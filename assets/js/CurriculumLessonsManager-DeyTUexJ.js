import{r as e,u as l,b as s,f as t,c as a,p as o,t as n,i,j as u,k as r,Q as d,l as c,o as p,d as m,h as v,e as y,aS as _}from"./app-DlLesFGi.js";import{Q as f}from"./QSpace-BK_PGLKv.js";import{Q as g}from"./QSelect-BTh0khse.js";import{f as b,a as h,o as V,I as k,J as x,K as j,b as C,R as q,V as w,N as T,O as E,Q as L,W as Q,z as U,a0 as $,F as A,y as F,_ as S}from"./vendor-BWKGNkNB.js";import{d as N}from"./vuedraggable.umd-DshT_Vng.js";import{E as I}from"./ExcelManager-K9-Y4G6v.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";import"./index-SlSKjXnq.js";import"./QTab-CYxYFXBq.js";import"./QTabs-BClcf-CB.js";import"./QTabPanel-DXa1fEFB.js";import"./use-panel-BqxRbB7W.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-CTgZWG49.js";import"./QFile-Cve4lAri.js";import"./use-file-DHXgO9tP.js";import"./QTable-BIAJAIui.js";import"./QMarkupTable-CzIo4GGA.js";import"./QLinearProgress-CX6G9yBK.js";import"./use-fullscreen-BQHoXYBI.js";import"./QTr-CEyXUusj.js";import"./xlsx-BHXqx-YI.js";const z={class:"col"},D={class:"q-my-none"},M={class:"col-auto"},O={key:0,class:"text-center q-py-lg text-grey-6"},P={class:"row items-center q-mb-md bg-grey-2 q-pa-md rounded-borders"},W={class:"col"},B={class:"q-my-none"},J={class:"text-grey-6 q-mb-none text-caption"},K={key:0,class:"col-auto q-gutter-xs"},G={class:"text-grey-8 q-gutter-xs"},R={key:0,class:"text-center q-py-md text-grey-6"},X={class:"text-h6"},Y={class:"q-gutter-md"},H={class:"text-h6"},Z={class:"q-gutter-md"},ee=e({__name:"CurriculumLessonsManager",props:{curriculum:{type:Object,required:!0}},emits:["close","updated"],setup(e,{emit:ee}){const le=e,se=ee,te=l(),ae=b([]),oe=b(!1),ne=b(!1),ie=b(null),ue=b(null),re=b(null),de=b(!1),ce=b(!1),pe=b(!1),me=b(!1),ve=b("import"),ye=b(!1),_e=["main","revision","quiz","project","extra"],fe=Array.from({length:21},(e,l)=>({label:l.toString(),value:l.toString()})),ge=b({number:"",title:"",description:""}),be=b({lesson_number:"",lesson_title:"",description:"",content:"",type:"main"}),he=h(()=>{if(0===ae.value.length)return[{topic_number:"1",topic_title:"Introduction",topic_description:"Basic concepts",lesson_number:"1.1",lesson_title:"What is it?",lesson_description:"Overview",lesson_content:"Some content here...",lesson_type:"main",page_number:1,standard:"",strand:"",skill:"",activities:"",assignment:"",assessment:"",objective:""}];const e=[];return ae.value.forEach(l=>{l.lessons&&0!==l.lessons.length?l.lessons.forEach(s=>{e.push({topic_number:l.number,topic_title:l.title,topic_description:l.description||"",lesson_number:s.lesson_number,lesson_title:s.lesson_title,lesson_description:s.description||"",lesson_content:s.content||"",lesson_type:s.type||"main",page_number:s.page_number||"",standard:s.standard||"",strand:s.strand||"",skill:s.skill||"",activities:s.activities||"",assignment:s.assignment||"",assessment:s.assessment||"",objective:s.objective||""})}):e.push({topic_number:l.number,topic_title:l.title,topic_description:l.description||"",lesson_number:"",lesson_title:"",lesson_description:"",lesson_content:"",lesson_type:"",page_number:"",standard:"",strand:"",skill:"",activities:"",assignment:"",assessment:"",objective:""})}),e}),Ve=(e="import")=>{ve.value=e,me.value=!0},ke=async()=>{pe.value=!0;try{const e=await S.get(`/api/curriculum/${le.curriculum.id}/topics`);ae.value=e.data}catch(e){te.notify({type:"negative",message:"Failed to load topics"})}finally{pe.value=!1}},xe=()=>{if(Ce(),ie.value=null,ae.value.length>0){const e=ae.value[ae.value.length-1],l=parseInt(e.number)||0;ge.value.number=(l+1).toString()}else ge.value.number="1";oe.value=!0},je=()=>{oe.value=!1,ie.value=null,Ce()},Ce=()=>{ge.value={number:"",title:"",description:""}},qe=async()=>{var e,l;if(ge.value.number&&ge.value.title){de.value=!0;try{const e={number:ge.value.number,title:ge.value.title,description:ge.value.description};ie.value?(await S.put(`/api/curriculum/topics/${ie.value.id}`,e),te.notify({type:"positive",message:"Topic updated successfully"})):(e.curriculum_id=le.curriculum.id,await S.post("/api/curriculum/topics",e),te.notify({type:"positive",message:"Topic created successfully"})),je(),ke(),se("updated")}catch(s){te.notify({type:"negative",message:(null==(l=null==(e=s.response)?void 0:e.data)?void 0:l.message)||"Failed to save topic"})}finally{de.value=!1}}else te.notify({type:"negative",message:"Please fill in all required fields"})},we=()=>{ne.value=!1,ue.value=null,re.value=null,Te()},Te=()=>{be.value={lesson_number:"",lesson_title:"",description:"",content:"",type:"main"}},Ee=async()=>{var e,l;if(be.value.lesson_number&&be.value.lesson_title){ce.value=!0;try{const e={lesson_number:be.value.lesson_number,lesson_title:be.value.lesson_title,description:be.value.description,content:be.value.content,type:be.value.type,school_id:le.curriculum.school_id};ue.value?(await S.put(`/api/curriculum/lessons/${ue.value.id}`,e),te.notify({type:"positive",message:"Lesson updated successfully"})):(e.topic_id=re.value.id,await S.post("/api/curriculum/lessons",e),te.notify({type:"positive",message:"Lesson created successfully"})),we(),ke(),se("updated")}catch(s){te.notify({type:"negative",message:(null==(l=null==(e=s.response)?void 0:e.data)?void 0:l.message)||"Failed to save lesson"})}finally{ce.value=!1}}else te.notify({type:"negative",message:"Please fill in all required fields"})},Le=async e=>{var l,s;try{const l=e.filter(e=>e.topic_number&&e.topic_title&&e.lesson_number&&e.lesson_title);if(0===l.length)return void te.notify({type:"negative",message:"No valid data found. Ensure topic_number, topic_title, lesson_number, and lesson_title are present."});const s=await S.post(`/api/curriculum/${le.curriculum.id}/bulk-import-topics-lessons`,{data:l});te.notify({type:"positive",message:s.data.message}),me.value=!1,ke(),se("updated")}catch(t){te.notify({type:"negative",message:(null==(s=null==(l=t.response)?void 0:l.data)?void 0:s.message)||"Failed to import data"})}};return V(()=>{ke()}),(l,b)=>(x(),k(m,{class:"full-height"},{default:j(()=>[C(t,{class:"row items-center q-pb-none"},{default:j(()=>[q("div",z,[q("h5",D,w(e.curriculum.name)+" - Topics & Lessons",1),b[16]||(b[16]=q("p",{class:"text-grey-6 q-mb-none"},"Manage topics and lessons for this curriculum",-1))]),q("div",M,[C(s,{flat:"",round:"",dense:"",icon:"close",onClick:b[0]||(b[0]=e=>l.$emit("close"))})])]),_:1}),C(a),C(t,{class:"q-pb-none"},{default:j(()=>[C(s,{color:"primary",icon:"add",label:"Add Topic",onClick:xe,unelevated:""}),C(s,{color:"primary",icon:"upload",label:"Import Excel",onClick:b[1]||(b[1]=e=>Ve("import")),unelevated:"",class:"q-ml-sm"}),C(s,{color:"primary",icon:"download",label:"Export to Excel",onClick:b[2]||(b[2]=e=>Ve("export")),unelevated:"",class:"q-ml-sm"}),C(f),C(o,{modelValue:ye.value,"onUpdate:modelValue":b[3]||(b[3]=e=>ye.value=e),label:"Edit Mode",color:"orange",icon:"edit"},null,8,["modelValue"])]),_:1}),C(t,{class:"scroll",style:{height:"calc(100% - 200px)"}},{default:j(()=>[0===ae.value.length?(x(),T("div",O,' No topics yet. Click "Add Topic" to create one. ')):E("",!0),(x(!0),T(A,null,L(ae.value,e=>{var l;return x(),T("div",{key:e.id,class:"q-mb-lg"},[q("div",P,[q("div",W,[q("h6",B,w(e.number)+" - "+w(e.title),1),q("p",J,w((null==(l=e.lessons)?void 0:l.length)||0)+" lessons",1)]),ye.value?(x(),T("div",K,[C(s,{size:"sm",flat:"",dense:"",round:"",icon:"add",color:"primary",onClick:l=>(e=>{if(re.value=e,Te(),ue.value=null,e.lessons&&e.lessons.length>0){const l=e.lessons[e.lessons.length-1],s=parseInt(l.lesson_number)||0;be.value.lesson_number=(s+1).toString()}else be.value.lesson_number="1";ne.value=!0})(e)},{default:j(()=>[C(n,null,{default:j(()=>b[17]||(b[17]=[Q("Add Lesson")])),_:1})]),_:2},1032,["onClick"]),C(s,{size:"sm",flat:"",dense:"",round:"",icon:"edit",color:"primary",onClick:l=>(e=>{ie.value=e,ge.value={number:e.number,title:e.title,description:e.description||""},oe.value=!0})(e)},{default:j(()=>[C(n,null,{default:j(()=>b[18]||(b[18]=[Q("Edit Topic")])),_:1})]),_:2},1032,["onClick"]),C(s,{size:"sm",flat:"",dense:"",round:"",icon:"delete",color:"negative",onClick:l=>(e=>{te.dialog({title:"Confirm Deletion",message:`Are you sure you want to delete "${e.title}"? All lessons in this topic will also be deleted.`,cancel:!0,persistent:!0,color:"negative"}).onOk(async()=>{var l,s;try{await S.delete(`/api/curriculum/topics/${e.id}`),te.notify({type:"positive",message:"Topic deleted successfully"}),ke(),se("updated")}catch(t){te.notify({type:"negative",message:(null==(s=null==(l=t.response)?void 0:l.data)?void 0:s.message)||"Failed to delete topic"})}})})(e)},{default:j(()=>[C(n,null,{default:j(()=>b[19]||(b[19]=[Q("Delete Topic")])),_:1})]),_:2},1032,["onClick"])])):E("",!0)]),C(i,{bordered:"",separator:"",class:"q-ml-lg"},{default:j(()=>[C(U(N),{modelValue:e.lessons,"onUpdate:modelValue":l=>e.lessons=l,"item-key":"id",onChange:l=>(async e=>{try{const l=e.lessons.map(e=>({id:e.id,lesson_number:e.lesson_number}));await S.post(`/api/curriculum/topics/${e.id}/lessons/reorder`,{lessons:l}),te.notify({type:"positive",message:"Lessons reordered successfully"}),se("updated")}catch(l){te.notify({type:"negative",message:"Failed to reorder lessons"}),ke()}})(e),class:"w-full"},{item:j(({element:l})=>[C(u,{clickable:""},{default:j(()=>[ye.value?(x(),k(r,{key:0,avatar:""},{default:j(()=>[C(d,{name:"drag_indicator",color:"grey"})]),_:1})):E("",!0),C(r,null,{default:j(()=>[C(c,null,{default:j(()=>[Q(w(l.lesson_number)+" - "+w(l.lesson_title),1)]),_:2},1024),C(c,{caption:""},{default:j(()=>[Q(w(l.description),1)]),_:2},1024)]),_:2},1024),ye.value?(x(),k(r,{key:1,side:"",top:""},{default:j(()=>[q("div",G,[C(s,{size:"sm",flat:"",dense:"",round:"",icon:"edit",color:"primary",onClick:$(s=>((e,l)=>{re.value=l,ue.value=e,be.value={lesson_number:e.lesson_number,lesson_title:e.lesson_title,description:e.description||"",content:e.content||"",type:e.type||"main"},ne.value=!0})(l,e),["stop"])},{default:j(()=>[C(n,null,{default:j(()=>b[20]||(b[20]=[Q("Edit")])),_:1})]),_:2},1032,["onClick"]),C(s,{size:"sm",flat:"",dense:"",round:"",icon:"delete",color:"negative",onClick:$(e=>(e=>{te.dialog({title:"Confirm Deletion",message:`Are you sure you want to delete "${e.lesson_title}"? This action cannot be undone.`,cancel:!0,persistent:!0,color:"negative"}).onOk(async()=>{var l,s;try{await S.delete(`/api/curriculum/lessons/${e.id}`),te.notify({type:"positive",message:"Lesson deleted successfully"}),ke(),se("updated")}catch(t){te.notify({type:"negative",message:(null==(s=null==(l=t.response)?void 0:l.data)?void 0:s.message)||"Failed to delete lesson"})}})})(l),["stop"])},{default:j(()=>[C(n,null,{default:j(()=>b[21]||(b[21]=[Q("Delete")])),_:1})]),_:2},1032,["onClick"])])]),_:2},1024)):E("",!0)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),e.lessons&&0!==e.lessons.length?E("",!0):(x(),T("div",R," No lessons in this topic "))]),_:2},1024)])}),128))]),_:1}),C(a),C(p,{align:"right"},{default:j(()=>[C(s,{flat:"",label:"Close",onClick:b[4]||(b[4]=e=>l.$emit("close"))})]),_:1}),C(y,{modelValue:oe.value,"onUpdate:modelValue":b[8]||(b[8]=e=>oe.value=e),persistent:""},{default:j(()=>[C(m,{style:{"min-width":"500px"}},{default:j(()=>[C(t,null,{default:j(()=>[q("div",X,w(ie.value?"Edit Topic":"Add New Topic"),1)]),_:1}),C(t,{class:"q-pt-none"},{default:j(()=>[q("div",Y,[C(g,{modelValue:ge.value.number,"onUpdate:modelValue":b[5]||(b[5]=e=>ge.value.number=e),options:U(fe),label:"Topic Number *",outlined:"",rules:[e=>null!==e&&""!==e||"Topic number is required"],"emit-value":"","map-options":""},null,8,["modelValue","options","rules"]),C(v,{modelValue:ge.value.title,"onUpdate:modelValue":b[6]||(b[6]=e=>ge.value.title=e),label:"Topic Title *",outlined:"",rules:[e=>!!e||"Title is required"]},null,8,["modelValue","rules"]),C(v,{modelValue:ge.value.description,"onUpdate:modelValue":b[7]||(b[7]=e=>ge.value.description=e),label:"Description",type:"textarea",rows:"3",outlined:""},null,8,["modelValue"])])]),_:1}),C(p,{align:"right"},{default:j(()=>[C(s,{flat:"",label:"Cancel",onClick:je}),C(s,{color:"primary",label:"Save",onClick:qe,loading:de.value,unelevated:""},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),C(y,{modelValue:ne.value,"onUpdate:modelValue":b[14]||(b[14]=e=>ne.value=e),persistent:""},{default:j(()=>[C(m,{style:{"min-width":"500px"}},{default:j(()=>[C(t,null,{default:j(()=>[q("div",H,w(ue.value?"Edit Lesson":"Add New Lesson"),1)]),_:1}),C(t,{class:"q-pt-none"},{default:j(()=>[q("div",Z,[C(g,{modelValue:be.value.lesson_number,"onUpdate:modelValue":b[9]||(b[9]=e=>be.value.lesson_number=e),options:U(fe),label:"Lesson Number *",outlined:"",rules:[e=>null!==e&&""!==e||"Lesson number is required"],"emit-value":"","map-options":""},null,8,["modelValue","options","rules"]),C(v,{modelValue:be.value.lesson_title,"onUpdate:modelValue":b[10]||(b[10]=e=>be.value.lesson_title=e),label:"Lesson Title *",outlined:"",rules:[e=>!!e||"Title is required"]},null,8,["modelValue","rules"]),C(v,{modelValue:be.value.description,"onUpdate:modelValue":b[11]||(b[11]=e=>be.value.description=e),label:"Description",type:"textarea",rows:"2",outlined:""},null,8,["modelValue"]),C(v,{modelValue:be.value.content,"onUpdate:modelValue":b[12]||(b[12]=e=>be.value.content=e),label:"Content",type:"textarea",rows:"4",outlined:""},null,8,["modelValue"]),C(g,{modelValue:be.value.type,"onUpdate:modelValue":b[13]||(b[13]=e=>be.value.type=e),options:_e,label:"Lesson Type",outlined:""},null,8,["modelValue"])])]),_:1}),C(p,{align:"right"},{default:j(()=>[C(s,{flat:"",label:"Cancel",onClick:we}),C(s,{color:"primary",label:"Save",onClick:Ee,loading:ce.value,unelevated:""},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),C(y,{modelValue:me.value,"onUpdate:modelValue":b[15]||(b[15]=e=>me.value=e),"full-width":""},{default:j(()=>[C(m,null,{default:j(()=>[C(t,{class:"row items-center q-pb-none"},{default:j(()=>[b[22]||(b[22]=q("div",{class:"text-h6"},"Import Topics & Lessons",-1)),C(f),F(C(s,{icon:"close",flat:"",round:"",dense:""},null,512),[[_]])]),_:1}),C(a),C(t,null,{default:j(()=>[C(I,{"export-file-name":`${e.curriculum.name}_topics_lessons.xlsx`,"export-data":he.value,"initial-tab":ve.value,onImportedJson:Le},null,8,["export-file-name","export-data","initial-tab"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},[["__scopeId","data-v-4a1e0372"]]);export{ee as default};
