import{u as l,d as e,g as a,Q as n,a as t,q as s,b as o,n as i,m as u,aD as r}from"./app-Dccx8xF5.js";import{u as c}from"./i18n-BbKXhR_S.js";import{f as d,k as p,a as m,H as v,I as w,J as y,b as k,M as b,U as f,y as g,L as h,O as _,x as P,V}from"./vendor-EI0FRBVb.js";import"./offline-BzIlwqNM.js";import"./ui-B__oX9pK.js";const x={class:"text-h6"},$={class:"q-gutter-md"},q={key:0,class:"row q-col-gutter-md"},C={class:"col-12 col-sm-6"},L={class:"row items-center q-gutter-sm q-mt-xs"},U={class:"row items-center q-gutter-sm q-mt-xs"},T={class:"row items-center q-gutter-sm q-mt-xs"},M={class:"text-subtitle2 q-mb-sm"},H={class:"q-gutter-md"},j=["innerHTML"],D={class:"text-caption text-grey-7"},I=["innerHTML"],O={class:"text-caption text-grey-7"},B=["innerHTML"],E={class:"text-h6"},F={__name:"WeeklyPlanEditor",props:{modelValue:{type:Boolean,required:!0},plan:{type:Object,required:!0},saving:{type:Boolean,default:!1}},emits:["update:modelValue","submit","close"],setup(F,{emit:K}){const N=F,W=K,A=l(),{t:J}=c(),Q=d(N.modelValue),S=d({...N.plan});p(()=>N.plan,l=>{S.value={...l}},{immediate:!0}),p(()=>N.modelValue,l=>{Q.value=l}),p(()=>Q.value,l=>{W("update:modelValue",l)});const z=()=>{S.value&&(S.value.cw="",S.value.hw="",S.value.notes="")},G=l=>{S.value&&(S.value[l]="")},R=async l=>{var e,a;try{await navigator.clipboard.writeText(null!=(a=null==(e=S.value)?void 0:e[l])?a:""),A.notify({type:"positive",message:J("weeklyPlans.notifications.copied")})}catch(n){A.notify({type:"negative",message:J("weeklyPlans.notifications.copyFailed")})}},X=async l=>{try{const e=await navigator.clipboard.readText();S.value[l]=e}catch(e){A.notify({type:"negative",message:J("weeklyPlans.notifications.pasteFailed")})}},Y=d(!1),Z=d("cw"),ll=d(""),el=d(""),al=l=>{Z.value=l,ll.value="",el.value="",Y.value=!0},nl=()=>{const l=(ll.value||"").trim(),e=(el.value||"").trim();if(!l)return void A.notify({type:"warning",message:J("weeklyPlans.notifications.enterUrl")});const a=e?`[${e}](${l})`:l,n=Z.value,t=S.value[n]||"";S.value[n]=t?`${t}\n${a}`:a,Y.value=!1},tl=l=>{let e=(l=>(l||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#039;"))(String(l||""));const a=[];e=e.replace(/\[([^\]]+)\]\((https?:\/\/[^\s)]+)\)/g,(l,e,n)=>{const t=`__LINK_${a.length}__`;return a.push(`<a href="${n}" target="_blank" rel="noopener">${e}</a>`),t}),e=e.replace(/(https?:\/\/[\w\-._~:/?#\[\]@!$&'()*+,;=%]+)/g,'<a href="$1" target="_blank" rel="noopener">$1</a>'),a.forEach((l,a)=>{e=e.replace(`__LINK_${a}__`,l)}),e=e.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>");const n=e.split(/\n/);let t="",s=!1,o=!1;const i=()=>{s&&(t+="</ul>",s=!1),o&&(t+="</ol>",o=!1)};for(let u=0;u<n.length;u++){const l=n[u];if(!l.trim()){i();continue}let e;(e=l.match(/^\s*###\s+(.+)/))?(i(),t+=`<h3>${e[1]}</h3>`):(e=l.match(/^\s*##\s+(.+)/))?(i(),t+=`<h2>${e[1]}</h2>`):(e=l.match(/^\s*#\s+(.+)/))?(i(),t+=`<h1>${e[1]}</h1>`):(e=l.match(/^\s*[-*]\s+(.+)/))?(s||(i(),t+="<ul>",s=!0),t+=`<li>${e[1]}</li>`):(e=l.match(/^\s*\d+\.\s+(.+)/))?(o||(i(),t+="<ol>",o=!0),t+=`<li>${e[1]}</li>`):(i(),t+=`<p>${l}</p>`)}return i(),t||""},sl=m(()=>{var l;return tl(null==(l=S.value)?void 0:l.cw)}),ol=m(()=>{var l;return tl(null==(l=S.value)?void 0:l.hw)}),il=m(()=>{var l;return tl(null==(l=S.value)?void 0:l.notes)});return(l,c)=>(w(),v(o,{modelValue:Q.value,"onUpdate:modelValue":c[21]||(c[21]=l=>Q.value=l),persistent:""},{default:y(()=>[k(i,{style:{"min-width":"600px"}},{default:y(()=>[k(e,null,{default:y(()=>[b("div",x,f(g(J)("weeklyPlans.editPlan")),1)]),_:1}),k(e,null,{default:y(()=>{var l,e;return[b("div",$,[(null==(e=null==(l=S.value)?void 0:l.schedule)?void 0:e.id)?(w(),h("div",q,[b("div",C,[k(a,{modelValue:S.value.schedule.period_order,"onUpdate:modelValue":c[0]||(c[0]=l=>S.value.schedule.period_order=l),modelModifiers:{number:!0},type:"number",min:"1",label:g(J)("weeklyPlans.periodOrder"),dense:"",outlined:""},null,8,["modelValue","label"])])])):_("",!0),b("div",null,[k(a,{modelValue:S.value.cw,"onUpdate:modelValue":c[1]||(c[1]=l=>S.value.cw=l),label:g(J)("weeklyPlans.classwork"),type:"textarea",rows:4},null,8,["modelValue","label"]),b("div",L,[k(n,{dense:"",flat:"",icon:"link",label:g(J)("weeklyPlans.insertLink"),onClick:c[2]||(c[2]=l=>al("cw"))},null,8,["label"]),k(n,{dense:"",flat:"",icon:"content_copy",label:g(J)("weeklyPlans.copy"),onClick:c[3]||(c[3]=l=>R("cw"))},null,8,["label"]),k(n,{dense:"",flat:"",icon:"content_paste",label:g(J)("weeklyPlans.paste"),onClick:c[4]||(c[4]=l=>X("cw"))},null,8,["label"]),k(n,{dense:"",flat:"",icon:"clear",label:g(J)("weeklyPlans.clear"),onClick:c[5]||(c[5]=l=>G("cw"))},null,8,["label"])])]),b("div",null,[k(a,{modelValue:S.value.hw,"onUpdate:modelValue":c[6]||(c[6]=l=>S.value.hw=l),label:g(J)("weeklyPlans.homework"),type:"textarea",rows:4},null,8,["modelValue","label"]),b("div",U,[k(n,{dense:"",flat:"",icon:"link",label:g(J)("weeklyPlans.insertLink"),onClick:c[7]||(c[7]=l=>al("hw"))},null,8,["label"]),k(n,{dense:"",flat:"",icon:"content_copy",label:g(J)("weeklyPlans.copy"),onClick:c[8]||(c[8]=l=>R("hw"))},null,8,["label"]),k(n,{dense:"",flat:"",icon:"content_paste",label:g(J)("weeklyPlans.paste"),onClick:c[9]||(c[9]=l=>X("hw"))},null,8,["label"]),k(n,{dense:"",flat:"",icon:"clear",label:g(J)("weeklyPlans.clear"),onClick:c[10]||(c[10]=l=>G("hw"))},null,8,["label"])])]),b("div",null,[k(a,{modelValue:S.value.notes,"onUpdate:modelValue":c[11]||(c[11]=l=>S.value.notes=l),label:g(J)("weeklyPlans.notes"),type:"textarea",rows:4},null,8,["modelValue","label"]),b("div",T,[k(n,{dense:"",flat:"",icon:"link",label:g(J)("weeklyPlans.insertLink"),onClick:c[12]||(c[12]=l=>al("notes"))},null,8,["label"]),k(n,{dense:"",flat:"",icon:"content_copy",label:g(J)("weeklyPlans.copy"),onClick:c[13]||(c[13]=l=>R("notes"))},null,8,["label"]),k(n,{dense:"",flat:"",icon:"content_paste",label:g(J)("weeklyPlans.paste"),onClick:c[14]||(c[14]=l=>X("notes"))},null,8,["label"]),k(n,{dense:"",flat:"",icon:"clear",label:g(J)("weeklyPlans.clear"),onClick:c[15]||(c[15]=l=>G("notes"))},null,8,["label"])])])])]}),_:1}),k(t),k(e,null,{default:y(()=>[b("div",M,f(g(J)("weeklyPlans.preview")),1),b("div",H,[b("div",null,[c[22]||(c[22]=b("div",{class:"text-caption text-grey-7"},"CW",-1)),b("div",{class:"q-pa-sm preview-content",innerHTML:sl.value},null,8,j)]),b("div",null,[b("div",D,f(g(J)("weeklyPlans.teacher.hwLabel")),1),b("div",{class:"q-pa-sm preview-content",innerHTML:ol.value},null,8,I)]),b("div",null,[b("div",O,f(g(J)("weeklyPlans.teacher.notesLabel")),1),b("div",{class:"q-pa-sm preview-content",innerHTML:il.value},null,8,B)])])]),_:1}),k(e,{align:"right"},{default:y(()=>[k(n,{flat:"",label:g(J)("weeklyPlans.clear"),color:"negative",onClick:z,class:"q-mr-sm"},{default:y(()=>[k(s,null,{default:y(()=>[V(f(g(J)("weeklyPlans.clearAllTooltip")),1)]),_:1})]),_:1},8,["label"]),P(k(n,{flat:"",label:g(J)("weeklyPlans.cancel"),onClick:c[16]||(c[16]=e=>l.$emit("close")),color:"primary"},null,8,["label"]),[[r]]),k(n,{flat:"",label:g(J)("weeklyPlans.save"),onClick:c[17]||(c[17]=e=>l.$emit("submit",S.value)),color:"primary",loading:F.saving},null,8,["label","loading"])]),_:1}),k(o,{modelValue:Y.value,"onUpdate:modelValue":c[20]||(c[20]=l=>Y.value=l)},{default:y(()=>[k(i,{style:{"min-width":"420px"}},{default:y(()=>[k(e,null,{default:y(()=>[b("div",E,f(g(J)("weeklyPlans.linkDialog.title")),1)]),_:1}),k(e,{class:"q-gutter-md"},{default:y(()=>[k(a,{modelValue:ll.value,"onUpdate:modelValue":c[18]||(c[18]=l=>ll.value=l),label:g(J)("weeklyPlans.linkDialog.urlLabel"),type:"url"},null,8,["modelValue","label"]),k(a,{modelValue:el.value,"onUpdate:modelValue":c[19]||(c[19]=l=>el.value=l),label:g(J)("weeklyPlans.linkDialog.textLabel")},null,8,["modelValue","label"])]),_:1}),k(u,{align:"right"},{default:y(()=>[P(k(n,{flat:"",label:g(J)("weeklyPlans.linkDialog.cancel")},null,8,["label"]),[[r]]),k(n,{flat:"",label:g(J)("weeklyPlans.linkDialog.insert"),color:"primary",onClick:nl},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]))}};export{F as default};
