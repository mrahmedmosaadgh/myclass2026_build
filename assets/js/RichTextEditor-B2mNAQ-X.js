import{r as e,u as l,Q as a,G as t,p as o,aS as n,b as s,f as r,c as i,h as u,t as d,br as c,F as m,d as p,g as v,o as g,e as f,i as y,k as b,l as h,j as x,aR as w,ao as _,H as k}from"./app-DlLesFGi.js";import{Q as V}from"./QColor-eqGXYKL_.js";import $ from"./purify.es-C2Ba6vpb.js";import{_ as C,f as T,k as A,a as q,I as S,J as I,K as M,b as z,R as P,W as Q,V as R,y as U,N as L,O as j,F,Q as H,B,z as E,o as G}from"./vendor-BWKGNkNB.js";import D from"./MathEditor-BWwFmcgr.js";import O from"./MathPastePreview-BAeMQ_tH.js";import{Q as K}from"./QSelect-BTh0khse.js";import{k as N}from"./katex-BXKQVcz-.js";import{Q as W}from"./QBadge-IdEcTs8C.js";import{Q as Y}from"./QTab-CYxYFXBq.js";import{Q as J}from"./QTabs-BClcf-CB.js";import{Q as X}from"./QTabPanel-DXa1fEFB.js";import{Q as Z}from"./QSlider-CuF3S-6I.js";import{Q as ee}from"./QTabPanels-CTgZWG49.js";const le=new class{async complete(e,l={}){var a,t,o,n;try{const a=await C.post("/api/ai/complete",{prompt:e,context:{previousMessages:l.previousMessages||[]},systemMessage:l.systemMessage,temperature:l.temperature||.7,maxTokens:l.maxTokens||2e3,model:l.model||"deepseek"});return{success:!0,content:a.data.content,usage:a.data.usage}}catch(s){return console.error("AI Service Error:",s),{success:!1,error:(null==(t=null==(a=s.response)?void 0:a.data)?void 0:t.error)||"Failed to get AI response",message:(null==(n=null==(o=s.response)?void 0:o.data)?void 0:n.message)||s.message}}}async improveText(e){return this.complete(`Improve the following text for clarity, grammar, and style:\n\n${e}`,{systemMessage:"You are an expert editor. Improve the text while maintaining its original meaning and tone.",temperature:.5})}async generateSimilarProblems(e,l=3){return this.complete(`Generate ${l} similar math problems to this one:\n\n${e}\n\nProvide only the problems, one per line.`,{systemMessage:"You are a math teacher creating practice problems. Generate similar problems with different numbers but the same concept.",temperature:.8})}async explainConcept(e,l="middle"){return this.complete(`Explain "${e}" in simple terms for ${l} school students.`,{systemMessage:"You are an experienced teacher. Explain concepts clearly and engagingly for students.",temperature:.6})}};const ae={class:"row items-center justify-between q-px-md"},te={class:"text-h5 flex items-center gap-3"},oe={class:"row items-center gap-3"},ne={class:"row q-pa-md",style:{"min-height":"560px"}},se={class:"col-12 col-lg-6 q-pr-lg-lg",style:{"max-height":"70vh","overflow-y":"auto"}},re={class:"q-gutter-y-md"},ie={key:0,class:"q-mb-md"},ue={class:"q-mt-xs"},de={key:1},ce={class:"q-mt-xs"},me={key:0,class:"q-mt-lg"},pe={class:"q-gutter-y-lg"},ve={key:0},ge={class:"q-gutter-y-md"},fe={class:"col-12 col-lg-6"},ye={class:"column full-height"},be={class:"row items-center justify-between q-mb-sm"},he={class:"text-h6 flex items-center gap-2"},xe=["innerHTML"],we={class:"row q-gutter-sm"},_e={key:0,class:"q-mt-md text-center"},ke={class:"q-mt-xs"},Ve=e({__name:"PromptBuilder",emits:["use-prompt","close"],setup(e,{emit:v}){const g=l(),f=v;T(!0);const y=T(!0),b=T("pro-quiz"),h=T(""),x=T({grade:"Grade 7",numQuestions:20,lessons:"5-1 Ratios and Rates\n5-2 Proportions\n5-3 Percent Problems",options:["withSections","withAnswerKey","withLatex"]}),w=T({topic:"",grade:"Grade 6",numQuestions:15,types:["multiple-choice","short-answer"],withAnswerKey:!0}),_=T({topic:"",grade:"",duration:60,style:"Direct"}),k=T(""),V=T(""),$=T([]),C=T({grade:[],lessons:[],topic:[]});try{const e=localStorage.getItem("promptBuilderHistory"),l=localStorage.getItem("promptBuilderFieldHistory");e&&($.value=JSON.parse(e)),l&&(C.value=JSON.parse(l))}catch(Te){console.error(Te)}const E=[{label:"Section per lesson",value:"withSections"},{label:"Group by type",value:"groupByType"},{label:"KaTeX math",value:"withLatex"},{label:"Answer key + explanations",value:"withAnswerKey"},{label:"Print-ready",value:"printReady"}],G=["multiple-choice","true-false","fill-in-blank","short-answer","matching"];function D(e){h.value=e}function O(e){return[...new Set(C.value[e]||[])].slice(0,8)}function N(e=!1){let l="";if("pro-quiz"===b.value){const e=x.value.lessons.split("\n").filter(e=>e.trim()).map(e=>`• ${e.trim()}`).join("\n")||"these topics",a=x.value.options||[];l=`Create a high-quality, ${x.value.numQuestions}-question quiz for ${x.value.grade} students covering:\n\n${e}\n\n`+(a.includes("withSections")?"Organize into sections by lesson.\n":"")+(a.includes("groupByType")?"Group by question type.\n":"")+(a.includes("withLatex")?"Use KaTeX for all math: \\frac{1}{2}, \\sqrt{x}\n":"")+(a.includes("withAnswerKey")?"Include detailed answer key with explanations at the end.\n":"")+(a.includes("printReady")?"Output in clean, print-ready HTML with title and name lines.\n":"")+"Use student misconceptions as distractors. Make it professional and ready to use."}else l="quiz"===b.value?`Generate a ${w.value.numQuestions}-question quiz about "${w.value.topic}" for ${w.value.grade} students. Include: ${w.value.types.join(", ")}. `+(w.value.withAnswerKey?"Add detailed answer key.":""):"custom"===b.value?k.value||"Your custom prompt will appear here...":"Select a template to begin...";V.value=l.trim(),function(e){if(!e||e.length<20)return;const l={text:e,template:b.value,timestamp:Date.now()};$.value=[l,...$.value.filter(l=>l.text!==e)].slice(0,20),localStorage.setItem("promptBuilderHistory",JSON.stringify($.value)),x.value.grade&&(C.value.grade=[x.value.grade,...C.value.grade.filter(e=>e!==x.value.grade)].slice(0,15));if(x.value.lessons){x.value.lessons.split("\n").map(e=>e.trim()).filter(Boolean).forEach(e=>{C.value.lessons.includes(e)||(C.value.lessons=[e,...C.value.lessons].slice(0,30))})}w.value.topic&&(C.value.topic=[w.value.topic,...C.value.topic.filter(e=>e!==w.value.topic)].slice(0,15));localStorage.setItem("promptBuilderFieldHistory",JSON.stringify(C.value))}(l)}A([x,w,_,k,b,y],()=>{N()},{deep:!0,immediate:!0});const le=q(()=>V.value?V.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/`(.*?)`/g,'<code class="bg-grey-3 q-px-xs rounded">$1</code>').replace(/\n/g,"<br>"):'<em class="text-grey-5">Your prompt will appear here...</em>');function Ve(e,l){return e.length>l?e.substring(0,l-3)+"...":e}function $e(){navigator.clipboard.writeText(V.value),g.notify({message:"Copied to clipboard!",type:"positive",icon:"content_copy"})}function Ce(){f("use-prompt",V.value)}return(e,l)=>(I(),S(p,{class:"prompt-builder-dialog",style:{width:"960px","max-width":"96vw","border-radius":"20px",overflow:"hidden"}},{default:M(()=>[z(r,{class:"bg-gradient text-white q-py-md"},{default:M(()=>[P("div",ae,[P("div",null,[P("div",te,[z(a,{name:"auto_awesome",size:"2rem"}),l[21]||(l[21]=Q(" Quick Prompt Builder ")),z(t,{dense:"",color:"white","text-color":"primary",icon:"bolt"},{default:M(()=>[Q(R(y.value?"Easy Mode":"Pro Mode"),1)]),_:1})]),l[22]||(l[22]=P("div",{class:"text-subtitle2 opacity-90 q-mt-xs"}," Build perfect AI prompts • History tags • Instant preview ",-1))]),P("div",oe,[z(o,{modelValue:y.value,"onUpdate:modelValue":l[0]||(l[0]=e=>y.value=e),color:"yellow",size:"lg",icon:"child_care",label:y.value?"Easy":"Pro","keep-color":""},null,8,["modelValue","label"]),U(z(s,{icon:"close",flat:"",round:"",dense:""},null,512),[[n]])])])]),_:1}),z(J,{modelValue:b.value,"onUpdate:modelValue":l[1]||(l[1]=e=>b.value=e),dense:"",class:"bg-grey-2","active-color":"primary","indicator-color":"primary",align:"justify"},{default:M(()=>[z(Y,{name:"pro-quiz",icon:"verified",label:"Pro Quiz"},{default:M(()=>[z(W,{color:"positive",floating:""},{default:M(()=>l[23]||(l[23]=[Q("Best")])),_:1})]),_:1}),z(Y,{name:"quiz",icon:"quiz",label:"Quick Quiz"}),z(Y,{name:"lesson",icon:"school",label:"Lesson Plan"}),z(Y,{name:"worksheet",icon:"assignment",label:"Worksheet"}),z(Y,{name:"flashcards",icon:"style",label:"Flashcards"}),z(Y,{name:"custom",icon:"tune",label:"Custom"})]),_:1},8,["modelValue"]),z(i),P("div",ne,[P("div",se,[z(ee,{modelValue:b.value,"onUpdate:modelValue":l[19]||(l[19]=e=>b.value=e),animated:"","keep-alive":""},{default:M(()=>[z(X,{name:"pro-quiz",class:"q-pa-none"},{default:M(()=>[P("div",re,[z(u,{modelValue:x.value.grade,"onUpdate:modelValue":l[2]||(l[2]=e=>x.value.grade=e),filled:"",label:"Grade / Course *",placeholder:"e.g. Grade 8, Algebra I, AP Biology",onFocus:l[3]||(l[3]=e=>D("grade"))},{prepend:M(()=>[z(a,{name:"school"})]),_:1},8,["modelValue"]),O("grade").length?(I(),L("div",ie,[l[24]||(l[24]=P("span",{class:"text-caption text-grey-6"},"Quick insert:",-1)),P("div",ue,[(I(!0),L(F,null,H(O("grade").slice(0,6),e=>(I(),S(t,{key:e,clickable:"",onClick:l=>x.value.grade=e,color:"primary","text-color":"white",size:"sm",class:"q-ma-xs"},{default:M(()=>[Q(R(e),1)]),_:2},1032,["onClick"]))),128))])])):j("",!0),z(u,{modelValue:x.value.numQuestions,"onUpdate:modelValue":l[4]||(l[4]=e=>x.value.numQuestions=e),modelModifiers:{number:!0},filled:"",type:"number",label:"Total Questions",min:5,max:y.value?25:60,hint:"Easy Mode: max 25"},{prepend:M(()=>[z(a,{name:"format_list_numbered"})]),_:1},8,["modelValue","max"]),z(u,{modelValue:x.value.lessons,"onUpdate:modelValue":l[5]||(l[5]=e=>x.value.lessons=e),filled:"",type:"textarea",rows:y.value?4:7,label:"Lessons / Topics * (one per line)",placeholder:"e.g. 5-1 Ratios\\n5-2 Percent Problems",autogrow:"",onFocus:l[6]||(l[6]=e=>D("lessons"))},{prepend:M(()=>[z(a,{name:"menu_book"})]),append:M(()=>[z(s,{flat:"",round:"",icon:"lightbulb",color:"amber"},{default:M(()=>[z(d,null,{default:M(()=>l[25]||(l[25]=[Q("Tip: Add page numbers!")])),_:1})]),_:1})]),_:1},8,["modelValue","rows"]),O("lessons").length?(I(),L("div",de,[l[26]||(l[26]=P("span",{class:"text-caption text-grey-6"},"Recent topics:",-1)),P("div",ce,[(I(!0),L(F,null,H(O("lessons").slice(0,8),e=>(I(),S(t,{key:e,clickable:"",onClick:l=>{return a=e,void(x.value.lessons+=(x.value.lessons?"\n":"")+a);var a},color:"teal","text-color":"white",size:"sm",icon:"history",class:"q-ma-xs"},{default:M(()=>[Q(R(Ve(e,22)),1)]),_:2},1032,["onClick"]))),128))])])):j("",!0),z(B,{name:"q-transition--fade"},{default:M(()=>[y.value?j("",!0):(I(),L("div",me,[l[27]||(l[27]=P("div",{class:"text-h6 text-primary q-mb-md"},"Advanced Options",-1)),z(c,{modelValue:x.value.options,"onUpdate:modelValue":l[7]||(l[7]=e=>x.value.options=e),options:E,type:"toggle",inline:"",color:"primary"},null,8,["modelValue"])]))]),_:1})])]),_:1}),z(X,{name:"quiz"},{default:M(()=>[P("div",pe,[z(u,{modelValue:w.value.topic,"onUpdate:modelValue":l[8]||(l[8]=e=>w.value.topic=e),filled:"",label:"Main Topic",onFocus:l[9]||(l[9]=e=>D("topic"))},null,8,["modelValue"]),O("topic").length?(I(),L("div",ve,[(I(!0),L(F,null,H(O("topic").slice(0,6),e=>(I(),S(t,{key:e,clickable:"",onClick:l=>w.value.topic=e,color:"orange","text-color":"white",size:"sm",class:"q-ma-xs"},{default:M(()=>[Q(R(e),1)]),_:2},1032,["onClick"]))),128))])):j("",!0),z(u,{modelValue:w.value.grade,"onUpdate:modelValue":l[10]||(l[10]=e=>w.value.grade=e),filled:"",label:"Grade Level"},null,8,["modelValue"]),z(Z,{modelValue:w.value.numQuestions,"onUpdate:modelValue":l[11]||(l[11]=e=>w.value.numQuestions=e),min:5,max:40,label:"","label-always":""},null,8,["modelValue"]),z(K,{modelValue:w.value.types,"onUpdate:modelValue":l[12]||(l[12]=e=>w.value.types=e),filled:"",multiple:"","use-chips":"",options:G,label:"Question Types"},null,8,["modelValue"]),z(o,{modelValue:w.value.withAnswerKey,"onUpdate:modelValue":l[13]||(l[13]=e=>w.value.withAnswerKey=e),label:"Include Answer Key + Explanations"},null,8,["modelValue"])])]),_:1}),z(X,{name:"lesson"},{default:M(()=>[P("div",ge,[z(u,{modelValue:_.value.topic,"onUpdate:modelValue":l[14]||(l[14]=e=>_.value.topic=e),filled:"",label:"Lesson Title"},null,8,["modelValue"]),z(u,{modelValue:_.value.grade,"onUpdate:modelValue":l[15]||(l[15]=e=>_.value.grade=e),filled:"",label:"Grade"},null,8,["modelValue"]),z(u,{modelValue:_.value.duration,"onUpdate:modelValue":l[16]||(l[16]=e=>_.value.duration=e),modelModifiers:{number:!0},filled:"",type:"number",suffix:" min",label:"Duration"},null,8,["modelValue"]),z(K,{modelValue:_.value.style,"onUpdate:modelValue":l[17]||(l[17]=e=>_.value.style=e),filled:"",options:["Direct","Inquiry","Flipped","Project-Based"],label:"Style"},null,8,["modelValue"])])]),_:1}),z(X,{name:"worksheet"},{default:M(()=>l[28]||(l[28]=[P("div",{class:"text-center text-grey"},"Worksheet builder coming soon...",-1)])),_:1}),z(X,{name:"flashcards"},{default:M(()=>l[29]||(l[29]=[P("div",{class:"text-center text-grey"},"Flashcards coming soon...",-1)])),_:1}),z(X,{name:"custom"},{default:M(()=>[z(u,{modelValue:k.value,"onUpdate:modelValue":l[18]||(l[18]=e=>k.value=e),filled:"",type:"textarea",autogrow:"",label:"Your Custom Prompt",placeholder:"Write or paste anything... full control!",class:"text-body1"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),P("div",fe,[P("div",ye,[P("div",be,[P("div",he,[z(a,{name:"preview",color:"primary"}),l[31]||(l[31]=Q(" Live Preview ")),z(t,{size:"sm",color:"positive",icon:"auto_mode"},{default:M(()=>l[30]||(l[30]=[Q("Auto")])),_:1})]),z(s,{flat:"",round:"",icon:"refresh",color:"grey-7",onClick:l[20]||(l[20]=e=>N(!0))})]),z(m,{class:"rounded-borders bg-grey-1 flex-grow-1 q-mb-md",style:{height:"1px"}},{default:M(()=>[P("div",{class:"q-pa-md font-mono text-body2",innerHTML:le.value},null,8,xe)]),_:1}),P("div",we,[z(s,{color:"grey-8",icon:"content_copy",label:"Copy",onClick:$e,class:"col",unelevated:""}),z(s,{color:"positive",icon:"send",label:"Send to AI",onClick:Ce,class:"col",unelevated:""})]),$.value.length?(I(),L("div",_e,[l[32]||(l[32]=P("span",{class:"text-caption text-grey"},"Recent prompts:",-1)),P("div",ke,[(I(!0),L(F,null,H($.value.slice(0,5),(e,l)=>(I(),S(t,{key:l,clickable:"",onClick:l=>function(e){V.value=e.text,b.value=e.template,g.notify({message:"Loaded from history",type:"positive",icon:"history"})}(e),size:"sm",color:"grey-4",class:"q-ma-xs"},{default:M(()=>[Q(R(Ve(e.text,28)),1)]),_:2},1032,["onClick"]))),128))])])):j("",!0)])])])]),_:1}))}},[["__scopeId","data-v-9cb32bec"]]),$e={class:"flex items-center justify-between"},Ce={class:"flex gap-2"},Te={key:0,class:"q-mt-md"},Ae=["innerHTML"],qe=e({__name:"AIAssistant",props:{modelValue:{type:Boolean,default:!1},initialPrompt:{type:String,default:""},context:{type:String,default:""},onInsert:{type:Function,default:null}},emits:["update:modelValue","insert"],setup(e,{emit:t}){const o=e,n=t,i=l(),{ask:c,loading:m,error:y,clearError:b}=function(){const e=T(!1),l=T(null),a=T("");return{loading:e,error:l,lastResponse:a,ask:async(t,o={})=>{if(!t||!t.trim())return l.value="Prompt cannot be empty","";e.value=!0,l.value=null;try{const e=await le.complete(t,o);return e.success?(a.value=e.content,e.content):(l.value=e.error||"Failed to get AI response","")}catch(n){return l.value=n.message||"An unexpected error occurred",""}finally{e.value=!1}},improveText:async t=>{if(!t||!t.trim())return l.value="Text cannot be empty","";e.value=!0,l.value=null;try{const e=await le.improveText(t);return e.success?(a.value=e.content,e.content):(l.value=e.error||"Failed to improve text","")}catch(o){return l.value=o.message||"An unexpected error occurred",""}finally{e.value=!1}},generateSimilarProblems:async(t,o=3)=>{if(!t||!t.trim())return l.value="Problem cannot be empty","";e.value=!0,l.value=null;try{const e=await le.generateSimilarProblems(t,o);return e.success?(a.value=e.content,e.content):(l.value=e.error||"Failed to generate problems","")}catch(n){return l.value=n.message||"An unexpected error occurred",""}finally{e.value=!1}},clearError:()=>{l.value=null}}}(),h=q({get:()=>o.modelValue,set:e=>n("update:modelValue",e)}),x=T(o.initialPrompt||""),w=T(""),_=T(localStorage.getItem("ai_model_preference")||"github"),k=T(!1),V=[{label:"GitHub (GPT-4o) - FREE",value:"github"},{label:"DeepSeek",value:"deepseek"},{label:"Gemini",value:"gemini"}],$=q(()=>w.value.replace(/\n/g,"<br>")),C=async()=>{b(),localStorage.setItem("ai_model_preference",_.value);let e=x.value;o.context&&(e=`Context:\n${o.context}\n\nRequest:\n${x.value}`);const l=await c(e,{model:_.value});l&&(w.value=l)},A=()=>{navigator.clipboard.writeText(w.value).then(()=>{i.notify({type:"positive",message:"Copied to clipboard!",position:"top",timeout:1500})})},U=()=>{let e=w.value;e=e.replace(/\\\((.*?)\\\)/g,"$$$1$$"),e=e.replace(/\\\[(.*?)\\\]/g,"$$$$$$1$$$$"),e=e.replace(/^### (.*?)$/gm,"<h3>$1</h3>"),e=e.replace(/^## (.*?)$/gm,"<h2>$1</h2>"),e=e.replace(/^# (.*?)$/gm,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<b>$1</b>"),e=e.replace(/\*(.*?)\*/g,"<i>$1</i>"),e=e.replace(/^---+$/gm,""),e=e.replace(/\n{3,}/g,"\n\n"),w.value=e.trim(),i.notify({type:"positive",message:"Delimiters fixed!",position:"top",timeout:1500})},H=()=>{let e=w.value;e=e.replace(/\\\((.*?)\\\)/g,"$$$1$$"),e=e.replace(/\\\[(.*?)\\\]/g,"$$$$$$1$$$$"),e=e.replace(/^### (.*?)$/gm,"<h3>$1</h3>"),e=e.replace(/^## (.*?)$/gm,"<h2>$1</h2>"),e=e.replace(/^# (.*?)$/gm,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<b>$1</b>"),e=e.replace(/\*(.*?)\*/g,"<i>$1</i>"),e=e.replace(/^---+$/gm,"");const l=/\$\$([\s\S]*?)\$\$|\$([\s\S]*?)\$/g;let a,t=0,o="";for(;null!==(a=l.exec(e));){o+=e.slice(t,a.index).replace(/\n/g,"<br>");const s=a[1],r=a[2];try{s?o+=N.renderToString(s,{throwOnError:!1,displayMode:!0}):r&&(o+=N.renderToString(r,{throwOnError:!1,displayMode:!1}))}catch(n){o+=`<span class="text-red-500">Error: ${n.message}</span>`}t=l.lastIndex}o+=e.slice(t).replace(/\n/g,"<br>"),w.value=o,i.notify({type:"positive",message:"Math rendered!",position:"top",timeout:1500})},B=()=>{o.onInsert&&o.onInsert(w.value),n("insert",w.value),G()},G=()=>{h.value=!1,setTimeout(()=>{x.value="",w.value="",b()},300)},D=e=>{x.value=e,k.value=!1};return(l,t)=>(I(),L(F,null,[z(f,{modelValue:h.value,"onUpdate:modelValue":t[3]||(t[3]=e=>h.value=e),persistent:""},{default:M(()=>[z(p,{style:{"min-width":"600px","max-width":"90vw"}},{default:M(()=>[z(r,null,{default:M(()=>[P("div",$e,[t[7]||(t[7]=P("div",null,[P("div",{class:"text-h6"},"AI Assistant"),P("div",{class:"text-caption text-grey"},"Ask AI to help with your content")],-1)),P("div",Ce,[z(s,{flat:"",dense:"",icon:"auto_awesome",color:"purple",onClick:t[0]||(t[0]=e=>k.value=!0)},{default:M(()=>[z(d,null,{default:M(()=>t[6]||(t[6]=[Q("Quick Prompt Builder")])),_:1})]),_:1}),z(K,{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=e=>_.value=e),options:V,label:"AI Model",dense:"",outlined:"","emit-value":"","map-options":"",style:{"min-width":"150px"}},{prepend:M(()=>[z(a,{name:"settings"})]),_:1},8,["modelValue"])])])]),_:1}),z(r,{class:"q-pt-none"},{default:M(()=>[z(u,{modelValue:x.value,"onUpdate:modelValue":t[2]||(t[2]=e=>x.value=e),filled:"",type:"textarea",rows:"4",label:"Your question or request",placeholder:"e.g., Improve this text, Generate 3 similar problems, Explain this concept...",disable:E(m),autofocus:""},null,8,["modelValue","disable"]),w.value?(I(),L("div",Te,[t[8]||(t[8]=P("div",{class:"text-subtitle2 text-grey-7 q-mb-xs"},"AI Response:",-1)),z(p,{flat:"",bordered:"",class:"q-pa-md bg-grey-1"},{default:M(()=>[P("div",{innerHTML:$.value,class:"markdown prose"},null,8,Ae)]),_:1})])):j("",!0),E(y)?(I(),S(v,{key:1,class:"bg-negative text-white q-mt-md",rounded:""},{avatar:M(()=>[z(a,{name:"error"})]),default:M(()=>[Q(" "+R(E(y)),1)]),_:1})):j("",!0)]),_:1}),z(g,{align:"right"},{default:M(()=>[z(s,{flat:"",label:"Cancel",color:"grey",onClick:G,disable:E(m)},null,8,["disable"]),w.value?(I(),S(s,{key:0,flat:"",label:"Copy",color:"primary",icon:"content_copy",onClick:A,disable:E(m)},null,8,["disable"])):j("",!0),w.value?(I(),S(s,{key:1,flat:"",label:"Fix Delimiters",color:"secondary",icon:"code",onClick:U,disable:E(m)},{default:M(()=>[z(d,null,{default:M(()=>t[9]||(t[9]=[Q("Convert \\(...\\) to $...$")])),_:1})]),_:1},8,["disable"])):j("",!0),w.value?(I(),S(s,{key:2,flat:"",label:"Render Math",color:"accent",icon:"functions",onClick:H,disable:E(m)},{default:M(()=>[z(d,null,{default:M(()=>t[10]||(t[10]=[Q("Render LaTeX with KaTeX")])),_:1})]),_:1},8,["disable"])):j("",!0),w.value&&e.onInsert?(I(),S(s,{key:3,unelevated:"",label:"Insert",color:"primary",icon:"add",onClick:B,disable:E(m)},null,8,["disable"])):j("",!0),z(s,{unelevated:"",label:"Ask AI",color:"accent",icon:"psychology",onClick:C,loading:E(m),disable:!x.value.trim()},null,8,["loading","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),z(f,{modelValue:k.value,"onUpdate:modelValue":t[5]||(t[5]=e=>k.value=e)},{default:M(()=>[z(Ve,{onClose:t[4]||(t[4]=e=>k.value=!1),onUsePrompt:D})]),_:1},8,["modelValue"])],64))}},[["__scopeId","data-v-2f30d47a"]]),Se={class:"rich-text-editor border border-gray-300 rounded-md shadow-sm overflow-hidden bg-white"},Ie={class:"w-full border-b border-grey-4 q-pa-xs flex gap-2 items-center"},Me={class:"flex items-center gap-1"},ze=e({__name:"RichTextEditor",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:l}){const a=e,t=l,o=T(null),r=T(!1),u=T(null),c=T(null),m=T(""),v=T(!0),g=T(!1),q=T(!1),R=T(!1);A(()=>a.modelValue,e=>{o.value&&e!==o.value.innerHTML&&(o.value.innerHTML=e)}),G(()=>{o.value&&(o.value.innerHTML=a.modelValue)});const H=()=>{o.value&&t("update:modelValue",o.value.innerHTML)},B=()=>{const e=window.getSelection();if(e.getRangeAt&&e.rangeCount){const l=e.getRangeAt(0);o.value&&o.value.contains(l.commonAncestorContainer)&&(u.value=l)}},E=()=>{if(u.value){const e=window.getSelection();e.removeAllRanges(),e.addRange(u.value)}else o.value&&o.value.focus()},K=e=>{"IMG"===e.target.tagName?(c.value=e.target,m.value=e.target.style.width||"auto",v.value="block"!==e.target.style.display):(c.value=null,m.value=""),B()},N=e=>{c.value&&(c.value.style.width=e,c.value.style.height="auto",m.value=e,H())},W=()=>{c.value&&(v.value=!v.value,v.value?(c.value.style.display="inline",c.value.style.margin=""):(c.value.style.display="block",c.value.style.margin="0 auto"),H())},Y=(e,l=null)=>{E(),document.execCommand(e,!1,l),B(),H()},J=e=>{E(),document.execCommand("insertHTML",!1,e),g.value=!1,B(),H()},X=e=>{E();const l=e.replace(/\n/g,"<br>");document.execCommand("insertHTML",!1,l),q.value=!1,B(),H()},Z=e=>{E(),document.execCommand("insertHTML",!1,e),R.value=!1,B(),H()},ee=()=>{const e=window.getSelection();return e&&e.rangeCount>0?e.toString():""},le=async e=>{try{return(await C.post(route("lesson-presentation.proxy-image"),{url:e})).data.base64}catch(l){return console.error("Failed to convert image:",e,l),null}},ae=async(e="cursor")=>{if(r.value=!0,o.value)if(o.value.focus(),"replace"===e){o.value.innerHTML="";const e=document.createRange(),l=window.getSelection();e.setStart(o.value,0),e.collapse(!0),l.removeAllRanges(),l.addRange(e),B()}else if("end"===e){const e=document.createRange(),l=window.getSelection();e.selectNodeContents(o.value),e.collapse(!1),l.removeAllRanges(),l.addRange(e),B()}else E();try{const e=await navigator.clipboard.read();for(const l of e){if(l.types.includes("text/html")){const e=await l.getType("text/html"),a=await e.text(),t=(new DOMParser).parseFromString(a,"text/html"),o=t.getElementsByTagName("img"),n=Array.from(o).map(async e=>{const l=e.getAttribute("src");if(l&&(l.startsWith("http://")||l.startsWith("https://"))){const a=await le(l);a&&e.setAttribute("src",a)}});await Promise.all(n);const s=$.sanitize(t.body.innerHTML,{ADD_TAGS:["img"],ADD_ATTR:["src","style","width","height","alt","class"]});return document.execCommand("insertHTML",!1,s),void H()}if(l.types.some(e=>e.startsWith("image/"))){const e=await l.getType(l.types.find(e=>e.startsWith("image/"))),a=new FileReader;return a.onload=e=>{const l=`<img src="${e.target.result}" style="max-width: 100%;" />`,a=$.sanitize(l,{ADD_TAGS:["img"],ADD_ATTR:["src","style"]});document.execCommand("insertHTML",!1,a),H()},void a.readAsDataURL(e)}if(l.types.includes("text/plain")){const e=await l.getType("text/plain"),a=await e.text();return document.execCommand("insertText",!1,a),void H()}}}catch(l){console.error("Failed to read clipboard contents: ",l);try{const e=await navigator.clipboard.readText();document.execCommand("insertText",!1,e),H()}catch(a){alert("Could not paste from clipboard. Please use Ctrl+V.")}}finally{r.value=!1}};return(e,l)=>(I(),L("div",Se,[P("div",Ie,[z(w,{split:"",onClick:l[3]||(l[3]=e=>ae("cursor")),loading:r.value,flat:"",dense:"",size:"sm",color:"grey-8",icon:"content_paste",label:"Paste","no-caps":""},{default:M(()=>[z(y,null,{default:M(()=>[U((I(),S(x,{clickable:"",onClick:l[0]||(l[0]=e=>ae("cursor"))},{default:M(()=>[z(b,null,{default:M(()=>[z(h,null,{default:M(()=>l[21]||(l[21]=[Q("Paste at Cursor")])),_:1})]),_:1})]),_:1})),[[n]]),U((I(),S(x,{clickable:"",onClick:l[1]||(l[1]=e=>R.value=!0)},{default:M(()=>[z(b,{class:"text-primary"},{default:M(()=>[z(h,null,{default:M(()=>l[22]||(l[22]=[Q("Smart Paste (Math/AI)...")])),_:1})]),_:1})]),_:1})),[[n]]),U((I(),S(x,{clickable:"",onClick:l[2]||(l[2]=e=>ae("replace"))},{default:M(()=>[z(b,{class:"text-red"},{default:M(()=>[z(h,null,{default:M(()=>l[23]||(l[23]=[Q("Replace All")])),_:1})]),_:1})]),_:1})),[[n]])]),_:1}),z(d,null,{default:M(()=>l[24]||(l[24]=[Q("Paste Options")])),_:1})]),_:1},8,["loading"]),z(i,{vertical:"",inset:""}),z(s,{flat:"",dense:"",size:"sm",color:"grey-8",icon:"format_color_text"},{default:M(()=>[z(d,null,{default:M(()=>l[25]||(l[25]=[Q("Text Color")])),_:1}),z(_,null,{default:M(()=>[z(V,{"no-header":"","no-footer":"","default-view":"palette","onUpdate:modelValue":l[4]||(l[4]=e=>Y("foreColor",e))})]),_:1})]),_:1}),z(s,{flat:"",dense:"",size:"sm",color:"grey-8",icon:"format_color_fill"},{default:M(()=>[z(d,null,{default:M(()=>l[26]||(l[26]=[Q("Background Color")])),_:1}),z(_,null,{default:M(()=>[z(V,{"no-header":"","no-footer":"","default-view":"palette","onUpdate:modelValue":l[5]||(l[5]=e=>Y("hiliteColor",e))})]),_:1})]),_:1}),z(i,{vertical:"",inset:""}),z(w,{flat:"",dense:"",size:"sm",color:"grey-8",icon:"format_size","no-caps":""},{default:M(()=>[z(y,null,{default:M(()=>[U((I(),S(x,{clickable:"",onClick:l[6]||(l[6]=e=>Y("fontSize","1"))},{default:M(()=>[z(b,null,{default:M(()=>l[27]||(l[27]=[Q("Small")])),_:1})]),_:1})),[[n]]),U((I(),S(x,{clickable:"",onClick:l[7]||(l[7]=e=>Y("fontSize","3"))},{default:M(()=>[z(b,null,{default:M(()=>l[28]||(l[28]=[Q("Normal")])),_:1})]),_:1})),[[n]]),U((I(),S(x,{clickable:"",onClick:l[8]||(l[8]=e=>Y("fontSize","5"))},{default:M(()=>[z(b,null,{default:M(()=>l[29]||(l[29]=[Q("Large")])),_:1})]),_:1})),[[n]]),U((I(),S(x,{clickable:"",onClick:l[9]||(l[9]=e=>Y("fontSize","7"))},{default:M(()=>[z(b,null,{default:M(()=>l[30]||(l[30]=[Q("Huge")])),_:1})]),_:1})),[[n]])]),_:1}),z(d,null,{default:M(()=>l[31]||(l[31]=[Q("Font Size")])),_:1})]),_:1}),z(i,{vertical:"",inset:""}),z(s,{onClick:l[10]||(l[10]=e=>Y("bold")),flat:"",dense:"",size:"sm",color:"grey-8",icon:"format_bold"},{default:M(()=>[z(d,null,{default:M(()=>l[32]||(l[32]=[Q("Bold")])),_:1})]),_:1}),z(s,{onClick:l[11]||(l[11]=e=>Y("italic")),flat:"",dense:"",size:"sm",color:"grey-8",icon:"format_italic"},{default:M(()=>[z(d,null,{default:M(()=>l[33]||(l[33]=[Q("Italic")])),_:1})]),_:1}),z(s,{onClick:l[12]||(l[12]=e=>Y("underline")),flat:"",dense:"",size:"sm",color:"grey-8",icon:"format_underlined"},{default:M(()=>[z(d,null,{default:M(()=>l[34]||(l[34]=[Q("Underline")])),_:1})]),_:1}),c.value?(I(),L(F,{key:0},[z(i,{vertical:"",inset:""}),P("div",Me,[l[36]||(l[36]=P("span",{class:"text-xs text-grey-7 q-ml-xs"},"Img:",-1)),z(k,{flat:"",dense:""},{default:M(()=>[z(s,{label:"25%",size:"sm",dense:"",color:"grey-8",onClick:l[13]||(l[13]=e=>N("25%"))}),z(s,{label:"50%",size:"sm",dense:"",color:"grey-8",onClick:l[14]||(l[14]=e=>N("50%"))}),z(s,{label:"100%",size:"sm",dense:"",color:"grey-8",onClick:l[15]||(l[15]=e=>N("100%"))})]),_:1}),z(s,{flat:!v.value,unelevated:v.value,color:v.value?"primary":"grey-8",size:"sm",dense:"",label:"Inline",onClick:W,class:"q-ml-xs"},{default:M(()=>[z(d,null,{default:M(()=>l[35]||(l[35]=[Q("Toggle Inline/Block")])),_:1})]),_:1},8,["flat","unelevated","color"])])],64)):j("",!0),z(i,{vertical:"",inset:""}),z(s,{onClick:l[16]||(l[16]=e=>g.value=!0),flat:"",dense:"",size:"sm",color:"grey-8",icon:"functions"},{default:M(()=>[z(d,null,{default:M(()=>l[37]||(l[37]=[Q("Insert Math Equation")])),_:1})]),_:1}),z(s,{onClick:l[17]||(l[17]=e=>q.value=!0),flat:"",dense:"",size:"sm",color:"accent",icon:"psychology"},{default:M(()=>[z(d,null,{default:M(()=>l[38]||(l[38]=[Q("AI Assistant")])),_:1})]),_:1})]),P("div",{ref_key:"editor",ref:o,class:"max-h-96 overflow-y-auto markdown prose dark:prose-invert w-full break-words markdown-new-styling",contenteditable:"true",onInput:H,onBlur:H,onMouseup:B,onKeyup:B,onMouseleave:B,onClick:K},null,544),z(f,{modelValue:g.value,"onUpdate:modelValue":l[18]||(l[18]=e=>g.value=e)},{default:M(()=>[z(p,{style:{"min-width":"600px","max-width":"90vw"}},{default:M(()=>[z(D,{onInsert:J})]),_:1})]),_:1},8,["modelValue"]),z(f,{modelValue:R.value,"onUpdate:modelValue":l[19]||(l[19]=e=>R.value=e),"full-width":"","full-height":""},{default:M(()=>[z(p,{class:"flex flex-col h-full overflow-hidden"},{default:M(()=>[z(O,{onInsert:Z})]),_:1})]),_:1},8,["modelValue"]),z(qe,{modelValue:q.value,"onUpdate:modelValue":l[20]||(l[20]=e=>q.value=e),context:ee(),"on-insert":X},null,8,["modelValue","context"])]))}},[["__scopeId","data-v-45c9ebd5"]]),Pe=Object.freeze(Object.defineProperty({__proto__:null,default:ze},Symbol.toStringTag,{value:"Module"}));export{qe as A,ze as R,Pe as a};
