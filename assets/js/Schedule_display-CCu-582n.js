import{r as e,u as l,Q as a,b as o,h as s,d as t,f as r,o as n,aS as d,e as i}from"./app-DTyzyps1.js";import{Q as u}from"./QTd-BUEdgfO2.js";import{Q as c}from"./QSelect-D0qwdF6_.js";import{Q as v}from"./QTable-ONISDY_Z.js";import{f as p,a as m,k as f,N as b,Q as y,J as g,b as h,K as w,O as _,F as C,z as k,V as j,W as V,y as S,_ as q}from"./vendor-BJyC5yAd.js";import"./offline-BzIlwqNM.js";import"./i18n-BDgsCcB6.js";import"./ui-DFn3cvMd.js";import"./rtl-Cr6c3OOr.js";import"./QMarkupTable-xjy79eNm.js";import"./QLinearProgress-Diz1Ffz5.js";import"./use-fullscreen-DbVybjDH.js";const Q={key:0,class:"mt-4"},P={class:"row full-width q-col-gutter-md"},I={class:"col-12 col-md-6"},U={class:"col-12 col-md-6 flex justify-end items-center"},x={class:"edit-actions q-mt-sm"},T=["onClick"],L={class:"edit-actions q-mt-sm"},$=["onClick"],A={class:"full-width row flex-center q-gutter-sm"},B={class:"text-negative"},D=e({__name:"Schedule_display",props:{schoolId:{type:Number,required:!0},scheduleCopyId:{type:Number,required:!0}},setup(e){const D=l(),E=e,F=[{name:"id",label:"ID",field:"id",align:"left",sortable:!0},{name:"classroom",label:"Classroom",field:e=>{var l,a;return null==(a=null==(l=e.cst)?void 0:l.classroom)?void 0:a.name},align:"left",sortable:!0},{name:"subject",label:"Subject",field:e=>{var l,a;return null==(a=null==(l=e.cst)?void 0:l.subject)?void 0:a.name},align:"left",sortable:!0},{name:"teacher",label:"Teacher",field:e=>{var l,a;return null==(a=null==(l=e.cst)?void 0:l.teacher)?void 0:a.name},align:"left",sortable:!0},{name:"period_number",label:"Period",field:"period_number",align:"center",sortable:!0},{name:"day",label:"Day",field:"day",align:"center",sortable:!0},{name:"active",label:"Active",field:"active",align:"center",sortable:!0}],N=p({sortBy:"period_number",descending:!1,page:1,rowsPerPage:10}),R=p(E.schoolId),z=p([]),K=p(!1),M=p(!1),O=p(""),W=p(""),J=p(null),G=p(""),H=p(""),X=p(!1),Y=p(null),Z=e=>["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"][e-1]||`Day ${e}`,ee=Array.from({length:10},(e,l)=>({label:`Period ${l+1}`,value:l+1})),le=Array.from({length:5},(e,l)=>({label:Z(l+1),value:l+1})),ae=(e,l,a)=>{J.value=e,G.value=l,H.value=a},oe=()=>{J.value=null,G.value=""},se=e=>{Y.value=e,X.value=!0},te=async e=>{var l,a;try{K.value=!0,await q.post(`/admin/schedules/update/${e.id}`,{[G.value]:H.value}),e[G.value]=H.value,D.notify({type:"positive",message:"Schedule updated successfully"})}catch(o){D.notify({type:"negative",message:(null==(a=null==(l=o.response)?void 0:l.data)?void 0:a.message)||"Failed to update schedule"}),console.error("Error updating schedule:",o)}finally{J.value=null,G.value="",X.value=!1,K.value=!1}},re=m(()=>{let e=[...z.value];if(W.value){const l=W.value.toLowerCase();e=e.filter(e=>{var a,o,s,t,r,n;return((null==(o=null==(a=e.cst)?void 0:a.classroom)?void 0:o.name)||"").toLowerCase().includes(l)||((null==(t=null==(s=e.cst)?void 0:s.subject)?void 0:t.name)||"").toLowerCase().includes(l)||((null==(n=null==(r=e.cst)?void 0:r.teacher)?void 0:n.name)||"").toLowerCase().includes(l)||String(e.period_number).includes(l)||Z(e.day).toLowerCase().includes(l)})}return e}),ne=async()=>{var e,l;try{K.value=!0;const e=await q.get(`/admin/schedules/${E.schoolId}/${E.scheduleCopyId}`);z.value=e.data}catch(a){O.value=(null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||"Failed to fetch schedule data",M.value=!0,console.error("Error fetching schedule data:",a)}finally{K.value=!1}},de=()=>{N.value.page=1},ie=e=>{N.value.page=e.pagination.page,N.value.rowsPerPage=e.pagination.rowsPerPage,N.value.sortBy=e.pagination.sortBy,N.value.descending=e.pagination.descending};return f(()=>E.scheduleCopyId,ne,{immediate:!0}),(l,p)=>R.value&&e.scheduleCopyId?(g(),b("div",Q,[h(v,{title:"Schedule Entries",rows:re.value,columns:F,"row-key":"id",loading:K.value,pagination:N.value,"rows-per-page-options":[10,20,50],flat:"",bordered:"",dense:"",onRequest:ie},{top:w(()=>[_("div",P,[_("div",I,[h(s,{modelValue:W.value,"onUpdate:modelValue":[p[0]||(p[0]=e=>W.value=e),de],dense:"",outlined:"",placeholder:"Search...",class:"q-mb-md"},{append:w(()=>[h(a,{name:"search"})]),_:1},8,["modelValue"])]),_("div",U,[h(o,{color:"primary",icon:"refresh",onClick:ne,loading:K.value,label:"Refresh",class:"q-ml-md"},null,8,["loading"])])])]),"body-cell-classroom":w(e=>[h(u,{props:e},{default:w(()=>{var l,a;return[V(j((null==(a=null==(l=e.row.cst)?void 0:l.classroom)?void 0:a.name)||"-"),1)]}),_:2},1032,["props"])]),"body-cell-subject":w(e=>[h(u,{props:e},{default:w(()=>{var l,a;return[V(j((null==(a=null==(l=e.row.cst)?void 0:l.subject)?void 0:a.name)||"-"),1)]}),_:2},1032,["props"])]),"body-cell-teacher":w(e=>[h(u,{props:e},{default:w(()=>{var l,a;return[V(j((null==(a=null==(l=e.row.cst)?void 0:l.teacher)?void 0:a.name)||"-"),1)]}),_:2},1032,["props"])]),"body-cell-period_number":w(e=>[h(u,{props:e,class:"editable-cell"},{default:w(()=>[J.value===e.row.id&&"period_number"===G.value?(g(),b(C,{key:0},[h(c,{modelValue:H.value,"onUpdate:modelValue":[p[1]||(p[1]=e=>H.value=e),l=>se(e.row)],options:k(ee),"option-value":"value","option-label":"label","emit-value":"","map-options":"",dense:"",outlined:"",class:"edit-select",rules:[e=>!!e||"Period is required"]},null,8,["modelValue","options","onUpdate:modelValue","rules"]),_("div",x,[h(o,{flat:"",dense:"",color:"positive",icon:"check",onClick:l=>te(e.row)},null,8,["onClick"]),h(o,{flat:"",dense:"",color:"negative",icon:"close",onClick:oe})])],64)):(g(),b("div",{key:1,class:"editable-content",onClick:l=>ae(e.row.id,"period_number",e.row.period_number)},j(e.row.period_number),9,T))]),_:2},1032,["props"])]),"body-cell-day":w(e=>[h(u,{props:e,class:"editable-cell"},{default:w(()=>[J.value===e.row.id&&"day"===G.value?(g(),b(C,{key:0},[h(c,{modelValue:H.value,"onUpdate:modelValue":[p[2]||(p[2]=e=>H.value=e),l=>se(e.row)],options:k(le),"option-value":"value","option-label":"label","emit-value":"","map-options":"",dense:"",outlined:"",class:"edit-select",rules:[e=>!!e||"Day is required"]},null,8,["modelValue","options","onUpdate:modelValue","rules"]),_("div",L,[h(o,{flat:"",dense:"",color:"positive",icon:"check",onClick:l=>te(e.row)},null,8,["onClick"]),h(o,{flat:"",dense:"",color:"negative",icon:"close",onClick:oe})])],64)):(g(),b("div",{key:1,class:"editable-content",onClick:l=>ae(e.row.id,"day",e.row.day)},j(Z(e.row.day)),9,$))]),_:2},1032,["props"])]),"body-cell-active":w(e=>[h(u,{props:e},{default:w(()=>[h(a,{name:e.row.active?"check_circle":"cancel",color:e.row.active?"positive":"negative"},null,8,["name","color"])]),_:2},1032,["props"])]),"no-data":w(()=>[_("div",A,[h(a,{size:"2em",name:"sentiment_dissatisfied"}),p[6]||(p[6]=_("span",null,"No matching records found",-1))])]),_:1},8,["rows","loading","pagination"]),h(i,{modelValue:M.value,"onUpdate:modelValue":p[3]||(p[3]=e=>M.value=e)},{default:w(()=>[h(t,null,{default:w(()=>[h(r,null,{default:w(()=>[p[7]||(p[7]=_("div",{class:"text-h6"},"Error",-1)),_("div",B,j(O.value),1)]),_:1}),h(n,{align:"right"},{default:w(()=>[S(h(o,{flat:"",label:"OK",color:"primary"},null,512),[[d]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),h(i,{modelValue:X.value,"onUpdate:modelValue":p[5]||(p[5]=e=>X.value=e)},{default:w(()=>[h(t,null,{default:w(()=>[h(r,null,{default:w(()=>p[8]||(p[8]=[_("div",{class:"text-h6"},"Confirm Changes",-1),_("div",{class:"text-body1"},"Are you sure you want to save the changes?",-1)])),_:1}),h(n,{align:"right"},{default:w(()=>[S(h(o,{flat:"",label:"Cancel",color:"negative"},null,512),[[d]]),h(o,{flat:"",label:"Save",color:"positive",onClick:p[4]||(p[4]=e=>te(Y.value))})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):y("",!0)}},[["__scopeId","data-v-1b4c281b"]]);export{D as default};
