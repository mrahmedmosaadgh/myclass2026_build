import{r as e,u as l,b as a,f as i,H as o,t,G as u,d as s,o as n,e as d,h as r,m as c,c as m}from"./app-DlLesFGi.js";import{Q as v}from"./QTd-BU_S4ffH.js";import{Q as p}from"./QTable-BIAJAIui.js";import{Q as g}from"./QSelect-BTh0khse.js";import{Q as f}from"./QSpace-BK_PGLKv.js";import b from"./CurriculumLessonsManager-DeyTUexJ.js";import{E as _}from"./ExcelManager-K9-Y4G6v.js";import{f as y,r as h,a as j,o as w,N as V,J as C,R as k,b as x,K as U,W as S,V as $,I as q,O as Q,_ as A}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./QMarkupTable-CzIo4GGA.js";import"./QLinearProgress-CX6G9yBK.js";import"./use-fullscreen-BQHoXYBI.js";import"./rtl-Cr6c3OOr.js";import"./vuedraggable.umd-DshT_Vng.js";import"./index-SlSKjXnq.js";import"./QTab-CYxYFXBq.js";import"./QTabs-BClcf-CB.js";import"./QTabPanel-DXa1fEFB.js";import"./use-panel-BqxRbB7W.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-CTgZWG49.js";import"./QFile-Cve4lAri.js";import"./use-file-DHXgO9tP.js";import"./QTr-CEyXUusj.js";import"./xlsx-BHXqx-YI.js";const N={class:"q-pa-md"},F={class:"row items-center q-mb-lg"},P={class:"col-auto q-gutter-sm"},E={class:"q-gutter-md"},T={class:"text-h6"},I={class:"q-gutter-md"},D=e({__name:"CurriculumManagement",setup(e){const D=l(),G=y([]),M=y([]),z=y([]),L=y([]),B=y([]),O=y([]),R=y(!1),J=y(!1),K=y(!1),W=y(!1),Y=y(!1),H=y(!1),X=y(!1),Z=y(!1),ee=y(!1),le=y(!1),ae=y(!1),ie=y(null),oe=y(null),te=h({school_id:null,subject_id:null,grade_id:null,active:null}),ue=h({school_id:null,subject_id:null,grade_id:null,name:"",description:"",active:!1}),se=[{name:"name",required:!0,label:"Curriculum Name",align:"left",field:"name",sortable:!0},{name:"school",label:"School",align:"left",field:e=>{var l;return(null==(l=e.school)?void 0:l.name)||"N/A"},sortable:!1},{name:"subject",label:"Subject",align:"left",field:e=>{var l;return(null==(l=e.subject)?void 0:l.name)||"N/A"},sortable:!1},{name:"grade",label:"Grade",align:"left",field:e=>{var l;return(null==(l=e.grade)?void 0:l.name)||"N/A"},sortable:!1},{name:"active",label:"Status",align:"center",field:"active",sortable:!0},{name:"created_at",label:"Created",align:"left",field:"created_at",format:e=>new Date(e).toLocaleDateString(),sortable:!0},{name:"actions",label:"Actions",align:"center",field:"actions",sortable:!1}],ne=y({sortBy:"created_at",descending:!0,page:1,rowsPerPage:15,rowsNumber:0}),de=[{label:"Active",value:1},{label:"Inactive",value:0}],re=j(()=>G.value.map(e=>{var l,a,i;return{name:e.name,school:(null==(l=e.school)?void 0:l.name)||"",subject:(null==(a=e.subject)?void 0:a.name)||"",grade:(null==(i=e.grade)?void 0:i.name)||"",description:e.description||"",active:1===e.active?"Yes":"No"}})),ce=async e=>{if(e){W.value=!0;try{const l=await A.get(`/api/curriculum/school/${e}/subjects`);B.value=l.data}catch(l){D.notify({type:"negative",message:"Failed to load subjects"})}finally{W.value=!1}}else B.value=[]},me=async e=>{if(e){Y.value=!0;try{const l=await A.get(`/api/curriculum/school/${e}/grades`);O.value=l.data}catch(l){D.notify({type:"negative",message:"Failed to load grades"})}finally{Y.value=!1}}else O.value=[]},ve=async()=>{var e,l,a;H.value=!0;try{const i=new URLSearchParams,o=(null==(e=te.school_id)?void 0:e.id)||te.school_id,t=(null==(l=te.subject_id)?void 0:l.id)||te.subject_id,u=(null==(a=te.grade_id)?void 0:a.id)||te.grade_id;o&&i.append("school_id",o),t&&i.append("subject_id",t),u&&i.append("grade_id",u),null!==te.active&&i.append("active",te.active);const s=await A.get(`/api/curriculum/curricula?${i}`);G.value=s.data.data,ne.value.rowsNumber=s.data.total}catch(i){D.notify({type:"negative",message:"Failed to load curricula"})}finally{H.value=!1}},pe=e=>{const l=(null==e?void 0:e.id)||e;te.school_id=l,te.subject_id=null,te.grade_id=null,l?((async e=>{if(e){J.value=!0;try{const l=await A.get(`/api/curriculum/school/${e}/subjects`);z.value=l.data}catch(l){D.notify({type:"negative",message:"Failed to load subjects"})}finally{J.value=!1}}else z.value=[]})(l),(async e=>{if(e){K.value=!0;try{const l=await A.get(`/api/curriculum/school/${e}/grades`);L.value=l.data}catch(l){D.notify({type:"negative",message:"Failed to load grades"})}finally{K.value=!1}}else L.value=[]})(l)):(z.value=[],L.value=[])},ge=e=>{const l=(null==e?void 0:e.id)||e;ue.school_id=l,ue.subject_id=null,ue.grade_id=null,l?(ce(l),me(l)):(B.value=[],O.value=[])},fe=e=>{const{page:l,rowsPerPage:a,sortBy:i,descending:o}=e.pagination;ne.value.page=l,ne.value.rowsPerPage=a,ne.value.sortBy=i,ne.value.descending=o,ve()},be=()=>{ee.value=!1,ve()},_e=()=>{te.school_id=null,te.subject_id=null,te.grade_id=null,te.active=null,z.value=[],L.value=[]},ye=async e=>{var l,a;try{const l=e.filter(e=>e.name&&e.school&&e.subject&&e.grade);if(0===l.length)return void D.notify({type:"negative",message:"No valid curricula found in imported data"});const a=await A.post("/api/curriculum/bulk-import",{curricula:l});D.notify({type:"positive",message:`Successfully imported ${a.data.imported} curricula`}),ae.value=!1,ve()}catch(i){D.notify({type:"negative",message:(null==(a=null==(l=i.response)?void 0:l.data)?void 0:a.message)||"Failed to import curricula"})}},he=e=>{D.notify({type:"positive",message:`Exported ${e.recordCount} curricula to ${e.fileName}`})},je=()=>{we(),Z.value=!0},we=()=>{ue.school_id=null,ue.subject_id=null,ue.grade_id=null,ue.name="",ue.description="",ue.active=!1,B.value=[],O.value=[],ie.value=null},Ve=()=>{Z.value=!1,we()},Ce=async()=>{var e,l,a,i,o;if(ue.school_id)if(ue.subject_id)if(ue.grade_id)if(ue.name&&""!==ue.name.trim()){X.value=!0;try{const i={name:ue.name.trim(),description:ue.description.trim(),school_id:(null==(e=ue.school_id)?void 0:e.id)||ue.school_id,subject_id:(null==(l=ue.subject_id)?void 0:l.id)||ue.subject_id,grade_id:(null==(a=ue.grade_id)?void 0:a.id)||ue.grade_id,active:ue.active?1:0};ie.value?(await A.put(`/api/curriculum/curricula/${ie.value.id}`,i),D.notify({type:"positive",message:"Curriculum updated successfully"})):(await A.post("/api/curriculum/curricula",i),D.notify({type:"positive",message:"Curriculum created successfully"})),Ve(),ve()}catch(t){D.notify({type:"negative",message:(null==(o=null==(i=t.response)?void 0:i.data)?void 0:o.message)||"Failed to save curriculum"})}finally{X.value=!1}}else D.notify({type:"negative",message:"Please enter a curriculum name"});else D.notify({type:"negative",message:"Please select a grade"});else D.notify({type:"negative",message:"Please select a subject"});else D.notify({type:"negative",message:"Please select a school"})};return w(()=>{(async()=>{R.value=!0;try{const e=await A.get("/api/curriculum/user-schools");M.value=e.data}catch(e){D.notify({type:"negative",message:"Failed to load schools"})}finally{R.value=!1}})(),ve()}),(e,l)=>(C(),V("div",N,[k("div",F,[l[19]||(l[19]=k("div",{class:"col"},[k("h4",{class:"text-h4 q-my-none"},"Curriculum Management"),k("p",{class:"text-grey-6 q-mb-none"},"Manage curricula for your schools and subjects")],-1)),k("div",P,[x(a,{color:"primary",icon:"add",label:"Add Curriculum",onClick:je,unelevated:""}),x(a,{color:"primary",icon:"filter_list",label:"Filter",onClick:l[0]||(l[0]=e=>ee.value=!0),unelevated:""}),x(a,{color:"primary",icon:"import_export",label:"Import/Export",onClick:l[1]||(l[1]=e=>ae.value=!0),unelevated:""})])]),x(s,null,{default:U(()=>[x(i,null,{default:U(()=>[x(p,{rows:G.value,columns:se,"row-key":"id",loading:H.value,pagination:ne.value,onRequest:fe,"binary-state-sort":""},{"body-cell-active":U(e=>[x(v,{props:e},{default:U(()=>[x(u,{color:1===e.value?"green":"grey","text-color":1===e.value?"white":"black",size:"sm"},{default:U(()=>[S($(1===e.value?"Active":"Inactive"),1)]),_:2},1032,["color","text-color"])]),_:2},1032,["props"])]),"body-cell-actions":U(e=>[x(v,{props:e},{default:U(()=>[x(o,{flat:""},{default:U(()=>[x(a,{flat:"",dense:"",color:"info",icon:"visibility",onClick:l=>{return a=e.row,oe.value=a,void(le.value=!0);var a},size:"sm"},{default:U(()=>[x(t,null,{default:U(()=>l[20]||(l[20]=[S("View Lessons")])),_:1})]),_:2},1032,["onClick"]),x(a,{flat:"",dense:"",color:"primary",icon:"edit",onClick:l=>{return a=e.row,ie.value=a,ue.school_id=a.school||{id:a.school_id,name:"Unknown"},ue.subject_id=a.subject||{id:a.subject_id,name:"Unknown"},ue.grade_id=a.grade||{id:a.grade_id,name:"Unknown"},ue.name=a.name,ue.description=a.description||"",ue.active=1===a.active,B.value=[a.subject||{id:a.subject_id,name:"Unknown"}],O.value=[a.grade||{id:a.grade_id,name:"Unknown"}],ce(a.school_id),me(a.school_id),void(Z.value=!0);var a},size:"sm"},{default:U(()=>[x(t,null,{default:U(()=>l[21]||(l[21]=[S("Edit")])),_:1})]),_:2},1032,["onClick"]),x(a,{flat:"",dense:"",color:1===e.row.active?"orange":"green",icon:1===e.row.active?"pause":"play_arrow",onClick:l=>(async e=>{const l=1===e.active?"deactivate":"activate",a=1===e.active?"deactivate":"activate";D.dialog({title:"Confirm Action",message:`Are you sure you want to ${a} this curriculum?${"activate"===l?" This will deactivate other curricula for the same subject and grade.":""}`,cancel:!0,persistent:!0}).onOk(async()=>{var i,o;try{await A.post(`/api/curriculum/curricula/${e.id}/${l}`),D.notify({type:"positive",message:`Curriculum ${a}d successfully`}),ve()}catch(t){D.notify({type:"negative",message:(null==(o=null==(i=t.response)?void 0:i.data)?void 0:o.message)||`Failed to ${a} curriculum`})}})})(e.row),size:"sm"},{default:U(()=>[x(t,null,{default:U(()=>[S($(1===e.row.active?"Deactivate":"Activate"),1)]),_:2},1024)]),_:2},1032,["color","icon","onClick"]),x(a,{flat:"",dense:"",color:"negative",icon:"delete",onClick:l=>(async e=>{D.dialog({title:"Confirm Deletion",message:`Are you sure you want to delete "${e.name}"? This action cannot be undone.`,cancel:!0,persistent:!0,color:"negative"}).onOk(async()=>{var l,a;try{await A.delete(`/api/curriculum/curricula/${e.id}`),D.notify({type:"positive",message:"Curriculum deleted successfully"}),ve()}catch(i){D.notify({type:"negative",message:(null==(a=null==(l=i.response)?void 0:l.data)?void 0:a.message)||"Failed to delete curriculum"})}})})(e.row),size:"sm"},{default:U(()=>[x(t,null,{default:U(()=>l[22]||(l[22]=[S("Delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])]),_:1})]),_:1}),x(d,{modelValue:ee.value,"onUpdate:modelValue":l[7]||(l[7]=e=>ee.value=e)},{default:U(()=>[x(s,{style:{"min-width":"500px"}},{default:U(()=>[x(i,null,{default:U(()=>l[23]||(l[23]=[k("div",{class:"text-h6"},"Filter Curricula",-1)])),_:1}),x(i,{class:"q-pt-none"},{default:U(()=>[k("div",E,[x(g,{modelValue:te.school_id,"onUpdate:modelValue":[l[2]||(l[2]=e=>te.school_id=e),pe],options:M.value,"option-value":"id","option-label":"name",label:"Select School",outlined:"",clearable:"",loading:R.value},null,8,["modelValue","options","loading"]),x(g,{modelValue:te.subject_id,"onUpdate:modelValue":l[3]||(l[3]=e=>te.subject_id=e),options:z.value,"option-value":"id","option-label":"name",label:"Select Subject",outlined:"",clearable:"",disable:!te.school_id,loading:J.value},null,8,["modelValue","options","disable","loading"]),x(g,{modelValue:te.grade_id,"onUpdate:modelValue":l[4]||(l[4]=e=>te.grade_id=e),options:L.value,"option-value":"id","option-label":"name",label:"Select Grade",outlined:"",clearable:"",disable:!te.school_id,loading:K.value},null,8,["modelValue","options","disable","loading"]),x(g,{modelValue:te.active,"onUpdate:modelValue":l[5]||(l[5]=e=>te.active=e),options:de,label:"Status",outlined:"",clearable:""},null,8,["modelValue"])])]),_:1}),x(n,{align:"right"},{default:U(()=>[x(a,{flat:"",label:"Clear",onClick:_e}),x(a,{flat:"",label:"Cancel",onClick:l[6]||(l[6]=e=>ee.value=!1)}),x(a,{color:"primary",label:"Apply",onClick:be,loading:H.value,unelevated:""},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),x(d,{modelValue:Z.value,"onUpdate:modelValue":l[14]||(l[14]=e=>Z.value=e),persistent:""},{default:U(()=>[x(s,{style:{"min-width":"500px"}},{default:U(()=>[x(i,null,{default:U(()=>[k("div",T,$(ie.value?"Edit Curriculum":"Add New Curriculum"),1)]),_:1}),x(i,{class:"q-pt-none"},{default:U(()=>[k("div",I,[x(g,{modelValue:ue.school_id,"onUpdate:modelValue":[l[8]||(l[8]=e=>ue.school_id=e),ge],options:M.value,"option-value":"id","option-label":"name",label:"School *",outlined:"",rules:[e=>!!e||"School is required"],loading:R.value,disable:ie.value},null,8,["modelValue","options","rules","loading","disable"]),x(g,{modelValue:ue.subject_id,"onUpdate:modelValue":l[9]||(l[9]=e=>ue.subject_id=e),options:B.value,"option-value":"id","option-label":"name",label:"Subject *",outlined:"",rules:[e=>!!e||"Subject is required"],disable:!ue.school_id||ie.value,loading:W.value},null,8,["modelValue","options","rules","disable","loading"]),x(g,{modelValue:ue.grade_id,"onUpdate:modelValue":l[10]||(l[10]=e=>ue.grade_id=e),options:O.value,"option-value":"id","option-label":"name",label:"Grade *",outlined:"",rules:[e=>!!e||"Grade is required"],disable:!ue.school_id||ie.value,loading:Y.value},null,8,["modelValue","options","rules","disable","loading"]),x(r,{modelValue:ue.name,"onUpdate:modelValue":l[11]||(l[11]=e=>ue.name=e),label:"Curriculum Name *",outlined:"",rules:[e=>!!e||"Name is required"]},null,8,["modelValue","rules"]),x(r,{modelValue:ue.description,"onUpdate:modelValue":l[12]||(l[12]=e=>ue.description=e),label:"Description",type:"textarea",rows:"3",outlined:""},null,8,["modelValue"]),x(c,{modelValue:ue.active,"onUpdate:modelValue":l[13]||(l[13]=e=>ue.active=e),label:"Set as Active (will deactivate other curricula for this subject and grade)",color:"primary"},null,8,["modelValue"])])]),_:1}),x(n,{align:"right"},{default:U(()=>[x(a,{flat:"",label:"Cancel",onClick:Ve}),x(a,{color:"primary",label:"Save",onClick:Ce,loading:X.value,unelevated:""},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),x(d,{modelValue:le.value,"onUpdate:modelValue":l[16]||(l[16]=e=>le.value=e),"full-width":"","full-height":""},{default:U(()=>[oe.value?(C(),q(b,{key:0,curriculum:oe.value,onClose:l[15]||(l[15]=e=>le.value=!1),onUpdated:ve},null,8,["curriculum"])):Q("",!0)]),_:1},8,["modelValue"]),x(d,{modelValue:ae.value,"onUpdate:modelValue":l[18]||(l[18]=e=>ae.value=e),"full-width":""},{default:U(()=>[x(s,null,{default:U(()=>[x(i,{class:"row items-center q-pb-none"},{default:U(()=>[l[24]||(l[24]=k("div",{class:"text-h6"},"Import/Export Curricula",-1)),x(f),x(a,{icon:"close",flat:"",round:"",dense:"",onClick:l[17]||(l[17]=e=>ae.value=!1)})]),_:1}),x(m),x(i,null,{default:U(()=>[x(_,{"export-data":re.value,"export-file-name":"curricula_template.xlsx",onImportedJson:ye,onExported:he},null,8,["export-data"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-6c71d093"]]);export{D as default};
