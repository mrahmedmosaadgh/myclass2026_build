import{Q as e}from"./QTab-D15tnj4c.js";import{Q as a}from"./QTabs-CSqR0VCn.js";import{r as l,u as t,Q as o,f as s,b as n,t as r,H as i,m as d,o as c,d as u,c as p,aS as m,e as v,h as f,g as y}from"./app-YpH5vqWh.js";import{Q as _}from"./QTabPanel-BAPJ1DQL.js";import{Q as g}from"./QSpace-DaC9STlt.js";import{Q as b}from"./QTabPanels-DBSQeA0j.js";import{Q as h}from"./QFile-CzgAInrb.js";import{a as x,Q as w}from"./QTable-CgaOzZjZ.js";import{Q as j}from"./QTr-BHzjgG2r.js";import{read as S,utils as k,writeFile as O}from"./xlsx-BHXqx-YI.js";import{f as N,a as E,k as I,I as V,J as A,K as T,b as C,O as J,R as P,W as D,N as Q,Q as q,F as U,V as F,y as R,a2 as L}from"./vendor-BWKGNkNB.js";const z={class:"q-mb-md row items-center justify-between"},G={class:"q-gutter-sm"},$={class:"q-ma-none text-caption"},H=l({__name:"ExcelImporter",props:{title:{type:String,default:"Import Excel Data"}},emits:["imported-json"],setup(e,{emit:a}){const l=t(),f=a,y=N(null),_=N([]),g=N([]),b=N({}),O=N(!1),L=N(""),H=N(!1),K=E(()=>_.value.length?Object.keys(_.value[0]).filter(e=>"__id"!==e).map(e=>({name:e,label:e.charAt(0).toUpperCase()+e.slice(1).replace(/_/g," "),field:e,align:"left",sortable:!0})):[]);I(O,e=>{g.value=e?[..._.value]:[]});const W=()=>{g.value=[..._.value]},Y=()=>{g.value=[]},B=()=>{const e=new Set(g.value.map(e=>e.__id));g.value=_.value.filter(a=>!e.has(a.__id))},M=()=>{if(!y.value)return;const e=new FileReader;e.onload=e=>{try{const a=new Uint8Array(e.target.result),t=S(a,{type:"array"}),o=t.SheetNames[0],s=t.Sheets[o],n=k.sheet_to_json(s);_.value=n.map((e,a)=>({...e,__id:a})),K.value.forEach(e=>{b.value[e.name]=!0}),l.notify({message:`Loaded ${_.value.length} rows from Excel`,color:"positive",position:"top"})}catch(a){l.notify({message:"Error reading Excel file: "+a.message,color:"negative",position:"top"}),ae()}},e.readAsArrayBuffer(y.value)},X=()=>{const e=g.value.map(e=>{const a={};return Object.keys(b.value).forEach(l=>{b.value[l]&&"__id"!==l&&(a[l]=e[l])}),a});L.value=JSON.stringify(e,null,2),H.value=!0},Z=async()=>{try{await navigator.clipboard.writeText(L.value),l.notify({message:"JSON copied to clipboard!",color:"positive",position:"top"})}catch(e){l.notify({message:"Failed to copy JSON",color:"negative",position:"top"})}},ee=()=>{const e=g.value.map(e=>{const a={};return Object.keys(b.value).forEach(l=>{b.value[l]&&"__id"!==l&&(a[l]=e[l])}),a});f("imported-json",e),H.value=!1,l.notify({message:`Successfully imported ${e.length} records`,color:"positive",position:"top"}),ae()},ae=()=>{y.value=null,_.value=[],g.value=[],b.value={},O.value=!1,L.value=""};return(e,a)=>(A(),V(u,{class:"bg-white shadow-md rounded-lg"},{default:T(()=>[C(s,null,{default:T(()=>[C(h,{modelValue:y.value,"onUpdate:modelValue":[a[0]||(a[0]=e=>y.value=e),M],label:"Upload Excel File",accept:".xlsx, .xls",outlined:"",dense:""},{prepend:T(()=>[C(o,{name:"attach_file"})]),_:1},8,["modelValue"])]),_:1}),_.value.length?(A(),V(s,{key:0},{default:T(()=>[P("div",z,[a[7]||(a[7]=P("div",null,[P("h6",{class:"q-my-none"},"Preview Data"),P("p",{class:"text-caption text-grey-6"},"Select rows and columns to import")],-1)),P("div",G,[C(i,{outline:""},{default:T(()=>[C(n,{outline:"",color:"primary",label:"Select All",icon:"check_box",onClick:W,size:"sm"},{default:T(()=>[C(r,null,{default:T(()=>a[4]||(a[4]=[D("Select all rows")])),_:1})]),_:1}),C(n,{outline:"",color:"primary",label:"Deselect All",icon:"check_box_outline_blank",onClick:Y,size:"sm"},{default:T(()=>[C(r,null,{default:T(()=>a[5]||(a[5]=[D("Deselect all rows")])),_:1})]),_:1}),C(n,{outline:"",color:"primary",label:"Inverse",icon:"swap_vert",onClick:B,size:"sm"},{default:T(()=>[C(r,null,{default:T(()=>a[6]||(a[6]=[D("Invert current selection")])),_:1})]),_:1})]),_:1})])]),C(w,{rows:_.value,columns:K.value,"row-key":"__id",selection:"multiple",selected:g.value,"onUpdate:selected":a[2]||(a[2]=e=>g.value=e),pagination:{rowsPerPage:10},dense:"",class:"text-sm"},{"header-selection":T(()=>[C(d,{modelValue:O.value,"onUpdate:modelValue":a[1]||(a[1]=e=>O.value=e),color:"primary"},null,8,["modelValue"])]),header:T(e=>[C(j,{props:e},{default:T(()=>[C(x,{"auto-width":""}),(A(!0),Q(U,null,q(e.cols,a=>(A(),V(x,{key:a.name,props:e},{default:T(()=>[C(d,{modelValue:b.value[a.name],"onUpdate:modelValue":e=>b.value[a.name]=e,color:"primary",dense:"",label:a.label},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),_:1},8,["rows","columns","selected"])]),_:1})):J("",!0),_.value.length?(A(),V(c,{key:1,align:"right"},{default:T(()=>[C(n,{label:"Cancel",flat:"",onClick:ae}),C(n,{label:"Import Selected as JSON",color:"primary",unelevated:"",disable:0===g.value.length,onClick:X},null,8,["disable"])]),_:1})):J("",!0),C(v,{modelValue:H.value,"onUpdate:modelValue":a[3]||(a[3]=e=>H.value=e)},{default:T(()=>[C(u,{style:{"min-width":"600px"}},{default:T(()=>[C(s,null,{default:T(()=>a[8]||(a[8]=[P("div",{class:"text-h6"},"Imported JSON Preview",-1)])),_:1}),C(p),C(s,{class:"bg-grey-1",style:{"max-height":"400px","overflow-y":"auto"}},{default:T(()=>[P("pre",$,F(L.value),1)]),_:1}),C(p),C(c,{align:"right"},{default:T(()=>[R(C(n,{label:"Close",flat:""},null,512),[[m]]),C(n,{label:"Copy JSON",color:"primary",onClick:Z,unelevated:""}),C(n,{label:"Confirm Import",color:"positive",onClick:ee,unelevated:""})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},[["__scopeId","data-v-51432a8a"]]),K={class:"row items-center q-gutter-md"},W={class:"col"},Y={class:"col-auto"},B={class:"q-mb-md"},M={class:"text-caption text-grey-6"},X=l({__name:"ExcelExporter",props:{jsonData:{type:Array,default:()=>[]},defaultFileName:{type:String,default:"template.xlsx"}},emits:["exported"],setup(e,{emit:a}){const l=t(),r=e,i=a,d=N(r.defaultFileName),c=E(()=>{if(!r.jsonData.length)return[];const e=r.jsonData.map((e,a)=>({...e,__id:a}));return Object.keys(e[0]).filter(e=>"__id"!==e).map(e=>({name:e,label:e.charAt(0).toUpperCase()+e.slice(1).replace(/_/g," "),field:e,align:"left"}))});I(()=>r.defaultFileName,e=>{d.value=e});const p=()=>{if(r.jsonData.length)try{const e=k.json_to_sheet(r.jsonData),a=Object.keys(r.jsonData[0]).map(()=>20);e["!cols"]=a.map(e=>({wch:e}));const t=k.book_new();k.book_append_sheet(t,e,"Template"),O(t,d.value),l.notify({message:"Template downloaded successfully!",color:"positive",position:"top"}),i("exported",{fileName:d.value,recordCount:r.jsonData.length})}catch(e){l.notify({message:"Error exporting to Excel: "+e.message,color:"negative",position:"top"})}else l.notify({message:"No data to export",color:"warning",position:"top"})};return(a,l)=>(A(),V(u,{class:"bg-white shadow-md rounded-lg"},{default:T(()=>[C(s,null,{default:T(()=>[P("div",K,[P("div",W,[C(f,{modelValue:d.value,"onUpdate:modelValue":l[0]||(l[0]=e=>d.value=e),label:"Template File Name",outlined:"",dense:"",placeholder:"e.g., curriculum_template.xlsx",onKeyup:L(p,["enter"])},null,8,["modelValue"])]),P("div",Y,[C(n,{label:"Download Excel Template",color:"primary",icon:"download",unelevated:"",disable:!e.jsonData.length,onClick:p},null,8,["disable"])])])]),_:1}),e.jsonData.length?(A(),V(s,{key:0},{default:T(()=>[P("div",B,[l[1]||(l[1]=P("h6",{class:"q-my-none"},"Template Preview",-1)),P("p",M,F(e.jsonData.length)+" sample records",1)]),C(w,{rows:e.jsonData,columns:c.value,"row-key":"__id",pagination:{rowsPerPage:5},dense:"",class:"text-sm"},null,8,["rows","columns"])]),_:1})):(A(),V(s,{key:1,class:"text-center text-grey-6 q-py-lg"},{default:T(()=>[C(o,{name:"info",size:"lg",class:"q-mb-md"}),l[2]||(l[2]=P("p",null,"No data provided. Pass JSON data as a prop to generate a template.",-1))]),_:1}))]),_:1}))}},[["__scopeId","data-v-3de8a46d"]]),Z={class:"q-pa-md"},ee={class:"row items-center q-mb-md"},ae={class:"row justify-end q-mt-md"},le=l({__name:"ExcelManager",props:{exportData:{type:Array,default:()=>[]},exportFileName:{type:String,default:"export.xlsx"},initialTab:{type:String,default:"import"}},emits:["imported-json","exported"],setup(l,{emit:s}){const r=t(),i=s,d=N(l.initialTab),c=N(""),m=e=>{i("imported-json",e)},v=e=>{i("exported",e)},h=async()=>{try{await navigator.clipboard.writeText('Please generate a JSON array of curriculum topics and lessons based on the following list.\nOutput ONLY the raw JSON array. Do not include any markdown formatting like ```json or any other text.\n\nRequired Fields for each object:\n- topic_number: Topic number (e.g. "1")\n- topic_title: Title of the topic\n- topic_description: Optional description\n- lesson_number: Lesson number (e.g. "1.1")\n- lesson_title: Title of the lesson\n- lesson_description: Optional description\n- lesson_content: Optional content/details\n- lesson_type: One of [main, revision, quiz, project, extra]\n- page_number: Numeric page number\n- standard, strand, skill, activities, assignment, assessment, objective: Optional fields\n\nLIST TO CONVERT:\n[PASTE YOUR LIST HERE]'),r.notify({color:"positive",message:"AI Prompt copied to clipboard!",icon:"content_copy"})}catch(e){r.notify({color:"negative",message:"Failed to copy prompt",icon:"error"})}},x=()=>{try{let e=c.value.trim();e.startsWith("```")&&(e=e.replace(/^```(json)?\n?/,"").replace(/\n?```$/,""));const a=JSON.parse(e);if(!Array.isArray(a))throw new Error("Data must be a JSON array");if(0===a.length)throw new Error("Empty JSON array");i("imported-json",a),c.value="",r.notify({color:"positive",message:`Successfully processed ${a.length} records from AI JSON`,icon:"check"})}catch(e){r.notify({color:"negative",message:"Invalid JSON format: "+e.message,icon:"error"})}};return(t,s)=>(A(),V(u,{class:"bg-white shadow-md rounded-lg"},{default:T(()=>[C(a,{modelValue:d.value,"onUpdate:modelValue":s[0]||(s[0]=e=>d.value=e),dense:"",class:"text-primary","active-color":"primary","indicator-color":"primary",align:"left"},{default:T(()=>[C(e,{name:"import",label:"Import from Excel",icon:"upload"}),C(e,{name:"ai",label:"AI Assistant",icon:"psychology"}),C(e,{name:"export",label:"Export to Excel",icon:"download"})]),_:1},8,["modelValue"]),C(p),C(b,{modelValue:d.value,"onUpdate:modelValue":s[2]||(s[2]=e=>d.value=e),animated:""},{default:T(()=>[C(_,{name:"import"},{default:T(()=>[C(H,{onImportedJson:m})]),_:1}),C(_,{name:"ai"},{default:T(()=>[P("div",Z,[P("div",ee,[s[3]||(s[3]=P("div",null,[P("div",{class:"text-h6"},"AI JSON Helper"),P("div",{class:"text-caption text-grey-7"},"Generate JSON using AI and paste it here")],-1)),C(g),C(n,{color:"primary",icon:"content_copy",label:"Copy AI Prompt",onClick:h,unelevated:""})]),C(y,{class:"bg-blue-1 text-blue-9 q-mb-lg rounded-borders"},{avatar:T(()=>[C(o,{name:"info",color:"blue-9"})]),default:T(()=>[s[4]||(s[4]=D(' 1. Click "Copy AI Prompt" and paste it into an AI (ChatGPT/Claude).')),s[5]||(s[5]=P("br",null,null,-1)),s[6]||(s[6]=D(" 2. Provide your lessons list to the AI.")),s[7]||(s[7]=P("br",null,null,-1)),s[8]||(s[8]=D(' 3. Paste the generated JSON below and click "Process". '))]),_:1}),C(f,{modelValue:c.value,"onUpdate:modelValue":s[1]||(s[1]=e=>c.value=e),type:"textarea",label:"Paste AI Generated JSON",outlined:"",rows:"12",placeholder:'[\n  {\n    "topic_number": "1",\n    "topic_title": "Example Topic",\n    "lesson_number": "1.1",\n    "lesson_title": "Example Lesson",\n    "lesson_type": "main"\n  }\n]',class:"bg-grey-1"},null,8,["modelValue"]),P("div",ae,[C(n,{color:"positive",icon:"check_circle",label:"Process & Import JSON",onClick:x,disable:!c.value.trim(),unelevated:""},null,8,["disable"])])])]),_:1}),C(_,{name:"export"},{default:T(()=>[C(X,{"json-data":l.exportData,"default-file-name":l.exportFileName,onExported:v},null,8,["json-data","default-file-name"])]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},[["__scopeId","data-v-0a4e4a8d"]]);export{le as E};
