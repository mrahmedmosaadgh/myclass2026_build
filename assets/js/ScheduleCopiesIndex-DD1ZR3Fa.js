import{o as e,u as a,d as l,p as s,Q as o,m as t,c as i,l as c,b as r,aP as n}from"./app-C-NJhdpe.js";import{Q as u}from"./QSpinnerDots-BFT-tKRa.js";import{f as d,a as m,o as p,ae as v,L as y,I as g,b as h,M as f,y as b,H as j,V as w,U as _,J as S,F as Q,Q as V,x as k,Z as C}from"./vendor-CUZ9QTQV.js";import x from"./ScheduleCopyCard-18CZQvkD.js";import q from"./ScheduleCopyForm-D8_flVY9.js";import T from"./ScheduleCopyFilters-CuvMiWgu.js";import E from"./ScheduleSyncDialog-CXG1wdC4.js";import F from"./CSTOverviewDialog-BQtrWbcv.js";import D from"./WeeklyPlanMenu-D0zERVbo.js";import{u as P}from"./i18n-CP46N9fu.js";import"./offline-BzIlwqNM.js";import"./ui-LrZmvB2D.js";import"./StatusBadge-D0X3NRwy.js";import"./QSpace-Bn7M2Abx.js";import"./QSelect-B3f0Rrq3.js";import"./rtl-Cr6c3OOr.js";import"./QForm-CqbXDoyt.js";import"./schoolData-BQSkQPXz.js";import"./QTd-D3bw3I77.js";import"./QTable-D-FHlyjj.js";import"./QMarkupTable-CDVIpyWz.js";import"./QLinearProgress-DLQRR2k-.js";import"./use-fullscreen-iiJPvjW2.js";import"./QBadge-D_SrvMy0.js";import"./date-V1XMGVxS.js";import"./QTab-C_vkYR0k.js";import"./QTabs-C8Sz98qV.js";import"./WeeklySystemGuide-C11T3DR0.js";import"./QTabPanel-zhJc0Joi.js";import"./use-panel-CGzbevm7.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-bY91sdlT.js";import"./MainSchoolData-i5zT_CXg.js";import"./SchoolSettingsDialog-D3tRhtrL.js";const U={class:"q-pa-md"},M={class:"row items-center q-mb-lg"},z={class:"col"},B={class:"q-ma-none text-weight-bold"},O={class:"text-grey-7 q-mb-none"},$={class:"col-auto"},H={key:0,class:"row justify-center q-pa-xl"},I={class:"text-h6 text-grey-7 q-mt-md"},J={class:"text-grey-6"},L={key:2,class:"row q-gutter-md"},R={class:"text-h6"},A=e({__name:"ScheduleCopiesIndex",setup(e){const{t:A}=P(),K=a(),W=d([]),G=d([]),N=d([]),Z=d([]),X=d(!1),Y=d(!1),ee=d(!1),ae=d(!1),le=d(!1),se=d(!1),oe=d(!1),te=d(!1),ie=d(!1),ce=d(!1),re=d(null),ne=d(null),ue=d(null),de=d({school_id:null,academic_year_id:null,semester_id:null,status:null}),me=m(()=>{let e=[...W.value];return de.value.school_id&&(e=e.filter(e=>e.school_id===de.value.school_id)),de.value.academic_year_id&&(e=e.filter(e=>e.academic_year_id===de.value.academic_year_id)),de.value.semester_id&&(e=e.filter(e=>e.semester_id===de.value.semester_id)),de.value.status&&(e=e.filter(e=>e.status===de.value.status)),e}),pe=async()=>{X.value=!0;try{const e=await C.get("/admin/schedule-copies");W.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching schedule copies:",e),K.notify({type:"negative",message:A("common.errors.fetchFailed")})}finally{X.value=!1}},ve=async()=>{Y.value=!0;try{const e=await C.get("/api/schools");G.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching schools:",e)}finally{Y.value=!1}},ye=async()=>{ee.value=!0;try{const e=await C.get("/api/academic-years");N.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching academic years:",e)}finally{ee.value=!1}},ge=async()=>{ae.value=!0;try{const e=await C.get("/api/semesters");Z.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching semesters:",e)}finally{ae.value=!1}},he=()=>{re.value=null,oe.value=!0},fe=e=>{re.value={...e},oe.value=!0},be=async e=>{le.value=!0;try{if(e.isEdit)await C.put(`/admin/schedule-copies/${re.value.id}`,e),K.notify({type:"positive",message:A("common.updatedSuccessfully")});else{const a=await C.post("/admin/schedule-copies",e);e.auto_generate&&a.data.id?(await C.post("/admin/schedule-copies/create-entries",{schedule_copy_id:a.data.id}),K.notify({type:"positive",message:"Schedule copy created with schedule slots"})):K.notify({type:"positive",message:A("common.createdSuccessfully")})}oe.value=!1,await pe()}catch(a){console.error("Error saving schedule copy:",a),K.notify({type:"negative",message:A("common.errors.submitFailed")})}finally{le.value=!1}},je=async e=>{try{await C.put(`/admin/schedule-copies/${e.id}`,{status:"active"}),K.notify({type:"positive",message:A("common.activatedSuccessfully")}),await pe()}catch(a){console.error("Error activating:",a),K.notify({type:"negative",message:A("common.errors.activateFailed")})}},we=async e=>{try{await C.put(`/admin/schedule-copies/${e.id}`,{status:"archived"}),K.notify({type:"info",message:A("common.archivedSuccessfully")}),await pe()}catch(a){console.error("Error archiving:",a),K.notify({type:"negative",message:A("common.errors.archiveFailed")})}},_e=e=>{ne.value=e,te.value=!0},Se=async()=>{se.value=!0;try{await C.delete(`/admin/schedule-copies/${ne.value.id}`),K.notify({type:"positive",message:A("common.deletedSuccessfully")}),te.value=!1,await pe()}catch(e){console.error("Error deleting:",e),K.notify({type:"negative",message:A("common.errors.deleteFailed")})}finally{se.value=!1}},Qe=()=>{},Ve=e=>{ue.value=e,ie.value=!0},ke=()=>{K.notify({type:"positive",message:"Schedule synchronization updated",position:"top"})};return p(async()=>{await Promise.all([pe(),ve(),ye(),ge()])}),(e,a)=>{var d,m;const p=v("Head");return g(),y(Q,null,[h(p,{title:b(A)("weeklySystem.scheduleCopies.title")},null,8,["title"]),f("div",U,[h(D),f("div",M,[f("div",z,[f("h4",B,[h(l,{name:"content_copy",class:"q-mr-sm",color:"primary"}),w(" "+_(b(A)("weeklySystem.scheduleCopies.title")),1)]),f("p",O,_(b(A)("weeklySystem.scheduleCopies.subtitle")),1)]),f("div",$,[h(o,{color:"teal",icon:"preview",label:"CST Overview",outline:"",onClick:a[0]||(a[0]=e=>ce.value=!0),class:"q-mr-sm"},{default:S(()=>[h(s,null,{default:S(()=>a[6]||(a[6]=[w("View subject-teacher assignments overview")])),_:1})]),_:1}),h(o,{color:"primary",icon:"add",label:b(A)("common.create"),onClick:he},null,8,["label"])])]),h(T,{modelValue:de.value,"onUpdate:modelValue":a[1]||(a[1]=e=>de.value=e),schools:G.value,"academic-years":N.value,semesters:Z.value,"loading-schools":Y.value,"loading-years":ee.value,"loading-semesters":ae.value,onFilter:Qe,class:"q-mb-lg"},null,8,["modelValue","schools","academic-years","semesters","loading-schools","loading-years","loading-semesters"]),X.value?(g(),y("div",H,[h(u,{size:"50px",color:"primary"})])):me.value.length?(g(),y("div",L,[(g(!0),y(Q,null,V(me.value,e=>(g(),y("div",{key:e.id,class:"col-12 col-sm-6 col-md-4 col-lg-3"},[h(x,{copy:e,onEdit:fe,onActivate:je,onArchive:we,onDelete:_e,onSync:Ve},null,8,["copy"])]))),128))])):(g(),j(t,{key:1,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:S(()=>[h(l,{name:"folder_open",size:"64px",color:"grey-5"}),f("p",I,_(b(A)("weeklySystem.schoolBrowser.noDataTitle")),1),f("p",J,_(b(A)("common.noResults")),1),h(o,{color:"primary",icon:"add",label:b(A)("common.create"),onClick:he,class:"q-mt-md"},null,8,["label"])]),_:1})),h(q,{modelValue:oe.value,"onUpdate:modelValue":a[2]||(a[2]=e=>oe.value=e),"edit-data":re.value,schools:G.value,"academic-years":N.value,semesters:Z.value,"loading-schools":Y.value,"loading-years":ee.value,"loading-semesters":ae.value,saving:le.value,onSubmit:be},null,8,["modelValue","edit-data","schools","academic-years","semesters","loading-schools","loading-years","loading-semesters","saving"]),h(r,{modelValue:te.value,"onUpdate:modelValue":a[3]||(a[3]=e=>te.value=e)},{default:S(()=>[h(t,{style:{"min-width":"350px"}},{default:S(()=>[h(i,{class:"row items-center"},{default:S(()=>[h(l,{name:"warning",color:"negative",size:"md",class:"q-mr-sm"}),f("span",R,_(b(A)("common.delete"))+" "+_(b(A)("weeklySystem.scheduleCopies.title")),1)]),_:1}),h(i,null,{default:S(()=>{var e;return[w(_(b(A)("common.confirmDelete"))+' "',1),f("strong",null,_(null==(e=ne.value)?void 0:e.name),1),w('"? '+_(b(A)("common.actionCannotBeUndone")),1)]}),_:1}),h(c,{align:"right"},{default:S(()=>[k(h(o,{flat:"",label:b(A)("common.cancel")},null,8,["label"]),[[n]]),h(o,{flat:"",label:b(A)("common.delete"),color:"negative",loading:se.value,onClick:Se},null,8,["label","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),h(E,{modelValue:ie.value,"onUpdate:modelValue":a[4]||(a[4]=e=>ie.value=e),"copy-id":null==(d=ue.value)?void 0:d.id,"copy-name":null==(m=ue.value)?void 0:m.name,onSynced:ke},null,8,["modelValue","copy-id","copy-name"]),h(F,{modelValue:ce.value,"onUpdate:modelValue":a[5]||(a[5]=e=>ce.value=e)},null,8,["modelValue"])])],64)}}},[["__scopeId","data-v-9338a7c2"]]);export{A as default};
