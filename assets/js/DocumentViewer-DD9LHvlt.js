import{o as e,u as l,c as n,d as t,aF as o,Q as a,g as c,j as i,h as r,i as s,m as d,b as u}from"./app-DOc39CFu.js";import{Q as m}from"./QSpace-DuS_4lXE.js";import{Q as v}from"./QSpinnerDots-2or4BCK2.js";import{Q as p}from"./QDrawer-Ci4YbwG7.js";import{f as y,a as g,k as h,_ as f,I as k,J as b,K as w,b as x,Q as L,N as M,V as T,W as H,M as _,F as $,R as q,U as C}from"./vendor-DuKqz2x4.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";const V={class:"col"},j={class:"row items-center"},z={class:"text-h5 text-weight-bold"},Q={class:"text-subtitle2 text-grey-7"},E={key:0},F={class:"col-auto"},I={key:0,class:"text-center q-py-xl"},S={key:1,class:"text-center q-py-xl"},A={class:"text-body2 text-grey-7 q-mt-sm"},R={key:2,class:"content-display"},D={key:0,class:"rendered-content"},U=["innerHTML"],B={key:1,class:"database-content"},J={key:0,class:"rich-content"},N=["innerHTML"],O=["innerHTML"],K=["innerHTML"],P=["innerHTML"],W={key:4,class:"code-block"},G=["innerHTML"],X={key:5},Y=["innerHTML"],Z=["innerHTML"],ee=["innerHTML"],le={key:1,class:"source-content"},ne={class:"source-code"},te=e({__name:"DocumentViewer",props:{modelValue:Boolean,document:Object},emits:["update:modelValue","close"],setup(e,{emit:te}){const oe=l(),ae=e,ce=y(!1),ie=y(null),re=y("rendered"),se=y(!1),de=y(""),ue=y(""),me=y([]),ve=g(()=>{var e,l;return"file"===(null==(e=ae.document)?void 0:e.source)?de.value:(null==(l=ae.document)?void 0:l.content)?"string"==typeof ae.document.content?ae.document.content:JSON.stringify(ae.document.content,null,2):""});h(()=>ae.document,e=>{e&&ae.modelValue&&pe()},{immediate:!0}),h(()=>ae.modelValue,e=>{e&&ae.document&&pe()});const pe=async()=>{var e,l;if(ae.document){ce.value=!0,ie.value=null;try{if("file"===ae.document.source){const e=await f.get("/admin/documentation-portal/file-content",{params:{path:ae.document.path}});de.value=e.data.content,ue.value=await ye(e.data.content),ge(e.data.content)}else de.value=ve.value,Array.isArray(ae.document.content)&&he(ae.document.content)}catch(n){ie.value=(null==(l=null==(e=n.response)?void 0:e.data)?void 0:l.error)||"Failed to load content"}finally{ce.value=!1}}},ye=async e=>e.replace(/^# (.+)$/gm,"<h1>$1</h1>").replace(/^## (.+)$/gm,"<h2>$1</h2>").replace(/^### (.+)$/gm,"<h3>$1</h3>").replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/`(.+?)`/g,"<code>$1</code>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>").replace(/\n/g,"<br>"),ge=e=>{const l=e.match(/^#{1,6}\s+.+$/gm)||[];me.value=l.map((e,l)=>({id:`heading-${l}`,level:e.match(/^#+/)[0].length,text:e.replace(/^#+\s+/,"")}))},he=e=>{me.value=e.filter(e=>["heading1","heading2","heading3"].includes(e.type)).map((e,l)=>({id:`heading-${l}`,level:parseInt(e.type.replace("heading","")),text:e.content.replace(/<[^>]*>/g,"")}))},fe=()=>{var e,l;return{code:"code",tutorial:"school",guide:"map",api:"api",reference:"book",note:"note",research:"science",question:"help",comment:"comment",idea:"lightbulb"}[null==(l=null==(e=ae.document)?void 0:e.type)?void 0:l.toLowerCase()]||"description"},ke=()=>{var e,l;return{code:"green",tutorial:"blue",guide:"purple",api:"red",reference:"indigo",note:"yellow",research:"teal",question:"pink",comment:"cyan",idea:"amber"}[null==(l=null==(e=ae.document)?void 0:e.type)?void 0:l.toLowerCase()]||"primary"},be=()=>{window.print()},we=()=>{oe.notify({type:"info",message:"Export functionality coming soon",position:"top"})},xe=()=>{var e;"database"===(null==(e=ae.document)?void 0:e.source)&&window.open(`/admin/documentation/${ae.document.id}/edit`,"_blank")},Le=()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()};return(l,y)=>(b(),k(u,{"model-value":e.modelValue,"onUpdate:modelValue":y[5]||(y[5]=e=>l.$emit("update:modelValue",e)),maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:w(()=>[x(d,{class:"document-viewer"},{default:w(()=>[x(n,{class:"viewer-header row items-center"},{default:w(()=>{var n,c,i,r;return[M("div",V,[M("div",j,[x(t,{name:fe(),color:ke(),size:"2rem",class:"q-mr-md"},null,8,["name","color"]),M("div",null,[M("div",z,T(null==(n=e.document)?void 0:n.title),1),M("div",Q,[H(T(null==(c=e.document)?void 0:c.category)+" • "+T(null==(i=e.document)?void 0:i.source)+" ",1),(null==(r=e.document)?void 0:r.author)?(b(),_("span",E," • by "+T(e.document.author.name),1)):L("",!0)])])])]),M("div",F,[x(o,{outline:""},{default:w(()=>[x(a,{color:"rendered"===re.value?"primary":"grey",icon:"visibility",label:"Rendered",onClick:y[0]||(y[0]=e=>re.value="rendered"),disable:ce.value},null,8,["color","disable"]),x(a,{color:"source"===re.value?"primary":"grey",icon:"code",label:"Source",onClick:y[1]||(y[1]=e=>re.value="source"),disable:ce.value},null,8,["color","disable"])]),_:1}),x(a,{flat:"",round:"",icon:"close",onClick:y[2]||(y[2]=e=>l.$emit("close")),class:"q-ml-md"})])]}),_:1}),x(n,{class:"viewer-toolbar row items-center q-py-sm"},{default:w(()=>{var l;return[x(a,{flat:"",icon:"print",label:"Print",onClick:be,size:"sm",class:"q-mr-sm"}),x(a,{flat:"",icon:"download",label:"Export",onClick:we,size:"sm",class:"q-mr-sm"}),"database"===(null==(l=e.document)?void 0:l.source)?(b(),k(a,{key:0,flat:"",icon:"edit",label:"Edit",onClick:xe,size:"sm",class:"q-mr-sm"})):L("",!0),x(m),x(a,{flat:"",icon:"fullscreen",onClick:Le,size:"sm"})]}),_:1}),x(n,{class:"viewer-content"},{default:w(()=>{var l,n,o;return[ce.value?(b(),_("div",I,[x(v,{size:"3rem",color:"primary"}),y[6]||(y[6]=M("div",{class:"text-subtitle1 q-mt-md"},"Loading content...",-1))])):ie.value?(b(),_("div",S,[x(t,{name:"error",size:"3rem",color:"negative"}),y[7]||(y[7]=M("div",{class:"text-h6 text-negative q-mt-md"},"Error loading content",-1)),M("div",A,T(ie.value),1),x(a,{color:"primary",icon:"refresh",label:"Retry",onClick:pe,class:"q-mt-md"})])):(b(),_("div",R,["rendered"===re.value?(b(),_("div",D,["file"===(null==(l=e.document)?void 0:l.source)?(b(),_("div",{key:0,class:"markdown-content",innerHTML:ue.value},null,8,U)):(b(),_("div",B,[Array.isArray(null==(n=e.document)?void 0:n.content)?(b(),_("div",J,[(b(!0),_($,null,q(e.document.content,(e,l)=>(b(),_("div",{key:l,class:"content-block q-mb-md"},["paragraph"===e.type?(b(),_("div",{key:0,innerHTML:e.content},null,8,N)):"heading1"===e.type?(b(),_("h1",{key:1,innerHTML:e.content},null,8,O)):"heading2"===e.type?(b(),_("h2",{key:2,innerHTML:e.content},null,8,K)):"heading3"===e.type?(b(),_("h3",{key:3,innerHTML:e.content},null,8,P)):"code"===e.type?(b(),_("pre",W,[M("code",{innerHTML:e.content},null,8,G)])):"list"===e.type?(b(),_("ul",X,[(b(!0),_($,null,q(e.items,(e,l)=>(b(),_("li",{key:l,innerHTML:e},null,8,Y))),128))])):(b(),_("div",{key:6,innerHTML:e.content},null,8,Z))]))),128))])):(b(),_("div",{key:1,class:"simple-content",innerHTML:null==(o=e.document)?void 0:o.content},null,8,ee))]))])):(b(),_("div",le,[M("pre",ne,[M("code",null,T(ve.value),1)])]))]))]}),_:1}),me.value.length>0?(b(),k(p,{key:0,modelValue:se.value,"onUpdate:modelValue":y[3]||(y[3]=e=>se.value=e),side:"right",overlay:"",bordered:"",width:300,class:"toc-drawer"},{default:w(()=>[x(c,null,{default:w(()=>[x(i,{header:""},{default:w(()=>y[8]||(y[8]=[H("Table of Contents")])),_:1}),(b(!0),_($,null,q(me.value,(e,l)=>(b(),k(r,{key:l,clickable:"",onClick:l=>(e=>{const l=document.getElementById(e);l&&l.scrollIntoView({behavior:"smooth"})})(e.id),class:C(`toc-level-${e.level}`)},{default:w(()=>[x(s,null,{default:w(()=>[x(i,null,{default:w(()=>[H(T(e.text),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick","class"]))),128))]),_:1})]),_:1},8,["modelValue"])):L("",!0),me.value.length>0?(b(),k(a,{key:1,fab:"",icon:"list",color:"primary",onClick:y[4]||(y[4]=e=>se.value=!se.value),class:"toc-toggle"})):L("",!0)]),_:1})]),_:1},8,["model-value"]))}},[["__scopeId","data-v-ec111f36"]]);export{te as default};
