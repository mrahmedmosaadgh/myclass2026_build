import{u as e,f as a,Q as l,c as s,o as t,b as o,d as i,e as n}from"./app-DTyzyps1.js";import{Q as d}from"./QSelect-D0qwdF6_.js";import{Q as u}from"./QForm-YUIalQzX.js";import{Q as m}from"./QBadge-CkKjK8Tj.js";import{a3 as r,f as c,k as p,a as v,_ as g,I as y,J as f,K as h,b as x,O as q,z as _,Q as w,V as b}from"./vendor-BJyC5yAd.js";import{u as S}from"./schoolData-CwP-3rwv.js";import"./offline-BzIlwqNM.js";import"./i18n-BDgsCcB6.js";import"./ui-DFn3cvMd.js";import"./rtl-Cr6c3OOr.js";const V={class:"row q-col-gutter-md"},j={class:"col-12"},k={class:"row q-col-gutter-md q-mt-none"},z={class:"col-12 col-md-4"},I={class:"col-12 col-md-4"},Q={class:"row justify-center q-gutter-md"},C={class:"text-weight-medium"},U={class:"text-weight-medium"},F={class:"text-weight-medium"},Y={__name:"SchoolSettingsDialog",props:{modelValue:{type:Boolean,default:!1},schoolId:{type:Number,required:!1,default:null}},emits:["update:modelValue","saved","cancel"],setup(Y,{emit:A}){const B=e(),D=S(),{schools:J}=r(D),K=Y,N=A,O=c(!1),P=c(null),R=c(null),$=c(null),E=c([]),G=c([]);p(()=>K.modelValue,e=>{O.value=e,e&&(K.schoolId&&(P.value=K.schoolId),T())}),p(O,e=>{N("update:modelValue",e)}),p(P,async e=>{e&&O.value&&await T()});const H=v(()=>P.value&&R.value&&$.value),L=e=>{const a=J.value.find(a=>a.id===e);return a?a.name:"Unknown School"},M=async e=>{e&&await D.setSchool(e)},T=async()=>{var e,a;try{if(E.value=D.academicYears,G.value=D.semesters,0===E.value.length){const e=await g.get("/api/academic-years");E.value=e.data.data||e.data}if(0===G.value.length){const e=await g.get("/api/semesters");G.value=e.data.data||e.data}P.value&&await W()}catch(l){B.notify({type:"negative",message:"Failed to load options",caption:(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||l.message})}},W=async()=>{var e,a;try{D.academicYearId&&(R.value=E.value.find(e=>e.id===D.academicYearId)||null),D.semesterId&&($.value=G.value.find(e=>e.id===D.semesterId)||null)}catch(l){B.notify({type:"negative",message:"Failed to load current settings",caption:(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||l.message})}},X=async()=>{var e,a,l,s;if(H.value)try{await D.updateSchoolSettings({academic_year_id:(null==(e=R.value)?void 0:e.id)||null,semester_id:(null==(a=$.value)?void 0:a.id)||null}),B.notify({type:"positive",message:"School settings saved successfully"}),N("saved"),O.value=!1}catch(t){B.notify({type:"negative",message:"Failed to save settings",caption:(null==(s=null==(l=t.response)?void 0:l.data)?void 0:s.message)||t.message})}else B.notify({type:"warning",message:"Please fill in all required fields",caption:"All fields marked with * are required"})};return(e,r)=>(f(),y(n,{modelValue:O.value,"onUpdate:modelValue":r[4]||(r[4]=e=>O.value=e),persistent:"",maximized:""},{default:h(()=>[x(i,{style:{"max-width":"800px",margin:"auto"},class:"q-pa-lg"},{default:h(()=>[x(a,{class:"text-center"},{default:h(()=>r[5]||(r[5]=[q("div",{class:"text-h5 text-primary q-mb-sm"},"School Configuration",-1),q("div",{class:"text-subtitle1 text-grey"},"Set up school context for the weekly planning system",-1)])),_:1}),x(a,null,{default:h(()=>[x(u,{class:"q-gutter-y-md"},{default:h(()=>[q("div",V,[q("div",j,[x(d,{modelValue:P.value,"onUpdate:modelValue":[r[0]||(r[0]=e=>P.value=e),M],options:_(D).schools,"option-value":"id","option-label":"name",label:"Select School *",outlined:"",dense:"","emit-value":"","map-options":"",loading:_(D).loading,rules:[e=>!!e||"School selection is required"],class:"full-width"},{prepend:h(()=>[x(l,{name:"school",color:"primary"})]),_:1},8,["modelValue","options","loading","rules"])])]),q("div",k,[q("div",z,[x(d,{modelValue:R.value,"onUpdate:modelValue":r[1]||(r[1]=e=>R.value=e),options:E.value,"option-value":"id","option-label":"name",label:"Academic Year *",outlined:"",dense:"","map-options":"",rules:[e=>!!e||"Academic year is required"]},{prepend:h(()=>[x(l,{name:"calendar_month",color:"blue"})]),_:1},8,["modelValue","options","rules"])]),q("div",I,[x(d,{modelValue:$.value,"onUpdate:modelValue":r[2]||(r[2]=e=>$.value=e),options:G.value,"option-value":"id","option-label":"name",label:"Semester *",outlined:"",dense:"","map-options":"",rules:[e=>!!e||"Semester is required"]},{prepend:h(()=>[x(l,{name:"event",color:"indigo"})]),_:1},8,["modelValue","options","rules"])])])]),_:1})]),_:1}),x(s,{class:"q-my-md"}),x(a,{class:"text-center"},{default:h(()=>[r[6]||(r[6]=q("div",{class:"text-h6 text-weight-medium text-primary q-mb-md"},"Current Selection",-1)),q("div",Q,[P.value?(f(),y(m,{key:0,color:"primary",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:h(()=>[x(l,{name:"school",size:"18px",class:"q-mr-xs"}),q("span",C,b(L(P.value)),1)]),_:1})):w("",!0),R.value?(f(),y(m,{key:1,color:"blue-6",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:h(()=>[x(l,{name:"calendar_month",size:"18px",class:"q-mr-xs"}),q("span",U,b(R.value.name),1)]),_:1})):w("",!0),$.value?(f(),y(m,{key:2,color:"indigo-6",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:h(()=>[x(l,{name:"event",size:"18px",class:"q-mr-xs"}),q("span",F,b($.value.name),1)]),_:1})):w("",!0)])]),_:1}),x(t,{align:"right",class:"q-pt-lg"},{default:h(()=>[x(o,{label:"Cancel",color:"grey",flat:"",onClick:r[3]||(r[3]=a=>e.$emit("cancel")),class:"q-px-md"}),x(o,{label:"Save Settings",icon:"save",color:"primary",onClick:X,disable:!H.value,class:"q-px-xl"},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{Y as default};
