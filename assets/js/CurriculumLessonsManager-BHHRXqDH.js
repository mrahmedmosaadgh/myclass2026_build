import{o as e,u as l,Q as s,c as t,a,n as o,p as n,g as i,h as u,i as r,d,j as c,l as p,m,f as v,b as y,aP as _}from"./app-C-NJhdpe.js";import{Q as f}from"./QSpace-Bn7M2Abx.js";import{Q as b}from"./QSelect-B3f0Rrq3.js";import{f as g,a as h,o as V,H as k,I as x,J as j,b as q,M as C,U as T,L as w,O as L,Q,V as U,y as $,$ as E,F as S,x as A,Z as F}from"./vendor-CUZ9QTQV.js";import{d as I}from"./vuedraggable.umd-DSpybXTp.js";import{E as M}from"./ExcelManager-lsq-DZ0a.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";import"./rtl-Cr6c3OOr.js";import"./index-qnu-TzzR.js";import"./QTab-C_vkYR0k.js";import"./QTabs-C8Sz98qV.js";import"./QTabPanel-zhJc0Joi.js";import"./use-panel-CGzbevm7.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-bY91sdlT.js";import"./QFile-Df8jQ91k.js";import"./use-file-DLm3sfQB.js";import"./QTable-D-FHlyjj.js";import"./QMarkupTable-CDVIpyWz.js";import"./QLinearProgress-DLQRR2k-.js";import"./use-fullscreen-iiJPvjW2.js";import"./QTr-Dh8Lv6ob.js";import"./xlsx-cMC2LkxH.js";const N={class:"col"},P={class:"q-my-none"},z={class:"col-auto"},D={key:0,class:"text-center q-py-lg text-grey-6"},O={class:"row items-center q-mb-md bg-grey-2 q-pa-md rounded-borders"},J={class:"col"},Y={class:"q-my-none"},Z={class:"text-grey-6 q-mb-none text-caption"},B={key:0,class:"col-auto q-gutter-xs"},H={class:"text-grey-8 q-gutter-xs"},K={key:0,class:"text-center q-py-md text-grey-6"},W={class:"text-h6"},G={class:"q-gutter-md"},R={class:"text-h6"},X={class:"q-gutter-md"},ee=e({__name:"CurriculumLessonsManager",props:{curriculum:{type:Object,required:!0}},emits:["close","updated"],setup(e,{emit:ee}){const le=e,se=ee,te=l(),ae=g([]),oe=g(!1),ne=g(!1),ie=g(null),ue=g(null),re=g(null),de=g(!1),ce=g(!1),pe=g(!1),me=g(!1),ve=g("import"),ye=g(!1),_e=["main","revision","quiz","project","extra"],fe=Array.from({length:21},(e,l)=>({label:l.toString(),value:l.toString()})),be=g({number:"",title:"",description:""}),ge=g({lesson_number:"",lesson_title:"",description:"",content:"",type:"main"}),he=h(()=>{if(0===ae.value.length)return[{topic_number:"1",topic_title:"Introduction",topic_description:"Basic concepts",lesson_number:"1.1",lesson_title:"What is it?",lesson_description:"Overview",lesson_content:"Some content here...",lesson_type:"main",page_number:1,standard:"",strand:"",skill:"",activities:"",assignment:"",assessment:"",objective:""}];const e=[];return ae.value.forEach(l=>{l.lessons&&0!==l.lessons.length?l.lessons.forEach(s=>{e.push({topic_number:l.number,topic_title:l.title,topic_description:l.description||"",lesson_number:s.lesson_number,lesson_title:s.lesson_title,lesson_description:s.description||"",lesson_content:s.content||"",lesson_type:s.type||"main",page_number:s.page_number||"",standard:s.standard||"",strand:s.strand||"",skill:s.skill||"",activities:s.activities||"",assignment:s.assignment||"",assessment:s.assessment||"",objective:s.objective||""})}):e.push({topic_number:l.number,topic_title:l.title,topic_description:l.description||"",lesson_number:"",lesson_title:"",lesson_description:"",lesson_content:"",lesson_type:"",page_number:"",standard:"",strand:"",skill:"",activities:"",assignment:"",assessment:"",objective:""})}),e}),Ve=(e="import")=>{ve.value=e,me.value=!0},ke=async()=>{pe.value=!0;try{const e=await F.get(`/api/curriculum/${le.curriculum.id}/topics`);ae.value=e.data}catch(e){te.notify({type:"negative",message:"Failed to load topics"})}finally{pe.value=!1}},xe=()=>{if(qe(),ie.value=null,ae.value.length>0){const e=ae.value[ae.value.length-1],l=parseInt(e.number)||0;be.value.number=(l+1).toString()}else be.value.number="1";oe.value=!0},je=()=>{oe.value=!1,ie.value=null,qe()},qe=()=>{be.value={number:"",title:"",description:""}},Ce=async()=>{var e,l;if(be.value.number&&be.value.title){de.value=!0;try{const e={number:be.value.number,title:be.value.title,description:be.value.description};ie.value?(await F.put(`/api/curriculum/topics/${ie.value.id}`,e),te.notify({type:"positive",message:"Topic updated successfully"})):(e.curriculum_id=le.curriculum.id,await F.post("/api/curriculum/topics",e),te.notify({type:"positive",message:"Topic created successfully"})),je(),ke(),se("updated")}catch(s){te.notify({type:"negative",message:(null==(l=null==(e=s.response)?void 0:e.data)?void 0:l.message)||"Failed to save topic"})}finally{de.value=!1}}else te.notify({type:"negative",message:"Please fill in all required fields"})},Te=()=>{ne.value=!1,ue.value=null,re.value=null,we()},we=()=>{ge.value={lesson_number:"",lesson_title:"",description:"",content:"",type:"main"}},Le=async()=>{var e,l;if(ge.value.lesson_number&&ge.value.lesson_title){ce.value=!0;try{const e={lesson_number:ge.value.lesson_number,lesson_title:ge.value.lesson_title,description:ge.value.description,content:ge.value.content,type:ge.value.type,school_id:le.curriculum.school_id};ue.value?(await F.put(`/api/curriculum/lessons/${ue.value.id}`,e),te.notify({type:"positive",message:"Lesson updated successfully"})):(e.topic_id=re.value.id,await F.post("/api/curriculum/lessons",e),te.notify({type:"positive",message:"Lesson created successfully"})),Te(),ke(),se("updated")}catch(s){te.notify({type:"negative",message:(null==(l=null==(e=s.response)?void 0:e.data)?void 0:l.message)||"Failed to save lesson"})}finally{ce.value=!1}}else te.notify({type:"negative",message:"Please fill in all required fields"})},Qe=async e=>{var l,s;try{const l=e.filter(e=>e.topic_number&&e.topic_title&&e.lesson_number&&e.lesson_title);if(0===l.length)return void te.notify({type:"negative",message:"No valid data found. Ensure topic_number, topic_title, lesson_number, and lesson_title are present."});const s=await F.post(`/api/curriculum/${le.curriculum.id}/bulk-import-topics-lessons`,{data:l});te.notify({type:"positive",message:s.data.message}),me.value=!1,ke(),se("updated")}catch(t){te.notify({type:"negative",message:(null==(s=null==(l=t.response)?void 0:l.data)?void 0:s.message)||"Failed to import data"})}};return V(()=>{ke()}),(l,g)=>(x(),k(m,{class:"full-height"},{default:j(()=>[q(t,{class:"row items-center q-pb-none"},{default:j(()=>[C("div",N,[C("h5",P,T(e.curriculum.name)+" - Topics & Lessons",1),g[16]||(g[16]=C("p",{class:"text-grey-6 q-mb-none"},"Manage topics and lessons for this curriculum",-1))]),C("div",z,[q(s,{flat:"",round:"",dense:"",icon:"close",onClick:g[0]||(g[0]=e=>l.$emit("close"))})])]),_:1}),q(a),q(t,{class:"q-pb-none"},{default:j(()=>[q(s,{color:"primary",icon:"add",label:"Add Topic",onClick:xe,unelevated:""}),q(s,{color:"primary",icon:"upload",label:"Import Excel",onClick:g[1]||(g[1]=e=>Ve("import")),unelevated:"",class:"q-ml-sm"}),q(s,{color:"primary",icon:"download",label:"Export to Excel",onClick:g[2]||(g[2]=e=>Ve("export")),unelevated:"",class:"q-ml-sm"}),q(f),q(o,{modelValue:ye.value,"onUpdate:modelValue":g[3]||(g[3]=e=>ye.value=e),label:"Edit Mode",color:"orange",icon:"edit"},null,8,["modelValue"])]),_:1}),q(t,{class:"scroll",style:{height:"calc(100% - 200px)"}},{default:j(()=>[0===ae.value.length?(x(),w("div",D,' No topics yet. Click "Add Topic" to create one. ')):L("",!0),(x(!0),w(S,null,Q(ae.value,e=>{var l;return x(),w("div",{key:e.id,class:"q-mb-lg"},[C("div",O,[C("div",J,[C("h6",Y,T(e.number)+" - "+T(e.title),1),C("p",Z,T((null==(l=e.lessons)?void 0:l.length)||0)+" lessons",1)]),ye.value?(x(),w("div",B,[q(s,{size:"sm",flat:"",dense:"",round:"",icon:"add",color:"primary",onClick:l=>(e=>{if(re.value=e,we(),ue.value=null,e.lessons&&e.lessons.length>0){const l=e.lessons[e.lessons.length-1],s=parseInt(l.lesson_number)||0;ge.value.lesson_number=(s+1).toString()}else ge.value.lesson_number="1";ne.value=!0})(e)},{default:j(()=>[q(n,null,{default:j(()=>g[17]||(g[17]=[U("Add Lesson")])),_:1})]),_:2},1032,["onClick"]),q(s,{size:"sm",flat:"",dense:"",round:"",icon:"edit",color:"primary",onClick:l=>(e=>{ie.value=e,be.value={number:e.number,title:e.title,description:e.description||""},oe.value=!0})(e)},{default:j(()=>[q(n,null,{default:j(()=>g[18]||(g[18]=[U("Edit Topic")])),_:1})]),_:2},1032,["onClick"]),q(s,{size:"sm",flat:"",dense:"",round:"",icon:"delete",color:"negative",onClick:l=>(e=>{te.dialog({title:"Confirm Deletion",message:`Are you sure you want to delete "${e.title}"? All lessons in this topic will also be deleted.`,cancel:!0,persistent:!0,color:"negative"}).onOk(async()=>{var l,s;try{await F.delete(`/api/curriculum/topics/${e.id}`),te.notify({type:"positive",message:"Topic deleted successfully"}),ke(),se("updated")}catch(t){te.notify({type:"negative",message:(null==(s=null==(l=t.response)?void 0:l.data)?void 0:s.message)||"Failed to delete topic"})}})})(e)},{default:j(()=>[q(n,null,{default:j(()=>g[19]||(g[19]=[U("Delete Topic")])),_:1})]),_:2},1032,["onClick"])])):L("",!0)]),q(i,{bordered:"",separator:"",class:"q-ml-lg"},{default:j(()=>[q($(I),{modelValue:e.lessons,"onUpdate:modelValue":l=>e.lessons=l,"item-key":"id",onChange:l=>(async e=>{try{const l=e.lessons.map(e=>({id:e.id,lesson_number:e.lesson_number}));await F.post(`/api/curriculum/topics/${e.id}/lessons/reorder`,{lessons:l}),te.notify({type:"positive",message:"Lessons reordered successfully"}),se("updated")}catch(l){te.notify({type:"negative",message:"Failed to reorder lessons"}),ke()}})(e),class:"w-full"},{item:j(({element:l})=>[q(u,{clickable:""},{default:j(()=>[ye.value?(x(),k(r,{key:0,avatar:""},{default:j(()=>[q(d,{name:"drag_indicator",color:"grey"})]),_:1})):L("",!0),q(r,null,{default:j(()=>[q(c,null,{default:j(()=>[U(T(l.lesson_number)+" - "+T(l.lesson_title),1)]),_:2},1024),q(c,{caption:""},{default:j(()=>[U(T(l.description),1)]),_:2},1024)]),_:2},1024),ye.value?(x(),k(r,{key:1,side:"",top:""},{default:j(()=>[C("div",H,[q(s,{size:"sm",flat:"",dense:"",round:"",icon:"edit",color:"primary",onClick:E(s=>((e,l)=>{re.value=l,ue.value=e,ge.value={lesson_number:e.lesson_number,lesson_title:e.lesson_title,description:e.description||"",content:e.content||"",type:e.type||"main"},ne.value=!0})(l,e),["stop"])},{default:j(()=>[q(n,null,{default:j(()=>g[20]||(g[20]=[U("Edit")])),_:1})]),_:2},1032,["onClick"]),q(s,{size:"sm",flat:"",dense:"",round:"",icon:"delete",color:"negative",onClick:E(e=>(e=>{te.dialog({title:"Confirm Deletion",message:`Are you sure you want to delete "${e.lesson_title}"? This action cannot be undone.`,cancel:!0,persistent:!0,color:"negative"}).onOk(async()=>{var l,s;try{await F.delete(`/api/curriculum/lessons/${e.id}`),te.notify({type:"positive",message:"Lesson deleted successfully"}),ke(),se("updated")}catch(t){te.notify({type:"negative",message:(null==(s=null==(l=t.response)?void 0:l.data)?void 0:s.message)||"Failed to delete lesson"})}})})(l),["stop"])},{default:j(()=>[q(n,null,{default:j(()=>g[21]||(g[21]=[U("Delete")])),_:1})]),_:2},1032,["onClick"])])]),_:2},1024)):L("",!0)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),e.lessons&&0!==e.lessons.length?L("",!0):(x(),w("div",K," No lessons in this topic "))]),_:2},1024)])}),128))]),_:1}),q(a),q(p,{align:"right"},{default:j(()=>[q(s,{flat:"",label:"Close",onClick:g[4]||(g[4]=e=>l.$emit("close"))})]),_:1}),q(y,{modelValue:oe.value,"onUpdate:modelValue":g[8]||(g[8]=e=>oe.value=e),persistent:""},{default:j(()=>[q(m,{style:{"min-width":"500px"}},{default:j(()=>[q(t,null,{default:j(()=>[C("div",W,T(ie.value?"Edit Topic":"Add New Topic"),1)]),_:1}),q(t,{class:"q-pt-none"},{default:j(()=>[C("div",G,[q(b,{modelValue:be.value.number,"onUpdate:modelValue":g[5]||(g[5]=e=>be.value.number=e),options:$(fe),label:"Topic Number *",outlined:"",rules:[e=>null!==e&&""!==e||"Topic number is required"],"emit-value":"","map-options":""},null,8,["modelValue","options","rules"]),q(v,{modelValue:be.value.title,"onUpdate:modelValue":g[6]||(g[6]=e=>be.value.title=e),label:"Topic Title *",outlined:"",rules:[e=>!!e||"Title is required"]},null,8,["modelValue","rules"]),q(v,{modelValue:be.value.description,"onUpdate:modelValue":g[7]||(g[7]=e=>be.value.description=e),label:"Description",type:"textarea",rows:"3",outlined:""},null,8,["modelValue"])])]),_:1}),q(p,{align:"right"},{default:j(()=>[q(s,{flat:"",label:"Cancel",onClick:je}),q(s,{color:"primary",label:"Save",onClick:Ce,loading:de.value,unelevated:""},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),q(y,{modelValue:ne.value,"onUpdate:modelValue":g[14]||(g[14]=e=>ne.value=e),persistent:""},{default:j(()=>[q(m,{style:{"min-width":"500px"}},{default:j(()=>[q(t,null,{default:j(()=>[C("div",R,T(ue.value?"Edit Lesson":"Add New Lesson"),1)]),_:1}),q(t,{class:"q-pt-none"},{default:j(()=>[C("div",X,[q(b,{modelValue:ge.value.lesson_number,"onUpdate:modelValue":g[9]||(g[9]=e=>ge.value.lesson_number=e),options:$(fe),label:"Lesson Number *",outlined:"",rules:[e=>null!==e&&""!==e||"Lesson number is required"],"emit-value":"","map-options":""},null,8,["modelValue","options","rules"]),q(v,{modelValue:ge.value.lesson_title,"onUpdate:modelValue":g[10]||(g[10]=e=>ge.value.lesson_title=e),label:"Lesson Title *",outlined:"",rules:[e=>!!e||"Title is required"]},null,8,["modelValue","rules"]),q(v,{modelValue:ge.value.description,"onUpdate:modelValue":g[11]||(g[11]=e=>ge.value.description=e),label:"Description",type:"textarea",rows:"2",outlined:""},null,8,["modelValue"]),q(v,{modelValue:ge.value.content,"onUpdate:modelValue":g[12]||(g[12]=e=>ge.value.content=e),label:"Content",type:"textarea",rows:"4",outlined:""},null,8,["modelValue"]),q(b,{modelValue:ge.value.type,"onUpdate:modelValue":g[13]||(g[13]=e=>ge.value.type=e),options:_e,label:"Lesson Type",outlined:""},null,8,["modelValue"])])]),_:1}),q(p,{align:"right"},{default:j(()=>[q(s,{flat:"",label:"Cancel",onClick:Te}),q(s,{color:"primary",label:"Save",onClick:Le,loading:ce.value,unelevated:""},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),q(y,{modelValue:me.value,"onUpdate:modelValue":g[15]||(g[15]=e=>me.value=e),"full-width":""},{default:j(()=>[q(m,null,{default:j(()=>[q(t,{class:"row items-center q-pb-none"},{default:j(()=>[g[22]||(g[22]=C("div",{class:"text-h6"},"Import Topics & Lessons",-1)),q(f),A(q(s,{icon:"close",flat:"",round:"",dense:""},null,512),[[_]])]),_:1}),q(a),q(t,null,{default:j(()=>[q(M,{"export-file-name":`${e.curriculum.name}_topics_lessons.xlsx`,"export-data":he.value,"initial-tab":ve.value,onImportedJson:Qe},null,8,["export-file-name","export-data","initial-tab"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},[["__scopeId","data-v-4a1e0372"]]);export{ee as default};
