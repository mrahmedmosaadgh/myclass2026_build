import{r as e,u as l,Q as s,t,b as a,j as c,k as o,i as d,ao as n,aS as r}from"./app-DTyzyps1.js";import{a as i,N as u,J as h,I as v,Q as m,V as p,O as _,S as f,b as y,W as b,K as g,a0 as k,y as w,U as x}from"./vendor-BJyC5yAd.js";import"./offline-BzIlwqNM.js";import"./i18n-BDgsCcB6.js";import"./ui-DFn3cvMd.js";const j={key:0,class:"empty-cell"},C={key:1,class:"text-caption text-grey-6"},S={key:2,class:"text-caption text-grey-4"},I={key:3,class:"period-order-badge"},T={key:1,class:"assigned-cell"},$={key:0,class:"period-order-badge is-assigned"},z=["title"],D=["title"],B={key:2,class:"classroom-name text-caption text-grey-6"},O={class:"indicators"},N=e({__name:"TimetableCell",props:{schedule:{type:Object,default:null},showClassroom:{type:Boolean,default:!1},hideTeacher:{type:Boolean,default:!1},conflictInfo:{type:Object,default:null},readonly:{type:Boolean,default:!1},showFullName:{type:Boolean,default:!1},rewardSystemDisabled:{type:Boolean,default:!1}},emits:["click","edit","clear","open-reward"],setup(e,{emit:N}){const F=l(),H=e,L=N;i(()=>{var e,l,s,t,a;return(null==(s=null==(l=null==(e=H.schedule)?void 0:e.cst)?void 0:l.subject)?void 0:s.name)||(null==(a=null==(t=H.schedule)?void 0:t.cst)?void 0:a.subject_name)||"Subject"}),i(()=>{var e,l,s,t,a;return(null==(s=null==(l=null==(e=H.schedule)?void 0:e.cst)?void 0:l.teacher)?void 0:s.name)||(null==(a=null==(t=H.schedule)?void 0:t.cst)?void 0:a.teacher_name)||"Teacher"});const Q=i(()=>{var e,l,s,t,a;return(null==(s=null==(l=null==(e=H.schedule)?void 0:e.cst)?void 0:l.subject)?void 0:s.name)||(null==(a=null==(t=H.schedule)?void 0:t.cst)?void 0:a.subject_name)||"Subject"}),W=i(()=>{var e,l,s,t,a;return(null==(s=null==(l=null==(e=H.schedule)?void 0:e.cst)?void 0:l.teacher)?void 0:s.name)||(null==(a=null==(t=H.schedule)?void 0:t.cst)?void 0:a.teacher_name)||"Teacher"}),q=i(()=>{const e=Q.value;return e.length>3?e.substring(0,3):e}),A=i(()=>{const e=W.value.split(" ");if(1===e.length)return e[0].length>3?e[0].substring(0,3):e[0];return`${e[0].length>3?e[0].substring(0,3):e[0]} ${e[e.length-1].length>3?e[e.length-1].substring(0,3):e[e.length-1]}`}),E=i(()=>{var e,l,s,t,a;return(null==(s=null==(l=null==(e=H.schedule)?void 0:e.cst)?void 0:l.classroom)?void 0:s.name)||(null==(a=null==(t=H.schedule)?void 0:t.cst)?void 0:a.classroom_name)||""}),J=i(()=>{var e,l,s,t;return(null==(l=null==(e=H.schedule)?void 0:e.cst)?void 0:l.c_bg)||(null==(t=null==(s=H.schedule)?void 0:s.cst)?void 0:t.color_custom)||"#e0e0e0"}),K=i(()=>{var e,l,s,t;return(null==(l=null==(e=H.schedule)?void 0:e.cst)?void 0:l.c_text)||(null==(t=null==(s=H.schedule)?void 0:s.cst)?void 0:t.color_custom_text)||"#333333"}),R=i(()=>{var e,l,s;return{"is-empty":!(null==(e=H.schedule)?void 0:e.cst_id),"is-assigned":!!(null==(l=H.schedule)?void 0:l.cst_id),"has-substitute":!!(null==(s=H.schedule)?void 0:s.teacher_substitute_id),"has-conflict":!!H.conflictInfo,"cursor-pointer":!H.readonly,"is-readonly":H.readonly}}),U=i(()=>!!H.conflictInfo),V=i(()=>{if(!H.conflictInfo)return"";const e=H.conflictInfo.other_classrooms||[];if(0===e.length)return"Teacher has a scheduling conflict";const l=e.map(e=>`${e.classroom_name} (${e.subject_name})`).join(", ");return`⚠️ Conflict: ${H.conflictInfo.teacher_name} is also assigned to: ${l}`}),G=()=>{var e,l,s;if(!(null==(s=null==(l=null==(e=H.schedule)?void 0:e.cst)?void 0:l.teacher)?void 0:s.id))return;const t=(H.schedule.cst.teacher.name||"teacher").toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),a=route("schedules.teacher.view",{teacher_id:H.schedule.cst.teacher.id,teacher_name:t});navigator.clipboard.writeText(a).then(()=>{F.notify({type:"positive",message:"Teacher schedule link copied to clipboard!",position:"top",timeout:2e3})})},M=()=>{H.readonly||L("click",H.schedule)},P=(e="positive")=>{var l;if(!(null==(l=H.schedule)?void 0:l.cst))return;const s=H.schedule.cst.classroom_id,t=H.schedule.cst.subject_id,a=H.schedule.period_number||H.schedule.period,c=(new Date).toISOString().split("T")[0];L("open-reward",{classroomId:s,subjectId:t,period:a,date:c,schedule:H.schedule,initialTab:e})};return(l,i)=>{var N,F,H;return h(),u("div",{class:x(["timetable-cell",R.value]),onClick:M},[(null==(N=e.schedule)?void 0:N.cst_id)?(h(),u("div",T,[e.schedule.period_order?(h(),u("div",$,p(e.schedule.period_order),1)):m("",!0),_("div",{class:"subject-badge",style:f({backgroundColor:J.value,color:K.value}),title:Q.value},p(e.showFullName?Q.value:q.value),13,z),e.hideTeacher?m("",!0):(h(),u("div",{key:1,class:"teacher-name text-caption scale-75",title:W.value},[y(s,{name:"person",size:"xs",class:"q-mr-xs text-gray-500"}),b(" "+p(A.value),1)],8,D)),e.showClassroom?(h(),u("div",B,p(E.value),1)):m("",!0),_("div",O,[U.value?(h(),v(s,{key:0,name:"warning",size:"sm",color:"red",class:"conflict-icon"},{default:g(()=>[y(t,{class:"bg-red text-white"},{default:g(()=>[b(p(V.value),1)]),_:1})]),_:1})):m("",!0),e.schedule.teacher_substitute_id?(h(),v(s,{key:1,name:"swap_horiz",size:"xs",color:"orange"},{default:g(()=>[y(t,null,{default:g(()=>i[2]||(i[2]=[b("Has substitute teacher")])),_:1})]),_:1})):m("",!0),e.schedule.co_teacher_id?(h(),v(s,{key:2,name:"group",size:"xs",color:"blue"},{default:g(()=>[y(t,null,{default:g(()=>i[3]||(i[3]=[b("Has co-teacher")])),_:1})]),_:1})):m("",!0)]),e.readonly?(h(),v(a,{key:3,round:"",dense:"",size:"xs",icon:"stars",color:e.rewardSystemDisabled?"grey":"amber",disable:e.rewardSystemDisabled,class:"reward-btn",onClick:k(P,["stop"])},{default:g(()=>[y(t,null,{default:g(()=>[b(p(e.rewardSystemDisabled?"Select Date & Week first":"Reward System"),1)]),_:1})]),_:1},8,["color","disable"])):m("",!0)])):(h(),u("div",j,[e.readonly?m("",!0):(h(),v(s,{key:0,name:"add",size:"sm",color:"grey-5"})),e.readonly?(h(),u("span",S,"-")):(h(),u("span",C,"Assign")),(null==(F=e.schedule)?void 0:F.period_order)?(h(),u("div",I,p(e.schedule.period_order),1)):m("",!0)])),(null==(H=e.schedule)?void 0:H.cst_id)&&!e.readonly?(h(),v(n,{key:2,"touch-position":"","context-menu":""},{default:g(()=>[y(d,{dense:"",style:{"min-width":"150px"}},{default:g(()=>[w((h(),v(c,{clickable:"",onClick:i[0]||(i[0]=s=>l.$emit("edit",e.schedule))},{default:g(()=>[y(o,{avatar:""},{default:g(()=>[y(s,{name:"edit"})]),_:1}),y(o,null,{default:g(()=>i[4]||(i[4]=[b("Edit")])),_:1})]),_:1})),[[r]]),w((h(),v(c,{clickable:"",onClick:G},{default:g(()=>[y(o,{avatar:""},{default:g(()=>[y(s,{name:"link",color:"primary"})]),_:1}),y(o,null,{default:g(()=>i[5]||(i[5]=[b("Link")])),_:1})]),_:1})),[[r]]),w((h(),v(c,{clickable:"",onClick:i[1]||(i[1]=s=>l.$emit("clear",e.schedule))},{default:g(()=>[y(o,{avatar:""},{default:g(()=>[y(s,{name:"clear",color:"negative"})]),_:1}),y(o,null,{default:g(()=>i[6]||(i[6]=[b("Clear")])),_:1})]),_:1})),[[r]])]),_:1})]),_:1})):m("",!0)],2)}}},[["__scopeId","data-v-b1fef64b"]]);export{N as default};
