const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/TopLeaderboard-CZEvOHyV.js","assets/js/app-Dtv5Fi9L.js","assets/js/vendor-BWKGNkNB.js","assets/js/offline-BzIlwqNM.js","assets/js/i18n-B0T1C7j3.js","assets/js/ui-B7TfxbV_.js","assets/css/app-D-EPZtur.css","assets/js/QSelect-BslHFD89.js","assets/js/rtl-Cr6c3OOr.js","assets/js/html2canvas.esm-Cq3pa7K9.js","assets/css/TopLeaderboard-Dw9a8_8K.css","assets/js/BehaviorIncidents-Dj0ZstCZ.js","assets/js/QBtnToggle-BoICfhrK.js","assets/js/QBadge-B7PIhVlN.js","assets/js/QToolbar-CZW0qibB.js","assets/js/StudentCard-rsVUyQIV.js","assets/js/AvatarManager-D64r3XLO.js","assets/js/CameraCapture-_bgxMbKa.js","assets/css/CameraCapture-DNCA1XZm.css","assets/css/AvatarManager-CvFCMAcw.css","assets/css/StudentCard-DXXgkWNV.css","assets/js/IncidentPrintReport-BD8ZLz8J.js","assets/css/IncidentPrintReport-BcWCgfP6.css","assets/js/StudentGrouping-CN9_hk_e.js","assets/js/vuedraggable.umd-DshT_Vng.js","assets/js/index-SlSKjXnq.js","assets/css/StudentGrouping-CRYXuU7Q.css"])))=>i.map(i=>d[i]);
import{r as e,u as a,f as t,Q as l,p as s,b as o,t as n,d as r,i,j as d,k as u,c,aR as v,e as m,o as p,l as g,g as b,h as f,_ as y,G as h,aS as x,s as w,m as _}from"./app-Dtv5Fi9L.js";import{Q as S}from"./QBtnToggle-BoICfhrK.js";import{Q as k}from"./QBadge-B7PIhVlN.js";import{Q as $}from"./QTabPanel-DJnQc_xc.js";import{Q as I}from"./QSpace-D-IrDQfo.js";import{Q as C}from"./QTab-C3dKeHww.js";import{Q as j}from"./QTabs-Djj_zpNj.js";import{Q as A}from"./QTabPanels-DIsvTADE.js";import{Q as V}from"./QSelect-BslHFD89.js";import{u as z}from"./i18n-B0T1C7j3.js";import{_ as P,f as E,o as D,k as F,M as T,a as U,af as q,N as R,J as N,b as B,R as L,I as O,O as M,K as Q,V as W,z as G,l as Y,W as H,F as J,Q as Z,y as K,E as X,ag as ee,ah as ae,aS as te,U as le}from"./vendor-BWKGNkNB.js";import se from"./PointsDisplaySettings-BtXJq6Vl.js";import oe from"./StudentCard-rsVUyQIV.js";import ne from"./noise-CzERC21p.js";import"./offline-BzIlwqNM.js";import"./ui-B7TfxbV_.js";import"./use-panel-CKffL4LQ.js";import"./use-render-cache-CmTcazfP.js";import"./rtl-Cr6c3OOr.js";import"./AvatarManager-D64r3XLO.js";import"./CameraCapture-_bgxMbKa.js";const re="/api",ie={behaviors:`${re}/behaviors`,studentBehaviors:`${re}/student-behaviors`,pointActions:`${re}/student-behaviors-point-actions`,leaderboard:`${re}/leaderboard`,studentSummary:e=>`${re}/student-behaviors/${e}/summary`,pointActionStatistics:e=>`${re}/student-behaviors/${e}/statistics`,attendance:`${re}/student-attendance`,attendanceBatch:`${re}/student-attendance/batch`};async function de({classroomId:e,startDate:a,endDate:t,limit:l=10}){var s,o;try{const s=await P.get(ie.leaderboard,{params:{classroom_id:e,start_date:a,end_date:t,limit:Math.min(l,50)}});return{success:!0,data:Array.isArray(s.data)?s.data:[]}}catch(n){return console.error("Error fetching leaderboard:",n),{success:!1,error:(null==(o=null==(s=n.response)?void 0:s.data)?void 0:o.message)||"Failed to fetch leaderboard",data:[],details:n}}}const ue={addPoint:async function(e,a,t=null,l=""){var s,o;try{const s={student_behaviors_id:e,value:parseInt(a),reason_id:t?parseInt(t):null,note:l||null};return{success:!0,data:(await P.post(ie.pointActions,s)).data,message:`Point ${a>0?"added":"deducted"} successfully`}}catch(n){return console.error("Error adding point:",n),{success:!1,error:(null==(o=null==(s=n.response)?void 0:s.data)?void 0:o.message)||"Failed to add point",details:n}}},cancelPoint:async function(e,a){var t,l;try{return{success:!0,data:(await P.post(`${ie.pointActions}/${e}/cancel`,{cancel_reason:a})).data,message:"Point action canceled successfully"}}catch(s){return console.error("Error canceling point:",s),{success:!1,error:(null==(l=null==(t=s.response)?void 0:t.data)?void 0:l.message)||"Failed to cancel point",details:s}}},restorePoint:async function(e){var a,t;try{return{success:!0,data:(await P.post(`${ie.pointActions}/${e}/restore`)).data,message:"Point action restored successfully"}}catch(l){return console.error("Error restoring point:",l),{success:!1,error:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||"Failed to restore point",details:l}}},deletePoint:async function(e){var a,t;try{return{success:!0,data:(await P.delete(`${ie.pointActions}/${e}`)).data,message:"Point action deleted successfully"}}catch(l){return console.error("Error deleting point:",l),{success:!1,error:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||"Failed to delete point",details:l}}},createStudentBehavior:async function(e){var a,t;try{const a={school_id:e.schoolId,student_behaviors_mains_id:e.studentBehaviorsMainsId,student_id:e.studentId,attend:e.attend||null,points_plus:e.pointsPlus||0,points_minus:e.pointsMinus||0,points_details:e.pointsDetails||"",notes:e.notes||null};return{success:!0,data:(await P.post(ie.studentBehaviors,a)).data,message:"Student behavior record created successfully"}}catch(l){return console.error("Error creating student behavior:",l),{success:!1,error:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||"Failed to create behavior record",details:l}}},getStudentSummary:async function(e){var a,t;try{return{success:!0,data:(await P.get(ie.studentSummary(e))).data}}catch(l){return console.error("Error fetching student summary:",l),{success:!1,error:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||"Failed to fetch student summary",details:l}}},getPointActions:async function(e){var a,t;try{return{success:!0,data:(await P.get(ie.pointActions,{params:{student_behaviors_id:e}})).data}}catch(l){return console.error("Error fetching point actions:",l),{success:!1,error:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||"Failed to fetch point actions",details:l}}},getPointStatistics:async function(e){var a,t;try{return{success:!0,data:(await P.get(`${ie.pointActions}/statistics/${e}`)).data}}catch(l){return console.error("Error fetching point statistics:",l),{success:!1,error:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||"Failed to fetch statistics",details:l}}},fetchBehaviors:async function(){var e,a;try{const e=await P.get(ie.behaviors);return{success:!0,data:Array.isArray(e.data)?e.data:[]}}catch(t){return console.error("Error fetching behaviors:",t),{success:!1,error:(null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.message)||"Failed to fetch behaviors",data:[],details:t}}},applyBehaviorToStudents:async function(e,a,t={}){var l,s,o,n,r,i,d,u,c,v,m,p,g,b;try{const g=[],b=[],y="object"==typeof a?a.id:a;if(console.log("üéØ applyBehaviorToStudents called with:",{studentCount:e.length,behaviorIdInput:a,actualBehaviorId:y,behaviorIdType:typeof a}),!y||isNaN(y))return console.error("‚ùå Invalid behavior ID:",a),{success:!1,error:"Invalid behavior ID provided"};for(const a of e){const e={student_id:a,behavior_id:y,date:t.date||(new Date).toISOString().split("T")[0],period_code:t.periodCode||null,notes:t.notes||null};console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"),console.log("üì§ Sending behavior application request"),console.log("   Student ID:",a),console.log("   Behavior ID:",y),console.log("   Date:",e.date),console.log("   Period Code:",e.period_code),console.log("   Payload:",JSON.stringify(e,null,2)),console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");try{const t=await P.post(`${re}/student-behaviors/quick-create`,e);console.log("‚úÖ SUCCESS - Behavior applied for student:",a),console.log("   Response Status:",t.status),console.log("   Response Data:",t.data),g.push({studentId:a,success:!0,data:t.data})}catch(f){console.error("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"),console.error("‚ùå FAILED - Error applying behavior to student:",a),console.error("   HTTP Status:",null==(l=f.response)?void 0:l.status,null==(s=f.response)?void 0:s.statusText),console.error("   Error Message:",null==(n=null==(o=f.response)?void 0:o.data)?void 0:n.message),console.error("   Error Details:",null==(i=null==(r=f.response)?void 0:r.data)?void 0:i.error),console.error("   Validation Errors:",null==(u=null==(d=f.response)?void 0:d.data)?void 0:u.errors),console.error("   Full Response:",null==(c=f.response)?void 0:c.data),console.error("   Sent Payload:",e),console.error("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"),b.push({studentId:a,success:!1,error:(null==(m=null==(v=f.response)?void 0:v.data)?void 0:m.message)||"Failed to apply behavior",fullError:null==(p=f.response)?void 0:p.data})}}return console.log("üéØ BATCH RESULT:",{totalRequests:e.length,successful:g.length,failed:b.length,successRate:`${Math.round(g.length/e.length*100)}%`}),{success:0===b.length,results:g,errors:b,message:`Applied to ${g.length}/${e.length} students`}}catch(y){return console.error("‚ùå OUTER ERROR - Exception in applyBehaviorToStudents:",y),{success:!1,error:(null==(b=null==(g=y.response)?void 0:g.data)?void 0:b.message)||"Failed to apply behavior",details:y}}},fetchLeaderboard:de,getTopStudentsByPeriod:async function({classroomId:e,period:a="week",limit:t=5}){try{const l=new Date;let s;switch(a){case"week":default:s=new Date(l.getTime()-6048e5);break;case"month":s=new Date(l.getFullYear(),l.getMonth(),1);break;case"all":s=new Date("2020-01-01")}const o=e=>e.toISOString().split("T")[0];return de({classroomId:e,startDate:o(s),endDate:o(l),limit:t})}catch(l){return console.error("Error getting top students:",l),{success:!1,error:"Failed to get top students",data:[],details:l}}},updateAttendance:async function(e,a,t={}){var l,s,o;try{const r={student_id:parseInt(e),attend:Boolean(a),date:t.date||(new Date).toISOString().split("T")[0],period_code:t.periodCode||null,classroom_id:t.classroomId||null};try{const e=await P.post(ie.attendance,r);return{success:!0,data:e.data,message:(null==(l=e.data)?void 0:l.message)||"Student marked as "+(a?"present":"absent")}}catch(n){return console.warn("Attendance API call failed, falling back to client-only update:",null==(s=null==n?void 0:n.response)?void 0:s.status),{success:!0,data:{studentId:parseInt(e),isPresent:Boolean(a),updatedAt:(new Date).toISOString()},message:`Student marked as ${a?"present":"absent"} (local)`,warning:(null==(o=n.response)?void 0:o.data)||n.message}}}catch(r){return console.error("Error updating attendance:",r),{success:!1,error:"Failed to update attendance",details:r}}},batchUpdateAttendance:async function(e,a={}){var t,l,s;try{if(!e||"object"!=typeof e)return{success:!1,error:"Invalid attendance data"};const n=Object.entries(e).map(([e,t])=>({student_id:parseInt(e),attend:Boolean(t),date:a.date||(new Date).toISOString().split("T")[0],period_code:a.periodCode||null,classroom_id:a.classroomId||null,updated_at:(new Date).toISOString()}));try{const e=await P.post(ie.attendanceBatch,{attendance:n});return{success:!0,data:e.data,message:(null==(t=e.data)?void 0:t.message)||`Updated attendance for ${n.length} students`}}catch(o){return console.warn("Batch attendance API call failed, falling back to local update:",null==(l=null==o?void 0:o.response)?void 0:l.status),{success:!0,data:n,message:`Updated attendance for ${n.length} students (local)`,warning:(null==(s=o.response)?void 0:s.data)||o.message}}}catch(n){return console.error("Error batch updating attendance:",n),{success:!1,error:"Failed to batch update attendance",details:n}}},getRecentActions:async function({classroomId:e,date:a,limit:t=10}){var l,s;try{const l=await P.get(`${re}/student-behaviors/recent-actions`,{params:{classroom_id:e,date:a,limit:t}});return{success:!0,data:Array.isArray(l.data.data)?l.data.data:[]}}catch(o){return console.error("Error fetching recent actions:",o),{success:!1,error:(null==(s=null==(l=o.response)?void 0:l.data)?void 0:s.message)||"Failed to fetch recent actions",data:[]}}},undoAction:async function(e,a="Undone by teacher"){var t,l;try{const t=await P.post(`${re}/student-behaviors/actions/${e}/cancel`,{cancel_reason:a});return{success:!0,data:t.data.data,message:t.data.message||"Action undone successfully"}}catch(s){return console.error("Error undoing action:",s),{success:!1,error:(null==(l=null==(t=s.response)?void 0:t.data)?void 0:l.message)||"Failed to undo action"}}},formatPointValue:function(e){return e>0?`+${e} ‚≠ê`:e<0?`${e} ‚ö†Ô∏è`:"0"},getActionTypeLabel:function(e){return{plus:"Added",minus:"Deducted",cancel:"Canceled",revoke:"Revoked"}[e]||e},calculateTotalPoints:function(e,a=!1){return Array.isArray(e)?e.filter(e=>a||!e.canceled).reduce((e,a)=>e+(a.value||0),0):0},separatePoints:function(e){if(!Array.isArray(e))return{positive:0,negative:0};const a=e.filter(e=>!e.canceled);return{positive:a.filter(e=>e.value>0).reduce((e,a)=>e+a.value,0),negative:Math.abs(a.filter(e=>e.value<0).reduce((e,a)=>e+a.value,0))}},isActionEditable:function(e,a=24){try{const t=new Date(e);return(new Date-t)/36e5<a}catch(t){return!1}},getUserFriendlyErrorMessage:function(e){var a,t,l,s,o,n,r;return 401===(null==(a=e.response)?void 0:a.status)?"You are not authenticated. Please log in.":403===(null==(t=e.response)?void 0:t.status)?"You do not have permission to perform this action.":404===(null==(l=e.response)?void 0:l.status)?"The requested resource was not found.":422===(null==(s=e.response)?void 0:s.status)?"Invalid data provided. Please check your input.":500===(null==(o=e.response)?void 0:o.status)?"Server error. Please try again later.":"Network Error"===e.message?"Network error. Please check your connection.":(null==(r=null==(n=e.response)?void 0:n.data)?void 0:r.message)||"An unexpected error occurred."},retryWithBackoff:async function(e,a=3,t=1e3){let l;for(let o=0;o<a;o++)try{return await e()}catch(s){if(l=s,o<a-1){const e=t*Math.pow(2,o);await new Promise(a=>setTimeout(a,e))}}throw l}},ce=new Map;async function ve(e){const a=Object.entries(e).map(([e,a])=>ce.has(e)?Promise.resolve():new Promise(t=>{const l=new Audio(a);l.addEventListener("canplaythrough",()=>{ce.set(e,l),t()},{once:!0}),l.addEventListener("error",()=>{console.warn(`Failed to preload sound "${e}"`),t()},{once:!0}),l.load()}));await Promise.all(a)}const me={class:"p-6 space-y-6 bg-gradient-to-br from-gray-800 to-gray-900 min-h-screen"},pe={class:"text-3xl font-bold"},ge={class:"text-blue-100"},be={class:"flex items-center justify-between bg-white p-4 rounded-lg border border-gray-200 shadow-sm"},fe={class:"flex items-center gap-4"},ye={class:"bg-blue-100 p-3 rounded-full text-blue-600"},he={class:"text-sm text-gray-500 font-medium"},xe={class:"text-lg font-bold text-gray-800 flex items-center gap-2"},we={key:0},_e={key:1,class:"text-gray-400 italic"},Se={class:"text-blue-600 font-mono bg-blue-50 px-2 py-0.5 rounded text-base"},ke={class:"text-xs text-gray-500 mt-1"},$e={key:0,class:"bg-gradient-to-r from-blue-50 to-indigo-50 p-3 rounded-lg border border-blue-200 shadow-sm"},Ie={class:"flex items-center justify-between flex-wrap gap-3"},Ce={class:"flex items-center gap-2"},je={class:"text-sm font-bold text-gray-700"},Ae={class:"flex items-center gap-3 flex-wrap"},Ve={key:0,class:"text-xs text-gray-500 bg-white px-2 py-1 rounded border border-dashed border-gray-300"},ze={class:"flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg border border-blue-200"},Pe={class:"flex flex-col"},Ee={class:"text-xs text-gray-500"},De={class:"text-lg font-bold text-blue-600"},Fe={class:"flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg border border-green-200"},Te={class:"flex flex-col"},Ue={class:"text-xs text-gray-500"},qe={class:"text-lg font-bold text-green-600"},Re={class:"flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg border border-red-200"},Ne={class:"flex flex-col"},Be={class:"text-xs text-gray-500"},Le={class:"text-lg font-bold text-red-600"},Oe={key:0,class:"mt-3 pt-3 border-t border-blue-200"},Me={class:"text-xs font-semibold text-gray-600 mb-2 flex items-center gap-1"},Qe={class:"bg-white border border-red-200 rounded-lg p-2"},We={class:"flex flex-wrap gap-1.5"},Ge={class:"q-pa-sm bg-white border-b border-gray-200 flex justify-between items-center"},Ye={class:"flex items-center gap-2"},He={class:"row no-wrap q-pa-md"},Je={class:"column",style:{"min-width":"220px"}},Ze={class:"column items-center",style:{"min-width":"180px"}},Ke={class:"column q-gutter-y-sm full-width"},Xe={class:"q-py-sm"},ea={class:"flex items-center gap-2"},aa={class:"space-y-4"},ta={class:"flex justify-between items-center mb-4"},la={class:"text-xl font-bold"},sa={class:"flex gap-2"},oa={class:"flex flex-wrap justify-center gap-6 p-4 bg-gray-400"},na={class:""},ra={class:"mt-6"},ia={class:"mb-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200 shadow-sm"},da={class:"flex items-center justify-between flex-wrap gap-3"},ua={class:"flex items-center gap-2"},ca={class:"font-bold text-gray-700"},va={class:"flex items-center gap-2 flex-wrap"},ma={class:"row items-center q-gutter-x-sm"},pa={class:"font-bold"},ga={class:"font-bold"},ba={class:"text-h6"},fa={key:0,class:"text-gray-500 italic text-center py-4"},ya=["src"],ha={style:{width:"420px","max-width":"90vw"}},xa={class:"row q-col-gutter-sm"},wa=["onClick"],_a={class:"column items-center q-pa-sm bg-blue-50 rounded-xl border border-blue-100 shadow-sm hover:shadow-md hover:bg-blue-100 transition-all text-center h-full relative-position"},Sa={class:"text-caption text-weight-bold text-grey-9 ellipsis-2-lines leading-tight min-h-[2.5em] flex items-center justify-center"},ka={class:"absolute-top-right q-ma-xs"},$a={class:"row q-col-gutter-sm"},Ia=["onClick"],Ca={class:"column items-center q-pa-sm bg-red-50 rounded-xl border border-red-100 shadow-sm hover:shadow-md hover:bg-red-100 transition-all text-center h-full relative-position"},ja={class:"text-caption text-weight-bold text-grey-9 ellipsis-2-lines leading-tight min-h-[2.5em] flex items-center justify-center"},Aa={class:"absolute-top-right q-ma-xs"},Va={key:0,class:"mb-3 p-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg border border-indigo-200"},za={class:"flex items-center justify-between"},Pa={class:"font-bold text-indigo-900 flex items-center gap-2"},Ea={class:"flex gap-2"},Da={class:"flex flex-wrap justify-center gap-4"},Fa={class:"space-y-4"},Ta={class:"mb-4"},Ua={class:"text-xl font-bold mb-2"},qa={class:"text-sm text-gray-600"},Ra={class:"p-4 bg-red-50 rounded-lg border border-red-200"},Na={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Ba={class:"mt-2 text-sm"},La={class:"flex flex-wrap justify-center gap-6 p-4"},Oa={class:"space-y-4"},Ma={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Qa=["onClick"],Wa={class:"flex items-start justify-between mb-3"},Ga={class:"flex-1"},Ya={class:"font-semibold text-lg"},Ha={class:"text-xs text-gray-600"},Ja={key:0,class:"text-xs text-red-600 mt-1"},Za={class:"space-y-2"},Ka={class:"p-2 bg-green-100 rounded flex justify-between items-center"},Xa={class:"text-sm font-bold text-green-900"},et={class:"p-2 bg-red-100 rounded flex justify-between items-center"},at={class:"text-sm font-bold text-red-900"},tt={class:"p-2 bg-blue-100 rounded flex justify-between items-center"},lt={class:"text-lg font-bold text-blue-600"},st={class:"space-y-4"},ot={class:"flex justify-between items-center mb-4"},nt={class:"text-xl font-bold"},rt={key:0,class:"text-center py-8"},it={class:"text-gray-500 text-lg"},dt={class:"flex items-start justify-between"},ut={class:"flex-1"},ct={class:"flex items-center gap-2 mb-1"},vt={class:"font-bold text-lg"},mt={class:"text-2xl"},pt={class:"text-sm text-gray-700"},gt={class:"text-xs text-gray-500 mt-1"},bt={key:0,class:"text-xs text-gray-600 mt-1 italic"},ft={key:1,class:"text-xs text-red-600 mt-1"},yt={class:"flex flex-col h-full gap-4"},ht={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},xt={class:"space-y-6"},wt={class:"flex justify-between items-center mb-6"},_t={class:"text-2xl font-bold text-gray-800"},St={class:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200"},kt={class:"flex items-center gap-3 mb-4"},$t={class:"text-xl font-bold text-green-800"},It={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Ct={class:"flex items-start justify-between mb-2"},jt={class:"flex items-center gap-2"},At={class:"text-3xl"},Vt={class:"font-bold text-gray-800"},zt={class:"text-xs text-gray-500"},Pt={class:"flex gap-1"},Et={class:"flex items-center justify-between mt-3 pt-3 border-t border-green-100"},Dt={class:"text-lg font-bold text-green-600"},Ft={key:0,class:"text-center py-8 text-gray-400"},Tt={class:"bg-gradient-to-r from-red-50 to-rose-50 rounded-xl p-6 border border-red-200"},Ut={class:"flex items-center gap-3 mb-4"},qt={class:"text-xl font-bold text-red-800"},Rt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Nt={class:"flex items-start justify-between mb-2"},Bt={class:"flex items-center gap-2"},Lt={class:"text-3xl"},Ot={class:"font-bold text-gray-800"},Mt={class:"text-xs text-gray-500"},Qt={class:"flex gap-1"},Wt={class:"flex items-center justify-between mt-3 pt-3 border-t border-red-100"},Gt={class:"text-lg font-bold text-red-600"},Yt={key:0,class:"text-center py-8 text-gray-400"},Ht={class:"text-2xl font-semibold text-gray-600"},Jt={class:"p-4 border-b border-blue-200 bg-blue-100/50"},Zt={class:"font-bold text-blue-900 flex items-center gap-2 text-lg"},Kt={class:"flex-1 overflow-y-auto p-4 custom-scrollbar"},Xt={key:0,class:"text-center py-8 text-gray-400 italic text-sm"},el={key:1,class:"flex flex-col gap-2"},al={class:"flex flex-col leading-tight overflow-hidden w-full"},tl={class:"font-bold text-2xl truncate"},ll={class:"text-sm opacity-80 truncate"},sl={class:"p-3 border-t border-blue-200 bg-white"},ol={class:"grid grid-cols-3 gap-2"},nl={class:"flex-1 flex flex-col bg-white"},rl={class:"text-h6 font-bold flex items-center gap-2"},il={class:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3"},dl=["onClick"],ul={class:"font-bold text-xl leading-tight text-gray-800 line-clamp-2"},cl={class:"flex justify-between items-center"},vl={class:"text-h6"},ml=e({__name:"reward_sys",props:{isDialog:{type:Boolean,default:!1},classroomId:{type:Number,default:null},subjectId:{type:Number,default:null},period:{type:Number,default:null},date:{type:String,default:null},week:{type:Number,default:null},initialTab:{type:String,default:"positive"}},setup(e){const re=e,ie=te(()=>y(()=>import("./TopLeaderboard-CZEvOHyV.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),de=te(()=>y(()=>import("./BehaviorIncidents-Dj0ZstCZ.js"),__vite__mapDeps([11,1,2,3,4,5,6,12,13,14,7,8,15,16,17,18,19,20,21,22]))),ml=te(()=>y(()=>import("./StudentGrouping-CN9_hk_e.js"),__vite__mapDeps([23,1,2,3,4,5,6,24,25,26]))),pl={select:"/audio/click-234708.mp3",reward:"/audio/purchase-success-384963.mp3",penalty:"/audio/error-010-206498.mp3"},gl=E(null),bl=E(!1);D(()=>{!function(e){"requestIdleCallback"in window?requestIdleCallback(()=>ve(e),{timeout:2e3}):setTimeout(()=>ve(e),1e3)}(pl);const e=localStorage.getItem("reward-system-bg-music");bl.value="true"===e,gl.value&&(gl.value.volume=.1,bl.value&&gl.value.play().catch(e=>console.log("Autoplay prevented:",e)))}),F(bl,e=>{localStorage.setItem("reward-system-bg-music",e),gl.value&&(e?gl.value.play().catch(e=>console.log("Playback error:",e)):gl.value.pause())});const fl=e=>{!async function(e,a){if(!a[e])return void console.warn(`Sound key "${e}" not found in soundFiles`);if(!ce.has(e)){const t=new Audio(a[e]);await new Promise((e,a)=>{t.addEventListener("canplaythrough",e,{once:!0}),t.addEventListener("error",a,{once:!0}),t.load()}).catch(a=>{console.warn(`Failed to load sound "${e}":`,a)}),ce.set(e,t)}const t=ce.get(e);t&&(t.currentTime=0,t.play().catch(e=>console.log("Sound play error:",e)))}(e,pl)},{t:yl,locale:hl}=z(),xl=e=>e?"ar"===hl.value&&e.name_ar?e.name_ar:e.name:"",wl=T(),_l=U(()=>{var e,a;const t=null==(a=null==(e=wl.props.auth)?void 0:e.user)?void 0:a.school;return Array.isArray(t)&&t.length>0?t[0].logo_url:null}),Sl=U(()=>{const e=new Map;return Vl.value.forEach(a=>{a.subject_id&&!e.has(a.subject_id)&&e.set(a.subject_id,{id:a.subject_id,name:a.subject_name,name_ar:a.subject_name_ar})}),Array.from(e.values())});U(()=>Dl.value?Vl.value.filter(e=>e.subject_id===Dl.value):[]);const kl=U(()=>{const e=zl.value.length;if(0===e)return{present:0,absent:0,absentList:[]};const a=zl.value.filter(e=>Ml.value[e.id]).length;return{present:a,absent:e-a,absentList:zl.value.filter(e=>!Ml.value[e.id])}}),$l=()=>{const e=kl.value.absentList.map(e=>"ar"===hl.value&&e.name_ar?e.name_ar:e.name).join("\n");e&&navigator.clipboard.writeText(e).then(()=>{Il.notify({message:yl("rewardSys.session.copied"),color:"positive",icon:"content_copy",position:"top"})}).catch(e=>{console.error("Failed to copy: ",e)})};E("https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf");const Il=a(),Cl=E(re.initialTab||"positive"),jl=E("positive");F(()=>re.initialTab,e=>{e&&(Cl.value=e)});const Al=E("behavior_incidents");F(Cl,(e,a)=>{localStorage.setItem("reward-system-active-tab",e),e!==a&&(Ll.value=[])});const Vl=E([]),zl=E([]),Pl=E([]),El=E(null),Dl=E(null),Fl=E((new Date).toISOString().split("T")[0]),Tl=E(1),Ul=E(1),ql=E(1),Rl=E(1),Nl=E(null),Bl=E(null),Ll=E([]),Ol=E({}),Ml=E({}),Ql=E({}),Wl=E([]);E([]);const Gl=E(!1),Yl=E(!1),Hl=E(!1),Jl=E(!1),Zl=E(!1),Kl=E(null),Xl=E(null),es=E({message:"",created:0,skipped:0}),as=E(!1),ts=E(!1),ls=E(!1),ss=E("positive"),os=E(null),ns=E("no_groups"),rs=E([]),is=E(!1),ds=E(null),us=E(!1),cs=E(localStorage.getItem("points-display-mode")||"overall"),vs=E({}),ms=E(localStorage.getItem("competition-start-time")||null),ps=E(localStorage.getItem("custom-date-from")||null),gs=E(localStorage.getItem("custom-date-to")||null),bs=E(localStorage.getItem("leaderboard-mode")||"top5"),fs=E(!1),ys=E(null),hs=E(!1),xs=E({name:"",type:"positive",points:0,icon:""});F(Dl,e=>{null!==e&&(localStorage.setItem("reward-system-selected-subject-id",e.toString()),console.log(`üíæ Saved subject to localStorage: ${e}`))}),F(El,e=>{null!==e&&(localStorage.setItem("reward-system-selected-classroom-id",e.toString()),console.log(`üíæ Saved classroom to localStorage: ${e}`))}),F(Tl,e=>{null!==e&&(localStorage.setItem("reward-system-selected-semester",e.toString()),console.log(`üíæ Saved semester to localStorage: ${e}`))}),F(Ul,e=>{null!==e&&(localStorage.setItem("reward-system-selected-week",e.toString()),console.log(`üíæ Saved week to localStorage: ${e}`))}),F(ql,e=>{null!==e&&(localStorage.setItem("reward-system-selected-day",e.toString()),console.log(`üíæ Saved day to localStorage: ${e}`))}),F(Rl,e=>{null!==e&&(localStorage.setItem("reward-system-selected-period-number",e.toString()),console.log(`üíæ Saved period number to localStorage: ${e}`))}),F(Fl,e=>{if(e){const a=new Date(e);ql.value=a.getDay()+1,console.log(`üìÖ Date changed to ${e}, Day updated to ${ql.value}`)}});const ws=U(()=>`${Tl.value}.${Ul.value}.${ql.value}.${Rl.value}`);U(()=>{const e=Vl.value.find(e=>e.classroom_id===El.value);return e?e.classroom_name:yl("rewardSys.session.unknownClass")}),U(()=>{const e=Sl.value.find(e=>e.subject_id===Dl.value);return e?"ar"===hl.value&&e.subject_name_ar?e.subject_name_ar:e.subject_name:""});const _s=U(()=>zl.value.filter(e=>Ml.value[e.id]).length),Ss=U(()=>zl.value.filter(e=>!Ml.value[e.id]).length),ks=E(!1),$s=E("present"),Is=U(()=>zl.value.filter(e=>"present"===$s.value?Ml.value[e.id]:!Ml.value[e.id]));function Cs(e){$s.value=e,ks.value=!0}function js(){const e=Is.value.map(e=>e.name).join("\n");navigator.clipboard.writeText(e).then(()=>{})}function As(e){return e.avatar?e.avatar.startsWith("/")?e.avatar:`/${e.avatar}`:"/images/avatars/default-avatar.svg"}const Vs=U(()=>{console.log("üîç All behaviors:",Pl.value);const e=Pl.value.filter(e=>{if(e.type)return"positive"===e.type||"reward"===e.type;return(e.value||e.points||0)>0});return console.log("‚úÖ Positive behaviors:",e),e}),zs=U(()=>{const e=Pl.value.filter(e=>{if(e.type)return"negative"===e.type||"penalty"===e.type;return(e.value||e.points||0)<0});return console.log("‚ö†Ô∏è Negative behaviors:",e),e}),Ps=U(()=>[{label:"No Groups",value:"no_groups",icon:"grid_view"},{label:"Name (A‚ÜíZ)",value:"name_asc",icon:"sort_by_alpha"},{label:"Name (Z‚ÜíA)",value:"name_desc",icon:"sort_by_alpha"},...rs.value.map(e=>({label:e.name,value:e.id,icon:"groups"}))]);U(()=>{const e=Ps.value.find(e=>e.value===ns.value);return(null==e?void 0:e.icon)||"grid_view"});const Es=U(()=>{if("no_groups"===ns.value)return[{name:null,students:zl.value}];if("name_asc"===ns.value){return[{name:null,students:[...zl.value].sort((e,a)=>(e.firstName||"").localeCompare(a.firstName||""))}]}if("name_desc"===ns.value){return[{name:null,students:[...zl.value].sort((e,a)=>(a.firstName||"").localeCompare(e.firstName||""))}]}const e=rs.value.find(e=>e.id===ns.value);if(!e)return[{name:null,students:zl.value}];const a=e.groups.map(e=>({name:e.name,students:zl.value.filter(a=>e.student_ids.includes(a.id))})),t=new Set(e.groups.flatMap(e=>e.student_ids)),l=zl.value.filter(e=>!t.has(e.id));return l.length>0&&a.push({name:"Unassigned",students:l}),a});function Ds(){const e=zl.value.filter(e=>Ml.value[e.id]);Ll.value=e.map(e=>e.id)}function Fs(){const e=zl.value.filter(e=>Ml.value[e.id]),a=new Set(Ll.value),t=[];e.forEach(e=>{a.has(e.id)||t.push(e.id)}),Ll.value=t}async function Ts(){os.value&&("positive"===ss.value?(Nl.value=os.value,await async function(){await Ys(Nl.value),Nl.value=null}()):(Bl.value=os.value,await Gs()),ls.value=!1,os.value=null)}async function Us(e){var a,t;const l=rs.value.findIndex(a=>a.id===e.id);l>=0?rs.value[l]=e:rs.value.push(e);try{const a=await P.post("/api/classroom-layouts/save",{classroom_id:El.value,layouts:rs.value});if(!a.data.success)throw new Error(a.data.message||"Failed to save layout");Il.notify({message:`Layout "${e.name}" saved successfully!`,color:"positive",position:"top",icon:"check_circle"}),ns.value=e.id,is.value=!1,ds.value=null}catch(s){if(console.error("Error saving layout:",s),Il.notify({message:"Failed to save layout: "+((null==(t=null==(a=s.response)?void 0:a.data)?void 0:t.message)||s.message),color:"negative",position:"top",icon:"error"}),l>=0)rs.value.splice(l,1);else{const a=rs.value.findIndex(a=>a.id===e.id);a>=0&&rs.value.splice(a,1)}}}async function qs(e){var a,t;const l=rs.value.findIndex(a=>a.id===e);if(l<0)return;const s=rs.value[l];rs.value.splice(l,1),ns.value===e&&(ns.value="no_groups");try{const e=await P.post("/api/classroom-layouts/save",{classroom_id:El.value,layouts:rs.value});if(!e.data.success)throw new Error(e.data.message||"Failed to delete layout");Il.notify({message:`Layout "${s.name}" deleted successfully!`,color:"positive",position:"top",icon:"delete"})}catch(o){console.error("Error deleting layout:",o),Il.notify({message:"Failed to delete layout: "+((null==(t=null==(a=o.response)?void 0:a.data)?void 0:t.message)||o.message),color:"negative",position:"top",icon:"error"}),rs.value.splice(l,0,s),"no_groups"===ns.value&&(ns.value=e)}}function Rs(e){e?(ys.value=e,xs.value={name:e.name,type:e.type||(e.value>0?"positive":"negative"),points:e.value||e.points||0,icon:e.icon||""}):(ys.value=null,xs.value={name:"",type:"positive",points:0,icon:""}),fs.value=!0}async function Ns(){var e,a;if(xs.value.name&&xs.value.type&&null!==xs.value.points){hs.value=!0;try{const e={name:xs.value.name,name_ar:xs.value.name_ar||null,type:xs.value.type,value:xs.value.points,points:xs.value.points,icon:xs.value.icon||null,school_id:1,year_id:2};if(ys.value){const a=await P.put(`/api/behaviors/${ys.value.id}`,e),t=Pl.value.findIndex(e=>e.id===ys.value.id);t>=0&&(Pl.value[t]=a.data),Il.notify({message:"Behavior updated successfully!",color:"positive",icon:"check_circle"})}else{const a=await P.post("/api/behaviors",e);Pl.value.push(a.data),Il.notify({message:"Behavior created successfully!",color:"positive",icon:"check_circle"})}fs.value=!1,ys.value=null}catch(t){console.error("Error saving behavior:",t),Il.notify({message:"Failed to save behavior: "+((null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.message)||t.message),color:"negative",icon:"error"})}finally{hs.value=!1}}else Il.notify({message:"Please fill in all required fields",color:"warning",position:"top"})}function Bs(e){Il.dialog({title:"Confirm Delete",message:`Are you sure you want to delete "${e.name}"? This action cannot be undone.`,cancel:!0,persistent:!0,color:"negative"}).onOk(()=>{!async function(e){var a,t;try{await P.delete(`/api/behaviors/${e.id}`);const a=Pl.value.findIndex(a=>a.id===e.id);a>=0&&Pl.value.splice(a,1),Il.notify({message:"Behavior deleted successfully!",color:"positive",icon:"check_circle"})}catch(l){console.error("Error deleting behavior:",l),Il.notify({message:"Failed to delete behavior: "+((null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||l.message),color:"negative",icon:"error"})}}(e)})}function Ls(e){if(!Ml.value[e])return void Il.notify({message:"Cannot select absent students",color:"warning",position:"top",timeout:1e3});const a=Ll.value.indexOf(e);-1===a?(Ll.value.push(e),fl("select")):Ll.value.splice(a,1)}function Os(e,a){if(a){const a=e.filter(e=>Ml.value[e.id]).map(e=>e.id),t=new Set(Ll.value);a.forEach(e=>t.add(e)),Ll.value=Array.from(t),fl("select")}else{const a=new Set(e.map(e=>e.id));Ll.value=Ll.value.filter(e=>!a.has(e))}}function Ms(){Ll.value=[]}async function Qs(e){if(!e)return zl.value=[],Ll.value=[],void(rs.value=[]);try{Yl.value=!0,zl.value=[],Ll.value=[],Xl.value=null,es.value={message:"",created:0,skipped:0},await async function(){if(El.value)try{const e=await P.get("/api/classroom-layouts/load",{params:{classroom_id:El.value}});e.data.success&&(rs.value=e.data.data||[])}catch(e){console.error("Error loading layouts:",e)}}()}catch(a){console.error("Failed to load classroom:",a),Il.notify({message:"Failed to load classroom: "+a.message,color:"negative",position:"top"})}finally{Yl.value=!1}}async function Ws(){if(El.value){Yl.value=!0,es.value={message:"Initializing...",created:0,skipped:0};try{const e={classroom_id:El.value,date:Fl.value,period_code:ws.value,points_mode:"from_now"===cs.value?"overall":cs.value},a=await P.post("/api/student-behaviors/init-classroom",e);if(a&&a.data){const e=a.data;Xl.value=e.student_behaviors_mains_id,es.value={message:`Session initialized (created ${e.created}, skipped ${e.skipped}, mode: ${e.points_mode})`,created:e.created,skipped:e.skipped};const t=e.student_behaviors||[],l=t.map(e=>e.student?{id:e.student.id,name:e.student.name||`Student ${e.student_id}`,name_ar:e.student.name_ar,firstName:e.student.first_name,secondName:e.student.second_name,lastName:e.student.last_name,avatar:e.student.avatar,behaviorRecordId:e.id}:null).filter(e=>null!==e);zl.value=l,Ll.value=[];const s={};for(const a of t)Ml.value[a.student_id]=void 0===a.attend||a.attend,s[a.student_id]={attend:void 0===a.attend||a.attend,points_plus:a.points_plus||0,points_minus:a.points_minus||0};Ol.value=s,Il.notify({message:"Session initialized",color:"positive",position:"top"}),await Ks()}}catch(e){console.error("Failed to init classroom session:",e),es.value={message:"Initialization failed",created:0,skipped:0},Il.notify({message:"Failed to init session: "+(e.message||"error"),color:"negative",position:"top"})}finally{Yl.value=!1}}}async function Gs(){await Ys(Bl.value),Bl.value=null}async function Ys(e){if(Ll.value.length&&e)try{Hl.value=!0;const a=await ue.applyBehaviorToStudents(Ll.value,e,{date:Fl.value,periodCode:ws.value,classroomId:El.value});if(a.results&&a.results.length>0){a.results.forEach(e=>{if(e.success&&e.data){const a=e.studentId,t=e.data;Ol.value[a]||(Ol.value[a]={points_plus:0,points_minus:0,attend:!0}),Ol.value[a]&&(Ol.value[a].points_plus=t.points_plus,Ol.value[a].points_minus=t.points_minus,void 0!==t.attend&&(Ol.value[a].attend=t.attend,Ml.value[a]=t.attend))}});const t=Pl.value.find(a=>a.id===e);if(t){const e=t.value||t.points||0;e>0&&fl("reward"),e<0&&fl("penalty")}Il.notify({message:`Applied behavior to ${a.results.length} students`+(a.errors&&a.errors.length?` (${a.errors.length} failed)`:""),color:a.errors&&a.errors.length?"warning":"positive",position:"top"}),await Ks(),Ll.value=[]}a.errors&&a.errors.length>0&&(console.error("Partial or full failure:",a.errors),0===a.results.length&&Il.notify({message:a.error||"Failed to apply behavior to selected students",color:"negative",position:"top"}))}catch(a){console.error("Error applying behavior:",a),Il.notify({message:a.message||"Error applying behavior",color:"negative",position:"top"})}finally{Hl.value=!1}}async function Hs(e,a,t){Ml.value[e]=a,Ql.value[e]=!0,fl("select");try{const t=await ue.updateAttendance(e,a,{date:Fl.value,periodCode:ws.value,classroomId:El.value});if(!t.success)throw new Error(t.error||"Failed to update attendance");Il.notify({message:t.message||"Attendance updated",color:"positive",position:"top"}),!1===a&&await Ws()}catch(l){console.error("Failed to persist attendance for",e,l),Ml.value[e]=t,Il.notify({message:"Failed to update attendance. Reverted.",color:"negative",position:"top"})}finally{Ql.value[e]=!1}}async function Js(){Jl.value=!0;const e={};for(const t of zl.value)e[t.id]=!0,Ml.value[t.id]=!0;try{(await ue.batchUpdateAttendance(e,{date:Fl.value,periodCode:ws.value,classroomId:El.value})).success&&Il.notify({message:"All students marked present",color:"positive",position:"top"})}catch(a){console.error("Failed to mark all present:",a),Il.notify({message:"Failed to mark all present",color:"negative",position:"top"})}finally{Jl.value=!1}}async function Zs(){Jl.value=!0;const e={};for(const t of zl.value)e[t.id]=!1,Ml.value[t.id]=!1;try{(await ue.batchUpdateAttendance(e,{date:Fl.value,periodCode:ws.value,classroomId:El.value})).success&&Il.notify({message:"All students marked absent",color:"warning",position:"top"})}catch(a){console.error("Failed to mark all absent:",a),Il.notify({message:"Failed to mark all absent",color:"negative",position:"top"})}finally{Jl.value=!1}}async function Ks(){Zl.value=!0;try{const e=await ue.getRecentActions({classroomId:El.value,date:Fl.value,limit:10});e.success?Wl.value=e.data:console.error("Failed to load history:",e.error)}catch(e){console.error("Error loading history:",e)}finally{Zl.value=!1}}function Xs(e){if(!e)return"";return new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function eo(){localStorage.setItem("points-display-mode",cs.value),ms.value?localStorage.setItem("competition-start-time",ms.value):localStorage.removeItem("competition-start-time"),ps.value&&localStorage.setItem("custom-date-from",ps.value),gs.value&&localStorage.setItem("custom-date-to",gs.value),localStorage.setItem("leaderboard-mode",bs.value),us.value=!1,El.value&&Ws(),Il.notify({message:"Points display settings applied",color:"positive",position:"top",icon:"check_circle"})}function ao(){cs.value="overall",ms.value=null,ps.value=null,gs.value=null,bs.value="top5",localStorage.removeItem("points-display-mode"),localStorage.removeItem("competition-start-time"),localStorage.removeItem("custom-date-from"),localStorage.removeItem("custom-date-to"),localStorage.removeItem("leaderboard-mode"),us.value=!1,El.value&&Ws(),Il.notify({message:"Reset to normal view",color:"info",position:"top"})}async function to(e){console.log("Incident recorded:",e),await Ws(),Il.notify({message:"Behavior incident recorded (-1 point)",color:"warning",position:"top"})}return F(cs,e=>{if("from_now"===e){const e={};for(const[a,t]of Object.entries(Ol.value))e[a]={plus:t.points_plus||0,minus:t.points_minus||0};vs.value=e}else Ws()}),D(async()=>{var e,a;if(as.value)console.log("‚è≠Ô∏è Skipping re-initialization - component already initialized");else try{console.log("üöÄ Initializing reward system...");const l=await P.get("/my_classes_with_students");Vl.value=l.data,console.log(`‚úÖ Loaded ${Vl.value.length} classrooms`);let s=!1;if(re.classroomId&&re.subjectId){console.log("üéØ Props detected (dialog mode) - auto-initializing..."),El.value=re.classroomId,Dl.value=re.subjectId;try{const t=null==(a=null==(e=T().props.auth)?void 0:e.school)?void 0:a.active_semester_id;t?(Tl.value=parseInt(t),console.log(`üè´ Active Semester from Inertia: ${Tl.value}`)):Tl.value=1}catch(t){console.warn("Could not fetch active semester, defaulting to 1",t),Tl.value=1}re.date?Fl.value=re.date:Fl.value=(new Date).toISOString().split("T")[0];const l=new Date(Fl.value);ql.value=l.getDay()+1,re.period&&(Rl.value=re.period),re.week&&(Ul.value=re.week,console.log(`üìÖ Props Week: ${re.week}`)),s=!0,console.log(`üìö Props Subject: ${re.subjectId}`),console.log(`üè´ Props Classroom: ${re.classroomId}`),console.log(`üìÖ Props Date: ${Fl.value}`),console.log(`‚ö° Calc Day: ${ql.value}`),console.log(`üî¢ Props Period: ${re.period}`)}else{const e=new URLSearchParams(window.location.search),a=e.get("classroom_id"),t=e.get("subject_id"),l=e.get("period"),o=e.get("date");if(a&&t)console.log("üîó URL parameters detected - auto-initializing..."),El.value=parseInt(a),Dl.value=parseInt(t),Fl.value=o||(new Date).toISOString().split("T")[0],l&&(Rl.value=parseInt(l)),s=!0,console.log(`üìö URL Subject: ${t}`),console.log(`üè´ URL Classroom: ${a}`),console.log(`üìÖ URL Date: ${Fl.value}`),console.log(`üî¢ URL Period: ${l}`);else{const e=localStorage.getItem("reward-system-selected-subject-id"),a=localStorage.getItem("reward-system-selected-classroom-id");e&&Sl.value.some(a=>a.id===parseInt(e))?(Dl.value=parseInt(e),console.log(`üìö Restored subject from localStorage: ${e}`)):Sl.value.length>0&&(Dl.value=Sl.value[0].id,console.log(`üìö Auto-selected first subject: ${Sl.value[0].name}`)),a&&Vl.value.some(e=>e.classroom_id===parseInt(a))&&(El.value=parseInt(a),console.log(`üè´ Restored classroom from localStorage: ${a}`));const t=localStorage.getItem("reward-system-active-tab");t&&(Cl.value=t);const l=localStorage.getItem("reward-system-selected-semester"),s=localStorage.getItem("reward-system-selected-week"),o=localStorage.getItem("reward-system-selected-day"),n=localStorage.getItem("reward-system-selected-period-number");l&&(Tl.value=parseInt(l),console.log(`üìÖ Restored semester from localStorage: ${l}`)),s&&(Ul.value=parseInt(s),console.log(`üìÖ Restored week from localStorage: ${s}`)),o&&(ql.value=parseInt(o),console.log(`üìÖ Restored day from localStorage: ${o}`)),n&&(Rl.value=parseInt(n),console.log(`üìÖ Restored period number from localStorage: ${n}`))}}console.log(`üî¢ Active Period Code: ${Tl.value}.${Ul.value}.${ql.value}.${Rl.value}`);const o=await ue.fetchBehaviors();o.success?(Pl.value=o.data,console.log(`‚úÖ Loaded ${Pl.value.length} behaviors`),console.log("üìã Behaviors data:",Pl.value),Pl.value=Pl.value.map(e=>({...e,value:e.value||e.points||0})),console.log("üìã Normalized behaviors:",Pl.value)):(console.error("‚ùå Failed to load behaviors:",o.error),Il.notify({message:"Failed to load behaviors: "+o.error,color:"negative",position:"top"})),console.log("‚úÖ Reward system initialized"),as.value=!0,s&&El.value&&(console.log("üöÄ Auto-initializing classroom session..."),await Qs(El.value),await Ws(),Il.notify({message:re.isDialog?"Session loaded!":"Session loaded from schedule!",color:"positive",position:"top",icon:"stars"}))}catch(l){console.error("‚ùå Failed to initialize reward system:",l),Il.notify({message:"Failed to initialize reward system: "+l.message,color:"negative",position:"top"})}}),(a,y)=>{const z=q("Head");return N(),R(J,null,[B(z,{title:"Reward System"}),L("div",me,[y[64]||(y[64]=L("div",{class:"p-1 scale-25"},null,-1)),e.isDialog?M("",!0):(N(),O(r,{key:0,class:"shadow-lg rounded-2xl overflow-hidden"},{default:Q(()=>[B(t,{class:"bg-gradient-to-r from-blue-500 to-indigo-600 text-white flex justify-between items-center"},{default:Q(()=>[L("div",null,[L("h1",pe,"üèÜ "+W(a.$t("rewardSys.behaviors.management")),1),L("p",ge,W(a.$t("rewardSys.behaviors.management")),1)]),B(S,{modelValue:G(hl),"onUpdate:modelValue":y[0]||(y[0]=e=>Y(hl)?hl.value=e:null),options:[{label:"üá¨üáß English",value:"en"},{label:"üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©",value:"ar"}],flat:"",color:"white","text-color":"white","toggle-color":"white","toggle-text-color":"primary",unelevated:""},null,8,["modelValue"])]),_:1}),B(t,{class:"p-6 space-y-4"},{default:Q(()=>{var e;return[L("div",be,[L("div",fe,[L("div",ye,[B(l,{name:"event_note",size:"md"})]),L("div",null,[L("div",he,W(a.$t("rewardSys.session.current")),1),L("div",xe,[El.value?(N(),R("span",we,W((null==(e=Vl.value.find(e=>e.classroom_id===El.value))?void 0:e.classroom_name)||a.$t("rewardSys.session.unknownClass")),1)):(N(),R("span",_e,W(a.$t("rewardSys.session.noClassroom")),1)),y[41]||(y[41]=L("span",{class:"text-gray-300"},"|",-1)),L("span",Se,W(ws.value),1)]),L("div",ke,W(new Date(Fl.value).toLocaleDateString())+" ‚Ä¢ Period "+W(Rl.value),1)])])]),El.value?(N(),R("div",$e,[L("div",Ie,[L("div",Ce,[B(l,{name:"groups",class:"text-blue-600",size:"sm"}),L("span",je,W(a.$t("rewardSys.session.classroomSummary")),1)]),L("div",Ae,[B(s,{modelValue:ts.value,"onUpdate:modelValue":y[1]||(y[1]=e=>ts.value=e),icon:"edit",label:"Edit Avatars",dense:"",color:"secondary",size:"sm",class:"bg-white px-2 py-1 rounded-lg border border-gray-200"},null,8,["modelValue"]),es.value.message?(N(),R("div",Ve,W(es.value.message)+" ("+W(es.value.created)+") ",1)):M("",!0),L("div",ze,[B(l,{name:"people",class:"text-blue-600",size:"sm"}),L("div",Pe,[L("span",Ee,W(a.$t("rewardSys.session.total")),1),L("span",De,W(zl.value.length),1)])]),L("div",Fe,[B(l,{name:"check_circle",class:"text-green-600",size:"sm"}),L("div",Te,[L("span",Ue,W(a.$t("rewardSys.session.present")),1),L("span",qe,W(kl.value.present),1)])]),L("div",Re,[B(l,{name:"cancel",class:"text-red-600",size:"sm"}),L("div",Ne,[L("span",Be,W(a.$t("rewardSys.session.absent")),1),L("span",Le,W(kl.value.absent),1)])]),B(o,{dense:"",color:"primary",icon:"content_copy",label:a.$t("rewardSys.session.copyList"),onClick:$l,disable:0===kl.value.absent,size:"sm",class:"shadow-sm"},{default:Q(()=>[B(n,null,{default:Q(()=>[H(W(a.$t("rewardSys.session.copyToClipboard")),1)]),_:1})]),_:1},8,["label","disable"])])]),kl.value.absent>0?(N(),R("div",Oe,[L("div",Me,[B(l,{name:"person_off",size:"xs",color:"red"}),L("span",null,W(a.$t("rewardSys.session.absentStudentsList")),1),B(k,{color:"red",label:kl.value.absent,class:"ml-1"},null,8,["label"])]),L("div",Qe,[L("div",We,[(N(!0),R(J,null,Z(kl.value.absentList,e=>(N(),O(h,{key:e.id,color:"red","text-color":"white",size:"sm",dense:"",icon:"person"},{default:Q(()=>[H(W("ar"===G(hl)&&e.name_ar?e.name_ar:e.name),1)]),_:2},1024))),128))])])])):M("",!0)])):M("",!0)]}),_:1})]),_:1})),L("audio",{ref_key:"bgMusic",ref:gl,loop:"",id:"bg-music"},y[42]||(y[42]=[L("source",{src:"/audio/background_music2.mp3",type:"audio/mpeg"},null,-1)]),512),zl.value.length?(N(),O(r,{key:1,class:"shadow-lg rounded-2xl"},{default:Q(()=>[L("div",Ge,[L("div",Ye,[B(v,{color:"primary",icon:"menu",label:"Menu",class:"shadow-sm glossy","content-class":"bg-white"},{default:Q(()=>[L("div",He,[L("div",Je,[y[48]||(y[48]=L("div",{class:"text-subtitle1 text-weight-bold q-mb-sm text-grey-8"},"Navigation",-1)),B(i,{dense:""},{default:Q(()=>[K((N(),O(d,{clickable:"",onClick:y[2]||(y[2]=e=>Cl.value="positive"),active:"positive"===Cl.value,"active-class":"bg-blue-50 text-primary"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"add_circle"})]),_:1}),B(u,null,{default:Q(()=>[H(W(a.$t("rewardSys.tabs.positivePoints")),1)]),_:1})]),_:1},8,["active"])),[[x]]),K((N(),O(d,{clickable:"",onClick:y[3]||(y[3]=e=>Cl.value="attendance"),active:"attendance"===Cl.value,"active-class":"bg-blue-50 text-primary"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"how_to_reg"})]),_:1}),B(u,null,{default:Q(()=>[H(W(a.$t("rewardSys.tabs.attendance")),1)]),_:1})]),_:1},8,["active"])),[[x]]),K((N(),O(d,{clickable:"",onClick:y[4]||(y[4]=e=>Cl.value="history"),active:"history"===Cl.value,"active-class":"bg-blue-50 text-primary"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"cancel"})]),_:1}),B(u,null,{default:Q(()=>[H(W(a.$t("rewardSys.tabs.history")),1)]),_:1})]),_:1},8,["active"])),[[x]]),K((N(),O(d,{clickable:"",onClick:y[5]||(y[5]=e=>{Gl.value=!0,Cl.value="champions"}),active:"champions"===Cl.value,"active-class":"bg-blue-50 text-primary"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"emoji_events"})]),_:1}),B(u,null,{default:Q(()=>[H(W(a.$t("rewardSys.tabs.champions")),1)]),_:1})]),_:1},8,["active"])),[[x]]),K((N(),O(d,{clickable:"",onClick:y[6]||(y[6]=e=>Cl.value="settings_reports"),active:"settings_reports"===Cl.value,"active-class":"bg-blue-50 text-primary"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"settings_applications"})]),_:1}),B(u,null,{default:Q(()=>[H(W(a.$t("rewardSys.tabs.settingsReports")),1)]),_:1})]),_:1},8,["active"])),[[x]])]),_:1}),B(c,{class:"q-my-md"}),y[49]||(y[49]=L("div",{class:"text-subtitle2 text-grey-7 q-mb-xs"},"Points Filter",-1)),B(i,{dense:""},{default:Q(()=>[K((N(),O(d,{clickable:"",onClick:y[7]||(y[7]=e=>cs.value="overall"),active:"overall"===cs.value,"active-class":"text-orange-9 text-weight-bold"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"functions",size:"xs"})]),_:1}),B(u,null,{default:Q(()=>y[43]||(y[43]=[H("Overall (All Time)")])),_:1}),"overall"===cs.value?(N(),O(u,{key:0,side:""},{default:Q(()=>[B(l,{name:"check",size:"xs",color:"orange"})]),_:1})):M("",!0)]),_:1},8,["active"])),[[x]]),K((N(),O(d,{clickable:"",onClick:y[8]||(y[8]=e=>cs.value="all_subjects"),active:"all_subjects"===cs.value,"active-class":"text-orange-9 text-weight-bold"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"public",size:"xs"})]),_:1}),B(u,null,{default:Q(()=>y[44]||(y[44]=[H("Overall (All Subjects)")])),_:1}),"all_subjects"===cs.value?(N(),O(u,{key:0,side:""},{default:Q(()=>[B(l,{name:"check",size:"xs",color:"orange"})]),_:1})):M("",!0)]),_:1},8,["active"])),[[x]]),K((N(),O(d,{clickable:"",onClick:y[9]||(y[9]=e=>cs.value="session"),active:"session"===cs.value,"active-class":"text-orange-9 text-weight-bold"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"timer",size:"xs"})]),_:1}),B(u,null,{default:Q(()=>y[45]||(y[45]=[H("This Session")])),_:1}),"session"===cs.value?(N(),O(u,{key:0,side:""},{default:Q(()=>[B(l,{name:"check",size:"xs",color:"orange"})]),_:1})):M("",!0)]),_:1},8,["active"])),[[x]]),K((N(),O(d,{clickable:"",onClick:y[10]||(y[10]=e=>cs.value="competition"),active:"competition"===cs.value,"active-class":"text-orange-9 text-weight-bold"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"date_range",size:"xs"})]),_:1}),B(u,null,{default:Q(()=>y[46]||(y[46]=[H("Competition (Week)")])),_:1}),"competition"===cs.value?(N(),O(u,{key:0,side:""},{default:Q(()=>[B(l,{name:"check",size:"xs",color:"orange"})]),_:1})):M("",!0)]),_:1},8,["active"])),[[x]]),K((N(),O(d,{clickable:"",onClick:y[11]||(y[11]=e=>cs.value="from_now"),active:"from_now"===cs.value,"active-class":"text-orange-9 text-weight-bold"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"restart_alt",size:"xs"})]),_:1}),B(u,null,{default:Q(()=>y[47]||(y[47]=[H("From Now (Reset View)")])),_:1}),"from_now"===cs.value?(N(),O(u,{key:0,side:""},{default:Q(()=>[B(l,{name:"check",size:"xs",color:"orange"})]),_:1})):M("",!0)]),_:1},8,["active"])),[[x]])]),_:1}),B(c,{class:"q-my-md"}),y[50]||(y[50]=L("div",{class:"text-subtitle2 text-grey-7 q-mb-xs"},"Layout",-1)),B(i,{dense:""},{default:Q(()=>[(N(!0),R(J,null,Z(Ps.value,e=>K((N(),O(d,{clickable:"",key:e.value,onClick:a=>ns.value=e.value,active:ns.value===e.value,"active-class":"text-orange-9 text-weight-bold"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:e.icon,size:"xs"},null,8,["name"])]),_:2},1024),B(u,null,{default:Q(()=>[H(W(e.label),1)]),_:2},1024),ns.value===e.value?(N(),O(u,{key:0,side:""},{default:Q(()=>[B(l,{name:"check",size:"xs",color:"orange"})]),_:1})):M("",!0)]),_:2},1032,["onClick","active"])),[[x]])),128)),B(c,{class:"q-my-xs"}),K((N(),O(d,{clickable:"",onClick:y[12]||(y[12]=e=>is.value=!0)},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"settings",size:"xs",class:"text-grey-7"})]),_:1}),B(u,{class:"text-grey-8"},{default:Q(()=>[H(W(a.$t("rewardSys.manageGroups")),1)]),_:1})]),_:1})),[[x]])]),_:1})]),B(c,{vertical:"",inset:"",class:"q-mx-lg"}),L("div",Ze,[y[51]||(y[51]=L("div",{class:"text-subtitle1 text-weight-bold q-mb-md text-grey-8"},"Settings",-1)),L("div",Ke,[B(s,{modelValue:bl.value,"onUpdate:modelValue":y[13]||(y[13]=e=>bl.value=e),"checked-icon":"music_note","unchecked-icon":"music_off",label:"Music On",color:"primary",dense:""},null,8,["modelValue"]),B(s,{modelValue:ts.value,"onUpdate:modelValue":y[14]||(y[14]=e=>ts.value=e),icon:"edit",label:"Edit Avatars",color:"secondary",dense:""},null,8,["modelValue"])]),B(c,{class:"q-my-md full-width"}),L("div",Xe,[B(ne,{class:"scale-90 transform-origin-center"})]),B(c,{class:"q-my-md full-width"})])])]),_:1}),L("div",ea,[B(k,{color:"blue-1","text-color":"blue-9",class:"q-py-xs q-px-sm text-subtitle2"},{default:Q(()=>[H(W("positive"===Cl.value?a.$t("rewardSys.tabs.positivePoints"):"attendance"===Cl.value?a.$t("rewardSys.tabs.attendance"):"history"===Cl.value?a.$t("rewardSys.tabs.history"):"champions"===Cl.value?a.$t("rewardSys.tabs.champions"):a.$t("rewardSys.tabs.settingsReports")),1)]),_:1}),"positive"===Cl.value?(N(),O(k,{key:0,color:"orange-1","text-color":"orange-9",class:"q-py-xs q-px-sm"},{default:Q(()=>[H(" Filter: "+W("overall"===cs.value?"Overall":"session"===cs.value?"Session":"Week/Comp"),1)]),_:1})):M("",!0)])])]),B(c),B(A,{modelValue:Cl.value,"onUpdate:modelValue":y[24]||(y[24]=e=>Cl.value=e),animated:""},{default:Q(()=>[B($,{name:"attendance"},{default:Q(()=>[L("div",aa,[L("div",ta,[L("h3",la,W(a.$t("rewardSys.attendance.manage")),1),L("div",sa,[B(o,{color:"positive",label:a.$t("rewardSys.attendance.markAllPresent"),onClick:Js,loading:Jl.value},null,8,["label","loading"]),B(o,{color:"warning",label:a.$t("rewardSys.attendance.markAllAbsent"),onClick:Zs,loading:Jl.value},null,8,["label","loading"])])]),L("div",oa,[(N(!0),R(J,null,Z(zl.value,e=>{var a,t,l,s;return N(),O(oe,{key:e.id,student:e,"disable-behavior":!Ml.value[e.id],"allow-disabled-click":!0,"avatar-edit-enabled":ts.value,"student-summary":{positive:((null==(a=Ol.value[e.id])?void 0:a.points_plus)||0)-("from_now"===cs.value&&vs.value[e.id]?vs.value[e.id].plus:0),negative:((null==(t=Ol.value[e.id])?void 0:t.points_minus)||0)-("from_now"===cs.value&&vs.value[e.id]?vs.value[e.id].minus:0),total:((null==(l=Ol.value[e.id])?void 0:l.points_plus)||0)-("from_now"===cs.value&&vs.value[e.id]?vs.value[e.id].plus:0)-(((null==(s=Ol.value[e.id])?void 0:s.points_minus)||0)-("from_now"===cs.value&&vs.value[e.id]?vs.value[e.id].minus:0))},onSelect:a=>async function(e){const a=void 0===Ml.value[e]||Ml.value[e],t=!a;if(!1===t){const l=Ol.value[e];if(l&&(l.points_plus>0||l.points_minus>0))return void Il.dialog({title:"Warning",message:`This student has ${l.points_plus} positive and ${l.points_minus} negative points for this session. Marking them absent will remove all their points for this session. Continue?`,cancel:!0,persistent:!0,ok:{label:"Yes, Mark Absent",color:"negative"},cancel:{label:"Cancel",color:"grey"}}).onOk(async()=>{await Hs(e,t,a)})}await Hs(e,t,a)}(e.id)},null,8,["student","disable-behavior","avatar-edit-enabled","student-summary","onSelect"])}),128))])])]),_:1}),B($,{name:"positive"},{default:Q(()=>[L("div",na,[L("div",ra,[L("div",ia,[L("div",da,[L("div",ua,[B(l,{name:"checklist",class:"text-blue-600",size:"sm"}),L("span",ca,W(a.$t("rewardSys.selected"))+": ",1),B(k,{label:Ll.value.length,color:"blue",class:"text-lg"},null,8,["label"])]),L("div",va,[B(o,{flat:"",dense:"",color:"primary",label:a.$t("rewardSys.selection.all"),size:"sm",onClick:Ds,icon:"check_box",class:"bg-blue-100/50"},null,8,["label"]),B(o,{flat:"",dense:"",color:"primary",label:a.$t("rewardSys.selection.inv"),size:"sm",onClick:Fs,icon:"swap_vert",class:"bg-blue-100/50"},null,8,["label"]),B(o,{flat:"",dense:"",color:"negative",label:a.$t("rewardSys.selection.clear"),size:"sm",onClick:Ms,icon:"clear",class:"bg-red-100/50"},null,8,["label"]),B(o,{flat:"",dense:"",color:"negative",label:a.$t("rewardSys.selection.clear"),size:"sm",onClick:Ms,icon:"clear",class:"bg-red-100/50"},null,8,["label"]),(N(),O(X,{to:"#dialog-header-actions"},[L("div",ma,[B(o,{rounded:"",dense:"","no-caps":"",color:"positive",class:"px-3 shadow-sm",onClick:y[15]||(y[15]=e=>Cs("present"))},{default:Q(()=>[B(l,{name:"check_circle",class:"mr-1",size:"xs"}),L("span",pa,W(_s.value),1)]),_:1}),B(o,{rounded:"",dense:"","no-caps":"",color:"negative",class:"px-3 shadow-sm",onClick:y[16]||(y[16]=e=>Cs("absent"))},{default:Q(()=>[B(l,{name:"cancel",class:"mr-1",size:"xs"}),L("span",ga,W(Ss.value),1)]),_:1})])])),B(c,{vertical:"",inset:"",class:"mx-2"}),B(m,{modelValue:ks.value,"onUpdate:modelValue":y[17]||(y[17]=e=>ks.value=e)},{default:Q(()=>[B(r,{style:{"min-width":"350px"}},{default:Q(()=>[B(t,{class:"row items-center"},{default:Q(()=>[L("div",ba,[H(W("present"===$s.value?"Present Students":"Absent Students")+" ",1),B(k,{color:"present"===$s.value?"positive":"negative",class:"ml-2"},{default:Q(()=>[H(W(Is.value.length),1)]),_:1},8,["color"])]),B(I),K(B(o,{icon:"close",flat:"",round:"",dense:""},null,512),[[x]])]),_:1}),B(t,{class:"q-pt-none",style:{"max-height":"50vh","overflow-y":"auto"}},{default:Q(()=>[0===Is.value.length?(N(),R("div",fa," No students found. ")):(N(),O(i,{key:1,bordered:"",separator:"",class:"rounded-lg"},{default:Q(()=>[(N(!0),R(J,null,Z(Is.value,e=>(N(),O(d,{key:e.id},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(w,{size:"sm"},{default:Q(()=>[L("img",{src:As(e)},null,8,ya)]),_:2},1024)]),_:2},1024),B(u,null,{default:Q(()=>[H(W(e.name),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1}),B(p,{align:"right",class:"bg-gray-50"},{default:Q(()=>[K(B(o,{flat:"",label:"Close",color:"primary"},null,512),[[x]]),B(o,{label:"Copy List",color:"primary",icon:"content_copy",onClick:js,disable:0===Is.value.length},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),B(v,{color:"primary",icon:"stars",label:"Give Feedback",disable:0===Ll.value.length,class:"shadow-sm","content-class":"rounded-xl"},{default:Q(()=>[L("div",ha,[B(j,{modelValue:jl.value,"onUpdate:modelValue":y[18]||(y[18]=e=>jl.value=e),class:"text-grey-7 bg-grey-1","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":"",dense:""},{default:Q(()=>[B(C,{name:"positive",icon:"thumb_up",label:"Positive",class:"text-weight-bold"}),B(C,{name:"needs_work",icon:"warning",label:"Needs Work",class:"text-weight-bold"})]),_:1},8,["modelValue"]),B(c),B(A,{modelValue:jl.value,"onUpdate:modelValue":y[19]||(y[19]=e=>jl.value=e),animated:"",class:"bg-white",style:{"max-height":"400px","overflow-y":"auto"}},{default:Q(()=>[B($,{name:"positive",class:"q-pa-md"},{default:Q(()=>[L("div",xa,[(N(!0),R(J,null,Z(Vs.value,e=>(N(),R("div",{class:"col-4 cursor-pointer",key:e.id,onClick:a=>Ys(e.id)},[K((N(),R("div",_a,[B(l,{name:e.icon||"star",size:"2em",class:"q-mb-xs text-orange"},null,8,["name"]),L("div",Sa,W(e.name),1),L("div",ka,[B(k,{color:"green-1","text-color":"green-9",class:"text-xs font-bold border border-green-200 shadow-sm rounded-full px-1.5"},{default:Q(()=>[H("+"+W(e.points||e.value),1)]),_:2},1024)])])),[[x]])],8,wa))),128))])]),_:1}),B($,{name:"needs_work",class:"q-pa-md"},{default:Q(()=>[L("div",$a,[(N(!0),R(J,null,Z(zs.value,e=>(N(),R("div",{class:"col-4 cursor-pointer",key:e.id,onClick:a=>Ys(e.id)},[K((N(),R("div",Ca,[B(l,{name:e.icon||"warning",size:"2em",class:"q-mb-xs text-red"},null,8,["name"]),L("div",ja,W(e.name),1),L("div",Aa,[B(k,{color:"red-1","text-color":"red-9",class:"text-xs font-bold border border-red-200 shadow-sm rounded-full px-1.5"},{default:Q(()=>[H(W(e.points||e.value),1)]),_:2},1024)])])),[[x]])],8,Ia))),128))])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["disable"])])])]),(N(!0),R(J,null,Z(Es.value,(e,t)=>(N(),R("div",{key:t,class:"mb-6 bg-gray-400"},[e.name?(N(),R("div",Va,[L("div",za,[L("h4",Pa,[B(l,{name:"groups"}),H(" "+W(e.name)+" ",1),B(k,{label:e.students.length,color:"indigo"},null,8,["label"])]),L("div",Ea,[B(o,{dense:"",size:"sm",color:"indigo",icon:"check_box",label:a.$t("rewardSys.selection.all"),onClick:a=>Os(e.students,!0),outline:""},null,8,["label","onClick"]),B(o,{dense:"",size:"sm",color:"grey",icon:"check_box_outline_blank",label:a.$t("rewardSys.selection.clear"),onClick:a=>Os(e.students,!1),outline:""},null,8,["label","onClick"])])])])):M("",!0),L("div",Da,[(N(!0),R(J,null,Z(e.students,e=>{var a,t,l,s;return N(),O(oe,{key:e.id,student:e,selected:Ll.value.includes(e.id),"selected-id":Ll.value.includes(e.id)?e.id:null,"disable-behavior":!Ml.value[e.id],"is-absent":!Ml.value[e.id],"allow-disabled-click":!1,"avatar-edit-enabled":ts.value,"student-summary":{positive:((null==(a=Ol.value[e.id])?void 0:a.points_plus)||0)-("from_now"===cs.value&&vs.value[e.id]?vs.value[e.id].plus:0),negative:((null==(t=Ol.value[e.id])?void 0:t.points_minus)||0)-("from_now"===cs.value&&vs.value[e.id]?vs.value[e.id].minus:0),total:((null==(l=Ol.value[e.id])?void 0:l.points_plus)||0)-("from_now"===cs.value&&vs.value[e.id]?vs.value[e.id].plus:0)-(((null==(s=Ol.value[e.id])?void 0:s.points_minus)||0)-("from_now"===cs.value&&vs.value[e.id]?vs.value[e.id].minus:0))},onSelect:a=>Ls(e.id)},null,8,["student","selected","selected-id","disable-behavior","is-absent","avatar-edit-enabled","student-summary","onSelect"])}),128))])]))),128))])])]),_:1}),B($,{name:"negative"},{default:Q(()=>[L("div",Fa,[L("div",Ta,[L("h3",Ua,W(a.$t("rewardSys.points.deduct")),1),L("p",qa,W(a.$t("rewardSys.points.selectStudentsNegative")),1)]),L("div",Ra,[L("div",Na,[B(V,{modelValue:Bl.value,"onUpdate:modelValue":y[20]||(y[20]=e=>Bl.value=e),options:zs.value,"option-value":"id","option-label":"name",outlined:"",dense:"",placeholder:a.$t("rewardSys.points.selectNegativeBehavior"),"emit-value":"","map-options":""},{option:Q(e=>[B(d,ee(ae(e.itemProps)),{default:Q(()=>[B(u,null,{default:Q(()=>[B(g,null,{default:Q(()=>[H(W(xl(e.opt)),1)]),_:2},1024),B(g,{caption:""},{default:Q(()=>[H(W(e.opt.value||e.opt.points||0)+" points",1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","placeholder"]),B(o,{color:"negative",icon:"remove_circle",label:a.$t("rewardSys.points.applyToSelected"),onClick:Gs,disable:!Ll.value.length||!Bl.value,loading:Hl.value},null,8,["label","disable","loading"])]),L("div",Ba,[y[52]||(y[52]=H("Selected: ")),L("strong",null,W(Ll.value.length),1),y[53]||(y[53]=H(" students"))])]),L("div",La,[(N(!0),R(J,null,Z(zl.value,e=>{var a,t,l,s;return N(),O(oe,{key:e.id,student:e,selected:Ll.value.includes(e.id),"selected-id":Ll.value.includes(e.id)?e.id:null,"disable-behavior":!Ml.value[e.id],"allow-disabled-click":!1,"avatar-edit-enabled":ts.value,"student-summary":{positive:(null==(a=Ol.value[e.id])?void 0:a.points_plus)||0,negative:(null==(t=Ol.value[e.id])?void 0:t.points_minus)||0,total:((null==(l=Ol.value[e.id])?void 0:l.points_plus)||0)-((null==(s=Ol.value[e.id])?void 0:s.points_minus)||0)},onSelect:a=>Ls(e.id)},null,8,["student","selected","selected-id","disable-behavior","avatar-edit-enabled","student-summary","onSelect"])}),128))])])]),_:1}),B($,{name:"old_card"},{default:Q(()=>[L("div",Oa,[y[57]||(y[57]=L("h3",{class:"text-xl font-bold mb-4"},"Old Card View",-1)),L("div",Ma,[(N(!0),R(J,null,Z(zl.value,e=>{var a,t,l,s;return N(),R("div",{key:e.id,class:le(["p-4 border-2 rounded-lg transition",[Ml.value[e.id]?Ll.value.includes(e.id)?"bg-green-100 border-green-500 cursor-pointer":"bg-white border-gray-200 cursor-pointer":"bg-gray-100 border-gray-300 opacity-50 cursor-not-allowed"]]),onClick:a=>Ml.value[e.id]&&Ls(e.id)},[L("div",Wa,[L("div",Ga,[L("p",Ya,W(e.name),1),L("p",Ha,"ID: "+W(e.id),1),Ml.value[e.id]?M("",!0):(N(),R("p",Ja,"‚ùå Absent"))]),B(_,{"model-value":Ll.value.includes(e.id),"onUpdate:modelValue":a=>Ls(e.id),disable:!Ml.value[e.id],color:"positive",size:"lg"},null,8,["model-value","onUpdate:modelValue","disable"])]),L("div",Za,[L("div",Ka,[y[54]||(y[54]=L("span",{class:"text-xs font-semibold text-green-800"},"Positive",-1)),L("span",Xa,"+"+W((null==(a=Ol.value[e.id])?void 0:a.points_plus)||0)+" ‚≠ê",1)]),L("div",et,[y[55]||(y[55]=L("span",{class:"text-xs font-semibold text-red-800"},"Negative",-1)),L("span",at,"-"+W((null==(t=Ol.value[e.id])?void 0:t.points_minus)||0)+" ‚ö†Ô∏è",1)]),L("div",tt,[y[56]||(y[56]=L("span",{class:"text-xs font-semibold text-blue-800"},"Total",-1)),L("span",lt,W(((null==(l=Ol.value[e.id])?void 0:l.points_plus)||0)-((null==(s=Ol.value[e.id])?void 0:s.points_minus)||0)),1)])])],10,Qa)}),128))])])]),_:1}),B($,{name:"history"},{default:Q(()=>[L("div",st,[L("div",ot,[L("h3",nt,W(a.$t("rewardSys.history.title")),1),B(o,{color:"primary",icon:"refresh",label:a.$t("rewardSys.history.refresh"),onClick:Ks,loading:Zl.value},null,8,["label","loading"])]),Wl.value.length?M("",!0):(N(),R("div",rt,[L("p",it,W(a.$t("rewardSys.history.empty")),1)])),(N(!0),R(J,null,Z(Wl.value,e=>{var t,l,s;return N(),R("div",{key:e.id,class:le(["p-4 bg-white rounded-lg border-l-4",[e.canceled?"border-gray-400 opacity-60":e.value>0?"border-green-500":"border-red-500"]])},[L("div",dt,[L("div",ut,[L("div",ct,[L("span",vt,W((null==(l=null==(t=e.student_behavior)?void 0:t.student)?void 0:l.name)||a.$t("rewardSys.history.unknown")),1),L("span",mt,W(e.value>0?"‚≠ê":"‚ö†Ô∏è"),1)]),L("p",pt,[L("strong",null,W(xl(e.behavior)||a.$t("rewardSys.history.unknownBehavior")),1),L("span",{class:le(e.value>0?"text-green-600":"text-red-600")}," ("+W(e.value>0?"+":"")+W(e.value)+" "+W(a.$t("rewardSys.points.title"))+") ",3)]),L("p",gt,W(Xs(e.created_at))+" by "+W((null==(s=e.created_by)?void 0:s.name)||a.$t("rewardSys.history.unknown")),1),e.note?(N(),R("p",bt,W(a.$t("rewardSys.history.note"))+" "+W(e.note),1)):M("",!0),e.canceled?(N(),R("p",ft," ‚ùå "+W(a.$t("rewardSys.history.canceled"))+" "+W(e.cancel_reason)+" ("+W(Xs(e.canceled_at))+") ",1)):M("",!0)]),e.canceled?M("",!0):(N(),O(o,{key:0,color:"warning",icon:"undo",label:a.$t("rewardSys.history.undo"),size:"sm",onClick:a=>async function(e){Kl.value=e;try{const a=await ue.undoAction(e,"Undone by teacher");a.success?(Il.notify({message:"Action undone successfully",color:"positive",position:"top"}),await Ks(),await Ws()):Il.notify({message:a.error||"Failed to undo action",color:"negative",position:"top"})}catch(a){console.error("Error undoing action:",a),Il.notify({message:"Error undoing action",color:"negative",position:"top"})}finally{Kl.value=null}}(e.id),loading:Kl.value===e.id},null,8,["label","onClick","loading"]))])],2)}),128))])]),_:1}),B($,{name:"settings_reports",class:"p-4"},{default:Q(()=>[L("div",yt,[L("div",ht,[B(j,{modelValue:Al.value,"onUpdate:modelValue":y[21]||(y[21]=e=>Al.value=e),align:"left",class:"text-gray-600 bg-gray-50 border-b border-gray-200","active-color":"primary","indicator-color":"primary",dense:""},{default:Q(()=>[B(C,{name:"behavior_incidents",icon:"report_problem",label:a.$t("rewardSys.tabs.behaviorIncidents")},null,8,["label"]),B(C,{name:"behaviors",icon:"settings",label:a.$t("rewardSys.tabs.behaviors")},null,8,["label"])]),_:1},8,["modelValue"]),B(A,{modelValue:Al.value,"onUpdate:modelValue":y[23]||(y[23]=e=>Al.value=e),animated:"",class:"bg-transparent"},{default:Q(()=>[B($,{name:"behavior_incidents"},{default:Q(()=>[B(G(de),{students:zl.value,"classroom-id":El.value,date:Fl.value,"period-code":ws.value,onIncidentRecorded:to},null,8,["students","classroom-id","date","period-code"])]),_:1}),B($,{name:"behaviors"},{default:Q(()=>[L("div",xt,[L("div",wt,[L("h3",_t,W(a.$t("rewardSys.behaviors.management")),1),B(o,{color:"primary",icon:"add",label:a.$t("rewardSys.behaviors.addNew"),onClick:y[22]||(y[22]=e=>Rs(null)),size:"md",class:"shadow-md"},null,8,["label"])]),L("div",St,[L("div",kt,[B(l,{name:"add_circle",size:"md",color:"positive"}),L("h4",$t,W(a.$t("rewardSys.behaviors.positiveSection")),1),B(k,{label:Vs.value.length,color:"positive"},null,8,["label"])]),L("div",It,[(N(!0),R(J,null,Z(Vs.value,e=>(N(),R("div",{key:e.id,class:"bg-white rounded-lg p-4 shadow-sm border border-green-100 hover:shadow-md transition-all"},[L("div",Ct,[L("div",jt,[L("div",At,W(e.icon||"‚≠ê"),1),L("div",null,[L("h5",Vt,W(xl(e)),1),L("p",zt,"ID: "+W(e.id),1)])]),L("div",Pt,[B(o,{flat:"",round:"",dense:"",icon:"edit",color:"primary",size:"sm",onClick:a=>Rs(e)},{default:Q(()=>[B(n,null,{default:Q(()=>y[58]||(y[58]=[H("Edit")])),_:1})]),_:2},1032,["onClick"]),B(o,{flat:"",round:"",dense:"",icon:"delete",color:"negative",size:"sm",onClick:a=>Bs(e)},{default:Q(()=>[B(n,null,{default:Q(()=>y[59]||(y[59]=[H("Delete")])),_:1})]),_:2},1032,["onClick"])])]),L("div",Et,[y[60]||(y[60]=L("span",{class:"text-sm text-gray-600"},"Points:",-1)),L("span",Dt,"+"+W(e.value||e.points||0),1)])]))),128))]),0===Vs.value.length?(N(),R("div",Ft,[B(l,{name:"sentiment_neutral",size:"3rem",class:"mb-2"}),L("p",null,W(a.$t("rewardSys.behaviors.noPositive")),1)])):M("",!0)]),L("div",Tt,[L("div",Ut,[B(l,{name:"remove_circle",size:"md",color:"negative"}),L("h4",qt,W(a.$t("rewardSys.behaviors.negativeSection")),1),B(k,{label:zs.value.length,color:"negative"},null,8,["label"])]),L("div",Rt,[(N(!0),R(J,null,Z(zs.value,e=>(N(),R("div",{key:e.id,class:"bg-white rounded-lg p-4 shadow-sm border border-red-100 hover:shadow-md transition-all"},[L("div",Nt,[L("div",Bt,[L("div",Lt,W(e.icon||"‚ö†Ô∏è"),1),L("div",null,[L("h5",Ot,W(xl(e)),1),L("p",Mt,"ID: "+W(e.id),1)])]),L("div",Qt,[B(o,{flat:"",round:"",dense:"",icon:"edit",color:"primary",size:"sm",onClick:a=>Rs(e)},{default:Q(()=>[B(n,null,{default:Q(()=>y[61]||(y[61]=[H("Edit")])),_:1})]),_:2},1032,["onClick"]),B(o,{flat:"",round:"",dense:"",icon:"delete",color:"negative",size:"sm",onClick:a=>Bs(e)},{default:Q(()=>[B(n,null,{default:Q(()=>y[62]||(y[62]=[H("Delete")])),_:1})]),_:2},1032,["onClick"])])]),L("div",Wt,[y[63]||(y[63]=L("span",{class:"text-sm text-gray-600"},"Points:",-1)),L("span",Gt,W(e.value||e.points||0),1)])]))),128))]),0===zs.value.length?(N(),R("div",Yt,[B(l,{name:"sentiment_neutral",size:"3rem",class:"mb-2"}),L("p",null,W(a.$t("rewardSys.behaviors.noNegative")),1)])):M("",!0)])])]),_:1})]),_:1},8,["modelValue"])])])]),_:1})]),_:1},8,["modelValue"])]),_:1})):M("",!0),zl.value.length?M("",!0):(N(),O(r,{key:2,class:"shadow-lg rounded-2xl"},{default:Q(()=>[B(t,{class:"text-center py-12"},{default:Q(()=>[L("p",Ht,"üìö "+W(a.$t("rewardSys.messages.selectClassroom")),1)]),_:1})]),_:1})),B(m,{modelValue:Gl.value,"onUpdate:modelValue":y[25]||(y[25]=e=>Gl.value=e),maximized:""},{default:Q(()=>[B(r,null,{default:Q(()=>[B(p,{align:"right"},{default:Q(()=>[K(B(o,{flat:"",label:"Close",color:"primary"},null,512),[[x]])]),_:1}),B(t,{class:"p-0"},{default:Q(()=>[B(G(ie),{students:zl.value,"student-behaviors":Ol.value,"period-code":ws.value,date:Fl.value,"school-logo":_l.value},null,8,["students","student-behaviors","period-code","date","school-logo"])]),_:1}),B(p,{align:"right"},{default:Q(()=>[K(B(o,{flat:"",label:"Close",color:"primary"},null,512),[[x]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),B(m,{modelValue:ls.value,"onUpdate:modelValue":y[26]||(y[26]=e=>ls.value=e),"full-width":"",maxWidth:"1000px"},{default:Q(()=>[B(r,{class:"flex flex-col md:flex-row h-[80vh] md:h-[70vh]"},{default:Q(()=>[B(t,{class:"w-full md:w-1/3 bg-blue-50 border-r border-blue-100 flex flex-col p-0"},{default:Q(()=>[L("div",Jt,[L("h4",Zt,[B(l,{name:"checklist"}),H(" "+W(a.$t("rewardSys.selected"))+" ("+W(Ll.value.length)+") ",1)])]),L("div",Kt,[0===Ll.value.length?(N(),R("div",Xt,W(a.$t("rewardSys.messages.clickToSelect")),1)):(N(),R("div",el,[(N(!0),R(J,null,Z(Ll.value,e=>(N(),O(h,{key:e,removable:"",onRemove:a=>Ls(e),color:"white","text-color":"primary",class:"shadow-sm border border-blue-100 m-0 w-full"},{default:Q(()=>{var a,t;return[B(w,{icon:"person",color:"primary","text-color":"white","font-size":"14px"}),L("div",al,[L("span",tl,[H(W(null==(a=zl.value.find(a=>a.id===e))?void 0:a.firstName)+" ",1),L("span",ll,W(null==(t=zl.value.find(a=>a.id===e))?void 0:t.lastName),1)])])]}),_:2},1032,["onRemove"]))),128))]))]),L("div",sl,[L("div",ol,[B(o,{flat:"",dense:"",color:"primary",label:"All",size:"sm",onClick:Ds,class:"bg-blue-50"}),B(o,{flat:"",dense:"",color:"primary",label:"Inv",size:"sm",onClick:Fs,class:"bg-blue-50"}),B(o,{flat:"",dense:"",color:"negative",label:"Clear",size:"sm",onClick:Ms,class:"bg-red-50"})])])]),_:1}),L("div",nl,[B(t,{class:le("positive"===ss.value?"bg-green-50 border-b border-green-100":"bg-red-50 border-b border-red-100")},{default:Q(()=>[L("div",rl,[B(l,{name:"positive"===ss.value?"add_circle":"remove_circle",color:"positive"===ss.value?"positive":"negative"},null,8,["name","color"]),H(" "+W("positive"===ss.value?a.$t("rewardSys.points.positiveTitle"):a.$t("rewardSys.points.negativeTitle")),1)])]),_:1},8,["class"]),B(t,{class:"flex-1 overflow-y-auto p-4 custom-scrollbar"},{default:Q(()=>[L("div",il,[(N(!0),R(J,null,Z("positive"===ss.value?Vs.value:zs.value,e=>(N(),R("div",{key:e.id,class:"cursor-pointer transition-all duration-200 relative group",onClick:a=>os.value=e.id},[L("div",{class:le(["h-full p-3 rounded-xl border-2 flex flex-col items-center text-center gap-2 hover:shadow-md transition-all",[os.value===e.id?"positive"===ss.value?"border-green-500 bg-green-50 scale-105":"border-red-500 bg-red-50 scale-105":"border-gray-100 bg-white hover:border-gray-300"]])},[L("div",{class:le(["text-3xl p-3 rounded-full mb-1","positive"===ss.value?"bg-green-100 text-green-600":"bg-red-100 text-red-600"])},W(e.icon||("positive"===ss.value?"‚≠ê":"‚ö†Ô∏è")),3),L("div",ul,W(xl(e)),1),L("div",{class:le(["text-xl font-bold px-3 py-1 rounded-full mt-auto","positive"===ss.value?"bg-green-200 text-green-800":"bg-red-200 text-red-800"])},W("positive"===ss.value?"+":"")+W(e.value||e.points||0),3),os.value===e.id?(N(),R("div",{key:0,class:le(["absolute top-2 right-2 text-xl drop-shadow-sm","positive"===ss.value?"text-green-600":"text-red-600"])},[B(l,{name:"check_circle"})],2)):M("",!0)],2)],8,dl))),128))])]),_:1}),B(p,{align:"right",class:"p-4 border-t border-gray-100 bg-gray-50 gap-3"},{default:Q(()=>[K(B(o,{flat:"",label:a.$t("rewardSys.tabs.cancel"),color:"grey-7",size:"lg",class:"font-bold"},null,8,["label"]),[[x]]),B(o,{color:"positive"===ss.value?"positive":"negative",label:"positive"===ss.value?a.$t("rewardSys.points.applyPositive"):a.$t("rewardSys.points.applyNegative"),icon:"positive"===ss.value?"check_circle":"warning",onClick:Ts,disable:!os.value,loading:Hl.value,size:"lg",class:"px-8 font-bold shadow-md",push:""},null,8,["color","label","icon","disable","loading"])]),_:1})])]),_:1})]),_:1},8,["modelValue"]),B(m,{modelValue:fs.value,"onUpdate:modelValue":y[32]||(y[32]=e=>fs.value=e),persistent:""},{default:Q(()=>[B(r,{class:"min-w-[500px]"},{default:Q(()=>[B(t,{class:"bg-primary text-white"},{default:Q(()=>[L("div",cl,[L("div",vl,W(ys.value?a.$t("rewardSys.behaviors.edit"):a.$t("rewardSys.behaviors.create")),1),ys.value&&!ys.value.teacher_id?(N(),O(k,{key:0,color:"blue",label:"üîí "+a.$t("rewardSys.behaviors.schoolDefault")},null,8,["label"])):M("",!0)])]),_:1}),B(t,{class:"q-pt-md space-y-4"},{default:Q(()=>[ys.value&&!ys.value.teacher_id?(N(),O(b,{key:0,class:"bg-blue-50 text-blue-900",rounded:"",dense:""},{avatar:Q(()=>[B(l,{name:"info",color:"blue"})]),default:Q(()=>[H(" "+W(a.$t("rewardSys.behaviors.readOnlyWarning")),1)]),_:1})):M("",!0),B(f,{modelValue:xs.value.name,"onUpdate:modelValue":y[27]||(y[27]=e=>xs.value.name=e),label:"üá¨üáß "+a.$t("rewardSys.behaviors.form.nameEn")+" *",outlined:"",dense:"",rules:[e=>!!e||"Name is required"],readonly:ys.value&&!ys.value.teacher_id},{prepend:Q(()=>[B(l,{name:"translate"})]),_:1},8,["modelValue","label","rules","readonly"]),B(f,{modelValue:xs.value.name_ar,"onUpdate:modelValue":y[28]||(y[28]=e=>xs.value.name_ar=e),label:"üá∏üá¶ "+a.$t("rewardSys.behaviors.form.nameAr"),outlined:"",dense:"",dir:"rtl",readonly:ys.value&&!ys.value.teacher_id},{prepend:Q(()=>[B(l,{name:"translate"})]),_:1},8,["modelValue","label","readonly"]),B(V,{modelValue:xs.value.type,"onUpdate:modelValue":y[29]||(y[29]=e=>xs.value.type=e),options:[{label:a.$t("rewardSys.behaviors.form.types.positive"),value:"positive"},{label:a.$t("rewardSys.behaviors.form.types.negative"),value:"negative"}],label:a.$t("rewardSys.behaviors.form.type")+" *",outlined:"",dense:"","emit-value":"","map-options":"",rules:[e=>!!e||"Type is required"],readonly:ys.value&&!ys.value.teacher_id},null,8,["modelValue","options","label","rules","readonly"]),B(f,{modelValue:xs.value.points,"onUpdate:modelValue":y[30]||(y[30]=e=>xs.value.points=e),modelModifiers:{number:!0},label:a.$t("rewardSys.behaviors.form.points")+" *",type:"number",outlined:"",dense:"",rules:[e=>null!==e&&""!==e||"Points are required"],hint:"positive"===xs.value.type?"Positive number (e.g., 5)":"Negative number (e.g., -3)",readonly:ys.value&&!ys.value.teacher_id},null,8,["modelValue","label","rules","hint","readonly"]),B(f,{modelValue:xs.value.icon,"onUpdate:modelValue":y[31]||(y[31]=e=>xs.value.icon=e),label:a.$t("rewardSys.behaviors.form.icon"),outlined:"",dense:"",hint:"Optional emoji, e.g., ‚≠ê üéâ ‚ö†Ô∏è üö´",readonly:ys.value&&!ys.value.teacher_id},null,8,["modelValue","label","readonly"])]),_:1}),B(p,{align:"right",class:"q-px-md q-pb-md"},{default:Q(()=>[K(B(o,{flat:"",label:a.$t("rewardSys.tabs.cancel")},null,8,["label"]),[[x]]),!ys.value||ys.value.teacher_id?(N(),O(o,{key:0,color:"primary",label:ys.value?a.$t("common.update"):a.$t("common.create"),onClick:Ns,loading:hs.value},null,8,["label","loading"])):M("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),B(m,{modelValue:is.value,"onUpdate:modelValue":y[34]||(y[34]=e=>is.value=e),maximized:""},{default:Q(()=>[B(G(ml),{students:zl.value,"saved-layouts":rs.value,"editing-layout":ds.value,onSave:Us,onDelete:qs,onClose:y[33]||(y[33]=e=>is.value=!1)},null,8,["students","saved-layouts","editing-layout"])]),_:1},8,["modelValue"]),B(m,{modelValue:us.value,"onUpdate:modelValue":y[40]||(y[40]=e=>us.value=e)},{default:Q(()=>[B(se,{mode:cs.value,"competition-start-time":ms.value,"date-from":ps.value,"date-to":gs.value,"leaderboard-mode":bs.value,"onUpdate:mode":y[35]||(y[35]=e=>cs.value=e),"onUpdate:competitionStartTime":y[36]||(y[36]=e=>ms.value=e),"onUpdate:dateFrom":y[37]||(y[37]=e=>ps.value=e),"onUpdate:dateTo":y[38]||(y[38]=e=>gs.value=e),"onUpdate:leaderboardMode":y[39]||(y[39]=e=>bs.value=e),onApply:eo,onReset:ao},null,8,["mode","competition-start-time","date-from","date-to","leaderboard-mode"])]),_:1},8,["modelValue"])])],64)}}},[["__scopeId","data-v-caaa4f3d"]]);export{ml as default};
