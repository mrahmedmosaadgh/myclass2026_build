import{p as e}from"./app-DXXarK7I.js";import{f as t,a as n,o,L as a,I as l,M as i,V as s,x as r,ab as c,$ as u}from"./vendor-EI0FRBVb.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./ui-B__oX9pK.js";const d={class:"pad"},p={class:"toolbar"},v=["disabled"],f=["disabled"],h=["disabled"],g=["disabled"],m=["disabled"],b={class:"canvas-wrapper"},y=800,w=500,x=e({__name:"FingerDrawingDemo",emits:["export-json"],setup(e,{emit:x}){const k=t(null);let C=null;const j=t([]),R=t([]);let T=null,O=!1;const S=t(!1),U=t("#111111"),z=t(3);let I=null,L=null,_=null,J=null;const M=x;function N(){C.clearRect(0,0,y,w),I?C.drawImage(I,0,0,_,J):L&&(C.font="16px sans-serif",C.fillStyle="#888",C.fillText(L,20,40));for(const e of j.value)F(e);T&&F(T)}function E(e){const t=k.value.getBoundingClientRect();return e.touches&&e.touches[0]?{x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}:{x:e.clientX-t.left,y:e.clientY-t.top}}function F(e){const t=e.points;if(!(t.length<2)){C.strokeStyle=e.color,C.lineWidth=e.size,C.beginPath(),C.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length-1;e++){const n=(t[e].x+t[e+1].x)/2,o=(t[e].y+t[e+1].y)/2;C.quadraticCurveTo(t[e].x,t[e].y,n,o)}C.lineTo(t[t.length-1].x,t[t.length-1].y),C.stroke()}}function P(e){O=!0;const t=E(e);T={points:[{x:t.x,y:t.y,t:0}],color:U.value,size:z.value,_startTime:performance.now()}}function A(e){if(!O||!T)return;const t=E(e),n=performance.now()-T._startTime;T.points.push({x:t.x,y:t.y,t:n}),N()}function D(){O&&(O=!1,T&&(delete T._startTime,j.value.push(T),R.value=[]),T=null,N())}function q(){j.value.length>0&&(R.value.push(j.value.pop()),N())}function B(){R.value.length>0&&(j.value.push(R.value.pop()),N())}function V(){j.value=[],R.value=[],N()}const W=n(()=>j.value.length>0),X=n(()=>R.value.length>0),Y=n(()=>j.value.length>0);function $(){if(S.value||0===j.value.length)return;S.value=!0;let e=0,t=0;requestAnimationFrame(function n(){C.clearRect(0,0,y,w),I?C.drawImage(I,0,0,_,J):L&&(C.font="16px sans-serif",C.fillStyle="#888",C.fillText(L,20,40));for(let t=0;t<e;t++)F(j.value[t]);if(e<j.value.length){const o=j.value[e],a=o.points,l=Math.floor(a.length*t);l>0&&F({...o,points:a.slice(0,l+1)}),t+=.03,t>=1&&(t=0,e++),requestAnimationFrame(n)}else S.value=!1})}async function G(){try{const e=await navigator.clipboard.read();for(const n of e)for(const e of n.types)if(e.startsWith("image/")){const t=await n.getType(e),o=new Image;return o.onload=()=>{I=o,_=o.width,J=o.height,L=null,N()},void(o.src=URL.createObjectURL(t))}const t=await navigator.clipboard.readText();t&&(L=t,I=null,N())}catch(e){console.error("Clipboard paste failed:",e)}}function H(){const e={version:1,width:y,height:w,strokes:j.value.map(e=>({points:e.points,color:e.color,size:e.size}))};M("export-json",e)}async function K(){let e=null;if(I){const t=document.createElement("canvas");t.width=_,t.height=J;t.getContext("2d").drawImage(I,0,0,_,J),e={type:"image",data:t.toDataURL(),width:_,height:J}}else L&&(e={type:"text",data:L});const t={version:1,width:y,height:w,strokes:j.value.map(e=>({points:e.points,color:e.color,size:e.size})),background:e},n=new Blob([JSON.stringify(t)],{type:"application/json"}),o=URL.createObjectURL(n),a=document.createElement("a");a.href=o,a.download=`drawing-${Date.now()}.json`,a.click(),URL.revokeObjectURL(o)}function Q(){const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async e=>{const t=e.target.files[0];if(t)try{const e=await t.text(),n=JSON.parse(e);if(!n.version||!Array.isArray(n.strokes))throw new Error("Invalid drawing file format");if(j.value=[],R.value=[],I=null,L=null,j.value=n.strokes.map(e=>({points:e.points,color:e.color||"#111111",size:e.size||3})),n.background)if("image"===n.background.type){const e=new Image;e.onload=()=>{I=e,_=n.background.width,J=n.background.height,L=null,N()},e.src=n.background.data}else"text"===n.background.type&&(L=n.background.data,I=null,N());N()}catch(n){console.error("Failed to load drawing:",n),alert("Failed to load the drawing file. Please make sure it's a valid drawing JSON file.")}},e.click()}return o(()=>{!function(){const e=k.value,t=window.devicePixelRatio||1;e.width=y*t,e.height=w*t,e.style.width=y+"px",e.style.height=w+"px",C=e.getContext("2d"),C.scale(t,t),C.lineCap="round",C.lineJoin="round",N()}()}),(e,t)=>(l(),a("div",d,[i("div",p,[i("label",null,[t[1]||(t[1]=s(" Pen Color: ")),r(i("input",{type:"color","onUpdate:modelValue":t[0]||(t[0]=e=>U.value=e)},null,512),[[c,U.value]])]),i("button",{onClick:q,disabled:!W.value},"Undo",8,v),i("button",{onClick:B,disabled:!X.value},"Redo",8,f),i("button",{onClick:V},"Clear"),i("button",{onClick:$,disabled:S.value||!Y.value},"Replay",8,h),i("button",{onClick:H,disabled:!Y.value},"Export JSON",8,g),i("button",{onClick:K,disabled:!Y.value},"Save as JSON",8,m),i("button",{onClick:Q},"Open JSON"),i("button",{onClick:G},"Paste Background")]),i("div",b,[i("canvas",{ref_key:"canvas",ref:k,class:"canvas",onMousedown:P,onMousemove:A,onMouseup:D,onMouseleave:D,onTouchstart:u(P,["prevent"]),onTouchmove:u(A,["prevent"]),onTouchend:u(D,["prevent"])},null,544)])]))}},[["__scopeId","data-v-9a612225"]]);export{x as default};
