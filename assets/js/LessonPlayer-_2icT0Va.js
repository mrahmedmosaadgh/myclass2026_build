import{o as e,u as t,Q as s,p as l,m as i,d as a,c as o,C as r,A as n,B as c,g as u,h as d,i as p,j as v,b as m}from"./app-B77gjd5a.js";import{Q as f}from"./QSpinnerDots-CnY0H5Kp.js";import{Q as g}from"./QBadge-ZkvAqPBD.js";import{Q as y}from"./QPage-CG6Ov1pS.js";import{Q as _}from"./QPageContainer-DG-wVzFn.js";import{Q as x}from"./QLayout-Baan8rHJ.js";import{f as b,a as h,k as w,o as q,I as k,J as j,K as z,b as Q,N as P,V as S,W as C,M as $,Q as T,S as B,B as E,F as A,R as D,_ as I}from"./vendor-DuKqz2x4.js";import{U as L}from"./QuestionSlide-D_UhoUJQ.js";import M from"./PlayerSidebar-E5wZjdGf.js";import R from"./SectionBanner-Dt1LC002.js";import V from"./SlideRenderer-CtZ0P3EM.js";import N from"./NavigationFooter-hwETugWi.js";import O from"./DrawingOverlay-D3tfmeer.js";import F from"./SlideAnnotationOverlay-3C569nLr.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";import"./EnhancedQuestionEditor--vrjn-Zp.js";import"./QuestionEditor-BjQbj_u5.js";import"./RichTextEditor-DZSonAId.js";import"./QColor-wHZP5dke.js";import"./QSlider-DfH-qdFu.js";import"./QTabs-D_ZwIIJm.js";import"./rtl-Cr6c3OOr.js";import"./QTab-CnAf4tCv.js";import"./QTabPanels-B5JhG1n5.js";import"./use-panel-N2fkKyR_.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanel-B_PJ80R0.js";import"./purify.es-C2Ba6vpb.js";import"./MathEditor-CPVN-kGD.js";import"./katex-BXKQVcz-.js";import"./MathPastePreview-DL2HQ2sN.js";import"./QSelect-DB_tK-Lk.js";import"./StepByStepEditor-BhnEtsS6.js";import"./QuestionTypeSelector-u1NNM5Ca.js";import"./QuizEngine-lpLTxvgm.js";import"./useQuizI18n-CN14QUvc.js";import"./QDrawer-tdlI8FxA.js";import"./SectionCard-DQKmdwT5.js";import"./QLinearProgress-B9hMkhRG.js";import"./FingerDrawingSlide-CZgg9zZV.js";import"./QPopupProxy-DUcqDdBR.js";import"./QSpace-Bk4F2b8L.js";import"./DrawingCanvas-Gjoue0TE.js";import"./DrawingToolbar-DhBSmOg9.js";import"./QBtnToggle-BRf5Indz.js";const H={class:"compact-header"},U={class:"row items-center q-pa-sm q-px-md"},J={class:"col ellipsis"},K={class:"text-subtitle1 text-weight-bold ellipsis"},Y={class:"content-wrapper q-pa-md"},W={class:"content-container"},X={key:0,class:"flex flex-center",style:{"min-height":"400px"}},G={class:"text-center"},Z={key:1,class:"locked-state"},ee={key:2},te={class:"row items-center justify-between q-mb-md"},se={key:1},le={class:"text-h6 text-weight-bold q-mb-sm"},ie={class:"text-grey-7 q-mb-md"},ae={class:"row q-gutter-md justify-center"},oe={class:"fullscreen-presentation"},re={key:0,class:"flex flex-center",style:{height:"100vh"}},ne={class:"text-center"},ce={key:1,class:"slide-wrapper"},ue={class:"slide-content-area"},de={class:"floating-nav"},pe={class:"floating-info"},ve={key:0,class:"section-menu-overlay"},me={class:"section-menu-header"},fe={key:2,class:"flex flex-center",style:{height:"100vh"}},ge={class:"text-center"},ye=e({__name:"LessonPlayer",props:{presentation:{type:Object,default:()=>({})},sections:{type:Array,default:()=>[]},slides:{type:Array,default:()=>[]},progress:{type:Object,default:null},loading:{type:Boolean,default:!1},isPreview:{type:Boolean,default:!1}},emits:["complete-learn","submit-practice"],setup(e,{emit:ye}){const _e=t(),xe=e,be=ye,he=b("learn"),we=b(null),qe=b(0),ke=b(!0),je=b(!1),ze=b({}),Qe=b(null),Pe=b(!1),Se=b(!1),Ce=b(null),$e=b(!1),Te=h(()=>xe.slides.filter(e=>e.section===he.value)),Be=h(()=>Te.value[qe.value]||{}),Ee=h(()=>{var e,t;if(xe.isPreview)return!0;if("question"!==(null==(e=Be.value)?void 0:e.slide_type))return!0;return((null==(t=Be.value.slide_content)?void 0:t.questions)||[]).every(e=>ze.value[e.id])});h(()=>{if(!xe.progress)return 0;let e=0,t=xe.sections.length;return xe.progress.learn_completed_at&&e++,xe.progress.practice_submitted_at&&e++,xe.progress.quiz_passed&&e++,e/t*100});const Ae=h(()=>!!xe.isPreview||!!xe.progress&&(xe.progress.learn_completed_at||"opened"!==xe.progress.status)),De=h(()=>!!xe.isPreview||!!xe.progress&&("quiz_unlocked"===xe.progress.status||"completed"===xe.progress.status||"failed"===xe.progress.status)),Ie=e=>!!xe.isPreview||(!!["learn","objectives","warmup","homework"].includes(e)||("practice"===e?Ae.value:"quiz"!==e||De.value)),Le=e=>!!xe.progress&&("learn"===e?!!xe.progress.learn_completed_at:"practice"===e?!!xe.progress.practice_submitted_at:"quiz"===e&&!!xe.progress.quiz_passed),Me=()=>{Pe.value=!0},Re=e=>({text:"description",image:"image",video:"videocam",audio:"audiotrack",pdf:"picture_as_pdf",question:"quiz",drawing:"brush"}[e]||"article"),Ve=e=>{if(Ie(e)){he.value=e;const t=xe.sections.find(t=>t.id===e);we.value=t}else{let t="You cannot access this section yet.";"practice"===e?t="Please complete the Learn section first.":"quiz"===e&&(t="Please complete the Practice section first."),_e.notify({type:"warning",message:t,position:"top"})}},Ne=()=>{if(Ee.value)if(qe.value<Te.value.length-1)qe.value++;else{const e=xe.sections.findIndex(e=>e.id===he.value),t=xe.sections[e+1];t&&Ie(t.id)?(he.value=t.id,qe.value=0,we.value=t,_e.notify({type:"positive",message:`Moving to ${t.title}`,icon:"arrow_forward",position:"top",timeout:1500})):Fe()}else _e.notify({type:"warning",message:"Please complete all questions before proceeding."})},Oe=()=>{if(qe.value>0)qe.value--;else{const e=xe.sections.findIndex(e=>e.id===he.value),t=xe.sections[e-1];if(t&&Ie(t.id)){he.value=t.id,we.value=t;const e=xe.slides.filter(e=>e.section===t.id);qe.value=Math.max(0,e.length-1),_e.notify({type:"info",message:`Back to ${t.title}`,icon:"arrow_back",position:"top",timeout:1500})}}},Fe=()=>{"learn"===he.value?xe.isPreview?(_e.notify({type:"positive",message:"[Preview] Learn section completed",icon:"celebration"}),he.value="practice"):be("complete-learn"):"practice"===he.value||"quiz"===he.value?je.value=!0:_e.notify({type:"positive",message:"Section completed!",icon:"celebration"})},He=()=>{xe.isPreview?_e.notify({type:"positive",message:"[Preview] Practice submitted"}):be("submit-practice")},Ue=()=>`attempt_${xe.presentation.id}_${Be.value.id||qe.value}_${Date.now()}`,Je=async e=>{xe.isPreview},Ke=async e=>{var t;xe.isPreview?_e.notify({type:"positive",message:`[Preview] Quiz completed! Score: ${e.correct}/${e.total}`,position:"top"}):_e.notify({type:"positive",message:`Quiz completed! Score: ${e.correct}/${e.total}`,icon:"celebration",position:"top"});((null==(t=Be.value.slide_content)?void 0:t.questions)||[]).forEach(e=>{ze.value[e.id]=!0}),setTimeout(()=>{Ne()},1500)},Ye=async()=>{if(xe.presentation.quiz_id)try{const e=await I.get(`/api/quizzes/${xe.presentation.quiz_id}`);Qe.value=e.data}catch(e){console.error("Failed to fetch quiz info:",e)}},We=()=>{_e.notify({type:"info",message:"Quiz engine integration coming soon!"})},Xe=e=>{console.log("Drawing mode:",e?"active":"inactive")},Ge=()=>{$e.value=!$e.value},Ze=()=>{const e=Be.value;return(null==e?void 0:e.id)||`${he.value}-${qe.value}`};return w(he,()=>{qe.value=0,je.value=!1;const e=xe.sections.find(e=>e.id===he.value);we.value=e}),q(()=>{xe.progress?De.value?he.value="quiz":Ae.value&&!xe.progress.practice_submitted_at?he.value="practice":xe.sections.length>0&&(he.value=xe.sections[0].id):xe.sections.length>0&&(he.value=xe.sections[0].id);const e=xe.sections.find(e=>e.id===he.value);we.value=e,qe.value=0,xe.presentation.quiz_id&&Ye()}),w(()=>xe.presentation.quiz_id,e=>{e?Ye():Qe.value=null}),(t,b)=>(j(),k(x,{view:"hHh lpR fFf",class:"student-lesson-view"},{default:z(()=>[Q(M,{modelValue:ke.value,"onUpdate:modelValue":b[0]||(b[0]=e=>ke.value=e),sections:e.sections,"current-section":he.value,slides:e.slides,progress:e.progress,"can-access-section":Ie,"is-section-completed":Le,onSectionSelect:Ve},null,8,["modelValue","sections","current-section","slides","progress"]),Q(_,null,{default:z(()=>[Q(y,{class:"student-lesson-page"},{default:z(()=>{var t;return[P("div",H,[P("div",U,[Q(s,{flat:"",dense:"",round:"",icon:"menu",color:"primary",onClick:b[1]||(b[1]=e=>ke.value=!ke.value),class:"q-mr-sm"}),P("div",J,[P("div",K,S(e.presentation.name),1)]),Q(s,{unelevated:"",color:"primary",icon:"fullscreen",label:"Present",onClick:Me,class:"q-px-md"},{default:z(()=>[Q(l,null,{default:z(()=>b[8]||(b[8]=[C("Enter Fullscreen Presentation Mode")])),_:1})]),_:1})])]),P("div",Y,[P("div",W,[e.loading?(j(),$("div",X,[P("div",G,[Q(f,{color:"primary",size:"50px"}),b[9]||(b[9]=P("div",{class:"text-grey-7 q-mt-md"},"Loading lesson...",-1))])])):e.isPreview||"locked"!==(null==(t=e.progress)?void 0:t.status)?(j(),$("div",ee,[Q(R,{section:we.value,"current-slide":qe.value,"total-slides":Te.value.length,class:"q-mb-md"},null,8,["section","current-slide","total-slides"]),Te.value.length>0&&!je.value?(j(),k(i,{key:0,flat:"",bordered:"",class:"slide-card"},{default:z(()=>[Q(o,{class:"q-pa-lg"},{default:z(()=>{return[P("div",te,[Q(g,{color:"grey-4","text-color":"grey-8",class:"q-px-md q-py-sm"},{default:z(()=>[Q(a,{name:"article",size:"16px",class:"q-mr-xs"}),C(" Slide "+S(qe.value+1)+" of "+S(Te.value.length),1)]),_:1}),Q(r,{icon:Re(Be.value.slide_type),color:(e=Be.value.slide_type,{text:"blue-6",image:"purple-6",video:"red-6",audio:"orange-6",pdf:"red-8",question:"green-6",drawing:"pink-6"}[e]||"grey-6"),"text-color":"white",class:"text-weight-bold"},{default:z(()=>{var e;return[C(S(null==(e=Be.value.slide_type)?void 0:e.toUpperCase()),1)]}),_:1},8,["icon","color"])]),Q(V,{slide:Be.value,"attempt-id":Ue(),"legacy-mode":he.value,onAnswerSelected:Je,onQuizCompleted:Ke,class:"q-mt-lg"},null,8,["slide","attempt-id","legacy-mode"])];var e}),_:1}),Q(N,{"current-slide":qe.value,"total-slides":Te.value.length,"can-proceed":Ee.value,"is-last-slide":qe.value>=Te.value.length-1,onPrev:Oe,onNext:Ne},null,8,["current-slide","total-slides","can-proceed","is-last-slide"])]),_:1})):je.value||0===Te.value.length?(j(),$("div",se,["practice"===he.value?(j(),k(i,{key:0,flat:"",bordered:"",class:"q-pa-lg"},{default:z(()=>[e.progress||e.isPreview?(j(),k(L,{key:0,question:{type:"upload_draw",text:"Practice Submission",points:0},mode:"practice",onSubmitted:He})):T("",!0)]),_:1})):"quiz"===he.value?(j(),k(i,{key:1,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:z(()=>[Q(n,{size:"100px",color:"positive","text-color":"white",class:"q-mb-md"},{default:z(()=>[Q(a,{name:"quiz",size:"50px"})]),_:1}),b[12]||(b[12]=P("div",{class:"text-h4 text-weight-bold q-mb-sm"},"Quiz Time!",-1)),b[13]||(b[13]=P("div",{class:"text-subtitle1 text-grey-7 q-mb-lg"},"Ready to test your knowledge?",-1)),Qe.value?(j(),k(i,{key:0,flat:"",bordered:"",class:"q-pa-lg q-mb-lg",style:{"max-width":"500px",margin:"0 auto"}},{default:z(()=>[P("div",le,S(Qe.value.name),1),P("div",ie,S(Qe.value.description),1),P("div",ae,[Q(r,{icon:"help",color:"primary","text-color":"white"},{default:z(()=>[C(S(Qe.value.questions_count)+" Questions ",1)]),_:1}),Qe.value.time_limit_minutes?(j(),k(r,{key:0,icon:"timer",color:"orange","text-color":"white"},{default:z(()=>[C(S(Qe.value.time_limit_minutes)+" Minutes ",1)]),_:1})):T("",!0)])]),_:1})):T("",!0),Qe.value?(j(),k(s,{key:1,unelevated:"",color:"positive",icon:"play_arrow",label:"Start Quiz",onClick:We,size:"lg",class:"q-px-xl q-py-sm"})):T("",!0)]),_:1})):(j(),k(i,{key:2,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:z(()=>[Q(a,{name:"folder_open",size:"80px",color:"grey-4",class:"q-mb-md"}),b[14]||(b[14]=P("div",{class:"text-h6 text-grey-7"},"No content available",-1))]),_:1}))])):T("",!0)])):(j(),$("div",Z,[Q(i,{flat:"",bordered:"",class:"text-center q-pa-xl"},{default:z(()=>[Q(a,{name:"lock",size:"80px",color:"grey-4",class:"q-mb-md"}),b[10]||(b[10]=P("div",{class:"text-h5 text-weight-bold q-mb-sm"},"Lesson Locked",-1)),b[11]||(b[11]=P("div",{class:"text-grey-7"}," This lesson has not been opened by your teacher yet. ",-1))]),_:1})]))])])]}),_:1})]),_:1}),Q(m,{modelValue:Pe.value,"onUpdate:modelValue":b[7]||(b[7]=e=>Pe.value=e),maximized:""},{default:z(()=>[P("div",oe,[e.loading?(j(),$("div",re,[P("div",ne,[Q(f,{color:"white",size:"50px"}),b[15]||(b[15]=P("div",{class:"text-white q-mt-md"},"Loading...",-1))])])):Te.value.length>0?(j(),$("div",ce,[P("div",ue,[Q(V,{slide:Be.value,"attempt-id":Ue(),"legacy-mode":he.value,onAnswerSelected:Je,onQuizCompleted:Ke},null,8,["slide","attempt-id","legacy-mode"])]),P("div",de,[qe.value>0?(j(),k(s,{key:0,fab:"",color:"primary",icon:"chevron_left",onClick:Oe,class:"nav-arrow nav-arrow-left"},{default:z(()=>[Q(l,null,{default:z(()=>b[16]||(b[16]=[C("Previous")])),_:1})]),_:1})):T("",!0),Ee.value?(j(),k(s,{key:1,fab:"",color:qe.value<Te.value.length-1?"primary":"positive",icon:qe.value<Te.value.length-1?"chevron_right":"check_circle",onClick:Ne,class:"nav-arrow nav-arrow-right"},{default:z(()=>[Q(l,null,{default:z(()=>[C(S(qe.value<Te.value.length-1?"Next":"Complete"),1)]),_:1})]),_:1},8,["color","icon"])):T("",!0)]),P("div",pe,[Q(r,{color:"rgba(0,0,0,0.7)","text-color":"white",class:"q-px-md"},{default:z(()=>[Q(a,{name:Re(Be.value.slide_type),size:"18px",class:"q-mr-xs"},null,8,["name"]),C(" "+S(qe.value+1)+" / "+S(Te.value.length),1)]),_:1}),we.value?(j(),k(r,{key:0,style:B({background:we.value.bg,color:we.value.textColor}),class:"q-ml-sm q-px-md"},{default:z(()=>[Q(a,{name:we.value.qIcon||we.value.icon,size:"18px",class:"q-mr-xs"},null,8,["name"]),C(" "+S(we.value.title),1)]),_:1},8,["style"])):T("",!0)]),Q(s,{flat:"",dense:"",round:"",icon:"list",color:"white",onClick:b[2]||(b[2]=e=>Se.value=!Se.value),class:"section-menu-btn"},{default:z(()=>[Q(l,null,{default:z(()=>b[17]||(b[17]=[C("Sections")])),_:1})]),_:1}),Q(E,{name:"slide-fade"},{default:z(()=>[Se.value?(j(),$("div",ve,[P("div",me,[b[18]||(b[18]=P("div",{class:"text-h6 text-white"},"Sections",-1)),Q(s,{flat:"",dense:"",round:"",icon:"close",color:"white",onClick:b[3]||(b[3]=e=>Se.value=!1)})]),Q(c,{class:"section-menu-list"},{default:z(()=>[Q(u,{dark:""},{default:z(()=>[(j(!0),$(A,null,D(e.sections,e=>(j(),k(d,{key:e.id,clickable:"",active:he.value===e.id,disable:!Ie(e.id),onClick:t=>(e=>{if(Ie(e)){he.value=e,qe.value=0;const t=xe.sections.find(t=>t.id===e);we.value=t,Se.value=!1,_e.notify({type:"positive",message:`Jumped to ${t.title}`,icon:"check",position:"top",timeout:1500})}else _e.notify({type:"warning",message:"This section is locked",position:"top"})})(e.id),class:"section-menu-item"},{default:z(()=>[Q(p,{avatar:""},{default:z(()=>[Q(n,{style:B({background:e.bg,color:e.textColor})},{default:z(()=>[Q(a,{name:e.qIcon||e.icon},null,8,["name"])]),_:2},1032,["style"])]),_:2},1024),Q(p,null,{default:z(()=>[Q(v,{class:"text-weight-medium"},{default:z(()=>[C(S(e.title),1)]),_:2},1024),Q(v,{caption:"",class:"text-grey-4"},{default:z(()=>{return[C(S((t=e.id,xe.slides.filter(e=>e.section===t).length))+" slides ",1)];var t}),_:2},1024)]),_:2},1024),Q(p,{side:""},{default:z(()=>[Le(e.id)?(j(),k(a,{key:0,name:"check_circle",color:"positive",size:"24px"})):Ie(e.id)?T("",!0):(j(),k(a,{key:1,name:"lock",color:"grey-5",size:"20px"}))]),_:2},1024)]),_:2},1032,["active","disable","onClick"]))),128))]),_:1})]),_:1})])):T("",!0)]),_:1}),Q(s,{flat:"",dense:"",round:"",icon:"close",color:"white",onClick:b[4]||(b[4]=e=>Pe.value=!1),class:"exit-fullscreen-btn"},{default:z(()=>[Q(l,null,{default:z(()=>b[19]||(b[19]=[C("Exit Presentation")])),_:1})]),_:1}),Q(s,{flat:"",dense:"",round:"",icon:$e.value?"edit_off":"edit_note",color:$e.value?"deep-orange":"white",onClick:Ge,class:"slide-annotation-btn"},{default:z(()=>[Q(l,null,{default:z(()=>[C(S($e.value?"Hide Slide Annotations":"Show Slide Annotations"),1)]),_:1})]),_:1},8,["icon","color"])])):(j(),$("div",fe,[P("div",ge,[Q(a,{name:"folder_open",size:"80px",color:"white",class:"q-mb-md"}),b[20]||(b[20]=P("div",{class:"text-h6 text-white"},"No slides available in this section",-1)),Q(s,{unelevated:"",color:"white","text-color":"black",label:"Close",onClick:b[5]||(b[5]=e=>Pe.value=!1),class:"q-mt-lg"})])]))]),Pe.value?(j(),k(O,{key:0,ref_key:"drawingOverlayRef",ref:Ce,onDrawingStateChanged:Xe},null,512)):T("",!0),Pe.value&&$e.value?(j(),k(F,{key:1,"current-slide-id":Ze(),"current-section":he.value,"current-slide-index":qe.value,onClose:b[6]||(b[6]=e=>$e.value=!1)},null,8,["current-slide-id","current-section","current-slide-index"])):T("",!0)]),_:1},8,["modelValue"])]),_:1}))}},[["__scopeId","data-v-816bf6ce"]]);export{ye as default};
