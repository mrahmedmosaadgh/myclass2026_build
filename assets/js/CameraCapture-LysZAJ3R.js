import{p as e}from"./app-DXXarK7I.js";import{f as a,a as l,L as t,I as u,O as n,x as v,M as i,$ as o,X as c,n as s}from"./vendor-EI0FRBVb.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./ui-B__oX9pK.js";const r={class:"camera-capture"},h={key:0},d={class:"section"},f={class:"section"},g={class:"camera-controls"},p={key:0,class:"section-title"},y={key:1,class:"crop-instruction"},m={key:2,class:"crop-instruction success"},w=["width","height"],x={key:4,class:"crop-buttons"},k=["disabled"],C={key:5,class:"cropped-preview"},b=["src"],R=e({__name:"CameraCapture",emits:["captured"],setup(e,{emit:R}){const T=R,I=a(null),M=a(null),S=a(!1),j=a(!1),E=a(!1),U=a({x:0,y:0}),_=a({x:0,y:0}),D=a(null),A=l(()=>D.value&&D.value.w>2&&D.value.h>2),L=a(null),P=a(null),W=a(300),F=a(300);let X=null;function B(e){const a=e.target.files[0];if(!a)return;const l=new FileReader;l.onload=e=>{return a=e.target.result,L.value=new Image,L.value.src=a,void(L.value.onload=()=>{j.value=!0,W.value=L.value.width,F.value=L.value.height,s(q)});var a},l.readAsDataURL(a)}const O=a("user");function Y(){X&&X.getTracks().forEach(e=>e.stop()),navigator.mediaDevices.getUserMedia({video:{facingMode:O.value}}).then(e=>{X=e,S.value=!0,s(()=>I.value.srcObject=X)})}function H(){O.value="user"===O.value?"environment":"user",Y()}function $(){const e=I.value,a=M.value;if(!a||!e)return;a.width=e.videoWidth,a.height=e.videoHeight;a.getContext("2d").drawImage(e,0,0,a.width,a.height),L.value=new Image,L.value.src=a.toDataURL("image/png"),L.value.onload=()=>{j.value=!0,S.value=!1,X&&X.getTracks().forEach(e=>e.stop()),s(q)}}function q(){const e=M.value;if(!e||!L.value)return;const a=e.getContext("2d");if(a.clearRect(0,0,e.width,e.height),a.drawImage(L.value,0,0,e.width,e.height),D.value){a.fillStyle="rgba(0, 0, 0, 0.6)",a.fillRect(0,0,e.width,e.height),a.clearRect(D.value.x,D.value.y,D.value.w,D.value.h),a.drawImage(L.value,D.value.x,D.value.y,D.value.w,D.value.h,D.value.x,D.value.y,D.value.w,D.value.h),a.fillStyle="rgba(76, 175, 80, 0.4)",a.fillRect(D.value.x,D.value.y,D.value.w,D.value.h),a.strokeStyle="#4CAF50",a.lineWidth=3,a.strokeRect(D.value.x,D.value.y,D.value.w,D.value.h);const l=20,t=[{x:D.value.x,y:D.value.y},{x:D.value.x+D.value.w,y:D.value.y},{x:D.value.x,y:D.value.y+D.value.h},{x:D.value.x+D.value.w,y:D.value.y+D.value.h}];a.fillStyle="#4CAF50",a.strokeStyle="#ffffff",a.lineWidth=2,t.forEach(e=>{a.beginPath(),a.arc(e.x,e.y,l/2,0,2*Math.PI),a.fill(),a.stroke()});const u=D.value.x+D.value.w/2,n=D.value.y+D.value.h/2,v=15;a.strokeStyle="#ffffff",a.lineWidth=2,a.beginPath(),a.moveTo(u-v,n),a.lineTo(u+v,n),a.moveTo(u,n-v),a.lineTo(u,n+v),a.stroke()}}function z(e){const a=M.value.getBoundingClientRect(),l=M.value.width/a.width,t=M.value.height/a.height;return{x:(e.clientX-a.left)*l,y:(e.clientY-a.top)*t}}function G(e){const a=M.value.getBoundingClientRect(),l=M.value.width/a.width,t=M.value.height/a.height,u=e.touches[0]||e.changedTouches[0];return{x:(u.clientX-a.left)*l,y:(u.clientY-a.top)*t}}function J(e){j.value&&(E.value=!0,U.value=z(e),D.value=null)}function K(e){E.value&&(_.value=z(e),ee())}function N(){E.value=!1}function Q(e){j.value&&(E.value=!0,U.value=G(e),D.value=null)}function V(e){E.value&&(_.value=G(e),ee())}function Z(){E.value=!1}function ee(){D.value={x:Math.min(U.value.x,_.value.x),y:Math.min(U.value.y,_.value.y),w:Math.abs(_.value.x-U.value.x),h:Math.abs(_.value.y-U.value.y)},q()}const ae=a(0);function le(){if(!A.value)return;const e=document.createElement("canvas");e.width=D.value.w,e.height=D.value.h;e.getContext("2d").drawImage(L.value,D.value.x,D.value.y,D.value.w,D.value.h,0,0,e.width,e.height),P.value=e.toDataURL("image/png"),D.value=null,E.value=!1,ae.value=1,s(q)}function te(){T("captured",{dataUrl:P.value}),X&&(X.getTracks().forEach(e=>e.stop()),X=null),S.value=!1}function ue(){D.value=null,P.value=null,ae.value=0,E.value=!1,j.value=!1,L.value=null,X&&(X.getTracks().forEach(e=>e.stop()),X=null),S.value=!1;const e=M.value;if(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}W.value=300,F.value=300}return(e,a)=>(u(),t("div",r,[j.value?n("",!0):(u(),t("div",h,[i("div",d,[a[0]||(a[0]=i("div",{class:"section-title"},"ğŸ“‚ Upload Image",-1)),i("input",{type:"file",accept:"image/*",onChange:B},null,32)]),i("div",f,[a[1]||(a[1]=i("div",{class:"section-title"},"ğŸ“¸ Camera",-1)),i("div",g,[i("button",{class:"touch-btn primary",onClick:Y},"Start Camera"),i("button",{class:"touch-btn warning",onClick:H},"ğŸ”„ Switch Camera"),v(i("video",{ref_key:"video",ref:I,autoplay:"",playsinline:"",class:"video"},null,512),[[c,S.value]]),S.value?(u(),t("button",{key:0,class:"touch-btn success",onClick:$},"Capture")):n("",!0)])])])),v(i("div",null,[j.value?(u(),t("div",p,"âœ‚ï¸ Crop Image")):n("",!0),j.value&&!D.value?(u(),t("div",y," ğŸ‘† Drag on the image to select the area you want to crop ")):n("",!0),j.value&&D.value?(u(),t("div",m,' âœ… Selection made! Adjust or tap "Crop" to continue ')):n("",!0),P.value?n("",!0):v((u(),t("canvas",{key:3,ref_key:"canvas",ref:M,width:W.value,height:F.value,onMousedown:J,onMousemove:K,onMouseup:N,onTouchstart:o(Q,["prevent"]),onTouchmove:o(V,["prevent"]),onTouchend:o(Z,["prevent"]),class:"crop-canvas"},null,40,w)),[[c,j.value]]),j.value&&!P.value?(u(),t("div",x,[i("button",{class:"touch-btn success",onClick:le,disabled:!A.value},"âœ‚ï¸ Crop",8,k),i("button",{class:"touch-btn danger",onClick:ue},"âŒ Cancel")])):n("",!0),P.value?(u(),t("div",C,[a[2]||(a[2]=i("div",{class:"section-title"},"âœ… Preview",-1)),i("img",{src:P.value,class:"preview-img"},null,8,b),i("div",{class:"cropped-actions"},[i("button",{class:"touch-btn primary",onClick:te},"ğŸ’¾ Save"),i("button",{class:"touch-btn warning",onClick:ue},"ğŸ”„ Retake")])])):n("",!0)],512),[[c,!0]])]))}},[["__scopeId","data-v-0c843920"]]);export{R as default};
