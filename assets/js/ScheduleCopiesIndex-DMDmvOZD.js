import{p as e,u as a,e as l,q as s,Q as o,n as t,d as i,m as c,b as r,aD as n}from"./app-BzjXrVp9.js";import{Q as u}from"./QSpinnerDots-CsCCDASU.js";import{f as d,a as m,o as p,ac as v,L as y,I as g,b as h,M as f,y as b,H as j,V as w,U as _,J as S,F as C,Q,x as V,Z as k}from"./vendor-EI0FRBVb.js";import x from"./ScheduleCopyCard-B43zS7cs.js";import q from"./ScheduleCopyForm-BftAhu_d.js";import T from"./ScheduleCopyFilters-FWwoVdpU.js";import D from"./ScheduleSyncDialog-Daw48qe8.js";import E from"./CSTOverviewDialog-BiwzwMi-.js";import F from"./WeeklyPlanMenu-DQoKCqg-.js";import{u as P}from"./i18n-BbKXhR_S.js";import"./offline-BzIlwqNM.js";import"./ui-B__oX9pK.js";import"./StatusBadge-D6cZlTBs.js";import"./QSpace-qzKo_-If.js";import"./QSelect-CciNNEfD.js";import"./rtl-Cr6c3OOr.js";import"./QForm-qY0qTz8Q.js";import"./schoolData-BnE_O2cp.js";import"./QTd-DUSBgVC_.js";import"./QTable-BcXT6C-J.js";import"./QMarkupTable-_1wJRVO3.js";import"./QLinearProgress-L5RdawR6.js";import"./use-fullscreen-BnDnBhbA.js";import"./QBadge-D2ciqrkO.js";import"./date-9WQMAJt0.js";import"./QTab-Cx9aTRVb.js";import"./QTabs-BwLFzVWR.js";import"./WeeklySystemGuide-B84Ji3tk.js";import"./QTabPanel-BWvsj8on.js";import"./use-panel-DdQZ_Vdk.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-C2OMgZHe.js";import"./MainSchoolData-CJWlOJsc.js";import"./SchoolSettingsDialog-Dnqkq0FS.js";const U={class:"q-pa-md"},M={class:"row items-center q-mb-lg"},I={class:"col"},$={class:"q-ma-none text-weight-bold"},z={class:"text-grey-7 q-mb-none"},B={class:"col-auto"},H={key:0,class:"row justify-center q-pa-xl"},O={class:"text-h6 text-grey-7 q-mt-md"},L={class:"text-grey-6"},A={key:2,class:"row q-gutter-md"},J={class:"text-h6"},K=e({__name:"ScheduleCopiesIndex",setup(e){const{t:K}=P(),N=a(),R=d([]),W=d([]),Z=d([]),G=d([]),X=d(!1),Y=d(!1),ee=d(!1),ae=d(!1),le=d(!1),se=d(!1),oe=d(!1),te=d(!1),ie=d(!1),ce=d(!1),re=d(null),ne=d(null),ue=d(null),de=d({school_id:null,academic_year_id:null,semester_id:null,status:null}),me=m(()=>{let e=[...R.value];return de.value.school_id&&(e=e.filter(e=>e.school_id===de.value.school_id)),de.value.academic_year_id&&(e=e.filter(e=>e.academic_year_id===de.value.academic_year_id)),de.value.semester_id&&(e=e.filter(e=>e.semester_id===de.value.semester_id)),de.value.status&&(e=e.filter(e=>e.status===de.value.status)),e}),pe=async()=>{X.value=!0;try{const e=await k.get("/admin/schedule-copies");R.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching schedule copies:",e),N.notify({type:"negative",message:K("common.errors.fetchFailed")})}finally{X.value=!1}},ve=async()=>{Y.value=!0;try{const e=await k.get("/api/schools");W.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching schools:",e)}finally{Y.value=!1}},ye=async()=>{ee.value=!0;try{const e=await k.get("/api/academic-years");Z.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching academic years:",e)}finally{ee.value=!1}},ge=async()=>{ae.value=!0;try{const e=await k.get("/api/semesters");G.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching semesters:",e)}finally{ae.value=!1}},he=()=>{re.value=null,oe.value=!0},fe=e=>{re.value={...e},oe.value=!0},be=async e=>{le.value=!0;try{if(e.isEdit)await k.put(`/admin/schedule-copies/${re.value.id}`,e),N.notify({type:"positive",message:K("common.updatedSuccessfully")});else{const a=await k.post("/admin/schedule-copies",e);e.auto_generate&&a.data.id?(await k.post("/admin/schedule-copies/create-entries",{schedule_copy_id:a.data.id}),N.notify({type:"positive",message:"Schedule copy created with schedule slots"})):N.notify({type:"positive",message:K("common.createdSuccessfully")})}oe.value=!1,await pe()}catch(a){console.error("Error saving schedule copy:",a),N.notify({type:"negative",message:K("common.errors.submitFailed")})}finally{le.value=!1}},je=async e=>{try{await k.put(`/admin/schedule-copies/${e.id}`,{status:"active"}),N.notify({type:"positive",message:K("common.activatedSuccessfully")}),await pe()}catch(a){console.error("Error activating:",a),N.notify({type:"negative",message:K("common.errors.activateFailed")})}},we=async e=>{try{await k.put(`/admin/schedule-copies/${e.id}`,{status:"archived"}),N.notify({type:"info",message:K("common.archivedSuccessfully")}),await pe()}catch(a){console.error("Error archiving:",a),N.notify({type:"negative",message:K("common.errors.archiveFailed")})}},_e=e=>{ne.value=e,te.value=!0},Se=async()=>{se.value=!0;try{await k.delete(`/admin/schedule-copies/${ne.value.id}`),N.notify({type:"positive",message:K("common.deletedSuccessfully")}),te.value=!1,await pe()}catch(e){console.error("Error deleting:",e),N.notify({type:"negative",message:K("common.errors.deleteFailed")})}finally{se.value=!1}},Ce=()=>{},Qe=e=>{ue.value=e,ie.value=!0},Ve=()=>{N.notify({type:"positive",message:"Schedule synchronization updated",position:"top"})};return p(async()=>{await Promise.all([pe(),ve(),ye(),ge()])}),(e,a)=>{var d,m;const p=v("Head");return g(),y(C,null,[h(p,{title:b(K)("weeklySystem.scheduleCopies.title")},null,8,["title"]),f("div",U,[h(F),f("div",M,[f("div",I,[f("h4",$,[h(l,{name:"content_copy",class:"q-mr-sm",color:"primary"}),w(" "+_(b(K)("weeklySystem.scheduleCopies.title")),1)]),f("p",z,_(b(K)("weeklySystem.scheduleCopies.subtitle")),1)]),f("div",B,[h(o,{color:"teal",icon:"preview",label:"CST Overview",outline:"",onClick:a[0]||(a[0]=e=>ce.value=!0),class:"q-mr-sm"},{default:S(()=>[h(s,null,{default:S(()=>a[6]||(a[6]=[w("View subject-teacher assignments overview")])),_:1})]),_:1}),h(o,{color:"primary",icon:"add",label:b(K)("common.create"),onClick:he},null,8,["label"])])]),h(T,{modelValue:de.value,"onUpdate:modelValue":a[1]||(a[1]=e=>de.value=e),schools:W.value,"academic-years":Z.value,semesters:G.value,"loading-schools":Y.value,"loading-years":ee.value,"loading-semesters":ae.value,onFilter:Ce,class:"q-mb-lg"},null,8,["modelValue","schools","academic-years","semesters","loading-schools","loading-years","loading-semesters"]),X.value?(g(),y("div",H,[h(u,{size:"50px",color:"primary"})])):me.value.length?(g(),y("div",A,[(g(!0),y(C,null,Q(me.value,e=>(g(),y("div",{key:e.id,class:"col-12 col-sm-6 col-md-4 col-lg-3"},[h(x,{copy:e,onEdit:fe,onActivate:je,onArchive:we,onDelete:_e,onSync:Qe},null,8,["copy"])]))),128))])):(g(),j(t,{key:1,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:S(()=>[h(l,{name:"folder_open",size:"64px",color:"grey-5"}),f("p",O,_(b(K)("weeklySystem.schoolBrowser.noDataTitle")),1),f("p",L,_(b(K)("common.noResults")),1),h(o,{color:"primary",icon:"add",label:b(K)("common.create"),onClick:he,class:"q-mt-md"},null,8,["label"])]),_:1})),h(q,{modelValue:oe.value,"onUpdate:modelValue":a[2]||(a[2]=e=>oe.value=e),"edit-data":re.value,schools:W.value,"academic-years":Z.value,semesters:G.value,"loading-schools":Y.value,"loading-years":ee.value,"loading-semesters":ae.value,saving:le.value,onSubmit:be},null,8,["modelValue","edit-data","schools","academic-years","semesters","loading-schools","loading-years","loading-semesters","saving"]),h(r,{modelValue:te.value,"onUpdate:modelValue":a[3]||(a[3]=e=>te.value=e)},{default:S(()=>[h(t,{style:{"min-width":"350px"}},{default:S(()=>[h(i,{class:"row items-center"},{default:S(()=>[h(l,{name:"warning",color:"negative",size:"md",class:"q-mr-sm"}),f("span",J,_(b(K)("common.delete"))+" "+_(b(K)("weeklySystem.scheduleCopies.title")),1)]),_:1}),h(i,null,{default:S(()=>{var e;return[w(_(b(K)("common.confirmDelete"))+' "',1),f("strong",null,_(null==(e=ne.value)?void 0:e.name),1),w('"? '+_(b(K)("common.actionCannotBeUndone")),1)]}),_:1}),h(c,{align:"right"},{default:S(()=>[V(h(o,{flat:"",label:b(K)("common.cancel")},null,8,["label"]),[[n]]),h(o,{flat:"",label:b(K)("common.delete"),color:"negative",loading:se.value,onClick:Se},null,8,["label","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),h(D,{modelValue:ie.value,"onUpdate:modelValue":a[4]||(a[4]=e=>ie.value=e),"copy-id":null==(d=ue.value)?void 0:d.id,"copy-name":null==(m=ue.value)?void 0:m.name,onSynced:Ve},null,8,["modelValue","copy-id","copy-name"]),h(E,{modelValue:ce.value,"onUpdate:modelValue":a[5]||(a[5]=e=>ce.value=e)},null,8,["modelValue"])])],64)}}},[["__scopeId","data-v-9338a7c2"]]);export{K as default};
