import{Q as e,a as t}from"./QToolbar-B7b0X7xh.js";import{Q as a}from"./QHeader-BPZu3ueO.js";import{r as s,u as l,d as n,f as o,Q as i,b as r,c as u,o as d,e as m,aS as c}from"./app-BxJhpxku.js";import{Q as v}from"./QLinearProgress-C8hggxm2.js";import{Q as p}from"./QPageContainer-2NxTLZlF.js";import{Q as g}from"./QLayout-DdBIq4J5.js";import{f,a as x,o as b,A as y,af as _,N as h,J as q,b as w,K as j,R as k,V as Q,F as A,Q as E,I as C,O as V,W as S,y as I,m as T,_ as D,$ as L}from"./vendor-BWKGNkNB.js";import{s as O}from"./i18n-B0T1C7j3.js";import P from"./QuExamTimer-DwB3fiF6.js";import $ from"./QuQuestionDisplay-4bz_pFJT.js";import"./offline-BzIlwqNM.js";import"./ui-B7TfxbV_.js";import"./QSpace-BD6HDuXW.js";import"./katex-DjUCNC-N.js";import"./katex-BXKQVcz-.js";const z={class:"text-h6"},F={class:"text-caption text-grey-7"},H={class:"exam-content"},J={class:"navigation-sidebar"},M={class:"text-caption text-grey-7 q-mb-sm"},N={class:"question-grid"},R={class:"text-caption text-grey-7 q-mb-xs"},U={class:"question-area"},W={class:"text-caption text-grey-7 q-mb-sm"},K={class:"q-gutter-sm"},Y={class:"q-mt-md"},B={class:"text-caption text-grey-7"},G={key:0,class:"text-caption text-warning q-mt-xs"},X=s({__name:"QuTakeExam",props:{exam:Object,attempt:Object,questions:Array,existing_answers:Object},setup(s){const X=l(),Z=s,ee=f(0),te=f({...Z.existing_answers}),ae=f(Date.now()),se=f(!1),le=f(!1),ne=f(!1),oe=f(!1);let ie=null;const re=x(()=>Z.questions[ee.value]),ue=x({get:()=>te.value[re.value.id]||{selected_options:[],answer_text:""},set(e){te.value[re.value.id]=e}}),de=x(()=>Object.keys(te.value).filter(e=>{const t=te.value[e],a=t.selected_options&&("string"==typeof t.selected_options&&t.selected_options.length>0||Array.isArray(t.selected_options)&&t.selected_options.length>0),s=t.answer_text&&t.answer_text.trim().length>0;return a||s}).length),me=x(()=>{const e=Math.floor((Date.now()-ae.value)/1e3);if(e<10)return"Just now";if(e<60)return`${e}s ago`;return`${Math.floor(e/60)}m ago`}),ce=e=>{const t=te.value[e];if(!t)return!1;const a=t.selected_options&&("string"==typeof t.selected_options&&t.selected_options.length>0||Array.isArray(t.selected_options)&&t.selected_options.length>0),s=t.answer_text&&t.answer_text.trim().length>0;return a||s},ve=e=>{if(ee.value===e)return"primary";const t=Z.questions[e];return ce(t.id)?"positive":"grey-5"},pe=()=>{ee.value>0&&ee.value--},ge=()=>{ee.value<Z.questions.length-1&&ee.value++},fe=()=>{},xe=async(e=!0)=>{if(!le.value){se.value=!0;try{await D.post(O("qu-student.exams.auto-save",{quExam:Z.exam.id,quAttempt:Z.attempt.id}),{answers:te.value}),ae.value=Date.now(),e&&X.notify({type:"positive",message:"Progress saved",icon:"save",timeout:2e3})}catch(t){e&&X.notify({type:"negative",message:"Failed to save progress",icon:"error"}),console.error("Auto-save error:",t)}finally{se.value=!1}}},be=()=>{ne.value=!0},ye=()=>{oe.value=!0,L.post(O("qu-student.exams.submit",{quExam:Z.exam.id,quAttempt:Z.attempt.id}),{answers:te.value},{onSuccess:()=>{le.value=!0,clearInterval(ie),X.notify({type:"positive",message:"Exam submitted successfully!",icon:"check_circle"})},onError:e=>{oe.value=!1,X.notify({type:"negative",message:e.message||"Failed to submit exam",icon:"error"})}})},_e=()=>{le.value=!0,clearInterval(ie),ye()},he=e=>{},qe=()=>{},we=e=>{if(!le.value)return e.preventDefault(),e.returnValue="",""};return b(()=>{ie=setInterval(()=>{xe(!1)},3e4),window.addEventListener("beforeunload",we)}),y(()=>{ie&&clearInterval(ie),window.removeEventListener("beforeunload",we)}),(l,f)=>{const x=_("Head");return q(),h(A,null,[w(x,{title:s.exam.title||"Take Exam"},null,8,["title"]),w(g,T({view:"hHh lpR fFf",class:"bg-grey-1"},l.$attrs),{default:j(()=>[w(a,{elevated:"",class:"bg-white text-dark"},{default:j(()=>[w(e,null,{default:j(()=>[w(t,null,{default:j(()=>{var e;return[k("div",z,Q(s.exam.title),1),k("div",F,Q(null==(e=s.exam.subject)?void 0:e.name),1)]}),_:1}),w(P,{"remaining-seconds":s.attempt.remaining_seconds,"auto-submit":_e,onTimeWarning:he,onTimeExpired:qe},null,8,["remaining-seconds"])]),_:1})]),_:1}),w(p,null,{default:j(()=>[k("div",H,[k("div",J,[w(n,null,{default:j(()=>[w(o,null,{default:j(()=>[f[3]||(f[3]=k("div",{class:"text-subtitle2 q-mb-md"},"Questions",-1)),k("div",M," Answered: "+Q(de.value)+" / "+Q(s.questions.length),1),k("div",N,[(q(!0),h(A,null,E(s.questions,(e,t)=>(q(),C(r,{key:e.id,label:t+1,color:ve(t),outline:ee.value!==t,unelevated:ee.value===t,size:"sm",onClick:e=>(e=>{ee.value=e})(t),class:"question-nav-btn"},{default:j(()=>[ce(e.id)?(q(),C(i,{key:0,name:"check",size:"xs",class:"absolute-top-right",style:{margin:"2px"}})):V("",!0)]),_:2},1032,["label","color","outline","unelevated","onClick"]))),128))])]),_:1}),w(u),w(o,null,{default:j(()=>[k("div",R," Last saved: "+Q(me.value),1),se.value?(q(),C(v,{key:0,indeterminate:"",color:"primary",size:"2px"})):V("",!0)]),_:1})]),_:1})]),k("div",U,[w(n,null,{default:j(()=>[w(o,null,{default:j(()=>[k("div",W," Question "+Q(ee.value+1)+" of "+Q(s.questions.length),1),w($,{question:re.value,index:ee.value+1,modelValue:ue.value,"onUpdate:modelValue":[f[0]||(f[0]=e=>ue.value=e),fe],readonly:!1,"show-correct-answer":!1},null,8,["question","index","modelValue"])]),_:1}),w(u),w(d,{align:"between",class:"q-pa-md"},{default:j(()=>[w(r,{flat:"",color:"primary",label:"Previous",icon:"chevron_left",disable:0===ee.value,onClick:pe},null,8,["disable"]),k("div",K,[w(r,{outline:"",color:"primary",label:"Save Progress",icon:"save",onClick:f[1]||(f[1]=e=>xe(!0)),loading:se.value},null,8,["loading"]),w(r,{color:"negative",label:"Submit Exam",icon:"send",onClick:be})]),w(r,{flat:"",color:"primary",label:"Next","icon-right":"chevron_right",disable:ee.value===s.questions.length-1,onClick:ge},null,8,["disable"])]),_:1})]),_:1})])])]),_:1}),w(m,{modelValue:ne.value,"onUpdate:modelValue":f[2]||(f[2]=e=>ne.value=e),persistent:""},{default:j(()=>[w(n,{style:{"min-width":"400px"}},{default:j(()=>[w(o,null,{default:j(()=>f[4]||(f[4]=[k("div",{class:"text-h6"},"Submit Exam?",-1)])),_:1}),w(o,null,{default:j(()=>[f[5]||(f[5]=k("p",null,"Are you sure you want to submit your exam?",-1)),k("div",Y,[k("div",B," Answered: "+Q(de.value)+" / "+Q(s.questions.length)+" questions ",1),de.value<s.questions.length?(q(),h("div",G,[w(i,{name:"warning",size:"sm"}),S(" You have "+Q(s.questions.length-de.value)+" unanswered question(s) ",1)])):V("",!0)])]),_:1}),w(d,{align:"right"},{default:j(()=>[I(w(r,{flat:"",label:"Cancel",color:"primary"},null,512),[[c]]),w(r,{label:"Submit",color:"negative",onClick:ye,loading:oe.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},16)],64)}}},[["__scopeId","data-v-ddba3016"]]);export{X as default};
