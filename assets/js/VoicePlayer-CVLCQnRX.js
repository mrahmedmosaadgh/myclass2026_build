import{r as e,u as a,b as l,t as o}from"./app-Dtv5Fi9L.js";import{Q as t}from"./QLinearProgress-D6iXPeG1.js";import{f as r,a as u,k as n,o as i,e as s,N as v,J as d,R as c,O as f,b as m,V as p,K as y,W as h,n as g}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";const w={class:"voice-player"},k={class:"row items-center q-gutter-sm"},_={class:"col"},C={class:"text-caption text-grey-7 time-display"},R=["src"],W=e({__name:"VoicePlayer",props:{audioUrl:{type:String,required:!0},showWaveform:{type:Boolean,default:!1},autoplay:{type:Boolean,default:!1}},setup(e){const W=e,b=a(),x=r(null),E=r(null),j=r(null),S=r(!1),z=r(!1),T=r(0),B=r(0),U=r(!1),q=r(1),M=r([]),N=[.5,.75,1,1.25,1.5,2],P=u(()=>B.value>0?T.value/B.value:0),$=async()=>{if(x.value)try{S.value?x.value.pause():(z.value=!0,await x.value.play())}catch(e){console.error("Error playing audio:",e),b.notify({type:"negative",message:"Failed to play audio",position:"top"})}finally{z.value=!1}},A=e=>{if(!x.value||0===B.value)return;const a=e.target.getBoundingClientRect(),l=(e.clientX-a.left)/a.width*B.value;x.value.currentTime=l},D=e=>{if(!x.value||0===B.value)return;const a=E.value.getBoundingClientRect(),l=(e.clientX-a.left)/a.width*B.value;x.value.currentTime=l},L=()=>{x.value&&(U.value=!U.value,x.value.muted=U.value)},O=()=>{const e=(N.indexOf(q.value)+1)%N.length;q.value=N[e],x.value&&(x.value.playbackRate=q.value)},Q=()=>{const e=document.createElement("a");e.href=W.audioUrl,e.download=`voice-note-${Date.now()}.wav`,document.body.appendChild(e),e.click(),document.body.removeChild(e)},V=e=>{if(!e||isNaN(e))return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`},X=()=>{if(!E.value||!M.value.length)return;const e=E.value,a=e.getContext("2d"),l=e.width,o=e.height;a.clearRect(0,0,l,o),a.fillStyle="#1976d2";const t=l/M.value.length;M.value.forEach((e,l)=>{const r=e*o,u=l*t,n=(o-r)/2;a.fillRect(u,n,t-1,r)}),P.value>0&&(a.fillStyle="rgba(25, 118, 210, 0.3)",a.fillRect(0,0,l*P.value,o))},F=()=>{B.value=x.value.duration,W.autoplay&&$(),W.showWaveform&&(async()=>{if(W.showWaveform&&x.value)try{const e=100,a=[];for(let l=0;l<e;l++)a.push(.8*Math.random()+.1);M.value=a,await g(),X()}catch(e){console.error("Error generating waveform:",e)}})()},I=()=>{T.value=x.value.currentTime,W.showWaveform&&X()},J=()=>{S.value=!1,T.value=0,W.showWaveform&&X()},K=e=>{console.error("Audio error:",e),z.value=!1,b.notify({type:"negative",message:"Error loading audio file",position:"top"})};return n(()=>{var e;return null==(e=x.value)?void 0:e.paused},e=>{S.value=!e}),n(()=>W.audioUrl,()=>{x.value&&x.value.load()}),i(()=>{if(E.value&&W.showWaveform){const e=E.value;e.width=e.offsetWidth,e.height=60}}),s(()=>{x.value&&x.value.pause()}),(a,r)=>(d(),v("div",w,[c("div",k,[m(l,{icon:S.value?"pause":"play_arrow",round:"",color:"primary",size:"sm",onClick:$,loading:z.value},null,8,["icon","loading"]),c("div",_,[m(t,{value:P.value,color:"primary","track-color":"grey-3",size:"8px",rounded:"",class:"cursor-pointer",onClick:A},null,8,["value"])]),c("div",C,p(V(T.value))+" / "+p(V(B.value)),1),m(l,{icon:U.value?"volume_off":"volume_up",flat:"",round:"",size:"sm",onClick:L},null,8,["icon"]),m(l,{icon:"download",flat:"",round:"",size:"sm",onClick:Q},{default:y(()=>[m(o,null,{default:y(()=>r[0]||(r[0]=[h("Download Audio")])),_:1})]),_:1}),m(l,{flat:"",round:"",size:"sm",onClick:O,class:"speed-btn"},{default:y(()=>[h(p(q.value)+"x ",1),m(o,null,{default:y(()=>r[1]||(r[1]=[h("Playback Speed")])),_:1})]),_:1})]),e.showWaveform?(d(),v("div",{key:0,class:"waveform-container q-mt-sm",ref_key:"waveformRef",ref:j},[c("canvas",{ref_key:"canvasRef",ref:E,class:"waveform-canvas",onClick:D},null,512)],512)):f("",!0),c("audio",{ref_key:"audioRef",ref:x,src:e.audioUrl,preload:"metadata",onLoadedmetadata:F,onTimeupdate:I,onEnded:J,onError:K},null,40,R)]))}},[["__scopeId","data-v-7967f027"]]);export{W as default};
