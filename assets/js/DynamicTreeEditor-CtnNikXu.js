import e from"./TreeNode-3E8_x6L2.js";import{f as a,o as t,Z as l,L as s,I as r,O as n,M as o,U as i,x as u,ab as d,V as c,F as v,Q as p,R as g,H as x,S as y}from"./vendor-EI0FRBVb.js";import{p as m}from"./app-Dccx8xF5.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./ui-B__oX9pK.js";const b={class:"p-6 space-y-4"},f={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},h={class:"bg-white p-6 rounded-lg shadow-lg text-center"},w={class:"bg-white p-4 rounded shadow"},k={class:"flex flex-col md:flex-row md:items-center gap-4 mb-4"},C={class:"flex-grow"},T={key:0,class:"mb-4 bg-gray-50 p-3 rounded border"},j={key:0,class:"text-gray-500 italic"},N={key:1,class:"space-y-2 max-h-40 overflow-y-auto"},S=["onClick"],_={class:"text-xs text-gray-500"},E={class:"flex flex-wrap gap-2"},L={class:"mr-1"},A={class:"tree bg-white p-4 rounded shadow"},z={key:0,class:"text-center text-gray-500 py-10"},D={key:1,class:"relative"},F={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},I={class:"bg-white p-6 rounded-lg shadow-lg max-w-md w-full"},M={class:"text-lg font-medium mb-4"},P={class:"fixed bottom-4 right-4 z-50"},R={class:"flex items-center"},U={class:"mr-2"},V=m({__name:"DynamicTreeEditor",setup(m){const V=a([]),$=a("My Tree Structure"),H=a(!1),O=a(""),B=a(!1),Q=a([]),Z=a(!1),q=a(1),G=a(null),J=a({visible:!1,y:0}),K=a(!1),W=a(""),X=a(null),Y=a(null),ee=a([]);t(async()=>{await ae()});const ae=async()=>{xe(!0,"Loading tree data...");try{const e=await l.get("/api/tree-structures/latest");e.data?($.value=e.data.name,V.value=e.data.tree_data,G.value=e.data.id,re(),ye("Tree loaded successfully","success")):te()}catch(e){console.error("Error loading tree data:",e),ye("Failed to load tree data. Starting with empty tree.","error"),te()}finally{xe(!1)}},te=()=>{V.value=[],q.value=1,G.value=null},le=()=>{ve("Create a new tree? Any unsaved changes will be lost.",()=>{$.value="New Tree Structure",V.value=[],q.value=1,G.value=null,ye("New tree created","info")})},se=async()=>{xe(!0,"Loading available trees...");try{const e=await l.get("/api/tree-structures");Q.value=e.data,B.value=!0}catch(e){console.error("Error loading tree list:",e),ye("Failed to load tree list","error")}finally{xe(!1)}},re=()=>{let e=0;const a=t=>{for(const l of t)l.id>e&&(e=l.id),l.children&&l.children.length>0&&a(l.children)};a(V.value),q.value=e+1},ne=()=>{V.value.push({id:q.value++,text:"",children:[],editing:!0,expanded:!0})},oe=async()=>{if($.value.trim()){xe(!0,"Saving tree...");try{const e={name:$.value,tree_data:V.value};let a;G.value?a=await l.put(`/api/tree-structures/${G.value}`,e):(a=await l.post("/api/tree-structures",e),G.value=a.data.id),ye("Tree saved successfully","success")}catch(e){console.error("Error saving tree:",e),ye("Failed to save tree","error")}finally{xe(!1)}}else ye("Please enter a tree name","error")},ie=()=>{Z.value=!Z.value;const e=a=>{for(const t of a)t.expanded=Z.value,t.children&&t.children.length>0&&e(t.children)};e(V.value)},ue=()=>{},de=e=>{J.value.visible=!0,J.value.y=e.y},ce=e=>{J.value.visible=!1;const{sourceParent:a,sourceIndex:t,targetParent:l,targetIndex:s}=e,[r]=a.splice(t,1);l.splice(s,0,r)},ve=(e,a,t=null)=>{W.value=e,X.value=a,Y.value=t,K.value=!0},pe=()=>{K.value=!1,X.value=null,Y.value=null},ge=()=>{X.value&&(Y.value?X.value(Y.value):X.value()),K.value=!1,X.value=null,Y.value=null},xe=(e,a="")=>{H.value=e,O.value=a},ye=(e,a="info")=>{const t={message:e,type:a};ee.value.push(t),setTimeout(()=>{const e=ee.value.indexOf(t);-1!==e&&ee.value.splice(e,1)},3e3)},me=e=>{if(!e)return"";const a=new Date(e);return a.toLocaleDateString()+" "+a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};return(a,t)=>(r(),s("div",b,[H.value?(r(),s("div",f,[o("div",h,[t[2]||(t[2]=o("svg",{class:"animate-spin h-10 w-10 text-blue-500 mx-auto mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[o("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),o("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),o("p",null,i(O.value),1)])])):n("",!0),o("div",w,[o("div",k,[o("div",C,[t[3]||(t[3]=o("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tree Name",-1)),u(o("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>$.value=e),type:"text",class:"border rounded p-2 w-full",placeholder:"Enter tree name"},null,512),[[d,$.value]])]),o("div",{class:"flex gap-2"},[o("button",{onClick:se,class:"bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded flex items-center"},t[4]||(t[4]=[o("span",{class:"mr-1"},"üìã",-1),c(" Load ")])),o("button",{onClick:le,class:"bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded flex items-center"},t[5]||(t[5]=[o("span",{class:"mr-1"},"üìù",-1),c(" New ")]))])]),B.value?(r(),s("div",T,[t[6]||(t[6]=o("h3",{class:"font-medium mb-2"},"Select a Tree",-1)),0===Q.value.length?(r(),s("div",j,"No saved trees found")):(r(),s("div",N,[(r(!0),s(v,null,p(Q.value,e=>(r(),s("div",{key:e.id,class:"flex justify-between items-center p-2 hover:bg-gray-100 rounded cursor-pointer",onClick:a=>(async e=>{xe(!0,"Loading selected tree..."),B.value=!1;try{const a=await l.get(`/api/tree-structures/${e}`);$.value=a.data.name,V.value=a.data.tree_data,G.value=a.data.id,re(),ye("Tree loaded successfully","success")}catch(a){console.error("Error loading tree:",a),ye("Failed to load tree","error")}finally{xe(!1)}})(e.id)},[o("span",null,i(e.name),1),o("span",_,i(me(e.updated_at)),1)],8,S))),128))])),o("button",{onClick:t[1]||(t[1]=e=>B.value=!1),class:"mt-2 text-sm text-gray-500"},"Cancel")])):n("",!0)]),o("div",E,[o("button",{onClick:ne,class:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded flex items-center"},t[7]||(t[7]=[o("span",{class:"mr-1"},"‚ûï",-1),c(" Add Root Node ")])),o("button",{onClick:oe,class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded flex items-center"},t[8]||(t[8]=[o("span",{class:"mr-1"},"üíæ",-1),c(" Save Tree ")])),o("button",{onClick:ie,class:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded flex items-center"},[o("span",L,i(Z.value?"üîº":"üîΩ"),1),c(" "+i(Z.value?"Collapse All":"Expand All"),1)])]),o("div",A,[0===V.value.length?(r(),s("div",z,t[9]||(t[9]=[o("p",{class:"text-xl mb-2"},"No nodes yet",-1),o("p",null,'Click "Add Root Node" to start building your tree',-1)]))):(r(),s("div",D,[J.value.visible?(r(),s("div",{key:0,class:"absolute h-0.5 bg-blue-500 transition-all",style:g({left:"0",right:"0",top:`${J.value.y}px`})},null,4)):n("",!0),(r(!0),s(v,null,p(V.value,(a,t)=>(r(),x(e,{key:a.id,node:a,parent:V.value,index:t,"expand-all":Z.value,onUpdate:ue,onNodeDrag:de,onNodeDrop:ce},null,8,["node","parent","index","expand-all"]))),128))]))]),K.value?(r(),s("div",F,[o("div",I,[o("h3",M,i(W.value),1),o("div",{class:"flex justify-end gap-2"},[o("button",{onClick:pe,class:"px-4 py-2 border rounded hover:bg-gray-100"},"Cancel"),o("button",{onClick:ge,class:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"},"Confirm")])])])):n("",!0),o("div",P,[(r(!0),s(v,null,p(ee.value,(e,a)=>(r(),s("div",{key:a,class:y(["mb-2 p-3 rounded shadow-lg max-w-xs transform transition-all duration-300",["success"===e.type?"bg-green-500 text-white":"error"===e.type?"bg-red-500 text-white":"bg-blue-500 text-white"]])},[o("div",R,[o("span",U,i("success"===e.type?"‚úÖ":"error"===e.type?"‚ùå":"‚ÑπÔ∏è"),1),o("span",null,i(e.message),1)])],2))),128))])]))}},[["__scopeId","data-v-c066e076"]]);export{V as default};
