import{Q as e}from"./QBtnToggle-B_4qjjv0.js";import{o as a,u as l,c as t,d as s,Q as o,m as i,b as n,a as r,h as d,i as u,j as c,l as v,e as m,f as p,aP as g,C as b,A as f,k as y,p as x}from"./app-BB4Fw2oM.js";import{Q as h,a as w}from"./QToolbar-C7aOZqau.js";import{Q as _}from"./QTab-BFa-NGCD.js";import{Q as S}from"./QTabs-CG-V162G.js";import{Q as k}from"./QTabPanel-BKNysMBn.js";import{Q as $}from"./QSelect-BImwntZk.js";import{Q as j}from"./QBadge-BkpTfeZ_.js";import{Q as C}from"./QTabPanels-ewjb0pYP.js";import{u as V}from"./i18n-DE5KxGn8.js";import{O as z,a as I,f as U,k as A,o as N,_ as F,af as P,M as Q,J as E,b as T,N as R,I as B,Q as D,K as L,V as O,z as q,l as M,y as W,W as G,F as K,R as J,ag as Z,ah as H,U as Y}from"./vendor-DuKqz2x4.js";import{r as X}from"./reward_sys_point_action-CqMZi24d.js";import ee from"./PeriodSelectionRefactored-Dsi6o1eW.js";import ae from"./ClassroomSelection-9N_8qGdF.js";import le from"./TopLeaderboard-Cv8pgKof.js";import te from"./StudentCard-uMuLzFKJ.js";import se from"./StudentGrouping-CIDWypEc.js";import oe from"./BehaviorIncidents-CfgeQvIj.js";import"./offline-BzIlwqNM.js";import"./ui-BITzTqrO.js";import"./rtl-Cr6c3OOr.js";import"./use-panel-DoNmfVmh.js";import"./use-render-cache-CmTcazfP.js";import"./html2canvas.esm-Cq3pa7K9.js";import"./CertificateGenerator-CYr2_LKB.js";import"./QSpace-CfcdpSpD.js";import"./QBar-BiJGvmBl.js";import"./QSlider-efS6zDHu.js";import"./jspdf.es.min-BOiSIJXt.js";import"./AvatarManager-CiGYL42s.js";import"./CameraCapture-JMGA11EA.js";import"./vuedraggable.umd-CABkNphu.js";import"./index-DJPqu1_-.js";import"./IncidentPrintReport-B6mEZSJk.js";const ie={class:"p-6 space-y-6 bg-gradient-to-br from-blue-50 to-indigo-50 min-h-screen"},ne={class:"text-3xl font-bold"},re={class:"text-blue-100"},de={class:"flex items-center justify-between bg-white p-4 rounded-lg border border-gray-200 shadow-sm"},ue={class:"flex items-center gap-4"},ce={class:"bg-blue-100 p-3 rounded-full text-blue-600"},ve={class:"text-sm text-gray-500 font-medium"},me={class:"text-lg font-bold text-gray-800 flex items-center gap-2"},pe={key:0},ge={key:1,class:"text-gray-400 italic"},be={class:"text-blue-600 font-mono bg-blue-50 px-2 py-0.5 rounded text-base"},fe={class:"text-xs text-gray-500 mt-1"},ye={class:"max-w-7xl mx-auto space-y-8"},xe={class:"bg-white p-6 rounded-xl shadow-sm border border-gray-200"},he={class:"text-lg font-bold text-gray-700 mb-4 flex items-center gap-2"},we={class:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-100 flex justify-center"},_e={class:"text-sm text-gray-700"},Se={class:"font-bold text-blue-600 font-mono text-lg"},ke={class:"bg-white p-6 rounded-xl shadow-sm border border-gray-200"},$e={class:"text-lg font-bold text-gray-700 mb-4 flex items-center gap-2"},je={key:0,class:"mt-4"},Ce={class:"text-md font-semibold text-gray-600 mb-3 flex items-center gap-2"},Ve={key:1,class:"text-center py-8 text-gray-400"},ze={class:"space-y-4"},Ie={class:"flex justify-between items-center mb-4"},Ue={class:"text-xl font-bold"},Ae={class:"flex gap-2"},Ne={class:"flex flex-wrap justify-center gap-6 p-4"},Fe={class:""},Pe={class:"mb-4 grid grid-cols-1 md:grid-cols-3 gap-3"},Qe={class:"text-green-800 font-bold flex items-center gap-2"},Ee={class:"text-2xl font-bold text-green-600"},Te={class:"text-red-800 font-bold flex items-center gap-2"},Re={class:"text-2xl font-bold text-red-600"},Be={class:"text-gray-800 font-bold flex items-center gap-2"},De={class:"flex items-center justify-between gap-4"},Le={class:"flex items-center gap-3 flex-1"},Oe={class:"font-bold text-gray-700"},qe={class:"flex flex-col md:flex-row gap-6 mt-6"},Me={class:"w-full md:w-fit flex-shrink-0"},We={class:"sticky top-4"},Ge={class:"bg-blue-50 rounded-xl border border-blue-100 p-4 shadow-sm"},Ke={class:"font-bold text-blue-800 mb-3 flex items-center gap-2"},Je={key:0,class:"text-center py-8 text-gray-400 italic text-sm"},Ze={key:1,class:"flex flex-col gap-2 max-h-[calc(100vh-300px)] overflow-y-auto custom-scrollbar pr-1"},He={class:"leading-tight overflow-hidden w-full"},Ye={class:"font-bold w-32 inline-block text-xl"},Xe={class:"text-xs opacity-80 truncate"},ea={class:"mt-4 pt-3 border-t border-blue-200 space-y-2"},aa={class:"grid grid-cols-3 gap-1"},la={class:"grid grid-cols-2 gap-2 pt-2"},ta={class:"flex-1"},sa={key:0,class:"mb-3 p-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg border border-indigo-200"},oa={class:"font-bold text-indigo-900 flex items-center gap-2"},ia={class:"flex flex-wrap justify-center gap-4"},na={class:"space-y-4"},ra={class:"mb-4"},da={class:"text-xl font-bold mb-2"},ua={class:"text-sm text-gray-600"},ca={class:"p-4 bg-red-50 rounded-lg border border-red-200"},va={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},ma={class:"mt-2 text-sm"},pa={class:"flex flex-wrap justify-center gap-6 p-4"},ga={class:"space-y-4"},ba={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},fa=["onClick"],ya={class:"flex items-start justify-between mb-3"},xa={class:"flex-1"},ha={class:"font-semibold text-lg"},wa={class:"text-xs text-gray-600"},_a={key:0,class:"text-xs text-red-600 mt-1"},Sa={class:"space-y-2"},ka={class:"p-2 bg-green-100 rounded flex justify-between items-center"},$a={class:"text-sm font-bold text-green-900"},ja={class:"p-2 bg-red-100 rounded flex justify-between items-center"},Ca={class:"text-sm font-bold text-red-900"},Va={class:"p-2 bg-blue-100 rounded flex justify-between items-center"},za={class:"text-lg font-bold text-blue-600"},Ia={class:"space-y-4"},Ua={class:"flex justify-between items-center mb-4"},Aa={class:"text-xl font-bold"},Na={key:0,class:"text-center py-8"},Fa={class:"text-gray-500 text-lg"},Pa={class:"flex items-start justify-between"},Qa={class:"flex-1"},Ea={class:"flex items-center gap-2 mb-1"},Ta={class:"font-bold text-lg"},Ra={class:"text-2xl"},Ba={class:"text-sm text-gray-700"},Da={class:"text-xs text-gray-500 mt-1"},La={key:0,class:"text-xs text-gray-600 mt-1 italic"},Oa={key:1,class:"text-xs text-red-600 mt-1"},qa={class:"flex flex-col h-full gap-4"},Ma={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},Wa={class:"space-y-6"},Ga={class:"flex justify-between items-center mb-6"},Ka={class:"text-2xl font-bold text-gray-800"},Ja={class:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200"},Za={class:"flex items-center gap-3 mb-4"},Ha={class:"text-xl font-bold text-green-800"},Ya={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Xa={class:"flex items-start justify-between mb-2"},el={class:"flex items-center gap-2"},al={class:"text-3xl"},ll={class:"font-bold text-gray-800"},tl={class:"text-xs text-gray-500"},sl={class:"flex gap-1"},ol={class:"flex items-center justify-between mt-3 pt-3 border-t border-green-100"},il={class:"text-lg font-bold text-green-600"},nl={key:0,class:"text-center py-8 text-gray-400"},rl={class:"bg-gradient-to-r from-red-50 to-rose-50 rounded-xl p-6 border border-red-200"},dl={class:"flex items-center gap-3 mb-4"},ul={class:"text-xl font-bold text-red-800"},cl={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},vl={class:"flex items-start justify-between mb-2"},ml={class:"flex items-center gap-2"},pl={class:"text-3xl"},gl={class:"font-bold text-gray-800"},bl={class:"text-xs text-gray-500"},fl={class:"flex gap-1"},yl={class:"flex items-center justify-between mt-3 pt-3 border-t border-red-100"},xl={class:"text-lg font-bold text-red-600"},hl={key:0,class:"text-center py-8 text-gray-400"},wl={class:"text-2xl font-semibold text-gray-600"},_l={class:"p-4 border-b border-blue-200 bg-blue-100/50"},Sl={class:"font-bold text-blue-900 flex items-center gap-2 text-lg"},kl={class:"flex-1 overflow-y-auto p-4 custom-scrollbar"},$l={key:0,class:"text-center py-8 text-gray-400 italic text-sm"},jl={key:1,class:"flex flex-col gap-2"},Cl={class:"flex flex-col leading-tight overflow-hidden w-full"},Vl={class:"font-bold text-2xl truncate"},zl={class:"text-sm opacity-80 truncate"},Il={class:"p-3 border-t border-blue-200 bg-white"},Ul={class:"grid grid-cols-3 gap-2"},Al={class:"flex-1 flex flex-col bg-white"},Nl={class:"text-h6 font-bold flex items-center gap-2"},Fl={class:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3"},Pl=["onClick"],Ql={class:"font-bold text-xl leading-tight text-gray-800 line-clamp-2"},El={class:"flex justify-between items-center"},Tl={class:"text-h6"},Rl=a({__name:"reward_sys",setup(a){const{t:Rl,locale:Bl}=V(),Dl=e=>e?"ar"===Bl.value&&e.name_ar?e.name_ar:e.name:"",Ll=z(),Ol=I(()=>{var e,a;const l=null==(a=null==(e=Ll.props.auth)?void 0:e.user)?void 0:a.school;return Array.isArray(l)&&l.length>0?l[0].logo_url:null}),ql=I(()=>{const e=new Map;return Hl.value.forEach(a=>{a.subject_id&&!e.has(a.subject_id)&&e.set(a.subject_id,{id:a.subject_id,name:a.subject_name,name_ar:a.subject_name_ar})}),Array.from(e.values())}),Ml=I(()=>at.value?Hl.value.filter(e=>e.subject_id===at.value):[]),Wl=I(()=>{const e=Yl.value.length;if(0===e)return{present:0,absent:0,absentList:[]};const a=Yl.value.filter(e=>ct.value[e.id]).length;return{present:a,absent:e-a,absentList:Yl.value.filter(e=>!ct.value[e.id])}}),Gl=()=>{const e=Wl.value.absentList.map(e=>"ar"===Bl.value&&e.name_ar?e.name_ar:e.name).join("\n");e&&navigator.clipboard.writeText(e).then(()=>{Kl.notify({message:Rl("rewardSys.session.copied"),color:"positive",icon:"content_copy",position:"top"})}).catch(e=>{console.error("Failed to copy: ",e)})};U("https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf");const Kl=l(),Jl=U("attendance"),Zl=U("behavior_incidents");A(Jl,(e,a)=>{e!==a&&(dt.value=[])});const Hl=U([]),Yl=U([]),Xl=U([]),et=U(null),at=U(null),lt=U((new Date).toISOString().split("T")[0]),tt=U(1),st=U(1),ot=U(1),it=U(1),nt=U(null),rt=U(null),dt=U([]),ut=U({}),ct=U({}),vt=U({}),mt=U([]);U([]);const pt=U(!1),gt=U(!1),bt=U(!1),ft=U(!1),yt=U(!1),xt=U(null),ht=U(null),wt=U({message:"",created:0,skipped:0}),_t=U(!0),St=U(!1),kt=U(!1),$t=U("positive"),jt=U(null),Ct=U("no_groups"),Vt=U([]),zt=U(!1),It=U(null),Ut=U(!1),At=U(null),Nt=U(!1),Ft=U({name:"",type:"positive",points:0,icon:""});A(at,e=>{null!==e&&(localStorage.setItem("reward-system-selected-subject-id",e.toString()),console.log(`ðŸ’¾ Saved subject to localStorage: ${e}`))}),A(et,e=>{null!==e&&(localStorage.setItem("reward-system-selected-classroom-id",e.toString()),console.log(`ðŸ’¾ Saved classroom to localStorage: ${e}`))});const Pt=I(()=>`${tt.value}.${st.value}.${ot.value}.${it.value}`),Qt=I(()=>{console.log("ðŸ” All behaviors:",Xl.value);const e=Xl.value.filter(e=>{if(e.type)return"positive"===e.type||"reward"===e.type;return(e.value||e.points||0)>0});return console.log("âœ… Positive behaviors:",e),e}),Et=I(()=>{const e=Xl.value.filter(e=>{if(e.type)return"negative"===e.type||"penalty"===e.type;return(e.value||e.points||0)<0});return console.log("âš ï¸ Negative behaviors:",e),e}),Tt=I(()=>[{label:"No Groups",value:"no_groups",icon:"grid_view"},{label:"Name (Aâ†’Z)",value:"name_asc",icon:"sort_by_alpha"},{label:"Name (Zâ†’A)",value:"name_desc",icon:"sort_by_alpha"},...Vt.value.map(e=>({label:e.name,value:e.id,icon:"groups"}))]),Rt=I(()=>{const e=Tt.value.find(e=>e.value===Ct.value);return(null==e?void 0:e.icon)||"grid_view"}),Bt=I(()=>{if("no_groups"===Ct.value)return[{name:null,students:Yl.value}];if("name_asc"===Ct.value){return[{name:null,students:[...Yl.value].sort((e,a)=>(e.firstName||"").localeCompare(a.firstName||""))}]}if("name_desc"===Ct.value){return[{name:null,students:[...Yl.value].sort((e,a)=>(a.firstName||"").localeCompare(e.firstName||""))}]}const e=Vt.value.find(e=>e.id===Ct.value);if(!e)return[{name:null,students:Yl.value}];const a=e.groups.map(e=>({name:e.name,students:Yl.value.filter(a=>e.student_ids.includes(a.id))})),l=new Set(e.groups.flatMap(e=>e.student_ids)),t=Yl.value.filter(e=>!l.has(e.id));return t.length>0&&a.push({name:"Unassigned",students:t}),a});function Dt(){const e=Yl.value.filter(e=>ct.value[e.id]);dt.value=e.map(e=>e.id)}function Lt(){const e=Yl.value.filter(e=>ct.value[e.id]),a=new Set(dt.value),l=[];e.forEach(e=>{a.has(e.id)||l.push(e.id)}),dt.value=l}function Ot(e){0!==dt.value.length?($t.value=e,jt.value=null,kt.value=!0):Kl.notify({message:"Please select students first",color:"warning",position:"top"})}async function qt(){jt.value&&("positive"===$t.value?(nt.value=jt.value,await async function(){await ls(nt.value),nt.value=null}()):(rt.value=jt.value,await as()),kt.value=!1,jt.value=null)}async function Mt(e){var a,l;const t=Vt.value.findIndex(a=>a.id===e.id);t>=0?Vt.value[t]=e:Vt.value.push(e);try{const a=await F.post("/api/classroom-layouts/save",{classroom_id:et.value,layouts:Vt.value});if(!a.data.success)throw new Error(a.data.message||"Failed to save layout");Kl.notify({message:`Layout "${e.name}" saved successfully!`,color:"positive",position:"top",icon:"check_circle"}),Ct.value=e.id,zt.value=!1,It.value=null}catch(s){if(console.error("Error saving layout:",s),Kl.notify({message:"Failed to save layout: "+((null==(l=null==(a=s.response)?void 0:a.data)?void 0:l.message)||s.message),color:"negative",position:"top",icon:"error"}),t>=0)Vt.value.splice(t,1);else{const a=Vt.value.findIndex(a=>a.id===e.id);a>=0&&Vt.value.splice(a,1)}}}async function Wt(e){var a,l;const t=Vt.value.findIndex(a=>a.id===e);if(t<0)return;const s=Vt.value[t];Vt.value.splice(t,1),Ct.value===e&&(Ct.value="no_groups");try{const e=await F.post("/api/classroom-layouts/save",{classroom_id:et.value,layouts:Vt.value});if(!e.data.success)throw new Error(e.data.message||"Failed to delete layout");Kl.notify({message:`Layout "${s.name}" deleted successfully!`,color:"positive",position:"top",icon:"delete"})}catch(o){console.error("Error deleting layout:",o),Kl.notify({message:"Failed to delete layout: "+((null==(l=null==(a=o.response)?void 0:a.data)?void 0:l.message)||o.message),color:"negative",position:"top",icon:"error"}),Vt.value.splice(t,0,s),"no_groups"===Ct.value&&(Ct.value=e)}}function Gt(e){e?(At.value=e,Ft.value={name:e.name,type:e.type||(e.value>0?"positive":"negative"),points:e.value||e.points||0,icon:e.icon||""}):(At.value=null,Ft.value={name:"",type:"positive",points:0,icon:""}),Ut.value=!0}async function Kt(){var e,a;if(Ft.value.name&&Ft.value.type&&null!==Ft.value.points){Nt.value=!0;try{const e={name:Ft.value.name,name_ar:Ft.value.name_ar||null,type:Ft.value.type,value:Ft.value.points,points:Ft.value.points,icon:Ft.value.icon||null,school_id:1,year_id:2};if(At.value){const a=await F.put(`/api/behaviors/${At.value.id}`,e),l=Xl.value.findIndex(e=>e.id===At.value.id);l>=0&&(Xl.value[l]=a.data),Kl.notify({message:"Behavior updated successfully!",color:"positive",icon:"check_circle"})}else{const a=await F.post("/api/behaviors",e);Xl.value.push(a.data),Kl.notify({message:"Behavior created successfully!",color:"positive",icon:"check_circle"})}Ut.value=!1,At.value=null}catch(l){console.error("Error saving behavior:",l),Kl.notify({message:"Failed to save behavior: "+((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||l.message),color:"negative",icon:"error"})}finally{Nt.value=!1}}else Kl.notify({message:"Please fill in all required fields",color:"warning",position:"top"})}function Jt(e){Kl.dialog({title:"Confirm Delete",message:`Are you sure you want to delete "${e.name}"? This action cannot be undone.`,cancel:!0,persistent:!0,color:"negative"}).onOk(()=>{!async function(e){var a,l;try{await F.delete(`/api/behaviors/${e.id}`);const a=Xl.value.findIndex(a=>a.id===e.id);a>=0&&Xl.value.splice(a,1),Kl.notify({message:"Behavior deleted successfully!",color:"positive",icon:"check_circle"})}catch(t){console.error("Error deleting behavior:",t),Kl.notify({message:"Failed to delete behavior: "+((null==(l=null==(a=t.response)?void 0:a.data)?void 0:l.message)||t.message),color:"negative",icon:"error"})}}(e)})}function Zt(e){lt.value=e.date,tt.value=e.semester,st.value=e.week,ot.value=e.day,it.value=e.periodNumber,console.log("ðŸ“… Period changed:",{periodCode:Pt.value,...e})}function Ht(e){if(!ct.value[e])return void Kl.notify({message:"Cannot select absent students",color:"warning",position:"top",timeout:1e3});const a=dt.value.indexOf(e);-1===a?dt.value.push(e):dt.value.splice(a,1)}function Yt(){dt.value=[]}async function Xt(e){if(!e)return Yl.value=[],dt.value=[],void(Vt.value=[]);try{gt.value=!0,Yl.value=[],dt.value=[],ht.value=null,wt.value={message:"",created:0,skipped:0},await async function(){if(et.value)try{const e=await F.get("/api/classroom-layouts/load",{params:{classroom_id:et.value}});e.data.success&&(Vt.value=e.data.data||[])}catch(e){console.error("Error loading layouts:",e)}}()}catch(a){console.error("Failed to load classroom:",a),Kl.notify({message:"Failed to load classroom: "+a.message,color:"negative",position:"top"})}finally{gt.value=!1}}async function es(){if(et.value){gt.value=!0,wt.value={message:"Initializing...",created:0,skipped:0};try{const e={classroom_id:et.value,date:lt.value,period_code:Pt.value},a=await F.post("/api/student-behaviors/init-classroom",e);if(a&&a.data){const e=a.data;ht.value=e.student_behaviors_mains_id,wt.value={message:`Session initialized (created ${e.created}, skipped ${e.skipped})`,created:e.created,skipped:e.skipped};const l=e.student_behaviors||[],t=l.map(e=>({id:e.student.id,name:e.student.name||`Student ${e.student_id}`,name_ar:e.student.name_ar,firstName:e.student.first_name,secondName:e.student.second_name,lastName:e.student.last_name,avatar:e.student.avatar,behaviorRecordId:e.id}));Yl.value=t,dt.value=[];const s={};for(const a of l)ct.value[a.student_id]=void 0===a.attend||a.attend,s[a.student_id]={attend:void 0===a.attend||a.attend,points_plus:a.points_plus||0,points_minus:a.points_minus||0};ut.value=s,Kl.notify({message:"Session initialized",color:"positive",position:"top"}),await is(),_t.value=!1}}catch(e){console.error("Failed to init classroom session:",e),wt.value={message:"Initialization failed",created:0,skipped:0},Kl.notify({message:"Failed to init session: "+(e.message||"error"),color:"negative",position:"top"})}finally{gt.value=!1}}}async function as(){await ls(rt.value),rt.value=null}async function ls(e){if(dt.value.length&&e)try{bt.value=!0;const a=await X.applyBehaviorToStudents(dt.value,e,{date:lt.value,periodCode:Pt.value,classroomId:et.value});a.success?(Kl.notify({message:`Applied behavior to ${dt.value.length} students`,color:"positive",position:"top"}),await es(),dt.value=[]):Kl.notify({message:a.error||"Failed to apply behavior",color:"negative",position:"top"})}catch(a){console.error("Error applying behavior:",a),Kl.notify({message:a.message||"Error applying behavior",color:"negative",position:"top"})}finally{bt.value=!1}}async function ts(e,a,l){ct.value[e]=a,vt.value[e]=!0;try{const l=await X.updateAttendance(e,a,{date:lt.value,periodCode:Pt.value,classroomId:et.value});if(!l.success)throw new Error(l.error||"Failed to update attendance");Kl.notify({message:l.message||"Attendance updated",color:"positive",position:"top"}),!1===a&&await es()}catch(t){console.error("Failed to persist attendance for",e,t),ct.value[e]=l,Kl.notify({message:"Failed to update attendance. Reverted.",color:"negative",position:"top"})}finally{vt.value[e]=!1}}async function ss(){ft.value=!0;const e={};for(const l of Yl.value)e[l.id]=!0,ct.value[l.id]=!0;try{(await X.batchUpdateAttendance(e,{date:lt.value,periodCode:Pt.value,classroomId:et.value})).success&&Kl.notify({message:"All students marked present",color:"positive",position:"top"})}catch(a){console.error("Failed to mark all present:",a),Kl.notify({message:"Failed to mark all present",color:"negative",position:"top"})}finally{ft.value=!1}}async function os(){ft.value=!0;const e={};for(const l of Yl.value)e[l.id]=!1,ct.value[l.id]=!1;try{(await X.batchUpdateAttendance(e,{date:lt.value,periodCode:Pt.value,classroomId:et.value})).success&&Kl.notify({message:"All students marked absent",color:"warning",position:"top"})}catch(a){console.error("Failed to mark all absent:",a),Kl.notify({message:"Failed to mark all absent",color:"negative",position:"top"})}finally{ft.value=!1}}async function is(){yt.value=!0;try{const e=await X.getRecentActions({classroomId:et.value,date:lt.value,limit:10});e.success?mt.value=e.data:console.error("Failed to load history:",e.error)}catch(e){console.error("Error loading history:",e)}finally{yt.value=!1}}function ns(e){if(!e)return"";return new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}async function rs(e){console.log("Incident recorded:",e),await es(),Kl.notify({message:"Behavior incident recorded (-1 point)",color:"warning",position:"top"})}return N(async()=>{try{console.log("ðŸš€ Initializing reward system...");const e=await F.get("/my_classes_with_students");Hl.value=e.data,console.log(`âœ… Loaded ${Hl.value.length} classrooms`);const a=localStorage.getItem("reward-system-selected-subject-id"),l=localStorage.getItem("reward-system-selected-classroom-id");a&&ql.value.some(e=>e.id===parseInt(a))?(at.value=parseInt(a),console.log(`ðŸ“š Restored subject from localStorage: ${a}`)):ql.value.length>0&&(at.value=ql.value[0].id,console.log(`ðŸ“š Auto-selected first subject: ${ql.value[0].name}`)),l&&Hl.value.some(e=>e.classroom_id===parseInt(l))&&(et.value=parseInt(l),console.log(`ðŸ« Restored classroom from localStorage: ${l}`));const t=await X.fetchBehaviors();t.success?(Xl.value=t.data,console.log(`âœ… Loaded ${Xl.value.length} behaviors`),console.log("ðŸ“‹ Behaviors data:",Xl.value),Xl.value=Xl.value.map(e=>({...e,value:e.value||e.points||0})),console.log("ðŸ“‹ Normalized behaviors:",Xl.value)):(console.error("âŒ Failed to load behaviors:",t.error),Kl.notify({message:"Failed to load behaviors: "+t.error,color:"negative",position:"top"})),console.log("âœ… Reward system initialized")}catch(e){console.error("âŒ Failed to initialize reward system:",e),Kl.notify({message:"Failed to initialize reward system: "+e.message,color:"negative",position:"top"})}}),(a,l)=>{const V=P("Head");return E(),Q(K,null,[T(V,{title:"Reward System"}),R("div",ie,[T(i,{class:"shadow-lg rounded-2xl overflow-hidden"},{default:L(()=>[T(t,{class:"bg-gradient-to-r from-blue-500 to-indigo-600 text-white flex justify-between items-center"},{default:L(()=>[R("div",null,[R("h1",ne,"ðŸ† "+O(a.$t("rewardSys.behaviors.management")),1),R("p",re,O(a.$t("rewardSys.behaviors.management")),1)]),T(e,{modelValue:q(Bl),"onUpdate:modelValue":l[0]||(l[0]=e=>M(Bl)?Bl.value=e:null),options:[{label:"ðŸ‡¬ðŸ‡§ English",value:"en"},{label:"ðŸ‡¸ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",value:"ar"}],flat:"",color:"white","text-color":"white","toggle-color":"white","toggle-text-color":"primary",unelevated:""},null,8,["modelValue"])]),_:1}),T(t,{class:"p-6 space-y-4"},{default:L(()=>{var e;return[R("div",de,[R("div",ue,[R("div",ce,[T(s,{name:"event_note",size:"md"})]),R("div",null,[R("div",ve,O(a.$t("rewardSys.session.current")),1),R("div",me,[et.value?(E(),Q("span",pe,O((null==(e=Hl.value.find(e=>e.classroom_id===et.value))?void 0:e.classroom_name)||a.$t("rewardSys.session.unknownClass")),1)):(E(),Q("span",ge,O(a.$t("rewardSys.session.noClassroom")),1)),l[32]||(l[32]=R("span",{class:"text-gray-300"},"|",-1)),R("span",be,O(Pt.value),1)]),R("div",fe,O(new Date(lt.value).toLocaleDateString())+" â€¢ Period "+O(it.value),1)])]),T(o,{color:"primary",icon:"settings",label:a.$t("rewardSys.session.setupButton"),onClick:l[1]||(l[1]=e=>_t.value=!0),size:"lg",class:"shadow-md"},null,8,["label"])])]}),_:1})]),_:1}),T(n,{modelValue:_t.value,"onUpdate:modelValue":l[10]||(l[10]=e=>_t.value=e),"full-width":"","full-height":""},{default:L(()=>[T(i,{class:"flex flex-col bg-gray-50"},{default:L(()=>[T(h,{class:"bg-white border-b border-gray-200 p-4"},{default:L(()=>[T(w,{class:"text-xl font-bold text-gray-800 flex items-center gap-2"},{default:L(()=>[T(s,{name:"settings_suggest",color:"primary"}),G(" "+O(a.$t("rewardSys.session.setup")),1)]),_:1}),W(T(o,{flat:"",round:"",dense:"",icon:"close"},null,512),[[g]])]),_:1}),T(t,{class:"flex-1 overflow-auto p-6"},{default:L(()=>[R("div",ye,[R("div",xe,[R("h3",he,[T(s,{name:"schedule",class:"text-blue-500"}),G(" "+O(a.$t("rewardSys.session.timePeriod")),1)]),T(ee,{date:lt.value,semester:tt.value,week:st.value,day:ot.value,"period-number":it.value,"onUpdate:date":l[2]||(l[2]=e=>lt.value=e),"onUpdate:semester":l[3]||(l[3]=e=>tt.value=e),"onUpdate:week":l[4]||(l[4]=e=>st.value=e),"onUpdate:day":l[5]||(l[5]=e=>ot.value=e),"onUpdate:periodNumber":l[6]||(l[6]=e=>it.value=e),onChange:Zt,persist:!0,persistKey:"reward-system-period-selection"},null,8,["date","semester","week","day","period-number"]),R("div",we,[R("p",_e,[G(O(a.$t("rewardSys.session.activePeriodCode"))+" ",1),R("span",Se,O(Pt.value),1)])])]),R("div",ke,[R("h3",$e,[T(s,{name:"school",class:"text-blue-500"}),G(" "+O(a.$t("rewardSys.session.subject")),1)]),T(S,{modelValue:at.value,"onUpdate:modelValue":l[7]||(l[7]=e=>at.value=e),dense:"",class:"text-grey-7 mb-4","active-color":"primary","indicator-color":"primary",align:"left","narrow-indicator":""},{default:L(()=>[(E(!0),Q(K,null,J(ql.value,e=>(E(),B(_,{key:e.id,name:e.id,label:"ar"===q(Bl)&&e.name_ar?e.name_ar:e.name,class:"text-sm"},null,8,["name","label"]))),128))]),_:1},8,["modelValue"]),at.value?(E(),Q("div",je,[R("h4",Ce,[T(s,{name:"class",class:"text-green-500"}),G(" "+O(a.$t("rewardSys.session.classroom")),1)]),T(ae,{modelValue:et.value,"onUpdate:modelValue":l[8]||(l[8]=e=>et.value=e),classrooms:Ml.value,loading:gt.value,"init-status":wt.value,"avatar-edit-enabled":St.value,"onUpdate:avatarEditEnabled":l[9]||(l[9]=e=>St.value=e),onChange:Xt,onInit:es},null,8,["modelValue","classrooms","loading","init-status","avatar-edit-enabled"])])):(E(),Q("div",Ve,[T(s,{name:"subject",size:"3rem",class:"mb-2"}),R("p",null,O(a.$t("rewardSys.session.selectSubject")),1)]))])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),Yl.value.length?(E(),B(i,{key:0,class:"shadow-lg rounded-2xl"},{default:L(()=>[T(S,{modelValue:Jl.value,"onUpdate:modelValue":l[12]||(l[12]=e=>Jl.value=e),dense:"",class:"text-grey-7","active-color":"primary","indicator-color":"primary",align:"left"},{default:L(()=>[T(_,{name:"attendance",icon:"how_to_reg",label:a.$t("rewardSys.tabs.attendance")},null,8,["label"]),T(_,{name:"positive",icon:"add_circle",label:a.$t("rewardSys.tabs.positivePoints")},null,8,["label"]),T(_,{name:"history",icon:"cancel",label:a.$t("rewardSys.tabs.history")},null,8,["label"]),T(_,{name:"champions",icon:"emoji_events",label:a.$t("rewardSys.tabs.champions"),onClick:l[11]||(l[11]=e=>pt.value=!0)},null,8,["label"]),T(_,{name:"settings_reports",icon:"settings_applications",label:a.$t("rewardSys.tabs.settingsReports")},null,8,["label"])]),_:1},8,["modelValue"]),T(r),T(C,{modelValue:Jl.value,"onUpdate:modelValue":l[21]||(l[21]=e=>Jl.value=e),animated:""},{default:L(()=>[T(k,{name:"attendance"},{default:L(()=>[R("div",ze,[R("div",Ie,[R("h3",Ue,O(a.$t("rewardSys.attendance.manage")),1),R("div",Ae,[T(o,{color:"positive",label:a.$t("rewardSys.attendance.markAllPresent"),onClick:ss,loading:ft.value},null,8,["label","loading"]),T(o,{color:"warning",label:a.$t("rewardSys.attendance.markAllAbsent"),onClick:os,loading:ft.value},null,8,["label","loading"])])]),R("div",Ne,[(E(!0),Q(K,null,J(Yl.value,e=>{var a,l,t,s;return E(),B(te,{key:e.id,student:e,"disable-behavior":!ct.value[e.id],"allow-disabled-click":!0,"avatar-edit-enabled":St.value,"student-summary":{positive:(null==(a=ut.value[e.id])?void 0:a.points_plus)||0,negative:(null==(l=ut.value[e.id])?void 0:l.points_minus)||0,total:((null==(t=ut.value[e.id])?void 0:t.points_plus)||0)-((null==(s=ut.value[e.id])?void 0:s.points_minus)||0)},onSelect:a=>async function(e){const a=void 0===ct.value[e]||ct.value[e],l=!a;if(!1===l){const t=ut.value[e];if(t&&(t.points_plus>0||t.points_minus>0))return void Kl.dialog({title:"Warning",message:`This student has ${t.points_plus} positive and ${t.points_minus} negative points for this session. Marking them absent will remove all their points for this session. Continue?`,cancel:!0,persistent:!0,ok:{label:"Yes, Mark Absent",color:"negative"},cancel:{label:"Cancel",color:"grey"}}).onOk(async()=>{await ts(e,l,a)})}await ts(e,l,a)}(e.id)},null,8,["student","disable-behavior","avatar-edit-enabled","student-summary","onSelect"])}),128))])])]),_:1}),T(k,{name:"positive"},{default:L(()=>[R("div",Fe,[R("div",Pe,[T(i,{class:"shadow-sm border border-green-200 bg-green-50"},{default:L(()=>[T(t,{class:"flex items-center justify-between p-3"},{default:L(()=>[R("div",Qe,[T(s,{name:"check_circle"}),G(" "+O(a.$t("rewardSys.session.present")),1)]),R("div",Ee,O(Wl.value.present),1)]),_:1})]),_:1}),T(i,{class:"shadow-sm border border-red-200 bg-red-50"},{default:L(()=>[T(t,{class:"flex items-center justify-between p-3"},{default:L(()=>[R("div",Te,[T(s,{name:"cancel"}),G(" "+O(a.$t("rewardSys.session.absent")),1)]),R("div",Re,O(Wl.value.absent),1)]),_:1})]),_:1}),T(i,{class:"shadow-sm border border-gray-200 bg-gray-50"},{default:L(()=>[T(t,{class:"flex items-center justify-between p-3"},{default:L(()=>[R("div",Be,[T(s,{name:"list"}),G(" "+O(a.$t("rewardSys.session.absentees")),1)]),T(o,{dense:"",flat:"",color:"primary",icon:"content_copy",label:a.$t("rewardSys.session.copyToClipboard"),onClick:Gl,disable:0===Wl.value.absent},null,8,["label","disable"])]),_:1})]),_:1})]),T(i,{class:"shadow-md rounded-xl mb-4"},{default:L(()=>[T(t,{class:"p-3 bg-gradient-to-r from-blue-50 to-indigo-50"},{default:L(()=>[R("div",De,[R("div",Le,[T(s,{name:"view_module",size:"sm",color:"primary"}),R("span",Oe,O(a.$t("rewardSys.layout")),1),T($,{modelValue:Ct.value,"onUpdate:modelValue":l[13]||(l[13]=e=>Ct.value=e),options:Tt.value,"option-value":"value","option-label":"label",outlined:"",dense:"","emit-value":"","map-options":"",class:"w-64"},{prepend:L(()=>[T(s,{name:Rt.value},null,8,["name"])]),_:1},8,["modelValue","options"])]),T(o,{flat:"",color:"primary",icon:"settings",label:a.$t("rewardSys.manageGroups"),onClick:l[14]||(l[14]=e=>zt.value=!0)},null,8,["label"])])]),_:1})]),_:1}),R("div",qe,[R("div",Me,[R("div",We,[R("div",Ge,[R("h4",Ke,[T(s,{name:"checklist"}),G(" "+O(a.$t("rewardSys.selected"))+" ("+O(dt.value.length)+") ",1)]),0===dt.value.length?(E(),Q("div",Je,O(a.$t("rewardSys.messages.clickToSelect")),1)):(E(),Q("div",Ze,[(E(!0),Q(K,null,J(dt.value,e=>(E(),B(b,{key:e,removable:"",onRemove:a=>Ht(e),color:"white","text-color":"primary",class:"shadow-sm border border-blue-100 m-0 w-full"},{default:L(()=>{var a,l;return[T(f,{icon:"person",color:"primary","text-color":"white","font-size":"14px"}),R("div",He,[R("span",Ye,O(null==(a=Yl.value.find(a=>a.id===e))?void 0:a.firstName),1),R("span",Xe,O(null==(l=Yl.value.find(a=>a.id===e))?void 0:l.lastName),1)])]}),_:2},1032,["onRemove"]))),128))])),R("div",ea,[R("div",aa,[T(o,{flat:"",dense:"",color:"primary",label:a.$t("rewardSys.selection.all"),size:"sm",onClick:Dt,class:"bg-blue-100/50"},null,8,["label"]),T(o,{flat:"",dense:"",color:"primary",label:a.$t("rewardSys.selection.inv"),size:"sm",onClick:Lt,class:"bg-blue-100/50"},null,8,["label"]),T(o,{flat:"",dense:"",color:"negative",label:a.$t("rewardSys.selection.clear"),size:"sm",onClick:Yt,class:"bg-red-100/50"},null,8,["label"])]),R("div",la,[T(o,{color:"positive",icon:"add",label:a.$t("rewardSys.points.title"),onClick:l[15]||(l[15]=e=>Ot("positive")),disable:0===dt.value.length},null,8,["label","disable"]),T(o,{color:"negative",icon:"remove",label:a.$t("rewardSys.points.title"),onClick:l[16]||(l[16]=e=>Ot("negative")),disable:0===dt.value.length},null,8,["label","disable"])])])])])]),R("div",ta,[(E(!0),Q(K,null,J(Bt.value,(e,a)=>(E(),Q("div",{key:a,class:"mb-6"},[e.name?(E(),Q("div",sa,[R("h4",oa,[T(s,{name:"groups"}),G(" "+O(e.name)+" ",1),T(j,{label:e.students.length,color:"indigo"},null,8,["label"])])])):D("",!0),R("div",ia,[(E(!0),Q(K,null,J(e.students,e=>{var a,l,t,s;return E(),B(te,{key:e.id,student:e,selected:dt.value.includes(e.id),"selected-id":dt.value.includes(e.id)?e.id:null,"disable-behavior":!ct.value[e.id],"is-absent":!ct.value[e.id],"allow-disabled-click":!1,"avatar-edit-enabled":St.value,"student-summary":{positive:(null==(a=ut.value[e.id])?void 0:a.points_plus)||0,negative:(null==(l=ut.value[e.id])?void 0:l.points_minus)||0,total:((null==(t=ut.value[e.id])?void 0:t.points_plus)||0)-((null==(s=ut.value[e.id])?void 0:s.points_minus)||0)},onSelect:a=>Ht(e.id)},null,8,["student","selected","selected-id","disable-behavior","is-absent","avatar-edit-enabled","student-summary","onSelect"])}),128))])]))),128))])])])]),_:1}),T(k,{name:"negative"},{default:L(()=>[R("div",na,[R("div",ra,[R("h3",da,O(a.$t("rewardSys.points.deduct")),1),R("p",ua,O(a.$t("rewardSys.points.selectStudentsNegative")),1)]),R("div",ca,[R("div",va,[T($,{modelValue:rt.value,"onUpdate:modelValue":l[17]||(l[17]=e=>rt.value=e),options:Et.value,"option-value":"id","option-label":"name",outlined:"",dense:"",placeholder:a.$t("rewardSys.points.selectNegativeBehavior"),"emit-value":"","map-options":""},{option:L(e=>[T(d,Z(H(e.itemProps)),{default:L(()=>[T(u,null,{default:L(()=>[T(c,null,{default:L(()=>[G(O(Dl(e.opt)),1)]),_:2},1024),T(c,{caption:""},{default:L(()=>[G(O(e.opt.value||e.opt.points||0)+" points",1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","placeholder"]),T(o,{color:"negative",icon:"remove_circle",label:a.$t("rewardSys.points.applyToSelected"),onClick:as,disable:!dt.value.length||!rt.value,loading:bt.value},null,8,["label","disable","loading"])]),R("div",ma,[l[33]||(l[33]=G("Selected: ")),R("strong",null,O(dt.value.length),1),l[34]||(l[34]=G(" students"))])]),R("div",pa,[(E(!0),Q(K,null,J(Yl.value,e=>{var a,l,t,s;return E(),B(te,{key:e.id,student:e,selected:dt.value.includes(e.id),"selected-id":dt.value.includes(e.id)?e.id:null,"disable-behavior":!ct.value[e.id],"allow-disabled-click":!1,"avatar-edit-enabled":St.value,"student-summary":{positive:(null==(a=ut.value[e.id])?void 0:a.points_plus)||0,negative:(null==(l=ut.value[e.id])?void 0:l.points_minus)||0,total:((null==(t=ut.value[e.id])?void 0:t.points_plus)||0)-((null==(s=ut.value[e.id])?void 0:s.points_minus)||0)},onSelect:a=>Ht(e.id)},null,8,["student","selected","selected-id","disable-behavior","avatar-edit-enabled","student-summary","onSelect"])}),128))])])]),_:1}),T(k,{name:"old_card"},{default:L(()=>[R("div",ga,[l[38]||(l[38]=R("h3",{class:"text-xl font-bold mb-4"},"Old Card View",-1)),R("div",ba,[(E(!0),Q(K,null,J(Yl.value,e=>{var a,t,s,o;return E(),Q("div",{key:e.id,class:Y(["p-4 border-2 rounded-lg transition",[ct.value[e.id]?dt.value.includes(e.id)?"bg-green-100 border-green-500 cursor-pointer":"bg-white border-gray-200 cursor-pointer":"bg-gray-100 border-gray-300 opacity-50 cursor-not-allowed"]]),onClick:a=>ct.value[e.id]&&Ht(e.id)},[R("div",ya,[R("div",xa,[R("p",ha,O(e.name),1),R("p",wa,"ID: "+O(e.id),1),ct.value[e.id]?D("",!0):(E(),Q("p",_a,"âŒ Absent"))]),T(y,{"model-value":dt.value.includes(e.id),"onUpdate:modelValue":a=>Ht(e.id),disable:!ct.value[e.id],color:"positive",size:"lg"},null,8,["model-value","onUpdate:modelValue","disable"])]),R("div",Sa,[R("div",ka,[l[35]||(l[35]=R("span",{class:"text-xs font-semibold text-green-800"},"Positive",-1)),R("span",$a,"+"+O((null==(a=ut.value[e.id])?void 0:a.points_plus)||0)+" â­",1)]),R("div",ja,[l[36]||(l[36]=R("span",{class:"text-xs font-semibold text-red-800"},"Negative",-1)),R("span",Ca,"-"+O((null==(t=ut.value[e.id])?void 0:t.points_minus)||0)+" âš ï¸",1)]),R("div",Va,[l[37]||(l[37]=R("span",{class:"text-xs font-semibold text-blue-800"},"Total",-1)),R("span",za,O(((null==(s=ut.value[e.id])?void 0:s.points_plus)||0)-((null==(o=ut.value[e.id])?void 0:o.points_minus)||0)),1)])])],10,fa)}),128))])])]),_:1}),T(k,{name:"history"},{default:L(()=>[R("div",Ia,[R("div",Ua,[R("h3",Aa,O(a.$t("rewardSys.history.title")),1),T(o,{color:"primary",icon:"refresh",label:a.$t("rewardSys.history.refresh"),onClick:is,loading:yt.value},null,8,["label","loading"])]),mt.value.length?D("",!0):(E(),Q("div",Na,[R("p",Fa,O(a.$t("rewardSys.history.empty")),1)])),(E(!0),Q(K,null,J(mt.value,e=>{var l,t,s;return E(),Q("div",{key:e.id,class:Y(["p-4 bg-white rounded-lg border-l-4",[e.canceled?"border-gray-400 opacity-60":e.value>0?"border-green-500":"border-red-500"]])},[R("div",Pa,[R("div",Qa,[R("div",Ea,[R("span",Ta,O((null==(t=null==(l=e.student_behavior)?void 0:l.student)?void 0:t.name)||a.$t("rewardSys.history.unknown")),1),R("span",Ra,O(e.value>0?"â­":"âš ï¸"),1)]),R("p",Ba,[R("strong",null,O(Dl(e.behavior)||a.$t("rewardSys.history.unknownBehavior")),1),R("span",{class:Y(e.value>0?"text-green-600":"text-red-600")}," ("+O(e.value>0?"+":"")+O(e.value)+" "+O(a.$t("rewardSys.points.title"))+") ",3)]),R("p",Da,O(ns(e.created_at))+" by "+O((null==(s=e.created_by)?void 0:s.name)||a.$t("rewardSys.history.unknown")),1),e.note?(E(),Q("p",La,O(a.$t("rewardSys.history.note"))+" "+O(e.note),1)):D("",!0),e.canceled?(E(),Q("p",Oa," âŒ "+O(a.$t("rewardSys.history.canceled"))+" "+O(e.cancel_reason)+" ("+O(ns(e.canceled_at))+") ",1)):D("",!0)]),e.canceled?D("",!0):(E(),B(o,{key:0,color:"warning",icon:"undo",label:a.$t("rewardSys.history.undo"),size:"sm",onClick:a=>async function(e){xt.value=e;try{const a=await X.undoAction(e,"Undone by teacher");a.success?(Kl.notify({message:"Action undone successfully",color:"positive",position:"top"}),await is(),await es()):Kl.notify({message:a.error||"Failed to undo action",color:"negative",position:"top"})}catch(a){console.error("Error undoing action:",a),Kl.notify({message:"Error undoing action",color:"negative",position:"top"})}finally{xt.value=null}}(e.id),loading:xt.value===e.id},null,8,["label","onClick","loading"]))])],2)}),128))])]),_:1}),T(k,{name:"settings_reports",class:"p-4"},{default:L(()=>[R("div",qa,[R("div",Ma,[T(S,{modelValue:Zl.value,"onUpdate:modelValue":l[18]||(l[18]=e=>Zl.value=e),align:"left",class:"text-gray-600 bg-gray-50 border-b border-gray-200","active-color":"primary","indicator-color":"primary",dense:""},{default:L(()=>[T(_,{name:"behavior_incidents",icon:"report_problem",label:a.$t("rewardSys.tabs.behaviorIncidents")},null,8,["label"]),T(_,{name:"behaviors",icon:"settings",label:a.$t("rewardSys.tabs.behaviors")},null,8,["label"])]),_:1},8,["modelValue"]),T(C,{modelValue:Zl.value,"onUpdate:modelValue":l[20]||(l[20]=e=>Zl.value=e),animated:"",class:"bg-transparent"},{default:L(()=>[T(k,{name:"behavior_incidents"},{default:L(()=>[T(oe,{students:Yl.value,"classroom-id":et.value,date:lt.value,"period-code":Pt.value,onIncidentRecorded:rs},null,8,["students","classroom-id","date","period-code"])]),_:1}),T(k,{name:"behaviors"},{default:L(()=>[R("div",Wa,[R("div",Ga,[R("h3",Ka,O(a.$t("rewardSys.behaviors.management")),1),T(o,{color:"primary",icon:"add",label:a.$t("rewardSys.behaviors.addNew"),onClick:l[19]||(l[19]=e=>Gt(null)),size:"md",class:"shadow-md"},null,8,["label"])]),R("div",Ja,[R("div",Za,[T(s,{name:"add_circle",size:"md",color:"positive"}),R("h4",Ha,O(a.$t("rewardSys.behaviors.positiveSection")),1),T(j,{label:Qt.value.length,color:"positive"},null,8,["label"])]),R("div",Ya,[(E(!0),Q(K,null,J(Qt.value,e=>(E(),Q("div",{key:e.id,class:"bg-white rounded-lg p-4 shadow-sm border border-green-100 hover:shadow-md transition-all"},[R("div",Xa,[R("div",el,[R("div",al,O(e.icon||"â­"),1),R("div",null,[R("h5",ll,O(Dl(e)),1),R("p",tl,"ID: "+O(e.id),1)])]),R("div",sl,[T(o,{flat:"",round:"",dense:"",icon:"edit",color:"primary",size:"sm",onClick:a=>Gt(e)},{default:L(()=>[T(x,null,{default:L(()=>l[39]||(l[39]=[G("Edit")])),_:1})]),_:2},1032,["onClick"]),T(o,{flat:"",round:"",dense:"",icon:"delete",color:"negative",size:"sm",onClick:a=>Jt(e)},{default:L(()=>[T(x,null,{default:L(()=>l[40]||(l[40]=[G("Delete")])),_:1})]),_:2},1032,["onClick"])])]),R("div",ol,[l[41]||(l[41]=R("span",{class:"text-sm text-gray-600"},"Points:",-1)),R("span",il,"+"+O(e.value||e.points||0),1)])]))),128))]),0===Qt.value.length?(E(),Q("div",nl,[T(s,{name:"sentiment_neutral",size:"3rem",class:"mb-2"}),R("p",null,O(a.$t("rewardSys.behaviors.noPositive")),1)])):D("",!0)]),R("div",rl,[R("div",dl,[T(s,{name:"remove_circle",size:"md",color:"negative"}),R("h4",ul,O(a.$t("rewardSys.behaviors.negativeSection")),1),T(j,{label:Et.value.length,color:"negative"},null,8,["label"])]),R("div",cl,[(E(!0),Q(K,null,J(Et.value,e=>(E(),Q("div",{key:e.id,class:"bg-white rounded-lg p-4 shadow-sm border border-red-100 hover:shadow-md transition-all"},[R("div",vl,[R("div",ml,[R("div",pl,O(e.icon||"âš ï¸"),1),R("div",null,[R("h5",gl,O(Dl(e)),1),R("p",bl,"ID: "+O(e.id),1)])]),R("div",fl,[T(o,{flat:"",round:"",dense:"",icon:"edit",color:"primary",size:"sm",onClick:a=>Gt(e)},{default:L(()=>[T(x,null,{default:L(()=>l[42]||(l[42]=[G("Edit")])),_:1})]),_:2},1032,["onClick"]),T(o,{flat:"",round:"",dense:"",icon:"delete",color:"negative",size:"sm",onClick:a=>Jt(e)},{default:L(()=>[T(x,null,{default:L(()=>l[43]||(l[43]=[G("Delete")])),_:1})]),_:2},1032,["onClick"])])]),R("div",yl,[l[44]||(l[44]=R("span",{class:"text-sm text-gray-600"},"Points:",-1)),R("span",xl,O(e.value||e.points||0),1)])]))),128))]),0===Et.value.length?(E(),Q("div",hl,[T(s,{name:"sentiment_neutral",size:"3rem",class:"mb-2"}),R("p",null,O(a.$t("rewardSys.behaviors.noNegative")),1)])):D("",!0)])])]),_:1})]),_:1},8,["modelValue"])])])]),_:1})]),_:1},8,["modelValue"])]),_:1})):D("",!0),Yl.value.length?D("",!0):(E(),B(i,{key:1,class:"shadow-lg rounded-2xl"},{default:L(()=>[T(t,{class:"text-center py-12"},{default:L(()=>[R("p",wl,"ðŸ“š "+O(a.$t("rewardSys.messages.selectClassroom")),1)]),_:1})]),_:1})),T(n,{modelValue:pt.value,"onUpdate:modelValue":l[22]||(l[22]=e=>pt.value=e),maximized:""},{default:L(()=>[T(i,null,{default:L(()=>[T(v,{align:"right"},{default:L(()=>[W(T(o,{flat:"",label:"Close",color:"primary"},null,512),[[g]])]),_:1}),T(t,{class:"p-0"},{default:L(()=>[T(le,{students:Yl.value,"student-behaviors":ut.value,"period-code":Pt.value,date:lt.value,"school-logo":Ol.value},null,8,["students","student-behaviors","period-code","date","school-logo"])]),_:1}),T(v,{align:"right"},{default:L(()=>[W(T(o,{flat:"",label:"Close",color:"primary"},null,512),[[g]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),T(n,{modelValue:kt.value,"onUpdate:modelValue":l[23]||(l[23]=e=>kt.value=e),"full-width":"",maxWidth:"1000px"},{default:L(()=>[T(i,{class:"flex flex-col md:flex-row h-[80vh] md:h-[70vh]"},{default:L(()=>[T(t,{class:"w-full md:w-1/3 bg-blue-50 border-r border-blue-100 flex flex-col p-0"},{default:L(()=>[R("div",_l,[R("h4",Sl,[T(s,{name:"checklist"}),G(" "+O(a.$t("rewardSys.selected"))+" ("+O(dt.value.length)+") ",1)])]),R("div",kl,[0===dt.value.length?(E(),Q("div",$l,O(a.$t("rewardSys.messages.clickToSelect")),1)):(E(),Q("div",jl,[(E(!0),Q(K,null,J(dt.value,e=>(E(),B(b,{key:e,removable:"",onRemove:a=>Ht(e),color:"white","text-color":"primary",class:"shadow-sm border border-blue-100 m-0 w-full"},{default:L(()=>{var a,l;return[T(f,{icon:"person",color:"primary","text-color":"white","font-size":"14px"}),R("div",Cl,[R("span",Vl,[G(O(null==(a=Yl.value.find(a=>a.id===e))?void 0:a.firstName)+" ",1),R("span",zl,O(null==(l=Yl.value.find(a=>a.id===e))?void 0:l.lastName),1)])])]}),_:2},1032,["onRemove"]))),128))]))]),R("div",Il,[R("div",Ul,[T(o,{flat:"",dense:"",color:"primary",label:"All",size:"sm",onClick:Dt,class:"bg-blue-50"}),T(o,{flat:"",dense:"",color:"primary",label:"Inv",size:"sm",onClick:Lt,class:"bg-blue-50"}),T(o,{flat:"",dense:"",color:"negative",label:"Clear",size:"sm",onClick:Yt,class:"bg-red-50"})])])]),_:1}),R("div",Al,[T(t,{class:Y("positive"===$t.value?"bg-green-50 border-b border-green-100":"bg-red-50 border-b border-red-100")},{default:L(()=>[R("div",Nl,[T(s,{name:"positive"===$t.value?"add_circle":"remove_circle",color:"positive"===$t.value?"positive":"negative"},null,8,["name","color"]),G(" "+O("positive"===$t.value?a.$t("rewardSys.points.positiveTitle"):a.$t("rewardSys.points.negativeTitle")),1)])]),_:1},8,["class"]),T(t,{class:"flex-1 overflow-y-auto p-4 custom-scrollbar"},{default:L(()=>[R("div",Fl,[(E(!0),Q(K,null,J("positive"===$t.value?Qt.value:Et.value,e=>(E(),Q("div",{key:e.id,class:"cursor-pointer transition-all duration-200 relative group",onClick:a=>jt.value=e.id},[R("div",{class:Y(["h-full p-3 rounded-xl border-2 flex flex-col items-center text-center gap-2 hover:shadow-md transition-all",[jt.value===e.id?"positive"===$t.value?"border-green-500 bg-green-50 scale-105":"border-red-500 bg-red-50 scale-105":"border-gray-100 bg-white hover:border-gray-300"]])},[R("div",{class:Y(["text-3xl p-3 rounded-full mb-1","positive"===$t.value?"bg-green-100 text-green-600":"bg-red-100 text-red-600"])},O(e.icon||("positive"===$t.value?"â­":"âš ï¸")),3),R("div",Ql,O(Dl(e)),1),R("div",{class:Y(["text-xl font-bold px-3 py-1 rounded-full mt-auto","positive"===$t.value?"bg-green-200 text-green-800":"bg-red-200 text-red-800"])},O("positive"===$t.value?"+":"")+O(e.value||e.points||0),3),jt.value===e.id?(E(),Q("div",{key:0,class:Y(["absolute top-2 right-2 text-xl drop-shadow-sm","positive"===$t.value?"text-green-600":"text-red-600"])},[T(s,{name:"check_circle"})],2)):D("",!0)],2)],8,Pl))),128))])]),_:1}),T(v,{align:"right",class:"p-4 border-t border-gray-100 bg-gray-50 gap-3"},{default:L(()=>[W(T(o,{flat:"",label:a.$t("rewardSys.tabs.cancel"),color:"grey-7",size:"lg",class:"font-bold"},null,8,["label"]),[[g]]),T(o,{color:"positive"===$t.value?"positive":"negative",label:"positive"===$t.value?a.$t("rewardSys.points.applyPositive"):a.$t("rewardSys.points.applyNegative"),icon:"positive"===$t.value?"check_circle":"warning",onClick:qt,disable:!jt.value,loading:bt.value,size:"lg",class:"px-8 font-bold shadow-md",push:""},null,8,["color","label","icon","disable","loading"])]),_:1})])]),_:1})]),_:1},8,["modelValue"]),T(n,{modelValue:Ut.value,"onUpdate:modelValue":l[29]||(l[29]=e=>Ut.value=e),persistent:""},{default:L(()=>[T(i,{class:"min-w-[500px]"},{default:L(()=>[T(t,{class:"bg-primary text-white"},{default:L(()=>[R("div",El,[R("div",Tl,O(At.value?a.$t("rewardSys.behaviors.edit"):a.$t("rewardSys.behaviors.create")),1),At.value&&!At.value.teacher_id?(E(),B(j,{key:0,color:"blue",label:"ðŸ”’ "+a.$t("rewardSys.behaviors.schoolDefault")},null,8,["label"])):D("",!0)])]),_:1}),T(t,{class:"q-pt-md space-y-4"},{default:L(()=>[At.value&&!At.value.teacher_id?(E(),B(m,{key:0,class:"bg-blue-50 text-blue-900",rounded:"",dense:""},{avatar:L(()=>[T(s,{name:"info",color:"blue"})]),default:L(()=>[G(" "+O(a.$t("rewardSys.behaviors.readOnlyWarning")),1)]),_:1})):D("",!0),T(p,{modelValue:Ft.value.name,"onUpdate:modelValue":l[24]||(l[24]=e=>Ft.value.name=e),label:"ðŸ‡¬ðŸ‡§ "+a.$t("rewardSys.behaviors.form.nameEn")+" *",outlined:"",dense:"",rules:[e=>!!e||"Name is required"],readonly:At.value&&!At.value.teacher_id},{prepend:L(()=>[T(s,{name:"translate"})]),_:1},8,["modelValue","label","rules","readonly"]),T(p,{modelValue:Ft.value.name_ar,"onUpdate:modelValue":l[25]||(l[25]=e=>Ft.value.name_ar=e),label:"ðŸ‡¸ðŸ‡¦ "+a.$t("rewardSys.behaviors.form.nameAr"),outlined:"",dense:"",dir:"rtl",readonly:At.value&&!At.value.teacher_id},{prepend:L(()=>[T(s,{name:"translate"})]),_:1},8,["modelValue","label","readonly"]),T($,{modelValue:Ft.value.type,"onUpdate:modelValue":l[26]||(l[26]=e=>Ft.value.type=e),options:[{label:a.$t("rewardSys.behaviors.form.types.positive"),value:"positive"},{label:a.$t("rewardSys.behaviors.form.types.negative"),value:"negative"}],label:a.$t("rewardSys.behaviors.form.type")+" *",outlined:"",dense:"","emit-value":"","map-options":"",rules:[e=>!!e||"Type is required"],readonly:At.value&&!At.value.teacher_id},null,8,["modelValue","options","label","rules","readonly"]),T(p,{modelValue:Ft.value.points,"onUpdate:modelValue":l[27]||(l[27]=e=>Ft.value.points=e),modelModifiers:{number:!0},label:a.$t("rewardSys.behaviors.form.points")+" *",type:"number",outlined:"",dense:"",rules:[e=>null!==e&&""!==e||"Points are required"],hint:"positive"===Ft.value.type?"Positive number (e.g., 5)":"Negative number (e.g., -3)",readonly:At.value&&!At.value.teacher_id},null,8,["modelValue","label","rules","hint","readonly"]),T(p,{modelValue:Ft.value.icon,"onUpdate:modelValue":l[28]||(l[28]=e=>Ft.value.icon=e),label:a.$t("rewardSys.behaviors.form.icon"),outlined:"",dense:"",hint:"Optional emoji, e.g., â­ ðŸŽ‰ âš ï¸ ðŸš«",readonly:At.value&&!At.value.teacher_id},null,8,["modelValue","label","readonly"])]),_:1}),T(v,{align:"right",class:"q-px-md q-pb-md"},{default:L(()=>[W(T(o,{flat:"",label:a.$t("rewardSys.tabs.cancel")},null,8,["label"]),[[g]]),!At.value||At.value.teacher_id?(E(),B(o,{key:0,color:"primary",label:At.value?a.$t("common.update"):a.$t("common.create"),onClick:Kt,loading:Nt.value},null,8,["label","loading"])):D("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),T(n,{modelValue:zt.value,"onUpdate:modelValue":l[31]||(l[31]=e=>zt.value=e),maximized:""},{default:L(()=>[T(se,{students:Yl.value,"saved-layouts":Vt.value,"editing-layout":It.value,onSave:Mt,onDelete:Wt,onClose:l[30]||(l[30]=e=>zt.value=!1)},null,8,["students","saved-layouts","editing-layout"])]),_:1},8,["modelValue"])])],64)}}},[["__scopeId","data-v-6688bb9b"]]);export{Rl as default};
