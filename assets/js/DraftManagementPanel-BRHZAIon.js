import{Q as e}from"./QSpace-DKhB4IlP.js";import{u as a,m as l,c as t,Q as o,f as s,d as r,aF as n,p as i,C as d,b as u,A as c,l as m,aP as f}from"./app-ggGwxJON.js";import{Q as p}from"./QTd-D6gdMIVj.js";import{Q as v}from"./QTable-D7jFdT1k.js";import{d as g}from"./date-C_NgUKAH.js";import{a as y,f as _,o as w,N as b,J as h,b as C,K as x,O as V,y as k,W as j,V as D,I as Q,Q as L,F as A,_ as P}from"./vendor-nQjeLEvd.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";import"./QMarkupTable-BbwJTHXP.js";import"./QSelect-DOo83gJW.js";import"./rtl-Cr6c3OOr.js";import"./QLinearProgress-DJHuJoTJ.js";import"./use-fullscreen-DuZ9ifcT.js";const U={class:"row q-gutter-md q-mb-md"},F={class:"col-12 col-md-4"},M={class:"col-auto"},S={class:"text-weight-bold"},T={class:"text-caption text-grey"},q={class:"text-caption text-grey"},Y={class:"q-ml-sm text-h6"},B={class:"text-grey-7"},O={class:"q-ml-sm text-h6"},H={__name:"DraftManagementPanel",props:{modelValue:Boolean},emits:["update:modelValue","compare","load"],setup(H,{emit:I}){const J=H,K=I,N=a(),R=y({get:()=>J.modelValue,set:e=>K("update:modelValue",e)}),z=_([]),W=_(!1),$=_(""),E=_(!1),G=_(!1),X=_(null),Z=[{name:"name",label:"Draft Name",align:"left",field:"name",sortable:!0},{name:"created",label:"Created",align:"left",field:"timestamp",sortable:!0},{name:"stats",label:"Assignments",align:"center",field:e=>e.total_assignments,sortable:!0},{name:"actions",label:"Actions",align:"right"}],ee=y(()=>{if(!$.value)return z.value;const e=$.value.toLowerCase();return z.value.filter(a=>a.name.toLowerCase().includes(e)||a.description&&a.description.toLowerCase().includes(e)||a.created_by_name&&a.created_by_name.toLowerCase().includes(e))});async function ae(){W.value=!0;try{const e=await P.get(route("weekly-system.api.drafts.index"));e.data.success&&(z.value=e.data.drafts.sort((e,a)=>new Date(a.timestamp)-new Date(e.timestamp)))}catch(e){console.error("Failed to load drafts",e),N.notify({type:"negative",message:"Failed to load drafts list"})}finally{W.value=!1}}function le(){X.value&&(K("load",X.value),E.value=!1)}async function te(){if(X.value)try{(await P.post(route("weekly-system.api.drafts.delete"),{name:X.value.name})).data.success&&(N.notify({type:"positive",message:"Draft deleted"}),ae())}catch(e){console.error("Failed to delete draft",e),N.notify({type:"negative",message:"Failed to delete draft"})}finally{G.value=!1,X.value=null}}return w(()=>{ae()}),(a,y)=>(h(),b(A,null,[C(u,{modelValue:R.value,"onUpdate:modelValue":y[1]||(y[1]=e=>R.value=e),"full-width":""},{default:x(()=>[C(l,{class:"column",style:{"min-height":"500px","max-height":"80vh"}},{default:x(()=>[C(t,{class:"bg-primary text-white row items-center"},{default:x(()=>[y[4]||(y[4]=V("div",{class:"text-h6"},"Draft Management",-1)),C(e),k(C(o,{icon:"close",flat:"",round:"",dense:""},null,512),[[f]])]),_:1}),C(t,{class:"q-pa-md col scroll"},{default:x(()=>[V("div",U,[V("div",F,[C(s,{dense:"",outlined:"",modelValue:$.value,"onUpdate:modelValue":y[0]||(y[0]=e=>$.value=e),label:"Search drafts",class:"bg-white"},{append:x(()=>[C(r,{name:"search"})]),_:1},8,["modelValue"])]),C(e),V("div",M,[C(o,{color:"primary",label:"Refresh List",icon:"refresh",flat:"",onClick:ae,loading:W.value},null,8,["loading"])])]),C(v,{rows:ee.value,columns:Z,"row-key":"name",loading:W.value,flat:"",bordered:"",pagination:{rowsPerPage:10}},{"body-cell-name":x(e=>[C(p,{props:e},{default:x(()=>[V("div",S,D(e.value),1),V("div",T,D(e.row.description),1),e.row.is_backup?(h(),Q(d,{key:0,size:"xs",color:"grey-3","text-color":"grey-8",icon:"restore"},{default:x(()=>y[5]||(y[5]=[j("Auto-Backup")])),_:1})):L("",!0)]),_:2},1032,["props"])]),"body-cell-created":x(e=>[C(p,{props:e},{default:x(()=>{return[V("div",null,D((a=e.row.timestamp,a?g.formatDate(a,"MMM D, YYYY HH:mm"):"-")),1),V("div",q,"by "+D(e.row.created_by_name||"System"),1)];var a}),_:2},1032,["props"])]),"body-cell-actions":x(e=>[C(p,{props:e,class:"text-right"},{default:x(()=>[C(n,{flat:""},{default:x(()=>[C(o,{flat:"",dense:"",color:"primary",icon:"compare_arrows",onClick:l=>a.$emit("compare",e.row)},{default:x(()=>[C(i,null,{default:x(()=>y[6]||(y[6]=[j("Compare with Live")])),_:1})]),_:2},1032,["onClick"]),C(o,{flat:"",dense:"",color:"secondary",icon:"restore",onClick:a=>{return l=e.row,X.value=l,void(E.value=!0);var l}},{default:x(()=>[C(i,null,{default:x(()=>y[7]||(y[7]=[j("Load/Restore")])),_:1})]),_:2},1032,["onClick"]),C(o,{flat:"",dense:"",color:"negative",icon:"delete",onClick:a=>{return l=e.row,X.value=l,void(G.value=!0);var l}},{default:x(()=>[C(i,null,{default:x(()=>y[8]||(y[8]=[j("Delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),C(u,{modelValue:E.value,"onUpdate:modelValue":y[2]||(y[2]=e=>E.value=e)},{default:x(()=>[C(l,null,{default:x(()=>[C(t,{class:"row items-center"},{default:x(()=>{var e;return[C(c,{icon:"warning",color:"warning","text-color":"white"}),V("span",Y,"Load Draft: "+D(null==(e=X.value)?void 0:e.name),1)]}),_:1}),C(t,null,{default:x(()=>[y[10]||(y[10]=V("p",null,"This action will replace the current live schedule with this draft.",-1)),V("p",B,[y[9]||(y[9]=j("Current schedule will be automatically backed up as ")),V("strong",null,"AUTO_BACKUP_"+D((new Date).toISOString().slice(0,10))+"...",1)])]),_:1}),C(m,{align:"right"},{default:x(()=>[k(C(o,{flat:"",label:"Cancel",color:"primary"},null,512),[[f]]),C(o,{flat:"",label:"Proceed & Load",color:"negative",onClick:le})]),_:1})]),_:1})]),_:1},8,["modelValue"]),C(u,{modelValue:G.value,"onUpdate:modelValue":y[3]||(y[3]=e=>G.value=e)},{default:x(()=>[C(l,null,{default:x(()=>[C(t,{class:"row items-center"},{default:x(()=>{var e;return[C(c,{icon:"delete",color:"negative","text-color":"white"}),V("span",O,"Delete Draft: "+D(null==(e=X.value)?void 0:e.name),1)]}),_:1}),C(t,null,{default:x(()=>y[11]||(y[11]=[j(" Are you sure you want to delete this draft? This action cannot be undone. ")])),_:1}),C(m,{align:"right"},{default:x(()=>[k(C(o,{flat:"",label:"Cancel",color:"primary"},null,512),[[f]]),C(o,{flat:"",label:"Delete",color:"negative",onClick:te})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{H as default};
