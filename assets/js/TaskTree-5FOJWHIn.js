import{r as e,Q as a,h as l,G as n,t,b as o}from"./app-DlLesFGi.js";import{Q as i}from"./QTree-zhNfVOze.js";import{f as r,a as s,k as d,N as c,J as u,b as p,K as v,R as f,U as g,I as k,O as m,a2 as y,a0 as h,V as b,W as A}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";const _={class:"task-tree"},w={class:"drag-handle-container q-mr-sm"},T={key:0,class:"editable-field"},C=["onDblclick"],x={class:"col-auto"},j={class:"description-area"},z={key:0,class:"editable-field description-editor"},V={class:"action-buttons"},B=e({__name:"TaskTree",props:{tasks:{type:Array,required:!0},expandAll:{type:Boolean,default:!1}},emits:["toggle-complete","edit-task","delete-task","reorder-tasks","add-subtask"],setup(e,{emit:B}){const U=e,E=B,I=r([]),K=r(!1),D=r(null),L=r(null),Q=r(""),S=r(null),q=s(()=>(console.log("Formatting tasks for tree:",U.tasks),F(U.tasks))),F=e=>e&&Array.isArray(e)&&e.length?e.map(e=>N(e)):(console.warn("formatTasksForTree: Invalid tasks input:",e),[]),N=e=>{if(!e||"object"!=typeof e)return console.warn("formatTask: Invalid task input:",e),null;const a={id:e.id||0,label:e.title||"Untitled Task",original:e,due_date:e.due_date||null,classification:e.classification||null,completed_at:e.completed_at||null,children:[]};return e.children&&Array.isArray(e.children)&&e.children.length>0&&(a.children=e.children.filter(e=>e).map(e=>N(e)).filter(e=>e)),a},$=e=>{try{if(!Array.isArray(e))return void console.warn("updateTicked: ticked is not an array:",e);const a=new Set(I.value||[]),l=new Set(e);for(const e of l)if(!a.has(e)){const a=G(e,U.tasks);a&&E("toggle-complete",a)}for(const e of a)if(!l.has(e)){const a=G(e,U.tasks);a&&E("toggle-complete",a)}I.value=e}catch(a){console.error("Error in updateTicked:",a)}},G=(e,a)=>{try{if(!a||!Array.isArray(a))return null;for(const l of a)if(l){if(l.id===e)return l;if(l.children&&Array.isArray(l.children)&&l.children.length){const a=G(e,l.children);if(a)return a}}}catch(l){console.error("Error in findTaskById:",l)}return null},J=e=>{if(!e)return"";return new Date(e).toLocaleDateString()},M=e=>{let a=0;for(let n=0;n<e.length;n++)a=e.charCodeAt(n)+((a<<5)-a);const l=["red","pink","purple","deep-purple","indigo","blue","light-blue","cyan","teal","green","light-green","lime","yellow","amber","orange","deep-orange","brown","grey","blue-grey"];return l[Math.abs(a)%l.length]},O=(e,a)=>{P(),D.value=e.id,L.value=a,Q.value="title"===a?e.title:e.description||""},P=()=>{S.value&&(clearTimeout(S.value),S.value=null),D.value=null,L.value=null,Q.value=""},R=e=>{if(S.value&&(clearTimeout(S.value),S.value=null),"title"===L.value&&Q.value!==e.title){const a={...e,title:Q.value};E("edit-task",a)}else if("description"===L.value&&Q.value!==e.description){const a={...e,description:Q.value};E("edit-task",a)}D.value=null,L.value=null,Q.value=""},W=e=>{S.value&&clearTimeout(S.value),S.value=setTimeout(()=>{D.value===e.id&&R(e)},5e3)},H=e=>{K.value=!1;const a=X(e);E("reorder-tasks",a)};document.addEventListener("dragstart",()=>{K.value=!0}),document.addEventListener("dragend",()=>{K.value=!1});const X=e=>e.map((e,a)=>{const l={...e.original,position:a};return e.children&&e.children.length>0&&(l.children=X(e.children)),l});return d(()=>U.tasks,e=>{const a=[],l=e=>{if(e&&Array.isArray(e))for(const n of e)n&&n.completed_at&&a.push(n.id),n&&n.children&&Array.isArray(n.children)&&n.children.length&&l(n.children);else console.warn("Tasks is not an array:",e)};e&&Array.isArray(e)?(console.log("Processing tasks for completion status:",e),l(e),I.value=a):(console.warn("New tasks is not an array:",e),I.value=[])},{immediate:!0}),(r,s)=>(u(),c("div",_,[p(i,{nodes:q.value,"node-key":"id","tick-strategy":"leaf",ticked:I.value,"onUpdate:ticked":$,"onUpdate:nodes":H,"no-connectors":"","default-expand-all":e.expandAll,draggable:""},{"default-header":v(e=>{return[f("div",{class:g(["row items-center full-width task-header",{"is-dragging":K.value}])},[f("div",w,[p(a,{name:"drag_indicator",size:"sm",class:"drag-handle cursor-grab"})]),f("div",{class:g(["col-grow task-title",{"completed-task":(i=e.node,null!==i.completed_at)}])},[D.value===e.node.id&&"title"===L.value?(u(),c("div",T,[p(l,{modelValue:Q.value,"onUpdate:modelValue":s[0]||(s[0]=e=>Q.value=e),dense:"",autofocus:"",onKeyup:[a=>W(e.node.original),y(a=>R(e.node.original),["enter"]),y(P,["esc"])],onBlur:a=>R(e.node.original)},null,8,["modelValue","onKeyup","onBlur"])])):(u(),c("div",{key:1,onDblclick:h(a=>O(e.node.original,"title"),["stop"])},b(e.node.label),41,C)),e.node.classification?(u(),k(n,{key:2,size:"sm",color:M(e.node.classification),"text-color":"white"},{default:v(()=>[A(b(e.node.classification),1)]),_:2},1032,["color"])):m("",!0),e.node.due_date?(u(),k(n,{key:3,size:"sm",color:"blue-grey-2","text-color":"black",icon:"event"},{default:v(()=>[A(b(J(e.node.due_date)),1)]),_:2},1024)):m("",!0)],2),f("div",x,[f("div",j,[D.value===e.node.id&&"description"===L.value?(u(),c("div",z,[p(l,{modelValue:Q.value,"onUpdate:modelValue":s[1]||(s[1]=e=>Q.value=e),type:"textarea",autofocus:"",dense:"",onKeyup:[a=>W(e.node.original),y(P,["esc"])],onBlur:a=>R(e.node.original)},null,8,["modelValue","onKeyup","onBlur"])])):(u(),k(o,{key:1,flat:"",round:"",dense:"",icon:e.node.original.description?"description":"add_comment",size:"sm",color:e.node.original.description?"blue-grey":"grey",onClick:h(a=>O(e.node.original,"description"),["stop"]),class:g({"has-description":e.node.original.description})},{default:v(()=>[p(t,null,{default:v(()=>[A(b(e.node.original.description?"Edit description":"Add description"),1)]),_:2},1024)]),_:2},1032,["icon","color","onClick","class"]))]),f("div",V,[p(o,{flat:"",round:"",dense:"",icon:"add",size:"sm",color:"positive",onClick:h(a=>{return l=e.node.original,void E("add-subtask",l);var l},["stop"])},null,8,["onClick"]),p(o,{flat:"",round:"",dense:"",icon:"edit",size:"sm",onClick:h(a=>r.$emit("edit-task",e.node.original),["stop"])},null,8,["onClick"]),p(o,{flat:"",round:"",dense:"",icon:"delete",size:"sm",color:"negative",onClick:h(a=>r.$emit("delete-task",e.node.original),["stop"])},null,8,["onClick"])])])],2)];var i}),_:1},8,["nodes","ticked","default-expand-all"])]))}},[["__scopeId","data-v-0f3816c7"]]);export{B as default};
