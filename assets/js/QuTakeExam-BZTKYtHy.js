import{Q as e,a as t}from"./QToolbar-D9EsGUqs.js";import{Q as a}from"./QHeader-CIFNrKl1.js";import{o as s,u as l,m as n,c as o,d as i,Q as r,a as u,l as d,b as c,aP as m}from"./app-B77gjd5a.js";import{Q as v}from"./QLinearProgress-B9hMkhRG.js";import{Q as p}from"./QPageContainer-DG-wVzFn.js";import{Q as g}from"./QLayout-Baan8rHJ.js";import{f,a as x,o as y,A as _,af as b,M as h,J as q,b as w,K as j,N as Q,V as k,F as A,R as E,I as C,Q as V,W as I,y as P,m as S,_ as T,$ as z}from"./vendor-DuKqz2x4.js";import{s as D}from"./i18n-DE5KxGn8.js";import L from"./QuExamTimer-BfyNcfof.js";import O from"./QuQuestionDisplay-dieC4GUv.js";import"./offline-BzIlwqNM.js";import"./ui-BITzTqrO.js";import"./QSpace-Bk4F2b8L.js";import"./katex-B0SjebBr.js";import"./katex-BXKQVcz-.js";const F={class:"text-h6"},$={class:"text-caption text-grey-7"},H={class:"exam-content"},M={class:"navigation-sidebar"},J={class:"text-caption text-grey-7 q-mb-sm"},N={class:"question-grid"},R={class:"text-caption text-grey-7 q-mb-xs"},U={class:"question-area"},W={class:"text-caption text-grey-7 q-mb-sm"},G={class:"q-gutter-sm"},K={class:"q-mt-md"},Y={class:"text-caption text-grey-7"},B={key:0,class:"text-caption text-warning q-mt-xs"},X=s({__name:"QuTakeExam",props:{exam:Object,attempt:Object,questions:Array,existing_answers:Object},setup(s){const X=l(),Z=s,ee=f(0),te=f({...Z.existing_answers}),ae=f(Date.now()),se=f(!1),le=f(!1),ne=f(!1),oe=f(!1);let ie=null;const re=x(()=>Z.questions[ee.value]),ue=x({get:()=>te.value[re.value.id]||{selected_options:[],answer_text:""},set(e){te.value[re.value.id]=e}}),de=x(()=>Object.keys(te.value).filter(e=>{const t=te.value[e],a=t.selected_options&&("string"==typeof t.selected_options&&t.selected_options.length>0||Array.isArray(t.selected_options)&&t.selected_options.length>0),s=t.answer_text&&t.answer_text.trim().length>0;return a||s}).length),ce=x(()=>{const e=Math.floor((Date.now()-ae.value)/1e3);if(e<10)return"Just now";if(e<60)return`${e}s ago`;return`${Math.floor(e/60)}m ago`}),me=e=>{const t=te.value[e];if(!t)return!1;const a=t.selected_options&&("string"==typeof t.selected_options&&t.selected_options.length>0||Array.isArray(t.selected_options)&&t.selected_options.length>0),s=t.answer_text&&t.answer_text.trim().length>0;return a||s},ve=e=>{if(ee.value===e)return"primary";const t=Z.questions[e];return me(t.id)?"positive":"grey-5"},pe=()=>{ee.value>0&&ee.value--},ge=()=>{ee.value<Z.questions.length-1&&ee.value++},fe=()=>{},xe=async(e=!0)=>{if(!le.value){se.value=!0;try{await T.post(D("qu-student.exams.auto-save",{quExam:Z.exam.id,quAttempt:Z.attempt.id}),{answers:te.value}),ae.value=Date.now(),e&&X.notify({type:"positive",message:"Progress saved",icon:"save",timeout:2e3})}catch(t){e&&X.notify({type:"negative",message:"Failed to save progress",icon:"error"}),console.error("Auto-save error:",t)}finally{se.value=!1}}},ye=()=>{ne.value=!0},_e=()=>{oe.value=!0,z.post(D("qu-student.exams.submit",{quExam:Z.exam.id,quAttempt:Z.attempt.id}),{answers:te.value},{onSuccess:()=>{le.value=!0,clearInterval(ie),X.notify({type:"positive",message:"Exam submitted successfully!",icon:"check_circle"})},onError:e=>{oe.value=!1,X.notify({type:"negative",message:e.message||"Failed to submit exam",icon:"error"})}})},be=()=>{le.value=!0,clearInterval(ie),_e()},he=e=>{},qe=()=>{},we=e=>{if(!le.value)return e.preventDefault(),e.returnValue="",""};return y(()=>{ie=setInterval(()=>{xe(!1)},3e4),window.addEventListener("beforeunload",we)}),_(()=>{ie&&clearInterval(ie),window.removeEventListener("beforeunload",we)}),(l,f)=>{const x=b("Head");return q(),h(A,null,[w(x,{title:s.exam.title||"Take Exam"},null,8,["title"]),w(g,S({view:"hHh lpR fFf",class:"bg-grey-1"},l.$attrs),{default:j(()=>[w(a,{elevated:"",class:"bg-white text-dark"},{default:j(()=>[w(e,null,{default:j(()=>[w(t,null,{default:j(()=>{var e;return[Q("div",F,k(s.exam.title),1),Q("div",$,k(null==(e=s.exam.subject)?void 0:e.name),1)]}),_:1}),w(L,{"remaining-seconds":s.attempt.remaining_seconds,"auto-submit":be,onTimeWarning:he,onTimeExpired:qe},null,8,["remaining-seconds"])]),_:1})]),_:1}),w(p,null,{default:j(()=>[Q("div",H,[Q("div",M,[w(n,null,{default:j(()=>[w(o,null,{default:j(()=>[f[3]||(f[3]=Q("div",{class:"text-subtitle2 q-mb-md"},"Questions",-1)),Q("div",J," Answered: "+k(de.value)+" / "+k(s.questions.length),1),Q("div",N,[(q(!0),h(A,null,E(s.questions,(e,t)=>(q(),C(r,{key:e.id,label:t+1,color:ve(t),outline:ee.value!==t,unelevated:ee.value===t,size:"sm",onClick:e=>(e=>{ee.value=e})(t),class:"question-nav-btn"},{default:j(()=>[me(e.id)?(q(),C(i,{key:0,name:"check",size:"xs",class:"absolute-top-right",style:{margin:"2px"}})):V("",!0)]),_:2},1032,["label","color","outline","unelevated","onClick"]))),128))])]),_:1}),w(u),w(o,null,{default:j(()=>[Q("div",R," Last saved: "+k(ce.value),1),se.value?(q(),C(v,{key:0,indeterminate:"",color:"primary",size:"2px"})):V("",!0)]),_:1})]),_:1})]),Q("div",U,[w(n,null,{default:j(()=>[w(o,null,{default:j(()=>[Q("div",W," Question "+k(ee.value+1)+" of "+k(s.questions.length),1),w(O,{question:re.value,index:ee.value+1,modelValue:ue.value,"onUpdate:modelValue":[f[0]||(f[0]=e=>ue.value=e),fe],readonly:!1,"show-correct-answer":!1},null,8,["question","index","modelValue"])]),_:1}),w(u),w(d,{align:"between",class:"q-pa-md"},{default:j(()=>[w(r,{flat:"",color:"primary",label:"Previous",icon:"chevron_left",disable:0===ee.value,onClick:pe},null,8,["disable"]),Q("div",G,[w(r,{outline:"",color:"primary",label:"Save Progress",icon:"save",onClick:f[1]||(f[1]=e=>xe(!0)),loading:se.value},null,8,["loading"]),w(r,{color:"negative",label:"Submit Exam",icon:"send",onClick:ye})]),w(r,{flat:"",color:"primary",label:"Next","icon-right":"chevron_right",disable:ee.value===s.questions.length-1,onClick:ge},null,8,["disable"])]),_:1})]),_:1})])])]),_:1}),w(c,{modelValue:ne.value,"onUpdate:modelValue":f[2]||(f[2]=e=>ne.value=e),persistent:""},{default:j(()=>[w(n,{style:{"min-width":"400px"}},{default:j(()=>[w(o,null,{default:j(()=>f[4]||(f[4]=[Q("div",{class:"text-h6"},"Submit Exam?",-1)])),_:1}),w(o,null,{default:j(()=>[f[5]||(f[5]=Q("p",null,"Are you sure you want to submit your exam?",-1)),Q("div",K,[Q("div",Y," Answered: "+k(de.value)+" / "+k(s.questions.length)+" questions ",1),de.value<s.questions.length?(q(),h("div",B,[w(i,{name:"warning",size:"sm"}),I(" You have "+k(s.questions.length-de.value)+" unanswered question(s) ",1)])):V("",!0)])]),_:1}),w(d,{align:"right"},{default:j(()=>[P(w(r,{flat:"",label:"Cancel",color:"primary"},null,512),[[m]]),w(r,{label:"Submit",color:"negative",onClick:_e,loading:oe.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},16)],64)}}},[["__scopeId","data-v-ddba3016"]]);export{X as default};
