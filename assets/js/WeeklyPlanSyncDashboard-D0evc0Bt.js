import{Q as e}from"./QSpinnerDots-CdUqmAKQ.js";import{o as l,u as a,c as s,d as t,m as i,Q as o,C as r,l as n,b as c,g as d,h as u,i as m,j as v,bb as p,aP as y}from"./app-BwCflFkV.js";import{Q as g}from"./QCircularProgress-geHKoKWc.js";import{Q as b}from"./QBadge-CShv2hr3.js";import{Q as f}from"./QTd-DftUN1Nv.js";import{Q as _}from"./QTable-C_EQBQcS.js";import{f as h,a as k,k as w,o as x,L as P,I as j,b as Q,M as C,H as q,O as z,J as I,U as E,y as M,F as N,Q as S,V as $,x as A,Z as D}from"./vendor-CUZ9QTQV.js";import{u as T}from"./useWeeklyPlansStore-CHtoznFq.js";import{u as V}from"./i18n-CP46N9fu.js";import"./offline-BzIlwqNM.js";import"./ui-LrZmvB2D.js";import"./QMarkupTable-CFmFAA-C.js";import"./QSelect-Cyosk05W.js";import"./rtl-Cr6c3OOr.js";import"./QLinearProgress-BKKQOFX1.js";import"./use-fullscreen-X4x-6n9-.js";import"./schoolData-BQSkQPXz.js";const F={class:"sync-dashboard q-pa-md"},U={key:0,class:"flex flex-center q-pa-xl"},W={key:1},B={class:"row q-col-gutter-md q-mb-lg"},L={class:"col-12 col-sm-6 col-md-3"},O={class:"stat-icon bg-blue-1 text-blue"},Y={class:"stat-value text-h4"},H={class:"stat-label text-grey-7"},J={class:"col-12 col-sm-6 col-md-3"},R={class:"stat-icon bg-green-1 text-green"},Z={class:"stat-value text-h4 text-positive"},G={class:"stat-label text-grey-7"},K={class:"col-12 col-sm-6 col-md-3"},X={class:"stat-icon bg-orange-1 text-orange"},ee={class:"stat-value text-h4 text-warning"},le={class:"stat-label text-grey-7"},ae={class:"col-12 col-sm-6 col-md-3"},se={class:"stat-icon bg-purple-1 text-purple"},te={class:"stat-value text-h4 text-primary"},ie={class:"stat-label text-grey-7"},oe={class:"row q-mb-lg"},re={class:"col-12"},ne={class:"row q-col-gutter-md"},ce={class:"row items-center q-mb-md"},de={class:"col"},ue={class:"text-h6"},me={class:"text-caption text-grey-7"},ve={class:"col-auto"},pe={class:"text-caption"},ye={key:0,class:"text-warning"},ge={class:"text-h6"},be={class:"text-caption text-grey-7"},fe={class:"text-h6 text-grey-7 q-mt-md"},_e={class:"text-grey-6"},he=l({__name:"WeeklyPlanSyncDashboard",setup(l){const{t:he}=V(),ke=T(),we=a(),xe=h(!1),Pe=h(!1),je=h(null),Qe=h(!1),Ce=h([]),qe=h([]),ze=h("all"),Ie=k(()=>"ar"===he("code")?"right":"left"),Ee=k(()=>[{name:"day",label:he("weeklyPlans.day"),field:"day",align:Ie.value,sortable:!0},{name:"period",label:he("weeklyPlans.period"),field:"period",align:"center",sortable:!0},{name:"subject",label:he("weeklyPlans.subject"),field:"subject",align:Ie.value,sortable:!0},{name:"teacher",label:he("weeklyPlans.teacher"),field:"teacher",align:Ie.value,sortable:!0},{name:"status",label:he("weeklyPlans.status"),field:"status",align:"center"}]),Me=async()=>{if(ke.selectedCopyId){xe.value=!0;try{const e=await D.get("/weekly-system/api/sync-analysis",{params:{copy_id:ke.selectedCopyId,week_number:ke.weekNumber,academic_year_id:ke.selectedAcademicYearId,semester_number:ke.semesterNumber}});je.value=e.data}catch(e){console.error("Error fetching sync analysis:",e),we.notify({type:"negative",message:"Failed to load sync analysis"})}finally{xe.value=!1}}},Ne=()=>{var e;ze.value="all",Ce.value=[],(null==(e=je.value)?void 0:e.classrooms)&&je.value.classrooms.forEach(e=>{e.days&&e.days.forEach(l=>{var a;(null==(a=l.missing_periods)?void 0:a.length)>0&&l.missing_periods.forEach(a=>{Ce.value.push({id:a.id,day:l.day,period:a.period,subject:a.subject,teacher:a.teacher,status:"missing",classroom_name:e.name})})})}),qe.value=[...Ce.value],Qe.value=!0},Se=()=>{var e,l;if("all"===ze.value)return"All Classrooms";const a=null==(l=null==(e=je.value)?void 0:e.classrooms)?void 0:l.find(e=>e.id===ze.value);return a?`Classroom ${a.name}`:""},$e=async()=>{var e,l;Pe.value=!0;try{const e=qe.value.map(e=>e.id),l=await D.post("/weekly-system/api/weekly-plans/batch-create",{schedule_ids:e,week_number:ke.weekNumber,academic_year_id:ke.selectedAcademicYearId,semester_number:ke.semesterNumber});we.notify({type:"positive",message:l.data.message||`Created ${e.length} weekly plans`}),Qe.value=!1,await Me()}catch(a){console.error(a),we.notify({type:"negative",message:(null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||"Failed to create plans"})}finally{Pe.value=!1}};return w(()=>[ke.selectedCopyId,ke.weekNumber,ke.semesterNumber],()=>{Me()},{deep:!0}),x(()=>{Me()}),(l,a)=>{var h,k,w,x,D;return j(),P("div",F,[xe.value?(j(),P("div",U,[Q(e,{size:"50px",color:"primary"})])):(j(),P("div",W,[C("div",B,[C("div",L,[Q(i,{flat:"",bordered:"",class:"stat-card"},{default:I(()=>[Q(s,null,{default:I(()=>{var e,l;return[C("div",O,[Q(t,{name:"grid_on",size:"32px"})]),C("div",Y,E((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.total_slots)||0),1),C("div",H,E(M(he)("weeklyPlans.totalSlots")),1)]}),_:1})]),_:1})]),C("div",J,[Q(i,{flat:"",bordered:"",class:"stat-card"},{default:I(()=>[Q(s,null,{default:I(()=>{var e,l;return[C("div",R,[Q(t,{name:"check_circle",size:"32px"})]),C("div",Z,E((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.complete)||0),1),C("div",G,E(M(he)("weeklyPlans.completed")),1)]}),_:1})]),_:1})]),C("div",K,[Q(i,{flat:"",bordered:"",class:"stat-card"},{default:I(()=>[Q(s,null,{default:I(()=>{var e,l;return[C("div",X,[Q(t,{name:"error",size:"32px"})]),C("div",ee,E((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.missing)||0),1),C("div",le,E(M(he)("weeklyPlans.missing")),1)]}),_:1})]),_:1})]),C("div",ae,[Q(i,{flat:"",bordered:"",class:"stat-card"},{default:I(()=>[Q(s,null,{default:I(()=>{var e,l;return[C("div",se,[Q(t,{name:"trending_up",size:"32px"})]),C("div",te,E((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.percentage)||0)+"%",1),C("div",ie,E(M(he)("weeklyPlans.progress")),1)]}),_:1})]),_:1})])]),C("div",oe,[C("div",re,[(null==(k=null==(h=je.value)?void 0:h.summary)?void 0:k.missing)>0?(j(),q(o,{key:0,color:"primary",icon:"sync",label:M(he)("weeklyPlans.syncAll"),loading:Pe.value,onClick:Ne,unelevated:"",size:"lg"},null,8,["label","loading"])):z("",!0)])]),C("div",ne,[(j(!0),P(N,null,S(null==(w=je.value)?void 0:w.classrooms,e=>(j(),P("div",{key:e.id,class:"col-12 col-md-6 col-lg-4"},[Q(i,{flat:"",bordered:"",class:"classroom-card"},{default:I(()=>[Q(s,null,{default:I(()=>{var l,a;return[C("div",ce,[C("div",de,[C("div",ue,E(e.name),1),C("div",me,E(e.complete)+"/"+E(e.total_slots)+" slots complete ",1)]),C("div",ve,[Q(g,{value:e.percentage,size:"80px",thickness:.15,color:(a=e.percentage,a>=80?"positive":a>=50?"warning":"negative"),"track-color":"grey-3","show-value":""},{default:I(()=>[C("div",pe,E(e.percentage)+"%",1)]),_:2},1032,["value","color"])])]),(null==(l=e.days)?void 0:l.length)?(j(),q(p,{key:0,icon:"calendar_today",label:M(he)("weeklyPlans.viewByDay"),dense:"","header-class":"text-primary"},{default:I(()=>[Q(d,{dense:"",separator:""},{default:I(()=>[(j(!0),P(N,null,S(e.days,e=>(j(),q(u,{key:e.day_number},{default:I(()=>[Q(m,null,{default:I(()=>[Q(v,null,{default:I(()=>[$(E(e.day),1)]),_:2},1024),Q(v,{caption:""},{default:I(()=>[$(E(e.complete)+"/"+E(e.total)+" complete ",1),e.missing>0?(j(),P("span",ye," (Missing: P"+E(e.missing_periods.join(", P"))+") ",1)):z("",!0)]),_:2},1024)]),_:2},1024),Q(m,{side:""},{default:I(()=>[Q(b,{color:e.missing>0?"warning":"positive",label:e.missing>0?`${e.missing} missing`:"Complete"},null,8,["color","label"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["label"])):z("",!0),e.missing>0?(j(),q(o,{key:1,color:"primary",icon:"sync",label:`${M(he)("weeklyPlans.syncWeeklyPlans")} (${e.missing})`,onClick:l=>(e=>{var l,a;ze.value=e,Ce.value=[];const s=null==(a=null==(l=je.value)?void 0:l.classrooms)?void 0:a.find(l=>l.id===e);s&&s.days&&s.days.forEach(e=>{var l;(null==(l=e.missing_periods)?void 0:l.length)>0&&e.missing_periods.forEach(l=>{Ce.value.push({id:l.id,day:e.day,period:l.period,subject:l.subject,teacher:l.teacher,status:"missing",classroom_name:s.name})})}),qe.value=[...Ce.value],Qe.value=!0})(e.id),outline:"",class:"full-width q-mt-md",size:"sm"},null,8,["label","onClick"])):z("",!0)]}),_:2},1024)]),_:2},1024)]))),128))]),Q(c,{modelValue:Qe.value,"onUpdate:modelValue":a[1]||(a[1]=e=>Qe.value=e),"full-width":""},{default:I(()=>[Q(i,null,{default:I(()=>[Q(s,null,{default:I(()=>[C("div",ge,E(M(he)("weeklyPlans.syncPreview"))+" - "+E(Se()),1),C("div",be,E(M(he)("weeklyPlans.selectMissingPlans")),1)]),_:1}),Q(s,{class:"q-pa-none"},{default:I(()=>[Q(_,{rows:Ce.value,columns:Ee.value,"row-key":"id",selection:"multiple",selected:qe.value,"onUpdate:selected":a[0]||(a[0]=e=>qe.value=e),flat:"",bordered:"",pagination:{rowsPerPage:0},"virtual-scroll":"",style:{height:"400px"}},{"body-cell-status":I(e=>[Q(f,{props:e},{default:I(()=>[Q(r,{color:"negative","text-color":"white",size:"sm",icon:"warning"},{default:I(()=>a[2]||(a[2]=[$(" Missing ")])),_:1})]),_:2},1032,["props"])]),_:1},8,["rows","columns","selected"])]),_:1}),Q(n,{align:"right",class:"q-pa-md"},{default:I(()=>[A(Q(o,{flat:"",label:M(he)("common.cancel"),color:"primary"},null,8,["label"]),[[y]]),Q(o,{unelevated:"",color:"primary",label:M(he)("weeklyPlans.createPlans",{count:qe.value.length}),disable:0===qe.value.length,loading:Pe.value,onClick:$e},null,8,["label","disable","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(null==(D=null==(x=je.value)?void 0:x.classrooms)?void 0:D.length)?z("",!0):(j(),q(i,{key:0,flat:"",bordered:"",class:"text-center q-pa-xl q-mt-lg"},{default:I(()=>[Q(t,{name:"check_circle",size:"64px",color:"positive"}),C("p",fe,E(M(he)("weeklyPlans.allSynced")),1),C("p",_e,E(M(he)("weeklyPlans.noMissingPlans")),1)]),_:1}))]))])}}},[["__scopeId","data-v-652055c6"]]);export{he as default};
