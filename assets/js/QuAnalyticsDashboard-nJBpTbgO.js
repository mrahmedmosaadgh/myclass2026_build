import{Q as e}from"./QSpace-BK_PGLKv.js";import{r as a,u as t,t as l,b as s,f as o,d as r,h as i,Q as d,aS as c,G as n,e as u}from"./app-DlLesFGi.js";import{Q as m}from"./QBadge-IdEcTs8C.js";import{Q as p}from"./QTd-BU_S4ffH.js";import{Q as f}from"./QTable-BIAJAIui.js";import{Q as v,a as g}from"./QToolbar-CJXOhUim.js";import{Q as x}from"./QSpinnerDots-B_GSDqC3.js";import{f as b,a as _,N as y,J as h,b as w,R as A,z as j,a4 as q,K as Q,W as S,V as k,I as E,O as P,y as T,F as V,_ as D}from"./vendor-BWKGNkNB.js";import{s as z}from"./i18n-B0T1C7j3.js";import{u as C,E as L,i as M,a as R,b as B,c as F,d as G,e as O,f as U}from"./install-7NukNujW.js";import"./offline-BzIlwqNM.js";import"./ui-B7TfxbV_.js";import"./QMarkupTable-CzIo4GGA.js";import"./QSelect-BTh0khse.js";import"./rtl-Cr6c3OOr.js";import"./QLinearProgress-CX6G9yBK.js";import"./use-fullscreen-BQHoXYBI.js";const I={class:"q-pa-md"},W={class:"row items-center q-mb-md"},J={class:"row q-col-gutter-md q-mb-lg"},K={class:"col-12 col-sm-6 col-md-3"},N={class:"text-h4 text-weight-bold"},X={class:"col-12 col-sm-6 col-md-3"},Y={class:"text-h4 text-weight-bold"},H={class:"col-12 col-sm-6 col-md-3"},Z={class:"text-h4 text-weight-bold"},$={class:"col-12 col-sm-6 col-md-3"},ee={class:"text-h4 text-weight-bold"},ae={class:"text-caption q-ml-xs text-grey"},te={class:"row justify-center q-py-xl"},le={class:"row q-col-gutter-md q-mb-lg"},se={class:"col-6 col-md-3"},oe={class:"text-h5 text-weight-bold"},re={class:"col-6 col-md-3"},ie={class:"text-h5 text-weight-bold text-primary"},de={class:"col-6 col-md-3"},ce={class:"text-h5 text-weight-bold text-indigo"},ne={class:"col-6 col-md-3"},ue={class:"text-h5 text-weight-bold text-green"},me={class:"row q-col-gutter-md"},pe={class:"col-12 col-md-6"},fe={class:"col-12 col-md-6"},ve={class:"q-mt-md"},ge={style:{"max-width":"400px","white-space":"normal",overflow:"hidden","text-overflow":"ellipsis"}},xe=a({__name:"QuAnalyticsDashboard",props:{exams:Array},setup(a){C([M,R,B,F,G,O,U]);const xe=a,be=t(),_e=b(""),ye=b(!1),he=b(null),we=b(!1),Ae=b(null),je=_(()=>xe.exams.reduce((e,a)=>e+a.attempts_count,0)),qe=_(()=>xe.exams.reduce((e,a)=>e+a.pending_grading,0)),Qe=_(()=>{const e=xe.exams.filter(e=>e.completed_attempts>0);if(0===e.length)return 0;const a=e.reduce((e,a)=>e+a.average_score/a.total_marks*100,0);return Math.round(a/e.length)}),Se=[{name:"title",required:!0,label:"Exam Title",align:"left",field:"title",sortable:!0},{name:"created_at",label:"Date",field:"created_at",sortable:!0},{name:"completed_attempts",label:"Attempts",field:"completed_attempts",sortable:!0},{name:"average_score",label:"Avg Score",field:"average_score",sortable:!0},{name:"pending_grading",label:"Pending Grading",field:"pending_grading",sortable:!0,classes:e=>e.pending_grading>0?"text-negative text-weight-bold":""},{name:"actions",label:"Actions",field:"actions",align:"right"}],ke=[{name:"text",label:"Question",field:"text",align:"left"},{name:"type",label:"Type",field:"type",align:"left"},{name:"bloom_level",label:"Bloom Level",field:"bloom_level",align:"left",sortable:!0},{name:"difficulty_label",label:"Difficulty",field:"difficulty_label",align:"left",sortable:!0}],Ee=(e,a)=>{const t=e/a*100;return t>=80?"green":t>=60?"blue":t>=40?"orange":"red"},Pe=()=>{be.notify({type:"info",message:"Export coming soon"})},Te=_(()=>{if(!Ae.value)return{};const e=Ae.value.score_distribution;return{tooltip:{trigger:"axis"},xAxis:{type:"category",data:Object.keys(e),name:"Score Range"},yAxis:{type:"value",name:"Students"},series:[{data:Object.values(e),type:"bar",color:"#3f51b5"}]}}),Ve=_(()=>{if(!Ae.value)return{};const e=Ae.value.bloom_stats;return{tooltip:{trigger:"axis"},xAxis:{type:"category",data:e.map(e=>e.level),axisLabel:{interval:0,rotate:30}},yAxis:{type:"value",name:"Avg Score %",max:100},series:[{data:e.map(e=>e.avg_percentage),type:"bar",color:"#ff9800",label:{show:!0,position:"top",formatter:"{c}%"}}]}});return(t,b)=>(h(),y(V,null,[w(j(q),{title:"Exam Analytics"}),A("div",I,[A("div",W,[b[3]||(b[3]=A("div",{class:"text-h5"},"Exam Analytics",-1)),w(e),w(s,{color:"secondary",icon:"table_chart",label:"Export All",disable:"",outline:""},{default:Q(()=>[w(l,null,{default:Q(()=>b[2]||(b[2]=[S("Coming Soon")])),_:1})]),_:1})]),A("div",J,[A("div",K,[w(r,{class:"bg-primary text-white"},{default:Q(()=>[w(o,null,{default:Q(()=>[b[4]||(b[4]=A("div",{class:"text-subtitle2"},"Total Exams",-1)),A("div",N,k(a.exams.length),1)]),_:1})]),_:1})]),A("div",X,[w(r,{class:"bg-teal text-white"},{default:Q(()=>[w(o,null,{default:Q(()=>[b[5]||(b[5]=A("div",{class:"text-subtitle2"},"Total Attempts",-1)),A("div",Y,k(je.value),1)]),_:1})]),_:1})]),A("div",H,[w(r,{class:"bg-orange text-white"},{default:Q(()=>[w(o,null,{default:Q(()=>[b[6]||(b[6]=A("div",{class:"text-subtitle2"},"Pending Grading",-1)),A("div",Z,k(qe.value),1)]),_:1})]),_:1})]),A("div",$,[w(r,{class:"bg-indigo text-white"},{default:Q(()=>[w(o,null,{default:Q(()=>[b[7]||(b[7]=A("div",{class:"text-subtitle2"},"Avg Score",-1)),A("div",ee,k(Qe.value)+"%",1)]),_:1})]),_:1})])]),w(r,null,{default:Q(()=>[w(f,{title:"Exam Performance",rows:a.exams,columns:Se,"row-key":"id",filter:_e.value,pagination:{rowsPerPage:10}},{"top-right":Q(()=>[w(i,{borderless:"",dense:"",debounce:"300",modelValue:_e.value,"onUpdate:modelValue":b[0]||(b[0]=e=>_e.value=e),placeholder:"Search"},{append:Q(()=>[w(d,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-average_score":Q(e=>[w(p,{props:e},{default:Q(()=>[w(m,{color:Ee(e.value,e.row.total_marks)},{default:Q(()=>[S(k(e.value)+" / "+k(e.row.total_marks),1)]),_:2},1032,["color"]),A("span",ae," ("+k(Math.round(e.value/e.row.total_marks*100))+"%) ",1)]),_:2},1032,["props"])]),"body-cell-actions":Q(e=>[w(p,{props:e,align:"right"},{default:Q(()=>[w(s,{flat:"",round:"",color:"primary",icon:"analytics",onClick:a=>(async e=>{he.value=e,ye.value=!0,we.value=!0,Ae.value=null;try{const a=await D.get(z("qu-analytics.exam",e.id));Ae.value=a.data}catch(a){console.error(a),be.notify({type:"negative",message:"Failed to load analytics data"})}finally{we.value=!1}})(e.row)},{default:Q(()=>[w(l,null,{default:Q(()=>b[8]||(b[8]=[S("View Detailed Analytics")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","filter"])]),_:1}),w(u,{modelValue:ye.value,"onUpdate:modelValue":b[1]||(b[1]=e=>ye.value=e),maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:Q(()=>[w(r,{class:"bg-grey-1"},{default:Q(()=>[w(v,{class:"bg-primary text-white"},{default:Q(()=>[T(w(s,{flat:"",round:"",dense:"",icon:"close"},null,512),[[c]]),w(g,null,{default:Q(()=>{var e;return[S(" Analytics: "+k(null==(e=he.value)?void 0:e.title),1)]}),_:1}),w(s,{flat:"",icon:"download",label:"Export Report",onClick:Pe,disable:""})]),_:1}),we.value?(h(),E(o,{key:0,class:"q-pa-md"},{default:Q(()=>[A("div",te,[w(x,{color:"primary",size:"3em"}),b[9]||(b[9]=A("div",{class:"text-grey q-mt-md"},"Loading analytics data...",-1))])]),_:1})):Ae.value?(h(),E(o,{key:1,class:"q-pa-md"},{default:Q(()=>[A("div",le,[A("div",se,[w(r,{flat:"",bordered:"",class:"text-center q-pa-sm"},{default:Q(()=>[b[10]||(b[10]=A("div",{class:"text-caption text-grey"},"Attempts",-1)),A("div",oe,k(Ae.value.overview.total_attempts),1)]),_:1})]),A("div",re,[w(r,{flat:"",bordered:"",class:"text-center q-pa-sm"},{default:Q(()=>[b[11]||(b[11]=A("div",{class:"text-caption text-grey"},"Average Score",-1)),A("div",ie,k(Ae.value.overview.avg_score),1)]),_:1})]),A("div",de,[w(r,{flat:"",bordered:"",class:"text-center q-pa-sm"},{default:Q(()=>[b[12]||(b[12]=A("div",{class:"text-caption text-grey"},"Median Score",-1)),A("div",ce,k(Ae.value.overview.median_score),1)]),_:1})]),A("div",ne,[w(r,{flat:"",bordered:"",class:"text-center q-pa-sm"},{default:Q(()=>[b[13]||(b[13]=A("div",{class:"text-caption text-grey"},"Pass Rate",-1)),A("div",ue,k(Ae.value.overview.pass_rate)+"%",1)]),_:1})])]),A("div",me,[A("div",pe,[w(r,{flat:"",bordered:"",class:"full-height"},{default:Q(()=>[w(o,null,{default:Q(()=>b[14]||(b[14]=[A("div",{class:"text-h6"},"Score Distribution",-1)])),_:1}),w(o,{style:{height:"300px"}},{default:Q(()=>[w(j(L),{class:"chart",option:Te.value,autoresize:""},null,8,["option"])]),_:1})]),_:1})]),A("div",fe,[w(r,{flat:"",bordered:"",class:"full-height"},{default:Q(()=>[w(o,null,{default:Q(()=>b[15]||(b[15]=[A("div",{class:"text-h6"},"Bloom's Taxonomy Performance",-1)])),_:1}),w(o,{style:{height:"300px"}},{default:Q(()=>[w(j(L),{class:"chart",option:Ve.value,autoresize:""},null,8,["option"])]),_:1})]),_:1})])]),A("div",ve,[w(r,{flat:"",bordered:""},{default:Q(()=>[w(o,null,{default:Q(()=>b[16]||(b[16]=[A("div",{class:"text-h6"},"Question Difficulty Analysis",-1)])),_:1}),w(f,{rows:Ae.value.question_stats,columns:ke,"row-key":"id",pagination:{rowsPerPage:10},dense:""},{"body-cell-difficulty_label":Q(e=>[w(p,{props:e},{default:Q(()=>{return[w(n,{dense:"",color:(a=e.row.percentage_correct,a>=80?"green":a>=50?"orange":"red"),"text-color":"white"},{default:Q(()=>[S(k(e.value)+" ("+k(e.row.percentage_correct)+"%) ",1)]),_:2},1032,["color"])];var a}),_:2},1032,["props"])]),"body-cell-text":Q(e=>[w(p,{props:e},{default:Q(()=>[A("div",ge,k(e.value),1)]),_:2},1032,["props"])]),_:1},8,["rows"])]),_:1})])]),_:1})):P("",!0)]),_:1})]),_:1},8,["modelValue"])])],64))}},[["__scopeId","data-v-c8321de5"]]);export{xe as default};
