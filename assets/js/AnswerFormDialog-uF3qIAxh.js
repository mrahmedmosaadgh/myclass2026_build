import{o as e,u as a,c as l,d as t,aP as s,Q as o,f as i,C as r,n as u,l as n,m as d,b as m}from"./app-DOc39CFu.js";import{Q as c}from"./QSpace-DuS_4lXE.js";import{Q as v}from"./QFile-Dhj0vy9l.js";import{Q as p}from"./QSelect-Dkiz84LX.js";import{Q as b}from"./QForm-CqUo2wlA.js";import{r as w}from"./resumeApi-BjxY7M1b.js";import{a as f,f as h,k as g,e as y,I as x,J as _,K as V,b as q,N as k,y as j,W as A,V as M,M as U,Q as R,F as Q,R as S,z as F}from"./vendor-DuKqz2x4.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";import"./use-file-BqyVk4Qc.js";import"./rtl-Cr6c3OOr.js";const N={class:"text-h6"},B={class:"q-mb-md"},C={class:"q-mb-md"},D={class:"q-mb-md"},z={key:0,class:"q-mt-sm"},E={class:"q-mb-md"},I={class:"row q-gutter-sm items-center"},P={key:0,class:"row items-center q-gutter-sm"},L={class:"text-caption"},T={class:"q-mb-md"},O={class:"q-mb-md"},$={class:"q-mb-md"},K=e({__name:"AnswerFormDialog",props:{modelValue:{type:Boolean,default:!1},answer:{type:Object,default:null},questionId:{type:Number,required:!0}},emits:["update:modelValue","save"],setup(e,{emit:K}){const G=e,J=K,W=a(),X=f({get:()=>G.modelValue,set:e=>J("update:modelValue",e)}),Y=h(!1),H=h({}),Z=h(null),ee=h(""),ae=h(!1),le=h(null),te=h(0),se=h(null),oe=h([]),ie=h({answer_text:"",media_links:[],attachments:[],status:"draft",notes:"",is_public:!1}),re=[{label:"Draft",value:"draft"},{label:"Published",value:"published"},{label:"Under Review",value:"review"},{label:"Archived",value:"archived"}],ue=f(()=>!!G.answer),ne=()=>{ie.value={answer_text:"",media_links:[],attachments:[],status:"draft",notes:"",is_public:!1},Z.value=null,ee.value="",le.value=null,H.value={}},de=()=>{if(!me())return;Y.value=!0,H.value={};const e={...ie.value,media_links:ee.value.split("\n").map(e=>e.trim()).filter(e=>e.length>0)};le.value&&(e.voice_note=le.value);(ue.value?w.updateAnswer(G.answer.id,e):w.createAnswer(G.questionId,e)).then(()=>{W.notify({type:"positive",message:`Answer ${ue.value?"updated":"created"} successfully`,position:"top"}),J("save"),X.value=!1}).catch(e=>{var a,l;console.error("Error saving answer:",e),(null==(l=null==(a=e.response)?void 0:a.data)?void 0:l.errors)&&(H.value=e.response.data.errors),W.notify({type:"negative",message:`Failed to ${ue.value?"update":"create"} answer`,position:"top"})}).finally(()=>{Y.value=!1})},me=()=>(H.value={},!!ie.value.answer_text.trim()||(H.value.answer_text="Answer text is required",!1)),ce=e=>{W.notify({type:"negative",message:`${e.length} file(s) rejected. Check file size and type.`,position:"top"})},ve=e=>{if(!e)return"";const a=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,a)*100)/100+" "+["Bytes","KB","MB","GB"][a]},pe=async()=>{ae.value?we():await be()},be=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});se.value=new MediaRecorder(e),oe.value=[],se.value.ondataavailable=e=>{oe.value.push(e.data)},se.value.onstop=()=>{const a=new Blob(oe.value,{type:"audio/wav"});le.value=a,e.getTracks().forEach(e=>e.stop())},se.value.start(),ae.value=!0;const a=Date.now(),l=setInterval(()=>{ae.value?te.value=Math.floor((Date.now()-a)/1e3):clearInterval(l)},1e3)}catch(e){console.error("Error starting recording:",e),W.notify({type:"negative",message:"Failed to start recording. Please check microphone permissions.",position:"top"})}},we=()=>{se.value&&ae.value&&(se.value.stop(),ae.value=!1)},fe=()=>{if(le.value){new Audio(URL.createObjectURL(le.value)).play()}},he=()=>{le.value=null,te.value=0};return g(()=>G.answer,e=>{var a;e?(a=e)&&(ie.value={answer_text:a.answer_text||"",media_links:a.media_links||[],attachments:a.attachments||[],status:a.status||"draft",notes:a.notes||"",is_public:a.is_public||!1},ee.value=(a.media_links||[]).join("\n")):ne()},{immediate:!0}),g(()=>G.modelValue,e=>{e||ne()}),y(()=>{ae.value&&we()}),(e,a)=>(_(),x(m,{modelValue:X.value,"onUpdate:modelValue":a[6]||(a[6]=e=>X.value=e),persistent:"",maximized:F(W).screen.lt.md,"full-width":F(W).screen.gt.sm,"transition-show":"slide-up","transition-hide":"slide-down"},{default:V(()=>[q(d,{style:{"min-width":"600px","max-width":"800px",width:"100%"}},{default:V(()=>[q(l,{class:"row items-center q-pb-none bg-primary text-white"},{default:V(()=>[k("div",N,[q(t,{name:"edit",class:"q-mr-sm"}),A(" "+M(ue.value?"Edit Answer":"Add New Answer"),1)]),q(c),j(q(o,{icon:"close",flat:"",round:"",dense:"",color:"white"},null,512),[[s]])]),_:1}),q(b,{onSubmit:de,class:"q-pa-md"},{default:V(()=>[k("div",B,[a[7]||(a[7]=k("label",{class:"text-subtitle2 q-mb-sm block"},"Answer Text *",-1)),q(i,{modelValue:ie.value.answer_text,"onUpdate:modelValue":a[0]||(a[0]=e=>ie.value.answer_text=e),type:"textarea",rows:"6",outlined:"",placeholder:"Enter your answer here...",error:!!H.value.answer_text,"error-message":H.value.answer_text,counter:"",maxlength:"5000"},null,8,["modelValue","error","error-message"])]),k("div",C,[a[8]||(a[8]=k("label",{class:"text-subtitle2 q-mb-sm block"},"Media Links",-1)),q(i,{modelValue:ee.value,"onUpdate:modelValue":a[1]||(a[1]=e=>ee.value=e),type:"textarea",rows:"3",outlined:"",placeholder:"Enter media URLs (one per line)",hint:"Add YouTube, image, or other media URLs"},null,8,["modelValue"])]),k("div",D,[a[11]||(a[11]=k("label",{class:"text-subtitle2 q-mb-sm block"},"File Attachments",-1)),q(v,{modelValue:Z.value,"onUpdate:modelValue":a[2]||(a[2]=e=>Z.value=e),multiple:"",outlined:"",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.mp4,.mp3","max-file-size":"10485760",onRejected:ce},{prepend:V(()=>[q(t,{name:"attach_file"})]),hint:V(()=>a[9]||(a[9]=[A(" Max 10MB per file. Supported: PDF, DOC, images, videos, audio ")])),_:1},8,["modelValue"]),Z.value&&Z.value.length>0?(_(),U("div",z,[a[10]||(a[10]=k("div",{class:"text-caption q-mb-xs"},"Selected files:",-1)),(_(!0),U(Q,null,S(Z.value,(e,a)=>{return _(),x(r,{key:a,removable:"",onRemove:e=>(e=>{Z.value&&Array.isArray(Z.value)&&Z.value.splice(e,1)})(a),color:"blue-1","text-color":"blue-8",icon:(l=e.type,(null==l?void 0:l.includes("image"))?"image":(null==l?void 0:l.includes("video"))?"videocam":(null==l?void 0:l.includes("audio"))?"audiotrack":(null==l?void 0:l.includes("pdf"))?"picture_as_pdf":"description")},{default:V(()=>[A(M(e.name)+" ("+M(ve(e.size))+") ",1)]),_:2},1032,["onRemove","icon"]);var l}),128))])):R("",!0)]),k("div",E,[a[12]||(a[12]=k("label",{class:"text-subtitle2 q-mb-sm block"},"Voice Note",-1)),k("div",I,[q(o,{color:ae.value?"negative":"primary",icon:ae.value?"stop":"mic",label:ae.value?"Stop Recording":"Record Voice Note",onClick:pe},null,8,["color","icon","label"]),le.value?(_(),U("div",P,[q(o,{icon:"play_arrow",flat:"",round:"",onClick:fe}),q(o,{icon:"delete",flat:"",round:"",color:"negative",onClick:he}),k("span",L,M(te.value)+"s",1)])):R("",!0)])]),k("div",T,[a[13]||(a[13]=k("label",{class:"text-subtitle2 q-mb-sm block"},"Status",-1)),q(p,{modelValue:ie.value.status,"onUpdate:modelValue":a[3]||(a[3]=e=>ie.value.status=e),options:re,outlined:"","emit-value":"","map-options":""},null,8,["modelValue"])]),k("div",O,[a[14]||(a[14]=k("label",{class:"text-subtitle2 q-mb-sm block"},"Private Notes",-1)),q(i,{modelValue:ie.value.notes,"onUpdate:modelValue":a[4]||(a[4]=e=>ie.value.notes=e),type:"textarea",rows:"3",outlined:"",placeholder:"Add private notes (only visible to you)"},null,8,["modelValue"])]),k("div",$,[q(u,{modelValue:ie.value.is_public,"onUpdate:modelValue":a[5]||(a[5]=e=>ie.value.is_public=e),label:"Make this answer public",color:"primary"},null,8,["modelValue"]),a[15]||(a[15]=k("div",{class:"text-caption text-grey-6 q-mt-xs"}," Public answers can be viewed by other users ",-1))]),q(n,{align:"right",class:"q-pt-md"},{default:V(()=>[j(q(o,{flat:"",label:"Cancel",color:"grey-7"},null,512),[[s]]),q(o,{type:"submit",label:ue.value?"Update Answer":"Save Answer",color:"primary",loading:Y.value,disable:!ie.value.answer_text.trim()},null,8,["label","loading","disable"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","maximized","full-width"]))}},[["__scopeId","data-v-eb660792"]]);export{K as default};
