import{r as e,u as l,Q as s,t as a,b as t,j as o,i as c,ao as n,aS as d}from"./app-DraepSDZ.js";import{Q as u}from"./QBadge-VPRr201m.js";import{a as r,N as i,J as h,I as v,O as m,K as p,W as f,V as _,S as y,R as b,b as g,a0 as k,y as w,U as j}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";const x={key:0,class:"cell-empty"},C={key:1,class:"assign-text"},I={key:2},T=["title"],S={key:1,class:"teacher text-shadow"},$={key:2,class:"classroom w-full flex justify-center items-center text-shadow"},B={class:"p-1 text-xl font-black"},z={class:"indicators"},O=e({__name:"TimetableCell",props:{schedule:{type:Object,default:null},showClassroom:{type:Boolean,default:!1},hideTeacher:{type:Boolean,default:!1},conflictInfo:{type:Object,default:null},readonly:{type:Boolean,default:!1},showFullName:{type:Boolean,default:!1},rewardSystemDisabled:{type:Boolean,default:!1}},emits:["click","edit","clear","open-reward"],setup(e,{emit:O}){const q=l(),D=e,N=O;r(()=>{var e,l,s,a,t;return(null==(s=null==(l=null==(e=D.schedule)?void 0:e.cst)?void 0:l.subject)?void 0:s.name)||(null==(t=null==(a=D.schedule)?void 0:a.cst)?void 0:t.subject_name)||"Subject"}),r(()=>{var e,l,s,a,t;return(null==(s=null==(l=null==(e=D.schedule)?void 0:e.cst)?void 0:l.teacher)?void 0:s.name)||(null==(t=null==(a=D.schedule)?void 0:a.cst)?void 0:t.teacher_name)||"Teacher"});const Q=r(()=>{var e,l,s,a,t;return(null==(s=null==(l=null==(e=D.schedule)?void 0:e.cst)?void 0:l.subject)?void 0:s.name)||(null==(t=null==(a=D.schedule)?void 0:a.cst)?void 0:t.subject_name)||"Subject"}),F=r(()=>{var e,l,s,a,t;return(null==(s=null==(l=null==(e=D.schedule)?void 0:e.cst)?void 0:l.teacher)?void 0:s.name)||(null==(t=null==(a=D.schedule)?void 0:a.cst)?void 0:t.teacher_name)||"Teacher"}),L=r(()=>{const e=Q.value;return e.length>3?e.substring(0,3):e}),A=r(()=>{const e=F.value.split(" ");if(1===e.length)return e[0].length>3?e[0].substring(0,3):e[0];return`${e[0].length>3?e[0].substring(0,3):e[0]} ${e[e.length-1].length>3?e[e.length-1].substring(0,3):e[e.length-1]}`}),E=r(()=>{var e,l,s,a,t;return(null==(s=null==(l=null==(e=D.schedule)?void 0:e.cst)?void 0:l.classroom)?void 0:s.name)||(null==(t=null==(a=D.schedule)?void 0:a.cst)?void 0:t.classroom_name)||""}),J=r(()=>{var e,l,s,a;return(null==(l=null==(e=D.schedule)?void 0:e.cst)?void 0:l.c_bg)||(null==(a=null==(s=D.schedule)?void 0:s.cst)?void 0:a.color_custom)||"#e0e0e0"}),K=r(()=>{var e,l,s,a;return(null==(l=null==(e=D.schedule)?void 0:e.cst)?void 0:l.c_text)||(null==(a=null==(s=D.schedule)?void 0:s.cst)?void 0:a.color_custom_text)||"#333333"}),R=r(()=>{var e,l,s;return{"is-empty":!(null==(e=D.schedule)?void 0:e.cst_id),"is-assigned":!!(null==(l=D.schedule)?void 0:l.cst_id),"has-substitute":!!(null==(s=D.schedule)?void 0:s.teacher_substitute_id),"has-conflict":!!D.conflictInfo,"cursor-pointer":!D.readonly,"is-readonly":D.readonly}}),U=r(()=>!!D.conflictInfo),V=r(()=>{if(!D.conflictInfo)return"";const e=D.conflictInfo.other_classrooms||[];if(0===e.length)return"Teacher has a scheduling conflict";const l=e.map(e=>`${e.classroom_name} (${e.subject_name})`).join(", ");return`⚠️ Conflict: ${D.conflictInfo.teacher_name} is also assigned to: ${l}`}),W=()=>{var e,l,s;if(!(null==(s=null==(l=null==(e=D.schedule)?void 0:e.cst)?void 0:l.teacher)?void 0:s.id))return;const a=(D.schedule.cst.teacher.name||"teacher").toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),t=route("schedules.teacher.view",{teacher_id:D.schedule.cst.teacher.id,teacher_name:a});navigator.clipboard.writeText(t).then(()=>{q.notify({type:"positive",message:"Teacher schedule link copied to clipboard!",position:"top",timeout:2e3})})},G=()=>{D.readonly||N("click",D.schedule)},H=(e="positive")=>{var l;if(!(null==(l=D.schedule)?void 0:l.cst))return;const s=D.schedule.cst.classroom_id,a=D.schedule.cst.subject_id,t=D.schedule.period_number||D.schedule.period,o=(new Date).toISOString().split("T")[0];N("open-reward",{classroomId:s,subjectId:a,period:t,date:o,schedule:D.schedule,initialTab:e})};return(l,r)=>{var O,q,D;return h(),i("div",{class:j(["timetable-cell",R.value]),onClick:G},[(null==(O=e.schedule)?void 0:O.cst_id)?(h(),i("div",{key:1,class:"cell-content w-full h-full shadow-sm",style:y({backgroundColor:J.value,color:K.value})},[e.schedule.period_order?(h(),v(u,{key:0,class:"period-badge assigned",style:y({backgroundColor:K.value,color:J.value})},{default:p(()=>[f(_(e.schedule.period_order),1)]),_:1},8,["style"])):m("",!0),b("div",{class:"subject text-shadow mt-4",title:Q.value},_(e.showFullName?Q.value:L.value),9,T),e.hideTeacher?m("",!0):(h(),i("div",S,[g(s,{name:"person",size:"xs",style:y({color:K.value})},null,8,["style"]),f(" "+_(A.value),1)])),e.showClassroom?(h(),i("div",$,[b("span",B,_(E.value),1)])):m("",!0),b("div",z,[U.value?(h(),v(s,{key:0,name:"warning",color:"negative",class:"shadow-1"},{default:p(()=>[g(a,null,{default:p(()=>[f(_(V.value),1)]),_:1})]),_:1})):m("",!0),e.schedule.teacher_substitute_id?(h(),v(s,{key:1,name:"swap_horiz",color:"orange",class:"shadow-1"},{default:p(()=>[g(a,null,{default:p(()=>r[2]||(r[2]=[f("Substitute")])),_:1})]),_:1})):m("",!0),e.schedule.co_teacher_id?(h(),v(s,{key:2,name:"group",color:"primary",class:"shadow-1"},{default:p(()=>[g(a,null,{default:p(()=>r[3]||(r[3]=[f("Co-teacher")])),_:1})]),_:1})):m("",!0)]),e.readonly?(h(),v(t,{key:3,round:"",dense:"",size:"xs",icon:"stars",disable:e.rewardSystemDisabled,color:"amber",class:"reward-btn glass-effect",onClick:k(H,["stop"])},null,8,["disable"])):m("",!0)],4)):(h(),i("div",x,[e.readonly?m("",!0):(h(),v(s,{key:0,name:"add",size:"sm"})),e.readonly?(h(),i("span",I,"-")):(h(),i("span",C,"Assign")),(null==(q=e.schedule)?void 0:q.period_order)?(h(),v(u,{key:3,class:"period-badge empty"},{default:p(()=>[f(_(e.schedule.period_order),1)]),_:1})):m("",!0)])),(null==(D=e.schedule)?void 0:D.cst_id)&&!e.readonly?(h(),v(n,{key:2,"context-menu":""},{default:p(()=>[g(c,{dense:""},{default:p(()=>[w((h(),v(o,{clickable:"",onClick:r[0]||(r[0]=s=>l.$emit("edit",e.schedule))},{default:p(()=>[g(s,{name:"edit",class:"q-mr-sm"}),r[4]||(r[4]=f(" Edit "))]),_:1})),[[d]]),w((h(),v(o,{clickable:"",onClick:W},{default:p(()=>[g(s,{name:"link",class:"q-mr-sm text-primary"}),r[5]||(r[5]=f(" Link "))]),_:1})),[[d]]),w((h(),v(o,{clickable:"",onClick:r[1]||(r[1]=s=>l.$emit("clear",e.schedule))},{default:p(()=>[g(s,{name:"clear",class:"q-mr-sm text-negative"}),r[6]||(r[6]=f(" Clear "))]),_:1})),[[d]])]),_:1})]),_:1})):m("",!0)],2)}}},[["__scopeId","data-v-604faeed"]]);export{O as default};
