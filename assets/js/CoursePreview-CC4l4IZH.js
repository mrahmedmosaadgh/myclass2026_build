import{o as e,u as l,B as a,g as s,R as t,i as r,A as o,j as n,Q as i,h as u,d as c,f as d,aE as m}from"./app-CqJgtQaN.js";import{Q as v}from"./QTree-BQKOtXup.js";import{Q as p}from"./QBadge-Coi-CloS.js";import{Q as f}from"./QSplitter-BXhQx5EZ.js";import{f as y,a as h,o as g,M as w,J as x,b as k,K as _,N as q,Q as C,I as b,V as L,W as j,F as $,R as Q,y as I}from"./vendor-DuKqz2x4.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";const V={class:"course-preview"},N={class:"q-pa-md"},S={class:"row items-center q-mb-md"},z={key:1,class:"text-center q-pa-md"},B={key:2,class:"text-center q-pa-md"},R={class:"text-negative q-mt-sm"},E={class:"row items-center"},F={class:"q-pa-md"},P={key:0},T={class:"row items-center q-mb-md"},U={class:"text-h4 col"},A={key:0,class:"text-center q-mt-xl"},H={class:"text-grey-7 q-mt-md"},J={key:0},K={key:1},M={key:1,class:"text-center q-mt-xl"},W=e({__name:"CoursePreview",setup(e){const W=l(),D=y(25),G=y(null),O=y(""),X=y(!1),Y=y([]),Z=y(!1),ee=y(null),le=h(()=>Y.value.map(e=>{var l;return{id:`course-${e.id}`,name:e.name,type:"course",children:(null==(l=e.levels)?void 0:l.map(l=>{var a;return{id:`level-${l.id}`,name:l.title,displayName:`${l.order||1}. ${l.title}`,type:"level",courseId:e.id,levelId:l.id,children:(null==(a=l.sections)?void 0:a.map(a=>({id:`section-${a.id}`,name:a.title,displayName:`${l.order||1}.${a.order||1}. ${a.title}`,type:"section",courseId:e.id,levelId:l.id,sectionId:a.id,lessons:a.lessons||[]})))||[]}}))||[]}})),ae=h(()=>{if(!O.value)return le.value;const e=O.value.toLowerCase();return le.value.map(l=>{if(l.name.toLowerCase().includes(e))return l;const a=l.children.filter(l=>{if(l.name.toLowerCase().includes(e))return!0;const a=l.children.filter(l=>{var a;if(l.name.toLowerCase().includes(e))return!0;return((null==(a=l.lessons)?void 0:a.filter(l=>l.title.toLowerCase().includes(e)||l.text&&l.text.toLowerCase().includes(e)))||[]).length>0});return a.length>0?{...l,children:a}:null}).filter(Boolean);return a.length>0?{...l,children:a}:null}).filter(Boolean)}),se=h(()=>{if(!G.value)return null;const e=oe(G.value);return e&&"section"===e.type?{name:e.name,lessons:e.lessons||[],originalLessons:e.lessons||[]}:null}),te=h(()=>{if(!se.value)return[];let e=se.value.originalLessons||[];if(O.value){const l=O.value.toLowerCase();e=e.filter(e=>e.title.toLowerCase().includes(l)||e.text&&e.text.toLowerCase().includes(l))}return e}),re=async()=>{Z.value=!0,ee.value=null;try{const e=await fetch("/course-management/api/courses/with-structure");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const l=await e.json();Y.value=l.data||l}catch(e){console.error("Error loading courses:",e),ee.value="Failed to load courses. Please try again.",W.notify({type:"negative",message:"Failed to load courses",position:"top"})}finally{Z.value=!1}},oe=e=>{for(const l of le.value){if(l.id===e)return l;for(const a of l.children||[]){if(a.id===e)return a;for(const l of a.children||[])if(l.id===e)return l}}return null},ne=e=>{switch(e.type){case"course":return"school";case"level":return"layers";case"section":return"description";default:return"help_outline"}},ie=e=>{switch(e.type){case"course":return"primary";case"level":return"secondary";case"section":return"accent";default:return"grey"}},ue=e=>{console.log("Selected node:",e)},ce=()=>{X.value=!X.value,X.value||(O.value="")};return g(()=>{re()}),(e,l)=>(x(),w("div",V,[k(f,{modelValue:D.value,"onUpdate:modelValue":l[2]||(l[2]=e=>D.value=e),style:{height:"100vh"},limits:[20,50]},{before:_(()=>[k(a,{class:"fit"},{default:_(()=>[q("div",N,[q("div",S,[l[3]||(l[3]=q("h3",{class:"text-h5 col"},"Course Structure",-1)),k(i,{flat:"",round:"",icon:"search",onClick:ce,color:X.value?"primary":"grey"},null,8,["color"])]),X.value?(x(),b(d,{key:0,modelValue:O.value,"onUpdate:modelValue":l[0]||(l[0]=e=>O.value=e),placeholder:"Search levels, sections, and lessons...",dense:"",outlined:"",class:"q-mb-md",clearable:""},{prepend:_(()=>[k(c,{name:"search"})]),_:1},8,["modelValue"])):C("",!0),Z.value?(x(),w("div",z,[k(m,{color:"primary",size:"3em"}),l[4]||(l[4]=q("div",{class:"q-mt-sm"},"Loading courses...",-1))])):ee.value?(x(),w("div",B,[k(c,{name:"error",size:"3em",color:"negative"}),q("div",R,L(ee.value),1),k(i,{color:"primary",label:"Retry",onClick:re,class:"q-mt-md"})])):(x(),b(v,{key:3,nodes:ae.value,"node-key":"id","label-key":"name","children-key":"children",selected:G.value,"onUpdate:selected":[l[1]||(l[1]=e=>G.value=e),ue],"default-expand-all":""},{"default-header":_(e=>[q("div",E,[k(c,{name:ne(e.node),size:"20px",class:"q-mr-sm",color:ie(e.node)},null,8,["name","color"]),q("span",null,L(e.node.displayName||e.node.name),1)])]),_:1},8,["nodes","selected"]))])]),_:1})]),after:_(()=>[k(a,{class:"fit"},{default:_(()=>[q("div",F,[se.value?(x(),w("div",P,[q("div",T,[q("h2",U,L(se.value.name),1),O.value?(x(),b(p,{key:0,color:"primary",class:"q-ml-sm"},{default:_(()=>{var e;return[j(L(te.value.length)+" of "+L((null==(e=se.value.originalLessons)?void 0:e.length)||0)+" lessons ",1)]}),_:1})):C("",!0)]),k(s,{bordered:"",separator:""},{default:_(()=>[(x(!0),w($,null,Q(te.value,(e,l)=>I((x(),b(u,{key:e.id,clickable:"",class:"q-py-md"},{default:_(()=>[k(r,{avatar:""},{default:_(()=>[k(o,{color:"primary","text-color":"white"},{default:_(()=>[j(L(l+1),1)]),_:2},1024)]),_:2},1024),k(r,null,{default:_(()=>[k(n,{class:"text-subtitle1"},{default:_(()=>[j(L(e.title),1)]),_:2},1024),e.text?(x(),b(n,{key:0,caption:""},{default:_(()=>[j(L(e.text),1)]),_:2},1024)):C("",!0)]),_:2},1024),k(r,{side:""},{default:_(()=>[k(i,{flat:"",round:"",icon:"play_arrow",color:"primary",onClick:l=>(e=>{W.notify({type:"positive",message:`Starting lesson: ${e.title}`,position:"top"})})(e)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)),[[t]])),128))]),_:1}),te.value&&0!==te.value.length?C("",!0):(x(),w("div",A,[k(c,{name:"info",size:"48px",color:"grey-5"}),q("p",H,[O.value?(x(),w("span",J,'No lessons match "'+L(O.value)+'"',1)):(x(),w("span",K,"No lessons available in this section"))])]))])):Z.value?C("",!0):(x(),w("div",M,[k(c,{name:"touch_app",size:"48px",color:"grey-5"}),l[5]||(l[5]=q("p",{class:"text-grey-7 q-mt-md"},"Select a section to view lessons",-1)),l[6]||(l[6]=j("33333 "))]))])]),_:1})]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-76441b9e"]]);export{W as default};
