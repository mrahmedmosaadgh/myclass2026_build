import{o as e,d as a,Q as l,c as s,m as t,f as o,a as r}from"./app-Cs5CKgHw.js";import{Q as n}from"./QSelect-D-pA-eh-.js";import{Q as d}from"./QTab-BrYgSklz.js";import{Q as u}from"./QTabs-BWwunJzN.js";import{Q as c}from"./QTabPanel-BXfuden_.js";import{Q as i}from"./QTabPanels-DzMXaeN6.js";import{f as m,a as v,N as p,J as h,O as b,b as g,W as f,K as _,V as y,I as x,Q as U,$ as j}from"./vendor-nQjeLEvd.js";import q from"./UsersList-BxIGx8vq.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";import"./rtl-Cr6c3OOr.js";import"./use-panel-FmIc7Z0R.js";import"./use-render-cache-CmTcazfP.js";import"./QSpinnerDots-CmOu2EXd.js";import"./QSpace-Xg69Ss6f.js";import"./UserDetailsDialog-CplmdSYn.js";const D={class:"users-roles-management"},V={class:"header-section q-mb-lg"},Q={class:"row items-center justify-between q-mb-md"},w={class:"col"},S={class:"text-h5 text-weight-bold q-ma-none"},T={class:"col-auto"},R={class:"row q-gutter-md q-mb-lg"},M={class:"col-12 col-sm-6 col-md-3"},C={class:"text-h5 text-weight-bold q-mt-sm"},P={class:"col-12 col-sm-6 col-md-3"},k={class:"text-h5 text-weight-bold q-mt-sm"},z={class:"col-12 col-sm-6 col-md-3"},L={class:"text-h5 text-weight-bold q-mt-sm"},O={class:"col-12 col-sm-6 col-md-3"},A={class:"text-h5 text-weight-bold q-mt-sm"},E={class:"row q-gutter-md items-end"},F={class:"col-12 col-md-4"},I={class:"col-12 col-md-3"},J={class:"col-12 col-md-3"},K={class:"col-12 col-md-2"},B=e({__name:"UsersRoles",props:{users:{type:Array,required:!0},enhancedUserData:{type:Object,default:()=>({})}},emits:["manage-user-roles"],setup(e,{emit:B}){const G=e,N=B,W=m("teachers"),$=m(""),H=m(null),X=m(null),Y=m(!1),Z=v(()=>{var e;return(null==(e=G.enhancedUserData)?void 0:e.schools)?G.enhancedUserData.schools.map(e=>({label:e.name,value:e.id})):[]}),ee=v(()=>{const e=new Set;return["teachers","students","parents","others"].forEach(a=>{var l;null==(l=G.enhancedUserData[a])||l.forEach(a=>{var l;null==(l=a.roles)||l.forEach(a=>{e.add(a.name)})})}),Array.from(e).map(e=>({label:e,value:e}))}),ae=e=>e?e.filter(e=>{var a;if($.value){const a=$.value.toLowerCase();if(![e.name,e.email,e.school_name,e.classroom_name,e.grade_name,e.stage_name,...e.subjects||[],...e.classrooms||[],...e.children_classrooms||[]].filter(Boolean).some(e=>e.toString().toLowerCase().includes(a)))return!1}if(H.value&&e.school_id!==H.value)return!1;if(X.value){if(!(null==(a=e.roles)?void 0:a.some(e=>e.name===X.value)))return!1}return!0}):[],le=v(()=>{var e;return ae(null==(e=G.enhancedUserData)?void 0:e.teachers)}),se=v(()=>{var e;return ae(null==(e=G.enhancedUserData)?void 0:e.students)}),te=v(()=>{var e;return ae(null==(e=G.enhancedUserData)?void 0:e.parents)}),oe=v(()=>{var e;return ae(null==(e=G.enhancedUserData)?void 0:e.others)}),re=e=>{var a,l,s,t;return{teachers:(null==(a=le.value)?void 0:a.length)||0,students:(null==(l=se.value)?void 0:l.length)||0,parents:(null==(s=te.value)?void 0:s.length)||0,others:(null==(t=oe.value)?void 0:t.length)||0}[e]||0},ne=()=>{$.value=""},de=()=>{$.value="",H.value=null,X.value=null},ue=()=>{Y.value=!0,j.reload({only:["enhancedUserData"]}),setTimeout(()=>{Y.value=!1},1e3)},ce=e=>{N("manage-user-roles",e)};return(m,v)=>(h(),p("div",D,[b("div",V,[b("div",Q,[b("div",w,[b("h3",S,[g(a,{name:"people",class:"q-mr-sm",color:"primary"}),v[5]||(v[5]=f(" Users & Roles Management "))]),v[6]||(v[6]=b("p",{class:"text-subtitle2 text-grey-7 q-mt-xs"}," Manage user roles across different user types ",-1))]),b("div",T,[g(l,{color:"primary",icon:"refresh",label:"Refresh",onClick:ue,outline:""})])]),b("div",R,[b("div",M,[g(t,{class:"stat-card"},{default:_(()=>[g(s,{class:"text-center"},{default:_(()=>{var l,s;return[g(a,{name:"people",size:"2rem",color:"primary"}),b("div",C,y((null==(s=null==(l=e.enhancedUserData)?void 0:l.stats)?void 0:s.total)||0),1),v[7]||(v[7]=b("div",{class:"text-caption text-grey-7"},"Total Users",-1))]}),_:1})]),_:1})]),b("div",P,[g(t,{class:"stat-card"},{default:_(()=>[g(s,{class:"text-center"},{default:_(()=>{var l,s;return[g(a,{name:"school",size:"2rem",color:"green"}),b("div",k,y((null==(s=null==(l=e.enhancedUserData)?void 0:l.stats)?void 0:s.teachers)||0),1),v[8]||(v[8]=b("div",{class:"text-caption text-grey-7"},"Teachers",-1))]}),_:1})]),_:1})]),b("div",z,[g(t,{class:"stat-card"},{default:_(()=>[g(s,{class:"text-center"},{default:_(()=>{var l,s;return[g(a,{name:"person",size:"2rem",color:"blue"}),b("div",L,y((null==(s=null==(l=e.enhancedUserData)?void 0:l.stats)?void 0:s.students)||0),1),v[9]||(v[9]=b("div",{class:"text-caption text-grey-7"},"Students",-1))]}),_:1})]),_:1})]),b("div",O,[g(t,{class:"stat-card"},{default:_(()=>[g(s,{class:"text-center"},{default:_(()=>{var l,s;return[g(a,{name:"family_restroom",size:"2rem",color:"orange"}),b("div",A,y((null==(s=null==(l=e.enhancedUserData)?void 0:l.stats)?void 0:s.parents)||0),1),v[10]||(v[10]=b("div",{class:"text-caption text-grey-7"},"Parents",-1))]}),_:1})]),_:1})])])]),g(t,{class:"search-card q-mb-lg"},{default:_(()=>[g(s,null,{default:_(()=>[b("div",E,[b("div",F,[g(o,{modelValue:$.value,"onUpdate:modelValue":v[0]||(v[0]=e=>$.value=e),placeholder:"Search by name, email, subject, classroom...",outlined:"",dense:"",debounce:"300"},{prepend:_(()=>[g(a,{name:"search"})]),append:_(()=>[$.value?(h(),x(l,{key:0,icon:"clear",flat:"",round:"",dense:"",onClick:ne})):U("",!0)]),_:1},8,["modelValue"])]),b("div",I,[g(n,{modelValue:H.value,"onUpdate:modelValue":v[1]||(v[1]=e=>H.value=e),options:Z.value,label:"Filter by School",outlined:"",dense:"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),b("div",J,[g(n,{modelValue:X.value,"onUpdate:modelValue":v[2]||(v[2]=e=>X.value=e),options:ee.value,label:"Filter by Role",outlined:"",dense:"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),b("div",K,[g(l,{color:"secondary",icon:"clear_all",label:"Clear All",onClick:de,outline:"",dense:""})])])]),_:1})]),_:1}),g(t,{class:"main-card"},{default:_(()=>[g(u,{modelValue:W.value,"onUpdate:modelValue":v[3]||(v[3]=e=>W.value=e),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:_(()=>[g(d,{name:"teachers",icon:"school",label:"Teachers",badge:re("teachers")},null,8,["badge"]),g(d,{name:"students",icon:"person",label:"Students",badge:re("students")},null,8,["badge"]),g(d,{name:"parents",icon:"family_restroom",label:"Parents",badge:re("parents")},null,8,["badge"]),g(d,{name:"others",icon:"people_outline",label:"Others",badge:re("others")},null,8,["badge"])]),_:1},8,["modelValue"]),g(r),g(i,{modelValue:W.value,"onUpdate:modelValue":v[4]||(v[4]=e=>W.value=e),animated:""},{default:_(()=>[g(c,{name:"teachers",class:"q-pa-none"},{default:_(()=>[g(q,{users:le.value,type:"teacher",loading:Y.value,onManageRoles:ce},null,8,["users","loading"])]),_:1}),g(c,{name:"students",class:"q-pa-none"},{default:_(()=>[g(q,{users:se.value,type:"student",loading:Y.value,onManageRoles:ce},null,8,["users","loading"])]),_:1}),g(c,{name:"parents",class:"q-pa-none"},{default:_(()=>[g(q,{users:te.value,type:"parent",loading:Y.value,onManageRoles:ce},null,8,["users","loading"])]),_:1}),g(c,{name:"others",class:"q-pa-none"},{default:_(()=>[g(q,{users:oe.value,type:"other",loading:Y.value,onManageRoles:ce},null,8,["users","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]))}},[["__scopeId","data-v-28710779"]]);export{B as default};
