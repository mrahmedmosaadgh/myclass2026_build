import{Q as e}from"./QTab-DhKL91H_.js";import{Q as a}from"./QTabs-CDJ215OP.js";import{p as l,u as t,e as o,d as s,Q as n,q as r,D as i,l as c,m as d,n as u,a as p,aD as m,b as v,g as f,f as y}from"./app-BXm70mdJ.js";import{Q as _}from"./QTabPanel-sB32VrK8.js";import{Q as g}from"./QSpace-Bu8V-QDa.js";import{Q as b}from"./QTabPanels-LFwTBPSC.js";import{Q as h}from"./QFile-BmfyT66f.js";import{a as x,Q as w}from"./QTable-rnEofRem.js";import{Q as j}from"./QTr-CHmCMIZo.js";import{r as S,u as k,w as O}from"./xlsx-cMC2LkxH.js";import{f as N,a as E,k as I,H as V,I as T,J as A,b as C,O as D,M as J,V as P,L as Q,Q as q,F as U,U as F,x as L,a1 as R}from"./vendor-DNM7Y6Xn.js";const z={class:"q-mb-md row items-center justify-between"},$={class:"q-gutter-sm"},G={class:"q-ma-none text-caption"},H=l({__name:"ExcelImporter",props:{title:{type:String,default:"Import Excel Data"}},emits:["imported-json"],setup(e,{emit:a}){const l=t(),f=a,y=N(null),_=N([]),g=N([]),b=N({}),O=N(!1),R=N(""),H=N(!1),M=E(()=>_.value.length?Object.keys(_.value[0]).filter(e=>"__id"!==e).map(e=>({name:e,label:e.charAt(0).toUpperCase()+e.slice(1).replace(/_/g," "),field:e,align:"left",sortable:!0})):[]);I(O,e=>{g.value=e?[..._.value]:[]});const Y=()=>{g.value=[..._.value]},B=()=>{g.value=[]},K=()=>{const e=new Set(g.value.map(e=>e.__id));g.value=_.value.filter(a=>!e.has(a.__id))},W=()=>{if(!y.value)return;const e=new FileReader;e.onload=e=>{try{const a=new Uint8Array(e.target.result),t=S(a,{type:"array"}),o=t.SheetNames[0],s=t.Sheets[o],n=k.sheet_to_json(s);_.value=n.map((e,a)=>({...e,__id:a})),M.value.forEach(e=>{b.value[e.name]=!0}),l.notify({message:`Loaded ${_.value.length} rows from Excel`,color:"positive",position:"top"})}catch(a){l.notify({message:"Error reading Excel file: "+a.message,color:"negative",position:"top"}),ae()}},e.readAsArrayBuffer(y.value)},X=()=>{const e=g.value.map(e=>{const a={};return Object.keys(b.value).forEach(l=>{b.value[l]&&"__id"!==l&&(a[l]=e[l])}),a});R.value=JSON.stringify(e,null,2),H.value=!0},Z=async()=>{try{await navigator.clipboard.writeText(R.value),l.notify({message:"JSON copied to clipboard!",color:"positive",position:"top"})}catch(e){l.notify({message:"Failed to copy JSON",color:"negative",position:"top"})}},ee=()=>{const e=g.value.map(e=>{const a={};return Object.keys(b.value).forEach(l=>{b.value[l]&&"__id"!==l&&(a[l]=e[l])}),a});f("imported-json",e),H.value=!1,l.notify({message:`Successfully imported ${e.length} records`,color:"positive",position:"top"}),ae()},ae=()=>{y.value=null,_.value=[],g.value=[],b.value={},O.value=!1,R.value=""};return(e,a)=>(T(),V(u,{class:"bg-white shadow-md rounded-lg"},{default:A(()=>[C(s,null,{default:A(()=>[C(h,{modelValue:y.value,"onUpdate:modelValue":[a[0]||(a[0]=e=>y.value=e),W],label:"Upload Excel File",accept:".xlsx, .xls",outlined:"",dense:""},{prepend:A(()=>[C(o,{name:"attach_file"})]),_:1},8,["modelValue"])]),_:1}),_.value.length?(T(),V(s,{key:0},{default:A(()=>[J("div",z,[a[7]||(a[7]=J("div",null,[J("h6",{class:"q-my-none"},"Preview Data"),J("p",{class:"text-caption text-grey-6"},"Select rows and columns to import")],-1)),J("div",$,[C(i,{outline:""},{default:A(()=>[C(n,{outline:"",color:"primary",label:"Select All",icon:"check_box",onClick:Y,size:"sm"},{default:A(()=>[C(r,null,{default:A(()=>a[4]||(a[4]=[P("Select all rows")])),_:1})]),_:1}),C(n,{outline:"",color:"primary",label:"Deselect All",icon:"check_box_outline_blank",onClick:B,size:"sm"},{default:A(()=>[C(r,null,{default:A(()=>a[5]||(a[5]=[P("Deselect all rows")])),_:1})]),_:1}),C(n,{outline:"",color:"primary",label:"Inverse",icon:"swap_vert",onClick:K,size:"sm"},{default:A(()=>[C(r,null,{default:A(()=>a[6]||(a[6]=[P("Invert current selection")])),_:1})]),_:1})]),_:1})])]),C(w,{rows:_.value,columns:M.value,"row-key":"__id",selection:"multiple",selected:g.value,"onUpdate:selected":a[2]||(a[2]=e=>g.value=e),pagination:{rowsPerPage:10},dense:"",class:"text-sm"},{"header-selection":A(()=>[C(c,{modelValue:O.value,"onUpdate:modelValue":a[1]||(a[1]=e=>O.value=e),color:"primary"},null,8,["modelValue"])]),header:A(e=>[C(j,{props:e},{default:A(()=>[C(x,{"auto-width":""}),(T(!0),Q(U,null,q(e.cols,a=>(T(),V(x,{key:a.name,props:e},{default:A(()=>[C(c,{modelValue:b.value[a.name],"onUpdate:modelValue":e=>b.value[a.name]=e,color:"primary",dense:"",label:a.label},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),_:1},8,["rows","columns","selected"])]),_:1})):D("",!0),_.value.length?(T(),V(d,{key:1,align:"right"},{default:A(()=>[C(n,{label:"Cancel",flat:"",onClick:ae}),C(n,{label:"Import Selected as JSON",color:"primary",unelevated:"",disable:0===g.value.length,onClick:X},null,8,["disable"])]),_:1})):D("",!0),C(v,{modelValue:H.value,"onUpdate:modelValue":a[3]||(a[3]=e=>H.value=e)},{default:A(()=>[C(u,{style:{"min-width":"600px"}},{default:A(()=>[C(s,null,{default:A(()=>a[8]||(a[8]=[J("div",{class:"text-h6"},"Imported JSON Preview",-1)])),_:1}),C(p),C(s,{class:"bg-grey-1",style:{"max-height":"400px","overflow-y":"auto"}},{default:A(()=>[J("pre",G,F(R.value),1)]),_:1}),C(p),C(d,{align:"right"},{default:A(()=>[L(C(n,{label:"Close",flat:""},null,512),[[m]]),C(n,{label:"Copy JSON",color:"primary",onClick:Z,unelevated:""}),C(n,{label:"Confirm Import",color:"positive",onClick:ee,unelevated:""})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},[["__scopeId","data-v-51432a8a"]]),M={class:"row items-center q-gutter-md"},Y={class:"col"},B={class:"col-auto"},K={class:"q-mb-md"},W={class:"text-caption text-grey-6"},X=l({__name:"ExcelExporter",props:{jsonData:{type:Array,default:()=>[]},defaultFileName:{type:String,default:"template.xlsx"}},emits:["exported"],setup(e,{emit:a}){const l=t(),r=e,i=a,c=N(r.defaultFileName),d=E(()=>{if(!r.jsonData.length)return[];const e=r.jsonData.map((e,a)=>({...e,__id:a}));return Object.keys(e[0]).filter(e=>"__id"!==e).map(e=>({name:e,label:e.charAt(0).toUpperCase()+e.slice(1).replace(/_/g," "),field:e,align:"left"}))});I(()=>r.defaultFileName,e=>{c.value=e});const p=()=>{if(r.jsonData.length)try{const e=k.json_to_sheet(r.jsonData),a=Object.keys(r.jsonData[0]).map(()=>20);e["!cols"]=a.map(e=>({wch:e}));const t=k.book_new();k.book_append_sheet(t,e,"Template"),O(t,c.value),l.notify({message:"Template downloaded successfully!",color:"positive",position:"top"}),i("exported",{fileName:c.value,recordCount:r.jsonData.length})}catch(e){l.notify({message:"Error exporting to Excel: "+e.message,color:"negative",position:"top"})}else l.notify({message:"No data to export",color:"warning",position:"top"})};return(a,l)=>(T(),V(u,{class:"bg-white shadow-md rounded-lg"},{default:A(()=>[C(s,null,{default:A(()=>[J("div",M,[J("div",Y,[C(f,{modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=e=>c.value=e),label:"Template File Name",outlined:"",dense:"",placeholder:"e.g., curriculum_template.xlsx",onKeyup:R(p,["enter"])},null,8,["modelValue"])]),J("div",B,[C(n,{label:"Download Excel Template",color:"primary",icon:"download",unelevated:"",disable:!e.jsonData.length,onClick:p},null,8,["disable"])])])]),_:1}),e.jsonData.length?(T(),V(s,{key:0},{default:A(()=>[J("div",K,[l[1]||(l[1]=J("h6",{class:"q-my-none"},"Template Preview",-1)),J("p",W,F(e.jsonData.length)+" sample records",1)]),C(w,{rows:e.jsonData,columns:d.value,"row-key":"__id",pagination:{rowsPerPage:5},dense:"",class:"text-sm"},null,8,["rows","columns"])]),_:1})):(T(),V(s,{key:1,class:"text-center text-grey-6 q-py-lg"},{default:A(()=>[C(o,{name:"info",size:"lg",class:"q-mb-md"}),l[2]||(l[2]=J("p",null,"No data provided. Pass JSON data as a prop to generate a template.",-1))]),_:1}))]),_:1}))}},[["__scopeId","data-v-3de8a46d"]]),Z={class:"q-pa-md"},ee={class:"row items-center q-mb-md"},ae={class:"row justify-end q-mt-md"},le=l({__name:"ExcelManager",props:{exportData:{type:Array,default:()=>[]},exportFileName:{type:String,default:"export.xlsx"},initialTab:{type:String,default:"import"}},emits:["imported-json","exported"],setup(l,{emit:s}){const r=t(),i=s,c=N(l.initialTab),d=N(""),m=e=>{i("imported-json",e)},v=e=>{i("exported",e)},h=async()=>{try{await navigator.clipboard.writeText('Please generate a JSON array of curriculum topics and lessons based on the following list.\nOutput ONLY the raw JSON array. Do not include any markdown formatting like ```json or any other text.\n\nRequired Fields for each object:\n- topic_number: Topic number (e.g. "1")\n- topic_title: Title of the topic\n- topic_description: Optional description\n- lesson_number: Lesson number (e.g. "1.1")\n- lesson_title: Title of the lesson\n- lesson_description: Optional description\n- lesson_content: Optional content/details\n- lesson_type: One of [main, revision, quiz, project, extra]\n- page_number: Numeric page number\n- standard, strand, skill, activities, assignment, assessment, objective: Optional fields\n\nLIST TO CONVERT:\n[PASTE YOUR LIST HERE]'),r.notify({color:"positive",message:"AI Prompt copied to clipboard!",icon:"content_copy"})}catch(e){r.notify({color:"negative",message:"Failed to copy prompt",icon:"error"})}},x=()=>{try{let e=d.value.trim();e.startsWith("```")&&(e=e.replace(/^```(json)?\n?/,"").replace(/\n?```$/,""));const a=JSON.parse(e);if(!Array.isArray(a))throw new Error("Data must be a JSON array");if(0===a.length)throw new Error("Empty JSON array");i("imported-json",a),d.value="",r.notify({color:"positive",message:`Successfully processed ${a.length} records from AI JSON`,icon:"check"})}catch(e){r.notify({color:"negative",message:"Invalid JSON format: "+e.message,icon:"error"})}};return(t,s)=>(T(),V(u,{class:"bg-white shadow-md rounded-lg"},{default:A(()=>[C(a,{modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=e=>c.value=e),dense:"",class:"text-primary","active-color":"primary","indicator-color":"primary",align:"left"},{default:A(()=>[C(e,{name:"import",label:"Import from Excel",icon:"upload"}),C(e,{name:"ai",label:"AI Assistant",icon:"psychology"}),C(e,{name:"export",label:"Export to Excel",icon:"download"})]),_:1},8,["modelValue"]),C(p),C(b,{modelValue:c.value,"onUpdate:modelValue":s[2]||(s[2]=e=>c.value=e),animated:""},{default:A(()=>[C(_,{name:"import"},{default:A(()=>[C(H,{onImportedJson:m})]),_:1}),C(_,{name:"ai"},{default:A(()=>[J("div",Z,[J("div",ee,[s[3]||(s[3]=J("div",null,[J("div",{class:"text-h6"},"AI JSON Helper"),J("div",{class:"text-caption text-grey-7"},"Generate JSON using AI and paste it here")],-1)),C(g),C(n,{color:"primary",icon:"content_copy",label:"Copy AI Prompt",onClick:h,unelevated:""})]),C(y,{class:"bg-blue-1 text-blue-9 q-mb-lg rounded-borders"},{avatar:A(()=>[C(o,{name:"info",color:"blue-9"})]),default:A(()=>[s[4]||(s[4]=P(' 1. Click "Copy AI Prompt" and paste it into an AI (ChatGPT/Claude).')),s[5]||(s[5]=J("br",null,null,-1)),s[6]||(s[6]=P(" 2. Provide your lessons list to the AI.")),s[7]||(s[7]=J("br",null,null,-1)),s[8]||(s[8]=P(' 3. Paste the generated JSON below and click "Process". '))]),_:1}),C(f,{modelValue:d.value,"onUpdate:modelValue":s[1]||(s[1]=e=>d.value=e),type:"textarea",label:"Paste AI Generated JSON",outlined:"",rows:"12",placeholder:'[\n  {\n    "topic_number": "1",\n    "topic_title": "Example Topic",\n    "lesson_number": "1.1",\n    "lesson_title": "Example Lesson",\n    "lesson_type": "main"\n  }\n]',class:"bg-grey-1"},null,8,["modelValue"]),J("div",ae,[C(n,{color:"positive",icon:"check_circle",label:"Process & Import JSON",onClick:x,disable:!d.value.trim(),unelevated:""},null,8,["disable"])])])]),_:1}),C(_,{name:"export"},{default:A(()=>[C(X,{"json-data":l.exportData,"default-file-name":l.exportFileName,onExported:v},null,8,["json-data","default-file-name"])]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},[["__scopeId","data-v-0a4e4a8d"]]);export{le as E};
