import{r as e,Q as a,b as l,f as s,d as t,h as o,c as r}from"./app-CCwy2VVq.js";import{Q as n}from"./QSelect-DZElG_R-.js";import{Q as d}from"./QTab-Bsf5uinQ.js";import{Q as u}from"./QTabs-Ddh79dFw.js";import{Q as c}from"./QTabPanel-D3EMF9t6.js";import{Q as i}from"./QTabPanels-C7WMGDee.js";import{f as m,a as v,N as p,J as h,R as g,b as f,W as b,K as _,V as y,I as x,O as U,$ as j}from"./vendor-BWKGNkNB.js";import q from"./UsersList-BL_mdQPh.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";import"./use-panel-Bv0wrwFr.js";import"./use-render-cache-CmTcazfP.js";import"./QSpinnerDots-BItRr4QS.js";import"./QSpace-B14M_epf.js";import"./UserDetailsDialog-EORoWmJ1.js";const D={class:"users-roles-management"},V={class:"header-section q-mb-lg"},w={class:"row items-center justify-between q-mb-md"},Q={class:"col"},R={class:"text-h5 text-weight-bold q-ma-none"},S={class:"col-auto"},T={class:"row q-gutter-md q-mb-lg"},C={class:"col-12 col-sm-6 col-md-3"},M={class:"text-h5 text-weight-bold q-mt-sm"},z={class:"col-12 col-sm-6 col-md-3"},k={class:"text-h5 text-weight-bold q-mt-sm"},A={class:"col-12 col-sm-6 col-md-3"},P={class:"text-h5 text-weight-bold q-mt-sm"},E={class:"col-12 col-sm-6 col-md-3"},L={class:"text-h5 text-weight-bold q-mt-sm"},O={class:"row q-gutter-md items-end"},F={class:"col-12 col-md-4"},I={class:"col-12 col-md-3"},B={class:"col-12 col-md-3"},J={class:"col-12 col-md-2"},K=e({__name:"UsersRoles",props:{users:{type:Array,required:!0},enhancedUserData:{type:Object,default:()=>({})}},emits:["manage-user-roles"],setup(e,{emit:K}){const N=e,W=K,$=m("teachers"),G=m(""),H=m(null),X=m(null),Y=m(!1),Z=v(()=>{var e;return(null==(e=N.enhancedUserData)?void 0:e.schools)?N.enhancedUserData.schools.map(e=>({label:e.name,value:e.id})):[]}),ee=v(()=>{const e=new Set;return["teachers","students","parents","others"].forEach(a=>{var l;null==(l=N.enhancedUserData[a])||l.forEach(a=>{var l;null==(l=a.roles)||l.forEach(a=>{e.add(a.name)})})}),Array.from(e).map(e=>({label:e,value:e}))}),ae=e=>e?e.filter(e=>{var a;if(G.value){const a=G.value.toLowerCase();if(![e.name,e.email,e.school_name,e.classroom_name,e.grade_name,e.stage_name,...e.subjects||[],...e.classrooms||[],...e.children_classrooms||[]].filter(Boolean).some(e=>e.toString().toLowerCase().includes(a)))return!1}if(H.value&&e.school_id!==H.value)return!1;if(X.value){if(!(null==(a=e.roles)?void 0:a.some(e=>e.name===X.value)))return!1}return!0}):[],le=v(()=>{var e;return ae(null==(e=N.enhancedUserData)?void 0:e.teachers)}),se=v(()=>{var e;return ae(null==(e=N.enhancedUserData)?void 0:e.students)}),te=v(()=>{var e;return ae(null==(e=N.enhancedUserData)?void 0:e.parents)}),oe=v(()=>{var e;return ae(null==(e=N.enhancedUserData)?void 0:e.others)}),re=e=>{var a,l,s,t;return{teachers:(null==(a=le.value)?void 0:a.length)||0,students:(null==(l=se.value)?void 0:l.length)||0,parents:(null==(s=te.value)?void 0:s.length)||0,others:(null==(t=oe.value)?void 0:t.length)||0}[e]||0},ne=()=>{G.value=""},de=()=>{G.value="",H.value=null,X.value=null},ue=()=>{Y.value=!0,j.reload({only:["enhancedUserData"]}),setTimeout(()=>{Y.value=!1},1e3)},ce=e=>{W("manage-user-roles",e)};return(m,v)=>(h(),p("div",D,[g("div",V,[g("div",w,[g("div",Q,[g("h3",R,[f(a,{name:"people",class:"q-mr-sm",color:"primary"}),v[5]||(v[5]=b(" Users & Roles Management "))]),v[6]||(v[6]=g("p",{class:"text-subtitle2 text-grey-7 q-mt-xs"}," Manage user roles across different user types ",-1))]),g("div",S,[f(l,{color:"primary",icon:"refresh",label:"Refresh",onClick:ue,outline:""})])]),g("div",T,[g("div",C,[f(t,{class:"stat-card"},{default:_(()=>[f(s,{class:"text-center"},{default:_(()=>{var l,s;return[f(a,{name:"people",size:"2rem",color:"primary"}),g("div",M,y((null==(s=null==(l=e.enhancedUserData)?void 0:l.stats)?void 0:s.total)||0),1),v[7]||(v[7]=g("div",{class:"text-caption text-grey-7"},"Total Users",-1))]}),_:1})]),_:1})]),g("div",z,[f(t,{class:"stat-card"},{default:_(()=>[f(s,{class:"text-center"},{default:_(()=>{var l,s;return[f(a,{name:"school",size:"2rem",color:"green"}),g("div",k,y((null==(s=null==(l=e.enhancedUserData)?void 0:l.stats)?void 0:s.teachers)||0),1),v[8]||(v[8]=g("div",{class:"text-caption text-grey-7"},"Teachers",-1))]}),_:1})]),_:1})]),g("div",A,[f(t,{class:"stat-card"},{default:_(()=>[f(s,{class:"text-center"},{default:_(()=>{var l,s;return[f(a,{name:"person",size:"2rem",color:"blue"}),g("div",P,y((null==(s=null==(l=e.enhancedUserData)?void 0:l.stats)?void 0:s.students)||0),1),v[9]||(v[9]=g("div",{class:"text-caption text-grey-7"},"Students",-1))]}),_:1})]),_:1})]),g("div",E,[f(t,{class:"stat-card"},{default:_(()=>[f(s,{class:"text-center"},{default:_(()=>{var l,s;return[f(a,{name:"family_restroom",size:"2rem",color:"orange"}),g("div",L,y((null==(s=null==(l=e.enhancedUserData)?void 0:l.stats)?void 0:s.parents)||0),1),v[10]||(v[10]=g("div",{class:"text-caption text-grey-7"},"Parents",-1))]}),_:1})]),_:1})])])]),f(t,{class:"search-card q-mb-lg"},{default:_(()=>[f(s,null,{default:_(()=>[g("div",O,[g("div",F,[f(o,{modelValue:G.value,"onUpdate:modelValue":v[0]||(v[0]=e=>G.value=e),placeholder:"Search by name, email, subject, classroom...",outlined:"",dense:"",debounce:"300"},{prepend:_(()=>[f(a,{name:"search"})]),append:_(()=>[G.value?(h(),x(l,{key:0,icon:"clear",flat:"",round:"",dense:"",onClick:ne})):U("",!0)]),_:1},8,["modelValue"])]),g("div",I,[f(n,{modelValue:H.value,"onUpdate:modelValue":v[1]||(v[1]=e=>H.value=e),options:Z.value,label:"Filter by School",outlined:"",dense:"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),g("div",B,[f(n,{modelValue:X.value,"onUpdate:modelValue":v[2]||(v[2]=e=>X.value=e),options:ee.value,label:"Filter by Role",outlined:"",dense:"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),g("div",J,[f(l,{color:"secondary",icon:"clear_all",label:"Clear All",onClick:de,outline:"",dense:""})])])]),_:1})]),_:1}),f(t,{class:"main-card"},{default:_(()=>[f(u,{modelValue:$.value,"onUpdate:modelValue":v[3]||(v[3]=e=>$.value=e),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:_(()=>[f(d,{name:"teachers",icon:"school",label:"Teachers",badge:re("teachers")},null,8,["badge"]),f(d,{name:"students",icon:"person",label:"Students",badge:re("students")},null,8,["badge"]),f(d,{name:"parents",icon:"family_restroom",label:"Parents",badge:re("parents")},null,8,["badge"]),f(d,{name:"others",icon:"people_outline",label:"Others",badge:re("others")},null,8,["badge"])]),_:1},8,["modelValue"]),f(r),f(i,{modelValue:$.value,"onUpdate:modelValue":v[4]||(v[4]=e=>$.value=e),animated:""},{default:_(()=>[f(c,{name:"teachers",class:"q-pa-none"},{default:_(()=>[f(q,{users:le.value,type:"teacher",loading:Y.value,onManageRoles:ce},null,8,["users","loading"])]),_:1}),f(c,{name:"students",class:"q-pa-none"},{default:_(()=>[f(q,{users:se.value,type:"student",loading:Y.value,onManageRoles:ce},null,8,["users","loading"])]),_:1}),f(c,{name:"parents",class:"q-pa-none"},{default:_(()=>[f(q,{users:te.value,type:"parent",loading:Y.value,onManageRoles:ce},null,8,["users","loading"])]),_:1}),f(c,{name:"others",class:"q-pa-none"},{default:_(()=>[f(q,{users:oe.value,type:"other",loading:Y.value,onManageRoles:ce},null,8,["users","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]))}},[["__scopeId","data-v-28710779"]]);export{K as default};
