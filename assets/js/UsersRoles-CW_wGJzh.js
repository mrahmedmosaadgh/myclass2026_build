import{o as e,d as a,Q as l,c as s,m as t,f as o,a as r}from"./app-C-NJhdpe.js";import{Q as n}from"./QSelect-B3f0Rrq3.js";import{Q as d}from"./QTab-C_vkYR0k.js";import{Q as u}from"./QTabs-C8Sz98qV.js";import{Q as c}from"./QTabPanel-zhJc0Joi.js";import{Q as i}from"./QTabPanels-bY91sdlT.js";import{f as m,a as v,L as p,I as h,M as b,b as g,V as f,J as _,U as y,H as x,O as U,_ as j}from"./vendor-CUZ9QTQV.js";import q from"./UsersList-Bc6JdkMJ.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";import"./rtl-Cr6c3OOr.js";import"./use-panel-CGzbevm7.js";import"./use-render-cache-CmTcazfP.js";import"./QSpinnerDots-BFT-tKRa.js";import"./QSpace-Bn7M2Abx.js";import"./UserDetailsDialog-BKLJ6_Ff.js";const D={class:"users-roles-management"},V={class:"header-section q-mb-lg"},Q={class:"row items-center justify-between q-mb-md"},w={class:"col"},S={class:"text-h5 text-weight-bold q-ma-none"},T={class:"col-auto"},M={class:"row q-gutter-md q-mb-lg"},R={class:"col-12 col-sm-6 col-md-3"},C={class:"text-h5 text-weight-bold q-mt-sm"},L={class:"col-12 col-sm-6 col-md-3"},P={class:"text-h5 text-weight-bold q-mt-sm"},k={class:"col-12 col-sm-6 col-md-3"},z={class:"text-h5 text-weight-bold q-mt-sm"},O={class:"col-12 col-sm-6 col-md-3"},A={class:"text-h5 text-weight-bold q-mt-sm"},E={class:"row q-gutter-md items-end"},F={class:"col-12 col-md-4"},I={class:"col-12 col-md-3"},J={class:"col-12 col-md-3"},B={class:"col-12 col-md-2"},G=e({__name:"UsersRoles",props:{users:{type:Array,required:!0},enhancedUserData:{type:Object,default:()=>({})}},emits:["manage-user-roles"],setup(e,{emit:G}){const H=e,K=G,N=m("teachers"),W=m(""),X=m(null),Y=m(null),Z=m(!1),$=v(()=>{var e;return(null==(e=H.enhancedUserData)?void 0:e.schools)?H.enhancedUserData.schools.map(e=>({label:e.name,value:e.id})):[]}),ee=v(()=>{const e=new Set;return["teachers","students","parents","others"].forEach(a=>{var l;null==(l=H.enhancedUserData[a])||l.forEach(a=>{var l;null==(l=a.roles)||l.forEach(a=>{e.add(a.name)})})}),Array.from(e).map(e=>({label:e,value:e}))}),ae=e=>e?e.filter(e=>{var a;if(W.value){const a=W.value.toLowerCase();if(![e.name,e.email,e.school_name,e.classroom_name,e.grade_name,e.stage_name,...e.subjects||[],...e.classrooms||[],...e.children_classrooms||[]].filter(Boolean).some(e=>e.toString().toLowerCase().includes(a)))return!1}if(X.value&&e.school_id!==X.value)return!1;if(Y.value){if(!(null==(a=e.roles)?void 0:a.some(e=>e.name===Y.value)))return!1}return!0}):[],le=v(()=>{var e;return ae(null==(e=H.enhancedUserData)?void 0:e.teachers)}),se=v(()=>{var e;return ae(null==(e=H.enhancedUserData)?void 0:e.students)}),te=v(()=>{var e;return ae(null==(e=H.enhancedUserData)?void 0:e.parents)}),oe=v(()=>{var e;return ae(null==(e=H.enhancedUserData)?void 0:e.others)}),re=e=>{var a,l,s,t;return{teachers:(null==(a=le.value)?void 0:a.length)||0,students:(null==(l=se.value)?void 0:l.length)||0,parents:(null==(s=te.value)?void 0:s.length)||0,others:(null==(t=oe.value)?void 0:t.length)||0}[e]||0},ne=()=>{W.value=""},de=()=>{W.value="",X.value=null,Y.value=null},ue=()=>{Z.value=!0,j.reload({only:["enhancedUserData"]}),setTimeout(()=>{Z.value=!1},1e3)},ce=e=>{K("manage-user-roles",e)};return(m,v)=>(h(),p("div",D,[b("div",V,[b("div",Q,[b("div",w,[b("h3",S,[g(a,{name:"people",class:"q-mr-sm",color:"primary"}),v[5]||(v[5]=f(" Users & Roles Management "))]),v[6]||(v[6]=b("p",{class:"text-subtitle2 text-grey-7 q-mt-xs"}," Manage user roles across different user types ",-1))]),b("div",T,[g(l,{color:"primary",icon:"refresh",label:"Refresh",onClick:ue,outline:""})])]),b("div",M,[b("div",R,[g(t,{class:"stat-card"},{default:_(()=>[g(s,{class:"text-center"},{default:_(()=>{var l,s;return[g(a,{name:"people",size:"2rem",color:"primary"}),b("div",C,y((null==(s=null==(l=e.enhancedUserData)?void 0:l.stats)?void 0:s.total)||0),1),v[7]||(v[7]=b("div",{class:"text-caption text-grey-7"},"Total Users",-1))]}),_:1})]),_:1})]),b("div",L,[g(t,{class:"stat-card"},{default:_(()=>[g(s,{class:"text-center"},{default:_(()=>{var l,s;return[g(a,{name:"school",size:"2rem",color:"green"}),b("div",P,y((null==(s=null==(l=e.enhancedUserData)?void 0:l.stats)?void 0:s.teachers)||0),1),v[8]||(v[8]=b("div",{class:"text-caption text-grey-7"},"Teachers",-1))]}),_:1})]),_:1})]),b("div",k,[g(t,{class:"stat-card"},{default:_(()=>[g(s,{class:"text-center"},{default:_(()=>{var l,s;return[g(a,{name:"person",size:"2rem",color:"blue"}),b("div",z,y((null==(s=null==(l=e.enhancedUserData)?void 0:l.stats)?void 0:s.students)||0),1),v[9]||(v[9]=b("div",{class:"text-caption text-grey-7"},"Students",-1))]}),_:1})]),_:1})]),b("div",O,[g(t,{class:"stat-card"},{default:_(()=>[g(s,{class:"text-center"},{default:_(()=>{var l,s;return[g(a,{name:"family_restroom",size:"2rem",color:"orange"}),b("div",A,y((null==(s=null==(l=e.enhancedUserData)?void 0:l.stats)?void 0:s.parents)||0),1),v[10]||(v[10]=b("div",{class:"text-caption text-grey-7"},"Parents",-1))]}),_:1})]),_:1})])])]),g(t,{class:"search-card q-mb-lg"},{default:_(()=>[g(s,null,{default:_(()=>[b("div",E,[b("div",F,[g(o,{modelValue:W.value,"onUpdate:modelValue":v[0]||(v[0]=e=>W.value=e),placeholder:"Search by name, email, subject, classroom...",outlined:"",dense:"",debounce:"300"},{prepend:_(()=>[g(a,{name:"search"})]),append:_(()=>[W.value?(h(),x(l,{key:0,icon:"clear",flat:"",round:"",dense:"",onClick:ne})):U("",!0)]),_:1},8,["modelValue"])]),b("div",I,[g(n,{modelValue:X.value,"onUpdate:modelValue":v[1]||(v[1]=e=>X.value=e),options:$.value,label:"Filter by School",outlined:"",dense:"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),b("div",J,[g(n,{modelValue:Y.value,"onUpdate:modelValue":v[2]||(v[2]=e=>Y.value=e),options:ee.value,label:"Filter by Role",outlined:"",dense:"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),b("div",B,[g(l,{color:"secondary",icon:"clear_all",label:"Clear All",onClick:de,outline:"",dense:""})])])]),_:1})]),_:1}),g(t,{class:"main-card"},{default:_(()=>[g(u,{modelValue:N.value,"onUpdate:modelValue":v[3]||(v[3]=e=>N.value=e),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:_(()=>[g(d,{name:"teachers",icon:"school",label:"Teachers",badge:re("teachers")},null,8,["badge"]),g(d,{name:"students",icon:"person",label:"Students",badge:re("students")},null,8,["badge"]),g(d,{name:"parents",icon:"family_restroom",label:"Parents",badge:re("parents")},null,8,["badge"]),g(d,{name:"others",icon:"people_outline",label:"Others",badge:re("others")},null,8,["badge"])]),_:1},8,["modelValue"]),g(r),g(i,{modelValue:N.value,"onUpdate:modelValue":v[4]||(v[4]=e=>N.value=e),animated:""},{default:_(()=>[g(c,{name:"teachers",class:"q-pa-none"},{default:_(()=>[g(q,{users:le.value,type:"teacher",loading:Z.value,onManageRoles:ce},null,8,["users","loading"])]),_:1}),g(c,{name:"students",class:"q-pa-none"},{default:_(()=>[g(q,{users:se.value,type:"student",loading:Z.value,onManageRoles:ce},null,8,["users","loading"])]),_:1}),g(c,{name:"parents",class:"q-pa-none"},{default:_(()=>[g(q,{users:te.value,type:"parent",loading:Z.value,onManageRoles:ce},null,8,["users","loading"])]),_:1}),g(c,{name:"others",class:"q-pa-none"},{default:_(()=>[g(q,{users:oe.value,type:"other",loading:Z.value,onManageRoles:ce},null,8,["users","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]))}},[["__scopeId","data-v-28710779"]]);export{G as default};
