import{Q as e}from"./QBadge-qhepP9EB.js";import{o as l,u as o,g as a,h as s,i as t,aP as i,Q as r,a as d,d as n,aj as c,p as u,m,c as v,j as p,aO as f,l as g,b as _,aU as b}from"./app-tFXAu5dG.js";import{Q as h}from"./QTable-RwFHEvWA.js";import{q as y,f as x,a as k,N as w,J as j,b as C,O as P,K as q,y as I,W as S,V as T,I as $,Q,F as O,R as U,S as A,U as B,_ as L}from"./vendor-nQjeLEvd.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";import"./QMarkupTable-Cof6YCqy.js";import"./QSelect-CmlFFsWs.js";import"./rtl-Cr6c3OOr.js";import"./QLinearProgress-D4JaekYN.js";import"./use-fullscreen-COCl0uwf.js";const V={class:"text-sm text-gray-700"},D={class:"q-pa-sm"},E={class:"flex p-1 flex-row justify-center gap-2"},F={class:"row items-center no-wrap"},M={class:"text-center"},N={class:"flex flex-col justify-start gap-2"},z={class:"text-sm text-gray-700"},R={class:"q-pa-sm"},W={class:"row items-center no-wrap"},J={class:"text-center"},K={class:"flex flex-col justify-start gap-2"},G={class:"flex flex-row justify-center gap-2"},H={class:"row items-center no-wrap"},X={class:"text-center"},Y={class:"flex flex-col justify-start gap-2"},Z={class:"text-sm text-gray-700"},ee={class:"q-pa-sm"},le={class:"absolute inset-0 pointer-events-none cursor-pointer z-10 scale-150"},oe={class:"relative z-20 flex flex-row items-center w-full h-full text-xs text-center gap-1 px-2"},ae={class:"rounded bg-black text-yellow-100"},se={class:"p-0 flex flex-row items-center gap-1"},te={class:"text-xs scale-75 rounded bg-black text-yellow-100 px-1"},ie={key:1,class:"p-0"},re={class:"relative px-1"},de=l({__name:"ScheduleCell",props:{teacher_data:{type:Object,required:!0},dayIndex:{type:Number,required:!0},period_code:{type:String,required:!0},periodIndex:{type:Number,required:!0},selectedPeriod:{type:Object,required:!0},hoverPeriod:{type:Object,required:!0},isLocked:{type:Boolean,default:!1},isDisabled:{type:Boolean,default:!1},is_confirm:{type:Boolean,default:!1},conflicts:{type:Array,required:!1}},emits:["toggle-lock","toggle-disable","link-period","update_grid"],setup(l,{emit:de}){const ne=l,ce=de,ue=o(),me=y("days",["Sun","Mon","Tue","Wed","Thu"]),ve=y("periodsCount",8),pe=x(!1),fe=k(()=>ne.teacher_data),ge=k(()=>ne.selectedPeriod.day===ne.dayIndex&&ne.selectedPeriod.period===ne.periodIndex),_e=k(()=>ne.hoverPeriod.day===ne.dayIndex&&ne.hoverPeriod.period===ne.periodIndex),be=e=>me[e]||`Day ${e+1}`,he=e=>`P${e+1}`;k(()=>{const e=[];if(!ne.teacher_data)return e;for(let l=0;l<me.length;l++)for(let o=0;o<ve;o++){const a=`d${l+1}p${o+1}`;ne.teacher_data[a]||a===ne.period_code||e.push({code:a,label:`${be(l)} ${he(o)}`,dayIndex:l,periodIndex:o})}return e}),k(()=>{var e,l;const o=null==(l=null==(e=fe.value)?void 0:e[ne.period_code])?void 0:l.classroom;return o&&ne.conflicts&&0!==ne.conflicts.length?ne.conflicts.filter(e=>e.classroom===o).length:0});const ye=e=>e&&ne.conflicts&&0!==ne.conflicts.length?ne.conflicts.filter(l=>l.classroom===e):0,xe=e=>{ne.is_confirm?ue.dialog({title:"Confirm Period Link",message:`Assign "${null==e?void 0:e.subject} / ${null==e?void 0:e.classroom}" to period ${ne.period_code}?`,cancel:!0,persistent:!0}).onOk(()=>{ke(e)}).onCancel(()=>{je("Period link cancelled")}):ke(e)},ke=e=>{if(!(null==e?void 0:e.schedule_id))return void ue.notify({type:"negative",message:"Error: Missing ID for the selected period."});const l=e.schedule_id,o=ne.period_code;b.start();const a=route("admin.schedules.update_period_code",{schedule:l});L.patch(a,{period_code:o}).then(e=>{b.done(),pe.value=!1,ue.notify({type:"positive",message:e.data.message||"Schedule updated successfully!"}),ce("update_grid")}).catch(e=>{var l,o;b.done(),pe.value=!1,console.error("Error updating period code:",e),e.response&&422===e.response.status?ue.notify({type:"warning",message:e.response.data.message||"Teacher conflict detected.",icon:"warning"}):ue.notify({type:"negative",message:(null==(o=null==(l=e.response)?void 0:l.data)?void 0:o.message)||"Failed to update schedule."})})},we=()=>{var e,l;const o=null==(l=null==(e=ne.teacher_data)?void 0:e[ne.period_code])?void 0:l.schedule_id;b.start();const a=route("admin.schedules.update_period_code",{schedule:o});L.patch(a,{period_code:null}).then(e=>{b.done(),ue.loading.hide(),pe.value=!1,ue.notify({type:"positive",message:e.data.message||"Schedule updated successfully!"}),ce("update_grid")}).catch(e=>{var l,o;b.done(),pe.value=!1,ue.loading.hide(),console.error("Error updating period code:",e),e.response&&422===e.response.status?ue.notify({type:"warning",message:e.response.data.message||"Conflict detected during unlink.",icon:"warning"}):ue.notify({type:"negative",message:(null==(o=null==(l=e.response)?void 0:l.data)?void 0:o.message)||"Failed to update schedule."})})},je=(e,l="log")=>{console.log(l,e)};return(o,b)=>{var y,x,k,L,de,ce,ue,me,ve;return j(),w("div",{class:"relative w-full h-full flex flex-col items-center justify-center cursor-pointer",onClick:b[1]||(b[1]=e=>pe.value=!0)},[C(c,{"touch-position":"","context-menu":""},{default:q(()=>[C(a,{dense:"",style:{"min-width":"100px"}},{default:q(()=>[C(s,null,{default:q(()=>[C(t,null,{default:q(()=>{var o,a,s,t;return[P("div",{color:"primary",onClick:we},[b[2]||(b[2]=P("div",{class:"p-2"},null,-1)),C(e,{color:"red"},{default:q(()=>{var e;return[S(T(null==(e=fe.value[ne.period_code])?void 0:e.classroom),1)]}),_:1}),S(" : "+T(null==(a=null==(o=fe.value)?void 0:o[l.period_code])?void 0:a.subject)+" : "+T(null==(t=null==(s=fe.value)?void 0:s.teacher)?void 0:t.name),1)])]}),_:1})]),_:1}),I((j(),$(s,{clickable:""},{default:q(()=>[C(t,null,{default:q(()=>{var e;return[(null==(e=fe.value[ne.period_code])?void 0:e.classroom)?(j(),$(r,{key:0,color:"primary",onClick:we},{default:q(()=>b[3]||(b[3]=[S("Unlink Period ")])),_:1})):Q("",!0)]}),_:1})]),_:1})),[[i]]),C(d),C(s,{clickable:""},{default:q(()=>[C(t,null,{default:q(()=>b[4]||(b[4]=[S("Link with")])),_:1}),C(t,{side:""},{default:q(()=>[C(n,{name:"keyboard_arrow_right"})]),_:1}),C(c,{anchor:"top end",self:"top start"},{default:q(()=>{var l;return[(j(!0),w(O,null,U(null==(l=fe.value)?void 0:l.period_code_empty,l=>(j(),$(s,{key:l.id,onClick:e=>xe(l),clickable:""},{default:q(()=>[C(t,null,{default:q(()=>{var o;return[C(e,{class:"text-sm relative",color:"primary"},{default:q(()=>{var o,a;return[S(T(null==l?void 0:l.classroom)+" ",1),(null==(o=ye(null==l?void 0:l.classroom))?void 0:o.length)>0?(j(),$(e,{key:0,color:"negative",rounded:"",class:"text-xs absolute -top-4 right-4",label:null==(a=ye(null==l?void 0:l.classroom))?void 0:a.length},null,8,["label"])):Q("",!0)]}),_:2},1024),P("span",V,T(null==l?void 0:l.subject),1),(null==(o=ye(null==l?void 0:l.classroom))?void 0:o.length)>0?(j(),$(u,{key:0,anchor:"top middle",self:"bottom middle",delay:100},{default:q(()=>[P("div",D,[b[5]||(b[5]=P("div",{class:"text-sm font-medium mb-1"}," Conflicts for this classroom: ",-1)),C(h,{rows:ye(null==l?void 0:l.classroom),columns:[{name:"teacher",label:"Teacher",field:"teacher",align:"left"},{name:"classroom",label:"Classroom",field:"classroom",align:"left"},{name:"subject",label:"Subject",field:"subject",align:"left"}],"row-key":"teacher"},null,8,["rows"])])]),_:2},1024)):Q("",!0)]}),_:2},1024),C(t,{side:""},{default:q(()=>[C(n,{name:"keyboard_arrow_right"})]),_:1})]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1}),C(d),I((j(),$(s,{clickable:""},{default:q(()=>[C(t,null,{default:q(()=>b[6]||(b[6]=[S("Quit")])),_:1})]),_:1})),[[i]])]),_:1})]),_:1}),C(_,{modelValue:pe.value,"onUpdate:modelValue":b[0]||(b[0]=e=>pe.value=e),position:"bottom"},{default:q(()=>[C(m,{class:"relative"},{default:q(()=>[C(v,{class:"text-lg font-semibold text-center text-primary"},{default:q(()=>b[7]||(b[7]=[S(" Available Periods ")])),_:1}),C(d),C(v,{class:"q-pa-none"},{default:q(()=>{var l;return[P("div",E,[(j(!0),w(O,null,U(null==(l=fe.value)?void 0:l.period_code_empty,l=>{var d,n,c;return j(),w("div",{class:"p-0",key:l.id},[(null==(d=ye(null==l?void 0:l.classroom))?void 0:d.length)>0?(j(),$(f,{key:0,class:"min-w-fit","disable-dropdown":0==(null==(n=ye(null==l?void 0:l.classroom))?void 0:n.length),split:"",color:(null==(c=ye(null==l?void 0:l.classroom))?void 0:c.length)>0?"red":"blue",push:"","no-caps":"",onClick:e=>xe(l)},{label:q(()=>{var o;return[P("div",F,[P("div",M,[P("div",N,[C(e,{class:"text-sm relative",color:"primary"},{default:q(()=>{var o,a;return[S(T(null==l?void 0:l.classroom)+" ",1),(null==(o=ye(null==l?void 0:l.classroom))?void 0:o.length)>0?(j(),$(e,{key:0,color:"negative",rounded:"",class:"text-xs absolute -top-4 right-4",label:null==(a=ye(null==l?void 0:l.classroom))?void 0:a.length},null,8,["label"])):Q("",!0)]}),_:2},1024),P("span",z,T(null==l?void 0:l.subject),1),(null==(o=ye(null==l?void 0:l.classroom))?void 0:o.length)>0?(j(),$(u,{key:0,anchor:"top middle",self:"bottom middle",delay:100},{default:q(()=>[P("div",R,[b[8]||(b[8]=P("div",{class:"text-sm font-medium mb-1"}," Conflicts for this classroom: ",-1)),C(h,{rows:ye(null==l?void 0:l.classroom),columns:[{name:"teacher",label:"Teacher",field:"teacher",align:"left"},{name:"classroom",label:"Classroom",field:"classroom",align:"left"},{name:"subject",label:"Subject",field:"subject",align:"left"}],"row-key":"teacher","hide-pagination":"",dense:""},null,8,["rows"])])]),_:2},1024)):Q("",!0)])])])]}),default:q(()=>[C(a,null,{default:q(()=>[I((j(),$(s,{clickable:"",onClick:o.onItemClick},{default:q(()=>[C(t,null,{default:q(()=>[C(p,{caption:""},{default:q(()=>b[9]||(b[9]=[S("Conflicts for this classroom:")])),_:1}),C(p,null,{default:q(()=>[C(h,{rows:ye(null==l?void 0:l.classroom),columns:[{name:"teacher",label:"Teacher",field:"teacher",align:"left"},{name:"classroom",label:"Classroom",field:"classroom",align:"left"},{name:"subject",label:"Subject",field:"subject",align:"left"}],"row-key":"teacher","hide-pagination":"",dense:""},null,8,["rows"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[i]])]),_:2},1024)]),_:2},1032,["disable-dropdown","color","onClick"])):(j(),$(r,{key:1,class:"min-w-fit text-yellow-200",color:"light-blue",push:"","no-caps":"",onClick:e=>xe(l)},{default:q(()=>[P("div",W,[P("div",J,[P("div",K,[P("div",{class:"text-sm px-1",style:A(`background-color:  ${null==l?void 0:l.c_bg};color: ${null==l?void 0:l.c_text};`)},[C(e,{class:"text-sm relative",color:"primary"},{default:q(()=>[S(T(null==l?void 0:l.classroom),1)]),_:2},1024),S(" "+T(null==l?void 0:l.subject),1)],4)])])])]),_:2},1032,["onClick"]))])}),128))])]}),_:1}),C(d),C(g,{align:"right"},{default:q(()=>{var e;return[(null==(e=fe.value[ne.period_code])?void 0:e.classroom)?(j(),$(r,{key:0,label:"Unlink Period",color:"primary",onClick:we})):Q("",!0)]}),_:1})]),_:1})]),_:1},8,["modelValue"]),C(_,{"transition-show":"scale","transition-hide":"scale"},{default:q(()=>[C(m,{class:"min-w-[650px]"},{default:q(()=>[C(v,{class:"text-lg font-semibold text-center text-primary"},{default:q(()=>b[10]||(b[10]=[S(" Available Periods ")])),_:1}),C(d),C(v,{class:"q-pa-none"},{default:q(()=>{var l;return[P("div",G,[(j(!0),w(O,null,U(null==(l=fe.value)?void 0:l.period_code_empty,l=>{var r,d;return j(),$(f,{"disable-dropdown":0==(null==(r=ye(null==l?void 0:l.classroom))?void 0:r.length),split:"",color:(null==(d=ye(null==l?void 0:l.classroom))?void 0:d.length)>0?"red":"blue",push:"","no-caps":"",key:l.id,onClick:e=>xe(l)},{label:q(()=>{var o;return[P("div",H,[P("div",X,[P("div",Y,[C(e,{class:"text-sm relative",color:"primary"},{default:q(()=>{var o,a;return[S(T(null==l?void 0:l.classroom)+" ",1),(null==(o=ye(null==l?void 0:l.classroom))?void 0:o.length)>0?(j(),$(e,{key:0,color:"negative",rounded:"",class:"text-xs absolute -top-4 right-4",label:null==(a=ye(null==l?void 0:l.classroom))?void 0:a.length},null,8,["label"])):Q("",!0)]}),_:2},1024),P("span",Z,T(null==l?void 0:l.subject),1),(null==(o=ye(null==l?void 0:l.classroom))?void 0:o.length)>0?(j(),$(u,{key:0,anchor:"top middle",self:"bottom middle",delay:100},{default:q(()=>[P("div",ee,[b[11]||(b[11]=P("div",{class:"text-sm font-medium mb-1"}," Conflicts for this classroom: ",-1)),C(h,{rows:ye(null==l?void 0:l.classroom),columns:[{name:"teacher",label:"Teacher",field:"teacher",align:"left"},{name:"classroom",label:"Classroom",field:"classroom",align:"left"},{name:"subject",label:"Subject",field:"subject",align:"left"}],"row-key":"teacher","hide-pagination":"",dense:""},null,8,["rows"])])]),_:2},1024)):Q("",!0)])])])]}),default:q(()=>[C(a,null,{default:q(()=>[I((j(),$(s,{clickable:"",onClick:o.onItemClick},{default:q(()=>[C(t,null,{default:q(()=>[C(p,{caption:""},{default:q(()=>b[12]||(b[12]=[S("Conflicts for this classroom:")])),_:1}),C(p,null,{default:q(()=>[C(h,{rows:ye(null==l?void 0:l.classroom),columns:[{name:"teacher",label:"Teacher",field:"teacher",align:"left"},{name:"classroom",label:"Classroom",field:"classroom",align:"left"},{name:"subject",label:"Subject",field:"subject",align:"left"}],"row-key":"teacher","hide-pagination":"",dense:""},null,8,["rows"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[i]])]),_:2},1024)]),_:2},1032,["disable-dropdown","color","onClick"])}),128))])]}),_:1}),C(d),C(g,{align:"right"},{default:q(()=>[C(r,{label:"Unlink Period",color:"primary",onClick:we})]),_:1})]),_:1})]),_:1}),P("div",le,[P("div",{class:B([ge.value?"  shadow-none rounded-none h-16    opacity-100":"opacity-0","absolute inset-0 rounded transition-opacity duration-200"])},b[13]||(b[13]=[P("div",{class:"w-full h-full bg-gray-200 opacity-40"},null,-1)]),2),P("div",{class:B([_e.value?"bg-gray-400 opacity-20":"opacity-0","absolute inset-0 rounded duration-200 pointer-events-none"])},null,2)]),P("div",oe,[(null==(y=fe.value[ne.period_code])?void 0:y.classroom)?(j(),w("div",{key:0,class:B(["flex flex-row items-center",(null==(x=fe.value[ne.period_code])?void 0:x.classroom)?"blue":" "])},[P("div",ae,[P("div",se,[P("div",te,[P("div",null,[(null==(k=fe.value[ne.period_code])?void 0:k.conflict_count)>0?(j(),$(e,{key:0,color:"red","text-color":"white"},{default:q(()=>{var l;return[S(T(null==(l=fe.value[ne.period_code])?void 0:l.classroom)+" ",1),C(e,{class:"mt-4",color:"red",floating:""},{default:q(()=>{var e;return[S(T(null==(e=fe.value[ne.period_code])?void 0:e.conflict_count),1)]}),_:1})]}),_:1})):Q("",!0),0==(null==(L=fe.value[ne.period_code])?void 0:L.conflict_count)?(j(),w("div",ie,T(null==(de=fe.value[ne.period_code])?void 0:de.classroom),1)):Q("",!0)])]),P("span",re,[S(T(null==(ue=null==(ce=fe.value)?void 0:ce[l.period_code])?void 0:ue.subject_cute)+" ",1),(null==(ve=null==(me=fe.value)?void 0:me[l.period_code])?void 0:ve.subject)?(j(),$(u,{key:0,anchor:"top middle",self:"bottom middle",delay:300},{default:q(()=>{var e,o;return[S(T(null==(o=null==(e=fe.value)?void 0:e[l.period_code])?void 0:o.subject),1)]}),_:1})):Q("",!0)])])])],2)):Q("",!0)])])}}},[["__scopeId","data-v-46b1c2d3"]]);export{de as default};
