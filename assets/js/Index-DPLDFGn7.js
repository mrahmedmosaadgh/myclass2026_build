import{o as e,u as s,c as a,m as l,a as t,d as o}from"./app-B77gjd5a.js";import{Q as r}from"./QTab-CnAf4tCv.js";import{Q as u}from"./QTabs-D_ZwIIJm.js";import{Q as n}from"./QSpinnerDots-CnY0H5Kp.js";import{Q as c}from"./QTabPanel-B_PJ80R0.js";import{Q as i}from"./QTabPanels-B5JhG1n5.js";import{f as d,a as m,o as p,I as v,J as f,K as h,N as b,b as y,M as g,R as j,V as _,F as x,$ as Q}from"./vendor-DuKqz2x4.js";import{_ as S}from"./AppLayout-OZsHDu4T.js";import U from"./UserCard-vOh1gGjp.js";import k from"./UserFilters-CxsLm_4C.js";import w from"./RoleManager-BGXrcGz2.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";import"./rtl-Cr6c3OOr.js";import"./use-panel-N2fkKyR_.js";import"./use-render-cache-CmTcazfP.js";import"./QSelect-DB_tK-Lk.js";const q={class:"q-pa-md"},M={class:"text-h5 text-bold"},T={class:"text-subtitle2 text-grey-8"},V={key:0,class:"text-center q-pa-lg"},L={key:1,class:"row q-col-gutter-md"},C={key:2,class:"text-center text-grey-7 q-pa-xl"},I=e({__name:"Index",props:{usersData:{type:Object,required:!0},schools:{type:Array,default:()=>[]},roles:{type:Array,default:()=>[]}},setup(e){const I=e,R=s(),D=d(!1),F=d("teachers"),O=d(""),A=d(null),J=d(null),K=d(!1),N=d(null),P=d(I.usersData),z=m(()=>I.roles.map(e=>e.name)),E=m(()=>({total:{count:P.value.stats.total,label:"Total Users"},teachers:{count:P.value.stats.teachers,label:"Teachers"},students:{count:P.value.stats.students,label:"Students"}})),H=m(()=>{var e;const s=O.value.toLowerCase(),a=null==(e=A.value)?void 0:e.id,l=J.value,t=e=>{const t=e.name.toLowerCase().includes(s),o=e.email.toLowerCase().includes(s),r=!a||e.school_id===a,u=!l||e.roles.some(e=>e.name===l);return(t||o)&&r&&u};return{teachers:P.value.teachers.filter(t),students:P.value.students.filter(t),others:P.value.others.filter(t)}}),$=e=>{N.value=e,K.value=!0},B=({userId:e,roles:s})=>{Q.post(route("admin.users.roles.update",e),{roles:s},{preserveScroll:!0,onSuccess:()=>{R.notify({type:"positive",message:"User roles updated successfully.",icon:"check_circle"}),K.value=!1,G()},onError:e=>{R.notify({type:"negative",message:"Failed to update roles. Please check the errors.",caption:Object.values(e).join(" ")})}})},G=()=>{Q.get(route("admin.users.index"),{},{preserveState:!0,preserveScroll:!0,onStart:()=>D.value=!0,onFinish:()=>D.value=!1,onSuccess:e=>{P.value=e.props.usersData}})};return p(()=>{}),(s,d)=>(f(),v(S,{title:"User Management"},{default:h(()=>[b("div",q,[y(l,{flat:"",bordered:""},{default:h(()=>[y(a,null,{default:h(()=>d[6]||(d[6]=[b("div",{class:"text-h6"},"Users & Roles Management",-1),b("div",{class:"text-subtitle2"},"Manage all users, roles, and permissions across the platform.",-1)])),_:1}),y(a,{class:"row q-col-gutter-md"},{default:h(()=>[(f(!0),g(x,null,j(E.value,(e,s)=>(f(),g("div",{key:s,class:"col-12 col-sm-6 col-md-3"},[y(l,{class:"bg-blue-grey-1 text-center"},{default:h(()=>[y(a,null,{default:h(()=>[b("div",M,_(e.count),1),b("div",T,_(e.label),1)]),_:2},1024)]),_:2},1024)]))),128))]),_:1}),y(a,null,{default:h(()=>[y(k,{schools:e.schools,roles:z.value,search:O.value,"onUpdate:search":d[0]||(d[0]=e=>O.value=e),school:A.value,"onUpdate:school":d[1]||(d[1]=e=>A.value=e),role:J.value,"onUpdate:role":d[2]||(d[2]=e=>J.value=e)},null,8,["schools","roles","search","school","role"])]),_:1}),y(t),y(u,{modelValue:F.value,"onUpdate:modelValue":d[3]||(d[3]=e=>F.value=e),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:h(()=>[y(r,{name:"teachers",label:"Teachers"}),y(r,{name:"students",label:"Students"}),y(r,{name:"others",label:"Others"})]),_:1},8,["modelValue"]),y(t),y(i,{modelValue:F.value,"onUpdate:modelValue":d[4]||(d[4]=e=>F.value=e),animated:""},{default:h(()=>[(f(),g(x,null,j(["teachers","students","others"],e=>y(c,{key:e,name:e},{default:h(()=>{var s;return[D.value?(f(),g("div",V,[y(n,{color:"primary",size:"40px"}),d[7]||(d[7]=b("p",null,"Loading users...",-1))])):(null==(s=H.value[e])?void 0:s.length)>0?(f(),g("div",L,[(f(!0),g(x,null,j(H.value[e],s=>(f(),g("div",{key:s.id,class:"col-12 col-sm-6 col-md-4 col-lg-3"},[y(U,{user:s,type:e.slice(0,-1),onManageRoles:$},null,8,["user","type"])]))),128))])):(f(),g("div",C,[y(o,{name:"person_off",size:"4em"}),d[8]||(d[8]=b("p",{class:"q-mt-md"},"No users found matching your criteria.",-1))]))]}),_:2},1032,["name"])),64))]),_:1},8,["modelValue"])]),_:1})]),y(w,{show:K.value,user:N.value,"all-roles":z.value,onClose:d[5]||(d[5]=e=>K.value=!1),onSave:B},null,8,["show","user","all-roles"])]),_:1}))}},[["__scopeId","data-v-13191e93"]]);export{I as default};
