import{o as e,u as t,c as l,m as a,d as o,n as i,a as s,Q as n,C as r,A as d,e as c,aP as u,f as m,k as v,b as p,l as y}from"./app-B77gjd5a.js";import{Q as g}from"./QSpace-Bk4F2b8L.js";import{Q as f}from"./QSelect-DB_tK-Lk.js";import{Q as b}from"./QForm-BQsH4F1U.js";import{Q as h}from"./QFile-CU_I75Xg.js";import{u as _,w}from"./xlsx-cMC2LkxH.js";import{F as x}from"./FullCalendar-ClNNme2B.js";import{f as C,a as E,_ as k,o as F,M as V,J as S,b as q,K as R,N as D,V as j,W as T,F as M,R as A,S as U,U as B,y as $,Q as z}from"./vendor-DuKqz2x4.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";import"./rtl-Cr6c3OOr.js";import"./use-file-Bu9Bf7oq.js";import"./QSpinnerDots-CnY0H5Kp.js";const Q=()=>{const e=document.head.querySelector('meta[name="csrf-token"]');return e?e.content:null},O=async()=>{let e=Q();if(!e)try{(await fetch("/sanctum/csrf-cookie",{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).ok&&(await new Promise(e=>setTimeout(e,100)),e=Q())}catch(t){console.error("Failed to fetch CSRF cookie:",t)}return e?(((e=null)=>{const t=e||Q();t&&window.axios&&(window.axios.defaults.headers.common["X-CSRF-TOKEN"]=t)})(e),console.log("CSRF token refreshed:",e.substring(0,10)+"..."),e):(console.error("Failed to refresh CSRF token - no token available"),null)},I=(e=null)=>{const t=e||window.axios;t?(t.interceptors.request.use(e=>{const t=Q();return t&&(e.headers["X-CSRF-TOKEN"]=t),e.headers["X-Requested-With"]="XMLHttpRequest",e},e=>Promise.reject(e)),t.interceptors.response.use(e=>e,e=>{var l;if(419===(null==(l=e.response)?void 0:l.status)){const l=e.config;return["/login","/logout","/register","/password/reset"].some(e=>{var t;return null==(t=l.url)?void 0:t.includes(e)})?(console.warn("CSRF token mismatch on auth endpoint. Reloading page..."),window.location.reload(),Promise.reject(e)):l._retryCount>=1?(console.error("CSRF token retry limit reached. Reloading page..."),window.location.reload(),Promise.reject(e)):(console.warn("CSRF token mismatch detected. Attempting to refresh..."),O().then(a=>a?(l._retryCount=(l._retryCount||0)+1,l.headers["X-CSRF-TOKEN"]=a,console.log("Retrying request with new CSRF token..."),t.request(l)):(console.error("Could not refresh CSRF token. Reloading page..."),window.location.reload(),Promise.reject(e))).catch(t=>(console.error("Error during CSRF token refresh:",t),window.location.reload(),Promise.reject(e))))}return Promise.reject(e)})):console.error("Axios instance not found")},P=()=>{const e=Q();return e&&e.length>0};"undefined"!=typeof window&&(window.csrfUtils={getCsrfToken:Q,refreshCsrfToken:O,validateCsrfToken:P,setupCsrfInterceptors:I});const H={class:"q-pa-md"},N={class:"row justify-between items-center q-mb-md"},X={class:"col-auto"},K={class:"row q-gutter-sm items-center"},L={class:"row items-center q-gutter-sm"},W={class:"text-body2 text-weight-medium"},G={class:"row q-gutter-md q-mb-md"},Y={class:"col-12 col-md-4"},J={class:"row items-center justify-between q-mb-md"},Z={class:"text-h6 text-weight-medium text-grey-8"},ee={key:0,class:"text-center q-py-md"},te={key:1,class:"column q-gutter-sm"},le={class:"row items-center no-wrap q-gutter-sm"},ae={class:"column flex-1"},oe={class:"text-weight-medium text-body2 text-grey-8"},ie={class:"text-caption text-grey-6"},se={class:"column items-end"},ne={class:"col-12 col-md-8"},re={class:"row items-center justify-between q-mb-md"},de={class:"text-h6 text-weight-medium text-grey-8"},ce={class:"row q-gutter-md items-center"},ue=["onMouseenter"],me={class:"row items-center no-wrap q-gutter-xs"},ve={class:"column"},pe={class:"text-caption text-grey-6"},ye={key:0,class:"edit-instructions"},ge={key:1,class:"view-instructions"},fe={class:"text-h6"},be={key:0,class:"row q-gutter-md"},he={class:"row justify-end q-gutter-sm q-mt-md"},_e=e({__name:"Index",props:{records:Object,options:Object},setup(e){const Q=t(),I=C(!1),_e=C(null),we=C(!1),xe=C(!1),Ce=C(null),Ee=C([]),ke=C(!1),Fe=C(null),Ve=C(null),Se=C(!0),qe=C({title:"",description:"",type:"",date:"",is_full_day:!1,start_time:"",end_time:"",location:"",status:"active"}),Re=E(()=>Ee.value||[]),De=[{value:"holiday",label:"Holiday"},{value:"meeting",label:"Meeting"},{value:"exam",label:"Exam"},{value:"activity",label:"Activity"},{value:"other",label:"Other"}],je=[{value:"active",label:"Active"},{value:"cancelled",label:"Cancelled"},{value:"completed",label:"Completed"}],Te=[{type:"holiday",label:"Holiday",icon:"beach_access",color:"#EF4444",darkColor:"#DC2626",bgColor:"#FEF2F2"},{type:"meeting",label:"Meeting",icon:"groups",color:"#3B82F6",darkColor:"#2563EB",bgColor:"#EFF6FF"},{type:"exam",label:"Exam",icon:"quiz",color:"#8B5CF6",darkColor:"#7C3AED",bgColor:"#F5F3FF"},{type:"activity",label:"Activity",icon:"sports_esports",color:"#10B981",darkColor:"#059669",bgColor:"#ECFDF5"},{type:"other",label:"Other",icon:"event_note",color:"#6B7280",darkColor:"#4B5563",bgColor:"#F9FAFB"}],Me=e=>{const t={holiday:"beach_access",meeting:"groups",exam:"quiz",activity:"sports_esports",other:"event_note"};return t[e]||t.other},Ae=e=>{const t=new Date,l=new Date(e);t.setHours(0,0,0,0),l.setHours(0,0,0,0);const a=l-t,o=Math.ceil(a/864e5);return Math.max(0,o)},Ue=E(()=>{const e=new Date;return e.setHours(0,0,0,0),Ee.value.filter(t=>{const l=new Date(t.date);return l.setHours(0,0,0,0),l>=e}).map(e=>({...e,daysRemaining:Ae(e.date)})).sort((e,t)=>e.daysRemaining-t.daysRemaining).slice(0,3)}),Be=async()=>{try{const e=await k.get("/api/calendar-events");Ee.value=$e(e.data),console.log("Events fetched successfully:",Ee.value.length,"events")}catch(e){console.error("Error fetching events:",e),Q.notify({color:"negative",message:"Failed to load calendar events",icon:"error"})}},$e=e=>e.map(e=>{let t;return t=e.calendar&&e.calendar.date?new Date(e.calendar.date).toISOString().split("T")[0]:e.date?e.date.includes("T")?e.date.split("T")[0]:e.date:e.start_time&&e.start_time.includes("T")?e.start_time.split("T")[0]:(new Date).toISOString().split("T")[0],{id:e.id,title:e.title,description:e.description,date:t,is_full_day:Boolean(e.is_full_day),start_time:e.start_time,end_time:e.end_time,location:e.location,type:e.type||"other",color:ze(e.type),affects_all_schedules:Boolean(e.affects_all_schedules),status:e.status,calendar:e.calendar}}),ze=e=>{const t={holiday:"#ef4444",meeting:"#3b82f6",exam:"#8b5cf6",activity:"#10b981",other:"#6b7280"};return t[e]||t.other},Qe=()=>{I.value=!1,_e.value=null,Ce.value=null,qe.value={title:"",description:"",type:"",date:"",is_full_day:!1,start_time:"",end_time:"",location:"",status:"active"}},Oe=(e=null)=>{e&&e.id?(_e.value=e,qe.value={title:e.title||"",description:e.description||"",type:e.type||"",date:e.date||"",is_full_day:e.is_full_day||!1,start_time:e.start_time||"",end_time:e.end_time||"",location:e.location||"",status:e.status||"active"}):(_e.value=null,qe.value={title:"",description:"",type:"",date:Ce.value?Ze(Ce.value):"",is_full_day:!1,start_time:"",end_time:"",location:"",status:"active"}),I.value=!0},Ie=async()=>{we.value=!0;try{_e.value&&_e.value.id?(await k.put(`/api/calendar-events/${_e.value.id}`,qe.value),Q.notify({color:"positive",message:"Event updated successfully",icon:"check"})):(await k.post("/api/calendar-events",qe.value),Q.notify({color:"positive",message:"Event created successfully",icon:"check"})),await Be(),Qe()}catch(e){console.error("Error saving event:",e),Q.notify({color:"negative",message:"Failed to save event",icon:"error"})}finally{we.value=!1}},Pe=()=>{const e=Ee.value.map(e=>({title:e.title,description:e.description,type:e.type,date:e.date,is_full_day:e.is_full_day,start_time:e.start_time,end_time:e.end_time,location:e.location,status:e.status})),t=_.json_to_sheet(e),l=_.book_new();_.book_append_sheet(l,t,"Calendar Events"),w(l,"calendar_events_export.xlsx")},He=e=>{Fe.value=e},Ne=async()=>{if(Fe.value){xe.value=!0;try{const e=new FormData;e.append("file",Fe.value);const t=await k.post("/api/calendar-events/import",e,{headers:{"Content-Type":"multipart/form-data"}});Q.notify({color:"positive",message:t.data.message||"Events imported successfully",icon:"check"}),await Be(),ke.value=!1,Fe.value=null}catch(e){console.error("Import failed:",e),Q.notify({color:"negative",message:"Failed to import events",icon:"error"})}finally{xe.value=!1}}},Xe={holiday:{label:"Holiday",color:"#EF4444",bgColor:"#FEE2E2"},meeting:{label:"Meeting",color:"#3B82F6",bgColor:"#DBEAFE"},exam:{label:"Exam",color:"#8B5CF6",bgColor:"#EDE9FE"},activity:{label:"Activity",color:"#10B981",bgColor:"#D1FAE5"},other:{label:"Other",color:"#6B7280",bgColor:"#F3F4F6"}},Ke=E(()=>Ee.value.map(e=>{const t=Xe[e.type]||Xe.other,l={id:e.id,title:e.title,date:e.date,type:e.type,color:t.color,backgroundColor:t.bgColor,description:e.description||t.label,location:e.location||"",start_time:e.start_time,end_time:e.end_time,originalEvent:e};return Se.value&&(l.interactive=!0,l.editable=!0,l.deletable=!0,l.extendedProps={...l.extendedProps,showEditButton:!0,showDeleteButton:!0,onEdit:()=>Ge(e),onDelete:()=>Ye(e)}),l})),Le=e=>{if(!Se.value)return;const t=Ee.value.find(t=>t.id===e.id);t&&Oe(t)},We=e=>{console.log("handleDateClick",e),Se.value&&(Ce.value=e,Oe(null))},Ge=e=>{if(!Se.value)return;const t=Ee.value.find(t=>t.id===e.id);t&&Oe(t)},Ye=async e=>{Se.value&&Q.dialog({title:"Delete Event",message:`Are you sure you want to delete "${e.title}"?`,cancel:!0,persistent:!0,color:"negative"}).onOk(async()=>{try{await k.delete(`/api/calendar-events/${e.id}`),Q.notify({color:"positive",message:"Event deleted successfully",icon:"check"}),await Be()}catch(t){console.error("Error deleting event:",t),Q.notify({color:"negative",message:"Failed to delete event",icon:"error"})}})},Je=e=>{Se.value=e,Q.notify({color:e?"positive":"info",message:"Edit mode "+(e?"enabled":"disabled"),icon:e?"edit":"visibility",timeout:1500})},Ze=e=>{if("string"==typeof e)return e;if(e instanceof Date){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`};return F(async()=>{if(we.value=!0,!P()){console.warn("CSRF token validation failed. Refreshing token...");try{await O()}catch(e){console.error("Failed to refresh CSRF token:",e)}}await Be(),we.value=!1}),(e,t)=>(S(),V("div",H,[q(a,{class:"q-mb-md"},{default:R(()=>[q(l,null,{default:R(()=>[D("div",N,[D("div",{class:"col-auto"},[D("div",{class:"text-h4 text-weight-bold"},j("Calendar Management")),t[16]||(t[16]=D("div",{class:"text-caption text-grey-6"},"Manage academic calendar entries and events",-1))]),D("div",X,[D("div",K,[q(a,{flat:"",bordered:"",class:"q-pa-sm"},{default:R(()=>[D("div",L,[q(o,{name:Se.value?"edit":"visibility",color:Se.value?"positive":"grey-6",size:"sm"},null,8,["name","color"]),D("span",W,j(Se.value?"Edit Mode":"View Mode"),1),q(i,{modelValue:Se.value,"onUpdate:modelValue":t[0]||(t[0]=e=>Se.value=e),color:"positive",size:"sm",icon:Se.value?"edit":"visibility"},null,8,["modelValue","icon"])])]),_:1}),q(s,{vertical:"",inset:""}),q(n,{color:"primary",icon:"add",label:"Add New Entry",onClick:t[1]||(t[1]=e=>Oe()),loading:we.value,disable:!Se.value,unelevated:""},null,8,["loading","disable"]),q(n,{color:"secondary",icon:"upload",label:"Import Events",onClick:t[2]||(t[2]=e=>ke.value=!0),disable:we.value||!Se.value,unelevated:""},null,8,["disable"]),q(n,{color:"accent",icon:"download",label:"Export",onClick:Pe,disable:we.value||!Re.value.length,unelevated:""},null,8,["disable"])])])]),D("div",G,[D("div",Y,[q(a,{flat:"",class:"upcoming-events-card",style:{background:"linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%)",border:"1px solid #fb923c"}},{default:R(()=>[q(l,{class:"q-pa-lg"},{default:R(()=>[D("div",J,[D("div",Z,[q(o,{name:"schedule",class:"q-mr-sm",color:"orange"}),t[17]||(t[17]=T(" Upcoming Events "))]),q(r,{outline:"",color:"orange","text-color":"orange",size:"sm",class:"text-weight-medium"},{default:R(()=>[T(" Next "+j(Ue.value.length),1)]),_:1})]),0===Ue.value.length?(S(),V("div",ee,[q(o,{name:"event_available",size:"48px",color:"grey-4"}),t[18]||(t[18]=D("div",{class:"text-body2 text-grey-6 q-mt-sm"},"No upcoming events",-1))])):(S(),V("div",te,[(S(!0),V(M,null,A(Ue.value,e=>(S(),V("div",{key:e.id,class:"upcoming-event-item"},[q(a,{flat:"",class:"upcoming-event-card q-pa-sm cursor-pointer",style:U({background:"white",border:`2px solid ${ze(e.type)}`,borderRadius:"8px"}),onClick:t=>Oe(e)},{default:R(()=>{return[D("div",le,[q(d,{style:U({background:ze(e.type),boxShadow:`0 2px 8px ${ze(e.type)}40`}),size:"32px"},{default:R(()=>[q(o,{name:Me(e.type),color:"white",size:"16px"},null,8,["name"])]),_:2},1032,["style"]),D("div",ae,[D("div",oe,j(e.title),1),D("div",ie,j((l=e.date,new Date(l).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}))),1)]),D("div",se,[q(r,{color:(t=e.daysRemaining,0===t?"red":1===t?"orange":t<=7?"amber":"green"),"text-color":"white",size:"sm",class:"text-weight-bold"},{default:R(()=>[T(j(0===e.daysRemaining?"Today":1===e.daysRemaining?"Tomorrow":`${e.daysRemaining} days`),1)]),_:2},1032,["color"])])])];var t,l}),_:2},1032,["style","onClick"])]))),128))]))]),_:1})]),_:1})]),D("div",ne,[q(a,{flat:"",class:"legend-card",style:{background:"linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%)",border:"1px solid #e1e8ff"}},{default:R(()=>[q(l,{class:"q-pa-lg"},{default:R(()=>[D("div",re,[D("div",de,[q(o,{name:"palette",class:"q-mr-sm",color:"primary"}),t[19]||(t[19]=T(" Event Types "))]),q(r,{outline:"",color:"primary","text-color":"primary",size:"sm",class:"text-weight-medium"},{default:R(()=>[T(j(Ee.value.length)+" Events ",1)]),_:1})]),D("div",ce,[(S(),V(M,null,A(Te,e=>D("div",{key:e.type,class:B(["legend-item",{"legend-item-active":Ve.value===e.type}]),onMouseenter:t=>Ve.value=e.type,onMouseleave:t[3]||(t[3]=e=>Ve.value=null)},[q(a,{flat:"",class:"legend-item-card q-pa-sm cursor-pointer",style:U({background:Ve.value===e.type?e.bgColor:"white",border:`2px solid ${e.color}`,borderRadius:"12px"})},{default:R(()=>{return[D("div",me,[q(d,{style:U({background:`linear-gradient(135deg, ${e.color}, ${e.darkColor})`,boxShadow:`0 2px 8px ${e.color}40`}),size:"24px",class:"legend-avatar"},{default:R(()=>[q(o,{name:e.icon,color:"white",size:"14px"},null,8,["name"])]),_:2},1032,["style"]),D("div",ve,[D("span",{class:"text-weight-medium text-body2",style:U({color:Ve.value===e.type?e.color:"#374151"})},j(e.label),5),D("span",pe,j((t=e.type,Ee.value.filter(e=>e.type===t).length))+" events ",1)])])];var t}),_:2},1032,["style"])],42,ue)),64))])]),_:1})]),_:1})])]),D("div",{class:B(["calendar-container",{"edit-mode":Se.value,"view-mode":!Se.value}])},[q(x,{events:Ke.value,"initial-edit-mode":Se.value,onEventClick:Le,onDateClick:We,onAddEvent:We,onEventEdit:Ge,onEventDelete:Ye,onEditModeChange:Je},null,8,["events","initial-edit-mode"]),Se.value?(S(),V("div",ye,[q(c,{"inline-actions":"",class:"bg-blue-1 text-blue-8"},{avatar:R(()=>[q(o,{name:"info",color:"blue"})]),action:R(()=>[q(n,{flat:"",color:"blue",label:"Got it",size:"sm"})]),default:R(()=>[t[20]||(t[20]=D("strong",null,"Edit Mode Active:",-1)),t[21]||(t[21]=T(" Click on any day to add events, or click on existing events to edit them. "))]),_:1})])):(S(),V("div",ge,[q(c,{"inline-actions":"",class:"bg-grey-2 text-grey-8"},{avatar:R(()=>[q(o,{name:"visibility",color:"grey-6"})]),default:R(()=>[t[22]||(t[22]=D("strong",null,"View Mode:",-1)),t[23]||(t[23]=T(" Calendar is in read-only mode. Enable Edit Mode to make changes. "))]),_:1})]))],2)]),_:1})]),_:1}),q(p,{modelValue:I.value,"onUpdate:modelValue":t[13]||(t[13]=e=>I.value=e),persistent:""},{default:R(()=>[q(a,{style:{"min-width":"500px"}},{default:R(()=>[q(l,{class:"row items-center q-pb-none"},{default:R(()=>[D("div",fe,j(_e.value?"Edit Event":"Add New Event"),1),q(g),$(q(n,{icon:"close",flat:"",round:"",dense:""},null,512),[[u]])]),_:1}),q(l,null,{default:R(()=>[q(b,{onSubmit:Ie,class:"q-gutter-md"},{default:R(()=>[q(m,{modelValue:qe.value.title,"onUpdate:modelValue":t[4]||(t[4]=e=>qe.value.title=e),label:"Event Title *",outlined:"",rules:[e=>!!e||"Title is required"]},null,8,["modelValue","rules"]),q(m,{modelValue:qe.value.description,"onUpdate:modelValue":t[5]||(t[5]=e=>qe.value.description=e),label:"Description",outlined:"",type:"textarea",rows:"3"},null,8,["modelValue"]),q(f,{modelValue:qe.value.type,"onUpdate:modelValue":t[6]||(t[6]=e=>qe.value.type=e),options:De,label:"Event Type *",outlined:"","emit-value":"","map-options":"",rules:[e=>!!e||"Event type is required"]},null,8,["modelValue","rules"]),q(m,{modelValue:qe.value.date,"onUpdate:modelValue":t[7]||(t[7]=e=>qe.value.date=e),label:"Date *",outlined:"",type:"date",rules:[e=>!!e||"Date is required"]},null,8,["modelValue","rules"]),q(v,{modelValue:qe.value.is_full_day,"onUpdate:modelValue":t[8]||(t[8]=e=>qe.value.is_full_day=e),label:"All Day Event"},null,8,["modelValue"]),qe.value.is_full_day?z("",!0):(S(),V("div",be,[q(m,{modelValue:qe.value.start_time,"onUpdate:modelValue":t[9]||(t[9]=e=>qe.value.start_time=e),label:"Start Time",outlined:"",type:"time",class:"col"},null,8,["modelValue"]),q(m,{modelValue:qe.value.end_time,"onUpdate:modelValue":t[10]||(t[10]=e=>qe.value.end_time=e),label:"End Time",outlined:"",type:"time",class:"col"},null,8,["modelValue"])])),q(m,{modelValue:qe.value.location,"onUpdate:modelValue":t[11]||(t[11]=e=>qe.value.location=e),label:"Location",outlined:""},null,8,["modelValue"]),q(f,{modelValue:qe.value.status,"onUpdate:modelValue":t[12]||(t[12]=e=>qe.value.status=e),options:je,label:"Status *",outlined:"","emit-value":"","map-options":"",rules:[e=>!!e||"Status is required"]},null,8,["modelValue","rules"]),D("div",he,[q(n,{label:"Cancel",color:"grey",flat:"",onClick:Qe}),q(n,{label:"Save",color:"primary",type:"submit",loading:we.value},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),q(p,{modelValue:ke.value,"onUpdate:modelValue":t[15]||(t[15]=e=>ke.value=e)},{default:R(()=>[q(a,{style:{"min-width":"400px"}},{default:R(()=>[q(l,null,{default:R(()=>t[24]||(t[24]=[D("div",{class:"text-h6"},"Import Calendar Events",-1)])),_:1}),q(l,null,{default:R(()=>[q(h,{modelValue:Fe.value,"onUpdate:modelValue":t[14]||(t[14]=e=>Fe.value=e),label:"Select Excel file",outlined:"",accept:".xlsx,.xls",onInput:He},{prepend:R(()=>[q(o,{name:"attach_file"})]),_:1},8,["modelValue"])]),_:1}),q(y,{align:"right"},{default:R(()=>[$(q(n,{flat:"",label:"Cancel",color:"grey"},null,512),[[u]]),q(n,{label:"Import",color:"primary",onClick:Ne,loading:xe.value,disable:!Fe.value},null,8,["loading","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-669ac6fb"]]);export{_e as default};
