import{r as e,u as l,Q as s,t,b as a,j as o,k as c,i as d,ao as r,aS as n}from"./app-Dtv5Fi9L.js";import{a as i,N as u,J as h,I as v,O as m,V as p,R as _,S as f,b as y,W as b,K as g,a0 as k,y as w,U as x}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";const j={key:0,class:"empty-cell"},C={key:1,class:"text-caption text-grey-6"},S={key:2,class:"text-caption text-grey-4"},I={key:3,class:"period-order-badge"},T={key:1,class:"assigned-cell"},$=["title"],z=["title"],D={key:2,class:"classroom-name text-caption text-grey-6"},B={class:"indicators"},O=e({__name:"TimetableCell",props:{schedule:{type:Object,default:null},showClassroom:{type:Boolean,default:!1},hideTeacher:{type:Boolean,default:!1},conflictInfo:{type:Object,default:null},readonly:{type:Boolean,default:!1},showFullName:{type:Boolean,default:!1},rewardSystemDisabled:{type:Boolean,default:!1}},emits:["click","edit","clear","open-reward"],setup(e,{emit:O}){const N=l(),F=e,H=O;i(()=>{var e,l,s,t,a;return(null==(s=null==(l=null==(e=F.schedule)?void 0:e.cst)?void 0:l.subject)?void 0:s.name)||(null==(a=null==(t=F.schedule)?void 0:t.cst)?void 0:a.subject_name)||"Subject"}),i(()=>{var e,l,s,t,a;return(null==(s=null==(l=null==(e=F.schedule)?void 0:e.cst)?void 0:l.teacher)?void 0:s.name)||(null==(a=null==(t=F.schedule)?void 0:t.cst)?void 0:a.teacher_name)||"Teacher"});const L=i(()=>{var e,l,s,t,a;return(null==(s=null==(l=null==(e=F.schedule)?void 0:e.cst)?void 0:l.subject)?void 0:s.name)||(null==(a=null==(t=F.schedule)?void 0:t.cst)?void 0:a.subject_name)||"Subject"}),R=i(()=>{var e,l,s,t,a;return(null==(s=null==(l=null==(e=F.schedule)?void 0:e.cst)?void 0:l.teacher)?void 0:s.name)||(null==(a=null==(t=F.schedule)?void 0:t.cst)?void 0:a.teacher_name)||"Teacher"}),W=i(()=>{const e=L.value;return e.length>3?e.substring(0,3):e}),q=i(()=>{const e=R.value.split(" ");if(1===e.length)return e[0].length>3?e[0].substring(0,3):e[0];return`${e[0].length>3?e[0].substring(0,3):e[0]} ${e[e.length-1].length>3?e[e.length-1].substring(0,3):e[e.length-1]}`}),A=i(()=>{var e,l,s,t,a;return(null==(s=null==(l=null==(e=F.schedule)?void 0:e.cst)?void 0:l.classroom)?void 0:s.name)||(null==(a=null==(t=F.schedule)?void 0:t.cst)?void 0:a.classroom_name)||""}),E=i(()=>{var e,l,s,t;return(null==(l=null==(e=F.schedule)?void 0:e.cst)?void 0:l.c_bg)||(null==(t=null==(s=F.schedule)?void 0:s.cst)?void 0:t.color_custom)||"#e0e0e0"}),J=i(()=>{var e,l,s,t;return(null==(l=null==(e=F.schedule)?void 0:e.cst)?void 0:l.c_text)||(null==(t=null==(s=F.schedule)?void 0:s.cst)?void 0:t.color_custom_text)||"#333333"}),K=i(()=>{var e,l,s;return{"is-empty":!(null==(e=F.schedule)?void 0:e.cst_id),"is-assigned":!!(null==(l=F.schedule)?void 0:l.cst_id),"has-substitute":!!(null==(s=F.schedule)?void 0:s.teacher_substitute_id),"has-conflict":!!F.conflictInfo,"cursor-pointer":!F.readonly,"is-readonly":F.readonly}}),Q=i(()=>!!F.conflictInfo),U=i(()=>{if(!F.conflictInfo)return"";const e=F.conflictInfo.other_classrooms||[];if(0===e.length)return"Teacher has a scheduling conflict";const l=e.map(e=>`${e.classroom_name} (${e.subject_name})`).join(", ");return`⚠️ Conflict: ${F.conflictInfo.teacher_name} is also assigned to: ${l}`}),V=()=>{var e,l,s;if(!(null==(s=null==(l=null==(e=F.schedule)?void 0:e.cst)?void 0:l.teacher)?void 0:s.id))return;const t=(F.schedule.cst.teacher.name||"teacher").toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),a=route("schedules.teacher.view",{teacher_id:F.schedule.cst.teacher.id,teacher_name:t});navigator.clipboard.writeText(a).then(()=>{N.notify({type:"positive",message:"Teacher schedule link copied to clipboard!",position:"top",timeout:2e3})})},G=()=>{F.readonly||H("click",F.schedule)},M=(e="positive")=>{var l;if(!(null==(l=F.schedule)?void 0:l.cst))return;const s=F.schedule.cst.classroom_id,t=F.schedule.cst.subject_id,a=F.schedule.period_number||F.schedule.period,o=(new Date).toISOString().split("T")[0];H("open-reward",{classroomId:s,subjectId:t,period:a,date:o,schedule:F.schedule,initialTab:e})};return(l,i)=>{var O,N,F;return h(),u("div",{class:x(["timetable-cell",K.value]),onClick:G},[(null==(O=e.schedule)?void 0:O.cst_id)?(h(),u("div",T,[e.schedule.period_order?(h(),u("div",{key:0,class:"period-order-badge is-assigned",style:f({backgroundColor:E.value,color:J.value})},p(e.schedule.period_order),5)):m("",!0),_("div",{class:"subject-badge",style:f({backgroundColor:E.value,color:J.value}),title:L.value},p(e.showFullName?L.value:W.value),13,$),e.hideTeacher?m("",!0):(h(),u("div",{key:1,class:"teacher-name text-caption scale-75",title:R.value},[y(s,{name:"person",size:"xs",class:"q-mr-xs text-gray-500"}),b(" "+p(q.value),1)],8,z)),e.showClassroom?(h(),u("div",D,p(A.value),1)):m("",!0),_("div",B,[Q.value?(h(),v(s,{key:0,name:"warning",size:"sm",color:"red",class:"conflict-icon"},{default:g(()=>[y(t,{class:"bg-red text-white"},{default:g(()=>[b(p(U.value),1)]),_:1})]),_:1})):m("",!0),e.schedule.teacher_substitute_id?(h(),v(s,{key:1,name:"swap_horiz",size:"xs",color:"orange"},{default:g(()=>[y(t,null,{default:g(()=>i[2]||(i[2]=[b("Has substitute teacher")])),_:1})]),_:1})):m("",!0),e.schedule.co_teacher_id?(h(),v(s,{key:2,name:"group",size:"xs",color:"blue"},{default:g(()=>[y(t,null,{default:g(()=>i[3]||(i[3]=[b("Has co-teacher")])),_:1})]),_:1})):m("",!0)]),e.readonly?(h(),v(a,{key:3,round:"",dense:"",size:"xs",icon:"stars",color:e.rewardSystemDisabled?"grey":"amber",disable:e.rewardSystemDisabled,class:"reward-btn",onClick:k(M,["stop"])},{default:g(()=>[y(t,null,{default:g(()=>[b(p(e.rewardSystemDisabled?"Select Date & Week first":"Reward System"),1)]),_:1})]),_:1},8,["color","disable"])):m("",!0)])):(h(),u("div",j,[e.readonly?m("",!0):(h(),v(s,{key:0,name:"add",size:"sm",color:"grey-5"})),e.readonly?(h(),u("span",S,"-")):(h(),u("span",C,"Assign")),(null==(N=e.schedule)?void 0:N.period_order)?(h(),u("div",I,p(e.schedule.period_order),1)):m("",!0)])),(null==(F=e.schedule)?void 0:F.cst_id)&&!e.readonly?(h(),v(r,{key:2,"touch-position":"","context-menu":""},{default:g(()=>[y(d,{dense:"",style:{"min-width":"150px"}},{default:g(()=>[w((h(),v(o,{clickable:"",onClick:i[0]||(i[0]=s=>l.$emit("edit",e.schedule))},{default:g(()=>[y(c,{avatar:""},{default:g(()=>[y(s,{name:"edit"})]),_:1}),y(c,null,{default:g(()=>i[4]||(i[4]=[b("Edit")])),_:1})]),_:1})),[[n]]),w((h(),v(o,{clickable:"",onClick:V},{default:g(()=>[y(c,{avatar:""},{default:g(()=>[y(s,{name:"link",color:"primary"})]),_:1}),y(c,null,{default:g(()=>i[5]||(i[5]=[b("Link")])),_:1})]),_:1})),[[n]]),w((h(),v(o,{clickable:"",onClick:i[1]||(i[1]=s=>l.$emit("clear",e.schedule))},{default:g(()=>[y(c,{avatar:""},{default:g(()=>[y(s,{name:"clear",color:"negative"})]),_:1}),y(c,null,{default:g(()=>i[6]||(i[6]=[b("Clear")])),_:1})]),_:1})),[[n]])]),_:1})]),_:1})):m("",!0)],2)}}},[["__scopeId","data-v-e9f94536"]]);export{O as default};
