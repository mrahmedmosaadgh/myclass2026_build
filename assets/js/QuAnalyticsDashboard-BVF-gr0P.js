import{Q as e}from"./QSpace-qzKo_-If.js";import{p as t,u as a,q as l,Q as s,d as o,n as r,g as i,e as d,aD as c,C as n,b as u}from"./app-BzjXrVp9.js";import{Q as m}from"./QBadge-D2ciqrkO.js";import{Q as p}from"./QTd-DUSBgVC_.js";import{Q as f}from"./QTable-BcXT6C-J.js";import{Q as v,a as g}from"./QToolbar-BqA_2ejV.js";import{Q as x}from"./QSpinnerDots-CsCCDASU.js";import{f as b,a as _,L as y,I as h,b as w,M as q,y as j,a3 as A,J as Q,V as k,U as S,H as P,O as E,x as T,F as D,Z as V}from"./vendor-EI0FRBVb.js";import{s as L}from"./i18n-BbKXhR_S.js";import{u as M,E as C,i as z,a as R,b as B,c as O,d as U,e as F,f as G}from"./install-0O9Llvp6.js";import"./offline-BzIlwqNM.js";import"./ui-B__oX9pK.js";import"./QMarkupTable-_1wJRVO3.js";import"./QSelect-CciNNEfD.js";import"./rtl-Cr6c3OOr.js";import"./QLinearProgress-L5RdawR6.js";import"./use-fullscreen-BnDnBhbA.js";const I={class:"q-pa-md"},Z={class:"row items-center q-mb-md"},H={class:"row q-col-gutter-md q-mb-lg"},J={class:"col-12 col-sm-6 col-md-3"},$={class:"text-h4 text-weight-bold"},K={class:"col-12 col-sm-6 col-md-3"},N={class:"text-h4 text-weight-bold"},W={class:"col-12 col-sm-6 col-md-3"},X={class:"text-h4 text-weight-bold"},Y={class:"col-12 col-sm-6 col-md-3"},ee={class:"text-h4 text-weight-bold"},te={class:"text-caption q-ml-xs text-grey"},ae={class:"row justify-center q-py-xl"},le={class:"row q-col-gutter-md q-mb-lg"},se={class:"col-6 col-md-3"},oe={class:"text-h5 text-weight-bold"},re={class:"col-6 col-md-3"},ie={class:"text-h5 text-weight-bold text-primary"},de={class:"col-6 col-md-3"},ce={class:"text-h5 text-weight-bold text-indigo"},ne={class:"col-6 col-md-3"},ue={class:"text-h5 text-weight-bold text-green"},me={class:"row q-col-gutter-md"},pe={class:"col-12 col-md-6"},fe={class:"col-12 col-md-6"},ve={class:"q-mt-md"},ge={style:{"max-width":"400px","white-space":"normal",overflow:"hidden","text-overflow":"ellipsis"}},xe=t({__name:"QuAnalyticsDashboard",props:{exams:Array},setup(t){M([z,R,B,O,U,F,G]);const xe=t,be=a(),_e=b(""),ye=b(!1),he=b(null),we=b(!1),qe=b(null),je=_(()=>xe.exams.reduce((e,t)=>e+t.attempts_count,0)),Ae=_(()=>xe.exams.reduce((e,t)=>e+t.pending_grading,0)),Qe=_(()=>{const e=xe.exams.filter(e=>e.completed_attempts>0);if(0===e.length)return 0;const t=e.reduce((e,t)=>e+t.average_score/t.total_marks*100,0);return Math.round(t/e.length)}),ke=[{name:"title",required:!0,label:"Exam Title",align:"left",field:"title",sortable:!0},{name:"created_at",label:"Date",field:"created_at",sortable:!0},{name:"completed_attempts",label:"Attempts",field:"completed_attempts",sortable:!0},{name:"average_score",label:"Avg Score",field:"average_score",sortable:!0},{name:"pending_grading",label:"Pending Grading",field:"pending_grading",sortable:!0,classes:e=>e.pending_grading>0?"text-negative text-weight-bold":""},{name:"actions",label:"Actions",field:"actions",align:"right"}],Se=[{name:"text",label:"Question",field:"text",align:"left"},{name:"type",label:"Type",field:"type",align:"left"},{name:"bloom_level",label:"Bloom Level",field:"bloom_level",align:"left",sortable:!0},{name:"difficulty_label",label:"Difficulty",field:"difficulty_label",align:"left",sortable:!0}],Pe=(e,t)=>{const a=e/t*100;return a>=80?"green":a>=60?"blue":a>=40?"orange":"red"},Ee=()=>{be.notify({type:"info",message:"Export coming soon"})},Te=_(()=>{if(!qe.value)return{};const e=qe.value.score_distribution;return{tooltip:{trigger:"axis"},xAxis:{type:"category",data:Object.keys(e),name:"Score Range"},yAxis:{type:"value",name:"Students"},series:[{data:Object.values(e),type:"bar",color:"#3f51b5"}]}}),De=_(()=>{if(!qe.value)return{};const e=qe.value.bloom_stats;return{tooltip:{trigger:"axis"},xAxis:{type:"category",data:e.map(e=>e.level),axisLabel:{interval:0,rotate:30}},yAxis:{type:"value",name:"Avg Score %",max:100},series:[{data:e.map(e=>e.avg_percentage),type:"bar",color:"#ff9800",label:{show:!0,position:"top",formatter:"{c}%"}}]}});return(a,b)=>(h(),y(D,null,[w(j(A),{title:"Exam Analytics"}),q("div",I,[q("div",Z,[b[3]||(b[3]=q("div",{class:"text-h5"},"Exam Analytics",-1)),w(e),w(s,{color:"secondary",icon:"table_chart",label:"Export All",disable:"",outline:""},{default:Q(()=>[w(l,null,{default:Q(()=>b[2]||(b[2]=[k("Coming Soon")])),_:1})]),_:1})]),q("div",H,[q("div",J,[w(r,{class:"bg-primary text-white"},{default:Q(()=>[w(o,null,{default:Q(()=>[b[4]||(b[4]=q("div",{class:"text-subtitle2"},"Total Exams",-1)),q("div",$,S(t.exams.length),1)]),_:1})]),_:1})]),q("div",K,[w(r,{class:"bg-teal text-white"},{default:Q(()=>[w(o,null,{default:Q(()=>[b[5]||(b[5]=q("div",{class:"text-subtitle2"},"Total Attempts",-1)),q("div",N,S(je.value),1)]),_:1})]),_:1})]),q("div",W,[w(r,{class:"bg-orange text-white"},{default:Q(()=>[w(o,null,{default:Q(()=>[b[6]||(b[6]=q("div",{class:"text-subtitle2"},"Pending Grading",-1)),q("div",X,S(Ae.value),1)]),_:1})]),_:1})]),q("div",Y,[w(r,{class:"bg-indigo text-white"},{default:Q(()=>[w(o,null,{default:Q(()=>[b[7]||(b[7]=q("div",{class:"text-subtitle2"},"Avg Score",-1)),q("div",ee,S(Qe.value)+"%",1)]),_:1})]),_:1})])]),w(r,null,{default:Q(()=>[w(f,{title:"Exam Performance",rows:t.exams,columns:ke,"row-key":"id",filter:_e.value,pagination:{rowsPerPage:10}},{"top-right":Q(()=>[w(i,{borderless:"",dense:"",debounce:"300",modelValue:_e.value,"onUpdate:modelValue":b[0]||(b[0]=e=>_e.value=e),placeholder:"Search"},{append:Q(()=>[w(d,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-average_score":Q(e=>[w(p,{props:e},{default:Q(()=>[w(m,{color:Pe(e.value,e.row.total_marks)},{default:Q(()=>[k(S(e.value)+" / "+S(e.row.total_marks),1)]),_:2},1032,["color"]),q("span",te," ("+S(Math.round(e.value/e.row.total_marks*100))+"%) ",1)]),_:2},1032,["props"])]),"body-cell-actions":Q(e=>[w(p,{props:e,align:"right"},{default:Q(()=>[w(s,{flat:"",round:"",color:"primary",icon:"analytics",onClick:t=>(async e=>{he.value=e,ye.value=!0,we.value=!0,qe.value=null;try{const t=await V.get(L("qu-analytics.exam",e.id));qe.value=t.data}catch(t){console.error(t),be.notify({type:"negative",message:"Failed to load analytics data"})}finally{we.value=!1}})(e.row)},{default:Q(()=>[w(l,null,{default:Q(()=>b[8]||(b[8]=[k("View Detailed Analytics")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","filter"])]),_:1}),w(u,{modelValue:ye.value,"onUpdate:modelValue":b[1]||(b[1]=e=>ye.value=e),maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:Q(()=>[w(r,{class:"bg-grey-1"},{default:Q(()=>[w(v,{class:"bg-primary text-white"},{default:Q(()=>[T(w(s,{flat:"",round:"",dense:"",icon:"close"},null,512),[[c]]),w(g,null,{default:Q(()=>{var e;return[k(" Analytics: "+S(null==(e=he.value)?void 0:e.title),1)]}),_:1}),w(s,{flat:"",icon:"download",label:"Export Report",onClick:Ee,disable:""})]),_:1}),we.value?(h(),P(o,{key:0,class:"q-pa-md"},{default:Q(()=>[q("div",ae,[w(x,{color:"primary",size:"3em"}),b[9]||(b[9]=q("div",{class:"text-grey q-mt-md"},"Loading analytics data...",-1))])]),_:1})):qe.value?(h(),P(o,{key:1,class:"q-pa-md"},{default:Q(()=>[q("div",le,[q("div",se,[w(r,{flat:"",bordered:"",class:"text-center q-pa-sm"},{default:Q(()=>[b[10]||(b[10]=q("div",{class:"text-caption text-grey"},"Attempts",-1)),q("div",oe,S(qe.value.overview.total_attempts),1)]),_:1})]),q("div",re,[w(r,{flat:"",bordered:"",class:"text-center q-pa-sm"},{default:Q(()=>[b[11]||(b[11]=q("div",{class:"text-caption text-grey"},"Average Score",-1)),q("div",ie,S(qe.value.overview.avg_score),1)]),_:1})]),q("div",de,[w(r,{flat:"",bordered:"",class:"text-center q-pa-sm"},{default:Q(()=>[b[12]||(b[12]=q("div",{class:"text-caption text-grey"},"Median Score",-1)),q("div",ce,S(qe.value.overview.median_score),1)]),_:1})]),q("div",ne,[w(r,{flat:"",bordered:"",class:"text-center q-pa-sm"},{default:Q(()=>[b[13]||(b[13]=q("div",{class:"text-caption text-grey"},"Pass Rate",-1)),q("div",ue,S(qe.value.overview.pass_rate)+"%",1)]),_:1})])]),q("div",me,[q("div",pe,[w(r,{flat:"",bordered:"",class:"full-height"},{default:Q(()=>[w(o,null,{default:Q(()=>b[14]||(b[14]=[q("div",{class:"text-h6"},"Score Distribution",-1)])),_:1}),w(o,{style:{height:"300px"}},{default:Q(()=>[w(j(C),{class:"chart",option:Te.value,autoresize:""},null,8,["option"])]),_:1})]),_:1})]),q("div",fe,[w(r,{flat:"",bordered:"",class:"full-height"},{default:Q(()=>[w(o,null,{default:Q(()=>b[15]||(b[15]=[q("div",{class:"text-h6"},"Bloom's Taxonomy Performance",-1)])),_:1}),w(o,{style:{height:"300px"}},{default:Q(()=>[w(j(C),{class:"chart",option:De.value,autoresize:""},null,8,["option"])]),_:1})]),_:1})])]),q("div",ve,[w(r,{flat:"",bordered:""},{default:Q(()=>[w(o,null,{default:Q(()=>b[16]||(b[16]=[q("div",{class:"text-h6"},"Question Difficulty Analysis",-1)])),_:1}),w(f,{rows:qe.value.question_stats,columns:Se,"row-key":"id",pagination:{rowsPerPage:10},dense:""},{"body-cell-difficulty_label":Q(e=>[w(p,{props:e},{default:Q(()=>{return[w(n,{dense:"",color:(t=e.row.percentage_correct,t>=80?"green":t>=50?"orange":"red"),"text-color":"white"},{default:Q(()=>[k(S(e.value)+" ("+S(e.row.percentage_correct)+"%) ",1)]),_:2},1032,["color"])];var t}),_:2},1032,["props"])]),"body-cell-text":Q(e=>[w(p,{props:e},{default:Q(()=>[q("div",ge,S(e.value),1)]),_:2},1032,["props"])]),_:1},8,["rows"])]),_:1})])]),_:1})):E("",!0)]),_:1})]),_:1},8,["modelValue"])])],64))}},[["__scopeId","data-v-c8321de5"]]);export{xe as default};
