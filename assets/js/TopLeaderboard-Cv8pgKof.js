import{o as e,u as l,c as a,Q as t,p as o,m as r,A as s,k as n}from"./app-BB4Fw2oM.js";import{Q as d}from"./QSelect-BImwntZk.js";import i from"./html2canvas.esm-Cq3pa7K9.js";import{u as c}from"./i18n-DE5KxGn8.js";import u from"./CertificateGenerator-CYr2_LKB.js";import{f as v,a as p,o as f,k as b,M as m,Q as g,J as h,b as w,K as y,N as x,I as k,V as S,z as _,W as z,F as j,R as C,n as V,U as N}from"./vendor-DuKqz2x4.js";import"./offline-BzIlwqNM.js";import"./ui-BITzTqrO.js";import"./rtl-Cr6c3OOr.js";import"./QSpace-CfcdpSpD.js";import"./QBar-BiJGvmBl.js";import"./QSlider-efS6zDHu.js";import"./jspdf.es.min-BOiSIJXt.js";const U={key:0,class:"mb-6"},A={class:"text-4xl md:text-6xl font-black tracking-wider text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 via-yellow-100 to-yellow-500 drop-shadow-lg animate-shine"},L={class:"mt-4"},Q={class:"mt-6 flex flex-col md:flex-row items-center justify-center gap-4 px-4"},I={class:"text-sm text-yellow-200 mt-3 font-bold tracking-widest uppercase opacity-80"},T={key:0,class:"text-center py-16"},W={key:1,class:"flex flex-col md:flex-row justify-center items-end gap-6 md:gap-10 min-h-[580px]"},B={class:"text-center mb-6"},F={key:0,class:"text-9xl animate-bounce-slow drop-shadow-2xl"},O={key:1,class:"text-8xl drop-shadow-2xl"},R={class:"text-center pt-8 pb-4 relative z-10"},J={class:"text-4xl font-black italic tracking-wider text-white drop-shadow-2xl"},$={class:"px-4 pb-4 relative z-10"},E={class:"space-y-4"},M=["src"],P={class:"flex-1 min-w-0"},D={class:"font-black"},G={class:"shiny-name text-3xl md:text-4xl leading-tight block truncate"},K={class:"shiny-name-small block text-lg mt-1 opacity-95 truncate"},q={class:"text-yellow-300 font-bold text-lg mt-1"},H={class:"bg-gradient-to-b from-gray-800 to-gray-900 rounded-2xl p-6 border-2 border-gray-700"},X={class:"flex items-center justify-between mb-6 flex-wrap gap-3"},Y={class:"text-2xl font-bold text-yellow-400 text-center flex-1"},Z={class:"flex gap-2"},ee={class:"space-y-3"},le={class:"flex items-center gap-5"},ae={class:"flex-shrink-0 w-14 h-14 rounded-full bg-gradient-to-br from-yellow-500 to-orange-600 flex items-center justify-center border-4 border-yellow-300 shadow-lg"},te={class:"text-white font-black text-2xl"},oe={class:"flex-1 flex flex-wrap gap-4"},re=["src"],se={class:"font-bold text-lg"},ne={class:"shiny-name"},de={class:"shiny-name-small text-sm ml-1"},ie={class:"text-yellow-300 text-sm font-semibold"},ce=e({__name:"TopLeaderboard",props:{students:{type:Array,default:()=>[]},studentBehaviors:{type:Object,default:()=>({})},periodCode:{type:String,default:""},date:{type:String,default:""},schoolLogo:{type:String,default:null}},setup(e){const ce=l(),{t:ue}=c(),ve=e,pe=v({label:"Current Session",value:"session"}),fe=v(5),be=p(()=>[{label:ue("rewardSys.leaderboard.currentSession"),value:"session"},{label:ue("rewardSys.leaderboard.today"),value:"today"},{label:ue("rewardSys.leaderboard.thisWeek"),value:"week"},{label:ue("rewardSys.leaderboard.allTime"),value:"all"}]);f(()=>{const e=localStorage.getItem("leaderboard_preferences");if(e)try{const l=JSON.parse(e),a=be.find(e=>e.value===l.scope);a&&(pe.value=a),l.topCount&&(fe.value=l.topCount)}catch(l){console.error(l)}}),b([pe,fe],()=>{localStorage.setItem("leaderboard_preferences",JSON.stringify({scope:pe.value.value,topCount:fe.value}))},{deep:!0});const me=p(()=>{if(!ve.students.length)return[];const e=ve.students.map(e=>{const l=ve.studentBehaviors[e.id]||{},a=(l.points_plus||0)-(l.points_minus||0);return{...e,total:a}}).filter(e=>e.total>0).sort((e,l)=>l.total-e.total);if(!e.length)return[];const l=[];let a={rank:1,total:e[0].total,students:[e[0]]};for(let t=1;t<e.length;t++)e[t].total===a.total?a.students.push(e[t]):(l.push(a),a={rank:l.length+1,total:e[t].total,students:[e[t]]});return l.push(a),l.slice(0,fe.value)}),ge=p(()=>me.value.slice(0,3)),he=p(()=>me.value),we=p(()=>{const e=ge.value,l=e.find(e=>1===e.rank);return[e.find(e=>2===e.rank),l,e.find(e=>3===e.rank)].filter(Boolean)});function ye(){console.log("Filters applied")}function xe(){pe.value=be[0],fe.value=5}function ke(e){const l=["th","st","nd","rd"],a=e%100;return e+(l[(a-20)%10]||l[a]||l[0])}function Se(e){return 1===e?"bg-gradient-to-b from-yellow-400 via-yellow-500 to-yellow-700 border-yellow-300 shadow-yellow-500/70 ring-8 ring-yellow-400/40":2===e?"bg-gradient-to-b from-gray-300 via-gray-400 to-gray-600 border-gray-200 shadow-gray-500/50":3===e?"bg-gradient-to-b from-orange-400 via-orange-500 to-orange-700 border-orange-300 shadow-orange-500/50":""}const _e=v(null),ze=v(!1);function je(){ze.value=!0,V(()=>{const e=_e.value;return e?document.contains(e)?void i(e).then(e=>{const l=e.toDataURL("image/png");navigator.canShare&&navigator.canShare({files:[]})?fetch(l).then(e=>e.blob()).then(e=>{const l=new File([e],"leaderboard.png",{type:"image/png"});return navigator.share({files:[l],title:"Leaderboard"})}).then(()=>{ce.notify({message:"Shared successfully!",color:"positive"})}).catch(()=>{Ce(l)}):Ce(l)}).catch(e=>{console.error(e),ce.notify({message:"Screenshot failed",color:"negative"})}).finally(()=>{ze.value=!1}):(ce.notify({message:"Element not available for screenshot",color:"negative"}),void(ze.value=!1)):(ce.notify({message:"Leaderboard element not found",color:"negative"}),void(ze.value=!1))})}function Ce(e){const l=document.createElement("a");l.href=e,l.download="leaderboard.png",l.click(),ce.notify({message:"Screenshot downloaded â€“ share on WhatsApp!",color:"positive",icon:"download"})}function Ve(e="S"){const l=e.split(" ").map(e=>e[0]).slice(0,2).join("").toUpperCase();return`data:image/svg+xml,${encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="140" height="140"><rect width="140" height="140" fill="#1e293b"/><text x="70" y="70" dy="12" text-anchor="middle" font-size="60" font-family="Arial" font-weight="bold" fill="#cbd5e1">${l}</text></svg>`)}`}const Ne=v(new Set),Ue=p(()=>me.value.flatMap(e=>e.students));function Ae(){Ne.value.size===Ue.value.length?Ne.value.clear():Ne.value=new Set(Ue.value.map(e=>e.id))}const Le=v(!1),Qe=v(null),Ie=v([]);function Te(e){Qe.value=e,Ie.value=[],Le.value=!0}function We(){Ne.value.size>0?Ie.value=Ue.value.filter(e=>Ne.value.has(e.id)):Ie.value=Ue.value,Qe.value=null,Le.value=!0}return(l,i)=>e.students.length?(h(),m("div",U,[w(r,{class:"shadow-2xl rounded-3xl overflow-hidden bg-gray-900 border-4 border-yellow-500 relative"},{default:y(()=>[i[7]||(i[7]=x("div",{class:"absolute inset-0 overflow-hidden pointer-events-none"},[x("div",{class:"stars"}),x("div",{class:"twinkling"})],-1)),w(a,{class:"relative z-10 text-center py-6 bg-gradient-to-b from-transparent to-black/50"},{default:y(()=>[x("h1",A," ðŸ† "+S(_(ue)("rewardSys.leaderboard.champions"))+" ðŸ† ",1),x("div",L,[w(t,{color:"yellow-7",icon:"print",label:Ne.value.size>0?_(ue)("rewardSys.leaderboard.printSelected",{count:Ne.value.size,plural:Ne.value.size>1?"s":""}):_(ue)("rewardSys.leaderboard.printAllCertificates"),size:"lg",class:"text-lg font-bold shadow-2xl px-8 py-3",onClick:We,disable:0===Ue.value.length},{default:y(()=>[w(o,null,{default:y(()=>[z(S(_(ue)("rewardSys.leaderboard.generateFor",{target:Ne.value.size>0?_(ue)("rewardSys.leaderboard.selectedStudents"):_(ue)("rewardSys.leaderboard.allChampions")})),1)]),_:1})]),_:1},8,["label","disable"])]),x("div",Q,[w(d,{modelValue:pe.value,"onUpdate:modelValue":[i[0]||(i[0]=e=>pe.value=e),ye],options:be.value,outlined:"",dense:"",dark:"",label:_(ue)("rewardSys.leaderboard.filterScope"),class:"w-full md:w-48 bg-black/30"},null,8,["modelValue","options","label"]),w(d,{modelValue:fe.value,"onUpdate:modelValue":[i[1]||(i[1]=e=>fe.value=e),ye],options:[{label:"Top 5",value:5},{label:"Top 10",value:10}],outlined:"",dense:"",dark:"",label:_(ue)("rewardSys.leaderboard.showPlaces"),class:"w-full md:w-32 bg-black/30","emit-value":"","map-options":""},null,8,["modelValue","label"]),w(t,{color:"yellow-7",icon:"refresh",label:_(ue)("rewardSys.leaderboard.reset"),onClick:xe,size:"md",class:"w-full md:w-auto"},null,8,["label"])]),x("p",I,S(pe.value.label)+" â€¢ "+S(_(ue)("rewardSys.leaderboard.topN",{n:fe.value})),1)]),_:1}),w(a,{class:"p-4 md:p-8 relative z-10"},{default:y(()=>[0===ge.value.length?(h(),m("div",T,i[3]||(i[3]=[x("p",{class:"text-3xl text-yellow-400 font-bold animate-pulse"},"The arena is empty... Who will rise? âš”ï¸",-1)]))):(h(),m("div",W,[(h(!0),m(j,null,C(we.value,(e,l)=>{return h(),m(j,{key:(null==e?void 0:e.rank)||l},[e?(h(),m("div",{key:0,class:N(["w-full md:w-1/3 flex flex-col transition-all duration-700 podium-card",[1===e.rank?"order-2 md:mb-32 z-30":2===e.rank?"order-1 md:mb-12 z-20":"order-3 z-20"]])},[x("div",B,[1===e.rank?(h(),m("div",F,"ðŸ‘‘")):(h(),m("div",O,S((a=e.rank,1===a?"ðŸ¥‡":2===a?"ðŸ¥ˆ":3===a?"ðŸ¥‰":"")),1))]),x("div",{class:N(["relative rounded-3xl overflow-hidden border-4 shadow-2xl backdrop-blur-xl flex flex-col mx-4 pb-6",Se(e.rank)])},[i[6]||(i[6]=x("div",{class:"absolute inset-0 bg-gradient-to-tr from-white/0 via-white/30 to-white/0 w-[200%] h-full animate-shine-move pointer-events-none"},null,-1)),x("div",R,[x("h2",J,S(ke(e.rank)),1),i[4]||(i[4]=x("div",{class:"h-1 w-32 mx-auto bg-white/40 rounded-full mt-3"},null,-1))]),x("div",$,[x("div",E,[(h(!0),m(j,null,C(e.students,e=>(h(),m("div",{key:e.id,class:"bg-black/70 rounded-2xl p-4 backdrop-blur-md border border-white/20 shadow-xl hover:border-yellow-400/50 transition-all flex items-center gap-4"},[w(s,{size:"80px",class:"ring-4 ring-yellow-400/60 shadow-xl border-2 flex-shrink-0"},{default:y(()=>[x("img",{src:e.avatar||Ve(e.name),class:"object-cover"},null,8,M)]),_:2},1024),x("div",P,[x("div",D,[x("span",G,S(e.firstName),1),x("span",K,S(e.lastName),1)]),x("div",q,S(e.total)+" pts",1)]),w(t,{flat:"",round:"",color:"white",icon:"card_membership",onClick:l=>Te(e)},{default:y(()=>[w(o,null,{default:y(()=>i[5]||(i[5]=[z("Print Certificate")])),_:1})]),_:2},1032,["onClick"])]))),128))])])],2)],2)):g("",!0)],64);var a}),128))]))]),_:1}),he.value.length>0?(h(),k(a,{key:0,ref_key:"leaderboardList",ref:_e,class:"p-4 md:p-8 pt-0 relative z-10"},{default:y(()=>[x("div",H,[x("div",X,[x("h3",Y,"ðŸ† "+S(_(ue)("rewardSys.leaderboard.completeLeaderboard"))+" ðŸ†",1),x("div",Z,[w(t,{outline:"",dense:"",color:"yellow-500",icon:Ne.value.size===Ue.value.length?"check_box":"check_box_outline_blank",label:Ne.value.size===Ue.value.length?_(ue)("rewardSys.leaderboard.deselectAll"):_(ue)("rewardSys.leaderboard.selectAll"),onClick:Ae,size:"sm"},null,8,["icon","label"]),w(t,{color:"green",icon:"screenshot",label:_(ue)("rewardSys.leaderboard.share"),onClick:je,loading:ze.value,class:"shadow-lg"},{default:y(()=>[w(o,null,{default:y(()=>[z(S(_(ue)("rewardSys.leaderboard.shareOnWhatsApp")),1)]),_:1})]),_:1},8,["label","loading"])])]),x("div",ee,[(h(!0),m(j,null,C(he.value,e=>(h(),m("div",{key:e.rank,class:"bg-gradient-to-r from-gray-700 to-gray-800 rounded-xl p-5 border border-gray-600 hover:border-yellow-500 hover:shadow-yellow-500/30 transition-all duration-300"},[x("div",le,[x("div",ae,[x("span",te,S(e.rank),1)]),x("div",oe,[(h(!0),m(j,null,C(e.students,e=>(h(),m("div",{key:e.id,class:"flex items-center gap-3 bg-black/50 rounded-lg px-4 py-3 backdrop-blur-sm"},[w(n,{"model-value":Ne.value.has(e.id),"onUpdate:modelValue":l=>function(e){Ne.value.has(e.id)?Ne.value.delete(e.id):Ne.value.add(e.id),Ne.value=new Set(Ne.value)}(e),color:"yellow-500",dark:""},null,8,["model-value","onUpdate:modelValue"]),w(s,{size:"48px",class:"border-2 border-yellow-500/40"},{default:y(()=>[x("img",{src:e.avatar||Ve(e.name)},null,8,re)]),_:2},1024),x("div",null,[x("div",se,[x("span",ne,S(e.firstName),1),x("span",de,S(e.lastName),1)]),x("div",ie,S(e.total)+" pts",1)]),w(t,{flat:"",round:"",dense:"",color:"yellow-500",icon:"card_membership",onClick:l=>Te(e)},{default:y(()=>[w(o,null,{default:y(()=>[z(S(_(ue)("rewardSys.leaderboard.printCertificate")),1)]),_:1})]),_:2},1032,["onClick"])]))),128))])])]))),128))])])]),_:1},512)):g("",!0),w(u,{modelValue:Le.value,"onUpdate:modelValue":i[2]||(i[2]=e=>Le.value=e),student:Qe.value,students:Ie.value,"default-date":e.date,"school-logo":e.schoolLogo},null,8,["modelValue","student","students","default-date","school-logo"])]),_:1})])):g("",!0)}},[["__scopeId","data-v-1eacee4b"]]);export{ce as default};
