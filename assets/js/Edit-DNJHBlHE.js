import{_ as e}from"./AppLayout-33RltWFH.js";import s from"./WeekNavigator-dOzaGdod.js";import a from"./SessionCard-LGKTxacP.js";import l from"./SessionModal-B9LKMIVy.js";import{af as n,I as t,J as o,K as i,O as r,b as d,N as c,V as u,Q as v,f as m,o as g,k as y,_ as p,a as w,$ as k}from"./vendor-nQjeLEvd.js";import{d as h}from"./vuedraggable.umd-C4qRof-w.js";import{o as x}from"./app-C-WHvmzS.js";import"./index-DTdDyFNb.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";const f={class:"flex justify-between items-center"},S={key:0,class:"text-sm text-gray-600 mt-1"},_={class:"flex space-x-2"},b={class:"py-12"},C={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},j={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-6 mb-6"},E={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-6"},W={class:"flex justify-between items-center mb-6"},D={class:"text-lg font-medium text-gray-900"},B={key:0,class:"space-y-4"},P={key:1,class:"text-center py-12"},A={class:"col"},Q={class:"text-h6 text-grey-8"},$={class:"text-caption text-grey-6"},N={class:"full-height overflow-auto"},V={class:"mt-6 bg-white overflow-hidden shadow-xl sm:rounded-lg p-6"},z={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},I={class:"text-center"},q={class:"text-2xl font-bold text-blue-600"},M={class:"text-center"},T={class:"text-2xl font-bold text-green-600"},L={class:"text-center"},F={class:"text-2xl font-bold text-yellow-600"},O={class:"text-center"},R={class:"text-2xl font-bold text-red-600"};const U=x({components:{AppLayout:e,WeekNavigator:s,SessionCard:a,SessionModal:l,draggable:h},props:{weeklyPlanId:{type:[String,Number],required:!0}},setup(e){const s=m(!1),a=m(!1),l=m(null),n=m([]),t=m(null),o=m(!1),i=m(1),r=m({}),d=m(!1);g(async()=>{await c()}),y(i,async e=>{await u()});const c=async()=>{s.value=!0;try{const s=await p.get(`/api/weeklyplansystem/headers/${e.weeklyPlanId}`);l.value=s.data,i.value=s.data.week_number,await u()}catch(a){console.error("Error loading weekly plan:",a)}finally{s.value=!1}},u=async e=>{if(l.value)try{const e=await p.get("/api/weeklyplansystem/sessions",{params:{weekly_plan_id:l.value.id}});n.value=e.data.sort((e,s)=>e.session_index-s.session_index)}catch(s){console.error("Error loading sessions:",s),n.value=[]}},v=async e=>{try{if(e.id){const s=await p.put(`/api/weeklyplansystem/sessions/${e.id}`,e),a=n.value.findIndex(s=>s.id===e.id);-1!==a&&(n.value[a]=s.data)}else{const s=await p.post("/api/weeklyplansystem/sessions",e);n.value.push(s.data),n.value.sort((e,s)=>e.session_index-s.session_index)}t.value=null,o.value=!1}catch(s){console.error("Error saving session:",s)}},h=async()=>{a.value=!0;try{t.value&&o.value&&await v(t.value),console.log("All changes saved successfully")}catch(e){console.error("Error saving changes:",e)}finally{a.value=!1}},x=()=>`${l.value.academic_year_id.toString().slice(-2)}.${l.value.semester_number}.${l.value.week_number}.${n.value.length+1}`,f=w(()=>n.value.filter(e=>{var s;return null==(s=e.data)?void 0:s.completed}).length);return{loading:s,saving:a,weeklyPlan:l,sessions:n,selectedSession:t,isEditing:o,currentWeek:i,weekStatus:r,showSessionDrawer:d,changeWeek:async e=>{await h();try{const s=await p.get("/api/weeklyplansystem/headers",{params:{cst_id:l.value.cst_id,academic_year_id:l.value.academic_year_id,semester_number:l.value.semester_number,week_number:e}});s.data.length>0&&k.visit(`/weekly-plans/${s.data[0].id}/edit`)}catch(s){console.error("Error changing week:",s)}},addNewSession:()=>{const e={id:null,weekly_plan_id:l.value.id,session_index:n.value.length+1,period_code:x(),type:"lesson",title:`Session ${n.value.length+1}`,data:{}};t.value=e,o.value=!0,d.value=!0},editSession:e=>{t.value={...e},o.value=!0,d.value=!0},saveSession:v,deleteSession:async e=>{var s;if(confirm("Are you sure you want to delete this session?"))try{await p.delete(`/api/weeklyplansystem/sessions/${e.id}`),n.value=n.value.filter(s=>s.id!==e.id),(null==(s=t.value)?void 0:s.id)===e.id&&(t.value=null,o.value=!1)}catch(a){console.error("Error deleting session:",a)}},duplicateSession:e=>{const s={...e,id:null,session_index:n.value.length+1,title:`${e.title} (Copy)`,period_code:x()};t.value=s,o.value=!0,d.value=!0},handleSessionReorder:async()=>{n.value.forEach((e,s)=>{e.session_index=s+1});try{await p.post("/api/weeklyplansystem/sessions/reorder",{weekly_plan_id:l.value.id,sessions:n.value.map(e=>({id:e.id,session_index:e.session_index}))})}catch(e){console.error("Error reordering sessions:",e)}},cancelEdit:()=>{t.value=null,o.value=!1},closeSessionDetails:()=>{t.value=null,o.value=!1},closeSessionDrawer:()=>{t.value=null,o.value=!1,d.value=!1},saveAllChanges:h,goBack:()=>{k.visit("/weekly-plans")},getSessionsByType:e=>n.value.filter(s=>s.type===e),completedSessions:f}}},[["render",function(e,s,a,l,m,g){const y=n("WeekNavigator"),p=n("SessionCard"),w=n("draggable"),k=n("SessionModal"),h=n("AppLayout");return o(),t(h,{title:"Weekly Plan Editor"},{header:i(()=>{var e,a,n,t;return[r("div",f,[r("div",null,[s[2]||(s[2]=r("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Weekly Plan Editor ",-1)),l.weeklyPlan?(o(),c("p",S,u(null==(a=null==(e=l.weeklyPlan.classroom_subject_teacher)?void 0:e.classroom)?void 0:a.name)+" - "+u(null==(t=null==(n=l.weeklyPlan.classroom_subject_teacher)?void 0:n.subject)?void 0:t.name)+" - Week "+u(l.weeklyPlan.week_number),1)):v("",!0)]),r("div",_,[d(QBtn,{outline:"",color:"grey",icon:"arrow_back",label:"Back to Overview",onClick:l.goBack},null,8,["onClick"]),d(QBtn,{color:"primary",icon:"save",label:"Save All Changes",onClick:l.saveAllChanges,loading:l.saving},null,8,["onClick","loading"])])])]}),default:i(()=>[r("div",b,[r("div",C,[r("div",j,[d(y,{"current-week":l.currentWeek,"total-weeks":18,"week-status":l.weekStatus,onWeekChanged:l.changeWeek},null,8,["current-week","week-status","onWeekChanged"])]),r("div",E,[r("div",W,[r("h3",D," Week "+u(l.currentWeek)+" Sessions ",1),d(QBtn,{color:"primary",icon:"add",label:"Add Session",onClick:l.addNewSession,size:"sm"},null,8,["onClick"])]),l.sessions.length>0?(o(),c("div",B,[d(w,{modelValue:l.sessions,"onUpdate:modelValue":s[0]||(s[0]=e=>l.sessions=e),group:"sessions","item-key":"id",animation:200,onChange:l.handleSessionReorder,handle:".drag-handle"},{item:i(({element:e,index:s})=>[d(p,{session:e,index:s+1,onEdit:l.editSession,onDelete:l.deleteSession,onDuplicate:l.duplicateSession},null,8,["session","index","onEdit","onDelete","onDuplicate"])]),_:1},8,["modelValue","onChange"])])):(o(),c("div",P,[s[3]||(s[3]=r("div",{class:"text-gray-400 mb-4"},[r("svg",{class:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})])],-1)),s[4]||(s[4]=r("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No Sessions Planned",-1)),s[5]||(s[5]=r("p",{class:"text-gray-600 mb-4"},"Add your first session to get started with this week's plan.",-1)),d(QBtn,{color:"primary",icon:"add",label:"Add First Session",onClick:l.addNewSession},null,8,["onClick"])]))]),d(QDialog,{modelValue:l.showSessionDrawer,"onUpdate:modelValue":s[1]||(s[1]=e=>l.showSessionDrawer=e),maximized:"","transition-show":"slide-left","transition-hide":"slide-right",class:"session-dialog"},{default:i(()=>[d(QCard,{class:"session-dialog-card"},{default:i(()=>[d(QCardSection,{class:"row items-center q-pb-none bg-grey-1"},{default:i(()=>{var e,s,a,n,t,o,i;return[r("div",A,[r("div",Q,u((null==(e=l.selectedSession)?void 0:e.id)?"Edit Session":"New Session"),1),r("div",$," Week "+u(l.currentWeek)+" - "+u(null==(n=null==(a=null==(s=l.weeklyPlan)?void 0:s.classroom_subject_teacher)?void 0:a.classroom)?void 0:n.name)+" - "+u(null==(i=null==(o=null==(t=l.weeklyPlan)?void 0:t.classroom_subject_teacher)?void 0:o.subject)?void 0:i.name),1)]),d(QBtn,{flat:"",round:"",dense:"",icon:"close",color:"grey-7",onClick:l.closeSessionDrawer},null,8,["onClick"])]}),_:1}),d(QCardSection,{class:"q-pa-none full-height"},{default:i(()=>[r("div",N,[d(k,{session:l.selectedSession,"is-editing":l.isEditing,"is-drawer":!0,onSave:l.saveSession,onCancel:l.cancelEdit,onClose:l.closeSessionDrawer},null,8,["session","is-editing","onSave","onCancel","onClose"])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),r("div",V,[s[10]||(s[10]=r("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Week Summary",-1)),r("div",z,[r("div",I,[r("div",q,u(l.sessions.length),1),s[6]||(s[6]=r("div",{class:"text-sm text-gray-600"},"Total Sessions",-1))]),r("div",M,[r("div",T,u(l.completedSessions),1),s[7]||(s[7]=r("div",{class:"text-sm text-gray-600"},"Completed",-1))]),r("div",L,[r("div",F,u(l.getSessionsByType("quiz").length),1),s[8]||(s[8]=r("div",{class:"text-sm text-gray-600"},"Quizzes",-1))]),r("div",O,[r("div",R,u(l.getSessionsByType("exam").length),1),s[9]||(s[9]=r("div",{class:"text-sm text-gray-600"},"Exams",-1))])])])])])]),_:1})}],["__scopeId","data-v-f83b55c7"]]);export{U as default};
