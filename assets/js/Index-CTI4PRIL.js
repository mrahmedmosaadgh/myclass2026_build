import{o as e,bk as a,Q as l,B as s,g as t,j as o,R as r,i as n,d as i,h as u,a as d,m as c,c as m,f as p,b as v,l as f,aP as k,A as h}from"./app-ggGwxJON.js";import{Q as g,a as _}from"./QToolbar-DMbCF1rG.js";import{Q as b}from"./QTab-Dz6RnWyq.js";import{Q as y}from"./QTabs-DMYUh0Ok.js";import{Q as w}from"./QHeader-QSVvjn9L.js";import{Q as T}from"./QDrawer-DFCooEAP.js";import{Q as j}from"./QPage-B1Nl3adk.js";import{Q as V}from"./QPageContainer-CznOqmtM.js";import{Q as C}from"./QLayout-D3qfTWrb.js";import A from"./MainTaskList-Mk6FGtnC.js";import S from"./TaskForm-kC0n5HKb.js";import Q from"./MultiTaskForm-BNtWKYvs.js";import D from"./PomodoroTimer-n2bPFuLT.js";import x from"./FocusMode-D3Hg_HfL.js";import U from"./copy_data_to_table-DLZ_a7xQ.js";import{f as M,a as E,o as F,af as L,N as q,J as I,b as P,K as R,I as O,Q as N,O as $,W as H,F as K,R as W,y as B,V as J,a2 as G}from"./vendor-nQjeLEvd.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";import"./rtl-Cr6c3OOr.js";import"./QBadge-DVUbh_5M.js";import"./TaskTree-DAIUnGv3.js";import"./QTree-B7OzcW8x.js";import"./DraggableTaskItem-gPPgWNNp.js";import"./QSelect-DOo83gJW.js";import"./QDate-BszpW1a3.js";import"./use-render-cache-CmTcazfP.js";import"./use-datetime-BAXS8q9i.js";import"./date-C_NgUKAH.js";import"./QPopupProxy-B_TgS9uL.js";import"./QForm-BTggRcrz.js";import"./QSpace-DKhB4IlP.js";import"./QCircularProgress-RDu5MLfe.js";const z={class:"ticktick-container"},X={class:"q-pa-md"},Y={class:"row q-mb-md"},Z={class:"col-12"},ee={class:"row items-center q-col-gutter-md"},ae={class:"col-12 col-md-6"},le={class:"col-12 col-md-6 flex justify-end"},se={class:"q-ml-sm"},te=e({__name:"Index",props:{tasks:Array,classifications:Array},setup(e){const te=e,oe=a(),re=M(!1),ne=M("all"),ie=M(!1),ue=M(!1),de=M(!1),ce=M(!1),me=M(!1),pe=M(!1),ve=M(!1),fe=M(""),ke=M(""),he=M(null),ge=M(null),_e=M(null),be=M(null),ye=M(Array.isArray(te.tasks)?te.tasks:[]);console.log("Initial tasks:",te.tasks);const we=M([]),Te=M(null);M("tree");const je=M(!1),Ve=M([]),Ce=M(!1),Ae=E(()=>ye.value&&Array.isArray(ye.value)?ye.value.filter(e=>!e.parent_id):(console.warn("parentTaskOptions: allTasks.value is not an array:",ye.value),[])),Se=E(()=>{if(!ye.value||!Array.isArray(ye.value))return console.warn("filteredTasks: allTasks.value is not an array:",ye.value),[];let e=[...ye.value];if("today"===ne.value){const a=(new Date).toISOString().split("T")[0];e=e.filter(e=>e.due_date&&e.due_date.startsWith(a))}else if("upcoming"===ne.value){const a=(new Date).toISOString().split("T")[0];e=e.filter(e=>e.due_date&&e.due_date>a)}else"completed"===ne.value&&(e=e.filter(e=>e.completed_at));if(Te.value&&(e=e.filter(e=>e.classification===Te.value)),fe.value){const a=fe.value.toLowerCase();e=e.filter(e=>e.title.toLowerCase().includes(a)||e.description&&e.description.toLowerCase().includes(a))}return e}),Qe=E(()=>{let e=[...Se.value];if(ke.value){const a=ke.value.toLowerCase(),l=e=>{const s=e.title.toLowerCase().includes(a)||e.description&&e.description.toLowerCase().includes(a);let t=!1;return e.children&&Array.isArray(e.children)&&e.children.length>0&&(t=e.children.some(e=>l(e))),s||t};e=e.filter(e=>l(e))}return e}),De=(e=null)=>{he.value=e?{...e}:{title:"",description:"",parent_id:null,classification:null,due_date:null},ie.value=!0},xe=e=>{he.value={title:"",description:"",parent_id:e.id,classification:e.classification||"new",due_date:null},ie.value=!0},Ue=e=>{const a=e.id?`/developer/tasks/${e.id}`:"/developer/tasks",l=e.id?"put":"post";oe.fetchData({endpoint:a,method:l,data:e,onSuccess:e=>{ie.value=!1,e.tasks?(ye.value=e.tasks,console.log("Updated tasks from server:",e.tasks)):Ie()}})},Me=e=>{oe.fetchData({endpoint:`/developer/tasks/${e.id}/toggle-complete`,method:"post",onSuccess:e=>{Ie()}})},Ee=e=>{ge.value=e,me.value=!0},Fe=()=>{ge.value&&oe.fetchData({endpoint:`/developer/tasks/${ge.value.id}`,method:"delete",onSuccess:e=>{Ie()}})},Le=e=>{qe(e),oe.fetchData({endpoint:"/developer/tasks/reorder",method:"post",data:{tasks:e},onSuccess:e=>{e&&e.tasks?(console.log("Received updated tasks from server:",e.tasks),ye.value=e.tasks):(console.warn("No tasks received in response from server, refreshing tasks"),Ie())},onError:e=>{console.error("Error reordering tasks:",e),Ie()},errorMessage:"Failed to save task order"})},qe=e=>{if(!e||!Array.isArray(e)||0===e.length)return;const a=new Map,l=e=>{e.forEach(e=>{a.set(e.id,e),e.children&&Array.isArray(e.children)&&e.children.length>0&&l(e.children)})};l(ye.value),e.forEach(e=>{const l=a.get(e.id);l&&(l.position=e.position,l.parent_id=e.parent_id,e.children&&Array.isArray(e.children)&&(l.children=e.children))});const s=Array.from(a.values()).filter(e=>!e.parent_id);s.sort((e,a)=>e.position-a.position),ye.value=s},Ie=()=>{oe.fetchData({endpoint:"/developer/tasks",method:"get",onSuccess:e=>{e&&e.tasks?(console.log("Refreshed tasks from server:",e.tasks),ye.value=e.tasks):console.warn("No tasks received in response from server during refresh")},onError:e=>{console.error("Error refreshing tasks:",e)},errorMessage:"Failed to refresh tasks"})},Pe=()=>{de.value=!1},Re=e=>{let a=0;for(let s=0;s<e.length;s++)a=e.charCodeAt(s)+((a<<5)-a);const l=["red","pink","purple","deep-purple","indigo","blue","light-blue","cyan","teal","green","light-green","lime","yellow","amber","orange","deep-orange","brown","grey","blue-grey"];return l[Math.abs(a)%l.length]},Oe=e=>{if(!e)return"";return new Date(e).toLocaleDateString()},Ne=e=>{e&&Array.isArray(e)&&0!==e.length&&oe.fetchData({endpoint:"/developer/tasks/batch",method:"post",data:{tasks:e},onSuccess:e=>{e&&e.tasks?ye.value=e.tasks:Ie()},errorMessage:"Failed to add tasks"})},$e=()=>{Ce.value=!Ce.value,Ce.value||(Ve.value=[])},He=e=>{if(!Ce.value)return;const a=Ve.value.findIndex(a=>a.id===e.id);-1===a?Ve.value.push(e):Ve.value.splice(a,1)},Ke=()=>{0!==Ve.value.length&&(pe.value=!0)},We=()=>{if(0===Ve.value.length)return;const e=Ve.value.map(e=>e.id);oe.fetchData({endpoint:"/developer/tasks/bulk-delete",method:"post",data:{task_ids:e},onSuccess:()=>{Ve.value=[],Ce.value=!1,Ie()},errorMessage:"Failed to delete tasks"})},Be=()=>{oe.fetchData({endpoint:"/developer/pomodoro/recent",method:"get",onSuccess:e=>{we.value=e.sessions}})},Je=(e,a)=>{console.log("Index.vue: Entering Focus Mode"),console.log("Task:",e),console.log("Session:",a),_e.value=e,be.value=a,ve.value=!0,ce.value=!1},Ge=()=>{ve.value=!1,be.value=null},ze=()=>{},Xe=()=>{je.value=!je.value};return F(()=>{Be()}),(a,M)=>{const E=L("Head");return I(),q("div",z,[P(E,{title:"TickTick Tasks"}),P(U),P(C,{view:"hHh LpR fFf",class:"bg-grey-1"},{default:R(()=>[P(w,{elevated:"",class:"bg-primary text-white"},{default:R(()=>[P(g,null,{default:R(()=>[P(l,{flat:"",round:"",dense:"",icon:"menu",onClick:M[0]||(M[0]=e=>re.value=!re.value)}),P(_,null,{default:R(()=>M[20]||(M[20]=[$("div",{class:"text-h6"},"TickTick Tasks",-1)])),_:1}),P(l,{flat:"",round:"",dense:"",icon:"search",onClick:M[1]||(M[1]=e=>de.value=!0)}),P(l,{flat:"",round:"",dense:"",icon:"timer",onClick:M[2]||(M[2]=e=>ce.value=!0)}),P(l,{flat:"",round:"",dense:"",icon:"settings"})]),_:1}),P(y,{modelValue:ne.value,"onUpdate:modelValue":M[3]||(M[3]=e=>ne.value=e),align:"left",class:"bg-primary text-white"},{default:R(()=>[P(b,{name:"all",icon:"list",label:"All Tasks"}),P(b,{name:"today",icon:"today",label:"Today"}),P(b,{name:"upcoming",icon:"event",label:"Upcoming"}),P(b,{name:"completed",icon:"check_circle",label:"Completed"})]),_:1},8,["modelValue"])]),_:1}),P(T,{modelValue:re.value,"onUpdate:modelValue":M[4]||(M[4]=e=>re.value=e),bordered:"",width:280,breakpoint:500,class:"bg-white"},{default:R(()=>[P(s,{class:"fit"},{default:R(()=>[P(t,{padding:""},{default:R(()=>[P(o,{header:""},{default:R(()=>M[21]||(M[21]=[H("Classifications")])),_:1}),(I(!0),q(K,null,W(e.classifications,e=>B((I(),O(u,{key:e,clickable:"",onClick:a=>(e=>{Te.value=e,re.value=!1})(e)},{default:R(()=>[P(n,{avatar:""},{default:R(()=>[P(i,{name:"label",color:Re(e)},null,8,["color"])]),_:2},1024),P(n,null,{default:R(()=>[H(J(e),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[r]])),128)),P(d,{spaced:""}),P(o,{header:""},{default:R(()=>M[22]||(M[22]=[H("Recent Pomodoro Sessions")])),_:1}),(I(!0),q(K,null,W(we.value,(e,a)=>B((I(),O(u,{key:a,clickable:""},{default:R(()=>[P(n,{avatar:""},{default:R(()=>[P(i,{name:"work"===e.type?"work":"break_time",color:"work"===e.type?"red":"green"},null,8,["name","color"])]),_:2},1024),P(n,null,{default:R(()=>[P(o,null,{default:R(()=>[H(J(e.task?e.task.title:"No task"),1)]),_:2},1024),P(o,{caption:""},{default:R(()=>[H(J(Oe(e.started_at))+" - "+J(e.duration)+"min",1)]),_:2},1024)]),_:2},1024)]),_:2},1024)),[[r]])),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]),P(V,null,{default:R(()=>[P(j,{padding:""},{default:R(()=>[$("div",X,[$("div",Y,[$("div",Z,[P(l,{color:"primary",icon:"add",label:"Add Task",onClick:M[5]||(M[5]=e=>De())}),P(l,{color:"primary",icon:"add_box",label:"Add Multiple",onClick:M[6]||(M[6]=e=>ue.value=!0),class:"q-ml-sm"}),P(l,{color:"secondary",icon:"search",label:"Search",onClick:M[7]||(M[7]=e=>de.value=!0),class:"q-ml-sm"}),P(l,{color:Ce.value?"negative":"grey",icon:Ce.value?"close":"select_all",label:Ce.value?"Cancel Selection":"Select Tasks",onClick:$e,class:"q-ml-sm"},null,8,["color","icon","label"]),Ce.value&&Ve.value.length>0?(I(),O(l,{key:0,color:"negative",icon:"delete",label:`Delete (${Ve.value.length})`,onClick:Ke,class:"q-ml-sm"},null,8,["label"])):N("",!0)])]),P(c,{flat:"",bordered:""},{default:R(()=>[P(m,{class:"q-pb-none"},{default:R(()=>[$("div",ee,[$("div",ae,[P(p,{modelValue:ke.value,"onUpdate:modelValue":[M[8]||(M[8]=e=>ke.value=e),ze],dense:"",outlined:"",placeholder:"Search tasks by title or description",clearable:""},{append:R(()=>[P(i,{name:"search"})]),_:1},8,["modelValue"])]),$("div",le,[P(l,{label:je.value?"Collapse All":"Expand All",icon:je.value?"unfold_less":"unfold_more",color:"primary",flat:"",onClick:Xe},null,8,["label","icon"])])])]),_:1}),P(m,null,{default:R(()=>[P(A,{tasks:Qe.value,"selection-mode":Ce.value,"selected-tasks":Ve.value,onToggleComplete:Me,onEditTask:De,onDeleteTask:Ee,onReorderTasks:Le,onAddSubtask:xe,onToggleSelection:He},null,8,["tasks","selection-mode","selected-tasks"])]),_:1})]),_:1})])]),_:1})]),_:1}),P(v,{modelValue:ie.value,"onUpdate:modelValue":M[10]||(M[10]=e=>ie.value=e),persistent:""},{default:R(()=>[P(S,{task:he.value,"parent-tasks":Ae.value,classifications:e.classifications,onSave:Ue,onCancel:M[9]||(M[9]=e=>ie.value=!1)},null,8,["task","parent-tasks","classifications"])]),_:1},8,["modelValue"]),P(v,{modelValue:ue.value,"onUpdate:modelValue":M[13]||(M[13]=e=>ue.value=e),persistent:""},{default:R(()=>[P(Q,{modelValue:ue.value,"onUpdate:modelValue":M[11]||(M[11]=e=>ue.value=e),"parent-task":he.value,"classification-options":e.classifications,"onUpdate:isOpen":M[12]||(M[12]=e=>ue.value=e),onAddTasks:Ne},null,8,["modelValue","parent-task","classification-options"])]),_:1},8,["modelValue"]),P(v,{modelValue:de.value,"onUpdate:modelValue":M[15]||(M[15]=e=>de.value=e)},{default:R(()=>[P(c,{style:{width:"500px","max-width":"80vw"}},{default:R(()=>[P(m,null,{default:R(()=>M[23]||(M[23]=[$("div",{class:"text-h6"},"Search Tasks",-1)])),_:1}),P(m,null,{default:R(()=>[P(p,{modelValue:fe.value,"onUpdate:modelValue":M[14]||(M[14]=e=>fe.value=e),label:"Search",autofocus:"",onKeyup:G(Pe,["enter"])},{append:R(()=>[P(i,{name:"search"})]),_:1},8,["modelValue"])]),_:1}),P(f,{align:"right"},{default:R(()=>[B(P(l,{flat:"",label:"Cancel",color:"primary"},null,512),[[k]]),B(P(l,{flat:"",label:"Search",color:"primary",onClick:Pe},null,512),[[k]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),P(v,{modelValue:ce.value,"onUpdate:modelValue":M[17]||(M[17]=e=>ce.value=e),persistent:""},{default:R(()=>[P(D,{tasks:ye.value,onClose:M[16]||(M[16]=e=>ce.value=!1),onSessionCompleted:Be,onEnterFocusMode:Je},null,8,["tasks"])]),_:1},8,["modelValue"]),ve.value?(I(),O(x,{key:0,task:_e.value,"pomodoro-session":be.value,onExit:Ge},null,8,["task","pomodoro-session"])):N("",!0),P(v,{modelValue:me.value,"onUpdate:modelValue":M[18]||(M[18]=e=>me.value=e)},{default:R(()=>[P(c,null,{default:R(()=>[P(m,{class:"row items-center"},{default:R(()=>[P(h,{icon:"delete",color:"negative","text-color":"white"}),M[24]||(M[24]=$("span",{class:"q-ml-sm"},"Are you sure you want to delete this task?",-1))]),_:1}),P(f,{align:"right"},{default:R(()=>[B(P(l,{flat:"",label:"Cancel",color:"primary"},null,512),[[k]]),B(P(l,{flat:"",label:"Delete",color:"negative",onClick:Fe},null,512),[[k]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),P(v,{modelValue:pe.value,"onUpdate:modelValue":M[19]||(M[19]=e=>pe.value=e)},{default:R(()=>[P(c,null,{default:R(()=>[P(m,{class:"row items-center"},{default:R(()=>[P(h,{icon:"delete",color:"negative","text-color":"white"}),$("span",se,"Delete "+J(Ve.value.length)+" tasks?",1)]),_:1}),P(m,null,{default:R(()=>M[25]||(M[25]=[H(" Are you sure you want to delete the selected tasks? This action cannot be undone. ")])),_:1}),P(f,{align:"right"},{default:R(()=>[B(P(l,{flat:"",label:"Cancel",color:"primary"},null,512),[[k]]),B(P(l,{flat:"",label:"Delete",color:"negative",onClick:We},null,512),[[k]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}},[["__scopeId","data-v-e704b06b"]]);export{te as default};
