import{Q as e}from"./QTab-BJCUrT4L.js";import{Q as a}from"./QTabs-4quOvtr1.js";import{p as l,a as t,Q as r,q as n,g as s,aD as o,n as i,d as c,m as u,b as d}from"./app-Dccx8xF5.js";import{Q as m}from"./QTabPanel-QxVdoii7.js";import{Q as p}from"./QTabPanels-DiqDdK2g.js";import{k as v}from"./katex-BXKQVcz-.js";import{f as b,a as f,L as g,I as x,M as y,b as $,J as h,F as w,Q as _,V as q,U as k,x as V,a1 as C,n as S}from"./vendor-EI0FRBVb.js";import"./rtl-Cr6c3OOr.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./ui-B__oX9pK.js";import"./use-panel-DP2_LoYb.js";import"./use-render-cache-CmTcazfP.js";const T={class:"math-editor q-pa-md",style:{"min-width":"700px","max-width":"95vw"}},E={class:"row q-col-gutter-md"},j={class:"col-12 col-md-7"},M={class:"flex gap-2 flex-wrap justify-center"},P=["innerHTML"],U={class:"flex gap-2 flex-wrap justify-center"},L=["innerHTML"],I={class:"column q-gutter-sm"},Q={class:"row justify-between items-center"},z={class:"row q-gutter-sm"},F={class:"row q-gutter-sm justify-center q-mt-md"},A={class:"col-12 col-md-5 column"},D={class:"preview-box border rounded p-4 bg-grey-1 flex items-center justify-center col-grow relative-position",style:{"min-height":"150px"}},H=["innerHTML"],N={key:1,class:"text-grey-5"},B={class:"row justify-end q-mt-md gap-2"},O={class:"text-h6"},R=l({__name:"MathEditor",emits:["insert"],setup(l,{emit:R}){const K=R,J=b(""),X=b(null),Z=b("basic"),G=b(!1),W=b(null),Y=b([]),ee=b(""),ae=b(""),le=b(""),te=[{name:"Fraction",template:"\\frac{{0}}{{1}}",vars:["Numerator","Denominator"],label:"\\frac{a}{b}"},{name:"Square Root",template:"\\sqrt{{0}}",vars:["Value"],label:"\\sqrt{x}"},{name:"Power",template:"{{0}}^{{1}}",vars:["Base","Exponent"],label:"x^2"},{name:"Subscript",template:"{{0}}_{{1}}",vars:["Base","Subscript"],label:"x_1"},{name:"Mixed Number",template:"{{0}}\\:\\frac{{1}}{{2}}",vars:["Whole","Numerator","Denominator"],label:"1\\:\\frac{1}{2}"},{name:"Multiplication",latex:"\\times"},{name:"Division",latex:"\\div"},{name:"Plus/Minus",latex:"\\pm"},{name:"Parentheses",template:"({{0}})",vars:["Content"],label:"(x)"}],re=[{name:"Infinity",latex:"\\infty"},{name:"Pi",latex:"\\pi"},{name:"Alpha",latex:"\\alpha"},{name:"Beta",latex:"\\beta"},{name:"Theta",latex:"\\theta"},{name:"Delta",latex:"\\Delta"},{name:"Less/Equal",latex:"\\leq"},{name:"Greater/Equal",latex:"\\geq"},{name:"Not Equal",latex:"\\neq"},{name:"Approx",latex:"\\approx"},{name:"Sum",template:"\\sum_{{0}}^{{1}}",vars:["From","To"],label:"\\sum"},{name:"Integral",template:"\\int_{{0}}^{{1}}",vars:["Lower","Upper"],label:"\\int"},{name:"Square Root N",template:"\\sqrt[{0}]{{1}}",vars:["Degree","Value"],label:"\\sqrt[n]{x}"}],ne=e=>{if(!e)return"";const a=/\$\$([\s\S]*?)\$\$|\$([\s\S]*?)\$/g;let l,t=0,r="",n=!1;for(;null!==(l=a.exec(e));){n=!0;const o=e.slice(t,l.index);r+=se(o).replace(/\n/g,"<br>").replace(/&lt;(\/?(strong|em|b|i|u|code))&gt;/g,"<$1>");const i=l[1],c=l[2];try{i?r+=v.renderToString(i,{throwOnError:!1,displayMode:!0}):c&&(r+=v.renderToString(c,{throwOnError:!1,displayMode:!1}))}catch(s){r+=`<span class="text-red-500">Error: ${s.message}</span>`}t=a.lastIndex}if(r+=se(e.slice(t)).replace(/\n/g,"<br>").replace(/&lt;(\/?(strong|em|b|i|u|code))&gt;/g,"<$1>"),!n&&e.trim().length>0)try{return v.renderToString(e,{throwOnError:!1,displayMode:!0})}catch(s){return se(e).replace(/\n/g,"<br>").replace(/&lt;(\/?(strong|em|b|i|u|code))&gt;/g,"<$1>")}return r},se=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),oe=f(()=>ne(J.value)),ie=e=>{try{return v.renderToString(e,{throwOnError:!1,displayMode:!1})}catch(a){return console.error("Error rendering math:",a),se(e)}},ce=()=>{const e=ne(J.value);K("insert",e+"&nbsp;"),J.value=""},ue=()=>{J.value=ee.value,Z.value="basic",ee.value=""},de=async()=>{try{const e=await navigator.clipboard.readText();ee.value=e}catch(e){console.error("Failed to read clipboard contents: ",e)}},me=()=>{if(!ee.value)return;const e=/\$\$([\s\S]*?)\$\$|\$([\s\S]*?)\$/g;let a,l=0,t="";const r=ee.value;for(;null!==(a=e.exec(r));){const n=r.slice(l,a.index);t+=ve(n),t+=a[0],l=e.lastIndex}t+=ve(r.slice(l)),ee.value=t},pe=async()=>{try{let e=await navigator.clipboard.readText();e=ve(e),e=e.replace(/(\((?:[^)(]+|\((?:[^)(]+|\([^)(]*\))*\))*\))/g,e=>/[\^_{}\\]/.test(e)||/[+\-*/=].*[+\-*/=]/.test(e)?`$${e}$`:e),e=e.replace(/(\\[a-zA-Z]+(?:\{.*?\})*)/g,e=>`$${e}$`),e=e.replace(/\$\$+/g,"$"),e=e.replace(/\$\$\$/g,"$$$"),ee.value=e}catch(e){console.error("Failed to paste and fix: ",e)}},ve=e=>{let a=e;return a=a.replace(/^([A-Z0-9]+\.)\s+([(\d\\].*)$/gm,"$1 $$$2$$"),a=a.replace(/(\*\*|__)(.*?)\1/g,"<strong>$2</strong>").replace(/(\*|_)(.*?)\1/g,"<em>$2</em>").replace(/^#+\s+(.*)$/gm,"<strong>$1</strong>").replace(/`([^`]+)`/g,"<code>$1</code>"),a},be=()=>{var e;const a=null==(e=X.value)?void 0:e.$el.querySelector("textarea");if(a){const e=a.selectionStart,l=a.selectionEnd,t=J.value,r=t.substring(0,e),n=t.substring(l);J.value=r+"\n"+n,S(()=>{a.focus();const l=e+1;a.selectionStart=a.selectionEnd=l})}else J.value+="\n"},fe=()=>{var e;const a=null==(e=X.value)?void 0:e.$el.querySelector("textarea");if(a){const e=a.selectionEnd,l=J.value,t=l.substring(0,e),r=l.substring(e);J.value=t+"\n"+r,S(()=>{a.focus();const l=e+1;a.selectionStart=a.selectionEnd=l})}else J.value+="\n"},ge=e=>{var a;if(e.vars){W.value=e,Y.value=new Array(e.vars.length).fill("");const l=null==(a=X.value)?void 0:a.$el.querySelector("textarea");if(l){const e=l.selectionStart,a=l.selectionEnd;if(e!==a){const l=J.value.substring(e,a);Y.value[0]=l}}G.value=!0}else ye(e.latex||e.template)},xe=()=>{if(!W.value)return;let e=W.value.template;W.value.vars.forEach((a,l)=>{e=e.replace(`{{${l}}}`,Y.value[l]||"")}),ye(e),G.value=!1},ye=e=>{var a;const l=null==(a=X.value)?void 0:a.$el.querySelector("textarea");if(l){const a=l.selectionStart,t=l.selectionEnd,r=J.value,n=r.substring(0,a),s=r.substring(t);J.value=n+e+s,S(()=>{l.focus(),l.selectionStart=l.selectionEnd=a+e.length})}else J.value+=e};return(l,v)=>(x(),g("div",T,[v[14]||(v[14]=y("div",{class:"text-h6 q-mb-md"},"Insert Math Equation",-1)),y("div",E,[y("div",j,[$(a,{modelValue:Z.value,"onUpdate:modelValue":v[0]||(v[0]=e=>Z.value=e),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:h(()=>[$(e,{name:"basic",label:"Basic"}),$(e,{name:"advanced",label:"Advanced"}),$(e,{name:"preview",label:"Text Preview"})]),_:1},8,["modelValue"]),$(t),$(p,{modelValue:Z.value,"onUpdate:modelValue":v[4]||(v[4]=e=>Z.value=e),animated:"",class:"bg-grey-1",style:{height:"250px","overflow-y":"auto"}},{default:h(()=>[$(m,{name:"basic",class:"q-pa-sm"},{default:h(()=>[y("div",M,[(x(),g(w,null,_(te,e=>$(r,{key:e.name,outline:"",color:"primary",size:"md",class:"math-btn bg-white",onClick:a=>ge(e)},{default:h(()=>[y("span",{innerHTML:ie(e.label||e.latex)},null,8,P),$(n,null,{default:h(()=>[q(k(e.name),1)]),_:2},1024)]),_:2},1032,["onClick"])),64))])]),_:1}),$(m,{name:"advanced",class:"q-pa-sm"},{default:h(()=>[y("div",U,[(x(),g(w,null,_(re,e=>$(r,{key:e.name,outline:"",color:"primary",size:"md",class:"math-btn bg-white",onClick:a=>ge(e)},{default:h(()=>[y("span",{innerHTML:ie(e.label||e.latex)},null,8,L),$(n,null,{default:h(()=>[q(k(e.name),1)]),_:2},1024)]),_:2},1032,["onClick"])),64))])]),_:1}),$(m,{name:"preview",class:"q-pa-sm"},{default:h(()=>[y("div",I,[y("div",Q,[v[10]||(v[10]=y("div",{class:"text-caption text-grey"},"Paste text with LaTeX (e.g., Problem: $\\frac{1}{2}$)",-1)),$(r,{flat:"",dense:"",color:"primary",icon:"content_paste",label:"Paste from Clipboard",size:"sm",onClick:de}),$(r,{flat:"",dense:"",color:"secondary",icon:"auto_fix_high",label:"Fix Markdown",size:"sm",onClick:me},{default:h(()=>[$(n,null,{default:h(()=>v[8]||(v[8]=[q("Convert **bold** to \\textbf{bold}, *italic* to \\textit{italic}")])),_:1})]),_:1}),$(r,{flat:"",dense:"",color:"accent",icon:"content_paste_go",label:"Paste & Fix",size:"sm",onClick:pe},{default:h(()=>[$(n,null,{default:h(()=>v[9]||(v[9]=[q("Paste from clipboard and auto-format math and lists")])),_:1})]),_:1})]),$(s,{modelValue:ee.value,"onUpdate:modelValue":v[1]||(v[1]=e=>ee.value=e),filled:"",type:"textarea",rows:"3",placeholder:"Paste your text here...",class:"text-sm"},null,8,["modelValue"]),y("div",z,[$(s,{modelValue:ae.value,"onUpdate:modelValue":v[2]||(v[2]=e=>ae.value=e),dense:"",outlined:"",placeholder:"Find",class:"col",style:{"font-size":"12px"}},null,8,["modelValue"]),$(s,{modelValue:le.value,"onUpdate:modelValue":v[3]||(v[3]=e=>le.value=e),dense:"",outlined:"",placeholder:"Replace with",class:"col"},null,8,["modelValue"])]),$(r,{unelevated:"",color:"primary",label:"Use This Text",size:"sm",onClick:ue,disable:!ee.value},null,8,["disable"])])]),_:1})]),_:1},8,["modelValue"]),y("div",F,[$(r,{flat:"",dense:"",color:"grey-8",icon:"space_bar",label:"Space",onClick:v[5]||(v[5]=e=>{ye("\\;")})}),$(r,{flat:"",dense:"",color:"grey-8",icon:"backspace",label:"Backspace",onClick:l.backspace},null,8,["onClick"]),$(r,{flat:"",dense:"",color:"negative",icon:"delete",label:"Clear",onClick:l.clear},null,8,["onClick"]),$(r,{flat:"",dense:"",color:"primary",label:"Replace",onClick:be}),$(r,{flat:"",dense:"",color:"primary",label:"Add",onClick:fe})])]),y("div",A,[v[11]||(v[11]=y("div",{class:"text-subtitle2 q-mb-xs text-grey-7"},"LaTeX Code",-1)),$(s,{modelValue:J.value,"onUpdate:modelValue":v[6]||(v[6]=e=>J.value=e),filled:"",type:"textarea",rows:"3",ref_key:"inputRef",ref:X,class:"q-mb-md","input-class":"font-mono text-sm",hint:"Use $...$ for inline math, e.g., Problem: $\\frac{1}{2}$"},null,8,["modelValue"]),v[12]||(v[12]=y("div",{class:"text-subtitle2 q-mb-xs text-grey-7"},"Preview",-1)),y("div",D,[J.value?(x(),g("div",{key:0,innerHTML:oe.value,class:"text-h5 text-center"},null,8,H)):(x(),g("div",N,"Preview"))]),y("div",B,[V($(r,{flat:"",label:"Cancel",color:"grey"},null,512),[[o]]),$(r,{unelevated:"",label:"Insert Equation",color:"primary",onClick:ce,disable:!J.value},null,8,["disable"])])])]),$(d,{modelValue:G.value,"onUpdate:modelValue":v[7]||(v[7]=e=>G.value=e),persistent:""},{default:h(()=>[$(i,{style:{"min-width":"350px"}},{default:h(()=>[$(c,null,{default:h(()=>{var e;return[y("div",O,k(null==(e=W.value)?void 0:e.name),1),v[13]||(v[13]=y("div",{class:"text-caption text-grey"},"Enter values for the variables",-1))]}),_:1}),$(c,{class:"q-pt-none"},{default:h(()=>{var e;return[(x(!0),g(w,null,_(null==(e=W.value)?void 0:e.vars,(e,a)=>(x(),g("div",{key:a,class:"q-mb-md"},[$(s,{modelValue:Y.value[a],"onUpdate:modelValue":e=>Y.value[a]=e,filled:"",dense:"",autofocus:0===a,onKeyup:C(e=>a===W.value.vars.length-1?xe():null,["enter"])},null,8,["modelValue","onUpdate:modelValue","autofocus","onKeyup"])]))),128))]}),_:1}),$(u,{align:"right"},{default:h(()=>[V($(r,{flat:"",label:"Cancel",color:"grey"},null,512),[[o]]),$(r,{flat:"",label:"Insert",color:"primary",onClick:xe})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-52b317f8"]]);export{R as default};
