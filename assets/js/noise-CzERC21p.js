import{r as e}from"./app-Dtv5Fi9L.js";import{f as a,a as t,e as n,N as s,J as l,R as o,O as i,S as r,V as u,U as c}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";const v={class:"bar-container"},d={class:"meter-info"},m={class:"status-text"},f={class:"db-text"},h={key:0,class:"warning-flasher"},p=e({__name:"noise",setup(e){const p=a(!1),M=a(-100),g=a(50);let w=null,y=null,b=null,x=null;const A=t(()=>Math.max(20,Math.round(M.value+70))),k=t(()=>p.value&&A.value>g.value),C=t(()=>k.value?"#ff3b30":A.value>g.value-5?"#ffcc00":"#34c759"),j=t(()=>{const e=(A.value-20)/90*100;return Math.max(0,Math.min(100,e))}),S=t(()=>{const e=(g.value-20)/90*100;return Math.max(0,Math.min(100,e))}),_=()=>{p.value=!1,x&&cancelAnimationFrame(x),b&&(b.disconnect(),b=null),w&&(w.close(),w=null)},q=()=>{p.value?_():(async()=>{try{w=new(window.AudioContext||window.webkitAudioContext),y=w.createAnalyser(),y.fftSize=512,y.smoothingTimeConstant=.8;const e=await navigator.mediaDevices.getUserMedia({audio:!0});b=w.createMediaStreamSource(e),b.connect(y),p.value=!0,B()}catch(e){console.error("Microphone access denied or error:",e),listenError.value=!0}})()},B=()=>{if(!y||!p.value)return;const e=y.frequencyBinCount,a=new Uint8Array(e);y.getByteTimeDomainData(a);let t=0;for(let s=0;s<e;s++){const e=(a[s]-128)/128;t+=e*e}const n=Math.sqrt(t/e);M.value=n>0?20*Math.log10(n):-100,x=requestAnimationFrame(B)};return n(()=>_()),(e,a)=>(l(),s("div",{class:c(["noise-meter-simple",{"is-listening":p.value}]),onClick:q},[o("div",v,[a[0]||(a[0]=o("div",{class:"bar-track"},null,-1)),o("div",{class:"bar-fill",style:r({height:j.value+"%",backgroundColor:C.value})},null,4),o("div",{class:"threshold-marker",style:r({bottom:S.value+"%"})},null,4)]),o("div",d,[o("div",m,u(p.value?"Listening...":"Paused"),1),o("div",f,u(p.value?Math.round(A.value):"--")+" dBA",1)]),k.value?(l(),s("div",h)):i("",!0)],2))}},[["__scopeId","data-v-fe1d0c12"]]);export{p as default};
