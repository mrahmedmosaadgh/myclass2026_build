import{Q as e}from"./QSpinnerDots-L0wFsY2y.js";import{o as l,u as a,c as s,d as t,m as i,Q as o,C as r,l as n,b as c,g as d,h as u,i as m,j as v,bb as p,aP as y}from"./app-BB4Fw2oM.js";import{Q as g}from"./QCircularProgress-C8N_Ornf.js";import{Q as b}from"./QBadge-BkpTfeZ_.js";import{Q as f}from"./QTd-By_JVJWe.js";import{Q as _}from"./QTable-_oeeTwa9.js";import{u as h}from"./i18n-DE5KxGn8.js";import{f as k,a as w,k as x,o as P,M as j,J as Q,b as q,N as C,I as z,Q as N,K as I,V as S,z as E,F as M,R as $,W as A,y as D,_ as V}from"./vendor-DuKqz2x4.js";import{u as W}from"./useWeeklyPlansStore-D6CrqLN3.js";import"./offline-BzIlwqNM.js";import"./ui-BITzTqrO.js";import"./QMarkupTable-DlrrqBMs.js";import"./QSelect-BImwntZk.js";import"./rtl-Cr6c3OOr.js";import"./QLinearProgress-BvcJ9Hu7.js";import"./use-fullscreen-DtPjMCV2.js";import"./schoolData-BRFwL7u7.js";const B={class:"sync-dashboard q-pa-md"},F={key:0,class:"flex flex-center q-pa-xl"},T={key:1},U={class:"row q-col-gutter-md q-mb-lg"},Y={class:"col-12 col-sm-6 col-md-3"},J={class:"stat-icon bg-blue-1 text-blue"},K={class:"stat-value text-h4"},L={class:"stat-label text-grey-7"},R={class:"col-12 col-sm-6 col-md-3"},G={class:"stat-icon bg-green-1 text-green"},H={class:"stat-value text-h4 text-positive"},O={class:"stat-label text-grey-7"},X={class:"col-12 col-sm-6 col-md-3"},Z={class:"stat-icon bg-orange-1 text-orange"},ee={class:"stat-value text-h4 text-warning"},le={class:"stat-label text-grey-7"},ae={class:"col-12 col-sm-6 col-md-3"},se={class:"stat-icon bg-purple-1 text-purple"},te={class:"stat-value text-h4 text-primary"},ie={class:"stat-label text-grey-7"},oe={class:"row q-mb-lg"},re={class:"col-12"},ne={class:"row q-col-gutter-md"},ce={class:"row items-center q-mb-md"},de={class:"col"},ue={class:"text-h6"},me={class:"text-caption text-grey-7"},ve={class:"col-auto"},pe={class:"text-caption"},ye={key:0,class:"text-warning"},ge={class:"text-h6"},be={class:"text-caption text-grey-7"},fe={class:"text-h6 text-grey-7 q-mt-md"},_e={class:"text-grey-6"},he=l({__name:"WeeklyPlanSyncDashboard",setup(l){const{t:he}=h(),ke=W(),we=a(),xe=k(!1),Pe=k(!1),je=k(null),Qe=k(!1),qe=k([]),Ce=k([]),ze=k("all"),Ne=w(()=>"ar"===he("code")?"right":"left"),Ie=w(()=>[{name:"day",label:he("weeklyPlans.day"),field:"day",align:Ne.value,sortable:!0},{name:"period",label:he("weeklyPlans.period"),field:"period",align:"center",sortable:!0},{name:"subject",label:he("weeklyPlans.subject"),field:"subject",align:Ne.value,sortable:!0},{name:"teacher",label:he("weeklyPlans.teacher"),field:"teacher",align:Ne.value,sortable:!0},{name:"status",label:he("weeklyPlans.status"),field:"status",align:"center"}]),Se=async()=>{if(ke.selectedCopyId){xe.value=!0;try{const e=await V.get("/weekly-system/api/sync-analysis",{params:{copy_id:ke.selectedCopyId,week_number:ke.weekNumber,academic_year_id:ke.selectedAcademicYearId,semester_number:ke.semesterNumber}});je.value=e.data}catch(e){console.error("Error fetching sync analysis:",e),we.notify({type:"negative",message:"Failed to load sync analysis"})}finally{xe.value=!1}}},Ee=()=>{var e;ze.value="all",qe.value=[],(null==(e=je.value)?void 0:e.classrooms)&&je.value.classrooms.forEach(e=>{e.days&&e.days.forEach(l=>{var a;(null==(a=l.missing_periods)?void 0:a.length)>0&&l.missing_periods.forEach(a=>{qe.value.push({id:a.id,day:l.day,period:a.period,subject:a.subject,teacher:a.teacher,status:"missing",classroom_name:e.name})})})}),Ce.value=[...qe.value],Qe.value=!0},Me=()=>{var e,l;if("all"===ze.value)return"All Classrooms";const a=null==(l=null==(e=je.value)?void 0:e.classrooms)?void 0:l.find(e=>e.id===ze.value);return a?`Classroom ${a.name}`:""},$e=async()=>{var e,l;Pe.value=!0;try{const e=Ce.value.map(e=>e.id),l=await V.post("/weekly-system/api/weekly-plans/batch-create",{schedule_ids:e,week_number:ke.weekNumber,academic_year_id:ke.selectedAcademicYearId,semester_number:ke.semesterNumber});we.notify({type:"positive",message:l.data.message||`Created ${e.length} weekly plans`}),Qe.value=!1,await Se()}catch(a){console.error(a),we.notify({type:"negative",message:(null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||"Failed to create plans"})}finally{Pe.value=!1}};return x(()=>[ke.selectedCopyId,ke.weekNumber,ke.semesterNumber],()=>{Se()},{deep:!0}),P(()=>{Se()}),(l,a)=>{var h,k,w,x,P;return Q(),j("div",B,[xe.value?(Q(),j("div",F,[q(e,{size:"50px",color:"primary"})])):(Q(),j("div",T,[C("div",U,[C("div",Y,[q(i,{flat:"",bordered:"",class:"stat-card"},{default:I(()=>[q(s,null,{default:I(()=>{var e,l;return[C("div",J,[q(t,{name:"grid_on",size:"32px"})]),C("div",K,S((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.total_slots)||0),1),C("div",L,S(E(he)("weeklyPlans.totalSlots")),1)]}),_:1})]),_:1})]),C("div",R,[q(i,{flat:"",bordered:"",class:"stat-card"},{default:I(()=>[q(s,null,{default:I(()=>{var e,l;return[C("div",G,[q(t,{name:"check_circle",size:"32px"})]),C("div",H,S((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.complete)||0),1),C("div",O,S(E(he)("weeklyPlans.completed")),1)]}),_:1})]),_:1})]),C("div",X,[q(i,{flat:"",bordered:"",class:"stat-card"},{default:I(()=>[q(s,null,{default:I(()=>{var e,l;return[C("div",Z,[q(t,{name:"error",size:"32px"})]),C("div",ee,S((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.missing)||0),1),C("div",le,S(E(he)("weeklyPlans.missing")),1)]}),_:1})]),_:1})]),C("div",ae,[q(i,{flat:"",bordered:"",class:"stat-card"},{default:I(()=>[q(s,null,{default:I(()=>{var e,l;return[C("div",se,[q(t,{name:"trending_up",size:"32px"})]),C("div",te,S((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.percentage)||0)+"%",1),C("div",ie,S(E(he)("weeklyPlans.progress")),1)]}),_:1})]),_:1})])]),C("div",oe,[C("div",re,[(null==(k=null==(h=je.value)?void 0:h.summary)?void 0:k.missing)>0?(Q(),z(o,{key:0,color:"primary",icon:"sync",label:E(he)("weeklyPlans.syncAll"),loading:Pe.value,onClick:Ee,unelevated:"",size:"lg"},null,8,["label","loading"])):N("",!0)])]),C("div",ne,[(Q(!0),j(M,null,$(null==(w=je.value)?void 0:w.classrooms,e=>(Q(),j("div",{key:e.id,class:"col-12 col-md-6 col-lg-4"},[q(i,{flat:"",bordered:"",class:"classroom-card"},{default:I(()=>[q(s,null,{default:I(()=>{var l,a;return[C("div",ce,[C("div",de,[C("div",ue,S(e.name),1),C("div",me,S(e.complete)+"/"+S(e.total_slots)+" slots complete ",1)]),C("div",ve,[q(g,{value:e.percentage,size:"80px",thickness:.15,color:(a=e.percentage,a>=80?"positive":a>=50?"warning":"negative"),"track-color":"grey-3","show-value":""},{default:I(()=>[C("div",pe,S(e.percentage)+"%",1)]),_:2},1032,["value","color"])])]),(null==(l=e.days)?void 0:l.length)?(Q(),z(p,{key:0,icon:"calendar_today",label:E(he)("weeklyPlans.viewByDay"),dense:"","header-class":"text-primary"},{default:I(()=>[q(d,{dense:"",separator:""},{default:I(()=>[(Q(!0),j(M,null,$(e.days,e=>(Q(),z(u,{key:e.day_number},{default:I(()=>[q(m,null,{default:I(()=>[q(v,null,{default:I(()=>[A(S(e.day),1)]),_:2},1024),q(v,{caption:""},{default:I(()=>[A(S(e.complete)+"/"+S(e.total)+" complete ",1),e.missing>0?(Q(),j("span",ye," (Missing: P"+S(e.missing_periods.join(", P"))+") ",1)):N("",!0)]),_:2},1024)]),_:2},1024),q(m,{side:""},{default:I(()=>[q(b,{color:e.missing>0?"warning":"positive",label:e.missing>0?`${e.missing} missing`:"Complete"},null,8,["color","label"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["label"])):N("",!0),e.missing>0?(Q(),z(o,{key:1,color:"primary",icon:"sync",label:`${E(he)("weeklyPlans.syncWeeklyPlans")} (${e.missing})`,onClick:l=>(e=>{var l,a;ze.value=e,qe.value=[];const s=null==(a=null==(l=je.value)?void 0:l.classrooms)?void 0:a.find(l=>l.id===e);s&&s.days&&s.days.forEach(e=>{var l;(null==(l=e.missing_periods)?void 0:l.length)>0&&e.missing_periods.forEach(l=>{qe.value.push({id:l.id,day:e.day,period:l.period,subject:l.subject,teacher:l.teacher,status:"missing",classroom_name:s.name})})}),Ce.value=[...qe.value],Qe.value=!0})(e.id),outline:"",class:"full-width q-mt-md",size:"sm"},null,8,["label","onClick"])):N("",!0)]}),_:2},1024)]),_:2},1024)]))),128))]),q(c,{modelValue:Qe.value,"onUpdate:modelValue":a[1]||(a[1]=e=>Qe.value=e),"full-width":""},{default:I(()=>[q(i,null,{default:I(()=>[q(s,null,{default:I(()=>[C("div",ge,S(E(he)("weeklyPlans.syncPreview"))+" - "+S(Me()),1),C("div",be,S(E(he)("weeklyPlans.selectMissingPlans")),1)]),_:1}),q(s,{class:"q-pa-none"},{default:I(()=>[q(_,{rows:qe.value,columns:Ie.value,"row-key":"id",selection:"multiple",selected:Ce.value,"onUpdate:selected":a[0]||(a[0]=e=>Ce.value=e),flat:"",bordered:"",pagination:{rowsPerPage:0},"virtual-scroll":"",style:{height:"400px"}},{"body-cell-status":I(e=>[q(f,{props:e},{default:I(()=>[q(r,{color:"negative","text-color":"white",size:"sm",icon:"warning"},{default:I(()=>a[2]||(a[2]=[A(" Missing ")])),_:1})]),_:2},1032,["props"])]),_:1},8,["rows","columns","selected"])]),_:1}),q(n,{align:"right",class:"q-pa-md"},{default:I(()=>[D(q(o,{flat:"",label:E(he)("common.cancel"),color:"primary"},null,8,["label"]),[[y]]),q(o,{unelevated:"",color:"primary",label:E(he)("weeklyPlans.createPlans",{count:Ce.value.length}),disable:0===Ce.value.length,loading:Pe.value,onClick:$e},null,8,["label","disable","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(null==(P=null==(x=je.value)?void 0:x.classrooms)?void 0:P.length)?N("",!0):(Q(),z(i,{key:0,flat:"",bordered:"",class:"text-center q-pa-xl q-mt-lg"},{default:I(()=>[q(t,{name:"check_circle",size:"64px",color:"positive"}),C("p",fe,S(E(he)("weeklyPlans.allSynced")),1),C("p",_e,S(E(he)("weeklyPlans.noMissingPlans")),1)]),_:1}))]))])}}},[["__scopeId","data-v-652055c6"]]);export{he as default};
