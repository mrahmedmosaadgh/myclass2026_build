import{Q as e}from"./QSpace-BaiVAeLS.js";import{u as a,d as l,f as t,b as o,h as s,Q as r,H as n,t as i,G as d,e as u,s as c,o as m,aS as f}from"./app-4gpSDtVV.js";import{Q as p}from"./QTd-D1GV5G3N.js";import{Q as v}from"./QTable-Yrq9AmcZ.js";import{d as g}from"./date-B0iTpe7S.js";import{a as y,f as w,o as _,N as b,J as h,b as x,K as C,R as k,y as V,W as j,V as D,I as Q,O as L,F as S,_ as A}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./QMarkupTable-B_ExttGO.js";import"./QSelect-Dgk9Cshp.js";import"./rtl-Cr6c3OOr.js";import"./QLinearProgress-CBrm9QWG.js";import"./use-fullscreen-BdF06Cx5.js";const T={class:"row q-gutter-md q-mb-md"},U={class:"col-12 col-md-4"},M={class:"col-auto"},P={class:"text-weight-bold"},q={class:"text-caption text-grey"},F={class:"text-caption text-grey"},B={class:"q-ml-sm text-h6"},R={class:"text-grey-7"},Y={class:"q-ml-sm text-h6"},H={__name:"DraftManagementPanel",props:{modelValue:Boolean},emits:["update:modelValue","compare","load"],setup(H,{emit:O}){const I=H,K=O,N=a(),z=y({get:()=>I.modelValue,set:e=>K("update:modelValue",e)}),G=w([]),J=w(!1),W=w(""),$=w(!1),E=w(!1),X=w(null),Z=[{name:"name",label:"Draft Name",align:"left",field:"name",sortable:!0},{name:"created",label:"Created",align:"left",field:"timestamp",sortable:!0},{name:"stats",label:"Assignments",align:"center",field:e=>e.total_assignments,sortable:!0},{name:"actions",label:"Actions",align:"right"}],ee=y(()=>{if(!W.value)return G.value;const e=W.value.toLowerCase();return G.value.filter(a=>a.name.toLowerCase().includes(e)||a.description&&a.description.toLowerCase().includes(e)||a.created_by_name&&a.created_by_name.toLowerCase().includes(e))});async function ae(){J.value=!0;try{const e=await A.get(route("weekly-system.api.drafts.index"));e.data.success&&(G.value=e.data.drafts.sort((e,a)=>new Date(a.timestamp)-new Date(e.timestamp)))}catch(e){console.error("Failed to load drafts",e),N.notify({type:"negative",message:"Failed to load drafts list"})}finally{J.value=!1}}function le(){X.value&&(K("load",X.value),$.value=!1)}async function te(){if(X.value)try{(await A.post(route("weekly-system.api.drafts.delete"),{name:X.value.name})).data.success&&(N.notify({type:"positive",message:"Draft deleted"}),ae())}catch(e){console.error("Failed to delete draft",e),N.notify({type:"negative",message:"Failed to delete draft"})}finally{E.value=!1,X.value=null}}return _(()=>{ae()}),(a,y)=>(h(),b(S,null,[x(u,{modelValue:z.value,"onUpdate:modelValue":y[1]||(y[1]=e=>z.value=e),"full-width":""},{default:C(()=>[x(l,{class:"column",style:{"min-height":"500px","max-height":"80vh"}},{default:C(()=>[x(t,{class:"bg-primary text-white row items-center"},{default:C(()=>[y[4]||(y[4]=k("div",{class:"text-h6"},"Draft Management",-1)),x(e),V(x(o,{icon:"close",flat:"",round:"",dense:""},null,512),[[f]])]),_:1}),x(t,{class:"q-pa-md col scroll"},{default:C(()=>[k("div",T,[k("div",U,[x(s,{dense:"",outlined:"",modelValue:W.value,"onUpdate:modelValue":y[0]||(y[0]=e=>W.value=e),label:"Search drafts",class:"bg-white"},{append:C(()=>[x(r,{name:"search"})]),_:1},8,["modelValue"])]),x(e),k("div",M,[x(o,{color:"primary",label:"Refresh List",icon:"refresh",flat:"",onClick:ae,loading:J.value},null,8,["loading"])])]),x(v,{rows:ee.value,columns:Z,"row-key":"name",loading:J.value,flat:"",bordered:"",pagination:{rowsPerPage:10}},{"body-cell-name":C(e=>[x(p,{props:e},{default:C(()=>[k("div",P,D(e.value),1),k("div",q,D(e.row.description),1),e.row.is_backup?(h(),Q(d,{key:0,size:"xs",color:"grey-3","text-color":"grey-8",icon:"restore"},{default:C(()=>y[5]||(y[5]=[j("Auto-Backup")])),_:1})):L("",!0)]),_:2},1032,["props"])]),"body-cell-created":C(e=>[x(p,{props:e},{default:C(()=>{return[k("div",null,D((a=e.row.timestamp,a?g.formatDate(a,"MMM D, YYYY HH:mm"):"-")),1),k("div",F,"by "+D(e.row.created_by_name||"System"),1)];var a}),_:2},1032,["props"])]),"body-cell-actions":C(e=>[x(p,{props:e,class:"text-right"},{default:C(()=>[x(n,{flat:""},{default:C(()=>[x(o,{flat:"",dense:"",color:"primary",icon:"compare_arrows",onClick:l=>a.$emit("compare",e.row)},{default:C(()=>[x(i,null,{default:C(()=>y[6]||(y[6]=[j("Compare with Live")])),_:1})]),_:2},1032,["onClick"]),x(o,{flat:"",dense:"",color:"secondary",icon:"restore",onClick:a=>{return l=e.row,X.value=l,void($.value=!0);var l}},{default:C(()=>[x(i,null,{default:C(()=>y[7]||(y[7]=[j("Load/Restore")])),_:1})]),_:2},1032,["onClick"]),x(o,{flat:"",dense:"",color:"negative",icon:"delete",onClick:a=>{return l=e.row,X.value=l,void(E.value=!0);var l}},{default:C(()=>[x(i,null,{default:C(()=>y[8]||(y[8]=[j("Delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),x(u,{modelValue:$.value,"onUpdate:modelValue":y[2]||(y[2]=e=>$.value=e)},{default:C(()=>[x(l,null,{default:C(()=>[x(t,{class:"row items-center"},{default:C(()=>{var e;return[x(c,{icon:"warning",color:"warning","text-color":"white"}),k("span",B,"Load Draft: "+D(null==(e=X.value)?void 0:e.name),1)]}),_:1}),x(t,null,{default:C(()=>[y[10]||(y[10]=k("p",null,"This action will replace the current live schedule with this draft.",-1)),k("p",R,[y[9]||(y[9]=j("Current schedule will be automatically backed up as ")),k("strong",null,"AUTO_BACKUP_"+D((new Date).toISOString().slice(0,10))+"...",1)])]),_:1}),x(m,{align:"right"},{default:C(()=>[V(x(o,{flat:"",label:"Cancel",color:"primary"},null,512),[[f]]),x(o,{flat:"",label:"Proceed & Load",color:"negative",onClick:le})]),_:1})]),_:1})]),_:1},8,["modelValue"]),x(u,{modelValue:E.value,"onUpdate:modelValue":y[3]||(y[3]=e=>E.value=e)},{default:C(()=>[x(l,null,{default:C(()=>[x(t,{class:"row items-center"},{default:C(()=>{var e;return[x(c,{icon:"delete",color:"negative","text-color":"white"}),k("span",Y,"Delete Draft: "+D(null==(e=X.value)?void 0:e.name),1)]}),_:1}),x(t,null,{default:C(()=>y[11]||(y[11]=[j(" Are you sure you want to delete this draft? This action cannot be undone. ")])),_:1}),x(m,{align:"right"},{default:C(()=>[V(x(o,{flat:"",label:"Cancel",color:"primary"},null,512),[[f]]),x(o,{flat:"",label:"Delete",color:"negative",onClick:te})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{H as default};
