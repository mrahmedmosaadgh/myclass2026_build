import{o as e,u as t,c as a,Q as l,p as s,d as o,a as n,n as i,f as r,m as d,l as c,b as u,aP as m,A as g,C as v}from"./app-BwCflFkV.js";import{Q as p}from"./QSelect-Cyosk05W.js";import{Q as f}from"./QTable-C_EQBQcS.js";import{Q as b}from"./QBtnToggle-jUeIyLRJ.js";import{Q as y}from"./QSpinnerHourglass-CFi_PjnJ.js";import{Q as h}from"./QImg-CGPoN2Ku.js";import{Q as w}from"./QLinearProgress-BKKQOFX1.js";import _ from"./CameraCapture-DrqVWxi5.js";import S from"./neontext-V-ZsLocv.js";import{f as x,e as E,k,a as I,o as C,Z as z,n as A,L as N,I as $,V,b as j,M as O,U as D,J as T,S as U,H as F,O as R,y as M,F as P,Q as J,x as Q,A as L,$ as B}from"./vendor-CUZ9QTQV.js";import W from"./BehaviorManager-CY6e11Lx.js";import{u as q}from"./i18n-CP46N9fu.js";import"./offline-BzIlwqNM.js";import"./ui-LrZmvB2D.js";import"./rtl-Cr6c3OOr.js";import"./QMarkupTable-CFmFAA-C.js";import"./use-fullscreen-X4x-6n9-.js";import"./QTab-DaEQqAL1.js";import"./QTabs-DEEJZhkK.js";import"./QTabPanel-Do4XKmfC.js";import"./use-panel-BLnXhVTM.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-BUOq7-x1.js";const H={class:"p-6 space-y-6"},G={class:"control-panel"},K={class:"flex flex-col gap-4"},Y={class:"flex flex-row justify-center gap-4"},Z={class:"mt-4 grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 items-end"},X={class:"flex flex-wrap justify-center gap-2 p-2 font-kid"},ee={class:"relative w-full bg-green-500 justify-center"},te=["src"],ae={class:"relative"},le={key:0,class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 rounded-full transition-all duration-300"},se={key:0,class:"absolute inset-0 flex items-center justify-center bg-gray-500 bg-opacity-20 rounded-full transition-all duration-300"},oe={class:"p-0 scale-75"},ne={key:0,class:"text-sm text-gray-700 font-semibold"},ie={key:1,class:"text-xs text-gray-500"},re={class:"flex flex-col items-center text-sm leading-tight"},de={class:"text-lg font-bold text-primary"},ce={key:0,class:"text-green-600"},ue={key:0,class:"text-red-500"},me={class:"selection-controls mt-6 space-y-4"},ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ve={key:0},pe={key:0,class:"text-gray-500 text-center"},fe={key:1},be={class:"mb-4 font-semibold"},ye={class:"font-semibold mb-2"},he={class:"text-h6"},we={class:"text-subtitle1 mb-3 font-semibold flex items-center gap-2"},_e={class:"settings-toggle-container enhanced-toggle-container"},Se={class:"toggle-status-indicator enhanced-status-indicator"},xe={class:"text-caption text-grey-6 ml-8 mt-2"},Ee={class:"header-content"},ke={class:"selector-content"},Ie={key:0,class:"loading-state"},Ce={key:1,class:"empty-state"},ze={key:2,class:"leaderboard-list"},Ae={key:0,class:"podium-section"},Ne={class:"podium"},$e={key:0,class:"podium-position second-place"},Ve={class:"podium-student"},je={class:"student-avatar-large"},Oe={class:"student-name"},De={class:"student-points silver-points"},Te={key:1,class:"podium-position first-place"},Ue={class:"podium-student"},Fe={class:"student-avatar-large"},Re={class:"student-name champion"},Me={class:"student-points gold-points"},Pe={key:2,class:"podium-position third-place"},Je={class:"podium-student"},Qe={class:"student-avatar-large"},Le={class:"student-name"},Be={class:"student-points bronze-points"},We={key:1,class:"remaining-students"},qe={class:"row-position"},He={class:"row-avatar"},Ge={class:"row-info"},Ke={class:"row-name"},Ye={class:"row-points"},Ze={class:"row-badge"},Xe={key:2,class:"recognition-section"},et={class:"recognition-cards"},tt={key:0,class:"recognition-card"},at={class:"card-name"},lt={key:1,class:"recognition-card"},st={class:"card-name"},ot={key:2,class:"recognition-card"},nt={class:"card-name"},it={class:"footer-content"},rt={class:"text-h6 flex items-center gap-2"},dt={class:"text-subtitle1 mb-3 font-semibold flex items-center gap-2"},ct={class:"settings-toggle-container enhanced-toggle-container"},ut={class:"toggle-status-indicator enhanced-status-indicator"},mt={class:"text-caption text-grey-6 ml-8 mt-2"},gt={class:"attendance-list max-h-80 overflow-y-auto"},vt={class:"flex items-center gap-3"},pt={class:"relative attendance-avatar-container"},ft={class:"absolute -top-1 -right-1 attendance-status-badge"},bt={class:"student-info"},yt={class:"flex items-center gap-3"},ht={class:"flex gap-2 mt-4 pt-4 border-t border-grey-3"},wt={class:"mt-3 p-3 bg-grey-1 rounded-lg attendance-summary"},_t={class:"flex items-center justify-between text-sm"},St={class:"flex items-center gap-2"},xt={class:"flex items-center gap-4"},Et={class:"flex items-center gap-1"},kt={class:"text-positive font-medium"},It={class:"flex items-center gap-1"},Ct={class:"text-negative font-medium"},zt={class:"mt-2"},At={class:"text-center text-grey-6 py-8"},Nt="reward-system-last-selection",$t=e({__name:"settings",setup(e){const $t=()=>{ga.value=!1},Vt=async({dataUrl:e})=>{if(!ma.value||!e)return;const t=function(e){const t=e.split(","),a=t[0].match(/:(.*?);/)[1],l=atob(t[1]),s=l.length,o=new Uint8Array(s);for(let n=0;n<s;n++)o[n]=l.charCodeAt(n);return new Blob([o],{type:a})}(e);await wa(ma.value.id,t,"capture.png"),ga.value=!1},{notsafe_t:jt}=q(),Ot=e=>{if(!e||"string"!=typeof e)return e||"";try{return jt(e)}catch(t){return e}},Dt=t(),Tt=x(""),Ut=x(""),Ft=x("neon-text"),Rt=x(null),Mt=x(null),Pt=x(null),Jt=x(null),Qt=x(""),Lt=x([]),Bt=Array.from({length:4},(e,t)=>({label:`Semester ${t+1}`,value:t+1})),Wt=Array.from({length:16},(e,t)=>({label:`Week ${t+1}`,value:t+1})),qt=Array.from({length:7},(e,t)=>({label:`Day ${t+1}`,value:t+1})),Ht=Array.from({length:8},(e,t)=>({label:`Period ${t+1}`,value:t+1}));function Gt(){try{const e={semester:Rt.value,week:Mt.value,day:Pt.value,periodNumber:Jt.value,classroomId:Tt.value||$a.value.currentClassroomId||null,classroomName:Qt.value||null,period_code:Ut.value||null};return localStorage.setItem(Nt,JSON.stringify(e)),!0}catch(e){return console.warn("saveLastSelection failed",e),!1}}x(["P-01","P-02","P-03","P-04"]),E(()=>{Gt()});const Kt=x({classes:[],subjects:[],my_classes:[],my_subjects:[],teacher:null,teacher_classes:[]}),Yt=x([]),Zt=x([{name:"key",label:"Field",field:"key",align:"left",sortable:!0},{name:"label",label:"Label",field:"label",align:"left",sortable:!0},{name:"type",label:"Type",field:"type",align:"left",sortable:!0},{name:"visible",label:"Visible",field:"visible",align:"center"}]),Xt=x(""),ea=x(!1),ta=()=>{try{const e=JSON.parse(Xt.value);if(Lt.value=Array.isArray(e)?e:[e],Lt.value.length>0){const e=Lt.value[0];Yt.value=Object.keys(e).map(e=>({key:e,label:e,type:"text",visible:!0}))}ea.value=!1,Dt.notify({type:"positive",message:"JSON Loaded"})}catch(e){console.error("JSON parsing error:",e),Dt.notify({type:"negative",message:"Invalid JSON format"})}},aa=()=>{try{const e=Xt.value.split("\n").filter(e=>""!==e.trim());e.length>0&&(Lt.value=e.map(e=>({value:e})),Yt.value=[{key:"value",label:"Value",type:"text",visible:!0}]),ea.value=!1,Dt.notify({type:"positive",message:"Text Loaded"})}catch(e){console.error("Text loading error:",e),Dt.notify({type:"negative",message:"Failed to load text data"})}};x([{label:"LMS System",children:[{label:"Authentication"},{label:"Class Management"},{label:"Quiz System"},{label:"Behavior Points"},{label:"Weekly Plan"},{label:"Lesson Planner"}]}]);const la=x(!1),sa=x({name:null,id:null,f_l_name:""}),oa=x({}),na=x(!1),ia=x([]),ra=x(!1),da=x("week"),ca=x(!1),ua=x(null),ma=x(null),ga=x(!1),va=x(null);x(null);const pa=x(null),fa=x(!1),ba=x(!1),ya=e=>{try{if(e){const t=e.split(" ").map(e=>e[0]||"").slice(0,2).join("").toUpperCase(),a=`<svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 96 96">\n        <rect width="96" height="96" fill="${"#e2e8f0"}" rx="48" ry="48"/>\n        <text x="48" y="48" dy="8" text-anchor="middle" font-family="Arial" font-size="32" font-weight="bold" fill="${"#475569"}">${t}</text>\n      </svg>`;return`data:image/svg+xml,${encodeURIComponent(a)}`}}catch(t){console.warn("Failed to generate avatar SVG:",t)}return"/images/avatars/default-avatar.svg"},ha=async e=>{var t;const a=e.target.files||(null==(t=e.dataTransfer)?void 0:t.files);if(!a||!a.length)return;const l=a[0];ma.value&&(await wa(ma.value.id,l),e.target.value="")},wa=async(e,t,a=null)=>{var l,s;try{fa.value=!0;const l=new FormData,s=t instanceof Blob?new File([t],a||"avatar.png",{type:t.type||"image/png"}):t;l.append("avatar",s),l.append("student_id",e);const o=await z.post(`/api/students/${e}/avatar`,l,{headers:{"Content-Type":"multipart/form-data"}});Dt.notify({message:"Avatar uploaded",color:"positive"});const n=(Ia.value.my_sel_classroom_students||[]).find(t=>t.id===e);n&&(n.avatar=o.data.avatar||o.data.url||n.avatar||null)}catch(o){console.error("avatar upload failed",o),Dt.notify({message:(null==(s=null==(l=o.response)?void 0:l.data)?void 0:s.message)||"Avatar upload failed",color:"negative"})}finally{fa.value=!1}},_a=async e=>{if(e)try{const t=await z.get(`/api/student-behaviors/${e}`);oa.value[e]=t.data}catch(t){console.warn("Failed to load student summary",t),oa.value[e]={positive:0,negative:0,total:0}}},Sa=async()=>{var e;if(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length){ba.value=!0;try{const e=Ia.value.my_sel_classroom_students,t=e.map(e=>_a(e.id));await Promise.all(t),Dt.notify({message:`Successfully loaded summaries for ${e.length} students!`,color:"positive",position:"top",icon:"assessment"})}catch(t){console.error("Failed to load all student summaries:",t),Dt.notify({message:"Failed to load some student summaries",color:"negative",position:"top"})}finally{ba.value=!1}}else Dt.notify({message:"No students found in selected classroom!",color:"warning",position:"top"})},xa=async()=>{var e;(null==(e=sa.value)?void 0:e.id)&&(await _a(sa.value.id),na.value&&await Ea())},Ea=async()=>{var e;if(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length){ra.value=!0;try{const e=Tt.value,t=new Date;let a=new Date;switch(da.value){case"week":const e=t.getDay(),l=0===e?6:e-1;a.setDate(t.getDate()-l),a.setHours(0,0,0,0);break;case"month":a=new Date(t.getFullYear(),t.getMonth(),1);break;case"all":const s=t.getFullYear(),o=t.getMonth()>=8?s:s-1;a=new Date(o,8,1)}const l=(await z.get("/api/leaderboard",{params:{classroom_id:e,start_date:a.toISOString().split("T")[0],end_date:t.toISOString().split("T")[0],limit:5}})).data.map(e=>{const t=Ia.value.my_sel_classroom_students.find(t=>t.id===e.student_id);return{...e,name:(null==t?void 0:t.name)||"Unknown Student",avatar:(null==t?void 0:t.avatar)||null}}).filter(e=>e.total>0);ia.value=l,l.length>0&&ka()}catch(t){console.error("Failed to load leaderboard:",t);const e=Object.entries(oa.value).map(([e,t])=>{var a;const l=null==(a=Ia.value.my_sel_classroom_students)?void 0:a.find(t=>t.id==e);return{student_id:parseInt(e),name:(null==l?void 0:l.name)||"Unknown Student",avatar:(null==l?void 0:l.avatar)||null,total:t.total||0,positive:t.positive||0,negative:t.negative||0}}).filter(e=>e.total>0).sort((e,t)=>t.total-e.total).slice(0,5);ia.value=e,0===e.length&&Dt.notify({message:"No student data available yet. Start recording some behaviors!",color:"info",position:"top"})}finally{ra.value=!1}}else Dt.notify({message:"Please select a classroom first!",color:"warning",position:"top"})},ka=()=>{try{const e=new(window.AudioContext||window.webkitAudioContext),t=(t,a,l)=>{const s=e.createOscillator(),o=e.createGain();s.connect(o),o.connect(e.destination),s.frequency.setValueAtTime(t,a),s.type="triangle",o.gain.setValueAtTime(0,a),o.gain.linearRampToValueAtTime(.3,a+.01),o.gain.exponentialRampToValueAtTime(.01,a+l),s.start(a),s.stop(a+l)},a=e.currentTime;t(523.25,a,.3),t(659.25,a+.15,.3),t(783.99,a+.3,.3),t(1046.5,a+.45,.5)}catch(e){console.log("Audio not available")}},Ia=x({my_sel_classroom_students:[],my_classes_with_students:[],classes:[],subjects:[]}),Ca=x(localStorage.getItem("studentViewPreference")||"card");k(Ca,e=>{try{localStorage.setItem("studentViewPreference",e)}catch(t){}}),x({sortBy:"name",descending:!1,page:1,rowsPerPage:10}),x([{name:"name",label:"Name",field:"name",sortable:!0},{name:"id",label:"ID",field:"id",sortable:!0},{name:"classroom",label:"Class",field:"class",sortable:!0},{name:"points",label:"Points",field:"points",sortable:!0},{name:"status",label:"Status",field:"status",sortable:!0},{name:"attend",label:"Attendance",field:"attend",sortable:!0,align:"center"}]),x(""),x(!1);const za=e=>{if(!e||"string"!=typeof e)return{firstName:null,lastName:null};const t=e.trim().split(/\s+/);if(0===t.length)return{firstName:null,lastName:null};const a=t[0];let l=null;return t.length>1&&(l=t[t.length-1]),a+" "+l};function Aa(e){if(!e||"string"!=typeof e)return{firstName:"",secondName:"",lastName:""};const t=e.trim().split(/\s+/).filter(e=>e.length>0),a=t[0]||"",l=t.length>1?t[t.length-1]:"";return{firstName:a,secondName:t.length>2?t.slice(1,-1).join(" "):"",lastName:l}}!async function(e,t,a=null){try{const l=await z.get(e,{params:a});return Ia.value||(Ia.value={}),Ia.value[t]=l.data,l.data}catch(l){return console.error("fetchDataGet failed",l),null}}("my_classes_with_students","my_classes_with_students");const Na=x([]),$a=x({avatarEditingEnabled:!0,readingAloudEnabled:!0,attendance:{},currentClassroomId:null}),Va=()=>{try{if(console.log("Starting settings save operation..."),"undefined"==typeof Storage||!window.localStorage)return console.warn("localStorage is not available"),Dt.notify({message:"Settings cannot be saved - browser storage unavailable",color:"warning",position:"top",timeout:3e3,icon:"warning"}),ja();let i;try{if(i=Ra($a.value),!i)throw new Error("Settings validation returned null/undefined")}catch(e){throw console.error("Settings validation failed:",e),new Error("Settings validation failed: "+e.message)}const r={...i,lastUpdated:(new Date).toISOString(),version:"1.1",userAgent:navigator.userAgent.substring(0,100),classroomId:i.currentClassroomId,attendanceCount:Object.keys(i.attendance||{}).length};try{const e="reward-system-settings-test-"+Date.now();localStorage.setItem(e,"test"),localStorage.removeItem(e)}catch(t){throw"QuotaExceededError"===t.name?new Error("localStorage quota exceeded during test write"):new Error("localStorage write test failed: "+t.message)}let d;try{d=JSON.stringify(r)}catch(a){throw console.error("Settings serialization failed:",a),new Error("Failed to serialize settings: "+a.message)}const c=5e6;if(d.length>c){console.warn(`Settings data too large: ${d.length} bytes (limit: ${c})`);try{return Da()}catch(l){throw new Error(`Settings data too large for localStorage: ${d.length} bytes`)}}let u=null;try{u=localStorage.getItem("reward-system-settings")}catch(s){console.warn("Could not create backup of existing settings:",s)}try{localStorage.setItem("reward-system-settings",d)}catch(o){if(u)try{localStorage.setItem("reward-system-settings",u)}catch(n){console.error("Failed to restore backup settings:",n)}throw o}return console.log("Settings saved successfully:",{size:d.length,attendanceEntries:Object.keys(i.attendance||{}).length,avatarEditingEnabled:i.avatarEditingEnabled,currentClassroomId:i.currentClassroomId}),!0}catch(i){console.error("Failed to save settings to localStorage:",i);let e="Failed to save settings",t=[];return"QuotaExceededError"===i.name||i.message.includes("quota exceeded")?(e="Storage quota exceeded - cannot save settings",t=[{label:"Clear Old Data",color:"white",handler:()=>Ja()},{label:"Compress Data",color:"white",handler:()=>Da()}]):i.message.includes("localStorage write test failed")||i.message.includes("disabled")?(e="Browser storage is disabled or unavailable",t=[{label:"Use Session Storage",color:"white",handler:()=>ja()},{label:"Use Memory Storage",color:"white",handler:()=>Oa()}]):i.message.includes("too large")?(e="Settings data is too large to save",t=[{label:"Compress Data",color:"white",handler:()=>Da()},{label:"Sanitize Data",color:"white",handler:()=>Ta()}]):(i.message.includes("validation failed")||i.message.includes("serialize"))&&(e="Settings data is corrupted",t=[{label:"Sanitize & Retry",color:"white",handler:()=>Ta()},{label:"Reset to Defaults",color:"white",handler:()=>{Ma(),Va()}}]),t.unshift({label:"Retry",color:"white",handler:()=>{setTimeout(()=>Va(),1e3)}}),Dt.notify({message:e,caption:i.message,color:"negative",position:"top",timeout:6e3,icon:"error",actions:t}),Xa(i,"save"),!1}},ja=()=>{try{if("undefined"!=typeof sessionStorage&&sessionStorage){const e={...Ra($a.value),lastUpdated:(new Date).toISOString(),version:"1.0",fallbackMode:"sessionStorage"};return sessionStorage.setItem("reward-system-settings-fallback",JSON.stringify(e)),Dt.notify({message:"Settings saved to session storage (temporary)",color:"warning",position:"top",timeout:3e3,icon:"warning"}),console.log("Settings saved to sessionStorage as fallback"),!0}throw new Error("sessionStorage not available")}catch(e){return console.error("sessionStorage fallback failed:",e),Oa(),!1}},Oa=()=>{try{return window.rewardSystemSettingsMemory={...Ra($a.value),lastUpdated:(new Date).toISOString(),version:"1.0",fallbackMode:"memory"},Dt.notify({message:"Settings saved in memory only (will be lost on refresh)",color:"warning",position:"top",timeout:4e3,icon:"warning"}),console.log("Settings saved to memory as fallback"),!0}catch(e){return console.error("Memory fallback failed:",e),Dt.notify({message:"Unable to save settings - all storage methods failed",color:"negative",position:"top",timeout:5e3,icon:"error"}),!1}},Da=()=>{try{const t={avatarEditingEnabled:$a.value.avatarEditingEnabled,attendance:$a.value.attendance,currentClassroomId:$a.value.currentClassroomId},a={};Object.entries(t.attendance||{}).forEach(([e,t])=>{!1===t&&(a[e]=!1)}),t.attendance=a;const l=JSON.stringify(t);if(l.length>5e6)throw new Error("Even compressed data is too large");try{localStorage.setItem("reward-system-settings-test","test"),localStorage.removeItem("reward-system-settings-test")}catch(e){throw new Error("localStorage write test failed after compression: "+e.message)}return localStorage.setItem("reward-system-settings",l),Dt.notify({message:"Settings saved in compressed format",color:"info",position:"top",timeout:3e3,icon:"compress"}),console.log("Settings saved in compressed format:",{originalSize:JSON.stringify($a.value).length,compressedSize:l.length,compressionRatio:Math.round(100*(1-l.length/JSON.stringify($a.value).length))}),!0}catch(t){return console.error("Compression fallback failed:",t),Dt.notify({message:"Compression failed, trying alternative storage",color:"warning",position:"top",timeout:3e3,icon:"warning"}),ja()}},Ta=()=>{var e;try{console.log("Starting settings sanitization process...");const a=JSON.parse(JSON.stringify($a.value)),l={avatarEditingEnabled:Boolean($a.value.avatarEditingEnabled),attendance:{},currentClassroomId:$a.value.currentClassroomId?String($a.value.currentClassroomId):null};let s=0,o=0;if($a.value.attendance&&"object"==typeof $a.value.attendance&&Object.entries($a.value.attendance).forEach(([e,t])=>{const a=parseInt(e);!isNaN(a)&&a>0?"boolean"==typeof t?(l.attendance[String(e)]=t,s++):"true"===t||"false"===t?(l.attendance[String(e)]="true"===t,s++):1===t||0===t?(l.attendance[String(e)]=Boolean(t),s++):(console.warn(`Removed invalid attendance value for student ${e}:`,t),o++):(console.warn("Removed invalid student ID from attendance:",e),o++)}),null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length){const e=new Set(Ia.value.my_sel_classroom_students.filter(e=>e&&e.id).map(e=>e.id.toString()));Object.keys(l.attendance).forEach(t=>{e.has(t)||(delete l.attendance[t],o++,console.warn(`Removed attendance for student not in current classroom: ${t}`))})}const n=JSON.stringify(l);if(n.length>5e6)throw new Error("Sanitized data still too large for localStorage");try{localStorage.setItem("reward-system-settings-test","test"),localStorage.removeItem("reward-system-settings-test")}catch(t){throw new Error("localStorage write test failed after sanitization: "+t.message)}localStorage.setItem("reward-system-settings",n),Object.assign($a.value,l);const i=`Settings sanitized: ${s} entries kept, ${o} invalid entries removed`;return Dt.notify({message:i,color:"positive",position:"top",timeout:4e3,icon:"cleaning_services"}),console.log("Settings sanitization completed:",{sanitizedCount:s,removedCount:o,sanitizedSettings:l,originalSize:JSON.stringify(a).length,sanitizedSize:n.length}),!0}catch(a){return console.error("Sanitization failed:",a),Dt.notify({message:`Sanitization failed: ${a.message}`,color:"negative",position:"top",timeout:4e3,icon:"error"}),ja()}},Ua=()=>{try{if("undefined"==typeof Storage||!window.localStorage)return console.warn("localStorage is not available, using default settings"),Ma(),!1;const t=localStorage.getItem("reward-system-settings");if(!t)return console.log("No saved settings found, using defaults"),Ma(),!0;let a;try{a=JSON.parse(t)}catch(e){throw new Error("Invalid JSON in saved settings: "+e.message)}if(!a||"object"!=typeof a)throw new Error("Invalid settings data structure");const{lastUpdated:l,version:s,...o}=a,n=Ra(o);return Object.assign($a.value,n),console.log("Settings loaded successfully:",n),s&&console.log("Loaded settings version:",s),!0}catch(t){console.error("Failed to load settings from localStorage:",t);let e="Settings reset to defaults due to loading error";t.message.includes("Invalid JSON")?e="Settings file corrupted - reset to defaults":t.message.includes("Invalid settings data")&&(e="Invalid settings format - reset to defaults");const a=Fa();return a||(Ma(),Dt.notify({message:e,color:"info",position:"top",timeout:3e3,icon:"refresh",actions:[{label:"OK",color:"white",handler:()=>{}}]})),a}},Fa=()=>{try{if("undefined"!=typeof sessionStorage&&sessionStorage){const t=sessionStorage.getItem("reward-system-settings-fallback");if(t)try{const e=JSON.parse(t),{lastUpdated:a,version:l,fallbackMode:s,...o}=e,n=Ra(o);return Object.assign($a.value,n),Dt.notify({message:"Settings loaded from session storage backup",color:"warning",position:"top",timeout:3e3,icon:"backup"}),console.log("Settings loaded from sessionStorage fallback"),!0}catch(e){console.warn("sessionStorage fallback data corrupted:",e)}}if(window.rewardSystemSettingsMemory)try{const{lastUpdated:e,version:t,fallbackMode:a,...l}=window.rewardSystemSettingsMemory,s=Ra(l);return Object.assign($a.value,s),Dt.notify({message:"Settings loaded from memory backup",color:"warning",position:"top",timeout:3e3,icon:"memory"}),console.log("Settings loaded from memory fallback"),!0}catch(t){console.warn("Memory fallback data corrupted:",t)}return!1}catch(a){return console.error("All fallback loading methods failed:",a),!1}},Ra=e=>{const t={avatarEditingEnabled:!0,attendance:{},currentClassroomId:null};if(!e||"object"!=typeof e)return console.warn("Invalid settings data, using defaults"),t;const a={...t};if("boolean"==typeof e.avatarEditingEnabled?a.avatarEditingEnabled=e.avatarEditingEnabled:console.warn("Invalid avatarEditingEnabled value, using default:",e.avatarEditingEnabled),e.attendance&&"object"==typeof e.attendance&&!Array.isArray(e.attendance)){const t={};Object.entries(e.attendance).forEach(([e,a])=>{const l=parseInt(e);!isNaN(l)&&l>0?"boolean"==typeof a?t[e]=a:(console.warn(`Invalid attendance value for student ${e}:`,a),t[e]=!0):console.warn("Invalid student ID in attendance:",e)}),a.attendance=t}else console.warn("Invalid attendance data, using empty object:",e.attendance);return null===e.currentClassroomId||"string"==typeof e.currentClassroomId&&e.currentClassroomId.length>0||"number"==typeof e.currentClassroomId&&e.currentClassroomId>0?a.currentClassroomId=e.currentClassroomId:console.warn("Invalid currentClassroomId, using null:",e.currentClassroomId),a},Ma=()=>{$a.value={avatarEditingEnabled:!0,attendance:{},currentClassroomId:null},console.log("Initialized default settings")},Pa=()=>{var e;try{if(!(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length))return console.log("No students in current classroom to validate against"),!0;const a=Ia.value.my_sel_classroom_students.filter(e=>!e.id||"string"!=typeof e.id&&"number"!=typeof e.id);a.length>0&&(console.error("Found students with invalid IDs:",a),Dt.notify({message:`Warning: ${a.length} students have invalid IDs`,color:"warning",position:"top",timeout:4e3,icon:"warning"}));const l=new Set;if(Ia.value.my_sel_classroom_students.forEach(e=>{e.id&&l.add(e.id.toString())}),0===l.size)return console.warn("No valid student IDs found in current classroom"),!0;if(!$a.value.attendance||"object"!=typeof $a.value.attendance)return console.warn("Invalid attendance data structure, resetting"),$a.value.attendance={},!0;const s=Object.keys($a.value.attendance).filter(e=>{if(!l.has(e))return!0;const t=$a.value.attendance[e];return"boolean"!=typeof t&&(console.warn(`Invalid attendance value for student ${e}:`,t),!0)});if(s.length>0){console.warn("Found invalid student IDs or values in attendance:",s);const e={...$a.value.attendance};try{const e={...$a.value.attendance};let t=0,a=0;s.forEach(s=>{const o=$a.value.attendance[s];l.has(s)?"boolean"!=typeof o&&(e[s]=!0,a++):(delete e[s],t++)}),$a.value.attendance=e;let o="";return t>0&&a>0?o=`Removed ${t} invalid student records and fixed ${a} invalid values`:t>0?o=`Removed ${t} invalid student records from attendance`:a>0&&(o=`Fixed ${a} invalid attendance values`),Dt.notify({message:o,color:"info",position:"top",timeout:3e3,icon:"cleaning_services"}),console.log("Attendance validation completed:",{removed:t,fixed:a,cleanedAttendance:e}),!1}catch(t){return console.error("Error during attendance cleanup:",t),$a.value.attendance=e,Dt.notify({message:"Failed to clean invalid attendance data",color:"negative",position:"top",timeout:3e3,icon:"error"}),!1}}return console.log("All student IDs in attendance are valid"),!0}catch(a){return console.error("Error during student ID validation:",a),Dt.notify({message:"Error validating student data - some features may not work correctly",color:"negative",position:"top",timeout:4e3,icon:"error"}),!1}},Ja=()=>{try{const e=[];for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);a&&a.startsWith("reward-system-")&&e.push(a)}return e.forEach(e=>{(e.includes("backup")||e.includes("old"))&&(localStorage.removeItem(e),console.log("Removed old settings:",e))}),Va()}catch(e){return console.error("Failed to handle storage quota exceeded:",e),Dt.notify({message:"Storage full - settings cannot be saved. Please clear browser data.",color:"negative",position:"top",timeout:5e3,icon:"storage"}),!1}},Qa=(e,t)=>{console.log(`Handling classroom selection: ${e}`),Tt.value=e,Ia.value.my_sel_classroom_students=t||[]},La=()=>{var e;if(console.log("Testing classroom switching behavior..."),!(null==(e=Ia.value.my_classes_with_students)?void 0:e.length))return void console.warn("No classrooms available for testing");const t=Ia.value.my_classes_with_students;let a=0;const l=()=>{if(a<t.length){const e=t[a];console.log(`Switching to classroom ${a+1}: ${e.classroom_name}`),console.log("Current settings before switch:",JSON.parse(JSON.stringify($a.value))),Qa(e.id,e.students),setTimeout(()=>{console.log("Settings after switch:",JSON.parse(JSON.stringify($a.value))),console.log("LocalStorage content:",localStorage.getItem("reward-system-settings")),a++,a<t.length?setTimeout(l,2e3):console.log("Classroom switching test completed")},100)}};l()},Ba=()=>{console.log("Starting comprehensive error handling tests...");const e=[];[{name:"localStorage Unavailable Test",test:()=>{const e=window.localStorage;Object.defineProperty(window,"localStorage",{value:null,writable:!0});const t=Va();return Object.defineProperty(window,"localStorage",{value:e,writable:!0}),!t}},{name:"Invalid Settings Data Test",test:()=>{const e={...$a.value};$a.value={avatarEditingEnabled:"invalid",attendance:"not an object",currentClassroomId:[]};const t=Ra($a.value);return $a.value=e,t&&"boolean"==typeof t.avatarEditingEnabled&&"object"==typeof t.attendance&&!Array.isArray(t.attendance)}},{name:"Student ID Validation Test",test:()=>{const e={...$a.value.attendance};$a.value.attendance={valid_id_1:!0,invalid_id_abc:!1,"":!0,null:null,999999:"not_boolean"};const t=Pa();return $a.value.attendance=e,"boolean"==typeof t}},{name:"Settings Dialog Error Boundary Test",test:()=>{try{const e=Ia.value;return Ia.value=null,el(),Ia.value=e,!0}catch(e){return!1}}},{name:"Compression Fallback Test",test:()=>{const e={...$a.value.attendance},t={};for(let l=0;l<1e4;l++)t[`student_${l}`]=Math.random()>.5;$a.value.attendance=t;const a=Da();return $a.value.attendance=e,"boolean"==typeof a}},{name:"Sanitization Test",test:()=>{const e={...$a.value};$a.value.attendance={123:!0,invalid:"not_boolean",456:!1,"":!0,null:null};const t=Ta();return $a.value=e,"boolean"==typeof t}}].forEach(({name:t,test:a})=>{try{const l=Date.now(),s=a(),o=Date.now()-l;e.push({name:t,passed:s,duration:o,error:null}),console.log(`âœ… ${t}: ${s?"PASSED":"FAILED"} (${o}ms)`)}catch(l){e.push({name:t,passed:!1,duration:0,error:l.message}),console.error(`âŒ ${t}: ERROR - ${l.message}`)}});const t=e.filter(e=>e.passed).length,a=e.length;return console.log(`\nðŸ“Š Error Handling Test Results: ${t}/${a} tests passed`),t===a?Dt.notify({message:`All ${a} error handling tests passed!`,color:"positive",position:"top",timeout:3e3,icon:"check_circle"}):Dt.notify({message:`${t}/${a} error handling tests passed`,color:"warning",position:"top",timeout:4e3,icon:"warning"}),e};"undefined"!=typeof window&&(window.testClassroomSwitching=La,window.testErrorHandling=Ba,window.testSettingsValidation=()=>Pa(),window.testSettingsCompression=()=>Da(),window.testSettingsSanitization=()=>Ta()),k($a,()=>{try{Wa&&clearTimeout(Wa),Wa=setTimeout(()=>{Va()},500)}catch(e){console.error("Error in settings watcher:",e),Dt.notify({message:"Error monitoring settings changes",color:"warning",position:"top",timeout:2e3,icon:"warning"})}},{deep:!0}),k(()=>Ia.value.my_sel_classroom_students,(e,t)=>{try{if(!e||!Array.isArray(e))return void console.log("No valid students array provided");if(e.length>0){const a={...$a.value.attendance};let l=!1,s=0,o=0;if(e.forEach(e=>{e&&e.id?e.id in a||(a[e.id]=!0,l=!0,s++):console.warn("Invalid student data:",e)}),t&&Array.isArray(t)&&t.length>0){const t=new Set(e.filter(e=>e&&e.id).map(e=>e.id.toString()));Object.keys(a).forEach(e=>{t.has(e.toString())||(delete a[e],l=!0,o++)})}l&&($a.value.attendance=a,console.log(`Updated attendance: +${s} students, -${o} students`),(s>0||o>0)&&Dt.notify({message:`Attendance updated: ${s} added, ${o} removed`,color:"info",position:"top",timeout:2e3,icon:"update"}))}else Object.keys($a.value.attendance).length>0&&($a.value.attendance={},console.log("Cleared attendance - no students in classroom"))}catch(a){console.error("Error updating attendance for student changes:",a),Dt.notify({message:`Error updating attendance: ${a.message}`,color:"warning",position:"top",timeout:3e3,icon:"warning"});try{Pa()}catch(l){console.error("Failed to validate student IDs during recovery:",l)}}},{deep:!0});let Wa=null;const qa=e=>!1!==$a.value.attendance[e];I(()=>{const e={};return Ia.value.my_sel_classroom_students&&Ia.value.my_sel_classroom_students.forEach(t=>{e[t.id]=!1!==$a.value.attendance[t.id]}),e});const Ha=I(()=>$a.value.avatarEditingEnabled),Ga=I(()=>e=>{const t="student-card cursor-pointer transition-all duration-300";return qa(e)?`${t} hover:shadow-xl hover:-translate-y-1`:`${t} student-absent opacity-50 grayscale cursor-not-allowed`}),Ka=I(()=>e=>!qa(e)),Ya=()=>{var e;try{if(!(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length))throw new Error("No students found in current classroom");let t=0;const a=[];Ia.value.my_sel_classroom_students.forEach(e=>{try{if(!e.id)throw new Error("Invalid student data: missing ID");$a.value.attendance[e.id]=!0,t++}catch(l){a.push(`Student ${e.name||"Unknown"}: ${l.message}`)}}),a.length>0?(console.warn("Errors marking students present:",a),Dt.notify({message:`Marked ${t} students present, ${a.length} errors occurred`,color:"warning",position:"top",timeout:4e3,icon:"warning"})):Dt.notify({message:`All ${t} students marked present`,color:"positive",position:"top",timeout:2e3,icon:"people"}),console.log(`Marked all students present: ${t} successful, ${a.length} errors`)}catch(t){console.error("Error marking all students present:",t),Dt.notify({message:`Failed to mark all present: ${t.message}`,color:"negative",position:"top",timeout:3e3,icon:"error"})}},Za=()=>{var e;try{if(!(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length))throw new Error("No students found in current classroom");let t=0;const a=[];Ia.value.my_sel_classroom_students.forEach(e=>{try{if(!e.id)throw new Error("Invalid student data: missing ID");$a.value.attendance[e.id]=!1,t++}catch(l){a.push(`Student ${e.name||"Unknown"}: ${l.message}`)}}),a.length>0?(console.warn("Errors marking students absent:",a),Dt.notify({message:`Marked ${t} students absent, ${a.length} errors occurred`,color:"warning",position:"top",timeout:4e3,icon:"warning"})):Dt.notify({message:`All ${t} students marked absent`,color:"warning",position:"top",timeout:2e3,icon:"person_off"}),console.log(`Marked all students absent: ${t} successful, ${a.length} errors`)}catch(t){console.error("Error marking all students absent:",t),Dt.notify({message:`Failed to mark all absent: ${t.message}`,color:"negative",position:"top",timeout:3e3,icon:"error"})}},Xa=(e,t)=>{var a;console.error(`Settings dialog error during ${t}:`,e);const l={operation:t,error:e.message,stack:e.stack,timestamp:(new Date).toISOString(),settingsState:$a.value?JSON.stringify($a.value):"null",classroomId:Tt.value,studentCount:(null==(a=Ia.value.my_sel_classroom_students)?void 0:a.length)||0};console.error("Settings error report:",l);const s=[];"open"===t?(s.push({label:"Retry",color:"white",handler:()=>el()}),s.push({label:"Reset & Open",color:"white",handler:()=>{Ma(),el()}})):"save"===t?(s.push({label:"Retry",color:"white",handler:()=>Va()}),s.push({label:"Compress & Save",color:"white",handler:()=>Da()}),s.push({label:"Sanitize & Save",color:"white",handler:()=>Ta()})):"load"===t?(s.push({label:"Retry",color:"white",handler:()=>Ua()}),s.push({label:"Use Defaults",color:"white",handler:()=>Ma()})):"validate"===t?(s.push({label:"Fix Data",color:"white",handler:()=>Ta()}),s.push({label:"Reset",color:"white",handler:()=>Ma()})):s.push({label:"Retry",color:"white",handler:()=>{"reset"===t&&tl()}}),Dt.notify({message:{open:"Failed to open settings dialog",close:"Failed to close settings dialog",save:"Failed to save settings",load:"Failed to load settings",reset:"Failed to reset settings",validate:"Settings validation failed",initialize:"Settings initialization failed"}[t]||"Settings dialog error occurred",caption:e.message,color:"negative",position:"top",timeout:5e3,icon:"error",actions:s})},el=()=>{var e;try{if(console.log("Attempting to open settings dialog..."),!Ia.value)throw new Error("Application data not initialized");"undefined"==typeof Storage&&console.warn("Browser storage not available, settings will not persist"),Ia.value.my_sel_classroom_students||(console.warn("No classroom selected, initializing empty student list"),Ia.value.my_sel_classroom_students=[]),$a.value&&"object"==typeof $a.value?("boolean"!=typeof $a.value.avatarEditingEnabled&&(console.warn("avatarEditingEnabled corrupted, resetting to default"),$a.value.avatarEditingEnabled=!0),$a.value.attendance&&"object"==typeof $a.value.attendance&&!Array.isArray($a.value.attendance)||(console.warn("Attendance data corrupted, reinitializing"),$a.value.attendance={}),null!==$a.value.currentClassroomId&&"string"!=typeof $a.value.currentClassroomId&&"number"!=typeof $a.value.currentClassroomId&&(console.warn("currentClassroomId corrupted, resetting to null"),$a.value.currentClassroomId=null)):(console.warn("Settings object corrupted, reinitializing"),Ma());try{Pa()||console.warn("Student ID validation returned false, but continuing with dialog open")}catch(t){console.warn("Student ID validation failed, attempting recovery:",t);try{Ta()}catch(a){console.error("Recovery failed, using default settings:",a),Ma()}}if(ca.value)return void console.log("Settings dialog already open");if(!Dt)throw new Error("Quasar instance not available");ca.value=!0,console.log("Settings dialog opened successfully"),console.log("Settings dialog state:",{settingsValid:!!$a.value,studentsCount:(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length)||0,attendanceEntries:Object.keys($a.value.attendance||{}).length,currentClassroom:$a.value.currentClassroomId})}catch(l){console.error("Critical error opening settings dialog:",l),Xa(l,"open")}},tl=()=>{try{Dt.dialog({title:"Reset Settings",message:"Are you sure you want to reset all settings to defaults? This will clear all attendance data.",cancel:!0,persistent:!1,color:"negative"}).onOk(()=>{try{Ma(),Va(),Dt.notify({message:"Settings reset to defaults",color:"info",position:"top",timeout:2e3,icon:"refresh"}),console.log("Settings reset to defaults successfully")}catch(e){Xa(e,"reset")}})}catch(e){Xa(e,"reset")}};C(async()=>{try{console.log("Initializing reward system component...");try{Ua()||(console.warn("Settings loading failed, using defaults"),Ma())}catch(e){console.error("Critical error loading settings:",e),Xa(e,"load"),Ma()}try{const e=await z.get("/api/behaviors");e.data&&Array.isArray(e.data)?(Na.value=e.data,console.log(`Loaded ${e.data.length} behaviors`)):(console.warn("Invalid behaviors data received:",e.data),Na.value=[])}catch(t){console.error("Failed to load behaviors:",t),Na.value=[],Dt.notify({message:"Failed to load behavior options",color:"warning",position:"top",timeout:3e3,icon:"warning"})}A(()=>{var e;try{if(Tt.value&&(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length)){if(console.log("Initializing settings for existing classroom selection..."),"string"!=typeof Tt.value&&"number"!=typeof Tt.value)return void console.warn("Invalid classroom ID detected:",Tt.value);$a.value.currentClassroomId!==Tt.value&&($a.value.currentClassroomId=Tt.value,console.log("Updated current classroom ID:",Tt.value));const e=Ia.value.my_sel_classroom_students.filter(e=>e&&e.id&&"string"==typeof e.name);e.length!==Ia.value.my_sel_classroom_students.length&&console.warn(`Found ${Ia.value.my_sel_classroom_students.length-e.length} invalid student records`);const l={...$a.value.attendance};let s=!1,o=0;if(e.forEach(e=>{e.id in l||(l[e.id]=!0,s=!0,o++)}),s){$a.value.attendance=l,console.log(`Initialized attendance for ${o} students in existing classroom`);try{Va()}catch(t){console.warn("Failed to save initial attendance settings:",t)}}try{Pa()}catch(a){console.warn("Post-initialization validation failed:",a)}}else console.log("No classroom selected during initialization")}catch(l){console.error("Error during settings initialization:",l),Xa(l,"initialize")}});try{!function(){var e,t,a,l,s,o;try{const n=localStorage.getItem(Nt);if(!n)return Rt.value=null,Mt.value=null,Pt.value=null,Jt.value=null,Tt.value="",Qt.value="",Ut.value="",!1;const i=JSON.parse(n);return Rt.value=null!=(e=i.semester)?e:null,Mt.value=null!=(t=i.week)?t:null,Pt.value=null!=(a=i.day)?a:null,Jt.value=null!=(l=i.periodNumber)?l:null,Qt.value=null!=(s=i.classroomName)?s:"",Ut.value=null!=(o=i.period_code)?o:"",!0}catch(n){return Rt.value=null,Mt.value=null,Pt.value=null,Jt.value=null,Tt.value="",Qt.value="",Ut.value="",console.warn("loadLastSelection failed",n),!1}}()}catch(a){console.warn("Failed to load last selection on init",a)}console.log("Reward system component initialization completed")}catch(l){console.error("Critical error during component mounting:",l),Dt.notify({message:"Application initialization failed",caption:l.message,color:"negative",position:"top",timeout:5e3,icon:"error",actions:[{label:"Reload Page",color:"white",handler:()=>window.location.reload()}]})}});let al=null;return k([Rt,Mt,Pt,Jt,Tt,Ut],()=>{try{try{const e=Rt.value,t=Mt.value,a=Pt.value,l=Jt.value;null!=e&&null!=t&&null!=a&&null!=l&&(Ut.value=`${e}.${t}.${a}.${l}`)}catch(e){console.warn("Failed to generate period_code",e)}al&&clearTimeout(al),al=setTimeout(()=>{Gt()},300)}catch(t){console.warn("Failed to auto-save last selection",t)}}),k(Tt,e=>{try{const t=(Ia.value.my_classes_with_students||[]).find(t=>t.id==e);Qt.value=(null==t?void 0:t.classroom_name)||""}catch(t){console.warn("Failed to sync classroom name for id",e,t)}},{immediate:!0}),(e,t)=>($(),N("div",H,[V(" ani_class:"+D(Ft.value)+" ",1),j(d,{class:"main-container-card shadow-lg rounded-2xl overflow-hidden"},{default:T(()=>[j(a,{class:"bg-white"},{default:T(()=>{var e,n;return[O("div",G,[O("div",K,[O("div",Y,[j(l,{color:"amber",icon:"emoji_events",label:"ðŸ† Show Leaderboard ðŸ†",onClick:t[0]||(t[0]=e=>{na.value=!0,Ea()}),class:"shadow-sm rounded-lg leaderboard-btn",size:"md",disable:!(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length)},{default:T(()=>{var e;return[j(s,{class:U((null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length)?"bg-amber text-white":"bg-grey-8 text-white"),anchor:"top middle",self:"bottom middle"},{default:T(()=>{var e,t;return[j(o,{name:(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length)?"emoji_events":"warning",size:"xs",class:"mr-1"},null,8,["name"]),V(" "+D((null==(t=Ia.value.my_sel_classroom_students)?void 0:t.length)?"View top 5 students with highest star points!":"Select a classroom first to view leaderboard"),1)]}),_:1},8,["class"])]}),_:1},8,["disable"]),j(l,{color:"grey-7",icon:"settings",label:"Settings",onClick:t[1]||(t[1]=e=>ca.value=!0),class:"shadow-sm rounded-lg settings-main-btn",size:"md"},{default:T(()=>[j(s,{class:"bg-grey-8 text-white",anchor:"top middle",self:"bottom middle"},{default:T(()=>[j(o,{name:"tune",size:"xs",class:"mr-1"}),t[22]||(t[22]=V(" Open classroom settings - manage avatar editing and attendance "))]),_:1})]),_:1})]),t[25]||(t[25]=O("div",{class:"mt-4"},null,-1)),O("div",Z,[j(p,{filled:"",modelValue:Rt.value,"onUpdate:modelValue":t[2]||(t[2]=e=>Rt.value=e),options:M(Bt),"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"Semester",class:"rounded-lg"},null,8,["modelValue","options"]),j(p,{filled:"",modelValue:Mt.value,"onUpdate:modelValue":t[3]||(t[3]=e=>Mt.value=e),options:M(Wt),"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"Week",class:"rounded-lg"},null,8,["modelValue","options"]),j(p,{filled:"",modelValue:Pt.value,"onUpdate:modelValue":t[4]||(t[4]=e=>Pt.value=e),options:M(qt),"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"Day",class:"rounded-lg"},null,8,["modelValue","options"]),j(p,{filled:"",modelValue:Jt.value,"onUpdate:modelValue":t[5]||(t[5]=e=>Jt.value=e),options:M(Ht),"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"Period Number",class:"rounded-lg"},null,8,["modelValue","options"]),Ia.value.my_classes_with_students?($(),F(p,{key:0,"onUpdate:modelValue":[t[6]||(t[6]=e=>{const t=(Ia.value.my_classes_with_students||[]).find(t=>t.id===e);t&&Qa(t.id,t.students)}),t[7]||(t[7]=e=>Tt.value=e)],filled:"",modelValue:Tt.value,options:(Ia.value.my_classes_with_students||[]).map(e=>{var t;return{label:`${e.classroom_name} (${(null==(t=e.students)?void 0:t.length)||0})`,value:e.id}}),"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"Classroom",class:"rounded-lg"},null,8,["modelValue","options"])):R("",!0),(null==(n=Ia.value.my_sel_classroom_students)?void 0:n.length)?($(),F(l,{key:1,color:"info",icon:"assessment",label:"Load  Summaries",onClick:Sa,class:"shadow-sm rounded-lg",size:"md",loading:ba.value},{default:T(()=>[j(s,{class:"bg-info text-white",anchor:"top middle",self:"bottom middle"},{default:T(()=>[j(o,{name:"assessment",size:"xs",class:"mr-1"}),t[23]||(t[23]=V(" Load behavior summaries for all students in this classroom "))]),_:1})]),_:1},8,["loading"])):R("",!0)]),O("div",X,[($(!0),N(P,null,J(Ia.value.my_sel_classroom_students,e=>($(),N("div",{class:"p-0 relative w-32 h-40 mt-12",key:e.id},[j(d,{class:U([[Ga.value(e.id),{"selected-card":Tt.value===e.id}],"absolute top-10 left-0 rounded-2xl shadow-lg transform hover:scale-105 transition-all duration-300 bg-gradient-to-br from-white via-blue-50 to-blue-100 border border-blue-100 cursor-pointer hover:z-50 hover:shadow-2xl hover:w-96"]),onClick:t=>Ka.value(e.id)?null:Tt.value=e.id,flat:""},{default:T(()=>[O("div",ee,[O("img",{src:e.avatar||ya(e.name),ratio:1,class:"w-32 h-32 absolute rounded-full -top-24 -left-5","spinner-color":"primary","spinner-size":"24px",loading:"lazy"},null,8,te),O("div",ae,[j(L,{name:"fade"},{default:T(()=>[Ha.value&&!Ka.value(e.id)?($(),N("div",le,[j(l,{round:"",dense:"",color:"white","text-color":"dark",icon:"photo_camera",onClick:B(t=>(async e=>{if($a.value.avatarEditingEnabled){ma.value=e,ga.value=!0;try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});pa.value=e,va.value&&(va.value.srcObject=e,await va.value.play())}catch(t){console.warn("Camera open failed",t),Dt.notify({message:"Camera not available",color:"negative"}),ga.value=!1}}else Dt.notify({message:"Avatar editing is currently disabled",color:"warning",position:"top"})})(e),["stop","prevent"]),class:"shadow-lg"},{default:T(()=>[j(s,{class:"bg-primary text-white text-sm rounded-lg px-2 py-1"},{default:T(()=>t[24]||(t[24]=[V(" ðŸ“· Take a photo! ")])),_:1})]),_:2},1032,["onClick"])])):R("",!0)]),_:2},1024),j(L,{name:"fade"},{default:T(()=>[!Ha.value||Ka.value(e.id)?($(),N("div",se,[j(l,{round:"",dense:"",color:"grey-5","text-color":"grey-7",icon:"photo_camera",disabled:""},{default:T(()=>[j(s,{class:"bg-grey-8 text-white text-sm rounded-lg px-2 py-1"},{default:T(()=>[V(" ðŸ˜´ "+D(Ka.value(e.id)?"Oops! They're not here today":"Camera is off"),1)]),_:2},1024)]),_:2},1024)])):R("",!0)]),_:2},1024)])]),j(a,{class:"text-left mt-6 pb-2 overflow-hidden"},{default:T(()=>[O("div",oe,[j(S,{ani_class:"neon-text-on-hover ",class:"block font-extrabold mb-1 neon-text-on-hover",text:Aa(e.name).firstName,colorA:"blue",colorB:"red"},null,8,["text"])]),Aa(e.name).lastName?($(),N("div",ne,D(Aa(e.name).lastName),1)):R("",!0),Aa(e.name).secondName?($(),N("div",ie,D(Aa(e.name).secondName),1)):R("",!0)]),_:2},1024),j(c,{class:"flex justify-between items-center px-5 py-3 bg-gradient-to-r from-blue-100 to-blue-50 rounded-b-2xl"},{default:T(()=>{var t;return[j(l,{round:"",dense:"",color:Ka.value(e.id)?"grey-5":"primary",icon:"star",glossy:"",onClick:B(t=>{return Ka.value(e.id)?null:(a=e.id,l=e.name,sa.value.id=a,sa.value.name=l,sa.value.f_l_name=za(l),la.value=!0,void _a(a));var a,l},["stop","prevent"]),disable:Ka.value(e.id),class:"shadow-sm"},{default:T(()=>[j(s,{class:U(["text-sm rounded-lg px-2 py-1",Ka.value(e.id)?"bg-grey-8 text-white":"bg-primary text-white"])},{default:T(()=>[V(" ðŸŒŸ "+D(Ka.value(e.id)?"Not available today":"Give a star!"),1)]),_:2},1032,["class"])]),_:2},1032,["color","onClick","disable"]),O("div",re,[O("div",de," ðŸŽ¯ "+D((null==(t=oa.value[e.id])?void 0:t.total)||0),1),j(L,{name:"fade"},{default:T(()=>{var t,a;return[(null==(t=oa.value[e.id])?void 0:t.positive)>0?($(),N("div",ce," ðŸŸ¢ +"+D(null==(a=oa.value[e.id])?void 0:a.positive),1)):R("",!0)]}),_:2},1024),j(L,{name:"fade"},{default:T(()=>{var t,a;return[(null==(t=oa.value[e.id])?void 0:t.negative)<0?($(),N("div",ue," ðŸ”´ "+D(null==(a=oa.value[e.id])?void 0:a.negative),1)):R("",!0)]}),_:2},1024)])]}),_:2},1024)]),_:2},1032,["class","onClick"])]))),128))]),O("div",me,[O("div",ge,[Ia.value.classes?($(),N("div",ve,[j(p,{filled:"",modelValue:Kt.value.classes,"onUpdate:modelValue":t[8]||(t[8]=e=>Kt.value.classes=e),options:Ia.value.classes,"option-value":"id","option-label":"name",multiple:"","emit-value":"","map-options":"",label:"Select Classes","use-chips":"",hint:"You can select multiple classes",class:"rounded-lg"},null,8,["modelValue","options"])])):R("",!0)])])])])]}),_:1}),j(n),j(a,null,{default:T(()=>[Lt.value.length?($(),N("div",fe,[O("div",be,D(Ot("common.preview")||"Table Preview"),1),j(n,{class:"my-4"}),O("div",ye,D(Ot("common.edit")||"Edit Configuration"),1),j(f,{flat:"",rows:Yt.value,columns:Zt.value,"row-key":"key",dense:""},{"body-cell-label":T(e=>[j(r,{modelValue:e.row.label,"onUpdate:modelValue":t=>e.row.label=t,outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),"body-cell-type":T(e=>[j(p,{modelValue:e.row.type,"onUpdate:modelValue":t=>e.row.type=t,options:["text","email","number","button","list"],outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),"body-cell-visible":T(e=>[j(i,{modelValue:e.row.visible,"onUpdate:modelValue":t=>e.row.visible=t,color:"primary"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["rows","columns"])])):($(),N("div",pe,D(Ot("common.noResults")||"No JSON data provided"),1))]),_:1})]),_:1}),j(u,{modelValue:ea.value,"onUpdate:modelValue":t[10]||(t[10]=e=>ea.value=e)},{default:T(()=>[j(d,{style:{"min-width":"500px"}},{default:T(()=>[j(a,null,{default:T(()=>[t[26]||(t[26]=O("div",{class:"text-lg font-semibold mb-2"},"Paste JSON Data",-1)),j(r,{modelValue:Xt.value,"onUpdate:modelValue":t[9]||(t[9]=e=>Xt.value=e),type:"textarea",autogrow:""},null,8,["modelValue"])]),_:1}),j(c,{align:"right"},{default:T(()=>[Q(j(l,{flat:"",label:"Cancel",color:"grey"},null,512),[[m]]),j(l,{flat:"",label:"Load",color:"primary",onClick:ta}),j(l,{flat:"",label:"Load Text",color:"primary",onClick:aa})]),_:1})]),_:1})]),_:1},8,["modelValue"]),j(u,{modelValue:la.value,"onUpdate:modelValue":t[13]||(t[13]=e=>la.value=e)},{default:T(()=>[j(d,{class:"q-pa-md",style:{"min-width":"500px","max-width":"800px"}},{default:T(()=>[j(a,{class:"row items-center justify-between"},{default:T(()=>[O("div",he," ðŸ§‘â€ðŸŽ“ "+D(sa.value.name),1),Q(j(l,{flat:"",round:"",icon:"close",dense:""},null,512),[[m]])]),_:1}),j(a,null,{default:T(()=>[O("div",we,[j(o,{name:"record_voice_over",color:"primary"}),t[27]||(t[27]=V(" Reading Aloud "))]),O("div",_e,[j(i,{modelValue:$a.value.readingAloudEnabled,"onUpdate:modelValue":t[11]||(t[11]=e=>$a.value.readingAloudEnabled=e),label:"Enable Reading Aloud",color:"primary",size:"lg",class:U(["mb-2 settings-toggle enhanced-settings-toggle",{"toggle-enabled":$a.value.readingAloudEnabled,"toggle-disabled":!$a.value.readingAloudEnabled}])},{default:T(()=>[j(s,{class:U(["bg-grey-8 text-white tooltip-enhanced",{"tooltip-success":$a.value.readingAloudEnabled,"tooltip-warning":!$a.value.readingAloudEnabled}]),anchor:"top middle",self:"bottom middle"},{default:T(()=>[j(o,{name:$a.value.readingAloudEnabled?"volume_up":"volume_off",size:"xs",class:"mr-1"},null,8,["name"]),V(" "+D($a.value.readingAloudEnabled?"Reading aloud is enabled - the app will play text aloud where supported":"Reading aloud is disabled - no text-to-speech will play"),1)]),_:1},8,["class"])]),_:1},8,["modelValue","class"]),O("div",Se,[j(o,{name:$a.value.readingAloudEnabled?"check_circle":"cancel",color:$a.value.readingAloudEnabled?"positive":"negative",size:"sm",class:U(["status-icon",{"icon-pulse":$a.value.readingAloudEnabled}])},{default:T(()=>[j(s,{class:U($a.value.readingAloudEnabled?"bg-positive text-white":"bg-negative text-white"),anchor:"top middle",self:"bottom middle"},{default:T(()=>[j(o,{name:$a.value.readingAloudEnabled?"thumb_up":"thumb_down",size:"xs",class:"mr-1"},null,8,["name"]),V(" Reading aloud is "+D($a.value.readingAloudEnabled?"active":"inactive"),1)]),_:1},8,["class"])]),_:1},8,["name","color","class"]),O("span",{class:U(["text-sm font-medium transition-all duration-300",$a.value.readingAloudEnabled?"text-positive":"text-negative"])},D($a.value.readingAloudEnabled?"Enabled":"Disabled"),3),O("div",{class:U(["ml-2 w-2 h-2 rounded-full transition-all duration-300",$a.value.readingAloudEnabled?"bg-positive shadow-green-glow animate-pulse":"bg-negative shadow-red-glow"])},null,2)])]),O("div",xe,[j(o,{name:"info",size:"xs",class:"mr-1"}),t[28]||(t[28]=V(" When enabled, the app will play text aloud where supported (text-to-speech) "))])]),_:1}),j(n),j(a,null,{default:T(()=>[j(W,{"student-id":sa.value.id,"student-name":sa.value.f_l_name,"period-code":Ut.value,behaviors:Na.value,summary:oa.value[sa.value.id]||{positive:0,negative:0,total:0},onRecorded:xa,onClose:t[12]||(t[12]=e=>la.value=!1)},null,8,["student-id","student-name","period-code","behaviors","summary"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),O("input",{ref_key:"fileInputRef",ref:ua,type:"file",accept:"image/*",style:{display:"none"},onChange:ha},null,544),j(u,{modelValue:ga.value,"onUpdate:modelValue":t[14]||(t[14]=e=>ga.value=e)},{default:T(()=>[j(d,{style:{"min-width":"500px"}},{default:T(()=>[j(_,{onCaptured:Vt,onCancel:$t})]),_:1})]),_:1},8,["modelValue"]),j(u,{modelValue:na.value,"onUpdate:modelValue":t[18]||(t[18]=e=>na.value=e),maximized:""},{default:T(()=>[j(d,{class:"leaderboard-dialog"},{default:T(()=>[j(a,{class:"leaderboard-header"},{default:T(()=>[O("div",Ee,[t[29]||(t[29]=O("div",{class:"trophy-animation"},"ðŸ†",-1)),t[30]||(t[30]=O("h1",{class:"leaderboard-title"},"Super Star Leaderboard!",-1)),t[31]||(t[31]=O("p",{class:"leaderboard-subtitle"},"Our Amazing Top 5 Students This Week! â­",-1)),j(l,{flat:"",round:"",icon:"close",color:"white",size:"lg",onClick:t[15]||(t[15]=e=>na.value=!1),class:"close-btn"})])]),_:1}),j(a,{class:"period-selector"},{default:T(()=>[O("div",ke,[j(b,{modelValue:da.value,"onUpdate:modelValue":[t[16]||(t[16]=e=>da.value=e),Ea],"toggle-color":"primary",options:[{label:"ðŸ“… This Week",value:"week"},{label:"ðŸ“† This Month",value:"month"},{label:"ðŸ—“ï¸ All Time",value:"all"}],class:"period-toggle"},null,8,["modelValue"]),j(l,{color:"primary",icon:"refresh",label:"Refresh",onClick:Ea,class:"refresh-btn"})])]),_:1}),j(a,{class:"leaderboard-content"},{default:T(()=>[ra.value?($(),N("div",Ie,[j(y,{size:"4rem",color:"primary"}),t[32]||(t[32]=O("p",{class:"loading-text"},"Loading our amazing students...",-1))])):0===ia.value.length?($(),N("div",Ce,t[33]||(t[33]=[O("div",{class:"empty-icon"},"ðŸ“š",-1),O("h3",null,"No stars earned yet!",-1),O("p",null,"Let's start earning some points and see who becomes our first super star!",-1)]))):($(),N("div",ze,[ia.value.length>=3?($(),N("div",Ae,[O("div",Ne,[ia.value[1]?($(),N("div",$e,[O("div",Ve,[O("div",je,[j(h,{src:ia.value[1].avatar||ya(ia.value[1].name),class:"avatar-img"},null,8,["src"]),t[34]||(t[34]=O("div",{class:"position-badge silver"},"2",-1))]),O("h3",Oe,D(Aa(ia.value[1].name).firstName),1),O("div",De,D(ia.value[1].total)+" â­",1),t[35]||(t[35]=O("div",{class:"medal"},"ðŸ¥ˆ",-1))]),t[36]||(t[36]=O("div",{class:"podium-base second-base"},"2nd",-1))])):R("",!0),ia.value[0]?($(),N("div",Te,[O("div",Ue,[O("div",Fe,[j(h,{src:ia.value[0].avatar||ya(ia.value[0].name),class:"avatar-img"},null,8,["src"]),t[37]||(t[37]=O("div",{class:"position-badge gold"},"1",-1)),t[38]||(t[38]=O("div",{class:"crown"},"ðŸ‘‘",-1))]),O("h3",Re,D(Aa(ia.value[0].name).firstName),1),O("div",Me,D(ia.value[0].total)+" â­",1),t[39]||(t[39]=O("div",{class:"medal"},"ðŸ¥‡",-1))]),t[40]||(t[40]=O("div",{class:"podium-base first-base"},"1st",-1))])):R("",!0),ia.value[2]?($(),N("div",Pe,[O("div",Je,[O("div",Qe,[j(h,{src:ia.value[2].avatar||ya(ia.value[2].name),class:"avatar-img"},null,8,["src"]),t[41]||(t[41]=O("div",{class:"position-badge bronze"},"3",-1))]),O("h3",Le,D(Aa(ia.value[2].name).firstName),1),O("div",Be,D(ia.value[2].total)+" â­",1),t[42]||(t[42]=O("div",{class:"medal"},"ðŸ¥‰",-1))]),t[43]||(t[43]=O("div",{class:"podium-base third-base"},"3rd",-1))])):R("",!0)])])):R("",!0),ia.value.length>3?($(),N("div",We,[($(!0),N(P,null,J(ia.value.slice(3,5),(e,t)=>($(),N("div",{key:e.id,class:"student-row"},[O("div",qe,D(t+4),1),O("div",He,[j(h,{src:e.avatar||ya(e.name),class:"row-avatar-img"},null,8,["src"])]),O("div",Ge,[O("h4",Ke,D(Aa(e.name).firstName)+" "+D(Aa(e.name).lastName),1),O("div",Ye,D(e.total)+" â­ points",1)]),O("div",Ze,D(0===t?"ðŸŒŸ":"â­"),1)]))),128))])):R("",!0),ia.value.length>0?($(),N("div",Xe,[t[50]||(t[50]=O("h3",{class:"recognition-title"},"ðŸŽ‰ Special Recognition! ðŸŽ‰",-1)),O("div",et,[ia.value[0]?($(),N("div",tt,[t[44]||(t[44]=O("div",{class:"card-icon"},"ðŸ‘‘",-1)),t[45]||(t[45]=O("div",{class:"card-title"},"Super Star Champion!",-1)),O("div",at,D(Aa(ia.value[0].name).firstName),1)])):R("",!0),ia.value[1]?($(),N("div",lt,[t[46]||(t[46]=O("div",{class:"card-icon"},"ðŸŒŸ",-1)),t[47]||(t[47]=O("div",{class:"card-title"},"Amazing Achiever!",-1)),O("div",st,D(Aa(ia.value[1].name).firstName),1)])):R("",!0),ia.value[2]?($(),N("div",ot,[t[48]||(t[48]=O("div",{class:"card-icon"},"â­",-1)),t[49]||(t[49]=O("div",{class:"card-title"},"Fantastic Friend!",-1)),O("div",nt,D(Aa(ia.value[2].name).firstName),1)])):R("",!0)])])):R("",!0)]))]),_:1}),j(a,{class:"leaderboard-footer"},{default:T(()=>[O("div",it,[t[51]||(t[51]=O("p",{class:"encouragement-message"}," ðŸŒŸ Every student is a star! Keep being awesome and earning those points! ðŸŒŸ ",-1)),j(l,{color:"primary",label:"ðŸŽ¯ Back to Classroom",onClick:t[17]||(t[17]=e=>na.value=!1),class:"back-btn",size:"lg"})])]),_:1})]),_:1})]),_:1},8,["modelValue"]),j(u,{modelValue:ca.value,"onUpdate:modelValue":t[21]||(t[21]=e=>ca.value=e)},{default:T(()=>[j(d,{style:{"min-width":"600px","max-width":"800px"}},{default:T(()=>{var e;return[j(a,null,{default:T(()=>[O("div",rt,[j(o,{name:"settings",color:"primary"}),t[52]||(t[52]=V(" Classroom Settings "))])]),_:1}),j(n),j(a,null,{default:T(()=>[O("div",dt,[j(o,{name:"photo_camera",color:"primary"}),t[53]||(t[53]=V(" Avatar Management "))]),O("div",ct,[j(i,{modelValue:$a.value.avatarEditingEnabled,"onUpdate:modelValue":t[19]||(t[19]=e=>$a.value.avatarEditingEnabled=e),label:"Enable Avatar Editing",color:"primary",size:"lg",class:U(["mb-2 settings-toggle enhanced-settings-toggle",{"toggle-enabled":$a.value.avatarEditingEnabled,"toggle-disabled":!$a.value.avatarEditingEnabled}])},{default:T(()=>[j(s,{class:U(["bg-grey-8 text-white tooltip-enhanced",{"tooltip-success":$a.value.avatarEditingEnabled,"tooltip-warning":!$a.value.avatarEditingEnabled}]),anchor:"top middle",self:"bottom middle"},{default:T(()=>[j(o,{name:$a.value.avatarEditingEnabled?"photo_camera":"photo_camera_off",size:"xs",class:"mr-1"},null,8,["name"]),V(" "+D($a.value.avatarEditingEnabled?"Avatar editing is currently enabled - students can upload/capture photos":"Avatar editing is currently disabled - students cannot change photos"),1)]),_:1},8,["class"])]),_:1},8,["modelValue","class"]),O("div",ut,[j(o,{name:$a.value.avatarEditingEnabled?"check_circle":"cancel",color:$a.value.avatarEditingEnabled?"positive":"negative",size:"sm",class:U(["status-icon",{"icon-pulse":$a.value.avatarEditingEnabled}])},{default:T(()=>[j(s,{class:U($a.value.avatarEditingEnabled?"bg-positive text-white":"bg-negative text-white"),anchor:"top middle",self:"bottom middle"},{default:T(()=>[j(o,{name:$a.value.avatarEditingEnabled?"thumb_up":"thumb_down",size:"xs",class:"mr-1"},null,8,["name"]),V(" Avatar editing is "+D($a.value.avatarEditingEnabled?"active":"inactive"),1)]),_:1},8,["class"])]),_:1},8,["name","color","class"]),O("span",{class:U(["text-sm font-medium transition-all duration-300",$a.value.avatarEditingEnabled?"text-positive":"text-negative"])},D($a.value.avatarEditingEnabled?"Enabled":"Disabled"),3),O("div",{class:U(["ml-2 w-2 h-2 rounded-full transition-all duration-300",$a.value.avatarEditingEnabled?"bg-positive shadow-green-glow animate-pulse":"bg-negative shadow-red-glow"])},null,2)])]),O("div",mt,[j(o,{name:"info",size:"xs",class:"mr-1"}),t[54]||(t[54]=V(" When enabled, students can upload or capture new profile pictures "))])]),_:1}),j(n),(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length)?($(),F(a,{key:0},{default:T(()=>{var e,a,n,r,d;return[t[56]||(t[56]=O("div",{class:"text-subtitle1 mb-3 font-semibold"},"Student Attendance",-1)),t[57]||(t[57]=O("div",{class:"text-caption text-grey-6 mb-4"}," Mark students as present or absent. Absent students will appear grayed out. ",-1)),O("div",gt,[($(!0),N(P,null,J(Ia.value.my_sel_classroom_students,e=>($(),N("div",{key:e.id,class:U(["attendance-item flex items-center justify-between p-3 rounded-lg mb-2 transition-all duration-300 hover:shadow-md",[qa(e.id)?"bg-green-50 hover:bg-green-100 border-l-4 border-green-400 attendance-present":"bg-red-50 hover:bg-red-100 border-l-4 border-red-400 attendance-absent"]])},[O("div",vt,[O("div",pt,[j(g,{size:"40px",class:"attendance-avatar"},{default:T(()=>[j(h,{src:e.avatar||ya(e.name),class:U(["rounded-full transition-all duration-300",{"grayscale opacity-60 blur-sm":!qa(e.id)}])},null,8,["src","class"])]),_:2},1024),O("div",ft,[j(o,{name:qa(e.id)?"check_circle":"cancel",color:qa(e.id)?"positive":"negative",size:"sm",class:U(["bg-white rounded-full shadow-sm attendance-status-icon",{"pulse-animation":!qa(e.id)}])},{default:T(()=>[j(s,{class:U(qa(e.id)?"bg-positive text-white":"bg-negative text-white"),anchor:"top middle",self:"bottom middle"},{default:T(()=>[j(o,{name:qa(e.id)?"person":"person_off",size:"xs",class:"mr-1"},null,8,["name"]),V(" "+D(Aa(e.name).firstName)+" is "+D(qa(e.id)?"present":"absent"),1)]),_:2},1032,["class"])]),_:2},1032,["name","color","class"])]),O("div",{class:U(["absolute inset-0 rounded-full border-2 transition-all duration-300",qa(e.id)?"border-green-400 shadow-green-glow":"border-red-400 shadow-red-glow"])},null,2)]),O("div",bt,[O("div",{class:U(["font-medium transition-all duration-300",qa(e.id)?"text-grey-8":"text-grey-5 line-through"])},[V(D(Aa(e.name).firstName)+" "+D(Aa(e.name).lastName)+" ",1),qa(e.id)?R("",!0):($(),F(o,{key:0,name:"visibility_off",size:"xs",class:"ml-1 text-grey-4"}))],2),Aa(e.name).secondName?($(),N("div",{key:0,class:U(["text-sm transition-all duration-300",qa(e.id)?"text-grey-6":"text-grey-4"])},D(Aa(e.name).secondName),3)):R("",!0)])]),O("div",yt,[j(v,{color:qa(e.id)?"positive":"negative","text-color":"white",size:"sm",class:U(["font-medium attendance-chip transition-all duration-300",{"chip-pulse":!qa(e.id)}]),icon:qa(e.id)?"person":"person_off"},{default:T(()=>[V(D(qa(e.id)?"Present":"Absent")+" ",1),j(s,{class:U(qa(e.id)?"bg-positive text-white":"bg-negative text-white"),anchor:"top middle",self:"bottom middle"},{default:T(()=>[j(o,{name:qa(e.id)?"check":"close",size:"xs",class:"mr-1"},null,8,["name"]),V(" "+D(Aa(e.name).firstName)+" is currently marked as "+D(qa(e.id)?"present":"absent"),1)]),_:2},1032,["class"])]),_:2},1032,["color","class","icon"]),j(i,{"model-value":qa(e.id),"onUpdate:modelValue":t=>(e=>{var t;try{if(!e||"string"!=typeof e&&"number"!=typeof e)throw new Error("Invalid student ID provided");if(!(null==(t=Ia.value.my_sel_classroom_students)?void 0:t.some(t=>t.id.toString()===e.toString())))throw new Error(`Student ID ${e} not found in current classroom`);const a=qa(e);$a.value.attendance[e]=!a;const l=Ia.value.my_sel_classroom_students.find(t=>t.id.toString()===e.toString()),s=l?Aa(l.name).firstName:`Student ${e}`;Dt.notify({message:`${s} marked as ${a?"absent":"present"}`,color:a?"warning":"positive",position:"top",timeout:2e3,icon:a?"person_off":"person"}),console.log(`Toggled attendance for student ${e}: ${a?"absent":"present"}`)}catch(a){console.error("Error toggling student attendance:",a),Dt.notify({message:`Failed to update attendance: ${a.message}`,color:"negative",position:"top",timeout:3e3,icon:"error"})}})(e.id),color:qa(e.id)?"positive":"negative",size:"md",class:U(["attendance-toggle enhanced-toggle",{"toggle-absent":!qa(e.id)}])},{default:T(()=>[j(s,{class:"bg-grey-8 text-white tooltip-enhanced",anchor:"top middle",self:"bottom middle"},{default:T(()=>[j(o,{name:qa(e.id)?"toggle_off":"toggle_on",size:"xs",class:"mr-1"},null,8,["name"]),V(" Click to mark "+D(Aa(e.name).firstName)+" as "+D(qa(e.id)?"absent":"present"),1)]),_:2},1024)]),_:2},1032,["model-value","onUpdate:modelValue","color","class"])])],2))),128))]),O("div",ht,[j(l,{color:"positive",icon:"check_circle",label:"Mark All Present",onClick:Ya,size:"sm",class:U(["flex-1 attendance-action-btn enhanced-action-btn",{"btn-success-glow":null==(e=Ia.value.my_sel_classroom_students)?void 0:e.every(e=>qa(e.id))}])},{default:T(()=>[j(s,{class:"bg-positive text-white tooltip-enhanced"},{default:T(()=>{var e;return[j(o,{name:"group",size:"xs",class:"mr-1"}),V(" Mark all "+D((null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length)||0)+" students in this classroom as present ",1)]}),_:1})]),_:1},8,["class"]),j(l,{color:"negative",icon:"cancel",label:"Mark All Absent",onClick:Za,size:"sm",class:U(["flex-1 attendance-action-btn enhanced-action-btn",{"btn-warning-glow":null==(a=Ia.value.my_sel_classroom_students)?void 0:a.every(e=>!qa(e.id))}])},{default:T(()=>[j(s,{class:"bg-negative text-white tooltip-enhanced"},{default:T(()=>{var e;return[j(o,{name:"group_off",size:"xs",class:"mr-1"}),V(" Mark all "+D((null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length)||0)+" students in this classroom as absent ",1)]}),_:1})]),_:1},8,["class"])]),O("div",wt,[O("div",_t,[O("div",St,[j(o,{name:"group",color:"primary",size:"sm"}),t[55]||(t[55]=O("span",{class:"font-medium"},"Attendance Summary:",-1))]),O("div",xt,[O("div",Et,[j(o,{name:"check_circle",color:"positive",size:"xs"}),O("span",kt,D((null==(n=Ia.value.my_sel_classroom_students)?void 0:n.filter(e=>qa(e.id)).length)||0)+" Present ",1)]),O("div",It,[j(o,{name:"cancel",color:"negative",size:"xs"}),O("span",Ct,D((null==(r=Ia.value.my_sel_classroom_students)?void 0:r.filter(e=>!qa(e.id)).length)||0)+" Absent ",1)])])]),O("div",zt,[j(w,{value:(null==(d=Ia.value.my_sel_classroom_students)?void 0:d.length)?Ia.value.my_sel_classroom_students.filter(e=>qa(e.id)).length/Ia.value.my_sel_classroom_students.length:0,color:"positive","track-color":"negative",size:"8px",rounded:"",class:"attendance-progress"},{default:T(()=>[j(s,{class:"bg-grey-8 text-white"},{default:T(()=>{var e;return[V(D(Math.round(100*((null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length)?Ia.value.my_sel_classroom_students.filter(e=>qa(e.id)).length/Ia.value.my_sel_classroom_students.length:0)))+"% attendance rate ",1)]}),_:1})]),_:1},8,["value"])])])]}),_:1})):($(),F(a,{key:1},{default:T(()=>[O("div",At,[j(o,{name:"school",size:"4rem",class:"mb-4"}),t[58]||(t[58]=O("div",{class:"text-h6 mb-2"},"No Classroom Selected",-1)),t[59]||(t[59]=O("div",{class:"text-body2"}," Please select a classroom to manage student attendance ",-1))])]),_:1})),j(n),j(c,{align:"right",class:"q-pa-md"},{default:T(()=>{var e;return[(null==(e=Ia.value.my_classes_with_students)?void 0:e.length)>1?($(),F(l,{key:0,flat:"",label:"Test Classroom Switching",color:"info",onClick:La,size:"sm",class:"mr-2"},{default:T(()=>[j(s,{class:"bg-info text-white"},{default:T(()=>[j(o,{name:"swap_horiz",size:"xs",class:"mr-1"}),t[60]||(t[60]=V(" Test settings behavior by switching between all available classrooms "))]),_:1})]),_:1})):R("",!0),j(l,{flat:"",label:"Close",color:"grey",onClick:t[20]||(t[20]=e=>ca.value=!1),size:"md"})]}),_:1})]}),_:1})]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-82c92ec7"]]);export{$t as default};
