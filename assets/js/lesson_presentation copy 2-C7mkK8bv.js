import{o as e,u as t,bq as i,br as o,p as a,Q as s,m as n,c as l,d as r,aP as d,b as c}from"./app-C-NJhdpe.js";import{Q as u}from"./QSpace-Bn7M2Abx.js";import{f as p,a as m,k as f,o as v,L as g,I as y,M as b,b as w,J as h,y as _,H as x,O as j,V as S,x as Q,ab as P,aa as C,F as L,Q as D,U as T,an as V,am as $,Z as k}from"./vendor-CUZ9QTQV.js";import U from"./TextSlide-Df5Jc84q.js";import q from"./MediaSlide-DgHNKC8p.js";import{Q as z}from"./QuestionSlide-u0n56UiZ.js";import E from"./LessonSidebar-DV2eYAXP.js";import I from"./LessonPlayer-C5aG7QcM.js";import{u as O}from"./teacherStore-DrPGRQaY.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";import"./RichTextEditor-B7pA9WRL.js";import"./QColor-AENRVZHO.js";import"./QSlider-BYqguEYs.js";import"./QTabs-C8Sz98qV.js";import"./rtl-Cr6c3OOr.js";import"./QTab-C_vkYR0k.js";import"./QTabPanels-bY91sdlT.js";import"./use-panel-CGzbevm7.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanel-zhJc0Joi.js";import"./purify.es-C2Ba6vpb.js";import"./MathEditor-DlzSQi7W.js";import"./katex-BXKQVcz-.js";import"./MathPastePreview-BvEJhsyE.js";import"./QBadge-D_SrvMy0.js";import"./QSelect-B3f0Rrq3.js";import"./EnhancedQuestionEditor-DhJVwAkh.js";import"./QuestionEditor-Dvtnk2op.js";import"./StepByStepEditor-DqB7CNlc.js";import"./QuestionTypeSelector-Dus9wpB8.js";import"./QuizEngine-D4cMagJm.js";import"./useQuizI18n-RdF52uR0.js";import"./QSpinnerDots-BFT-tKRa.js";import"./QPage-BEppkzfh.js";import"./QPageContainer-CpNn50oF.js";import"./QLayout-J4gd82wJ.js";import"./PlayerSidebar-8KQ1Vahh.js";import"./QDrawer-C7E1z0eN.js";import"./SectionCard-DJLVGWMa.js";import"./SectionBanner-Coh7KQQK.js";import"./QLinearProgress-DLQRR2k-.js";import"./SlideRenderer-Bo8oM-xv.js";import"./FingerDrawingSlide-B8iEwzXi.js";import"./QPopupProxy-D8p5Hvz_.js";import"./NavigationFooter-CSTWFaHK.js";import"./DrawingOverlay-BQwxC0tj.js";import"./DrawingCanvas-D-za4DeL.js";import"./DrawingToolbar-khKpjIHq.js";import"./QBtnToggle-CGKDwXD9.js";import"./SlideAnnotationOverlay-B3I80Lsq.js";const F={class:"flex bg-gray-50 overflow-hidden"},M={class:"flex-1 flex flex-col overflow-hidden"},A={class:"bg-white border-b border-gray-200 px-6 py-3"},B={class:"flex items-center justify-between"},R={class:"flex gap-2"},N={class:"bg-white border-b border-gray-200 px-6 py-4"},H={class:"flex items-start justify-between mb-4"},G={class:"flex-1 mr-4"},J={class:"flex gap-4 mt-2"},Z=["value"],K={class:"flex gap-3 pt-24"},W={class:"flex w-full flex-col"},X={class:"flex-1 overflow-y-auto p-8 bg-gray-50 flex justify-center"},Y={class:"w-full max-w-4xl bg-white rounded-xl shadow-sm border border-gray-200 min-h-[600px] p-2"},ee={key:0,class:"min-h-full flex flex-col"},te={class:"mb-2 flex justify-between items-center border-b pb-1"},ie={class:"flex-1"},oe={key:1,class:"h-full flex flex-col items-center justify-center text-gray-400"},ae={class:"text-h6 flex items-center gap-2"},se=e({__name:"lesson_presentation copy 2",props:{presentationId:{type:[Number,String],default:null},defaultContext:{type:Object,default:()=>({school_id:1,teacher_id:1,subject_id:1})},sections:{type:Array,default:()=>[]}},setup(e){const se=e,ne=O(),le=t(),re=new URLSearchParams(window.location.search).get("id"),de=se.presentationId||re,ce=p({name:"New Lesson",description:"Lesson description",grade_id:null,quiz_id:null,slides:[]}),ue=p(se.sections),pe=p("learn"),me=p(null),fe=p([]),ve=p(0),ge=p(!1),ye=p(!1),be=p(!0);p(!0);const we=m({get:()=>!le.screen.lt.sm&&be.value,set(e){be.value=e}});m(()=>{const e=ue.value.find(e=>e.id===pe.value);return e?`Section: ${e.title}`:"Select a section"});const he=m(()=>fe.value.filter(e=>e.section===pe.value)),_e=m(()=>0===he.value.length?null:he.value[ve.value]),xe=e=>{switch(e){case"text":default:return U;case"question":return z;case"image":case"video":case"audio":case"pdf":return q}},je=()=>{const e={slide_type:"text",slide_content:{},section:pe.value};fe.value.push(e),ve.value=he.value.length-1},Se=e=>{const t=document.createElement("DIV");return t.innerHTML=e||"",t.textContent||t.innerText||""},Qe=async()=>{if((()=>{var e,t;if(!ce.value.name.trim())return le.notify({type:"warning",message:"Please enter a lesson name",icon:"warning",position:"top"}),!1;if(!ce.value.grade_id)return le.notify({type:"warning",message:"Please select a grade",icon:"warning",position:"top"}),!1;for(let i=0;i<fe.value.length;i++){const o=fe.value[i];if("question"===o.slide_type){const t=(null==(e=o.slide_content)?void 0:e.questions)||[];if(0===t.length)return le.notify({type:"warning",message:`Slide ${i+1}: Please add at least one question`,icon:"warning",position:"top"}),ve.value=i,!1;for(let e=0;e<t.length;e++){const o=t[e];if(!Se(o.text).trim())return le.notify({type:"warning",message:`Slide ${i+1}, Question ${e+1}: Question text cannot be empty`,icon:"warning",position:"top"}),ve.value=i,!1;if(["short_answer","number"].includes(o.type)&&!o.correct_answer)return le.notify({type:"warning",message:`Slide ${i+1}, Question ${e+1}: Please provide a correct answer`,icon:"warning",position:"top"}),ve.value=i,!1;if("single_choice"===o.type&&!o.correct_answer)return le.notify({type:"warning",message:`Slide ${i+1}, Question ${e+1}: Please select a correct option`,icon:"warning",position:"top"}),ve.value=i,!1;if(["single_choice","multiple_choice"].includes(o.type)){if(!o.options||o.options.length<2)return le.notify({type:"warning",message:`Slide ${i+1}, Question ${e+1}: Must have at least 2 options`,icon:"warning",position:"top"}),ve.value=i,!1;for(let t=0;t<o.options.length;t++)if(!Se(o.options[t].text).trim())return le.notify({type:"warning",message:`Slide ${i+1}, Question ${e+1}, Option ${t+1}: Option text cannot be empty`,icon:"warning",position:"top"}),ve.value=i,!1}}}else if("text"===o.slide_type&&!Se(null==(t=o.slide_content)?void 0:t.text).trim())return le.notify({type:"warning",message:`Slide ${i+1}: Text content cannot be empty`,icon:"warning",position:"top"}),ve.value=i,!1}return!0})()){ge.value=!0;try{const e={...ce.value,school_id:se.defaultContext.school_id,teacher_id:se.defaultContext.teacher_id,subject_id:se.defaultContext.subject_id,grade_id:ce.value.grade_id||se.defaultContext.grade_id};let t;t=de?await k.put(route("lesson-presentation.update",{id:de}),e):await k.post(route("lesson-presentation.store"),e);const i=t.data;for(const o of fe.value)o.id?await k.put(route("lesson-presentation.slides.update",{id:i.id,slideId:o.id}),o):await k.post(route("lesson-presentation.slides.add",{id:i.id}),o);if(le.notify({type:"positive",message:"Lesson saved successfully!",icon:"check_circle",position:"top",timeout:2e3}),!de&&i.id){const e=new URL(window.location);e.searchParams.set("id",i.id),window.history.pushState({},"",e)}}catch(e){console.error("Save failed:",e),le.notify({type:"negative",message:"Failed to save lesson. Please try again.",icon:"error",position:"top",timeout:3e3})}finally{ge.value=!1}}},Pe=()=>{window.location.href="/lesson-presentation/edit"},Ce=async()=>{if(de)try{le.notify({type:"info",message:"Duplicating lesson...",icon:"content_copy",position:"top",timeout:1e3});const e={...ce.value,name:`${ce.value.name} (Copy)`,school_id:se.defaultContext.school_id,teacher_id:se.defaultContext.teacher_id,subject_id:se.defaultContext.subject_id},t=(await k.post(route("lesson-presentation.store"),e)).data;for(const i of fe.value){const e={slide_type:i.slide_type,slide_content:i.slide_content,section:i.section};await k.post(route("lesson-presentation.slides.add",{id:t.id}),e)}le.notify({type:"positive",message:"Lesson duplicated successfully!",icon:"check_circle",position:"top",timeout:2e3}),setTimeout(()=>{window.location.href=`/lesson-presentation/edit?id=${t.id}`},500)}catch(e){console.error("Duplicate failed:",e),le.notify({type:"negative",message:"Failed to duplicate lesson",icon:"error",position:"top",timeout:3e3})}};return f(pe,()=>{ve.value=0}),v(async()=>{await ne.fetchTeacherData(),de?(async e=>{try{const t=await k.get(route("lesson-presentation.show",{id:e}));ce.value={name:t.data.name,description:t.data.description,grade_id:t.data.grade_id,quiz_id:t.data.quiz_id},fe.value=(t.data.slides||[]).map(e=>({...e,section:e.section||"learn"}))}catch(t){console.error("Fetch failed:",t),le.notify({type:"negative",message:"Failed to load lesson",icon:"error",position:"top"})}})(de):(0===fe.value.length&&je(),ne.grades.length>0&&(ce.value.grade_id=ne.grades[0].id))}),(e,t)=>(y(),g(L,null,[b("div",F,[b("div",M,[b("div",A,[b("div",B,[w(o,{class:"text-sm"},{default:h(()=>[w(i,{icon:"home",label:"Dashboard",to:"/dashboard"}),w(i,{icon:"school",label:"Lessons",to:"/lesson-presentation"}),w(i,{icon:"edit",label:_(de)?"Edit Lesson":"New Lesson"},null,8,["label"])]),_:1}),b("div",R,[w(s,{flat:"",dense:"",icon:"list",label:"All Lessons",color:"primary",size:"sm",to:"/lesson-presentation"},{default:h(()=>[w(a,null,{default:h(()=>t[11]||(t[11]=[S("View all lessons")])),_:1})]),_:1}),w(s,{flat:"",dense:"",icon:"add_circle",label:"New Lesson",color:"positive",size:"sm",onClick:Pe},{default:h(()=>[w(a,null,{default:h(()=>t[12]||(t[12]=[S("Create a new lesson")])),_:1})]),_:1}),_(de)?(y(),x(s,{key:0,flat:"",dense:"",icon:"content_copy",label:"Duplicate",color:"secondary",size:"sm",onClick:Ce},{default:h(()=>[w(a,null,{default:h(()=>t[13]||(t[13]=[S("Duplicate this lesson")])),_:1})]),_:1})):j("",!0)])])]),b("div",N,[b("div",H,[b("div",G,[Q(b("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>ce.value.name=e),class:"text-xl font-bold text-gray-800 border-none focus:ring-0 p-0 w-full bg-transparent placeholder-gray-400",placeholder:"Untitled Lesson"},null,512),[[P,ce.value.name]]),b("div",J,[Q(b("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>ce.value.description=e),class:"text-sm text-gray-500 border-none focus:ring-0 p-0 flex-1 bg-transparent placeholder-gray-400",placeholder:"Add a description..."},null,512),[[P,ce.value.description]]),Q(b("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>ce.value.grade_id=e),class:"text-sm border-gray-200 rounded-md text-gray-600 py-1 pl-2 pr-8 bg-transparent focus:ring-0 focus:border-blue-500"},[t[14]||(t[14]=b("option",{value:null,disabled:""},"Select Grade",-1)),(y(!0),g(L,null,D(_(ne).grades,e=>(y(),g("option",{key:e.id,value:e.id},T(e.name),9,Z))),128))],512),[[C,ce.value.grade_id]])])]),b("div",K,[w(s,{outline:"",color:"primary",icon:"visibility",label:"Preview",onClick:t[3]||(t[3]=e=>ye.value=!0),disable:!_(de)},{default:h(()=>[_(de)?j("",!0):(y(),x(a,{key:0},{default:h(()=>t[15]||(t[15]=[S("Save the lesson first to preview")])),_:1}))]),_:1},8,["disable"]),w(s,{color:"positive",icon:"save",label:"Save",onClick:Qe,loading:ge.value},null,8,["loading"])])])]),b("div",W,[w(E,{sections:ue.value,currentSection_data:me.value,"onUpdate:currentSection_data":t[4]||(t[4]=e=>me.value=e),currentSection:pe.value,"onUpdate:currentSection":t[5]||(t[5]=e=>pe.value=e),slides:fe.value,showDrawer:we.value,"onUpdate:showDrawer":t[6]||(t[6]=e=>we.value=e),"can-edit":!0,"active-slide":_e.value,onSelectSlide:t[7]||(t[7]=e=>ve.value=he.value.indexOf(e)),onAddSlide:je},null,8,["sections","currentSection_data","currentSection","slides","showDrawer","active-slide"])]),b("div",X,[b("div",Y,[_e.value?(y(),g("div",ee,[b("div",te,[t[17]||(t[17]=b("h3",{class:"text-lg font-medium text-gray-700"},"Edit Slide Content",-1)),Q(b("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>_e.value.slide_type=e),class:"border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},t[16]||(t[16]=[V('<option value="text" data-v-b55f77a4>Text Slide</option><option value="image" data-v-b55f77a4>Image Slide</option><option value="video" data-v-b55f77a4>Video Slide</option><option value="audio" data-v-b55f77a4>Audio Slide</option><option value="pdf" data-v-b55f77a4>PDF Slide</option><option value="question" data-v-b55f77a4>Question Slide</option>',6)]),512),[[C,_e.value.slide_type]])]),b("div",ie,[(y(),x($(xe(_e.value.slide_type)),{modelValue:_e.value.slide_content,"onUpdate:modelValue":t[9]||(t[9]=e=>_e.value.slide_content=e)},null,8,["modelValue"]))])])):(y(),g("div",oe,t[18]||(t[18]=[b("i",{class:"fas fa-layer-group text-4xl mb-4"},null,-1),b("p",null,"Select a slide to edit or create a new one",-1)])))])])])]),w(c,{modelValue:ye.value,"onUpdate:modelValue":t[10]||(t[10]=e=>ye.value=e),maximized:""},{default:h(()=>[w(n,{class:"bg-white"},{default:h(()=>[w(l,{class:"row items-center q-pb-none bg-primary text-white"},{default:h(()=>[b("div",ae,[w(r,{name:"visibility",size:"28px"}),t[19]||(t[19]=S(" Student View Preview "))]),w(u),Q(w(s,{icon:"close",flat:"",round:"",dense:""},null,512),[[d]])]),_:1}),w(l,{class:"q-pa-none",style:{height:"calc(100vh - 60px)"}},{default:h(()=>[w(I,{presentation:{...ce.value,name:"Preview: "+ce.value.name},sections:ue.value,slides:fe.value,"is-preview":!0},null,8,["presentation","sections","slides"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},[["__scopeId","data-v-b55f77a4"]]);export{se as default};
