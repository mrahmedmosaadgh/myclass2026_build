import{r as e,u as a,f as s,j as t,k as l,l as o,h as i,p as n,b as u,d as r,Q as c,i as d,s as v,y as p,E as m,z as _,A as f}from"./app-Dtv5Fi9L.js";import{Q as g}from"./QSelect-BslHFD89.js";import{Q as y}from"./QBadge-B7PIhVlN.js";import{f as b,o as h,e as w,N as q,J as x,b as z,R as S,z as k,a4 as V,K as j,ag as C,ah as F,W as A,V as Q,I as T,O as I,U,F as N,Q as $,_ as E}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";const L={class:"teacher-test-page"},M={key:0,class:"session-setup"},P={class:"question-selector"},O={class:"session-settings"},G={key:1,class:"session-control"},J={class:"access-code"},B={class:"row items-center q-gutter-sm"},H={class:"control-buttons-grid"},R=e({__name:"TeacherTestPage",setup(e){const R=a(),D=b(null),K=b(null),W=b({questions:[]}),X=b([]),Y=b(!1),Z=b(0),ee=b(null),ae=b({timer:60,auto_submit:!0,show_correct_answer:!1});let se=null;const te=async()=>{try{const e=await E.get("/api/questions");W.value=e.data.data||e.data}catch(e){console.error("Failed to load questions:",e),R.notify({type:"negative",message:"Failed to load questions"})}},le=(e,a)=>{a(()=>{""===e?te():e.toLowerCase()})},oe=async()=>{Y.value=!0;try{const e=await E.post("/api/quiz-sessions",{settings:ae.value});D.value=e.data.session;const a=p(_,`quiz_sessions/${D.value.access_code}`);await m(a,{status:"waiting",current_question_id:null,participants:{}}),ie(),R.notify({type:"positive",message:"Session created successfully"})}catch(e){console.error("Failed to create session:",e),R.notify({type:"negative",message:"Failed to create session"})}finally{Y.value=!1}},ie=()=>{console.log("Setting up Firebase listeners for code:",D.value.access_code);const e=p(_,`quiz_sessions/${D.value.access_code}/participants`);se=f(e,e=>{const a=e.val();console.log("Firebase participants update:",a),a?(X.value=Object.values(a),console.log("Participants array:",X.value)):X.value=[]})},ne=async()=>{var e;if(K.value)try{await E.post(`/api/quiz-sessions/${D.value.id}/state`,{action:"start",question_id:K.value.id});const a=p(_,`quiz_sessions/${D.value.access_code}`),s=JSON.parse(JSON.stringify(K.value));await m(a,{status:"active",current_question_id:K.value.id,current_question:s}),D.value.status="active",ae.value.timer&&(e=ae.value.timer,Z.value=e,ee.value&&clearInterval(ee.value),ee.value=setInterval(()=>{Z.value--,Z.value<=0&&clearInterval(ee.value)},1e3)),R.notify({type:"positive",message:"Session started"})}catch(a){console.error("Failed to start session:",a)}},ue=async()=>{try{await E.post(`/api/quiz-sessions/${D.value.id}/state`,{action:"pause"}),ee.value&&clearInterval(ee.value),R.notify({type:"info",message:"Session paused"})}catch(e){console.error("Failed to pause session:",e)}},re=async()=>{try{await E.post(`/api/quiz-sessions/${D.value.id}/state`,{action:"end"}),D.value.status="completed",ee.value&&clearInterval(ee.value),R.notify({type:"positive",message:"Session ended"})}catch(e){console.error("Failed to end session:",e)}};return h(()=>{te()}),w(()=>{se&&se(),ee.value&&clearInterval(ee.value)}),(e,a)=>(x(),q(N,null,[z(k(V),{title:"Live Quiz - Teacher Control"}),S("div",L,[a[10]||(a[10]=S("div",{class:"page-header"},[S("h1",null,"Live Quiz Session"),S("p",null,"Create and control a live quiz session for your students")],-1)),D.value?(x(),q("div",G,[z(r,{class:"access-code-card"},{default:j(()=>[z(s,{class:"text-center"},{default:j(()=>[a[7]||(a[7]=S("h2",null,"Access Code",-1)),S("div",J,Q(D.value.access_code),1),a[8]||(a[8]=S("p",null,[A(" Students can join at: "),S("strong",null,"/quiz/live/join")],-1))]),_:1})]),_:1}),"active"===D.value.status?(x(),T(r,{key:0,class:"timer-card q-mb-md"},{default:j(()=>[z(s,{class:"text-center"},{default:j(()=>[S("div",{class:U(["text-h4 text-weight-bold",{"text-negative":Z.value<=10,"text-primary":Z.value>10}])},[z(c,{name:"timer"}),A(" "+Q(Z.value)+"s ",1)],2)]),_:1})]),_:1})):I("",!0),z(r,{class:"participants-card"},{default:j(()=>[z(s,null,{default:j(()=>[S("h3",null,"Participants ("+Q(X.value.length)+")",1),z(d,{separator:""},{default:j(()=>[(x(!0),q(N,null,$(X.value,e=>(x(),T(t,{key:e.id},{default:j(()=>[z(l,{avatar:""},{default:j(()=>[z(v,{color:"primary","text-color":"white"},{default:j(()=>{var a,s;return[A(Q((null==(s=null==(a=e.student)?void 0:a.name)?void 0:s.charAt(0))||"?"),1)]}),_:2},1024)]),_:2},1024),z(l,null,{default:j(()=>[z(o,null,{default:j(()=>{var a;return[A(Q((null==(a=e.student)?void 0:a.name)||"Unknown"),1)]}),_:2},1024),z(o,{caption:""},{default:j(()=>[A("Score: "+Q(e.score),1)]),_:2},1024)]),_:2},1024),z(l,{side:""},{default:j(()=>{var a;return[S("div",B,[e.last_answered_question_id===(null==(a=D.value)?void 0:a.current_question_id)?(x(),T(y,{key:0,color:"positive",label:"Answered"},{default:j(()=>[z(c,{name:"check",color:"white",class:"q-ml-xs"})]),_:1})):(x(),T(y,{key:1,color:"warning","text-color":"black",label:"Thinking..."},{default:j(()=>[z(c,{name:"more_horiz",class:"q-ml-xs"})]),_:1})),z(y,{color:"active"===e.status?"primary":"grey",outline:""},{default:j(()=>[A(Q(e.status),1)]),_:2},1032,["color"])])]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),z(r,{class:"controls-card bounce-in"},{default:j(()=>[z(s,null,{default:j(()=>[a[9]||(a[9]=S("h3",{class:"text-center text-primary text-weight-bold q-mb-lg"},"ðŸŽ® Game Controls",-1)),S("div",H,["waiting"===D.value.status?(x(),T(u,{key:0,push:"",color:"positive",label:"START GAME! ðŸš€",onClick:ne,size:"xl",class:"game-btn start-btn"})):I("",!0),"active"===D.value.status?(x(),T(u,{key:1,push:"",color:"warning","text-color":"black",label:"PAUSE â¸ï¸",onClick:ue,size:"lg",class:"game-btn pause-btn"})):I("",!0),z(u,{push:"",color:"negative",label:"END GAME ðŸ›‘",onClick:re,size:"lg",class:"game-btn end-btn"})])]),_:1})]),_:1})])):(x(),q("div",M,[z(r,{class:"setup-card"},{default:j(()=>[z(s,null,{default:j(()=>{var e;return[a[6]||(a[6]=S("h2",null,"Create New Session",-1)),S("div",P,[z(g,{modelValue:K.value,"onUpdate:modelValue":a[0]||(a[0]=e=>K.value=e),options:(null==(e=W.value)?void 0:e.questions)||[],"option-label":"question_text","option-value":"id",label:"Select a Question",outlined:"","use-input":"",onFilter:le},{"no-option":j(()=>[z(t,null,{default:j(()=>[z(l,{class:"text-grey"},{default:j(()=>a[4]||(a[4]=[A(" No questions found ")])),_:1})]),_:1})]),option:j(e=>[z(t,C(F(e.itemProps)),{default:j(()=>[z(l,null,{default:j(()=>[z(o,{innerHTML:e.opt.question_text},null,8,["innerHTML"]),z(o,{caption:""},{default:j(()=>{var a;return[A(Q((null==(a=e.opt.options)?void 0:a.length)||0)+" options ",1)]}),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])]),S("div",O,[a[5]||(a[5]=S("h3",null,"Session Settings",-1)),z(i,{modelValue:ae.value.timer,"onUpdate:modelValue":a[1]||(a[1]=e=>ae.value.timer=e),modelModifiers:{number:!0},type:"number",label:"Timer (seconds)",outlined:"",min:"10"},null,8,["modelValue"]),z(n,{modelValue:ae.value.auto_submit,"onUpdate:modelValue":a[2]||(a[2]=e=>ae.value.auto_submit=e),label:"Auto-submit when timer ends"},null,8,["modelValue"]),z(n,{modelValue:ae.value.show_correct_answer,"onUpdate:modelValue":a[3]||(a[3]=e=>ae.value.show_correct_answer=e),label:"Show correct answer after submission"},null,8,["modelValue"])]),z(u,{color:"primary",label:"Create Session",onClick:oe,loading:Y.value,disable:!K.value,size:"lg",class:"full-width"},null,8,["loading","disable"])]}),_:1})]),_:1})]))])],64))}},[["__scopeId","data-v-206f255c"]]);export{R as default};
