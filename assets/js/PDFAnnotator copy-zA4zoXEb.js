import{Y as e}from"./index-tBjxLB0S.js";import t from"./html2canvas.esm-Cq3pa7K9.js";import{E as a}from"./jspdf.es.min-BTDh8jQZ.js";import{o as n}from"./app-tFXAu5dG.js";import{f as o,o as l,N as s,J as i,O as u,U as r,b as d,z as v}from"./vendor-nQjeLEvd.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";const c={class:"pdf-annotator"},p={class:"toolbar"},h=n({__name:"PDFAnnotator copy",props:{pdfUrl:{type:String,required:!0}},setup(n){const h=o(null),m=o(null),f=o("black"),g=o(!1),k=o([]),b=o([]);let w=null;const y=()=>{const e=h.value.querySelector(".pdf-embed"),{width:t,height:a}=e.getBoundingClientRect();m.value.width=t,m.value.height=a,w=m.value.getContext("2d"),w.lineWidth=2,w.lineCap="round",w.strokeStyle=f.value,m.value.addEventListener("mousedown",C),m.value.addEventListener("mousemove",E),m.value.addEventListener("mouseup",L),m.value.addEventListener("mouseout",L),m.value.addEventListener("touchstart",C),m.value.addEventListener("touchmove",E),m.value.addEventListener("touchend",L)},C=e=>{g.value=!0,b.value=[],k.value.push({color:f.value,points:b.value}),E(e)},E=e=>{var t,a;if(!g.value)return;const n=m.value.getBoundingClientRect(),o=(e.clientX||e.touches[0].clientX)-n.left,l=(e.clientY||e.touches[0].clientY)-n.top;b.value.push({x:o,y:l}),w.strokeStyle=f.value,w.beginPath(),w.moveTo((null==(t=b.value[b.value.length-2])?void 0:t.x)||o,(null==(a=b.value[b.value.length-2])?void 0:a.y)||l),w.lineTo(o,l),w.stroke()},L=()=>{g.value=!1},j=e=>{f.value=e,w&&(w.strokeStyle=e)},x=()=>{0!==k.value.length&&(k.value.pop(),_())},S=()=>{k.value=[],_()},_=()=>{w.clearRect(0,0,m.value.width,m.value.height),k.value.forEach(e=>{w.strokeStyle=e.color,w.beginPath(),e.points.forEach((e,t)=>{0===t?w.moveTo(e.x,e.y):w.lineTo(e.x,e.y)}),w.stroke()})},P=()=>{t(h.value).then(e=>{const t=document.createElement("a");t.download="annotated-pdf.png",t.href=e.toDataURL(),t.click()})},R=()=>{t(h.value).then(e=>{const t=e.toDataURL("image/png"),n=new a({orientation:e.width>e.height?"l":"p",unit:"px",format:[e.width,e.height]});n.addImage(t,"PNG",0,0,e.width,e.height),n.save("annotated-pdf.pdf")})};return l(()=>{window.addEventListener("resize",y)}),(t,a)=>(i(),s("div",c,[u("div",p,[u("button",{onClick:a[0]||(a[0]=e=>j("black")),class:r({active:"black"===f.value})},"أسود",2),u("button",{onClick:a[1]||(a[1]=e=>j("red")),class:r({active:"red"===f.value})},"أحمر",2),u("button",{onClick:x},"تراجع"),u("button",{onClick:S},"مسح الكل"),u("button",{onClick:P},"حفظ كصورة"),u("button",{onClick:R},"حفظ كـ PDF")]),u("div",{class:"viewer-container",ref_key:"viewerContainer",ref:h},[d(v(e),{source:n.pdfUrl,onLoaded:y,class:"pdf-embed"},null,8,["source"]),u("canvas",{ref_key:"canvas",ref:m,class:"drawing-canvas"},null,512)],512)]))}},[["__scopeId","data-v-b49de8d5"]]);export{h as default};
