import{r as e}from"./app-DraepSDZ.js";import{f as t,o as n,N as l,J as a,R as i,O as o,V as r}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";const s={class:"player"},u={key:0,class:"error"},c={class:"controls"},v=["disabled"],f=e({__name:"DrawingPlayer",setup(e){const f=t(null);let d=null;const p=t(null),y=t(!1),h=t(""),m=t(!1);function g(){d.clearRect(0,0,800,500)}function x(){g(),p.value=null,y.value=!1,h.value=""}function k(e){const t=e.target.files[0];if(!t)return;const n=new FileReader;n.onload=()=>{try{!function(e){if(e&&Array.isArray(e.strokes)&&"number"==typeof e.width&&"number"==typeof e.height){if(e.strokes.every(e=>Array.isArray(e.points)&&e.points.every(e=>"x"in e&&"y"in e&&"t"in e)))return p.value=e,y.value=!0,void(h.value="")}h.value="File structure not valid for replay",y.value=!1}(JSON.parse(n.result))}catch(e){h.value="Invalid JSON file",y.value=!1}},n.readAsText(t)}function b(e,t=null){const n=t?e.points.slice(0,t):e.points;if(!(n.length<2)){d.strokeStyle=e.color||"#111",d.lineWidth=e.size||3,d.beginPath(),d.moveTo(n[0].x,n[0].y);for(let e=1;e<n.length-1;e++){const t=(n[e].x+n[e+1].x)/2,l=(n[e].y+n[e+1].y)/2;d.quadraticCurveTo(n[e].x,n[e].y,t,l)}d.lineTo(n[n.length-1].x,n[n.length-1].y),d.stroke()}}function w(){if(!y.value||!p.value)return;m.value=!0,g();const e=p.value.strokes,t=performance.now();let n=0,l=t;requestAnimationFrame(function t(a){g();for(let l=0;l<n;l++)b(e[l]);if(n>=e.length)return void(m.value=!1);const i=e[n],o=a-l,r=i.points,s=r[r.length-1].t,u=r.findIndex(e=>e.t>o);b(i,-1===u?r.length:u),o>=s&&(n++,l=a),requestAnimationFrame(t)})}return n(()=>{!function(){const e=f.value,t=window.devicePixelRatio||1;e.width=800*t,e.height=500*t,e.style.width="800px",e.style.height="500px",d=e.getContext("2d"),d.scale(t,t),d.lineCap="round",d.lineJoin="round",g()}()}),(e,t)=>(a(),l("div",s,[i("input",{type:"file",accept:"application/json",onChange:k},null,32),h.value?(a(),l("div",u,r(h.value),1)):o("",!0),i("canvas",{ref_key:"canvas",ref:f,class:"canvas"},null,512),i("div",c,[i("button",{disabled:!y.value||m.value,onClick:w},"Replay",8,v),i("button",{onClick:x},"Clear")])]))}},[["__scopeId","data-v-5c4b7aef"]]);export{f as default};
