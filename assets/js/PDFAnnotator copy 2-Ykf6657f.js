import{Y as e}from"./index-tBjxLB0S.js";import a from"./html2canvas.esm-Cq3pa7K9.js";import{E as l}from"./jspdf.es.min-BJlCvzNI.js";import{o as t}from"./app-Cs5CKgHw.js";import{f as n,k as u,n as o,o as s,e as v,N as i,J as c,O as d,W as r,V as p,a0 as g,U as f,y as h,ac as m,b,z as k}from"./vendor-nQjeLEvd.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";const y={class:"pdf-draw-local"},w={class:"upload-section"},P={class:"upload-box"},C={key:0,class:"upload-content"},x={key:1,class:"selected-file"},R={key:0,class:"pdf-section"},U={class:"toolbar"},L=["disabled"],j={class:"navigation-bar"},D=["disabled"],E={class:"page-info"},F=["max"],M=["disabled"],B={class:"viewer-wrapper"},S={key:1,class:"no-pdf"},O=t({__name:"PDFAnnotator copy 2",setup(t){const O=n(""),_=n(""),I=n(1),T=n(1),A=n("black"),N=n({}),Y=n(!1),z=n([]),H=n(null);let J=null;const V=e=>{var a;const l=null==(a=e.target.files)?void 0:a[0];l&&("application/pdf"===l.type?l.size>52428800?alert("File too large (max 50 MB)"):(O.value&&URL.revokeObjectURL(O.value),O.value=URL.createObjectURL(l),_.value=l.name,N.value={},I.value=1):alert("Please select a PDF file"))},W=()=>{O.value&&URL.revokeObjectURL(O.value),O.value="",_.value="",I.value=1,T.value=1,N.value={},H.value&&H.value.getContext("2d").clearRect(0,0,H.value.width,H.value.height)},X=e=>{e&&e.totalPages&&(T.value=e.totalPages)},q=()=>{o(G)},G=()=>{if(!H.value)return;const e=H.value.parentElement.querySelector(".pdf-embed");if(!e)return;const a=e.getBoundingClientRect();H.value.width=a.width,H.value.height=a.height,H.value.style.width=a.width+"px",H.value.style.height=a.height+"px",J=H.value.getContext("2d"),J.lineWidth=3,J.lineCap="round",J.lineJoin="round",J.strokeStyle=A.value,Z()},$=e=>{"mousedown"===e.type&&e.preventDefault(),Y.value=!0,z.value=[];const a=H.value.getBoundingClientRect(),l=e.clientX-a.left,t=e.clientY-a.top;z.value.push({x:l,y:t}),N.value[I.value]||(N.value[I.value]=[]),N.value[I.value].push({color:A.value,points:z.value})},K=e=>{if(!Y.value||!J)return;e.preventDefault();const a=H.value.getBoundingClientRect(),l=e.clientX-a.left,t=e.clientY-a.top;z.value.push({x:l,y:t});const n=z.value[z.value.length-2];J.beginPath(),J.moveTo(n.x,n.y),J.lineTo(l,t),J.stroke()},Q=e=>{Y.value=!1},Z=()=>{if(!J)return;J.clearRect(0,0,H.value.width,H.value.height);(N.value[I.value]||[]).forEach(e=>{J.strokeStyle=e.color,J.beginPath(),e.points.forEach((e,a)=>{0===a?J.moveTo(e.x,e.y):J.lineTo(e.x,e.y)}),J.stroke()})},ee=()=>{var e;return(null==(e=N.value[I.value])?void 0:e.length)>0},ae=e=>{A.value=e,J&&(J.strokeStyle=e)},le=()=>{var e;(null==(e=N.value[I.value])?void 0:e.length)>0&&(N.value[I.value].pop(),Z())},te=()=>{N.value[I.value]=[],Z()},ne=async()=>{var e;const l=null==(e=H.value)?void 0:e.parentElement;if(!l)return;const t=await a(l,{scale:1}),n=document.createElement("a");n.download=`annotated-page-${I.value}.png`,n.href=t.toDataURL(),n.click()},ue=async()=>{var e;const t=new l("p","mm","a4");let n=0;for(let l=1;l<=T.value;l++){I.value=l,await o(),await o();const u=null==(e=H.value)?void 0:e.parentElement;if(!u)continue;const s=await a(u,{scale:1}),v=s.toDataURL("image/png"),i=210,c=295;let d=s.height*i/s.width;n>0&&t.addPage();do{const e=c-n;newHeight>e&&(t.addPage(),n=0),t.addImage(v,"PNG",0,n,i,newHeight),d-=e,n=0}while(d>0);n=d-c}t.save("annotated-pdf-full.pdf")},oe=()=>{I.value>1&&I.value--},se=()=>{I.value<T.value&&I.value++},ve=()=>{I.value<1&&(I.value=1),I.value>T.value&&(I.value=T.value)};return u(I,()=>{o(()=>{G()})}),s(()=>{var e,a,l;null==(e=H.value)||e.addEventListener("touchstart",e=>{e.preventDefault(),$(e.touches[0])},{passive:!1}),null==(a=H.value)||a.addEventListener("touchmove",e=>{e.preventDefault(),K(e.touches[0])},{passive:!1}),null==(l=H.value)||l.addEventListener("touchend",Q,{passive:!1})}),v(()=>{O.value&&URL.revokeObjectURL(O.value)}),(a,l)=>(c(),i("div",y,[d("div",w,[l[6]||(l[6]=d("h2",{class:"title"},"Upload PDF to Draw on Any Page",-1)),d("label",P,[d("input",{type:"file",accept:".pdf",onChange:V,class:"file-input"},null,32),_.value?(c(),i("div",x,[l[5]||(l[5]=d("div",{class:"icon"},"âœ…",-1)),d("p",null,[l[4]||(l[4]=r("Loaded: ")),d("strong",null,p(_.value),1)]),d("button",{onClick:g(W,["prevent"]),class:"clear-btn"},"Change File")])):(c(),i("div",C,l[3]||(l[3]=[d("div",{class:"icon"},"ðŸ“„",-1),d("p",null,"Drag & drop or click to upload",-1),d("small",null,"Max 50 MB",-1)])))])]),O.value?(c(),i("div",R,[d("div",U,[d("button",{onClick:l[0]||(l[0]=e=>ae("black")),class:f({active:"black"===A.value})},"Black",2),d("button",{onClick:l[1]||(l[1]=e=>ae("red")),class:f({active:"red"===A.value})},"Red",2),d("button",{onClick:le,disabled:!ee},"Undo",8,L),d("button",{onClick:te},"Clear Page"),d("button",{onClick:ne},"Save Page as Image"),d("button",{onClick:ue},"Save All as PDF")]),d("div",j,[d("button",{onClick:oe,disabled:I.value<=1,class:"nav-btn"},"â† Previous",8,D),d("span",E,[l[7]||(l[7]=r(" Page ")),h(d("input",{"onUpdate:modelValue":l[2]||(l[2]=e=>I.value=e),onInput:ve,type:"number",min:"1",max:T.value,class:"page-input"},null,40,F),[[m,I.value,void 0,{number:!0}]]),r(" of "+p(T.value),1)]),d("button",{onClick:se,disabled:I.value>=T.value,class:"nav-btn"},"Next â†’",8,M)]),d("div",B,[b(k(e),{source:O.value,"page-number":I.value,onProgress:X,onRendered:q,class:"pdf-embed","enable-annotation":!1},null,8,["source","page-number"]),d("canvas",{ref_key:"canvas",ref:H,class:"draw-canvas",onMousedown:$,onMousemove:K,onMouseup:Q,onMouseleave:Q},null,544)])])):(c(),i("div",S,l[8]||(l[8]=[d("p",null,"Upload a PDF to start drawing on any page",-1)])))]))}},[["__scopeId","data-v-c86e35b1"]]);export{O as default};
