import{o as e,d as l,Q as a,C as s,m as t,a as n,b as o,p as u}from"./app-Buylb2AA.js";import{Q as i}from"./QLinearProgress-B7jHdoB9.js";import{Q as d}from"./QTab-DYNjFyV-.js";import{Q as r}from"./QTabs-DdUHRwMQ.js";import{Q as c}from"./QTabPanels-BcXMjpO5.js";import{f as m,k as v,o as y,a as p,ae as k,L as w,I as b,b as f,M as h,y as g,V as _,U as x,J as q,O as P,F as S,Q as W,Z as j,H as V,S as C}from"./vendor-CUZ9QTQV.js";import z from"./WeekSelector-C-N3Sg_r.js";import Q from"./WeeklyPlanEditor-DfEtgdTH.js";import N from"./StatusBadge-DM3cSt1q.js";import{u as M}from"./i18n-CP46N9fu.js";import"./offline-BzIlwqNM.js";import"./ui-LrZmvB2D.js";import"./rtl-Cr6c3OOr.js";import"./use-panel-B1dc8KLj.js";import"./use-render-cache-CmTcazfP.js";import"./QSelect-CcTxzM62.js";const E={class:"q-pa-md"},U={class:"row items-center q-mb-lg"},D={class:"col"},$={class:"q-ma-none text-weight-bold"},A={class:"text-grey-7 q-mb-none"},F={class:"row q-gutter-md items-center"},H={class:"col-auto"},O={class:"row items-center"},T={class:"col-auto q-ml-auto"},I={class:"col-auto"},J={class:"weekly-plans-grid"},L={class:"q-mb-md text-weight-bold"},B={class:"plans-grid"},K={class:"plan-header row items-center q-px-md q-py-sm"},Y={class:"col"},Z={class:"text-subtitle2 text-weight-bold"},G={class:"text-caption"},R={class:"col-auto"},X={class:"plan-content q-px-md q-py-sm"},ee={class:"plan-section q-mb-sm"},le={class:"plan-label"},ae={key:0},se={key:1,class:"text-grey-5"},te={class:"plan-section q-mb-sm"},ne={class:"plan-label"},oe={key:0},ue={key:1,class:"text-grey-5"},ie={class:"plan-section"},de={class:"plan-label"},re={key:0},ce={key:1,class:"text-grey-5"},me={class:"plan-actions row justify-end q-px-md q-py-sm"},ve={key:0,class:"text-center q-pa-xl"},ye={class:"text-h6 text-grey-7 q-mt-md"},pe={class:"text-grey-6"},ke=e({__name:"SimpleWeeklyPlans",setup(e){const{t:ke}=M(),we=m(!1),be=m(1),fe=m(1),he=m(18),ge=m(1),_e=m([]),xe=m(null),qe=m(null),Pe=m(!1),Se=m(null),We=m(!1),je=m("table"),Ve=e=>{const l=`weeklyPlans.fullDays.${e}`,a=ke(l);return a!==l?a:`Day ${e}`};async function Ce(){var e,l;try{const{data:a}=await j.get("/weekly-system/api/teacher/my-weekly-plans",{params:{week_number:be.value,semester_number:fe.value}}),s=Array.isArray(null==a?void 0:a.data)?a.data:Array.isArray(a)?a:[],t={};for(const n of s){const a=null!=(l=null==(e=null==n?void 0:n.schedule)?void 0:e.day)?l:0;t[a]||(t[a]={dayNumber:a,dayName:Ve(a),plans:[]}),t[a].plans.push({id:n.id,data:n,isEditing:!1,saving:!1})}Object.values(t).forEach(e=>{e.plans.sort((e,l)=>{var a,s,t,n;return((null==(s=null==(a=e.data)?void 0:a.schedule)?void 0:s.period_number)||0)-((null==(n=null==(t=l.data)?void 0:t.schedule)?void 0:n.period_number)||0)})}),_e.value=Object.values(t).sort((e,l)=>e.dayNumber-l.dayNumber)}catch(a){console.error("Error loading weekly plans:",a)}}function ze(){be.value>1&&(be.value--,Ce())}function Qe(){be.value<he.value&&(be.value++,Ce())}v(()=>be.value,e=>{e&&Ce()}),y(()=>{const e=new Date,l=new Date(e.getFullYear(),0,1),a=Math.floor((e-l)/864e5),s=Math.ceil((a+l.getDay()+1)/7);ge.value=Math.min(s,he.value),be.value=ge.value,Ce()});const Ne=p(()=>_e.value),Me=p(()=>{if(0===_e.value.length)return 0;const e=_e.value.reduce((e,l)=>e+l.plans.length,0);if(0===e)return 0;const l=_e.value.reduce((e,l)=>e+l.plans.filter(e=>{var l;return"completed"===(null==(l=e.data)?void 0:l.status)}).length,0);return Math.round(l/e*100)}),Ee=p(()=>{const e=Me.value;return e<30?"negative":e<70?"warning":"positive"});p(()=>_e.value.flatMap(e=>e.plans.map(e=>e.data)));const Ue=async e=>{var l,a,s,t,n,o,u,i,d;if(null==(l=Se.value)?void 0:l.id)try{Pe.value=!0;const l=Number(null==(a=null==e?void 0:e.schedule)?void 0:a.period_order),r=Number(null==(t=null==(s=Se.value)?void 0:s.schedule)?void 0:t.period_order),c=null==(o=null==(n=Se.value)?void 0:n.schedule)?void 0:o.id;c&&Number.isFinite(l)&&l>0&&l!==r&&await j.put(`/weekly-system/api/schedules/${c}/period-order`,{period_order:l}),await j.put(`/weekly-system/api/weekly-plans/${Se.value.id}`,{cw:null!=(u=null==e?void 0:e.cw)?u:"",hw:null!=(i=null==e?void 0:e.hw)?i:"",notes:null!=(d=null==e?void 0:e.notes)?d:""}),We.value=!1,await Ce()}catch(r){console.error("Failed to save weekly plan",r)}finally{Pe.value=!1}};return(e,m)=>{const v=k("Head");return b(),w(S,null,[f(v,{title:g(ke)("weeklySystem.myWeeklyPlans.title")},null,8,["title"]),h("div",E,[h("div",U,[h("div",D,[h("h4",$,[f(l,{name:"edit_note",class:"q-mr-sm",color:"primary"}),_(" "+x(g(ke)("weeklySystem.myWeeklyPlans.title")),1)]),h("p",A,x(g(ke)("weeklySystem.myWeeklyPlans.subtitle")),1)])]),f(t,{flat:"",bordered:"",class:"q-pa-md q-mb-lg"},{default:q(()=>[h("div",F,[h("div",H,[h("div",O,[f(a,{icon:"chevron_left",color:"primary",round:"",flat:"",onClick:ze,disable:be.value<=1},null,8,["disable"]),f(z,{modelValue:be.value,"onUpdate:modelValue":m[0]||(m[0]=e=>be.value=e),"max-weeks":he.value,"current-week":ge.value,class:"q-mx-md"},null,8,["modelValue","max-weeks","current-week"]),f(a,{icon:"chevron_right",color:"primary",round:"",flat:"",onClick:Qe,disable:be.value>=he.value},null,8,["disable"])])]),h("div",T,[f(i,{value:Me.value/100,size:"25px",color:Ee.value,"track-color":"grey-3",rounded:"",style:{width:"150px"}},null,8,["value","color"])]),h("div",I,[f(s,{color:Ee.value,"text-color":"white",label:`${Me.value}%`},null,8,["color","label"])])])]),_:1}),f(r,{modelValue:je.value,"onUpdate:modelValue":m[1]||(m[1]=e=>je.value=e),dense:"",class:"text-primary q-mb-sm"},{default:q(()=>[f(d,{name:"table",icon:"table_chart",label:g(ke)("weeklySystem.myWeeklyPlans.tableView")},null,8,["label"])]),_:1},8,["modelValue"]),f(n,{class:"q-mb-md"}),f(c,{modelValue:je.value,"onUpdate:modelValue":m[2]||(m[2]=e=>je.value=e),animated:""},{default:q(()=>[h("div",J,[(b(!0),w(S,null,W(Ne.value,e=>(b(),w("div",{key:e.dayNumber,class:"day-section q-mb-xl"},[h("h5",L,[_(x(Ve(e.dayNumber))+" ",1),f(s,{dense:"",color:Ee.value,"text-color":"white",label:e.plans.length},null,8,["color","label"])]),h("div",B,[(b(!0),w(S,null,W(e.plans,e=>(b(),V(t,{key:e.id,flat:"",bordered:"",class:C(["plan-card q-mr-sm q-mb-sm",{copied:xe.value===e.id}])},{default:q(()=>{var s,t,n,o,i,d,r,c,m,v,y,p,k;return[h("div",K,[h("div",Y,[h("div",Z,[f(l,{name:"meeting_room",size:"sm",color:"primary"}),_(" "+x((null==(n=null==(t=null==(s=e.data)?void 0:s.schedule)?void 0:t.cst)?void 0:n.classroom_name)||g(ke)("weeklySystem.myWeeklyPlans.noClassroom")),1)]),h("div",G,[f(l,{name:"school",size:"xs",color:"primary"}),_(" "+x((null==(d=null==(i=null==(o=e.data)?void 0:o.schedule)?void 0:i.cst)?void 0:d.subject_name)||g(ke)("weeklySystem.myWeeklyPlans.noSubject")),1)])]),h("div",R,[f(N,{status:(null==(r=e.data)?void 0:r.status)||"empty"},null,8,["status"])])]),h("div",X,[h("div",ee,[h("div",le,x(g(ke)("weeklySystem.myWeeklyPlans.classwork"))+" (CW)",1),h("div",{class:C(["plan-content-text",{empty:!(null==(c=e.data)?void 0:c.cw)}])},[f(l,{name:"school",size:"xs",color:"primary"}),(null==(m=e.data)?void 0:m.cw)?(b(),w("span",ae,x(e.data.cw),1)):(b(),w("span",se,x(g(ke)("weeklySystem.myWeeklyPlans.noClasswork")),1))],2)]),h("div",te,[h("div",ne,x(g(ke)("weeklySystem.myWeeklyPlans.homework"))+" (HW)",1),h("div",{class:C(["plan-content-text",{empty:!(null==(v=e.data)?void 0:v.hw)}])},[f(l,{name:"home_work",size:"xs",color:"amber"}),(null==(y=e.data)?void 0:y.hw)?(b(),w("span",oe,x(e.data.hw),1)):(b(),w("span",ue,x(g(ke)("weeklySystem.myWeeklyPlans.noHomework")),1))],2)]),h("div",ie,[h("div",de,x(g(ke)("weeklySystem.myWeeklyPlans.notes")),1),h("div",{class:C(["plan-content-text",{empty:!(null==(p=e.data)?void 0:p.notes)}])},[f(l,{name:"note",size:"xs",color:"secondary"}),(null==(k=e.data)?void 0:k.notes)?(b(),w("span",re,x(e.data.notes),1)):(b(),w("span",ce,x(g(ke)("weeklySystem.myWeeklyPlans.noNotes")),1))],2)])]),h("div",me,[we.value||qe.value&&xe.value===e.id?P("",!0):(b(),V(a,{key:0,icon:"content_copy",size:"sm",flat:"",color:"primary",onClick:l=>(e=>{var l,a,s,t;xe.value=null!=(l=null==e?void 0:e.id)?l:null,qe.value={cw:(null==(a=null==e?void 0:e.data)?void 0:a.cw)||"",hw:(null==(s=null==e?void 0:e.data)?void 0:s.hw)||"",notes:(null==(t=null==e?void 0:e.data)?void 0:t.notes)||""}})(e),class:"q-mr-sm"},{default:q(()=>[f(u,null,{default:q(()=>[_(x(g(ke)("weeklySystem.myWeeklyPlans.copied")),1)]),_:1})]),_:2},1032,["onClick"])),!we.value&&qe.value&&xe.value!==e.id?(b(),V(a,{key:1,icon:"content_paste",size:"sm",flat:"",color:"primary",onClick:l=>(async e=>{var l,a;qe.value&&(Se.value=null!=(l=null==e?void 0:e.data)?l:null,(null==(a=Se.value)?void 0:a.id)&&await Ue({cw:qe.value.cw,hw:qe.value.hw,notes:qe.value.notes}))})(e),class:"q-mr-sm"},{default:q(()=>[f(u,null,{default:q(()=>[_(x(g(ke)("weeklySystem.myWeeklyPlans.paste")),1)]),_:1})]),_:2},1032,["onClick"])):P("",!0),we.value?P("",!0):(b(),V(a,{key:2,icon:"edit",size:"sm",flat:"",color:"primary",onClick:l=>(e=>{var l;Se.value=null!=(l=null==e?void 0:e.data)?l:null,Se.value&&(We.value=!0)})(e)},{default:q(()=>[f(u,null,{default:q(()=>[_(x(g(ke)("weeklySystem.myWeeklyPlans.edit")),1)]),_:1})]),_:2},1032,["onClick"])),we.value&&e.isEditing?(b(),V(a,{key:3,icon:"save",size:"sm",flat:"",color:"green",loading:e.saving,onClick:l=>(async e=>{(null==e?void 0:e.data)&&(Se.value=e.data,await Ue(e.data))})(e)},{default:q(()=>[f(u,null,{default:q(()=>[_(x(g(ke)("weeklySystem.myWeeklyPlans.save")),1)]),_:1})]),_:2},1032,["loading","onClick"])):P("",!0),we.value&&e.isEditing?(b(),V(a,{key:4,icon:"cancel",size:"sm",flat:"",color:"red",onClick:e=>{}},{default:q(()=>[f(u,null,{default:q(()=>[_(x(g(ke)("weeklySystem.myWeeklyPlans.cancel")),1)]),_:1})]),_:2},1032,["onClick"])):P("",!0)])]}),_:2},1032,["class"]))),128))])]))),128))]),_e.value.length?P("",!0):(b(),w("div",ve,[f(l,{name:"edit_note",size:"64px",color:"grey-5"}),h("p",ye,x(g(ke)("weeklySystem.myWeeklyPlans.noPlans")),1),h("p",pe,x(g(ke)("weeklySystem.myWeeklyPlans.selectWeek")),1)]))]),_:1},8,["modelValue"]),f(o,{modelValue:We.value,"onUpdate:modelValue":m[5]||(m[5]=e=>We.value=e),persistent:""},{default:q(()=>[f(Q,{modelValue:We.value,"onUpdate:modelValue":m[3]||(m[3]=e=>We.value=e),plan:Se.value,saving:Pe.value,onSubmit:Ue,onClose:m[4]||(m[4]=e=>We.value=!1)},null,8,["modelValue","plan","saving"])]),_:1},8,["modelValue"])])],64)}}},[["__scopeId","data-v-608fe1db"]]);export{ke as default};
