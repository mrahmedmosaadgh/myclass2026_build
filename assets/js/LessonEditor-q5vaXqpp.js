import{c as e,a as l,h as t,i as s,Q as a,l as o,m as n,n as i}from"./app-B77gjd5a.js";import{d}from"./vuedraggable.umd-CABkNphu.js";import r from"./11SlideEditor-D6YWuBuM.js";import u from"./LessonProgress-DFKTbqRN.js";import c from"./LessonControls-CXoC1qKd.js";import{f as v,a as p,k as f,M as m,J as y,N as x,b as g,K as j,W as S,z as k,U as _,V as b,a0 as D,I as h,Q as w}from"./vendor-DuKqz2x4.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";import"./index-DJPqu1_-.js";import"./QSelect-DB_tK-Lk.js";import"./rtl-Cr6c3OOr.js";import"./QLinearProgress-B9hMkhRG.js";let q=!1;try{q="undefined"!=typeof Dexie}catch(R){q=!1}const L="lesson_draft_v1";const N={class:"q-pa-md row"},V={class:"col-3"},C={class:"text-subtitle2"},U={class:"text-caption"},E={class:"col-6"},I={key:1,class:"q-pa-md"},O={class:"col-3"},Q={class:"text-subtitle2"},A={key:0},J={__name:"LessonEditor",setup(J){const T=function(){if(q){const e=new Dexie("LessonEditorDB");return e.version(1).stores({drafts:"id,data"}),{async saveDraft(l){await e.drafts.put({id:"current",data:l})},async loadDraft(){const l=await e.drafts.get("current");return(null==l?void 0:l.data)||null},async clear(){await e.drafts.delete("current")}}}return{saveDraft(e){localStorage.setItem(L,JSON.stringify(e))},loadDraft(){try{return JSON.parse(localStorage.getItem(L))}catch(R){return null}},clear(){localStorage.removeItem(L)}}}(),M=v(T.loadDraft()||{id:Date.now().toString(),title:"New Lesson",slides:[]}),P=v(0),B=p(()=>M.value.slides[P.value]||null);function z(e){const l={id:"s_"+Date.now(),type:e};"video"===e&&(l.video={src:"",start:0,end:null,autoNext:!0,isLocal:!1}),"question"===e&&(l.question={id:"q_"+Date.now(),type:"MultipleChoice",questionText:"",options:["",""],correctIndex:0,maxPoints:5}),"text"===e&&(l.content=""),M.value.slides.push(l),P.value=M.value.slides.length-1,W()}function K(e){M.value.slides[P.value]=e,W()}function W(){T.saveDraft(M.value)}async function F(){const e=new Blob([JSON.stringify(M.value,null,2)],{type:"application/json"}),l=URL.createObjectURL(e),t=document.createElement("a");t.href=l,t.download=(M.value.title||"lesson")+".json",t.click(),URL.revokeObjectURL(l)}async function G(e){const l=await e.text();try{const e=JSON.parse(l);M.value=e,T.saveDraft(M.value)}catch(R){console.error(R)}}function H(){console.log("Save to server not implemented")}return f(M,e=>T.saveDraft(e),{deep:!0}),(v,p)=>(y(),m("div",N,[x("div",V,[g(n,{flat:""},{default:j(()=>[g(e,{class:"text-h6"},{default:j(()=>p[5]||(p[5]=[S("Slides")])),_:1}),g(l),g(k(d),{modelValue:M.value.slides,"onUpdate:modelValue":p[0]||(p[0]=e=>M.value.slides=e),"item-key":"id",onEnd:W},{item:j(({element:e,index:l})=>[g(t,{clickable:"",onClick:e=>{return t=l,void(P.value=t);var t},class:_({"bg-grey-2":l===P.value})},{default:j(()=>[g(s,null,{default:j(()=>{return[x("div",C,b(l+1)+". "+b(e.type),1),x("div",U,b((t=e,t?"video"===t.type?(null==(s=t.video)?void 0:s.src)||"Video slide":"question"===t.type?(null==(o=null==(a=t.question)?void 0:a.questionText)?void 0:o.slice(0,40))||"Question slide":(null==(n=t.content)?void 0:n.slice(0,40))||"Text slide":"")),1)];var t,s,a,o,n}),_:2},1024),g(s,{side:""},{default:j(()=>[g(a,{dense:"",flat:"",color:"negative",icon:"delete",onClick:D(e=>{return t=l,M.value.slides.splice(t,1),P.value>=M.value.slides.length&&(P.value=M.value.slides.length-1),void W();var t},["stop"])},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick","class"])]),_:1},8,["modelValue"]),g(l),g(o,null,{default:j(()=>[g(a,{label:"Add Video",color:"primary",onClick:p[1]||(p[1]=e=>z("video"))}),g(a,{label:"Add Question",color:"accent",onClick:p[2]||(p[2]=e=>z("question"))}),g(a,{label:"Add Text",color:"secondary",onClick:p[3]||(p[3]=e=>z("text"))})]),_:1})]),_:1})]),x("div",E,[B.value?(y(),h(r,{key:0,slide:B.value,onUpdateSlide:K},null,8,["slide"])):(y(),m("div",I,"No slide selected")),g(u,{lesson:M.value,"current-index":P.value},null,8,["lesson","current-index"])]),x("div",O,[g(c,{lesson:M.value,onExport:F,onImport:G,onSave:H},null,8,["lesson"]),g(l,{class:"q-mt-md"}),g(n,null,{default:j(()=>[g(e,null,{default:j(()=>[p[6]||(p[6]=x("div",{class:"text-h6"},"Selected Slide",-1)),x("div",Q,b(P.value+1)+" / "+b(M.value.slides.length),1)]),_:1}),g(l),B.value?(y(),h(e,{key:0},{default:j(()=>[x("div",null,[p[7]||(p[7]=x("strong",null,"Type:",-1)),S(" "+b(B.value.type),1)]),"video"===B.value.type?(y(),m("div",A,[x("div",null,[p[8]||(p[8]=x("strong",null,"Video:",-1)),S(" "+b(B.value.video.src||"â€”"),1)]),x("div",null,[p[9]||(p[9]=x("strong",null,"Start:",-1)),S(" "+b(B.value.video.start||0)+"s",1)]),x("div",null,[p[10]||(p[10]=x("strong",null,"End:",-1)),S(" "+b(B.value.video.end||"end")+"s",1)]),g(i,{modelValue:B.value.video.autoNext,"onUpdate:modelValue":[p[4]||(p[4]=e=>B.value.video.autoNext=e),W],label:"Auto Next"},null,8,["modelValue"])])):w("",!0)]),_:1})):w("",!0)]),_:1})])]))}};export{J as default};
