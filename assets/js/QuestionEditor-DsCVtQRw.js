import{p as e,n as l,d as a,e as t,g as o,q as i,l as s,b1 as n,Q as u,u as d,aq as r}from"./app-BXm70mdJ.js";import{f as c,a as m,k as p,L as v,I as _,M as b,b as f,O as y,J as g,H as x,U as q,V,y as h,o as w,Q as k,F as j,Z as U,N as Q,a3 as C,_ as E}from"./vendor-DNM7Y6Xn.js";import{Q as O}from"./QSelect-CnZtzPIC.js";import{Q as A}from"./QForm-DyZk5PSh.js";import{d as F}from"./vuedraggable.umd-BqRLJd4h.js";import"./offline-BzIlwqNM.js";import"./i18n-CBOKL2HS.js";import"./ui-BP0GJNn5.js";import"./rtl-Cr6c3OOr.js";import"./index-CUaaxLlN.js";const S={class:"option-editor"},z={class:"row items-center q-gutter-sm"},D={class:"option-key"},I={key:0,class:"text-negative text-caption q-mt-sm"},L={key:1,class:"text-warning text-caption q-mt-sm"},M=e({__name:"OptionEditor",props:{modelValue:{type:Array,default:()=>[]},allowMultiple:{type:Boolean,default:!1},minOptions:{type:Number,default:2},maxOptions:{type:Number,default:6}},emits:["update:modelValue"],setup(e,{emit:d}){const r=e,w=d,k=c([...r.modelValue]),j=c(""),U=["A","B","C","D","E","F"],Q=m(()=>k.value.some(e=>e.is_correct)),C=()=>{if(k.value.length>=r.maxOptions)return;const e={id:Date.now(),option_key:U[k.value.length],option_text:"",is_correct:!1,order_index:k.value.length};k.value.push(e),M()},E=()=>{k.value.forEach((e,l)=>{e.option_key=U[l],e.order_index=l}),M()},O=()=>{const e=k.value.find(e=>e.is_correct);return e?e.id:null},A=()=>{j.value="",Q.value||(j.value="At least one option must be marked as correct"),M()},M=()=>{w("update:modelValue",[...k.value])};if(p(()=>r.modelValue,e=>{k.value=[...e]},{deep:!0}),0===k.value.length)for(let l=0;l<r.minOptions;l++)C();return(d,c)=>(_(),v("div",S,[c[5]||(c[5]=b("div",{class:"text-subtitle2 q-mb-md"},"Answer Options",-1)),f(h(F),{modelValue:k.value,"onUpdate:modelValue":c[0]||(c[0]=e=>k.value=e),"item-key":"id",handle:".drag-handle",onEnd:E},{item:g(({element:d,index:m})=>[f(l,{flat:"",bordered:"",class:"option-item q-mb-sm"},{default:g(()=>[f(a,{class:"q-pa-sm"},{default:g(()=>[b("div",z,[f(t,{name:"drag_indicator",class:"drag-handle cursor-pointer text-grey-6",size:"20px"}),b("div",D,q(d.option_key),1),f(o,{modelValue:d.option_text,"onUpdate:modelValue":e=>d.option_text=e,outlined:"",dense:"",placeholder:"Enter option text",class:"col",rules:[e=>!!e||"Option text is required"]},null,8,["modelValue","onUpdate:modelValue","rules"]),e.allowMultiple?(_(),x(s,{key:0,modelValue:d.is_correct,"onUpdate:modelValue":[e=>d.is_correct=e,A],color:"positive"},{default:g(()=>[f(i,null,{default:g(()=>c[1]||(c[1]=[V("Mark as correct answer")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])):(_(),x(n,{key:1,"model-value":O(),val:d.id,color:"positive","onUpdate:modelValue":e=>{return l=d.id,k.value.forEach(e=>{e.is_correct=e.id===l}),void M();var l}},{default:g(()=>[f(i,null,{default:g(()=>c[2]||(c[2]=[V("Mark as correct answer")])),_:1})]),_:2},1032,["model-value","val","onUpdate:modelValue"])),f(u,{flat:"",round:"",dense:"",icon:"close",size:"sm",color:"negative",onClick:e=>(e=>{k.value.length<=r.minOptions||(k.value.splice(e,1),k.value.forEach((e,l)=>{e.option_key=U[l],e.order_index=l}),M())})(m),disable:k.value.length<=e.minOptions},{default:g(()=>[f(i,null,{default:g(()=>c[3]||(c[3]=[V("Remove option")])),_:1})]),_:2},1032,["onClick","disable"])])]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue"]),f(u,{flat:"",icon:"add",label:"Add Option",color:"primary",size:"sm",onClick:C,disable:k.value.length>=e.maxOptions,class:"q-mt-sm"},null,8,["disable"]),j.value?(_(),v("div",I,[f(t,{name:"warning",size:"16px",class:"q-mr-xs"}),V(" "+q(j.value),1)])):y("",!0),Q.value?y("",!0):(_(),v("div",L,[f(t,{name:"info",size:"16px",class:"q-mr-xs"}),c[4]||(c[4]=V(" Please mark at least one option as correct "))]))]))}},[["__scopeId","data-v-079fc1d5"]]),B={class:"form-section"},H={class:"form-section"},N={class:"form-section"},T={class:"row q-col-gutter-md"},R={class:"col-12 col-md-4"},$={class:"col-12 col-md-4"},G={class:"col-12 col-md-4"},J={class:"form-section"},P={class:"row q-col-gutter-md"},Z={class:"col-12 col-md-4"},K={class:"col-12 col-md-4"},W={class:"col-12 col-md-4"},X={key:0,class:"form-section"},Y={class:"form-section"},ee={class:"col"},le={class:"form-section"},ae={class:"form-section"},te={class:"row q-gutter-sm justify-end q-mt-lg"},oe=e({__name:"QuestionForm",props:{modelValue:{type:Object,default:()=>({})},mode:{type:String,default:"create"}},emits:["submit","cancel","update:modelValue"],setup(e,{emit:l}){const a=e,i=l,n=c({question_type_id:null,question_text:"",grade_id:null,subject_id:null,topic_id:null,difficulty_level:3,bloom_level:null,estimated_time_sec:60,status:"draft",options:[],hints:[],explanation:{text:"",revealed_after_attempt:!0},...a.modelValue}),d=c([]),r=c([]),q=c([]),V=c([]),h=c(!1),Q=[{label:"Very Easy",value:1},{label:"Easy",value:2},{label:"Medium",value:3},{label:"Hard",value:4},{label:"Very Hard",value:5}],C=[{label:"Level 1 - Remember",value:1},{label:"Level 2 - Understand",value:2},{label:"Level 3 - Apply",value:3},{label:"Level 4 - Analyze",value:4},{label:"Level 5 - Evaluate",value:5},{label:"Level 6 - Create",value:6}],E=[{label:"Draft",value:"draft"},{label:"Active",value:"active"},{label:"Archived",value:"archived"},{label:"Review",value:"review"}],F=m(()=>d.value.find(e=>e.id===n.value.question_type_id)),S=m(()=>{var e;return"multi_select"===(null==(e=F.value)?void 0:e.slug)}),z=m(()=>q.value),D=m(()=>n.value.subject_id?V.value.filter(e=>e.subject_id===n.value.subject_id):V.value),I=()=>{var e,l;if(null==(e=F.value)?void 0:e.has_options){"true_false"===(null==(l=F.value)?void 0:l.slug)?n.value.options=[{id:Date.now(),option_key:"A",option_text:"True",is_correct:!1,order_index:0},{id:Date.now()+1,option_key:"B",option_text:"False",is_correct:!1,order_index:1}]:0===n.value.options.length&&(n.value.options=[{id:Date.now(),option_key:"A",option_text:"",is_correct:!1,order_index:0},{id:Date.now()+1,option_key:"B",option_text:"",is_correct:!1,order_index:1}])}else n.value.options=[]},L=()=>{n.value.subject_id=null,n.value.topic_id=null},oe=()=>{n.value.topic_id=null},ie=()=>{n.value.hints.push("")},se=()=>{i("submit",n.value)},ne=()=>{n.value.status="draft",i("submit",n.value)};return p(()=>a.modelValue,e=>{n.value={...n.value,...e}},{deep:!0}),w(()=>{(async()=>{try{const e=await U.get("/api/question-types");d.value=e.data.data||e.data}catch(e){console.error("Failed to load question types:",e)}})(),(async()=>{try{const e=await U.get("/api/grades");r.value=e.data.data||e.data}catch(e){console.error("Failed to load grades:",e)}})(),(async()=>{try{const e=await U.get("/api/subjects");q.value=e.data.data||e.data,console.log("ddddddd",e.data.data),console.log("subjects",q.value)}catch(e){console.error("Failed to load subjects:",e)}})(),(async()=>{try{const e=await U.get("/api/topics");V.value=e.data.data||e.data}catch(e){console.error("Failed to load topics:",e)}})()}),(e,l)=>(_(),x(A,{onSubmit:se,class:"question-form"},{default:g(()=>{var a;return[b("div",B,[l[13]||(l[13]=b("div",{class:"text-subtitle1 q-mb-md"},"Question Type",-1)),f(O,{modelValue:n.value.question_type_id,"onUpdate:modelValue":[l[0]||(l[0]=e=>n.value.question_type_id=e),I],options:d.value,"option-value":"id","option-label":"name","emit-value":"","map-options":"",outlined:"",dense:"",label:"Select question type *",rules:[e=>!!e||"Question type is required"]},{prepend:g(()=>[f(t,{name:"quiz"})]),_:1},8,["modelValue","options","rules"])]),b("div",H,[l[14]||(l[14]=b("div",{class:"text-subtitle1 q-mb-md"},"Question Text",-1)),f(o,{modelValue:n.value.question_text,"onUpdate:modelValue":l[1]||(l[1]=e=>n.value.question_text=e),type:"textarea",outlined:"",label:"Enter your question *",rows:"4",rules:[e=>!!e||"Question text is required",e=>e.length>=10||"Question must be at least 10 characters"]},null,8,["modelValue","rules"])]),b("div",N,[l[15]||(l[15]=b("div",{class:"text-subtitle1 q-mb-md"},"Curriculum Alignment",-1)),b("div",T,[b("div",R,[f(O,{modelValue:n.value.grade_id,"onUpdate:modelValue":[l[2]||(l[2]=e=>n.value.grade_id=e),L],options:r.value,"option-value":"id","option-label":"name","emit-value":"","map-options":"",outlined:"",dense:"",label:"Grade",clearable:""},{prepend:g(()=>[f(t,{name:"school"})]),_:1},8,["modelValue","options"])]),b("div",$,[f(O,{modelValue:n.value.subject_id,"onUpdate:modelValue":[l[3]||(l[3]=e=>n.value.subject_id=e),oe],options:z.value,"option-value":"id","option-label":"name","emit-value":"","map-options":"",outlined:"",dense:"",label:"Subject",clearable:"",disable:!n.value.grade_id},{prepend:g(()=>[f(t,{name:"subject"})]),_:1},8,["modelValue","options","disable"])]),b("div",G,[f(O,{modelValue:n.value.topic_id,"onUpdate:modelValue":l[4]||(l[4]=e=>n.value.topic_id=e),options:D.value,"option-value":"id","option-label":"name","emit-value":"","map-options":"",outlined:"",dense:"",label:"Topic",clearable:"",disable:!n.value.subject_id},{prepend:g(()=>[f(t,{name:"label"})]),_:1},8,["modelValue","options","disable"])])])]),b("div",J,[l[16]||(l[16]=b("div",{class:"text-subtitle1 q-mb-md"},"Cognitive Settings",-1)),b("div",P,[b("div",Z,[f(O,{modelValue:n.value.difficulty_level,"onUpdate:modelValue":l[5]||(l[5]=e=>n.value.difficulty_level=e),options:Q,"emit-value":"","map-options":"",outlined:"",dense:"",label:"Difficulty"},{prepend:g(()=>[f(t,{name:"speed"})]),_:1},8,["modelValue"])]),b("div",K,[f(O,{modelValue:n.value.bloom_level,"onUpdate:modelValue":l[6]||(l[6]=e=>n.value.bloom_level=e),options:C,"emit-value":"","map-options":"",outlined:"",dense:"",label:"Bloom Level"},{prepend:g(()=>[f(t,{name:"psychology"})]),_:1},8,["modelValue"])]),b("div",W,[f(o,{modelValue:n.value.estimated_time_sec,"onUpdate:modelValue":l[7]||(l[7]=e=>n.value.estimated_time_sec=e),modelModifiers:{number:!0},type:"number",outlined:"",dense:"",label:"Est. Time (seconds)",min:"0"},{prepend:g(()=>[f(t,{name:"timer"})]),_:1},8,["modelValue"])])])]),(null==(a=F.value)?void 0:a.has_options)?(_(),v("div",X,[f(M,{modelValue:n.value.options,"onUpdate:modelValue":l[8]||(l[8]=e=>n.value.options=e),"allow-multiple":S.value,"min-options":2,"max-options":6},null,8,["modelValue","allow-multiple"])])):y("",!0),b("div",Y,[l[17]||(l[17]=b("div",{class:"text-subtitle1 q-mb-md"},"Hints (Optional)",-1)),(_(!0),v(j,null,k(n.value.hints,(e,l)=>(_(),v("div",{key:l,class:"row q-col-gutter-sm q-mb-sm"},[b("div",ee,[f(o,{modelValue:n.value.hints[l],"onUpdate:modelValue":e=>n.value.hints[l]=e,outlined:"",dense:"",label:`Hint ${l+1}`},null,8,["modelValue","onUpdate:modelValue","label"])]),b("div",null,[f(u,{flat:"",round:"",dense:"",icon:"close",size:"sm",color:"negative",onClick:e=>(e=>{n.value.hints.splice(e,1)})(l)},null,8,["onClick"])])]))),128)),f(u,{flat:"",icon:"add",label:"Add Hint",color:"primary",size:"sm",onClick:ie})]),b("div",le,[l[18]||(l[18]=b("div",{class:"text-subtitle1 q-mb-md"},"Explanation (Optional)",-1)),f(o,{modelValue:n.value.explanation.text,"onUpdate:modelValue":l[9]||(l[9]=e=>n.value.explanation.text=e),type:"textarea",outlined:"",label:"Explain the correct answer",rows:"3"},null,8,["modelValue"]),f(s,{modelValue:n.value.explanation.revealed_after_attempt,"onUpdate:modelValue":l[10]||(l[10]=e=>n.value.explanation.revealed_after_attempt=e),label:"Reveal after first attempt",class:"q-mt-sm"},null,8,["modelValue"])]),b("div",ae,[l[19]||(l[19]=b("div",{class:"text-subtitle1 q-mb-md"},"Status",-1)),f(O,{modelValue:n.value.status,"onUpdate:modelValue":l[11]||(l[11]=e=>n.value.status=e),options:E,"emit-value":"","map-options":"",outlined:"",dense:"",label:"Question status"},{prepend:g(()=>[f(t,{name:"flag"})]),_:1},8,["modelValue"])]),b("div",te,[f(u,{flat:"",label:"Cancel",color:"grey-7",onClick:l[12]||(l[12]=l=>e.$emit("cancel"))}),f(u,{flat:"",label:"Save as Draft",color:"grey-8",onClick:ne,loading:h.value},null,8,["loading"]),f(u,{type:"submit",label:"Save",color:"primary",loading:h.value},null,8,["loading"])])]}),_:1}))}},[["__scopeId","data-v-175e56dd"]]),ie={class:"question-editor-page"},se={class:"q-pa-md"},ne={class:"row items-center q-mb-lg"},ue={class:"q-ma-none"},de={class:"text-grey-7 q-mb-none"},re={key:0,class:"text-center q-py-xl"},ce=e({__name:"QuestionEditor",props:{question:{type:Object,default:null},questionId:{type:[String,Number],default:null}},setup(e){Q();const t=d(),o=e,i=c(o.question||{}),s=c(!1),n=c(!1),p=m(()=>!!o.questionId&&"new"!==o.questionId),y=async e=>{var l,a,i,s,u;n.value=!0;try{const l={question_type_id:e.question_type_id,question_text:e.question_text,grade_id:e.grade_id||null,subject_id:e.subject_id||null,topic_id:e.topic_id||null,difficulty_level:e.difficulty_level||null,bloom_level:e.bloom_level||null,estimated_time_sec:e.estimated_time_sec||null,status:e.status||"draft",hints:e.hints&&e.hints.length>0?e.hints.filter(e=>e.trim()):null,explanation:e.explanation&&e.explanation.text?e.explanation:null,options:e.options&&e.options.length>0?e.options.map((e,l)=>({id:e.id>1e12?void 0:e.id,option_key:e.option_key,option_text:e.option_text,is_correct:e.is_correct,order_index:l})):void 0};let a;a=p.value?await U.put(`/api/questions/${o.questionId}`,l):await U.post("/api/questions",l),a.data.success&&(t.notify({type:"positive",message:p.value?"Question updated successfully":"Question created successfully"}),E.visit("/questions"))}catch(d){if(console.error("Failed to save question:",d),422===(null==(l=d.response)?void 0:l.status)){const e=(null==(a=d.response.data.error)?void 0:a.details)||d.response.data.errors,l=Object.values(e).flat().join(", ");t.notify({type:"negative",message:"Validation failed",caption:l,timeout:5e3})}else t.notify({type:"negative",message:"Failed to save question",caption:(null==(u=null==(s=null==(i=d.response)?void 0:i.data)?void 0:s.error)?void 0:u.message)||d.message})}finally{n.value=!1}},V=()=>{E.visit("/questions")};return w(()=>{p.value&&(async()=>{var e,l,a;if(p.value&&!o.question){s.value=!0;try{const e=await U.get(`/api/questions/${o.questionId}`);e.data.success&&(i.value=e.data.data,i.value.hints||(i.value.hints=[]),i.value.explanation||(i.value.explanation={text:"",revealed_after_attempt:!0}))}catch(n){console.error("Failed to load question:",n),t.notify({type:"negative",message:"Failed to load question",caption:(null==(a=null==(l=null==(e=n.response)?void 0:e.data)?void 0:l.error)?void 0:a.message)||n.message}),V()}finally{s.value=!1}}})()}),(e,t)=>(_(),v(j,null,[f(h(C),{title:p.value?"Edit Question":"Create Question"},null,8,["title"]),b("div",ie,[b("div",se,[b("div",ne,[f(u,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:V,class:"q-mr-md"}),b("div",null,[b("h4",ue,q(p.value?"Edit Question":"Create New Question"),1),b("p",de,q(p.value?"Update question details":"Add a new question to your bank"),1)])]),s.value?(_(),v("div",re,[f(r,{color:"primary",size:"50px"}),t[1]||(t[1]=b("p",{class:"text-grey-7 q-mt-md"},"Loading question...",-1))])):(_(),x(l,{key:1,flat:"",bordered:""},{default:g(()=>[f(a,{class:"q-pa-lg"},{default:g(()=>[f(oe,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),mode:p.value?"edit":"create",onSubmit:y,onCancel:V},null,8,["modelValue","mode"])]),_:1})]),_:1}))])])],64))}},[["__scopeId","data-v-0aabbec6"]]);export{ce as default};
