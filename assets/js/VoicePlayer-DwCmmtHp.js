import{o as e,u as a,Q as l,p as o}from"./app-DOc39CFu.js";import{Q as t}from"./QLinearProgress-DkNjmMsH.js";import{f as r,a as u,k as n,o as i,e as s,M as v,J as c,N as d,Q as f,b as p,V as m,K as y,W as h,n as g}from"./vendor-DuKqz2x4.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";const w={class:"voice-player"},k={class:"row items-center q-gutter-sm"},_={class:"col"},C={class:"text-caption text-grey-7 time-display"},R=["src"],W=e({__name:"VoicePlayer",props:{audioUrl:{type:String,required:!0},showWaveform:{type:Boolean,default:!1},autoplay:{type:Boolean,default:!1}},setup(e){const W=e,b=a(),x=r(null),E=r(null),j=r(null),S=r(!1),z=r(!1),B=r(0),M=r(0),Q=r(!1),T=r(1),U=r([]),q=[.5,.75,1,1.25,1.5,2],N=u(()=>M.value>0?B.value/M.value:0),P=async()=>{if(x.value)try{S.value?x.value.pause():(z.value=!0,await x.value.play())}catch(e){console.error("Error playing audio:",e),b.notify({type:"negative",message:"Failed to play audio",position:"top"})}finally{z.value=!1}},$=e=>{if(!x.value||0===M.value)return;const a=e.target.getBoundingClientRect(),l=(e.clientX-a.left)/a.width*M.value;x.value.currentTime=l},A=e=>{if(!x.value||0===M.value)return;const a=E.value.getBoundingClientRect(),l=(e.clientX-a.left)/a.width*M.value;x.value.currentTime=l},D=()=>{x.value&&(Q.value=!Q.value,x.value.muted=Q.value)},L=()=>{const e=(q.indexOf(T.value)+1)%q.length;T.value=q[e],x.value&&(x.value.playbackRate=T.value)},V=()=>{const e=document.createElement("a");e.href=W.audioUrl,e.download=`voice-note-${Date.now()}.wav`,document.body.appendChild(e),e.click(),document.body.removeChild(e)},X=e=>{if(!e||isNaN(e))return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`},F=()=>{if(!E.value||!U.value.length)return;const e=E.value,a=e.getContext("2d"),l=e.width,o=e.height;a.clearRect(0,0,l,o),a.fillStyle="#1976d2";const t=l/U.value.length;U.value.forEach((e,l)=>{const r=e*o,u=l*t,n=(o-r)/2;a.fillRect(u,n,t-1,r)}),N.value>0&&(a.fillStyle="rgba(25, 118, 210, 0.3)",a.fillRect(0,0,l*N.value,o))},I=()=>{M.value=x.value.duration,W.autoplay&&P(),W.showWaveform&&(async()=>{if(W.showWaveform&&x.value)try{const e=100,a=[];for(let l=0;l<e;l++)a.push(.8*Math.random()+.1);U.value=a,await g(),F()}catch(e){console.error("Error generating waveform:",e)}})()},J=()=>{B.value=x.value.currentTime,W.showWaveform&&F()},K=()=>{S.value=!1,B.value=0,W.showWaveform&&F()},O=e=>{console.error("Audio error:",e),z.value=!1,b.notify({type:"negative",message:"Error loading audio file",position:"top"})};return n(()=>{var e;return null==(e=x.value)?void 0:e.paused},e=>{S.value=!e}),n(()=>W.audioUrl,()=>{x.value&&x.value.load()}),i(()=>{if(E.value&&W.showWaveform){const e=E.value;e.width=e.offsetWidth,e.height=60}}),s(()=>{x.value&&x.value.pause()}),(a,r)=>(c(),v("div",w,[d("div",k,[p(l,{icon:S.value?"pause":"play_arrow",round:"",color:"primary",size:"sm",onClick:P,loading:z.value},null,8,["icon","loading"]),d("div",_,[p(t,{value:N.value,color:"primary","track-color":"grey-3",size:"8px",rounded:"",class:"cursor-pointer",onClick:$},null,8,["value"])]),d("div",C,m(X(B.value))+" / "+m(X(M.value)),1),p(l,{icon:Q.value?"volume_off":"volume_up",flat:"",round:"",size:"sm",onClick:D},null,8,["icon"]),p(l,{icon:"download",flat:"",round:"",size:"sm",onClick:V},{default:y(()=>[p(o,null,{default:y(()=>r[0]||(r[0]=[h("Download Audio")])),_:1})]),_:1}),p(l,{flat:"",round:"",size:"sm",onClick:L,class:"speed-btn"},{default:y(()=>[h(m(T.value)+"x ",1),p(o,null,{default:y(()=>r[1]||(r[1]=[h("Playback Speed")])),_:1})]),_:1})]),e.showWaveform?(c(),v("div",{key:0,class:"waveform-container q-mt-sm",ref_key:"waveformRef",ref:j},[d("canvas",{ref_key:"canvasRef",ref:E,class:"waveform-canvas",onClick:A},null,512)],512)):f("",!0),d("audio",{ref_key:"audioRef",ref:x,src:e.audioUrl,preload:"metadata",onLoadedmetadata:I,onTimeupdate:J,onEnded:K,onError:O},null,40,R)]))}},[["__scopeId","data-v-7967f027"]]);export{W as default};
