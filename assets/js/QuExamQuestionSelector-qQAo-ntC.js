import{Q as e}from"./QSpace-CtVAwmqA.js";import{c as l,Q as a,f as t,d as o,p as s,C as i,l as u,m as n,aP as r,b as d}from"./app-BwCflFkV.js";import{Q as c}from"./QSelect-Cyosk05W.js";import{Q as m}from"./QTd-DftUN1Nv.js";import{Q as p}from"./QBadge-CShv2hr3.js";import{Q as v}from"./QTable-C_EQBQcS.js";import{s as b}from"./i18n-CP46N9fu.js";import{f,r as y,a as _,k as g,Z as h,H as w,I as Q,J as V,b as q,O as k,M as x,U as j,V as C,L as S,Q as U,F as T,x as z}from"./vendor-CUZ9QTQV.js";import P from"./QuQuestionDisplay-CwxtGci-.js";import"./offline-BzIlwqNM.js";import"./ui-LrZmvB2D.js";import"./rtl-Cr6c3OOr.js";import"./QMarkupTable-CFmFAA-C.js";import"./QLinearProgress-BKKQOFX1.js";import"./use-fullscreen-X4x-6n9-.js";import"./katex-BAATRBTg.js";import"./katex-BXKQVcz-.js";const I={class:"row q-gutter-md"},A={class:"row items-center q-gutter-sm"},B={class:"text-subtitle2"},D={class:"text-subtitle2"},M={class:"text-caption text-grey-7"},F={class:"row q-gutter-sm"},L={__name:"QuExamQuestionSelector",props:{modelValue:Boolean,subjectId:[Number,String],selectedQuestions:{type:Array,default:()=>[]}},emits:["update:modelValue","update:selectedQuestions"],setup(L,{emit:N}){const $=L,O=N,E=f([]),R=f([...$.selectedQuestions]),H=f(!1),J=f(!1),Z=f(null),G=f([]),K=y({difficulty:null,bloom_level:null,topic_id:null,question_type:null,search:""}),W=f({page:1,rowsPerPage:50,rowsNumber:0}),X=["easy","medium","hard"],Y=["remember","understand","apply","analyze","evaluate","create"],ee=[{value:"mcq",label:"Multiple Choice"},{value:"true_false",label:"True/False"},{value:"short",label:"Short Answer"},{value:"long",label:"Long Answer"}],le=[{name:"id",label:"ID",field:"id",align:"left",sortable:!0},{name:"question_text",label:"Question",field:"question_text",align:"left"},{name:"question_type",label:"Type",field:"question_type",align:"center"},{name:"difficulty",label:"Difficulty",field:"difficulty",align:"center"},{name:"bloom_level",label:"Bloom",field:"bloom_level",align:"center"},{name:"marks",label:"Marks",field:"marks",align:"center"},{name:"preview",label:"Preview",align:"center"}],ae=_(()=>R.value.reduce((e,l)=>e+(l.marks||0),0)),te=_(()=>{const e={remember:0,understand:0,apply:0,analyze:0,evaluate:0,create:0};return R.value.forEach(l=>{l.bloom_level&&e.hasOwnProperty(l.bloom_level)&&e[l.bloom_level]++}),e});g(()=>$.modelValue,e=>{e&&(oe(),se(),R.value=[...$.selectedQuestions])}),g(()=>$.selectedQuestions,e=>{R.value=[...e]});const oe=async()=>{if($.subjectId){H.value=!0;try{const e={subject_id:$.subjectId,...K,page:W.value.page},l=await h.get(b("qu-exams.questions.available"),{params:e});E.value=l.data.questions.data,W.value.rowsNumber=l.data.questions.total}catch(e){console.error("Failed to load questions:",e)}finally{H.value=!1}}},se=async()=>{if($.subjectId)try{G.value=[]}catch(e){console.error("Failed to load topics:",e)}},ie=e=>{W.value.page=e.pagination.page,oe()},ue=()=>{R.value=[...E.value]},ne=()=>{R.value=[]},re=()=>{const e=new Set(R.value.map(e=>e.id));R.value=E.value.filter(l=>!e.has(l.id))},de=()=>{O("update:selectedQuestions",R.value),O("update:modelValue",!1)};function ce(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}function me(e){return{remember:"psychology",understand:"lightbulb",apply:"build",analyze:"analytics",evaluate:"fact_check",create:"auto_awesome"}[e]||"help"}return(b,f)=>(Q(),w(d,{"model-value":L.modelValue,"onUpdate:modelValue":f[9]||(f[9]=e=>b.$emit("update:modelValue",e)),maximized:""},{default:V(()=>[q(n,null,{default:V(()=>[q(l,{class:"row items-center q-pb-none"},{default:V(()=>[f[10]||(f[10]=x("div",{class:"text-h6"},"Select Questions",-1)),q(e),q(a,{icon:"close",flat:"",round:"",dense:"",onClick:f[0]||(f[0]=e=>b.$emit("update:modelValue",!1))})]),_:1}),q(l,null,{default:V(()=>[x("div",I,[q(c,{modelValue:K.difficulty,"onUpdate:modelValue":[f[1]||(f[1]=e=>K.difficulty=e),oe],options:X,label:"Difficulty",clearable:"",style:{"min-width":"150px"}},null,8,["modelValue"]),q(c,{modelValue:K.bloom_level,"onUpdate:modelValue":[f[2]||(f[2]=e=>K.bloom_level=e),oe],options:Y,label:"Bloom Level",clearable:"",style:{"min-width":"150px"}},null,8,["modelValue"]),q(c,{modelValue:K.topic_id,"onUpdate:modelValue":[f[3]||(f[3]=e=>K.topic_id=e),oe],options:G.value,"option-value":"id","option-label":"name",label:"Topic",clearable:"","emit-value":"","map-options":"",style:{"min-width":"200px"}},null,8,["modelValue","options"]),q(c,{modelValue:K.question_type,"onUpdate:modelValue":[f[4]||(f[4]=e=>K.question_type=e),oe],options:ee,"option-value":"value","option-label":"label",label:"Question Type",clearable:"","emit-value":"","map-options":"",style:{"min-width":"150px"}},null,8,["modelValue"]),q(t,{modelValue:K.search,"onUpdate:modelValue":[f[5]||(f[5]=e=>K.search=e),oe],label:"Search",debounce:"500",clearable:"",style:{"min-width":"200px"}},{prepend:V(()=>[q(o,{name:"search"})]),_:1},8,["modelValue"])])]),_:1}),q(l,{class:"q-pt-none"},{default:V(()=>[x("div",A,[q(a,{size:"sm",outline:"",color:"primary",label:"Select All",onClick:ue}),q(a,{size:"sm",outline:"",color:"primary",label:"Select None",onClick:ne}),q(a,{size:"sm",outline:"",color:"primary",label:"Inverse",onClick:re}),q(e),x("div",B," Selected: "+j(R.value.length)+" questions | Total Marks: "+j(ae.value),1)])]),_:1}),q(l,null,{default:V(()=>[q(v,{rows:E.value,columns:le,"row-key":"id",selection:"multiple",selected:R.value,"onUpdate:selected":f[6]||(f[6]=e=>R.value=e),flat:"",bordered:"",loading:H.value,pagination:W.value,onRequest:ie},{"body-cell-question_text":V(e=>[q(m,{props:e},{default:V(()=>{var l,a,t;return[x("div",D,j((a=e.row.question_text,t=80,a&&a.length>t?a.substring(0,t)+"...":a)),1),x("div",M,j(null==(l=e.row.topic)?void 0:l.name),1)]}),_:2},1032,["props"])]),"body-cell-difficulty":V(e=>[q(m,{props:e},{default:V(()=>{return[q(p,{color:(l=e.row.difficulty,{easy:"green",medium:"orange",hard:"red"}[l]||"grey"),label:e.row.difficulty},null,8,["color","label"])];var l}),_:2},1032,["props"])]),"body-cell-bloom_level":V(e=>[q(m,{props:e},{default:V(()=>[e.row.bloom_level?(Q(),w(i,{key:0,dense:"",icon:me(e.row.bloom_level),color:"purple-3"},{default:V(()=>[C(j(ce(e.row.bloom_level)),1)]),_:2},1032,["icon"])):k("",!0)]),_:2},1032,["props"])]),"body-cell-preview":V(e=>[q(m,{props:e},{default:V(()=>[q(a,{flat:"",dense:"",round:"",color:"primary",icon:"visibility",onClick:l=>{return a=e.row,Z.value=a,void(J.value=!0);var a}},{default:V(()=>[q(s,null,{default:V(()=>f[11]||(f[11]=[C("Preview")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","selected","loading","pagination"])]),_:1}),R.value.length>0?(Q(),w(l,{key:0},{default:V(()=>[f[12]||(f[12]=x("div",{class:"text-subtitle2 q-mb-sm"},"Bloom Distribution of Selected Questions",-1)),x("div",F,[(Q(!0),S(T,null,U(te.value,(e,l)=>(Q(),S(T,{key:l},[e>0?(Q(),w(i,{key:0,icon:me(l),color:"purple-2"},{default:V(()=>[C(j(ce(l))+": "+j(e),1)]),_:2},1032,["icon"])):k("",!0)],64))),128))])]),_:1})):k("",!0),q(u,{align:"right"},{default:V(()=>[q(a,{flat:"",label:"Cancel",color:"negative",onClick:f[7]||(f[7]=e=>b.$emit("update:modelValue",!1))}),q(a,{unelevated:"",label:`Confirm (${R.value.length} questions)`,color:"primary",onClick:de,disable:0===R.value.length},null,8,["label","disable"])]),_:1})]),_:1}),q(d,{modelValue:J.value,"onUpdate:modelValue":f[8]||(f[8]=e=>J.value=e)},{default:V(()=>[q(n,{style:{"min-width":"500px"}},{default:V(()=>[q(l,null,{default:V(()=>f[13]||(f[13]=[x("div",{class:"text-h6"},"Question Preview",-1)])),_:1}),Z.value?(Q(),w(l,{key:0},{default:V(()=>[q(P,{question:Z.value},null,8,["question"])]),_:1})):k("",!0),q(u,{align:"right"},{default:V(()=>[z(q(a,{flat:"",label:"Close",color:"primary"},null,512),[[r]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["model-value"]))}};export{L as default};
