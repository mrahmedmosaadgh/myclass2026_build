import e from"./CanvasToolbar-4Pd4HkBZ.js";import{d as t,f as a,o as l,e as n,N as o,J as i,b as u,R as r,O as s,U as v}from"./vendor-BWKGNkNB.js";import{r as c}from"./app-BxJhpxku.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";const d={class:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50"},h={class:"max-w-5xl mx-auto px-4 pt-32 pb-10"},g={class:"bg-white/90 backdrop-blur-xl rounded-3xl shadow-2xl overflow-hidden border border-white/40"},p={key:1,class:"inset-0 bg-black/70 flex items-center justify-center z-50 backdrop-blur-sm"},f=c(t({__name:"draw3",setup(t){const c=a(null);let f=null,m=null,w=[];const b=a("pen"),x=a("#8B5CF6"),y=a(6),R=a(null),k=a("original"),P=a("top-center"),U=a(!1),L=a(!1),j=a(!1),I=a(0),A=a(null),F=a(null),C=a([]),S=a([]),T=a([]),D=a(-1);let M=0,B=null;function E(e){"F7"===e.key?(e.preventDefault(),L.value?j.value=!j.value:Q()):"F8"===e.key?(e.preventDefault(),ee()):"F9"===e.key&&(e.preventDefault(),ee(),setTimeout(()=>Q(),10))}function O(){if(!c.value||!f)return;const e=c.value.getBoundingClientRect();c.value.width=e.width*devicePixelRatio,c.value.height=e.height*devicePixelRatio,f.scale(devicePixelRatio,devicePixelRatio),G()}function W(e){if(!c.value)return{x:0,y:0};const t=c.value.getBoundingClientRect();return{x:(e.clientX-t.left)*devicePixelRatio,y:(e.clientY-t.top)*devicePixelRatio}}function z(e){if(L.value||!f)return;U.value=!0;const t=W(e);C.value.push({tool:b.value,color:"pen"===b.value?x.value:null,width:y.value,path:[t]}),f.beginPath(),f.moveTo(t.x/devicePixelRatio,t.y/devicePixelRatio),q()}function J(e){if(!U.value||!f||!C.value.length)return;const t=W(e);C.value[C.value.length-1].path.push(t),f.lineTo(t.x/devicePixelRatio,t.y/devicePixelRatio),f.stroke()}function _(){U.value&&(U.value=!1,N())}function q(e){if(!f)return;const t=null!=e?e:{tool:b.value,color:x.value,width:y.value};f.globalCompositeOperation="eraser"===t.tool?"destination-out":"source-over","eraser"!==t.tool&&(f.strokeStyle=t.color),f.lineWidth=t.width}function N(){if(!f||!c.value)return;const e=f.getImageData(0,0,c.value.width,c.value.height);T.value=T.value.slice(0,D.value+1),T.value.push(e),D.value=T.value.length-1}function V(){D.value<=0||(D.value--,f&&c.value&&f.putImageData(T.value[D.value],0,0))}function X(){f&&c.value&&(f.clearRect(0,0,c.value.width,c.value.height),C.value=[],S.value=[],R.value=null,T.value=[],D.value=-1,N())}function Y(){R.value=null,G()}function $(){if(!f||!c.value||!R.value)return;const e=new Image;e.src=R.value,e.onload=()=>{const t=c.value.width/devicePixelRatio,a=c.value.height/devicePixelRatio;let l=0,n=0,o=e.width,i=e.height;if("contain"===k.value){const u=Math.min(t/e.width,a/e.height);o=e.width*u,i=e.height*u,l=(t-o)/2,n="top-center"===P.value?0:(a-i)/2}else{if("fill"===k.value)return void f.drawImage(e,0,0,t,a);if("cover"===k.value){const u=Math.max(t/e.width,a/e.height);o=e.width*u,i=e.height*u,l=(t-o)/2,n=(a-i)/2}else"original"===k.value&&(l=(t-e.width)/2,n="top-center"===P.value?0:(a-e.height)/2)}f.drawImage(e,l,n,o,i)}}function G(){f&&c.value&&(f.clearRect(0,0,c.value.width,c.value.height),$(),function(){if(!f)return;for(const e of C.value)if(!(e.path.length<2)){f.beginPath(),f.moveTo(e.path[0].x/devicePixelRatio,e.path[0].y/devicePixelRatio),q(e);for(let t=1;t<e.path.length;t++)f.lineTo(e.path[t].x/devicePixelRatio,e.path[t].y/devicePixelRatio);f.stroke()}}())}function H(){if(0===C.value.length)return;let e=0;for(const l of C.value)e+=l.path.length;let t=0;for(let l=0;l<C.value.length-1;l++)t+=C.value[l].path.length;t+=C.value[C.value.length-1].path.length;const a=e>0?t/e:0;S.value.push({globalIndex:t,progress:a}),S.value.sort((e,t)=>e.progress-t.progress)}function K(){"recording"===(null==m?void 0:m.state)&&m.stop()}async function Q(){if(0===C.value.length||!f||!c.value)return;if(L.value=!0,j.value=!1,I.value=0,M=0,f.clearRect(0,0,c.value.width,c.value.height),R.value){const e=new Image;e.src=R.value,await new Promise(t=>e.onload=t),$()}const e=C.value.reduce((e,t)=>e+t.path.length,0),t=()=>{if(!L.value||j.value)return void(B=requestAnimationFrame(t));if(M>=e)return void(L.value=!1);let a=0,l=null,n=0;for(const e of C.value){if(M<a+e.path.length){l=e,n=M-a;break}a+=e.path.length}if(l&&f){const e=l.path[n];0===n?(f.beginPath(),f.moveTo(e.x/devicePixelRatio,e.y/devicePixelRatio)):f.lineTo(e.x/devicePixelRatio,e.y/devicePixelRatio),q(l),f.stroke()}M++,I.value=M/e*100;const o=S.value.find(e=>e.globalIndex===M&&e.audio);(null==o?void 0:o.audio)&&new Audio(o.audio).play(),S.value.some(e=>e.globalIndex===M)&&(j.value=!0),B=requestAnimationFrame(t)};B=requestAnimationFrame(t)}function Z(){j.value=!1}function ee(){L.value=!1,j.value=!1,B&&cancelAnimationFrame(B),M=0,G()}async function te(){if(!L.value)try{const e=await navigator.clipboard.read();for(const t of e)if(t.types.some(e=>e.startsWith("image/"))){const e=await t.getType(t.types.find(e=>e.startsWith("image/")));return void le(URL.createObjectURL(e))}}catch(e){console.log("No image in clipboard or permission denied")}}function ae(e){var t;if(L.value)return;const a=null==(t=e.clipboardData)?void 0:t.items;if(a)for(const l of a)if(l.type.startsWith("image/")){e.preventDefault();const t=l.getAsFile();return void(t&&le(URL.createObjectURL(t)))}}function le(e){const t=new Image;t.onload=()=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),R.value=e.toDataURL("image/png"),G()},t.src=e}function ne(){const e={version:10,background:R.value,bgMode:k.value,bgAlign:P.value,strokes:C.value,breakpoints:S.value},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.download=`drawing-${(new Date).toISOString().slice(0,10)}.json`,l.click(),URL.revokeObjectURL(a)}function oe(e){var t;const a=null==(t=e.target.files)?void 0:t[0];if(!a)return;const l=new FileReader;l.onload=()=>{try{const e=JSON.parse(l.result);R.value=e.background||null,k.value=e.bgMode||"original",P.value=e.bgAlign||"top-center",C.value=e.strokes||[],S.value=e.breakpoints||[],G(),N()}catch(e){alert("Invalid file")}},l.readAsText(a)}return l(()=>{!function(){if(!c.value)return;if(f=c.value.getContext("2d",{willReadFrequently:!0}),!f)return;f.lineCap="round",f.lineJoin="round",O(),N()}(),window.addEventListener("resize",O),window.addEventListener("paste",ae),window.addEventListener("keydown",E)}),n(()=>{window.removeEventListener("resize",O),window.removeEventListener("paste",ae),window.removeEventListener("keydown",E),B&&cancelAnimationFrame(B)}),(t,a)=>(i(),o("div",d,[u(e,{tool:b.value,"onUpdate:tool":a[0]||(a[0]=e=>b.value=e),color:x.value,"onUpdate:color":a[1]||(a[1]=e=>x.value=e),lineWidth:y.value,"onUpdate:lineWidth":a[2]||(a[2]=e=>y.value=e),"bg-mode":k.value,"onUpdate:bgMode":a[3]||(a[3]=e=>k.value=e),"bg-align":P.value,"onUpdate:bgAlign":a[4]||(a[4]=e=>P.value=e),"is-drawing":U.value,"is-replaying":L.value,"replay-paused":j.value,"replay-progress":I.value,"strokes-length":C.value.length,"has-bg":!!R.value,"history-step":D.value,onAddBreakpoint:H,onClear:X,onUndo:V,onPasteBg:te,onRemoveBg:Y,onSave:ne,onLoad:oe,onStartReplay:Q,onStopReplay:ee,onResumeReplay:Z,onPauseReplay:a[5]||(a[5]=e=>j.value=!0)},null,8,["tool","color","lineWidth","bg-mode","bg-align","is-drawing","is-replaying","replay-paused","replay-progress","strokes-length","has-bg","history-step"]),r("div",h,[r("div",g,[r("canvas",{ref_key:"canvas",ref:c,onPointerdown:z,onPointermove:J,onPointerup:_,onPointerleave:_,onPointercancel:_,class:v(["w-full block touch-none","eraser"===b.value?"cursor-eraser":"cursor-crosshair"]),style:{height:"calc(100vh - 280px)","min-height":"520px"}},null,34)]),null!==F.value&&null===A.value?(i(),o("button",{key:0,onClick:a[6]||(a[6]=e=>async function(e){try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});m=new MediaRecorder(t),w=[],m.ondataavailable=e=>w.push(e.data),m.onstop=()=>{const a=new Blob(w,{type:"audio/webm"}),l=new FileReader;l.onload=()=>{S.value[e].audio=l.result,A.value=null,F.value=null},l.readAsDataURL(a),t.getTracks().forEach(e=>e.stop())},A.value=e,m.start(),setTimeout(()=>"recording"===(null==m?void 0:m.state)&&m.stop(),1e4)}catch(t){alert("Please allow microphone access"),F.value=null}}(F.value)),class:"bottom-8 right-8 w-20 h-20 bg-red-600 hover:bg-red-700 rounded-full shadow-2xl flex items-center justify-center animate-bounce z-50",title:"Start Voice Recording"},a[7]||(a[7]=[r("svg",{class:"w-12 h-12 text-white",fill:"currentColor",viewBox:"0 0 24 24"},[r("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),r("path",{d:"M19 11c0 3.87-3.13 7-7 7s-7-3.13-7-7"})],-1)]))):s("",!0),null!==A.value?(i(),o("div",p,[r("div",{class:"bg-white rounded-3xl p-12 text-center shadow-2xl"},[a[8]||(a[8]=r("div",{class:"w-28 h-28 bg-red-600 rounded-full mx-auto mb-6 animate-pulse flex items-center justify-center"},[r("div",{class:"w-16 h-16 bg-white rounded-full"})],-1)),a[9]||(a[9]=r("p",{class:"text-3xl font-bold text-red-600 mb-4"},"Recording...",-1)),a[10]||(a[10]=r("p",{class:"text-gray-600 text-lg"},"(Max 10 seconds)",-1)),r("button",{onClick:K,class:"mt-8 bg-gray-800 hover:bg-gray-900 text-white px-10 py-5 rounded-2xl text-xl font-bold transition"}," Stop & Save ")])])):s("",!0)])]))}}),[["__scopeId","data-v-74f6712f"]]);export{f as default};
