import{f as e,N as a,J as t,y as l,R as n,O as s,ac as i,W as u,ae as o,V as d,_ as r,z as c,af as m,F as p,Q as v,I as b,b as y,o as f}from"./vendor-BWKGNkNB.js";import{r as h}from"./app-Dtv5Fi9L.js";const g={class:"comment-composer"},k={class:"flex gap-2 mb-2"},_=["src"],w=["src"],q={class:"flex items-center gap-2"},x=["disabled"],I={key:0,class:"text-red-500 mt-1"},C=h({__name:"CommentComposer",props:{questionId:[String,Number],parentId:[String,Number]},setup(c){const m=c,p=e(""),v=e(!0),b=e(null),y=e(null),f=e(null),h=e(!1),C=e(null),R=e([]),S=e(!1),U=e("");function L(e){const a=e.target.files[0];a&&(b.value=a,a.type.startsWith("audio")?(y.value=URL.createObjectURL(a),f.value=null):a.type.startsWith("video")&&(f.value=URL.createObjectURL(a),y.value=null))}function P(){U.value="",navigator.mediaDevices&&window.MediaRecorder?navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{C.value=new MediaRecorder(e),R.value=[],C.value.ondataavailable=e=>{e.data.size>0&&R.value.push(e.data)},C.value.onstop=()=>{const e=new Blob(R.value,{type:"audio/webm"});b.value=new File([e],"voice.webm",{type:"audio/webm"}),y.value=URL.createObjectURL(e)},C.value.start(),h.value=!0}).catch(()=>{U.value="Could not access microphone."}):U.value="Voice recording not supported."}function T(){C.value&&(C.value.stop(),h.value=!1)}async function V(){var e,a,t,l;S.value=!0,U.value="";try{const e=new FormData;e.append("comment",p.value),e.append("is_public",v.value?1:0),m.parentId&&e.append("parent_id",m.parentId),b.value&&e.append("file",b.value),await r.post(`/api/resume-comments/${m.questionId}`,e),p.value="",b.value=null,y.value=null,f.value=null,C.value&&(C.value=null),R.value=[],emit("submitted")}catch(n){U.value=(null==(l=null==(t=null==(a=null==(e=n.response)?void 0:e.data)?void 0:a.errors)?void 0:t.file)?void 0:l[0])||"Failed to submit."}finally{S.value=!1}}return(e,r)=>(t(),a("div",g,[l(n("textarea",{"onUpdate:modelValue":r[0]||(r[0]=e=>p.value=e),placeholder:"Write a comment...",rows:"3",class:"w-full mb-2"},null,512),[[i,p.value]]),n("div",k,[n("input",{type:"file",ref:"fileInput",onChange:L,accept:"audio/*,video/*",class:"hidden"},null,544),n("button",{onClick:r[1]||(r[1]=a=>e.$refs.fileInput.click())},"Upload Audio/Video"),h.value?s("",!0):(t(),a("button",{key:0,onClick:P},"ðŸŽ¤ Record Voice")),h.value?(t(),a("button",{key:1,onClick:T},"â¹ï¸ Stop")):s("",!0),y.value?(t(),a("audio",{key:2,src:y.value,controls:"",class:"ml-2"},null,8,_)):s("",!0),f.value?(t(),a("video",{key:3,src:f.value,controls:"",class:"ml-2",width:"120"},null,8,w)):s("",!0)]),n("div",q,[n("label",null,[l(n("input",{type:"checkbox","onUpdate:modelValue":r[2]||(r[2]=e=>v.value=e)},null,512),[[o,v.value]]),r[3]||(r[3]=u(" Public"))]),n("button",{onClick:V,disabled:S.value},"Send",8,x)]),U.value?(t(),a("div",I,d(U.value),1)):s("",!0)]))}},[["__scopeId","data-v-009de892"]]),R=["src"],S=["src"],U=["src"],L=["href"],P={__name:"CommentMediaPlayer",props:{mediaType:String,mediaPath:String},setup(e){const l=e,n=computed(()=>l.mediaPath?`/storage/${l.mediaPath}`:null);return(l,i)=>(t(),a("div",null,["audio"===e.mediaType?(t(),a("audio",{key:0,src:c(n),controls:""},null,8,R)):"video"===e.mediaType?(t(),a("video",{key:1,src:c(n),controls:"",width:"200"},null,8,S)):"image"===e.mediaType?(t(),a("img",{key:2,src:c(n),alt:"Comment media",class:"max-w-xs"},null,8,U)):c(n)?(t(),a("a",{key:3,href:c(n),target:"_blank"},"Download file",8,L)):s("",!0)]))}},T={class:"comment-thread"},V={class:"flex items-center gap-2"},j={class:"font-bold"},D={class:"text-xs text-gray-500"},N={key:0,class:"text-xs text-red-500"},F={key:0,class:"mb-1"},M={class:"ml-4 mt-2"},O={__name:"CommentThread",props:{comments:Array,questionId:[String,Number]},setup:e=>(l,i)=>{const u=m("CommentThread",!0);return t(),a("div",T,[(t(!0),a(p,null,v(e.comments,o=>{var r;return t(),a("div",{key:o.id,class:"mb-4 border-b pb-2"},[n("div",V,[n("span",j,d((null==(r=o.user)?void 0:r.name)||"User"),1),n("span",D,d(new Date(o.created_at).toLocaleString()),1),o.is_public?s("",!0):(t(),a("span",N,"Private"))]),o.comment?(t(),a("div",F,d(o.comment),1)):s("",!0),o.media_path?(t(),b(P,{key:1,"media-type":o.media_type,"media-path":o.media_path},null,8,["media-type","media-path"])):s("",!0),n("div",M,[o.replies&&o.replies.length?(t(),b(u,{key:0,comments:o.replies},null,8,["comments"])):s("",!0),y(C,{"question-id":e.questionId,"parent-id":o.id,onSubmitted:i[0]||(i[0]=e=>l.$emit("refresh"))},null,8,["question-id","parent-id"])])])}),128))])}},W={__name:"ResumeCommentsPanel",props:{questionId:[String,Number]},setup(l){const n=l,s=e([]);async function i(){const e=await r.get("/api/resume-comments",{params:{question_id:n.questionId}});s.value=e.data}return f(i),(e,n)=>(t(),a("div",null,[y(C,{"question-id":l.questionId,onSubmitted:i},null,8,["question-id"]),y(O,{comments:s.value,"question-id":l.questionId,onRefresh:i},null,8,["comments","question-id"])]))}};export{W as _};
