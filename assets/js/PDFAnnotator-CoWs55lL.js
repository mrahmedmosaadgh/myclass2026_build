import{Y as e}from"./index-DHgm37GR.js";import a from"./html2canvas.esm-Cq3pa7K9.js";import{E as l}from"./jspdf.es.min-DKhx6mND.js";import{p as t}from"./app-BXm70mdJ.js";import{f as o,k as n,n as u,o as s,e as i,L as v,I as r,M as c,S as d,F as p,Q as m,R as h,O as g,U as b,H as f,y as k}from"./vendor-DNM7Y6Xn.js";import"./offline-BzIlwqNM.js";import"./i18n-CBOKL2HS.js";import"./ui-BP0GJNn5.js";const y={class:"pdf-annotator-app"},C={key:0,class:"upload-area"},w={class:"upload-box"},P={key:1,class:"viewer-area"},x={class:"toolbar"},L={class:"toolbar-group"},R={class:"toolbar-group colors-group"},O=["onClick","title"],W={key:0,class:"check"},E={class:"toolbar-group zoom-controls"},j=["disabled"],U={class:"zoom-display"},F=["disabled"],S={class:"toolbar-group quality-controls"},D={class:"nav-bar"},H=["disabled"],B=["disabled"],M=t({__name:"PDFAnnotator",setup(t){const M=o(""),_=o(1),Q=o(1),T=o("pen"),$=o("black"),q=o([{name:"Black",value:"black"},{name:"Red",value:"#e74c3c"},{name:"Blue",value:"#3498db"},{name:"Green",value:"#27ae60"},{name:"Yellow",value:"#f1c40f"},{name:"Orange",value:"#e67e22"},{name:"Purple",value:"#9b59b6"},{name:"Pink",value:"#e91e63"},{name:"Brown",value:"#795548"},{name:"Gray",value:"#95a5a6"}]),A=o({}),I=o(1),z=o("custom"),G=o(2),Y=o(null),Z=o(null),J=o(null);let N=null,X=!1,K=[];const V=e=>{const a=e.target.files[0];return a&&a.type.includes("pdf")?a.size>52428800?alert("File too big (max 50 MB)"):(M.value=URL.createObjectURL(a),_.value=1,Q.value=1,void(A.value={})):alert("Please select a PDF file")},ee=e=>{Q.value=e.numPages,console.log("PDF loaded with",Q.value,"pages")},ae=async()=>{await u(),console.log("Page",_.value,"rendered"),le(),ie()},le=()=>{var e;const a=null==(e=Z.value)?void 0:e.querySelector(".pdf-embed canvas");if(!a||!J.value)return;const l=a.getBoundingClientRect();J.value.width=l.width,J.value.height=l.height,J.value.style.width=`${l.width}px`,J.value.style.height=`${l.height}px`,N=J.value.getContext("2d",{willReadFrequently:!0}),N.lineWidth=3,N.lineCap="round",N.lineJoin="round";const t=J.value;t.onmousedown=t.ontouchstart=null,t.addEventListener("mousedown",ne),t.addEventListener("mousemove",ue),t.addEventListener("mouseup",se),t.addEventListener("mouseout",se),t.addEventListener("touchstart",e=>{e.preventDefault(),ne(e.touches[0])},{passive:!1}),t.addEventListener("touchmove",e=>{e.preventDefault(),ue(e.touches[0])},{passive:!1}),t.addEventListener("touchend",se),ie()},te=e=>{T.value=e,J.value&&(J.value.style.cursor="crosshair")},oe=e=>{const a=J.value.getBoundingClientRect();return{x:(e.clientX-a.left)/I.value,y:(e.clientY-a.top)/I.value}},ne=e=>{X=!0;const{x:a,y:l}=oe(e);K=[{x:a,y:l}],A.value[_.value]||(A.value[_.value]=[]),"eraser"===T.value?A.value[_.value].push({tool:"eraser",color:"white",points:K,lineWidth:20}):A.value[_.value].push({tool:"pen",color:$.value,points:K,lineWidth:3})},ue=e=>{if(!X||!N||0===K.length)return;const{x:a,y:l}=oe(e);K.push({x:a,y:l}),"eraser"===T.value?(N.globalCompositeOperation="destination-out",N.strokeStyle="rgba(0,0,0,1)",N.lineWidth=20):(N.globalCompositeOperation="source-over",N.strokeStyle=$.value,N.lineWidth=3),N.beginPath(),N.moveTo(K[K.length-2].x,K[K.length-2].y),N.lineTo(a,l),N.stroke()},se=()=>{X=!1},ie=()=>{if(!N||!J.value)return;N.clearRect(0,0,J.value.width,J.value.height);(A.value[_.value]||[]).forEach(e=>{"eraser"===e.tool?(N.globalCompositeOperation="destination-out",N.strokeStyle="rgba(0,0,0,1)",N.lineWidth=e.lineWidth||20):(N.globalCompositeOperation="source-over",N.strokeStyle=e.color,N.lineWidth=e.lineWidth||3),N.beginPath(),e.points.forEach((e,a)=>0===a?N.moveTo(e.x,e.y):N.lineTo(e.x,e.y)),N.stroke()}),N.globalCompositeOperation="source-over"},ve=()=>{var e;(null==(e=A.value[_.value])?void 0:e.length)&&(A.value[_.value].pop(),ie())},re=()=>{A.value[_.value]=[],ie()},ce=()=>{_.value>1&&_.value--},de=()=>{_.value<Q.value&&_.value++},pe=()=>{I.value<3&&(I.value=Math.min(3,I.value+.25),z.value="custom")},me=()=>{I.value>.5&&(I.value=Math.max(.5,I.value-.25),z.value="custom")},he=()=>{I.value=1,z.value="custom"},ge=async()=>{await u();const e=Y.value,a=Z.value;if(!e||!a)return;const l=e.clientWidth-40,t=a.scrollWidth/I.value;I.value=l/t,z.value="fitWidth"},be=async()=>{await u();const e=Y.value,a=Z.value;if(!e||!a)return;const l=e.clientHeight-40,t=a.scrollHeight/I.value;I.value=l/t,z.value="fitHeight"},fe=async()=>{const e=await a(Z.value,{scale:2,useCORS:!0}),l=document.createElement("a");l.download=`page-${_.value}.png`,l.href=e.toDataURL(),l.click()},ke=async()=>{const e=new l,t=_.value;for(let l=1;l<=Q.value;l++){_.value=l,await u(),await new Promise(e=>setTimeout(e,400));const t=(await a(Z.value,{scale:2,useCORS:!0,backgroundColor:"#ffffff",onclone:e=>{e.querySelectorAll("*").forEach(e=>{var a,l;const t=e.style;(null==(a=t.background)?void 0:a.includes("oklch"))&&(t.background="#ffffff"),(null==(l=t.color)?void 0:l.includes("oklch"))&&(t.color="#000000")})}})).toDataURL("image/jpeg",.95);l>1&&e.addPage(),e.addImage(t,"JPEG",0,0,210,297)}e.save("annotated-document.pdf"),_.value=t},ye=()=>{M.value&&URL.revokeObjectURL(M.value),M.value="",_.value=1,A.value={}};return n(_,async()=>{await u(),le()}),s(()=>{console.log("PDFAnnotator mounted")}),i(()=>{M.value&&URL.revokeObjectURL(M.value)}),(a,l)=>(r(),v("div",y,[M.value?(r(),v("div",P,[c("div",x,[c("div",L,[l[8]||(l[8]=c("span",{class:"tool-label"},"Tools:",-1)),c("button",{onClick:l[0]||(l[0]=e=>te("pen")),class:d({active:"pen"===T.value}),title:"Pen"},"âœï¸ Pen",2),c("button",{onClick:l[1]||(l[1]=e=>te("eraser")),class:d({active:"eraser"===T.value}),title:"Eraser"},"ðŸ§¹ Eraser",2),c("button",{onClick:ve,title:"Undo"},"â†¶ Undo"),c("button",{onClick:re,title:"Clear Page"},"ðŸ—‘ï¸ Clear")]),c("div",R,[l[9]||(l[9]=c("span",{class:"tool-label"},"Colors:",-1)),(r(!0),v(p,null,m(q.value,e=>(r(),v("button",{key:e.value,onClick:a=>$.value=e.value,class:d([{active:$.value===e.value&&"pen"===T.value},"color-btn"]),style:h({background:e.value,border:"2px solid "+($.value===e.value&&"pen"===T.value?"#fff":"#666")}),title:e.name},[$.value===e.value&&"pen"===T.value?(r(),v("span",W,"âœ“")):g("",!0)],14,O))),128))]),c("div",E,[c("button",{onClick:me,disabled:I.value<=.5,title:"Zoom Out"},"ðŸ”-",8,j),c("span",U,b(Math.round(100*I.value))+"%",1),c("button",{onClick:pe,disabled:I.value>=3,title:"Zoom In"},"ðŸ”+",8,F),c("button",{onClick:ge,title:"Fit Width"},"â†”ï¸ Width"),c("button",{onClick:be,title:"Fit Height"},"â†•ï¸ Height"),c("button",{onClick:he,title:"Reset Zoom"},"âŠ¡ 100%")]),c("div",S,[l[10]||(l[10]=c("span",{class:"quality-label"},"Quality:",-1)),c("button",{onClick:l[2]||(l[2]=e=>G.value=1),class:d({active:1===G.value}),title:"Low Quality"},"Low",2),c("button",{onClick:l[3]||(l[3]=e=>G.value=2),class:d({active:2===G.value}),title:"High Quality"},"High",2),c("button",{onClick:l[4]||(l[4]=e=>G.value=3),class:d({active:3===G.value}),title:"Ultra Quality"},"Ultra",2)]),c("div",{class:"toolbar-group"},[c("button",{onClick:fe},"Save Page"),c("button",{onClick:ke,class:"save-all"},"Save All Pages"),c("button",{onClick:ye,class:"reset"},"New PDF")])]),c("div",D,[c("button",{onClick:ce,disabled:_.value<=1},"Previous",8,H),c("span",null,"Page "+b(_.value)+" of "+b(Q.value),1),c("button",{onClick:de,disabled:_.value>=Q.value},"Next",8,B)]),c("div",{class:"page-wrapper",ref_key:"pageWrapper",ref:Y},[c("div",{class:"page-container",ref_key:"pageContainer",ref:Z,style:h({transform:`scale(${I.value})`,transformOrigin:"top center"})},[(r(),f(k(e),{key:`page-${_.value}`,source:M.value,page:_.value,width:1200,scale:G.value,onLoaded:ee,onRendered:ae,class:"pdf-embed"},null,8,["source","page","scale"])),(r(),v("canvas",{ref_key:"drawCanvas",ref:J,class:"draw-canvas",key:`canvas-${_.value}`}))],4)],512)])):(r(),v("div",C,[c("label",w,[c("input",{type:"file",accept:".pdf",onChange:V,hidden:""},null,32),l[5]||(l[5]=c("div",{class:"icon"},"ðŸ“„",-1)),l[6]||(l[6]=c("p",null,"Click or drop a PDF file here",-1)),l[7]||(l[7]=c("small",null,"Maximum 50 MB",-1))])]))]))}},[["__scopeId","data-v-bb184d2e"]]);export{M as default};
