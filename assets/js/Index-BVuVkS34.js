import{E as e,aV as a,S as l,D as o,o as t,u as s,d as n,Q as i,p as d,aF as r,c as u,m as c,f as m,A as v,e as p,l as g,aP as f,b as _}from"./app-BwCflFkV.js";import{Q as h}from"./QSelect-Cyosk05W.js";import{Q as y}from"./QTd-DftUN1Nv.js";import{Q as b}from"./QBadge-CShv2hr3.js";import{Q as w}from"./QTable-C_EQBQcS.js";import{a as x,Q as k}from"./QToolbar-DYAggbbc.js";import{q as V,a as C,p as $,h as S,f as N,o as q,L as A,I as P,M as j,b as U,H as I,O as Q,V as E,J as F,U as T,F as D,x as O,Z as R}from"./vendor-CUZ9QTQV.js";import{Q as G}from"./QFile--1kLQgDH.js";import{r as B,u as M}from"./xlsx-cMC2LkxH.js";import z from"./StudentPromotionDialog-BzMFRiHy.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";import"./rtl-Cr6c3OOr.js";import"./QMarkupTable-CFmFAA-C.js";import"./QLinearProgress-BKKQOFX1.js";import"./use-fullscreen-X4x-6n9-.js";import"./use-file-DlZDX63w.js";import"./QStepperNavigation-DfPDNpNq.js";import"./QStepper-lAHFGRsC.js";import"./use-panel-BLnXhVTM.js";import"./use-render-cache-CmTcazfP.js";const L=o({name:"QPageSticky",props:{position:{type:String,default:"bottom-right",validator:e=>["top-right","top-left","bottom-right","bottom-left","top","right","bottom","left"].includes(e)},offset:{type:Array,validator:e=>2===e.length},expand:Boolean},setup(o,{slots:t}){const{getStickyContent:s}=function(){const{props:o,proxy:{$q:t}}=$(),s=V(a,e);if(s===e)return console.error("QPageSticky needs to be child of QLayout"),e;const n=C(()=>{const e=o.position;return{top:-1!==e.indexOf("top"),right:-1!==e.indexOf("right"),bottom:-1!==e.indexOf("bottom"),left:-1!==e.indexOf("left"),vertical:"top"===e||"bottom"===e,horizontal:"left"===e||"right"===e}}),i=C(()=>s.header.offset),d=C(()=>s.right.offset),r=C(()=>s.footer.offset),u=C(()=>s.left.offset),c=C(()=>{let e=0,a=0;const l=n.value,s=!0===t.lang.rtl?-1:1;!0===l.top&&0!==i.value?a=`${i.value}px`:!0===l.bottom&&0!==r.value&&(a=-r.value+"px"),!0===l.left&&0!==u.value?e=s*u.value+"px":!0===l.right&&0!==d.value&&(e=-s*d.value+"px");const c={transform:`translate(${e}, ${a})`};return o.offset&&(c.margin=`${o.offset[1]}px ${o.offset[0]}px`),!0===l.vertical?(0!==u.value&&(c[!0===t.lang.rtl?"right":"left"]=`${u.value}px`),0!==d.value&&(c[!0===t.lang.rtl?"left":"right"]=`${d.value}px`)):!0===l.horizontal&&(0!==i.value&&(c.top=`${i.value}px`),0!==r.value&&(c.bottom=`${r.value}px`)),c}),m=C(()=>`q-page-sticky row flex-center fixed-${o.position} q-page-sticky--${!0===o.expand?"expand":"shrink"}`);return{$layout:s,getStickyContent:function(e){const a=l(e.default);return S("div",{class:m.value,style:c.value},!0===o.expand?a:[S("div",a)])}}}();return()=>s(t)}}),H={class:"q-pa-md"},W={class:"row items-center q-mb-md"},Y={class:"col"},J={class:"text-h4 text-weight-bold"},Z={class:"col-auto"},K={class:"row q-col-gutter-md q-mb-md"},X={class:"col-12 col-md-3"},ee={class:"text-h6"},ae={class:"col-12 col-md-3"},le={class:"text-h6"},oe={class:"col-12 col-md-3"},te={class:"text-h6"},se={class:"col-12 col-md-3"},ne={class:"text-h6"},ie={class:"row items-center q-mb-sm"},de={class:"col"},re={class:"text-h6"},ue={class:"col-auto"},ce={class:"row q-col-gutter-md"},me={class:"col-12 col-md-3"},ve={class:"col-12 col-md-3"},pe={class:"col-12 col-md-3"},ge={class:"col-12 col-md-3"},fe={class:"col-12 col-md-6"},_e={class:"col-12"},he={key:0,class:"text-caption text-grey-7"},ye={class:"text-weight-bold"},be={class:"text-caption text-grey-7"},we={class:"full-width row flex-center q-gutter-sm q-pa-lg"},xe={class:"text-h6"},ke={key:0,class:"text-caption"},Ve={class:"row q-col-gutter-md"},Ce={class:"col-12 col-md-6"},$e={class:"col-12 col-md-6"},Se={class:"col-12 col-md-6"},Ne={class:"col-12 col-md-6"},qe={class:"col-12 col-md-6"},Ae={class:"col-12 col-md-6"},Pe={class:"col-12"},je={class:"col-12"},Ue={class:"text-caption"},Ie={class:"text-subtitle2 q-mb-sm"},Qe={class:"text-caption"},Ee={class:"text-subtitle2 q-mb-sm"},Fe=t({__name:"Index",props:{records:Object,schools:Array,grades:Array,academicYears:Array,userRoles:Array,permissions:Object},setup(e){const a=e,l=s(),o=N(!1),t=N([]),V=N([]),$=N(!1),S=N(!1),Fe=N(!1),Te=N(null),De=N(!1),Oe=N(null),Re=N([]),Ge=N(!1),Be=N(!1),Me=N(null),ze=N([]),Le=[{name:"name",label:"Name",field:"name",align:"left"},{name:"name_ar",label:"Arabic Name",field:"name_ar",align:"left"},{name:"name_cute",label:"Nickname",field:"name_cute",align:"left"},{name:"notes",label:"Notes",field:"notes",align:"left"}],He=[{name:"name",label:"Name",field:"name",align:"left"},{name:"name_ar",label:"Arabic Name",field:"name_ar",align:"left"},{name:"name_cute",label:"Nickname",field:"name_cute",align:"left"},{name:"classroom",label:"Classroom",field:"classroom",align:"left"},{name:"notes",label:"Notes",field:"notes",align:"left"}],We=N({school_id:null,stage_id:null,grade_id:null,classroom_id:null,search:""}),Ye=N([]),Je=N([]),Ze=N([]),Ke=N(a.grades||[]),Xe=N(a.academicYears||[]),ea=N([]),aa=N([]),la=N([]),oa=N({name:"",name_ar:"",name_cute:"",school_id:null,stage_id:null,grade_id:null,classroom_id:null,notes:""}),ta=N({sortBy:"name",descending:!1,page:1,rowsPerPage:25,rowsNumber:0}),sa=[{name:"avatar",label:"",field:"avatar",align:"center",style:"width: 60px"},{name:"s_id",label:"ID",field:"s_id",align:"left",sortable:!0},{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"school",label:"School",field:e=>{var a;return null==(a=e.school)?void 0:a.name},align:"left",sortable:!0},{name:"grade",label:"Grade",field:e=>{var a;return null==(a=e.grade)?void 0:a.name},align:"left",sortable:!0},{name:"classroom",label:"Classroom",field:e=>{var a;return null==(a=e.classroom)?void 0:a.name},align:"left",sortable:!0},{name:"actions",label:"Actions",field:"actions",align:"center"}],na=C(()=>ta.value.rowsNumber||0),ia=C(()=>We.value.school_id?t.value.filter(e=>e.school_id===We.value.school_id).length:0),da=C(()=>t.value.length),ra=C(()=>V.value.length),ua=C(()=>We.value.school_id&&We.value.grade_id&&We.value.classroom_id),ca=()=>{const e=a.schools.find(e=>e.id===We.value.school_id);return(null==e?void 0:e.name)||"N/A"},ma=()=>{const e=Je.value.find(e=>e.id===We.value.grade_id);return(null==e?void 0:e.name)||"N/A"},va=()=>{const e=Ze.value.find(e=>e.id===We.value.classroom_id);return(null==e?void 0:e.name)||"N/A"},pa=()=>`${ca()} → ${ma()} → ${va()}`,ga=e=>{if(!e)return"?";const a=e.split(" ");return a.length>=2?(a[0][0]+a[1][0]).toUpperCase():e.substring(0,2).toUpperCase()},fa=async()=>{We.value.stage_id=null,We.value.grade_id=null,We.value.classroom_id=null,Ye.value=[],Je.value=[],Ze.value=[],We.value.school_id&&await ya(We.value.school_id),xa()},_a=async()=>{We.value.grade_id=null,We.value.classroom_id=null,Je.value=[],Ze.value=[],We.value.stage_id&&await ba(We.value.stage_id),xa()},ha=async()=>{We.value.classroom_id=null,Ze.value=[],We.value.grade_id&&await wa(We.value.grade_id),xa()},ya=async e=>{try{const a=await R.get(`/admin/stages/by-school/${e}`);Ye.value=a.data}catch(a){console.error("Error loading stages:",a)}},ba=async e=>{try{const a=await R.get(`/admin/grades/by-stage/${e}`);Je.value=a.data}catch(a){console.error("Error loading grades:",a)}},wa=async e=>{try{const a=await R.get(`/admin/classrooms/by-grade/${e}`);Ze.value=a.data}catch(a){console.error("Error loading classrooms:",a)}},xa=async()=>{o.value=!0;try{const e={school_id:We.value.school_id,stage_id:We.value.stage_id,grade_id:We.value.grade_id,classroom_id:We.value.classroom_id,search:We.value.search},a=await R.get("/admin/students/filtered",{params:e});t.value=a.data.records.data||[],ta.value.rowsNumber=a.data.records.total||0}catch(e){l.notify({type:"negative",message:"Failed to load students"})}finally{o.value=!1}},ka=()=>{We.value={school_id:null,stage_id:null,grade_id:null,classroom_id:null,search:""},Ye.value=[],Je.value=[],Ze.value=[],xa()};let Va;const Ca=()=>{clearTimeout(Va),Va=setTimeout(()=>{xa()},500)},$a=e=>{xa()},Sa=(e=null)=>{e?(Te.value=e,oa.value={name:e.name,name_ar:e.name_ar,name_cute:e.name_cute,school_id:e.school_id,stage_id:e.stage_id,grade_id:e.grade_id,classroom_id:e.classroom_id,notes:e.notes},e.school_id&&Na(),e.stage_id&&qa(),e.grade_id&&Aa()):(Te.value=null,oa.value={name:"",name_ar:"",name_cute:"",school_id:We.value.school_id,stage_id:We.value.stage_id,grade_id:We.value.grade_id,classroom_id:We.value.classroom_id,notes:""}),$.value=!0},Na=async()=>{if(oa.value.stage_id=null,oa.value.grade_id=null,oa.value.classroom_id=null,oa.value.school_id){const e=await R.get(`/admin/stages/by-school/${oa.value.school_id}`);ea.value=e.data}},qa=async()=>{if(oa.value.grade_id=null,oa.value.classroom_id=null,oa.value.stage_id){const e=await R.get(`/admin/grades/by-stage/${oa.value.stage_id}`);aa.value=e.data}},Aa=async()=>{if(oa.value.classroom_id=null,oa.value.grade_id){const e=await R.get(`/admin/classrooms/by-grade/${oa.value.grade_id}`);la.value=e.data}},Pa=async()=>{var e,a;De.value=!0;try{const e=Te.value?`/admin/students/${Te.value.id}`:"/admin/students",a={...oa.value,...Te.value&&{_method:"PUT"}};await R.post(e,a),l.notify({type:"positive",message:Te.value?"Student updated successfully":"Student created successfully"}),$.value=!1,xa()}catch(o){l.notify({type:"negative",message:(null==(a=null==(e=o.response)?void 0:e.data)?void 0:a.message)||"Failed to save student"})}finally{De.value=!1}},ja=()=>{l.notify({type:"info",message:"Export functionality coming soon!"})},Ua=()=>{l.notify({type:"info",message:"Bulk classroom change coming in Phase 4!"})},Ia=()=>{l.notify({type:"info",message:`Exporting ${V.value.length} students...`})},Qa=()=>{l.dialog({title:"Confirm Bulk Delete",message:`Are you sure you want to delete ${V.value.length} students?`,cancel:!0,persistent:!0}).onOk(()=>{l.notify({type:"info",message:"Bulk delete coming soon!"})})},Ea=e=>{l.notify({type:"positive",message:`Successfully promoted ${e.promoted_count} students!`}),xa()},Fa=()=>{ua.value?Fe.value=!0:l.notify({type:"negative",message:"Please select School, Grade, and Classroom before importing"})},Ta=async e=>{if(e)try{const a=await Da(e);Re.value=a.map((e,a)=>({index:a,name:e.name||e.Name||"",name_ar:e.name_ar||e["Arabic Name"]||"",name_cute:e.name_cute||e.Nickname||"",notes:e.notes||e.Notes||""}))}catch(a){l.notify({type:"negative",message:"Error reading Excel file: "+a.message})}},Da=e=>new Promise((a,l)=>{const o=new FileReader;o.onload=e=>{try{const l=new Uint8Array(e.target.result),o=B(l,{type:"array"}),t=o.Sheets[o.SheetNames[0]],s=M.sheet_to_json(t);a(s)}catch(o){l(o)}},o.onerror=l,o.readAsArrayBuffer(e)}),Oa=async()=>{Ge.value=!0;let e=0,a=0;try{for(const l of Re.value)try{const a={name:l.name,name_ar:l.name_ar||"",name_cute:l.name_cute||"",school_id:We.value.school_id,stage_id:We.value.stage_id,grade_id:We.value.grade_id,classroom_id:We.value.classroom_id,notes:l.notes||""};await R.post("/admin/students",a),e++}catch(o){a++,console.error("Import error:",o)}l.notify({type:e>0?"positive":"negative",message:`Import complete: ${e} students added${a>0?`, ${a} errors`:""}`,timeout:3e3}),La(),await xa()}catch(o){l.notify({type:"negative",message:"Import failed: "+(o.message||"Unknown error")})}finally{Ge.value=!1}},Ra=()=>{window.location.href="/admin/students/download-template"},Ga=()=>{window.location.href="/admin/students/download-template-with-classroom"},Ba=async e=>{if(e)try{const a=await Da(e);if(a.length>0&&!("classroom"in a[0])&&!("Classroom"in a[0]))return l.notify({type:"negative",message:'Invalid file: Missing "classroom" column. Please download the correct template.'}),void(Me.value=null);const o=[],t=[];if(a.forEach((e,a)=>{const l=e.name||e.Name||"",s=e.classroom||e.Classroom||"";l.trim()&&s.trim()?o.push({index:a,name:l.trim(),name_ar:(e.name_ar||e["Arabic Name"]||"").trim(),name_cute:(e.name_cute||e.Nickname||"").trim(),classroom:s.trim(),notes:(e.notes||e.Notes||"").trim()}):t.push({row:a+2,reason:l.trim()?"Missing classroom":"Missing name"})}),t.length>0){const e=t.map(e=>`Row ${e.row}: ${e.reason}`).join("\n");l.dialog({title:"Invalid Records Found",message:`Found ${t.length} invalid record(s):\n\n${e}\n\nThese rows will be skipped.`,html:!0})}ze.value=o}catch(a){l.notify({type:"negative",message:"Error reading Excel file: "+a.message})}},Ma=async()=>{var e,a;if(!We.value.school_id)return void l.notify({type:"negative",message:"Please select a school"});const o=ze.value.length;let t=0,s=0,n=0,i=0;const d=[],r=l.dialog({title:"Importing Students",message:`Processing 0 of ${o} students...`,progress:{spinner:!1,value:0,color:"primary"},persistent:!0,ok:!1});Ge.value=!0;try{for(const[l,m]of ze.value.entries())try{const e=await R.post("/admin/students/import-with-classroom",{school_id:We.value.school_id,name:m.name,name_ar:m.name_ar,name_cute:m.name_cute,classroom:m.classroom,notes:m.notes});t++,"created"===e.data.status?s++:"duplicate"===e.data.status&&n++,r.update({message:`Processing ${t} of ${o} students...\nCreated: ${s} | Duplicates: ${n} | Failed: ${i}`,progress:{value:t/o}})}catch(u){t++,i++,d.push({row:l+2,name:m.name,error:(null==(a=null==(e=u.response)?void 0:e.data)?void 0:a.message)||u.message}),r.update({message:`Processing ${t} of ${o} students...\nCreated: ${s} | Duplicates: ${n} | Failed: ${i}`,progress:{value:t/o}})}r.hide();const c=`Import Complete!\n\n✅ Created: ${s}\n⏭️ Duplicates: ${n}\n❌ Failed: ${i}`;i>0?(l.dialog({title:"Import Completed with Errors",message:c+"\n\nCheck console for error details.",html:!0}),console.log("Import Errors:",d)):l.notify({type:"positive",message:c,html:!0,timeout:5e3}),Ha(),await xa()}catch(u){r.hide(),l.notify({type:"negative",message:"Import failed: "+(u.message||"Unknown error")})}finally{Ge.value=!1}},za=()=>{We.value.school_id?Be.value=!0:l.notify({type:"negative",message:"Please select a School first"})},La=()=>{Fe.value=!1,Oe.value=null,Re.value=[]},Ha=()=>{Be.value=!1,Me.value=null,ze.value=[]};return q(async()=>{var e;(null==(e=a.records)?void 0:e.data)&&(t.value=a.records.data,ta.value.rowsNumber=a.records.total||0),a.schools&&a.schools.length>0&&(We.value.school_id=a.schools[0].id,await fa())}),(a,s)=>(P(),A("div",H,[j("div",W,[j("div",Y,[j("div",J,[U(n,{name:"school",class:"q-mr-sm"}),s[23]||(s[23]=E(" Student Management "))]),s[24]||(s[24]=j("div",{class:"text-subtitle2 text-grey-7"}," Manage students, classrooms, and promotions ",-1))]),j("div",Z,[U(r,{push:""},{default:F(()=>[U(i,{color:"primary",icon:"add",label:"Add Student",onClick:s[0]||(s[0]=e=>Sa()),disable:!ua.value,unelevated:""},{default:F(()=>[ua.value?Q("",!0):(P(),I(d,{key:0},{default:F(()=>s[25]||(s[25]=[E(" Please select School, Grade, and Classroom first ")])),_:1}))]),_:1},8,["disable"]),U(i,{color:"secondary",icon:"upgrade",label:"Promote Students",onClick:s[1]||(s[1]=e=>S.value=!0),unelevated:""}),U(i,{color:"info",icon:"upload_file",label:"Import",onClick:Fa,disable:!ua.value,unelevated:""},{default:F(()=>[ua.value?Q("",!0):(P(),I(d,{key:0},{default:F(()=>s[26]||(s[26]=[E(" Please select School, Grade, and Classroom first ")])),_:1}))]),_:1},8,["disable"]),U(i,{color:"purple",icon:"cloud_upload",label:"School-Wide Import",onClick:za,disable:!We.value.school_id,unelevated:""},{default:F(()=>[We.value.school_id?Q("",!0):(P(),I(d,{key:0},{default:F(()=>s[27]||(s[27]=[E(" Please select a School first ")])),_:1}))]),_:1},8,["disable"]),U(i,{color:"positive",icon:"download",label:"Export",onClick:ja,unelevated:""})]),_:1})])]),j("div",K,[j("div",X,[U(c,{flat:"",bordered:""},{default:F(()=>[U(u,{class:"bg-primary text-white"},{default:F(()=>[j("div",ee,T(na.value),1),s[28]||(s[28]=j("div",{class:"text-caption"},"Total Students",-1))]),_:1})]),_:1})]),j("div",ae,[U(c,{flat:"",bordered:""},{default:F(()=>[U(u,{class:"bg-secondary text-white"},{default:F(()=>[j("div",le,T(ia.value),1),s[29]||(s[29]=j("div",{class:"text-caption"},"In Selected School",-1))]),_:1})]),_:1})]),j("div",oe,[U(c,{flat:"",bordered:""},{default:F(()=>[U(u,{class:"bg-positive text-white"},{default:F(()=>[j("div",te,T(da.value),1),s[30]||(s[30]=j("div",{class:"text-caption"},"Filtered Results",-1))]),_:1})]),_:1})]),j("div",se,[U(c,{flat:"",bordered:""},{default:F(()=>[U(u,{class:"bg-info text-white"},{default:F(()=>[j("div",ne,T(ra.value),1),s[31]||(s[31]=j("div",{class:"text-caption"},"Selected",-1))]),_:1})]),_:1})])]),U(c,{flat:"",bordered:"",class:"q-mb-md"},{default:F(()=>[U(u,null,{default:F(()=>[j("div",ie,[j("div",de,[j("div",re,[U(n,{name:"filter_list",class:"q-mr-sm"}),s[32]||(s[32]=E(" Filters "))])]),j("div",ue,[U(i,{flat:"",dense:"",icon:"clear",label:"Clear All",onClick:ka,color:"negative"})])]),j("div",ce,[j("div",me,[U(h,{modelValue:We.value.school_id,"onUpdate:modelValue":[s[2]||(s[2]=e=>We.value.school_id=e),fa],options:e.schools,"option-value":"id","option-label":"name",label:"School",outlined:"",dense:"",clearable:"","emit-value":"","map-options":""},{prepend:F(()=>[U(n,{name:"business"})]),_:1},8,["modelValue","options"])]),j("div",ve,[U(h,{modelValue:We.value.stage_id,"onUpdate:modelValue":[s[3]||(s[3]=e=>We.value.stage_id=e),_a],options:Ye.value,"option-value":"id","option-label":"name",label:"Stage",outlined:"",dense:"",clearable:"","emit-value":"","map-options":"",disable:!We.value.school_id},{prepend:F(()=>[U(n,{name:"layers"})]),_:1},8,["modelValue","options","disable"])]),j("div",pe,[U(h,{modelValue:We.value.grade_id,"onUpdate:modelValue":[s[4]||(s[4]=e=>We.value.grade_id=e),ha],options:Je.value,"option-value":"id","option-label":"name",label:"Grade",outlined:"",dense:"",clearable:"","emit-value":"","map-options":"",disable:!We.value.stage_id},{prepend:F(()=>[U(n,{name:"school"})]),_:1},8,["modelValue","options","disable"])]),j("div",ge,[U(h,{modelValue:We.value.classroom_id,"onUpdate:modelValue":[s[5]||(s[5]=e=>We.value.classroom_id=e),xa],options:Ze.value,"option-value":"id","option-label":"name",label:"Classroom",outlined:"",dense:"",clearable:"","emit-value":"","map-options":"",disable:!We.value.grade_id},{prepend:F(()=>[U(n,{name:"meeting_room"})]),_:1},8,["modelValue","options","disable"])]),j("div",fe,[U(m,{modelValue:We.value.search,"onUpdate:modelValue":[s[6]||(s[6]=e=>We.value.search=e),Ca],label:"Search by name or ID",outlined:"",dense:"",clearable:""},{prepend:F(()=>[U(n,{name:"search"})]),_:1},8,["modelValue"])])])]),_:1})]),_:1}),U(c,{flat:"",bordered:""},{default:F(()=>[U(w,{rows:t.value,columns:sa,"row-key":"id",loading:o.value,pagination:ta.value,onRequest:$a,selection:"multiple",selected:V.value,"onUpdate:selected":s[7]||(s[7]=e=>V.value=e),flat:"","rows-per-page-options":[10,25,50,100]},{top:F(()=>[j("div",_e,[s[33]||(s[33]=j("div",{class:"text-h6"},"Students List",-1)),V.value.length>0?(P(),A("div",he,T(V.value.length)+" student(s) selected ",1)):Q("",!0)])]),"body-cell-avatar":F(e=>[U(y,{props:e},{default:F(()=>[U(v,{color:"primary","text-color":"white",size:"md"},{default:F(()=>[E(T(ga(e.row.name)),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-name":F(e=>[U(y,{props:e},{default:F(()=>[j("div",ye,T(e.row.name),1),j("div",be,T(e.row.name_ar),1)]),_:2},1032,["props"])]),"body-cell-s_id":F(e=>[U(y,{props:e},{default:F(()=>[U(b,{color:"grey-7",outline:""},{default:F(()=>[E(T(e.row.s_id),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-school":F(e=>[U(y,{props:e},{default:F(()=>{var a;return[j("div",null,T(null==(a=e.row.school)?void 0:a.name),1)]}),_:2},1032,["props"])]),"body-cell-classroom":F(e=>[U(y,{props:e},{default:F(()=>[U(b,{color:"secondary"},{default:F(()=>{var a;return[E(T(null==(a=e.row.classroom)?void 0:a.name),1)]}),_:2},1024)]),_:2},1032,["props"])]),"body-cell-grade":F(e=>[U(y,{props:e},{default:F(()=>{var a;return[j("div",null,T(null==(a=e.row.grade)?void 0:a.name),1)]}),_:2},1032,["props"])]),"body-cell-actions":F(e=>[U(y,{props:e},{default:F(()=>[U(r,{flat:""},{default:F(()=>[U(i,{flat:"",dense:"",round:"",icon:"edit",color:"primary",onClick:a=>Sa(e.row)},{default:F(()=>[U(d,null,{default:F(()=>s[34]||(s[34]=[E("Edit")])),_:1})]),_:2},1032,["onClick"]),U(i,{flat:"",dense:"",round:"",icon:"history",color:"info",onClick:a=>(async e=>{try{const a=await R.get(`/admin/students/${e.id}/classroom-history`);l.dialog({title:`Classroom History - ${e.name}`,message:JSON.stringify(a.data.history,null,2)})}catch(a){l.notify({type:"negative",message:"Failed to load history"})}})(e.row)},{default:F(()=>[U(d,null,{default:F(()=>s[35]||(s[35]=[E("View History")])),_:1})]),_:2},1032,["onClick"]),U(i,{flat:"",dense:"",round:"",icon:"delete",color:"negative",onClick:a=>(async e=>{l.dialog({title:"Confirm Delete",message:`Are you sure you want to delete ${e.name}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{await R.delete(`/admin/students/${e.id}`),l.notify({type:"positive",message:"Student deleted successfully"}),xa()}catch(a){l.notify({type:"negative",message:"Failed to delete student"})}})})(e.row)},{default:F(()=>[U(d,null,{default:F(()=>s[36]||(s[36]=[E("Delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),"no-data":F(()=>[j("div",we,[U(n,{size:"2em",name:"sentiment_dissatisfied"}),s[37]||(s[37]=j("span",null,"No students found. Try adjusting your filters.",-1))])]),_:1},8,["rows","loading","pagination","selected"])]),_:1}),V.value.length>0?(P(),I(L,{key:0,position:"bottom",offset:[0,18]},{default:F(()=>[U(k,{class:"bg-primary text-white shadow-up-2"},{default:F(()=>[U(x,null,{default:F(()=>[E(T(V.value.length)+" student(s) selected ",1)]),_:1}),U(i,{flat:"",label:"Change Classroom",icon:"meeting_room",onClick:Ua}),U(i,{flat:"",label:"Export Selected",icon:"download",onClick:Ia}),U(i,{flat:"",label:"Delete Selected",icon:"delete",onClick:Qa}),U(i,{flat:"",round:"",dense:"",icon:"close",onClick:s[8]||(s[8]=e=>V.value=[])})]),_:1})]),_:1})):Q("",!0),U(_,{modelValue:$.value,"onUpdate:modelValue":s[17]||(s[17]=e=>$.value=e),persistent:""},{default:F(()=>[U(c,{style:{"min-width":"600px"}},{default:F(()=>[U(u,{class:"bg-primary text-white"},{default:F(()=>[j("div",xe,T(Te.value?"Edit Student":"Add New Student"),1),Te.value?Q("",!0):(P(),A("div",ke," Adding to: "+T(pa()),1))]),_:1}),U(u,null,{default:F(()=>[Te.value?Q("",!0):(P(),I(p,{key:0,class:"bg-info text-white q-mb-md",rounded:""},{avatar:F(()=>[U(n,{name:"info"})]),default:F(()=>[s[38]||(s[38]=j("div",{class:"text-weight-bold"},"Selected Context:",-1)),j("div",null,T(ca())+" → "+T(ma())+" → "+T(va()),1)]),_:1})),j("div",Ve,[j("div",Ce,[U(m,{modelValue:oa.value.name,"onUpdate:modelValue":s[9]||(s[9]=e=>oa.value.name=e),label:"Name *",outlined:"",rules:[e=>!!e||"Name is required"]},null,8,["modelValue","rules"])]),j("div",$e,[U(m,{modelValue:oa.value.name_ar,"onUpdate:modelValue":s[10]||(s[10]=e=>oa.value.name_ar=e),label:"Arabic Name",outlined:""},null,8,["modelValue"])]),j("div",Se,[U(m,{modelValue:oa.value.name_cute,"onUpdate:modelValue":s[11]||(s[11]=e=>oa.value.name_cute=e),label:"Nickname",outlined:""},null,8,["modelValue"])]),Te.value?(P(),A(D,{key:0},[j("div",Ne,[U(h,{modelValue:oa.value.school_id,"onUpdate:modelValue":[s[12]||(s[12]=e=>oa.value.school_id=e),Na],options:e.schools,"option-value":"id","option-label":"name",label:"School *",outlined:"","emit-value":"","map-options":"",rules:[e=>!!e||"School is required"]},null,8,["modelValue","options","rules"])]),j("div",qe,[U(h,{modelValue:oa.value.stage_id,"onUpdate:modelValue":[s[13]||(s[13]=e=>oa.value.stage_id=e),qa],options:ea.value,"option-value":"id","option-label":"name",label:"Stage *",outlined:"","emit-value":"","map-options":"",disable:!oa.value.school_id,rules:[e=>!!e||"Stage is required"]},null,8,["modelValue","options","disable","rules"])]),j("div",Ae,[U(h,{modelValue:oa.value.grade_id,"onUpdate:modelValue":[s[14]||(s[14]=e=>oa.value.grade_id=e),Aa],options:aa.value,"option-value":"id","option-label":"name",label:"Grade *",outlined:"","emit-value":"","map-options":"",disable:!oa.value.stage_id,rules:[e=>!!e||"Grade is required"]},null,8,["modelValue","options","disable","rules"])]),j("div",Pe,[U(h,{modelValue:oa.value.classroom_id,"onUpdate:modelValue":s[15]||(s[15]=e=>oa.value.classroom_id=e),options:la.value,"option-value":"id","option-label":"name",label:"Classroom *",outlined:"","emit-value":"","map-options":"",disable:!oa.value.grade_id,rules:[e=>!!e||"Classroom is required"]},null,8,["modelValue","options","disable","rules"])])],64)):Q("",!0),j("div",je,[U(m,{modelValue:oa.value.notes,"onUpdate:modelValue":s[16]||(s[16]=e=>oa.value.notes=e),label:"Notes",outlined:"",type:"textarea",rows:"3"},null,8,["modelValue"])])])]),_:1}),U(g,{align:"right"},{default:F(()=>[O(U(i,{flat:"",label:"Cancel",color:"negative"},null,512),[[f]]),U(i,{unelevated:"",label:"Save",color:"primary",onClick:Pa,loading:De.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),U(z,{modelValue:S.value,"onUpdate:modelValue":s[18]||(s[18]=e=>S.value=e),grades:Ke.value,"academic-years":Xe.value,onPromoted:Ea},null,8,["modelValue","grades","academic-years"]),U(_,{modelValue:Fe.value,"onUpdate:modelValue":s[20]||(s[20]=e=>Fe.value=e),persistent:""},{default:F(()=>[U(c,{style:{"min-width":"700px","max-width":"90vw"}},{default:F(()=>[U(u,{class:"bg-info text-white"},{default:F(()=>[s[39]||(s[39]=j("div",{class:"text-h6"},"Import Students",-1)),j("div",Ue," Importing to: "+T(pa()),1)]),_:1}),Re.value.length?(P(),I(u,{key:1,class:"q-pt-none",style:{"max-height":"400px","overflow-y":"auto"}},{default:F(()=>[j("div",Ie,"Preview ("+T(Re.value.length)+" students)",1),U(w,{rows:Re.value,columns:Le,"row-key":"index",flat:"",dense:"",pagination:{rowsPerPage:10}},null,8,["rows"])]),_:1})):(P(),I(u,{key:0},{default:F(()=>[U(G,{modelValue:Oe.value,"onUpdate:modelValue":[s[19]||(s[19]=e=>Oe.value=e),Ta],label:"Select Excel file",accept:".xlsx,.xls",outlined:""},{prepend:F(()=>[U(n,{name:"attach_file"})]),_:1},8,["modelValue"]),U(p,{class:"bg-grey-2 q-mt-md",rounded:""},{avatar:F(()=>[U(n,{name:"info",color:"info"})]),action:F(()=>[U(i,{flat:"",dense:"",label:"Download Template",icon:"download",color:"primary",onClick:Ra})]),default:F(()=>[s[40]||(s[40]=j("div",{class:"text-caption"},[j("strong",null,"Required columns:"),E(" name"),j("br"),j("strong",null,"Optional columns:"),E(" name_ar, name_cute, notes ")],-1))]),_:1})]),_:1})),U(g,{align:"right"},{default:F(()=>[U(i,{flat:"",label:"Cancel",color:"negative",onClick:La}),Re.value.length?(P(),I(i,{key:0,unelevated:"",label:"Import All",color:"primary",onClick:Oa,loading:Ge.value},null,8,["loading"])):Q("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),U(_,{modelValue:Be.value,"onUpdate:modelValue":s[22]||(s[22]=e=>Be.value=e),persistent:""},{default:F(()=>[U(c,{style:{"min-width":"700px","max-width":"90vw"}},{default:F(()=>[U(u,{class:"bg-purple text-white"},{default:F(()=>[s[41]||(s[41]=j("div",{class:"text-h6"},"School-Wide Import",-1)),j("div",Qe," Importing to: "+T(ca()),1)]),_:1}),ze.value.length?(P(),I(u,{key:1,class:"q-pt-none",style:{"max-height":"400px","overflow-y":"auto"}},{default:F(()=>[j("div",Ee,"Preview ("+T(ze.value.length)+" students)",1),U(w,{rows:ze.value,columns:He,"row-key":"index",flat:"",dense:"",pagination:{rowsPerPage:10}},null,8,["rows"])]),_:1})):(P(),I(u,{key:0},{default:F(()=>[U(G,{modelValue:Me.value,"onUpdate:modelValue":[s[21]||(s[21]=e=>Me.value=e),Ba],label:"Select Excel file with classroom column",accept:".xlsx,.xls",outlined:""},{prepend:F(()=>[U(n,{name:"attach_file"})]),_:1},8,["modelValue"]),U(p,{class:"bg-grey-2 q-mt-md",rounded:""},{avatar:F(()=>[U(n,{name:"info",color:"info"})]),action:F(()=>[U(i,{flat:"",dense:"",label:"Download Template",icon:"download",color:"primary",onClick:Ga})]),default:F(()=>[s[42]||(s[42]=j("div",{class:"text-caption"},[j("strong",null,"Required columns:"),E(" name, classroom"),j("br"),j("strong",null,"Optional columns:"),E(" name_ar, name_cute, notes"),j("br"),j("strong",null,"Classroom formats:"),E(' "4A", "Grade 4 - A", "4-A" ')],-1))]),_:1})]),_:1})),U(g,{align:"right"},{default:F(()=>[U(i,{flat:"",label:"Cancel",color:"negative",onClick:Ha}),ze.value.length?(P(),I(i,{key:0,unelevated:"",label:"Import All",color:"purple",onClick:Ma,loading:Ge.value},null,8,["loading"])):Q("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-8d7c3f3d"]]);export{Fe as default};
