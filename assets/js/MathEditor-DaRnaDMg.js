import{Q as e}from"./QTab-BTRoGWkY.js";import{Q as a}from"./QTabs-BgqCfsdX.js";import{r as l,c as t,b as r,t as n,h as s,aS as o,d as i,f as c,o as u,e as d}from"./app-DraepSDZ.js";import{Q as m}from"./QTabPanel-BcQ_0NuW.js";import{Q as p}from"./QTabPanels-Dk5dhPlu.js";import{k as v}from"./katex-BXKQVcz-.js";import{f,a as b,N as g,J as x,R as y,b as h,K as $,F as w,Q as _,W as q,V as k,y as V,a2 as S,n as C}from"./vendor-BWKGNkNB.js";import"./rtl-Cr6c3OOr.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./use-panel-BIFIFpms.js";import"./use-render-cache-CmTcazfP.js";const T={class:"math-editor q-pa-md",style:{"min-width":"700px","max-width":"95vw"}},E={class:"row q-col-gutter-md"},j={class:"col-12 col-md-7"},M={class:"flex gap-2 flex-wrap justify-center"},P=["innerHTML"],U={class:"flex gap-2 flex-wrap justify-center"},L=["innerHTML"],z={class:"column q-gutter-sm"},Q={class:"row justify-between items-center"},A={class:"row q-gutter-sm"},F={class:"row q-gutter-sm justify-center q-mt-md"},I={class:"col-12 col-md-5 column"},D={class:"preview-box border rounded p-4 bg-grey-1 flex items-center justify-center col-grow relative-position",style:{"min-height":"150px"}},H=["innerHTML"],N={key:1,class:"text-grey-5"},R={class:"row justify-end q-mt-md gap-2"},B={class:"text-h6"},O=l({__name:"MathEditor",emits:["insert"],setup(l,{emit:O}){const K=O,W=f(""),X=f(null),Z=f("basic"),G=f(!1),J=f(null),Y=f([]),ee=f(""),ae=f(""),le=f(""),te=[{name:"Fraction",template:"\\frac{{0}}{{1}}",vars:["Numerator","Denominator"],label:"\\frac{a}{b}"},{name:"Square Root",template:"\\sqrt{{0}}",vars:["Value"],label:"\\sqrt{x}"},{name:"Power",template:"{{0}}^{{1}}",vars:["Base","Exponent"],label:"x^2"},{name:"Subscript",template:"{{0}}_{{1}}",vars:["Base","Subscript"],label:"x_1"},{name:"Mixed Number",template:"{{0}}\\:\\frac{{1}}{{2}}",vars:["Whole","Numerator","Denominator"],label:"1\\:\\frac{1}{2}"},{name:"Multiplication",latex:"\\times"},{name:"Division",latex:"\\div"},{name:"Plus/Minus",latex:"\\pm"},{name:"Parentheses",template:"({{0}})",vars:["Content"],label:"(x)"}],re=[{name:"Infinity",latex:"\\infty"},{name:"Pi",latex:"\\pi"},{name:"Alpha",latex:"\\alpha"},{name:"Beta",latex:"\\beta"},{name:"Theta",latex:"\\theta"},{name:"Delta",latex:"\\Delta"},{name:"Less/Equal",latex:"\\leq"},{name:"Greater/Equal",latex:"\\geq"},{name:"Not Equal",latex:"\\neq"},{name:"Approx",latex:"\\approx"},{name:"Sum",template:"\\sum_{{0}}^{{1}}",vars:["From","To"],label:"\\sum"},{name:"Integral",template:"\\int_{{0}}^{{1}}",vars:["Lower","Upper"],label:"\\int"},{name:"Square Root N",template:"\\sqrt[{0}]{{1}}",vars:["Degree","Value"],label:"\\sqrt[n]{x}"}],ne=e=>{if(!e)return"";const a=/\$\$([\s\S]*?)\$\$|\$([\s\S]*?)\$/g;let l,t=0,r="",n=!1;for(;null!==(l=a.exec(e));){n=!0;const o=e.slice(t,l.index);r+=se(o).replace(/\n/g,"<br>").replace(/&lt;(\/?(strong|em|b|i|u|code))&gt;/g,"<$1>");const i=l[1],c=l[2];try{i?r+=v.renderToString(i,{throwOnError:!1,displayMode:!0}):c&&(r+=v.renderToString(c,{throwOnError:!1,displayMode:!1}))}catch(s){r+=`<span class="text-red-500">Error: ${s.message}</span>`}t=a.lastIndex}if(r+=se(e.slice(t)).replace(/\n/g,"<br>").replace(/&lt;(\/?(strong|em|b|i|u|code))&gt;/g,"<$1>"),!n&&e.trim().length>0)try{return v.renderToString(e,{throwOnError:!1,displayMode:!0})}catch(s){return se(e).replace(/\n/g,"<br>").replace(/&lt;(\/?(strong|em|b|i|u|code))&gt;/g,"<$1>")}return r},se=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),oe=b(()=>ne(W.value)),ie=e=>{try{return v.renderToString(e,{throwOnError:!1,displayMode:!1})}catch(a){return console.error("Error rendering math:",a),se(e)}},ce=()=>{const e=ne(W.value);K("insert",e+"&nbsp;"),W.value=""},ue=()=>{W.value=ee.value,Z.value="basic",ee.value=""},de=async()=>{try{const e=await navigator.clipboard.readText();ee.value=e}catch(e){console.error("Failed to read clipboard contents: ",e)}},me=()=>{if(!ee.value)return;const e=/\$\$([\s\S]*?)\$\$|\$([\s\S]*?)\$/g;let a,l=0,t="";const r=ee.value;for(;null!==(a=e.exec(r));){const n=r.slice(l,a.index);t+=ve(n),t+=a[0],l=e.lastIndex}t+=ve(r.slice(l)),ee.value=t},pe=async()=>{try{let e=await navigator.clipboard.readText();e=ve(e),e=e.replace(/(\((?:[^)(]+|\((?:[^)(]+|\([^)(]*\))*\))*\))/g,e=>/[\^_{}\\]/.test(e)||/[+\-*/=].*[+\-*/=]/.test(e)?`$${e}$`:e),e=e.replace(/(\\[a-zA-Z]+(?:\{.*?\})*)/g,e=>`$${e}$`),e=e.replace(/\$\$+/g,"$"),e=e.replace(/\$\$\$/g,"$$$"),ee.value=e}catch(e){console.error("Failed to paste and fix: ",e)}},ve=e=>{let a=e;return a=a.replace(/^([A-Z0-9]+\.)\s+([(\d\\].*)$/gm,"$1 $$$2$$"),a=a.replace(/(\*\*|__)(.*?)\1/g,"<strong>$2</strong>").replace(/(\*|_)(.*?)\1/g,"<em>$2</em>").replace(/^#+\s+(.*)$/gm,"<strong>$1</strong>").replace(/`([^`]+)`/g,"<code>$1</code>"),a},fe=()=>{var e;const a=null==(e=X.value)?void 0:e.$el.querySelector("textarea");if(a){const e=a.selectionStart,l=a.selectionEnd,t=W.value,r=t.substring(0,e),n=t.substring(l);W.value=r+"\n"+n,C(()=>{a.focus();const l=e+1;a.selectionStart=a.selectionEnd=l})}else W.value+="\n"},be=()=>{var e;const a=null==(e=X.value)?void 0:e.$el.querySelector("textarea");if(a){const e=a.selectionEnd,l=W.value,t=l.substring(0,e),r=l.substring(e);W.value=t+"\n"+r,C(()=>{a.focus();const l=e+1;a.selectionStart=a.selectionEnd=l})}else W.value+="\n"},ge=e=>{var a;if(e.vars){J.value=e,Y.value=new Array(e.vars.length).fill("");const l=null==(a=X.value)?void 0:a.$el.querySelector("textarea");if(l){const e=l.selectionStart,a=l.selectionEnd;if(e!==a){const l=W.value.substring(e,a);Y.value[0]=l}}G.value=!0}else ye(e.latex||e.template)},xe=()=>{if(!J.value)return;let e=J.value.template;J.value.vars.forEach((a,l)=>{e=e.replace(`{{${l}}}`,Y.value[l]||"")}),ye(e),G.value=!1},ye=e=>{var a;const l=null==(a=X.value)?void 0:a.$el.querySelector("textarea");if(l){const a=l.selectionStart,t=l.selectionEnd,r=W.value,n=r.substring(0,a),s=r.substring(t);W.value=n+e+s,C(()=>{l.focus(),l.selectionStart=l.selectionEnd=a+e.length})}else W.value+=e};return(l,v)=>(x(),g("div",T,[v[14]||(v[14]=y("div",{class:"text-h6 q-mb-md"},"Insert Math Equation",-1)),y("div",E,[y("div",j,[h(a,{modelValue:Z.value,"onUpdate:modelValue":v[0]||(v[0]=e=>Z.value=e),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:$(()=>[h(e,{name:"basic",label:"Basic"}),h(e,{name:"advanced",label:"Advanced"}),h(e,{name:"preview",label:"Text Preview"})]),_:1},8,["modelValue"]),h(t),h(p,{modelValue:Z.value,"onUpdate:modelValue":v[4]||(v[4]=e=>Z.value=e),animated:"",class:"bg-grey-1",style:{height:"250px","overflow-y":"auto"}},{default:$(()=>[h(m,{name:"basic",class:"q-pa-sm"},{default:$(()=>[y("div",M,[(x(),g(w,null,_(te,e=>h(r,{key:e.name,outline:"",color:"primary",size:"md",class:"math-btn bg-white",onClick:a=>ge(e)},{default:$(()=>[y("span",{innerHTML:ie(e.label||e.latex)},null,8,P),h(n,null,{default:$(()=>[q(k(e.name),1)]),_:2},1024)]),_:2},1032,["onClick"])),64))])]),_:1}),h(m,{name:"advanced",class:"q-pa-sm"},{default:$(()=>[y("div",U,[(x(),g(w,null,_(re,e=>h(r,{key:e.name,outline:"",color:"primary",size:"md",class:"math-btn bg-white",onClick:a=>ge(e)},{default:$(()=>[y("span",{innerHTML:ie(e.label||e.latex)},null,8,L),h(n,null,{default:$(()=>[q(k(e.name),1)]),_:2},1024)]),_:2},1032,["onClick"])),64))])]),_:1}),h(m,{name:"preview",class:"q-pa-sm"},{default:$(()=>[y("div",z,[y("div",Q,[v[10]||(v[10]=y("div",{class:"text-caption text-grey"},"Paste text with LaTeX (e.g., Problem: $\\frac{1}{2}$)",-1)),h(r,{flat:"",dense:"",color:"primary",icon:"content_paste",label:"Paste from Clipboard",size:"sm",onClick:de}),h(r,{flat:"",dense:"",color:"secondary",icon:"auto_fix_high",label:"Fix Markdown",size:"sm",onClick:me},{default:$(()=>[h(n,null,{default:$(()=>v[8]||(v[8]=[q("Convert **bold** to \\textbf{bold}, *italic* to \\textit{italic}")])),_:1})]),_:1}),h(r,{flat:"",dense:"",color:"accent",icon:"content_paste_go",label:"Paste & Fix",size:"sm",onClick:pe},{default:$(()=>[h(n,null,{default:$(()=>v[9]||(v[9]=[q("Paste from clipboard and auto-format math and lists")])),_:1})]),_:1})]),h(s,{modelValue:ee.value,"onUpdate:modelValue":v[1]||(v[1]=e=>ee.value=e),filled:"",type:"textarea",rows:"3",placeholder:"Paste your text here...",class:"text-sm"},null,8,["modelValue"]),y("div",A,[h(s,{modelValue:ae.value,"onUpdate:modelValue":v[2]||(v[2]=e=>ae.value=e),dense:"",outlined:"",placeholder:"Find",class:"col",style:{"font-size":"12px"}},null,8,["modelValue"]),h(s,{modelValue:le.value,"onUpdate:modelValue":v[3]||(v[3]=e=>le.value=e),dense:"",outlined:"",placeholder:"Replace with",class:"col"},null,8,["modelValue"])]),h(r,{unelevated:"",color:"primary",label:"Use This Text",size:"sm",onClick:ue,disable:!ee.value},null,8,["disable"])])]),_:1})]),_:1},8,["modelValue"]),y("div",F,[h(r,{flat:"",dense:"",color:"grey-8",icon:"space_bar",label:"Space",onClick:v[5]||(v[5]=e=>{ye("\\;")})}),h(r,{flat:"",dense:"",color:"grey-8",icon:"backspace",label:"Backspace",onClick:l.backspace},null,8,["onClick"]),h(r,{flat:"",dense:"",color:"negative",icon:"delete",label:"Clear",onClick:l.clear},null,8,["onClick"]),h(r,{flat:"",dense:"",color:"primary",label:"Replace",onClick:fe}),h(r,{flat:"",dense:"",color:"primary",label:"Add",onClick:be})])]),y("div",I,[v[11]||(v[11]=y("div",{class:"text-subtitle2 q-mb-xs text-grey-7"},"LaTeX Code",-1)),h(s,{modelValue:W.value,"onUpdate:modelValue":v[6]||(v[6]=e=>W.value=e),filled:"",type:"textarea",rows:"3",ref_key:"inputRef",ref:X,class:"q-mb-md","input-class":"font-mono text-sm",hint:"Use $...$ for inline math, e.g., Problem: $\\frac{1}{2}$"},null,8,["modelValue"]),v[12]||(v[12]=y("div",{class:"text-subtitle2 q-mb-xs text-grey-7"},"Preview",-1)),y("div",D,[W.value?(x(),g("div",{key:0,innerHTML:oe.value,class:"text-h5 text-center"},null,8,H)):(x(),g("div",N,"Preview"))]),y("div",R,[V(h(r,{flat:"",label:"Cancel",color:"grey"},null,512),[[o]]),h(r,{unelevated:"",label:"Insert Equation",color:"primary",onClick:ce,disable:!W.value},null,8,["disable"])])])]),h(d,{modelValue:G.value,"onUpdate:modelValue":v[7]||(v[7]=e=>G.value=e),persistent:""},{default:$(()=>[h(i,{style:{"min-width":"350px"}},{default:$(()=>[h(c,null,{default:$(()=>{var e;return[y("div",B,k(null==(e=J.value)?void 0:e.name),1),v[13]||(v[13]=y("div",{class:"text-caption text-grey"},"Enter values for the variables",-1))]}),_:1}),h(c,{class:"q-pt-none"},{default:$(()=>{var e;return[(x(!0),g(w,null,_(null==(e=J.value)?void 0:e.vars,(e,a)=>(x(),g("div",{key:a,class:"q-mb-md"},[h(s,{modelValue:Y.value[a],"onUpdate:modelValue":e=>Y.value[a]=e,filled:"",dense:"",autofocus:0===a,onKeyup:S(e=>a===J.value.vars.length-1?xe():null,["enter"])},null,8,["modelValue","onUpdate:modelValue","autofocus","onKeyup"])]))),128))]}),_:1}),h(u,{align:"right"},{default:$(()=>[V(h(r,{flat:"",label:"Cancel",color:"grey"},null,512),[[o]]),h(r,{flat:"",label:"Insert",color:"primary",onClick:xe})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-52b317f8"]]);export{O as default};
