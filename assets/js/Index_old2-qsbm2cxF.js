import{l as e}from"./ui-LrZmvB2D.js";import{_ as l}from"./AppLayout-ClCiCQFL.js";import o from"./DialogModal_8-C-HFKBV5.js";import a from"./RadioButtonGroup-Cx1Z8d0a.js";import{_ as s}from"./FilterSelectV2-CCPquDXB.js";import r from"./Dropdown2-B85CDyX3.js";import d from"./card2-C0-FMRPG.js";import{f as t,k as n,a as u,H as c,I as i,J as v,M as p,O as m,U as _,b as y,L as b,Q as f,F as h,y as g,Z as j}from"./vendor-CUZ9QTQV.js";import{o as x}from"./app-BwCflFkV.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./NameAbbreviator2-CeFANypZ.js";const w={class:"p-0 flex flex-wrap justify-center"},k={class:"mb-6 space-y-4"},S={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},$={class:"bg-white rounded-lg shadow overflow-x-auto"},V={class:"min-w-full divide-y divide-gray-200"},C={class:"bg-gray-50"},U={class:"bg-white divide-y divide-gray-200"},D={class:"px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900 border-r"},A={class:"p-0"},T=["onClick"],E={class:"p-0"},M=["onClick"],O={class:"py-1"},z=x({__name:"Index_old2",props:{records:{type:Object,default:()=>({data:[]})},records2:{type:Object,default:()=>({data:[]})},options:{type:Object,default:()=>({})},periodDetails:{type:Array,default:()=>[]}},setup(x){t("Cozy"),t([{value:"Cozy2",label:"Cozy"}]);const z=x;t(null==z?void 0:z.records);const F=t(z.records||[]),I=t({});console.log("Props received:",{records:z.records,options:z.options,periodDetails:z.periodDetails});const N=[{name:"Sunday",number:1},{name:"Monday",number:2},{name:"Tuesday",number:3},{name:"Wednesday",number:4},{name:"Thursday",number:5}],P=Array.from({length:8},(e,l)=>l+1),L=t(!1),Z=t(z.records||[]),q=t(!1),B=t({day:null,period_number:null}),G=t(null),H=t(!1),J=t({school:null,school_object:{},classroom:null,classroom_object:{},schedule:null,schedule_object:{}});t(!1);const Q=t(null);n(()=>z.records,e=>{Z.value=e},{deep:!0});const R=u(()=>{var e;console.log("CSTs from options:",null==(e=z.options)?void 0:e.csts);const l=z.records||[],o=[...new Set(l.map(e=>{var l,o;return null==(o=null==(l=e.cst)?void 0:l.classroom)?void 0:o.id}))].map(e=>{var o,a,s,r,d,t;const n=l.find(l=>{var o,a;return(null==(a=null==(o=l.cst)?void 0:o.classroom)?void 0:a.id)===e});return{id:null==(a=null==(o=n.cst)?void 0:o.classroom)?void 0:a.id,name:null==(r=null==(s=n.cst)?void 0:s.classroom)?void 0:r.name,grade:null==(t=null==(d=n.cst)?void 0:d.classroom)?void 0:t.grade}});return console.log("Processed classrooms:",o),o});u(()=>{var e,l;console.log("CSTs from options:",null==(e=z.options)?void 0:e.csts);const o=(null==(l=z.options)?void 0:l.csts)||[],a=[...new Set(o.map(e=>e.classroom.id))].map(e=>{const l=o.find(l=>l.classroom.id===e);return{id:l.classroom.id,name:l.classroom.name,grade:l.classroom.grade}});return console.log("Processed classrooms:",a),a}),u(()=>{const e={};return R.value.forEach(l=>{e[l.id]={};for(let o=1;o<=5;o++){e[l.id][o]={};for(let a=1;a<=8;a++)e[l.id][o][a]=null}}),z.records.forEach(l=>{const o=l.cst.classroom.id;e[o]&&(e[o][l.day][l.period_number]={id:l.id,subject:l.cst.subject.name,teacher:l.cst.teacher.name,is_disabled:!l.active,color_bg:l.cst.subject.color_bg,color_text:l.cst.subject.color_text})}),e});const W=u(()=>{var e;return(null==(e=z.records)?void 0:e.length)?z.records.reduce((e,l)=>{var o,a,s,r,d,t,n,u;if(!(null==l?void 0:l.day)||!(null==l?void 0:l.period_number))return e;return e[`${l.day}-${l.period_number}`]={subject:(null==(a=null==(o=l.cst)?void 0:o.subject)?void 0:a.name)||"",teacher:(null==(r=null==(s=l.cst)?void 0:s.teacher)?void 0:r.name)||"",color_bg:(null==(t=null==(d=l.cst)?void 0:d.subject)?void 0:t.color_bg)||"#ffffff",color_text:(null==(u=null==(n=l.cst)?void 0:n.subject)?void 0:u.color_text)||"#000000",cst:l.cst||null,schedule:l,id:null==l?void 0:l.id},e},{}):{}}),Y=(e,l,o)=>W.value[`${l.number}-${o}`]||null,K=(e,l,o)=>{var a;return console.log(l,o),B.value.day=l.number,B.value.period_number=o,F.value=null==(a=z.records)?void 0:a.filter(l=>{var o,a;return(null==(a=null==(o=l.cst)?void 0:o.classroom)?void 0:a.id)===e}),console.log("Filtered records:",F.value),F.value},X=()=>{q.value=!1,G.value=null,H.value=!1},ee=async(l,o,a,s)=>{var r,d,t,n,u;const c={...l,id:l.id,day:a.number,period_number:s,school_id:l.school_id,copy_id:l.copy_id,active:null==(r=l.active)||r};try{return console.log("formData22222222___________",c),void console.log("3333___________",l,o,a,s)}catch(i){const l=(null==(t=null==(d=i.response)?void 0:d.data)?void 0:t.message)||"An unexpected error occurred";onError((null==(u=null==(n=i.response)?void 0:n.data)?void 0:u.errors)||{error:[l]}),e.error(l)}finally{H.value=!1}},le=async({form:l,onSuccess:o,onError:a})=>{var s,r,d,t,n;if(H.value)return;H.value=!0,Q.value=null;const u={...l,day:B.value.day,period_number:B.value.period_number,school_id:G.value.school_id,copy_id:G.value.copy_id,active:null==(s=G.value.active)||s};try{const l="/admin/schedule/update2",a=await j.post(l,u);Z.value=u.id?Z.value.map(e=>e.id===G.value.id?a.data:e):[...Z.value,a.data],X(),o(),e.success(`Schedule ${u.id?"updated":"created"} successfully`)}catch(c){const l=(null==(d=null==(r=c.response)?void 0:r.data)?void 0:d.message)||"An unexpected error occurred";a((null==(n=null==(t=c.response)?void 0:t.data)?void 0:n.errors)||{error:[l]}),e.error(l)}finally{H.value=!1}},oe=u(()=>{var e;return[{name:"cst_id",label:"Class-Subject-Teacher",type:"select",required:!0,options:(null==(e=F.value)?void 0:e.map(e=>({value:e.id,label:`${e.classroom}`})))||[]}]});t(null),t(null),t({row:null,col:null}),t(null),u(()=>{var e;return{school_id:null==(e=selected_school_object.value)?void 0:e.id,period_number:null,day:null,cst_id:null,place:"",active:!0,notes:""}}),u(()=>{var e;return(null==(e=z.records2)?void 0:e.filter(e=>{var l,o,a,s,r;return!Y(null==(o=null==(l=e.cst)?void 0:l.classroom)||o.id,e.day,e.period_number)&&(null==(s=null==(a=e.cst)?void 0:a.classroom)?void 0:s.id)===(null==(r=selected_classroom.value)?void 0:r.id)}))||[]});const ae=u(()=>{var e;return(null==(e=F.value)?void 0:e.filter(e=>null!=e))||[]});return(e,t)=>(i(),c(l,{title:"Schedule Management"},{default:v(()=>{var l,n,u;return[p("details",null,[p("pre",null,"    props.options?.classrooms:"+_(null==(n=null==(l=z.options)?void 0:l.csts[0])?void 0:n.classroom)+"\n\n\n",1)]),p("details",null,[p("div",w,[y(a,{modelValue:I.value,"onUpdate:modelValue":t[0]||(t[0]=e=>I.value=e),name:"officeType",my_class:"flex flex-wrap justify-center gap-1",options:ae.value,period_day:{day:null==(u=e.day)?void 0:u.number,period:e.period}},null,8,["modelValue","options","period_day"])])]),p("details",null,[p("pre",null,"                props.records:"+_(z.records2)+"\n\n            ",1)]),p("div",k,[p("div",S,[y(s,{modelValue:J.value.school,"onUpdate:modelValue":t[1]||(t[1]=e=>J.value.school=e),object:J.value.school_object,"onUpdate:object":t[2]||(t[2]=e=>J.value.school_object=e),options:e.$page.props.auth.user.school,"value-key":"id","label-key":["name","hr.name"],placeholder:"Select School","label-separator":" - ","default-selected-index":0,label_only:!1},null,8,["modelValue","object","options"]),y(s,{modelValue:J.value.classroom,"onUpdate:modelValue":t[3]||(t[3]=e=>J.value.classroom=e),object:J.value.classroom_object,"onUpdate:object":t[4]||(t[4]=e=>J.value.classroom_object=e),options:e.$page.props.auth.user.classroom,"value-key":"id","label-key":["name"],placeholder:"Select Classroom"},null,8,["modelValue","object","options"]),y(s,{modelValue:J.value.schedule,"onUpdate:modelValue":t[5]||(t[5]=e=>J.value.schedule=e),object:J.value.schedule_object,"onUpdate:object":t[6]||(t[6]=e=>J.value.schedule_object=e),options:e.$page.props.auth.user.schedule,"value-key":"id","label-key":["cst.classroom_name","cst.subject_name","cst.teacher_name"],placeholder:"Select Schedule"},null,8,["modelValue","object","options"])])]),p("div",$,[p("table",V,[p("thead",C,[p("tr",null,[t[8]||(t[8]=p("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Classroom ",-1)),(i(),b(h,null,f(N,e=>p("th",{key:e,colspan:8,class:"px-4 py-2 text-center text-sm font-medium text-gray-700 border-l"},_(e.name),1)),64))]),p("tr",null,[t[9]||(t[9]=p("th",null,null,-1)),(i(),b(h,null,f(N,e=>(i(),b(h,{key:`periods-${e}`},[(i(!0),b(h,null,f(g(P),l=>(i(),b("th",{key:`${e}-${l}`,class:"px-2 py-2 text-center text-xs font-medium text-gray-500 uppercase border-l first:border-l-0"},_(l),1))),128))],64))),64))])]),p("tbody",U,[(i(!0),b(h,null,f(R.value,e=>(i(),b("tr",{key:e.id},[p("td",D,_(e.name),1),(i(),b(h,null,f(N,l=>(i(),b(h,{key:`${e.id}-${l}`},[(i(!0),b(h,null,f(g(P),o=>(i(),b("td",{key:`${e.id}-${l}-${o}`,class:"px-2 py-2 border-l first:border-l-0"},[p("div",A,[p("button",{onClick:a=>{return s=Y(e.id,l,o),void console.log(s);var s}},"wwww",8,T),y(r,{width:"56",align:"left","auto-hide":!0},{trigger:v(()=>{var a,s,r,t;return[p("div",E,[(null==(s=null==(a=Y(e.id,l,o))?void 0:a.schedule)?void 0:s.period_number)==o&&(null==(t=null==(r=Y(e.id,l,o))?void 0:r.schedule)?void 0:t.day)==l.number?(i(),c(d,{key:0,option:Y(e.id,l,o),name:"radioName",my_class:"custom-class",onClick:a=>K(e.id,l,o),onSet_data:a=>((e,l,o,a)=>{console.log("setSelectedSession________",e),L.value=e,ee(L.value,l,o,a)})(a,e.id,l,o)},null,8,["option","onClick","onSet_data"])):(i(),b("button",{key:1,onClick:a=>K(e.id,l,o),class:"px-2 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded"}," filter ",8,M))])]}),content:v(()=>[p("div",O,[y(a,{class:"scale-75",modelValue:I.value,"onUpdate:modelValue":t[7]||(t[7]=e=>I.value=e),name:"officeType",my_class:"flex flex-wrap justify-center gap-1",options:F.value,period_day:{classroom:e.id,day:l.number,period:o}},null,8,["modelValue","options","period_day"])])]),_:2},1024)])]))),128))],64))),64))]))),128))])])]),q.value?(i(),c(o,{key:0,show:q.value,title:G.value?"Edit Schedule":"Add New Schedule",fields:oe.value,formData:G.value,onClose:X,onSubmitted:le},null,8,["show","title","fields","formData"])):m("",!0)]}),_:1}))}},[["__scopeId","data-v-2d9eb6c3"]]);export{z as default};
