import{u as e,c as l,d as a,a as s,l as t,Q as o,m as i,b as d}from"./app-Buylb2AA.js";import{Q as u}from"./QSelect-CcTxzM62.js";import{Q as n}from"./QForm-Bm_VWO8S.js";import{Q as c}from"./QBadge-Dt5ch-CZ.js";import{a2 as m,f as r,k as p,a as v,Z as g,H as h,I as y,J as f,b as x,M as q,y as _,O as b,U as w}from"./vendor-CUZ9QTQV.js";import{u as S}from"./schoolData-BQSkQPXz.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";import"./rtl-Cr6c3OOr.js";const V={class:"row q-col-gutter-md"},j={class:"col-12"},k={class:"row q-col-gutter-md q-mt-none"},I={class:"col-12 col-md-4"},z={class:"col-12 col-md-4"},C={class:"col-12 col-md-4"},U={class:"row justify-center q-gutter-md"},Q={class:"text-weight-medium"},F={class:"text-weight-medium"},Y={class:"text-weight-medium"},A={class:"text-weight-medium"},B={__name:"SchoolSettingsDialog",props:{modelValue:{type:Boolean,default:!1},schoolId:{type:Number,required:!1,default:null}},emits:["update:modelValue","saved","cancel"],setup(B,{emit:D}){const O=e(),H=S(),{schools:J}=m(H),M=B,N=D,P=r(!1),R=r(null),T=r(null),Z=r(null),$=r(null),E=r([]),G=r([]),K=r([]);p(()=>M.modelValue,e=>{P.value=e,e&&(M.schoolId&&(R.value=M.schoolId),ee())}),p(P,e=>{N("update:modelValue",e)}),p(R,async e=>{e&&P.value&&await ee()});const L=v(()=>R.value&&T.value&&Z.value&&$.value),W=e=>{const l=J.value.find(l=>l.id===e);return l?l.name:"Unknown School"},X=async e=>{e&&await H.setSchool(e)},ee=async()=>{var e,l;try{if(E.value=H.academicYears,G.value=H.semesters,K.value=H.scheduleCopies,0===E.value.length){const e=await g.get("/api/academic-years");E.value=e.data.data||e.data}if(0===G.value.length){const e=await g.get("/api/semesters");G.value=e.data.data||e.data}if(R.value){if(0===K.value.length){const e=await g.get("/api/schedule-copies",{params:{school_id:R.value}});K.value=e.data}}else K.value=[];R.value&&await le()}catch(a){O.notify({type:"negative",message:"Failed to load options",caption:(null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||a.message})}},le=async()=>{var e,l;try{H.academicYearId&&(T.value=E.value.find(e=>e.id===H.academicYearId)||null),H.semesterId&&(Z.value=G.value.find(e=>e.id===H.semesterId)||null),H.scheduleCopyId&&($.value=K.value.find(e=>e.id===H.scheduleCopyId)||null)}catch(a){O.notify({type:"negative",message:"Failed to load current settings",caption:(null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||a.message})}},ae=async()=>{var e,l,a,s,t;if(L.value)try{await H.updateSchoolSettings({academic_year_id:(null==(e=T.value)?void 0:e.id)||null,semester_id:(null==(l=Z.value)?void 0:l.id)||null,schedule_copy_id:(null==(a=$.value)?void 0:a.id)||null}),O.notify({type:"positive",message:"School settings saved successfully"}),N("saved"),P.value=!1}catch(o){O.notify({type:"negative",message:"Failed to save settings",caption:(null==(t=null==(s=o.response)?void 0:s.data)?void 0:t.message)||o.message})}else O.notify({type:"warning",message:"Please fill in all required fields",caption:"All fields marked with * are required"})};return(e,m)=>(y(),h(d,{modelValue:P.value,"onUpdate:modelValue":m[5]||(m[5]=e=>P.value=e),persistent:"",maximized:""},{default:f(()=>[x(i,{style:{"max-width":"800px",margin:"auto"},class:"q-pa-lg"},{default:f(()=>[x(l,{class:"text-center"},{default:f(()=>m[6]||(m[6]=[q("div",{class:"text-h5 text-primary q-mb-sm"},"School Configuration",-1),q("div",{class:"text-subtitle1 text-grey"},"Set up school context for the weekly planning system",-1)])),_:1}),x(l,null,{default:f(()=>[x(n,{class:"q-gutter-y-md"},{default:f(()=>[q("div",V,[q("div",j,[x(u,{modelValue:R.value,"onUpdate:modelValue":[m[0]||(m[0]=e=>R.value=e),X],options:_(H).schools,"option-value":"id","option-label":"name",label:"Select School *",outlined:"",dense:"","emit-value":"","map-options":"",loading:_(H).loading,rules:[e=>!!e||"School selection is required"],class:"full-width"},{prepend:f(()=>[x(a,{name:"school",color:"primary"})]),_:1},8,["modelValue","options","loading","rules"])])]),q("div",k,[q("div",I,[x(u,{modelValue:T.value,"onUpdate:modelValue":m[1]||(m[1]=e=>T.value=e),options:E.value,"option-value":"id","option-label":"name",label:"Academic Year *",outlined:"",dense:"","map-options":"",rules:[e=>!!e||"Academic year is required"]},{prepend:f(()=>[x(a,{name:"calendar_month",color:"blue"})]),_:1},8,["modelValue","options","rules"])]),q("div",z,[x(u,{modelValue:Z.value,"onUpdate:modelValue":m[2]||(m[2]=e=>Z.value=e),options:G.value,"option-value":"id","option-label":"name",label:"Semester *",outlined:"",dense:"","map-options":"",rules:[e=>!!e||"Semester is required"]},{prepend:f(()=>[x(a,{name:"event",color:"indigo"})]),_:1},8,["modelValue","options","rules"])]),q("div",C,[x(u,{modelValue:$.value,"onUpdate:modelValue":m[3]||(m[3]=e=>$.value=e),options:K.value,"option-value":"id","option-label":"name",label:"Schedule Copy *",outlined:"",dense:"","map-options":"",rules:[e=>!!e||"Schedule copy is required"]},{prepend:f(()=>[x(a,{name:"schedule",color:"teal"})]),_:1},8,["modelValue","options","rules"])])])]),_:1})]),_:1}),x(s,{class:"q-my-md"}),x(l,{class:"text-center"},{default:f(()=>[m[7]||(m[7]=q("div",{class:"text-h6 text-weight-medium text-primary q-mb-md"},"Current Selection",-1)),q("div",U,[R.value?(y(),h(c,{key:0,color:"primary",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:f(()=>[x(a,{name:"school",size:"18px",class:"q-mr-xs"}),q("span",Q,w(W(R.value)),1)]),_:1})):b("",!0),T.value?(y(),h(c,{key:1,color:"blue-6",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:f(()=>[x(a,{name:"calendar_month",size:"18px",class:"q-mr-xs"}),q("span",F,w(T.value.name),1)]),_:1})):b("",!0),Z.value?(y(),h(c,{key:2,color:"indigo-6",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:f(()=>[x(a,{name:"event",size:"18px",class:"q-mr-xs"}),q("span",Y,w(Z.value.name),1)]),_:1})):b("",!0),$.value?(y(),h(c,{key:3,color:"teal-6",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:f(()=>[x(a,{name:"schedule",size:"18px",class:"q-mr-xs"}),q("span",A,w($.value.name),1)]),_:1})):b("",!0)])]),_:1}),x(t,{align:"right",class:"q-pt-lg"},{default:f(()=>[x(o,{label:"Cancel",color:"grey",flat:"",onClick:m[4]||(m[4]=l=>e.$emit("cancel")),class:"q-px-md"}),x(o,{label:"Save Settings",icon:"save",color:"primary",onClick:ae,disable:!L.value,class:"q-px-xl"},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{B as default};
