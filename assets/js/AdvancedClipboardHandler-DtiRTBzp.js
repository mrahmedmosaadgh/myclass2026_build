import e from"./purify.es-C2Ba6vpb.js";import{_ as t}from"./LucideIcon-DSukDbp_.js";import{o as a,aO as n}from"./app-CqJgtQaN.js";import{f as l,a as o,M as r,J as s,N as i,Q as c,b as d,K as u,W as p,z as m,y as v,ac as f,V as g,a0 as y,U as b,ab as h,an as w}from"./vendor-DuKqz2x4.js";import"./createLucideIcon-CH-llAdf.js";import"./align-right-GjtEmXC3.js";import"./underline-mNdAcouf.js";import"./image-C7UVNzjr.js";import"./printer-DFzJsatj.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";const x={class:"clipboard-handler"},C={class:"flex space-x-2 mb-4"},T=["disabled"],A=["disabled"],D={key:0,class:"paste-instructions"},E=["disabled"],k={key:1,class:"content-preview"},N=["innerHTML"],z={key:1,class:"image-wrapper"},R=["src"],j={key:3,class:"url-content"},L={key:0,class:"controls mt-4 flex items-center justify-between"},I={class:"flex items-center space-x-3"},S=["disabled"],_=a({__name:"AdvancedClipboardHandler",props:{maxSize:{type:Number,default:5242880},allowedTypes:{type:Array,default:()=>["text","html","image","code","url"]}},emits:["update:content","error","change","set_data"],setup(a,{emit:_}){const H=a,M=_,P=l(null),F=l(null),U=l("text"),W=l(!1),V=l(null),B=l(""),O=o(()=>"html"===U.value?e.sanitize(F.value):F.value),J=e=>e.match(/<[^>]*>/)?"html":e.match(/^https?:\/\//)?"url":e.match(/^(const|let|var|function|class|import|export|if|for|while)/)?"code":"text",K=async t=>{try{W.value=!0,t.preventDefault();const a=window.getSelection(),n=a.getRangeAt(0),l=t.clipboardData.items,o=t.clipboardData.getData("text/html");if(o){const t=e.sanitize(o),a=document.createElement("div");a.innerHTML=t;const l=e=>{if(1===e.nodeType){const t=e.attributes;for(let a=t.length-1;a>=0;a--){const n=t[a];["src","href","alt"].includes(n.name)||e.removeAttribute(n.name)}Array.from(e.children).forEach(l)}};l(a);const r=document.createDocumentFragment();return Array.from(a.childNodes).forEach(e=>r.appendChild(e)),n.deleteContents(),void n.insertNode(r)}const r=t.clipboardData.getData("text/plain");if(r){const e=document.createTextNode(r);return n.deleteContents(),n.insertNode(e),n.setStartAfter(e),n.setEndAfter(e),a.removeAllRanges(),void a.addRange(n)}for(const e of l)if(e.type.startsWith("image/")){const t=e.getAsFile();if(t.size>H.maxSize)throw new Error("Image size exceeds limit");const a=await Z(t),l=document.createElement("img");return l.src=a,n.deleteContents(),void n.insertNode(l)}}catch(a){M("error",a)}finally{W.value=!1}},Q=async e=>{try{W.value=!0;const t=e.dataTransfer.files[0];if(t){if(t.size>H.maxSize)throw new Error("File size exceeds limit");if(t.type.startsWith("image/")){const e=await Z(t);$({type:"image",data:e})}else{const e=await t.text(),a=J(e);$({type:a,data:e})}}}catch(t){M("error",t)}finally{W.value=!1}},Z=e=>new Promise((t,a)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=a,n.readAsDataURL(e)}),$=e=>{H.allowedTypes.includes(e.type)?(F.value=e.data,U.value=e.type,"image"===e.type&&(B.value=""),M("update:content",{content:e.data,type:e.type,..."image"===e.type?{altText:B.value}:{}})):M("error",new Error(`Content type '${e.type}' not allowed`))},q=()=>{$({type:U.value,data:F.value})},G=()=>{F.value=null,U.value="text",M("update:content",null),M("change",null)},X=async(t="replace")=>{try{W.value=!0;const a=await navigator.clipboard.read();for(const n of a){if(n.types.includes("text/html")){const a=await n.getType("text/html"),l=await a.text(),o=e.sanitize(l);if("replace"===t)F.value=o,U.value="html",M("update:content",{content:o,type:"html"});else{const e=window.getSelection().getRangeAt(0),t=document.createElement("div");t.innerHTML=o;const a=document.createDocumentFragment();Array.from(t.childNodes).forEach(e=>a.appendChild(e)),e.insertNode(a)}return}if(n.types.some(e=>e.startsWith("image/"))){const e=n.types.find(e=>e.startsWith("image/")),a=await n.getType(e),l=await Z(a);if("replace"===t)F.value=l,U.value="image",M("update:content",{content:l,type:"image"});else{const e=window.getSelection().getRangeAt(0),t=document.createElement("img");t.src=l,e.insertNode(t)}return}if(n.types.includes("text/plain")){const e=await n.getType("text/plain"),a=await e.text(),l=J(a);if("replace"===t)F.value=a,U.value=l,M("update:content",{content:a,type:l});else{const e=window.getSelection().getRangeAt(0),t=document.createTextNode(a);e.insertNode(t)}return}}}catch(a){M("error",a)}finally{W.value=!1}},Y=e=>{"html"===U.value?F.value=e.target.innerHTML:"url"===U.value?F.value=e.target.value:F.value=e.target.innerText,M("update:content",{content:F.value,type:U.value})},ee=()=>{M("update:content",{content:F.value,type:U.value,altText:B.value})},te=()=>{const t={content:F.value,type:U.value};"image"===U.value?t.altText=B.value:"html"===U.value?t.content=e.sanitize(F.value):"code"===U.value&&(t.content=F.value.trim()),M("set_data",t)},ae=async t=>{try{W.value=!0,t.preventDefault();const a=V.value;let n,l=window.getSelection();l.rangeCount?n=l.getRangeAt(0):(n=document.createRange(),a&&(n.selectNodeContents(a),n.collapse(!1),l=window.getSelection(),l.removeAllRanges(),l.addRange(n)));const o=t.clipboardData.items,r=t.clipboardData.getData("text/html");if(r){const t=e.sanitize(r),l=await(async e=>{const t=document.createElement("div");t.innerHTML=e;const a=t.getElementsByTagName("img"),n=Array.from(a).map(async e=>{if(!e.src.startsWith("data:"))try{const t=await fetch(e.src),a=await t.blob(),n=await Z(a);e.src=n}catch(t){console.error("Failed to convert image to base64:",t)}});return await Promise.all(n),t.innerHTML})(t),o=document.createElement("div");o.innerHTML=l,cleanElement(o);const s=document.createDocumentFragment();return Array.from(o.childNodes).forEach(e=>s.appendChild(e)),void(n?(n.deleteContents(),n.insertNode(s)):a&&a.appendChild(s))}for(const e of o)if(e.type.startsWith("image/")){const t=e.getAsFile();if(t.size>H.maxSize)throw new Error("Image size exceeds limit");const l=await Z(t),o=document.createElement("img");return o.src=l,void(n?(n.deleteContents(),n.insertNode(o)):a&&a.appendChild(o))}const s=t.clipboardData.getData("text/plain");if(s){const e=document.createTextNode(s);n?(n.deleteContents(),n.insertNode(e),n.setStartAfter(e),n.setEndAfter(e),l.removeAllRanges(),l.addRange(n)):a&&a.appendChild(e)}}catch(a){M("error",a)}finally{W.value=!1}},ne=async()=>{try{const e=await navigator.clipboard.readText(),t=new ClipboardEvent("paste",{clipboardData:new DataTransfer});Object.defineProperty(t.clipboardData,"getData",{value:t=>"text/plain"===t?e:""}),await ae(t)}catch(e){try{const e=P.value;e&&(e.focus(),document.execCommand("paste"))}catch(t){M("error",t)}}};return(e,a)=>(s(),r("div",x,[i("div",C,[d(m(n),{align:"left","auto-close":!0},{label:u(()=>[i("button",{class:"paste-btn flex items-center",disabled:W.value},[d(t,{name:"clipboard-paste",class:"w-5 h-5 mr-2"}),a[6]||(a[6]=i("span",null,"Paste",-1)),d(t,{name:"chevron-down",class:"w-4 h-4 ml-1"})],8,T)]),default:u(()=>[i("button",{onClick:a[0]||(a[0]=e=>X("replace")),class:"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center"},[d(t,{name:"replace",class:"w-4 h-4 mr-2"}),a[7]||(a[7]=p(" Replace Content "))]),i("button",{onClick:a[1]||(a[1]=e=>X("insert")),class:"w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center"},[d(t,{name:"plus",class:"w-4 h-4 mr-2"}),a[8]||(a[8]=p(" Insert at Cursor "))])]),_:1}),i("button",{onClick:ne,class:"paste-btn-base64",disabled:W.value},[d(t,{name:"image",class:"w-5 h-5 mr-2"}),a[9]||(a[9]=p(" Paste with Base64 Images "))],8,A)]),i("div",{ref_key:"pasteZone",ref:P,class:b(["paste-zone",{"is-processing":W.value}]),onPaste:K,onDragover:a[4]||(a[4]=y(()=>{},["prevent"])),onDrop:y(Q,["prevent"]),tabindex:"0"},[F.value?(s(),r("div",k,["html"===U.value?(s(),r("div",{key:0,ref_key:"editableContent",ref:V,contenteditable:"true",class:"html-content editable-content",onInput:Y,innerHTML:O.value},null,40,N)):"image"===U.value?(s(),r("div",z,[i("img",{src:F.value,class:"image-content"},null,8,R),void 0!==B.value?v((s(),r("textarea",{key:0,"onUpdate:modelValue":a[2]||(a[2]=e=>B.value=e),class:"image-alt-text",placeholder:"Enter image description...",onInput:ee},null,544)),[[f,B.value]]):c("",!0)])):"code"===U.value?(s(),r("div",{key:2,ref_key:"editableContent",ref:V,contenteditable:"true",class:"code-content editable-content",onInput:Y},[i("pre",null,[i("code",null,g(F.value),1)])],544)):"url"===U.value?(s(),r("div",j,[v(i("input",{type:"url","onUpdate:modelValue":a[3]||(a[3]=e=>F.value=e),class:"url-input",onInput:Y},null,544),[[f,F.value]])])):(s(),r("div",{key:4,ref_key:"editableContent",ref:V,contenteditable:"true",class:"text-content editable-content",onInput:Y},g(F.value),545))])):(s(),r("div",D,[d(t,{name:"clipboard",class:"icon"}),a[11]||(a[11]=i("p",null,"Paste content or drop files here",-1)),a[12]||(a[12]=i("small",null,"Supports: Text, HTML, Images, URLs, Code",-1)),i("button",{onClick:X,class:"paste-btn mt-4",disabled:W.value},[d(t,{name:"clipboard-paste",class:"w-5 h-5 mr-2"}),a[10]||(a[10]=p(" Paste from Clipboard "))],8,E)]))],34),F.value?(s(),r("div",L,[i("div",I,[v(i("select",{"onUpdate:modelValue":a[5]||(a[5]=e=>U.value=e),onChange:q,class:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},a[13]||(a[13]=[w('<option value="text" data-v-3bd0d34d>Plain Text</option><option value="html" data-v-3bd0d34d>HTML</option><option value="image" data-v-3bd0d34d>Image</option><option value="code" data-v-3bd0d34d>Code</option><option value="url" data-v-3bd0d34d>URL</option>',5)]),544),[[h,U.value]]),i("button",{onClick:G,class:"px-3 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"}," Clear ")]),i("button",{onClick:te,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",disabled:!F.value},[d(t,{name:"save",class:"w-5 h-5"}),a[14]||(a[14]=i("span",null,"Save Changes",-1))],8,S)])):c("",!0)]))}},[["__scopeId","data-v-3bd0d34d"]]);export{_ as default};
