import{p as e,u as l,d as a,e as o,Q as s,a as t,f as r,C as i,l as n,q as d,m as u,n as m,b as c,aD as p}from"./app-BXm70mdJ.js";import{Q as f}from"./QSpace-Bu8V-QDa.js";import{Q as v,a as y}from"./QStepper-9iCkKHrv.js";import{Q as b}from"./QTab-DhKL91H_.js";import{Q as g}from"./QTabs-CDJ215OP.js";import{Q as _}from"./QBadge-ZzhN1X9C.js";import{Q as w}from"./QTd-BIxMTYzb.js";import{Q as h}from"./QTable-rnEofRem.js";import{Q as k}from"./QTabPanel-sB32VrK8.js";import{Q as x}from"./QTabPanels-LFwTBPSC.js";import{f as j,a as q,k as Q,H as V,I as C,J as P,b as T,M as S,x as F,O as N,U as z,L as I,V as R,S as U,Z as $}from"./vendor-DNM7Y6Xn.js";import"./offline-BzIlwqNM.js";import"./i18n-CBOKL2HS.js";import"./ui-BP0GJNn5.js";import"./use-panel-D2HepUiw.js";import"./use-render-cache-CmTcazfP.js";import"./rtl-Cr6c3OOr.js";import"./QMarkupTable-Dmg3C5Wm.js";import"./QSelect-CnZtzPIC.js";import"./QLinearProgress-Cix0cchl.js";import"./use-fullscreen-FlxrEg_V.js";const A={class:"text-body2 q-mb-md"},B={class:"q-mt-md"},D={key:0,class:"q-mb-md"},M={class:"row q-gutter-sm q-mb-md"},L={class:"text-caption text-orange-9"},G={class:"text-caption text-grey-7"},O={class:"q-mt-md"},E={key:0,class:"q-mt-xs text-orange-9"},H={class:"q-mt-md"},J={class:"text-weight-bold"},K={key:0,class:"text-caption q-mt-xs"},W={key:0},Z={key:1},X={key:2},Y=e({__name:"RandomFillDialog",props:{modelValue:Boolean,classroomId:Number,classroomName:String,copyId:Number},emits:["update:modelValue","applied"],setup(e,{emit:Y}){const ee=e,le=Y,ae=l(),oe=j(1),se=j(!1),te=j(!1),re=j(null),ie=j(!1),ne=j("all"),de=j(!1),ue=j(null),me=["","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],ce=q(()=>{if(!re.value)return[];const e=[...re.value.filled];return ie.value&&e.push(...re.value.conflicts),e}),pe=[{name:"day",label:"Day",field:"day",align:"left"},{name:"period",label:"Period",field:"period",align:"center"},{name:"subject_name",label:"Subject",field:"subject_name",align:"left"},{name:"teacher_name",label:"Teacher",field:"teacher_name",align:"left"},{name:"status",label:"Status",align:"center"}],fe=[{name:"day",label:"Day",field:"day",align:"left"},{name:"period",label:"Period",field:"period",align:"center"},{name:"subject_name",label:"Subject",field:"subject_name",align:"left"},{name:"teacher_name",label:"Teacher",field:"teacher_name",align:"left"},{name:"conflict",label:"Conflict",align:"left"}],ve=[{name:"day",label:"Day",field:"day",align:"left"},{name:"period",label:"Period",field:"period",align:"center"},{name:"reason",label:"Reason",field:"reason",align:"left"}],ye=e=>me[e]||`Day ${e}`,be=e=>["","red-4","blue-4","green-4","orange-4","purple-4","teal-4","pink-4"][e]||"grey-4",ge=async()=>{var e,l;se.value=!0,te.value=!1,re.value=null;try{const e=await $.post("/weekly-system/api/random-fill/preview",{copy_id:ee.copyId,classroom_id:ee.classroomId});e.data.success?(re.value=e.data.data,te.value=!0,ae.notify({type:"positive",message:`Preview generated: ${e.data.data.summary.total_empty} empty slots found`,position:"top"}),e.data.data.summary.total_empty>0&&setTimeout(()=>{oe.value=2},500)):ae.notify({type:"negative",message:e.data.message||"Failed to generate preview",position:"top"})}catch(a){ae.notify({type:"negative",message:(null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||"Failed to generate preview",position:"top"})}finally{se.value=!1}},_e=async()=>{var e,l,a,o,s,t;de.value=!0,ue.value=null;try{const e=await $.post("/weekly-system/api/random-fill/apply",{copy_id:ee.copyId,classroom_id:ee.classroomId,assignments:ce.value,force_conflicts:ie.value});ue.value=e.data,e.data.success&&(ae.notify({type:"positive",message:e.data.message,position:"top"}),le("applied"))}catch(r){ue.value={success:!1,message:(null==(l=null==(e=r.response)?void 0:e.data)?void 0:l.message)||"Failed to apply random fill",errors:null==(o=null==(a=r.response)?void 0:a.data)?void 0:o.errors},ae.notify({type:"negative",message:(null==(t=null==(s=r.response)?void 0:s.data)?void 0:t.message)||"Failed to apply random fill",position:"top"})}finally{de.value=!1}};return Q(()=>ee.modelValue,e=>{e&&(oe.value=1,se.value=!1,te.value=!1,re.value=null,ie.value=!1,ne.value="all",de.value=!1,ue.value=null)}),(l,j)=>(C(),V(c,{"model-value":e.modelValue,"onUpdate:modelValue":j[8]||(j[8]=e=>l.$emit("update:modelValue",e)),position:"right",maximized:""},{default:P(()=>[T(m,{style:{width:"900px","max-width":"90vw"},class:"column"},{default:P(()=>[T(a,{class:"row items-center q-pb-none bg-primary text-white"},{default:P(()=>[T(o,{name:"shuffle",size:"sm",class:"q-mr-sm"}),j[9]||(j[9]=S("div",{class:"text-h6"},"Random Fill Missing Periods",-1)),T(f),F(T(s,{icon:"close",flat:"",round:"",dense:""},null,512),[[p]])]),_:1}),T(t),T(a,{class:"col scroll"},{default:P(()=>[T(v,{modelValue:oe.value,"onUpdate:modelValue":j[7]||(j[7]=e=>oe.value=e),vertical:"",color:"primary",animated:""},{default:P(()=>[T(y,{name:1,title:"Generate Preview",icon:"preview",done:oe.value>1},{default:P(()=>[S("div",A," Click the button below to generate a preview of random assignments for all empty periods in "+z(e.classroomName)+". ",1),te.value?N("",!0):(C(),V(r,{key:0,class:"bg-blue-1 q-mb-md"},{avatar:P(()=>[T(o,{name:"info",color:"blue"})]),default:P(()=>[j[10]||(j[10]=S("div",null," The system will randomly assign available subject-teacher combinations to empty periods, avoiding conflicts where possible. ",-1))]),_:1})),S("div",B,[T(s,{color:"primary",icon:"shuffle",label:"Generate Preview",onClick:ge,loading:se.value,class:"q-mr-sm"},null,8,["loading"]),te.value?(C(),V(s,{key:0,flat:"",color:"primary",label:"Next: Review",onClick:j[0]||(j[0]=e=>oe.value=2)})):N("",!0)])]),_:1},8,["done"]),T(y,{name:2,title:"Review Assignments",icon:"checklist",done:oe.value>2},{default:P(()=>[j[13]||(j[13]=S("div",{class:"text-body2 q-mb-md"}," Review the proposed random assignments below. ",-1)),re.value?(C(),I("div",D,[S("div",M,[T(i,{icon:"apps",color:"grey-3","text-color":"grey-9"},{default:P(()=>[R(z(re.value.summary.total_empty)+" empty slots ",1)]),_:1}),T(i,{icon:"check_circle",color:"green-2","text-color":"green-9"},{default:P(()=>[R(z(re.value.summary.fillable)+" can fill without conflicts ",1)]),_:1}),re.value.summary.conflicts>0?(C(),V(i,{key:0,icon:"warning",color:"orange-2","text-color":"orange-9"},{default:P(()=>[R(z(re.value.summary.conflicts)+" have conflicts ",1)]),_:1})):N("",!0),re.value.summary.unfillable>0?(C(),V(i,{key:1,icon:"block",color:"red-2","text-color":"red-9"},{default:P(()=>[R(z(re.value.summary.unfillable)+" unfillable ",1)]),_:1})):N("",!0)]),re.value.summary.conflicts>0?(C(),V(n,{key:0,modelValue:ie.value,"onUpdate:modelValue":j[1]||(j[1]=e=>ie.value=e),label:"Force fill even with conflicts (teachers will be assigned to multiple classrooms)",class:"q-mb-md"},null,8,["modelValue"])):N("",!0),T(g,{modelValue:ne.value,"onUpdate:modelValue":j[2]||(j[2]=e=>ne.value=e),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"left"},{default:P(()=>[T(b,{name:"all",label:`All (${ce.value.length})`},null,8,["label"]),re.value.filled.length>0?(C(),V(b,{key:0,name:"clean",label:`Clean (${re.value.filled.length})`},null,8,["label"])):N("",!0),re.value.conflicts.length>0?(C(),V(b,{key:1,name:"conflicts",label:`Conflicts (${re.value.conflicts.length})`},null,8,["label"])):N("",!0),re.value.unfillable.length>0?(C(),V(b,{key:2,name:"unfillable",label:`Unfillable (${re.value.unfillable.length})`},null,8,["label"])):N("",!0)]),_:1},8,["modelValue"]),T(t,{class:"q-mb-md"}),T(x,{modelValue:ne.value,"onUpdate:modelValue":j[3]||(j[3]=e=>ne.value=e),animated:""},{default:P(()=>[T(k,{name:"all"},{default:P(()=>[T(h,{rows:ce.value,columns:pe,"row-key":"index",flat:"",bordered:"",dense:"","rows-per-page-options":[0]},{"body-cell-day":P(e=>[T(w,{props:e},{default:P(()=>[T(_,{color:be(e.row.day)},{default:P(()=>[R(z(ye(e.row.day)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-period":P(e=>[T(w,{props:e},{default:P(()=>[S("strong",null,"Period "+z(e.row.period),1)]),_:2},1032,["props"])]),"body-cell-status":P(e=>[T(w,{props:e},{default:P(()=>[e.row.has_conflict?(C(),V(o,{key:0,name:"warning",color:"orange",size:"sm"},{default:P(()=>[T(d,null,{default:P(()=>{var l;return[R(z(null==(l=e.row.conflict_details)?void 0:l.message),1)]}),_:2},1024)]),_:2},1024)):(C(),V(o,{key:1,name:"check_circle",color:"green",size:"sm"},{default:P(()=>[T(d,null,{default:P(()=>j[11]||(j[11]=[R("No conflicts")])),_:1})]),_:1}))]),_:2},1032,["props"])]),_:1},8,["rows"])]),_:1}),T(k,{name:"clean"},{default:P(()=>[T(h,{rows:re.value.filled,columns:pe,"row-key":"index",flat:"",bordered:"",dense:"","rows-per-page-options":[0]},{"body-cell-day":P(e=>[T(w,{props:e},{default:P(()=>[T(_,{color:be(e.row.day)},{default:P(()=>[R(z(ye(e.row.day)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-period":P(e=>[T(w,{props:e},{default:P(()=>[S("strong",null,"Period "+z(e.row.period),1)]),_:2},1032,["props"])]),"body-cell-status":P(e=>[T(w,{props:e},{default:P(()=>[T(o,{name:"check_circle",color:"green",size:"sm"},{default:P(()=>[T(d,null,{default:P(()=>j[12]||(j[12]=[R("No conflicts")])),_:1})]),_:1})]),_:2},1032,["props"])]),_:1},8,["rows"])]),_:1}),T(k,{name:"conflicts"},{default:P(()=>[T(h,{rows:re.value.conflicts,columns:fe,"row-key":"index",flat:"",bordered:"",dense:"","rows-per-page-options":[0]},{"body-cell-day":P(e=>[T(w,{props:e},{default:P(()=>[T(_,{color:be(e.row.day)},{default:P(()=>[R(z(ye(e.row.day)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-period":P(e=>[T(w,{props:e},{default:P(()=>[S("strong",null,"Period "+z(e.row.period),1)]),_:2},1032,["props"])]),"body-cell-conflict":P(e=>[T(w,{props:e},{default:P(()=>{var l,a;return[S("div",L,[T(o,{name:"warning",color:"orange",size:"xs",class:"q-mr-xs"}),R(" "+z(null==(l=e.row.conflict_details)?void 0:l.message),1)]),S("div",G," Busy in: "+z(null==(a=e.row.conflict_details)?void 0:a.busy_in_classroom),1)]}),_:2},1032,["props"])]),_:1},8,["rows"])]),_:1}),T(k,{name:"unfillable"},{default:P(()=>[T(h,{rows:re.value.unfillable,columns:ve,"row-key":"index",flat:"",bordered:"",dense:"","rows-per-page-options":[0]},{"body-cell-day":P(e=>[T(w,{props:e},{default:P(()=>[T(_,{color:be(e.row.day)},{default:P(()=>[R(z(ye(e.row.day)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-period":P(e=>[T(w,{props:e},{default:P(()=>[S("strong",null,"Period "+z(e.row.period),1)]),_:2},1032,["props"])]),_:1},8,["rows"])]),_:1})]),_:1},8,["modelValue"])])):N("",!0),S("div",O,[T(s,{flat:"",color:"primary",label:"Back",onClick:j[4]||(j[4]=e=>oe.value=1),class:"q-mr-sm"}),T(s,{color:"primary",label:"Next: Apply",onClick:j[5]||(j[5]=e=>oe.value=3),disable:0===ce.value.length},null,8,["disable"])])]),_:1},8,["done"]),T(y,{name:3,title:"Apply Changes",icon:"save"},{default:P(()=>[j[15]||(j[15]=S("div",{class:"text-body2 q-mb-md"}," Ready to apply the random fill assignments? ",-1)),T(r,{class:"bg-blue-1 q-mb-md"},{avatar:P(()=>[T(o,{name:"info",color:"blue"})]),default:P(()=>{var e;return[S("div",null,[S("strong",null,z(ce.value.length)+" assignments",1),j[14]||(j[14]=R(" will be created/updated in your timetable. ")),ie.value&&(null==(e=re.value)?void 0:e.summary.conflicts)>0?(C(),I("div",E,[T(o,{name:"warning",size:"xs",class:"q-mr-xs"}),R(" Force fill is enabled. "+z(re.value.summary.conflicts)+" conflicting assignments will be created. ",1)])):N("",!0)])]}),_:1}),S("div",H,[T(s,{flat:"",color:"primary",label:"Back",onClick:j[6]||(j[6]=e=>oe.value=2),class:"q-mr-sm",disable:de.value},null,8,["disable"]),T(s,{color:"positive",icon:"check",label:"Apply Random Fill",onClick:_e,loading:de.value},null,8,["loading"])]),ue.value?(C(),V(r,{key:0,class:U(["q-mt-md",ue.value.success?"bg-positive text-white":"bg-negative text-white"])},{avatar:P(()=>[T(o,{name:ue.value.success?"check_circle":"error",color:"white"},null,8,["name"])]),default:P(()=>[S("div",null,[S("div",J,z(ue.value.message),1),ue.value.summary?(C(),I("div",K,[ue.value.summary.created?(C(),I("div",W,"Created: "+z(ue.value.summary.created),1)):N("",!0),ue.value.summary.updated?(C(),I("div",Z,"Updated: "+z(ue.value.summary.updated),1)):N("",!0),ue.value.summary.skipped?(C(),I("div",X,"Skipped: "+z(ue.value.summary.skipped),1)):N("",!0)])):N("",!0)])]),_:1},8,["class"])):N("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),T(t),T(u,{align:"right"},{default:P(()=>[F(T(s,{flat:"",label:"Close",color:"primary"},null,512),[[p]])]),_:1})]),_:1})]),_:1},8,["model-value"]))}},[["__scopeId","data-v-7e512dc2"]]);export{Y as default};
