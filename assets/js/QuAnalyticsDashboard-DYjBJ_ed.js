import{Q as e}from"./QSpace-1_yTqfel.js";import{o as t,u as a,p as l,Q as s,c as o,m as r,f as i,d,aP as c,C as n,b as u}from"./app-Buylb2AA.js";import{Q as m}from"./QBadge-Dt5ch-CZ.js";import{Q as p}from"./QTd-B6OVqMbX.js";import{Q as f}from"./QTable-BmRSX4cl.js";import{Q as v,a as g}from"./QToolbar-BC_oHanJ.js";import{Q as x}from"./QSpinnerDots-DjseaGnd.js";import{f as b,a as _,L as y,I as h,b as w,M as j,y as q,a3 as A,J as Q,V as S,U as k,H as P,O as E,x as T,F as V,Z as D}from"./vendor-CUZ9QTQV.js";import{s as C}from"./i18n-CP46N9fu.js";import{u as L,E as M,i as z,a as O,b as R,c as B,d as U,e as F,f as G}from"./install-4Psh_o8-.js";import"./offline-BzIlwqNM.js";import"./ui-LrZmvB2D.js";import"./QMarkupTable-Cd9X66xB.js";import"./QSelect-CcTxzM62.js";import"./rtl-Cr6c3OOr.js";import"./QLinearProgress-B7jHdoB9.js";import"./use-fullscreen-DO2N8akv.js";const I={class:"q-pa-md"},H={class:"row items-center q-mb-md"},J={class:"row q-col-gutter-md q-mb-lg"},Z={class:"col-12 col-sm-6 col-md-3"},K={class:"text-h4 text-weight-bold"},N={class:"col-12 col-sm-6 col-md-3"},W={class:"text-h4 text-weight-bold"},X={class:"col-12 col-sm-6 col-md-3"},Y={class:"text-h4 text-weight-bold"},$={class:"col-12 col-sm-6 col-md-3"},ee={class:"text-h4 text-weight-bold"},te={class:"text-caption q-ml-xs text-grey"},ae={class:"row justify-center q-py-xl"},le={class:"row q-col-gutter-md q-mb-lg"},se={class:"col-6 col-md-3"},oe={class:"text-h5 text-weight-bold"},re={class:"col-6 col-md-3"},ie={class:"text-h5 text-weight-bold text-primary"},de={class:"col-6 col-md-3"},ce={class:"text-h5 text-weight-bold text-indigo"},ne={class:"col-6 col-md-3"},ue={class:"text-h5 text-weight-bold text-green"},me={class:"row q-col-gutter-md"},pe={class:"col-12 col-md-6"},fe={class:"col-12 col-md-6"},ve={class:"q-mt-md"},ge={style:{"max-width":"400px","white-space":"normal",overflow:"hidden","text-overflow":"ellipsis"}},xe=t({__name:"QuAnalyticsDashboard",props:{exams:Array},setup(t){L([z,O,R,B,U,F,G]);const xe=t,be=a(),_e=b(""),ye=b(!1),he=b(null),we=b(!1),je=b(null),qe=_(()=>xe.exams.reduce((e,t)=>e+t.attempts_count,0)),Ae=_(()=>xe.exams.reduce((e,t)=>e+t.pending_grading,0)),Qe=_(()=>{const e=xe.exams.filter(e=>e.completed_attempts>0);if(0===e.length)return 0;const t=e.reduce((e,t)=>e+t.average_score/t.total_marks*100,0);return Math.round(t/e.length)}),Se=[{name:"title",required:!0,label:"Exam Title",align:"left",field:"title",sortable:!0},{name:"created_at",label:"Date",field:"created_at",sortable:!0},{name:"completed_attempts",label:"Attempts",field:"completed_attempts",sortable:!0},{name:"average_score",label:"Avg Score",field:"average_score",sortable:!0},{name:"pending_grading",label:"Pending Grading",field:"pending_grading",sortable:!0,classes:e=>e.pending_grading>0?"text-negative text-weight-bold":""},{name:"actions",label:"Actions",field:"actions",align:"right"}],ke=[{name:"text",label:"Question",field:"text",align:"left"},{name:"type",label:"Type",field:"type",align:"left"},{name:"bloom_level",label:"Bloom Level",field:"bloom_level",align:"left",sortable:!0},{name:"difficulty_label",label:"Difficulty",field:"difficulty_label",align:"left",sortable:!0}],Pe=(e,t)=>{const a=e/t*100;return a>=80?"green":a>=60?"blue":a>=40?"orange":"red"},Ee=()=>{be.notify({type:"info",message:"Export coming soon"})},Te=_(()=>{if(!je.value)return{};const e=je.value.score_distribution;return{tooltip:{trigger:"axis"},xAxis:{type:"category",data:Object.keys(e),name:"Score Range"},yAxis:{type:"value",name:"Students"},series:[{data:Object.values(e),type:"bar",color:"#3f51b5"}]}}),Ve=_(()=>{if(!je.value)return{};const e=je.value.bloom_stats;return{tooltip:{trigger:"axis"},xAxis:{type:"category",data:e.map(e=>e.level),axisLabel:{interval:0,rotate:30}},yAxis:{type:"value",name:"Avg Score %",max:100},series:[{data:e.map(e=>e.avg_percentage),type:"bar",color:"#ff9800",label:{show:!0,position:"top",formatter:"{c}%"}}]}});return(a,b)=>(h(),y(V,null,[w(q(A),{title:"Exam Analytics"}),j("div",I,[j("div",H,[b[3]||(b[3]=j("div",{class:"text-h5"},"Exam Analytics",-1)),w(e),w(s,{color:"secondary",icon:"table_chart",label:"Export All",disable:"",outline:""},{default:Q(()=>[w(l,null,{default:Q(()=>b[2]||(b[2]=[S("Coming Soon")])),_:1})]),_:1})]),j("div",J,[j("div",Z,[w(r,{class:"bg-primary text-white"},{default:Q(()=>[w(o,null,{default:Q(()=>[b[4]||(b[4]=j("div",{class:"text-subtitle2"},"Total Exams",-1)),j("div",K,k(t.exams.length),1)]),_:1})]),_:1})]),j("div",N,[w(r,{class:"bg-teal text-white"},{default:Q(()=>[w(o,null,{default:Q(()=>[b[5]||(b[5]=j("div",{class:"text-subtitle2"},"Total Attempts",-1)),j("div",W,k(qe.value),1)]),_:1})]),_:1})]),j("div",X,[w(r,{class:"bg-orange text-white"},{default:Q(()=>[w(o,null,{default:Q(()=>[b[6]||(b[6]=j("div",{class:"text-subtitle2"},"Pending Grading",-1)),j("div",Y,k(Ae.value),1)]),_:1})]),_:1})]),j("div",$,[w(r,{class:"bg-indigo text-white"},{default:Q(()=>[w(o,null,{default:Q(()=>[b[7]||(b[7]=j("div",{class:"text-subtitle2"},"Avg Score",-1)),j("div",ee,k(Qe.value)+"%",1)]),_:1})]),_:1})])]),w(r,null,{default:Q(()=>[w(f,{title:"Exam Performance",rows:t.exams,columns:Se,"row-key":"id",filter:_e.value,pagination:{rowsPerPage:10}},{"top-right":Q(()=>[w(i,{borderless:"",dense:"",debounce:"300",modelValue:_e.value,"onUpdate:modelValue":b[0]||(b[0]=e=>_e.value=e),placeholder:"Search"},{append:Q(()=>[w(d,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-average_score":Q(e=>[w(p,{props:e},{default:Q(()=>[w(m,{color:Pe(e.value,e.row.total_marks)},{default:Q(()=>[S(k(e.value)+" / "+k(e.row.total_marks),1)]),_:2},1032,["color"]),j("span",te," ("+k(Math.round(e.value/e.row.total_marks*100))+"%) ",1)]),_:2},1032,["props"])]),"body-cell-actions":Q(e=>[w(p,{props:e,align:"right"},{default:Q(()=>[w(s,{flat:"",round:"",color:"primary",icon:"analytics",onClick:t=>(async e=>{he.value=e,ye.value=!0,we.value=!0,je.value=null;try{const t=await D.get(C("qu-analytics.exam",e.id));je.value=t.data}catch(t){console.error(t),be.notify({type:"negative",message:"Failed to load analytics data"})}finally{we.value=!1}})(e.row)},{default:Q(()=>[w(l,null,{default:Q(()=>b[8]||(b[8]=[S("View Detailed Analytics")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","filter"])]),_:1}),w(u,{modelValue:ye.value,"onUpdate:modelValue":b[1]||(b[1]=e=>ye.value=e),maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:Q(()=>[w(r,{class:"bg-grey-1"},{default:Q(()=>[w(v,{class:"bg-primary text-white"},{default:Q(()=>[T(w(s,{flat:"",round:"",dense:"",icon:"close"},null,512),[[c]]),w(g,null,{default:Q(()=>{var e;return[S(" Analytics: "+k(null==(e=he.value)?void 0:e.title),1)]}),_:1}),w(s,{flat:"",icon:"download",label:"Export Report",onClick:Ee,disable:""})]),_:1}),we.value?(h(),P(o,{key:0,class:"q-pa-md"},{default:Q(()=>[j("div",ae,[w(x,{color:"primary",size:"3em"}),b[9]||(b[9]=j("div",{class:"text-grey q-mt-md"},"Loading analytics data...",-1))])]),_:1})):je.value?(h(),P(o,{key:1,class:"q-pa-md"},{default:Q(()=>[j("div",le,[j("div",se,[w(r,{flat:"",bordered:"",class:"text-center q-pa-sm"},{default:Q(()=>[b[10]||(b[10]=j("div",{class:"text-caption text-grey"},"Attempts",-1)),j("div",oe,k(je.value.overview.total_attempts),1)]),_:1})]),j("div",re,[w(r,{flat:"",bordered:"",class:"text-center q-pa-sm"},{default:Q(()=>[b[11]||(b[11]=j("div",{class:"text-caption text-grey"},"Average Score",-1)),j("div",ie,k(je.value.overview.avg_score),1)]),_:1})]),j("div",de,[w(r,{flat:"",bordered:"",class:"text-center q-pa-sm"},{default:Q(()=>[b[12]||(b[12]=j("div",{class:"text-caption text-grey"},"Median Score",-1)),j("div",ce,k(je.value.overview.median_score),1)]),_:1})]),j("div",ne,[w(r,{flat:"",bordered:"",class:"text-center q-pa-sm"},{default:Q(()=>[b[13]||(b[13]=j("div",{class:"text-caption text-grey"},"Pass Rate",-1)),j("div",ue,k(je.value.overview.pass_rate)+"%",1)]),_:1})])]),j("div",me,[j("div",pe,[w(r,{flat:"",bordered:"",class:"full-height"},{default:Q(()=>[w(o,null,{default:Q(()=>b[14]||(b[14]=[j("div",{class:"text-h6"},"Score Distribution",-1)])),_:1}),w(o,{style:{height:"300px"}},{default:Q(()=>[w(q(M),{class:"chart",option:Te.value,autoresize:""},null,8,["option"])]),_:1})]),_:1})]),j("div",fe,[w(r,{flat:"",bordered:"",class:"full-height"},{default:Q(()=>[w(o,null,{default:Q(()=>b[15]||(b[15]=[j("div",{class:"text-h6"},"Bloom's Taxonomy Performance",-1)])),_:1}),w(o,{style:{height:"300px"}},{default:Q(()=>[w(q(M),{class:"chart",option:Ve.value,autoresize:""},null,8,["option"])]),_:1})]),_:1})])]),j("div",ve,[w(r,{flat:"",bordered:""},{default:Q(()=>[w(o,null,{default:Q(()=>b[16]||(b[16]=[j("div",{class:"text-h6"},"Question Difficulty Analysis",-1)])),_:1}),w(f,{rows:je.value.question_stats,columns:ke,"row-key":"id",pagination:{rowsPerPage:10},dense:""},{"body-cell-difficulty_label":Q(e=>[w(p,{props:e},{default:Q(()=>{return[w(n,{dense:"",color:(t=e.row.percentage_correct,t>=80?"green":t>=50?"orange":"red"),"text-color":"white"},{default:Q(()=>[S(k(e.value)+" ("+k(e.row.percentage_correct)+"%) ",1)]),_:2},1032,["color"])];var t}),_:2},1032,["props"])]),"body-cell-text":Q(e=>[w(p,{props:e},{default:Q(()=>[j("div",ge,k(e.value),1)]),_:2},1032,["props"])]),_:1},8,["rows"])]),_:1})])]),_:1})):E("",!0)]),_:1})]),_:1},8,["modelValue"])])],64))}},[["__scopeId","data-v-c8321de5"]]);export{xe as default};
