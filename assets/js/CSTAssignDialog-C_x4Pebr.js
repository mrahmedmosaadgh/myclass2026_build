import{I as e,Y as a,Z as l,X as t,f as s,Q as o,b as i,G as n,c as u,g as d,j as r,k as c,s as p,l as m,h as _,o as b,d as y,e as g,aS as v}from"./app-4gpSDtVV.js";import{Q as h}from"./QSpace-BaiVAeLS.js";import{p as f,a as j,h as S,f as x,k as V,I as k,J as q,K as w,b as Q,O as A,R as T,y as B,W as C,V as O,m as $,S as z,U as N}from"./vendor-BWKGNkNB.js";import{Q as U}from"./QSelect-Dgk9Cshp.js";import{Q as R}from"./QForm-B3HUaoek.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";const I=["text","rect","circle","QBtn","QBadge","QChip","QToolbar","QCheckbox","QRadio","QToggle","QSlider","QRange","QInput","QAvatar"],D=["wave","pulse","pulse-x","pulse-y","fade","blink","none"],F=e({name:"QSkeleton",props:{...a,tag:{type:String,default:"div"},type:{type:String,validator:e=>I.includes(e),default:"rect"},animation:{type:String,validator:e=>D.includes(e),default:"wave"},animationSpeed:{type:[String,Number],default:1500},square:Boolean,bordered:Boolean,size:String,width:String,height:String},setup(e,{slots:a}){const s=f(),o=l(e,s.proxy.$q),i=j(()=>{const a=void 0!==e.size?[e.size,e.size]:[e.width,e.height];return{"--q-skeleton-speed":`${e.animationSpeed}ms`,width:a[0],height:a[1]}}),n=j(()=>`q-skeleton q-skeleton--${!0===o.value?"dark":"light"} q-skeleton--type-${e.type}`+("none"!==e.animation?` q-skeleton--anim q-skeleton--anim-${e.animation}`:"")+(!0===e.square?" q-skeleton--square":"")+(!0===e.bordered?" q-skeleton--bordered":""));return()=>S(e.tag,{class:n.value,style:i.value},t(a.default))}}),P={class:"text-h6"},W={class:"row q-gutter-sm text-caption text-grey-7"},G={class:"text-weight-medium"},J={__name:"CSTAssignDialog",props:{modelValue:{type:Boolean,default:!1},schedule:{type:Object,default:null},day:{type:Number,default:null},period:{type:Number,default:null},classroomName:{type:String,default:""},cstOptions:{type:Array,default:()=>[]},teachers:{type:Array,default:()=>[]},subjects:{type:Array,default:()=>[]},loadingCST:{type:Boolean,default:!1},loadingTeachers:{type:Boolean,default:!1},loadingSubjects:{type:Boolean,default:!1},saving:{type:Boolean,default:!1},slotAvailability:{type:Object,default:null},loadingAvailability:{type:Boolean,default:!1}},emits:["update:modelValue","submit","filter-cst"],setup(e,{emit:a}){const l=e,t=a,f=j({get:()=>l.modelValue,set:e=>t("update:modelValue",e)}),S=["","Sunday","Monday","Tuesday","Wednesday","Thursday"],I=j(()=>S[l.day]||"Day"),D=j(()=>{if(!l.slotAvailability)return l.cstOptions.map(e=>({...e,is_busy:!1,busy_info:null,display_label:`${e.subject_name} - ${e.teacher_name}`}));const e=l.slotAvailability.busy_teachers||{};return l.cstOptions.map(a=>{const l=e[a.teacher_id],t=!!l&&!l.is_current_classroom;return{...a,is_busy:t,busy_info:l,display_label:t?`${a.subject_name} - ${a.teacher_name} ⚠️`:`${a.subject_name} - ${a.teacher_name}`}})}),J=j(()=>{if(!l.slotAvailability)return 0;const e=l.slotAvailability.busy_teachers||{};return Object.values(e).filter(e=>!e.is_current_classroom).length}),K=x({cst_id:null,teacher_substitute_id:null,co_teacher_id:null,co_subject_id:null,place:"",notes:""});V(()=>l.schedule,e=>{K.value=e?{cst_id:e.cst_id,teacher_substitute_id:e.teacher_substitute_id,co_teacher_id:e.co_teacher_id,co_subject_id:e.co_subject_id,place:e.place||"",notes:e.notes||""}:{cst_id:null,teacher_substitute_id:null,co_teacher_id:null,co_subject_id:null,place:"",notes:""}},{immediate:!0}),V(f,e=>{e||(K.value={cst_id:null,teacher_substitute_id:null,co_teacher_id:null,co_subject_id:null,place:"",notes:""})});const L=(e,a,l)=>{t("filter-cst",e),a()},M=()=>{var e;t("submit",{...K.value,schedule_id:null==(e=l.schedule)?void 0:e.id,day:l.day,period:l.period})};return(a,l)=>(q(),k(g,{modelValue:f.value,"onUpdate:modelValue":l[6]||(l[6]=e=>f.value=e),persistent:""},{default:w(()=>[Q(y,{style:{"min-width":"450px","max-width":"550px"}},{default:w(()=>[Q(s,{class:"row items-center q-pb-none"},{default:w(()=>[T("div",P,[Q(o,{name:"assignment",class:"q-mr-sm",color:"primary"}),l[7]||(l[7]=C(" Assign Subject & Teacher "))]),Q(h),B(Q(i,{icon:"close",flat:"",round:"",dense:""},null,512),[[v]])]),_:1}),Q(s,{class:"q-pt-sm"},{default:w(()=>[T("div",W,[Q(n,{dense:"",icon:"calendar_today",size:"sm"},{default:w(()=>[C(O(I.value)+" - Period "+O(e.period),1)]),_:1}),e.classroomName?(q(),k(n,{key:0,dense:"",icon:"meeting_room",size:"sm"},{default:w(()=>[C(O(e.classroomName),1)]),_:1})):A("",!0)])]),_:1}),Q(u),e.loadingAvailability?(q(),k(s,{key:0,class:"q-py-sm"},{default:w(()=>[Q(F,{type:"text",width:"60%"})]),_:1})):J.value>0?(q(),k(s,{key:1,class:"q-py-sm"},{default:w(()=>[Q(d,{dense:"",rounded:"",class:"bg-orange-1 text-orange-9"},{avatar:w(()=>[Q(o,{name:"warning",color:"orange"})]),default:w(()=>[T("span",G,O(J.value)+" teacher(s)",1),l[8]||(l[8]=C(" already assigned at this time slot in other classrooms. ")),l[9]||(l[9]=T("div",{class:"text-caption q-mt-xs"}," They are marked with ⚠️ in the dropdown below. ",-1))]),_:1})]),_:1})):A("",!0),Q(s,null,{default:w(()=>[Q(R,{class:"q-gutter-md"},{default:w(()=>[Q(U,{modelValue:K.value.cst_id,"onUpdate:modelValue":l[0]||(l[0]=e=>K.value.cst_id=e),options:D.value,"option-value":"id","option-label":"display_label",label:"Subject & Teacher *",outlined:"",dense:"","emit-value":"","map-options":"",clearable:"","use-input":"","input-debounce":"300",onFilter:L,loading:e.loadingCST||e.loadingAvailability},{prepend:w(()=>[Q(o,{name:"menu_book",color:"primary"})]),option:w(({opt:e,itemProps:a})=>[Q(r,$(a,{class:{"bg-orange-1":e.is_busy}}),{default:w(()=>[Q(c,{avatar:""},{default:w(()=>[Q(p,{style:z({backgroundColor:e.c_bg||"#e0e0e0",color:e.c_text||"#333"}),size:"32px"},{default:w(()=>{var a;return[C(O((null==(a=e.subject_name)?void 0:a.charAt(0))||"S"),1)]}),_:2},1032,["style"])]),_:2},1024),Q(c,null,{default:w(()=>[Q(m,{class:N({"text-orange-9":e.is_busy})},{default:w(()=>[C(O(e.subject_name)+" ",1),e.is_busy?(q(),k(o,{key:0,name:"warning",color:"orange",size:"xs",class:"q-ml-xs"})):A("",!0)]),_:2},1032,["class"]),Q(m,{caption:"",class:N({"text-orange-7":e.is_busy})},{default:w(()=>[C(O(e.teacher_name),1)]),_:2},1032,["class"]),e.is_busy?(q(),k(m,{key:0,caption:"",class:"text-orange-8"},{default:w(()=>{var a,l;return[Q(o,{name:"info",size:"xs",class:"q-mr-xs"}),C(" Busy in "+O(null==(a=e.busy_info)?void 0:a.assigned_to_classroom)+" ("+O(null==(l=e.busy_info)?void 0:l.subject)+") ",1)]}),_:2},1024)):A("",!0)]),_:2},1024)]),_:2},1040,["class"])]),"no-option":w(()=>[Q(r,null,{default:w(()=>[Q(c,{class:"text-grey"},{default:w(()=>l[10]||(l[10]=[C("No options available")])),_:1})]),_:1})]),_:1},8,["modelValue","options","loading"]),Q(U,{modelValue:K.value.teacher_substitute_id,"onUpdate:modelValue":l[1]||(l[1]=e=>K.value.teacher_substitute_id=e),options:e.teachers,"option-value":"id","option-label":"name",label:"Substitute Teacher (Optional)",outlined:"",dense:"","emit-value":"","map-options":"",clearable:"",loading:e.loadingTeachers},{prepend:w(()=>[Q(o,{name:"swap_horiz",color:"orange"})]),_:1},8,["modelValue","options","loading"]),Q(U,{modelValue:K.value.co_teacher_id,"onUpdate:modelValue":l[2]||(l[2]=e=>K.value.co_teacher_id=e),options:e.teachers,"option-value":"id","option-label":"name",label:"Co-Teacher (Optional)",outlined:"",dense:"","emit-value":"","map-options":"",clearable:"",loading:e.loadingTeachers},{prepend:w(()=>[Q(o,{name:"group",color:"blue"})]),_:1},8,["modelValue","options","loading"]),Q(U,{modelValue:K.value.co_subject_id,"onUpdate:modelValue":l[3]||(l[3]=e=>K.value.co_subject_id=e),options:e.subjects,"option-value":"id","option-label":"name",label:"Co-Subject (Optional)",outlined:"",dense:"","emit-value":"","map-options":"",clearable:"",loading:e.loadingSubjects},{prepend:w(()=>[Q(o,{name:"library_books",color:"teal"})]),_:1},8,["modelValue","options","loading"]),Q(_,{modelValue:K.value.place,"onUpdate:modelValue":l[4]||(l[4]=e=>K.value.place=e),label:"Location/Room (Optional)",outlined:"",dense:""},{prepend:w(()=>[Q(o,{name:"place"})]),_:1},8,["modelValue"]),Q(_,{modelValue:K.value.notes,"onUpdate:modelValue":l[5]||(l[5]=e=>K.value.notes=e),label:"Notes",outlined:"",dense:"",type:"textarea",rows:"2"},{prepend:w(()=>[Q(o,{name:"note"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),Q(u),Q(b,{align:"right",class:"q-pa-md"},{default:w(()=>[B(Q(i,{flat:"",label:"Cancel",color:"grey"},null,512),[[v]]),Q(i,{label:"Save Assignment",color:"primary",loading:e.saving,onClick:M},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{J as default};
