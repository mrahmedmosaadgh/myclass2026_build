import{o as e,u as l,d as a,Q as o,f as s,m as t,c as r,l as n,aP as d,b as i}from"./app-ggGwxJON.js";import{Q as u}from"./QTd-D6gdMIVj.js";import{Q as c}from"./QSelect-DOo83gJW.js";import{Q as v}from"./QTable-D7jFdT1k.js";import{f as p,a as m,k as f,N as b,Q as y,J as g,b as h,K as w,O as _,F as C,z as k,V as j,W as V,y as q,_ as P}from"./vendor-nQjeLEvd.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";import"./rtl-Cr6c3OOr.js";import"./QMarkupTable-BbwJTHXP.js";import"./QLinearProgress-DJHuJoTJ.js";import"./use-fullscreen-DuZ9ifcT.js";const Q={key:0,class:"mt-4"},S={class:"row full-width q-col-gutter-md"},I={class:"col-12 col-md-6"},x={class:"col-12 col-md-6 flex justify-end items-center"},U={class:"edit-actions q-mt-sm"},L=["onClick"],T={class:"edit-actions q-mt-sm"},$=["onClick"],A={class:"full-width row flex-center q-gutter-sm"},D={class:"text-negative"},E=e({__name:"Schedule_display",props:{schoolId:{type:Number,required:!0},scheduleCopyId:{type:Number,required:!0}},setup(e){const E=l(),F=e,N=[{name:"id",label:"ID",field:"id",align:"left",sortable:!0},{name:"classroom",label:"Classroom",field:e=>{var l,a;return null==(a=null==(l=e.cst)?void 0:l.classroom)?void 0:a.name},align:"left",sortable:!0},{name:"subject",label:"Subject",field:e=>{var l,a;return null==(a=null==(l=e.cst)?void 0:l.subject)?void 0:a.name},align:"left",sortable:!0},{name:"teacher",label:"Teacher",field:e=>{var l,a;return null==(a=null==(l=e.cst)?void 0:l.teacher)?void 0:a.name},align:"left",sortable:!0},{name:"period_number",label:"Period",field:"period_number",align:"center",sortable:!0},{name:"day",label:"Day",field:"day",align:"center",sortable:!0},{name:"active",label:"Active",field:"active",align:"center",sortable:!0}],B=p({sortBy:"period_number",descending:!1,page:1,rowsPerPage:10}),z=p(F.schoolId),K=p([]),M=p(!1),O=p(!1),R=p(""),W=p(""),J=p(null),G=p(""),H=p(""),X=p(!1),Y=p(null),Z=e=>["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"][e-1]||`Day ${e}`,ee=Array.from({length:10},(e,l)=>({label:`Period ${l+1}`,value:l+1})),le=Array.from({length:5},(e,l)=>({label:Z(l+1),value:l+1})),ae=(e,l,a)=>{J.value=e,G.value=l,H.value=a},oe=()=>{J.value=null,G.value=""},se=e=>{Y.value=e,X.value=!0},te=async e=>{var l,a;try{M.value=!0,await P.post(`/admin/schedules/update/${e.id}`,{[G.value]:H.value}),e[G.value]=H.value,E.notify({type:"positive",message:"Schedule updated successfully"})}catch(o){E.notify({type:"negative",message:(null==(a=null==(l=o.response)?void 0:l.data)?void 0:a.message)||"Failed to update schedule"}),console.error("Error updating schedule:",o)}finally{J.value=null,G.value="",X.value=!1,M.value=!1}},re=m(()=>{let e=[...K.value];if(W.value){const l=W.value.toLowerCase();e=e.filter(e=>{var a,o,s,t,r,n;return((null==(o=null==(a=e.cst)?void 0:a.classroom)?void 0:o.name)||"").toLowerCase().includes(l)||((null==(t=null==(s=e.cst)?void 0:s.subject)?void 0:t.name)||"").toLowerCase().includes(l)||((null==(n=null==(r=e.cst)?void 0:r.teacher)?void 0:n.name)||"").toLowerCase().includes(l)||String(e.period_number).includes(l)||Z(e.day).toLowerCase().includes(l)})}return e}),ne=async()=>{var e,l;try{M.value=!0;const e=await P.get(`/admin/schedules/${F.schoolId}/${F.scheduleCopyId}`);K.value=e.data}catch(a){R.value=(null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||"Failed to fetch schedule data",O.value=!0,console.error("Error fetching schedule data:",a)}finally{M.value=!1}},de=()=>{B.value.page=1},ie=e=>{B.value.page=e.pagination.page,B.value.rowsPerPage=e.pagination.rowsPerPage,B.value.sortBy=e.pagination.sortBy,B.value.descending=e.pagination.descending};return f(()=>F.scheduleCopyId,ne,{immediate:!0}),(l,p)=>z.value&&e.scheduleCopyId?(g(),b("div",Q,[h(v,{title:"Schedule Entries",rows:re.value,columns:N,"row-key":"id",loading:M.value,pagination:B.value,"rows-per-page-options":[10,20,50],flat:"",bordered:"",dense:"",onRequest:ie},{top:w(()=>[_("div",S,[_("div",I,[h(s,{modelValue:W.value,"onUpdate:modelValue":[p[0]||(p[0]=e=>W.value=e),de],dense:"",outlined:"",placeholder:"Search...",class:"q-mb-md"},{append:w(()=>[h(a,{name:"search"})]),_:1},8,["modelValue"])]),_("div",x,[h(o,{color:"primary",icon:"refresh",onClick:ne,loading:M.value,label:"Refresh",class:"q-ml-md"},null,8,["loading"])])])]),"body-cell-classroom":w(e=>[h(u,{props:e},{default:w(()=>{var l,a;return[V(j((null==(a=null==(l=e.row.cst)?void 0:l.classroom)?void 0:a.name)||"-"),1)]}),_:2},1032,["props"])]),"body-cell-subject":w(e=>[h(u,{props:e},{default:w(()=>{var l,a;return[V(j((null==(a=null==(l=e.row.cst)?void 0:l.subject)?void 0:a.name)||"-"),1)]}),_:2},1032,["props"])]),"body-cell-teacher":w(e=>[h(u,{props:e},{default:w(()=>{var l,a;return[V(j((null==(a=null==(l=e.row.cst)?void 0:l.teacher)?void 0:a.name)||"-"),1)]}),_:2},1032,["props"])]),"body-cell-period_number":w(e=>[h(u,{props:e,class:"editable-cell"},{default:w(()=>[J.value===e.row.id&&"period_number"===G.value?(g(),b(C,{key:0},[h(c,{modelValue:H.value,"onUpdate:modelValue":[p[1]||(p[1]=e=>H.value=e),l=>se(e.row)],options:k(ee),"option-value":"value","option-label":"label","emit-value":"","map-options":"",dense:"",outlined:"",class:"edit-select",rules:[e=>!!e||"Period is required"]},null,8,["modelValue","options","onUpdate:modelValue","rules"]),_("div",U,[h(o,{flat:"",dense:"",color:"positive",icon:"check",onClick:l=>te(e.row)},null,8,["onClick"]),h(o,{flat:"",dense:"",color:"negative",icon:"close",onClick:oe})])],64)):(g(),b("div",{key:1,class:"editable-content",onClick:l=>ae(e.row.id,"period_number",e.row.period_number)},j(e.row.period_number),9,L))]),_:2},1032,["props"])]),"body-cell-day":w(e=>[h(u,{props:e,class:"editable-cell"},{default:w(()=>[J.value===e.row.id&&"day"===G.value?(g(),b(C,{key:0},[h(c,{modelValue:H.value,"onUpdate:modelValue":[p[2]||(p[2]=e=>H.value=e),l=>se(e.row)],options:k(le),"option-value":"value","option-label":"label","emit-value":"","map-options":"",dense:"",outlined:"",class:"edit-select",rules:[e=>!!e||"Day is required"]},null,8,["modelValue","options","onUpdate:modelValue","rules"]),_("div",T,[h(o,{flat:"",dense:"",color:"positive",icon:"check",onClick:l=>te(e.row)},null,8,["onClick"]),h(o,{flat:"",dense:"",color:"negative",icon:"close",onClick:oe})])],64)):(g(),b("div",{key:1,class:"editable-content",onClick:l=>ae(e.row.id,"day",e.row.day)},j(Z(e.row.day)),9,$))]),_:2},1032,["props"])]),"body-cell-active":w(e=>[h(u,{props:e},{default:w(()=>[h(a,{name:e.row.active?"check_circle":"cancel",color:e.row.active?"positive":"negative"},null,8,["name","color"])]),_:2},1032,["props"])]),"no-data":w(()=>[_("div",A,[h(a,{size:"2em",name:"sentiment_dissatisfied"}),p[6]||(p[6]=_("span",null,"No matching records found",-1))])]),_:1},8,["rows","loading","pagination"]),h(i,{modelValue:O.value,"onUpdate:modelValue":p[3]||(p[3]=e=>O.value=e)},{default:w(()=>[h(t,null,{default:w(()=>[h(r,null,{default:w(()=>[p[7]||(p[7]=_("div",{class:"text-h6"},"Error",-1)),_("div",D,j(R.value),1)]),_:1}),h(n,{align:"right"},{default:w(()=>[q(h(o,{flat:"",label:"OK",color:"primary"},null,512),[[d]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),h(i,{modelValue:X.value,"onUpdate:modelValue":p[5]||(p[5]=e=>X.value=e)},{default:w(()=>[h(t,null,{default:w(()=>[h(r,null,{default:w(()=>p[8]||(p[8]=[_("div",{class:"text-h6"},"Confirm Changes",-1),_("div",{class:"text-body1"},"Are you sure you want to save the changes?",-1)])),_:1}),h(n,{align:"right"},{default:w(()=>[q(h(o,{flat:"",label:"Cancel",color:"negative"},null,512),[[d]]),h(o,{flat:"",label:"Save",color:"positive",onClick:p[4]||(p[4]=e=>te(Y.value))})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):y("",!0)}},[["__scopeId","data-v-1b4c281b"]]);export{E as default};
