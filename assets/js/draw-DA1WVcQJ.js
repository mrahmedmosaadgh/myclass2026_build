import{d as e,f as t,o as a,e as o,M as l,J as n,N as i,Q as r,U as s,W as u,y as c,V as d,ac as v}from"./vendor-DuKqz2x4.js";import{o as h}from"./app-B77gjd5a.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";const p={class:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 p-4"},g={class:"max-w-5xl mx-auto"},x={class:"bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl p-6 mb-8 border border-white/30"},f={class:"flex flex-wrap gap-4 justify-center items-center text-sm"},w={class:"flex rounded-xl overflow-hidden shadow-lg"},m={class:"flex items-center gap-6"},b={class:"flex items-center gap-3"},y={class:"font-bold text-lg w-12 text-right"},k={class:"flex gap-3"},R=["disabled"],P=["disabled"],C={class:"flex gap-3"},j={class:"bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-xl shadow-lg cursor-pointer transition"},L={class:"bg-white/90 backdrop-blur-xl rounded-3xl shadow-2xl overflow-hidden border border-white/40"},B={key:0,class:"fixed inset-0 pointer-events-none flex items-end justify-center pb-12 z-50"},U={class:"bg-black/90 text-white px-10 py-5 rounded-full text-2xl font-bold shadow-2xl animate-pulse"},I=h(e({__name:"draw",setup(e){const h=t(null);let I=null;const O=t("pen"),S=t("#8B5CF6"),M=t(6),E=t(!1),T=t(!1),D=t(0),z=t(null),A=t([]),V=t([]),J=t(-1);function N(){if(!h.value||!I)return;const e=h.value.getBoundingClientRect();h.value.width=e.width*devicePixelRatio,h.value.height=e.height*devicePixelRatio,I.scale(devicePixelRatio,devicePixelRatio),$()}function F(e){if(!h.value)return{x:0,y:0};const t=h.value.getBoundingClientRect();return{x:(e.clientX-t.left)*devicePixelRatio,y:(e.clientY-t.top)*devicePixelRatio}}function _(e){if(T.value||!I)return;E.value=!0;const t=F(e);A.value.push({tool:O.value,color:"pen"===O.value?S.value:null,width:M.value,path:[t]}),I.beginPath(),I.moveTo(t.x/devicePixelRatio,t.y/devicePixelRatio),G()}function H(e){if(!E.value||!I||!A.value.length)return;const t=F(e);A.value[A.value.length-1].path.push(t),I.lineTo(t.x/devicePixelRatio,t.y/devicePixelRatio),I.stroke()}function W(){E.value&&(E.value=!1,q())}function G(e){if(!I)return;const t=e||{tool:O.value,color:S.value,width:M.value};"eraser"===t.tool?I.globalCompositeOperation="destination-out":(I.globalCompositeOperation="source-over",I.strokeStyle=t.color,I.lineWidth=t.width)}function q(){if(!I||!h.value)return;const e=I.getImageData(0,0,h.value.width,h.value.height);V.value=V.value.slice(0,J.value+1),V.value.push(e),J.value=V.value.length-1}function Q(){J.value<=0||(J.value--,I&&h.value&&I.putImageData(V.value[J.value],0,0))}function X(){I&&h.value&&(I.clearRect(0,0,h.value.width,h.value.height),A.value=[],z.value=null,V.value=[],J.value=-1,q())}function Y(){z.value=null,$()}function $(){if(I&&h.value)if(I.clearRect(0,0,h.value.width,h.value.height),z.value){const e=new Image;e.onload=()=>{I.drawImage(e,0,0,h.value.width/devicePixelRatio,h.value.height/devicePixelRatio),K()},e.src=z.value}else K()}function K(){A.value.forEach(e=>{if(!(e.path.length<2)){I.beginPath(),I.moveTo(e.path[0].x/devicePixelRatio,e.path[0].y/devicePixelRatio),G(e);for(let t=1;t<e.path.length;t++)I.lineTo(e.path[t].x/devicePixelRatio,e.path[t].y/devicePixelRatio);I.stroke()}})}async function Z(){if(!A.value.length||!I||!h.value)return;if(T.value=!0,D.value=0,I.clearRect(0,0,h.value.width,h.value.height),z.value){const e=new Image;e.src=z.value,await new Promise(t=>e.onload=t),I.drawImage(e,0,0,h.value.width/devicePixelRatio,h.value.height/devicePixelRatio)}let e=A.value.reduce((e,t)=>e+t.path.length,0),t=0;for(const a of A.value)if(!(a.path.length<2)){I.beginPath(),I.moveTo(a.path[0].x/devicePixelRatio,a.path[0].y/devicePixelRatio),G(a);for(let o=1;o<a.path.length;o++)I.lineTo(a.path[o].x/devicePixelRatio,a.path[o].y/devicePixelRatio),I.stroke(),t++,D.value=t/e*100,await new Promise(requestAnimationFrame)}T.value=!1}function ee(e){const t=new Image;t.onload=()=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;e.getContext("2d").drawImage(t,0,0),z.value=e.toDataURL("image/png"),$()},t.onerror=()=>alert("Failed to load image"),t.src=e}async function te(){try{const e=await navigator.clipboard.read();for(const t of e){const e=t.types.find(e=>e.startsWith("image/"));if(e){const a=await t.getType(e);return void ee(URL.createObjectURL(a))}}alert("No image found in clipboard")}catch(e){alert("Clipboard access denied – copy an image first!")}}function ae(e){var t;if(T.value)return;const a=null==(t=e.clipboardData)?void 0:t.items;if(a)for(const o of a)if(o.type.startsWith("image/")){e.preventDefault();const t=o.getAsFile();return void(t&&ee(URL.createObjectURL(t)))}}function oe(){const e={version:4,background:z.value,strokes:A.value,createdAt:(new Date).toISOString()},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),o=document.createElement("a");o.href=a,o.download=`magic-canvas-${(new Date).toISOString().slice(0,10)}.json`,o.click(),URL.revokeObjectURL(a)}function le(e){var t;const a=null==(t=e.target.files)?void 0:t[0];if(!a)return;const o=new FileReader;o.onload=()=>{try{const e=JSON.parse(o.result);z.value=e.background||null,A.value=e.strokes||[],$(),q()}catch(e){alert("Invalid file!")}},o.readAsText(a)}return a(()=>{!function(){if(!h.value)return;if(I=h.value.getContext("2d"),!I)return;I.lineCap="round",I.lineJoin="round",N(),q()}(),window.addEventListener("resize",N),window.addEventListener("paste",ae)}),o(()=>{window.removeEventListener("resize",N),window.removeEventListener("paste",ae)}),(e,t)=>(n(),l("div",p,[i("div",g,[t[10]||(t[10]=i("h1",{class:"text-center text-5xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2"}," ✨ Magic Canvas ✨ ",-1)),t[11]||(t[11]=i("p",{class:"text-center text-gray-600 mb-8"},"Draw • Erase • Replay • Paste Background • Save/Load",-1)),i("div",x,[i("div",f,[i("div",w,[i("button",{onClick:t[0]||(t[0]=e=>O.value="pen"),class:s(["pen"===O.value?"bg-gradient-to-r from-purple-500 to-pink-500 text-white":"bg-gray-100 text-gray-700","flex items-center gap-2 px-6 py-4 font-medium transition"])},t[4]||(t[4]=[i("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})],-1),u(" Pen ")]),2),i("button",{onClick:t[1]||(t[1]=e=>O.value="eraser"),class:s(["eraser"===O.value?"bg-gradient-to-r from-red-500 to-orange-500 text-white":"bg-gray-100 text-gray-700","flex items-center gap-2 px-6 py-4 font-medium transition"])},t[5]||(t[5]=[i("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"}),i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 7v4m0 4v.01"})],-1),u(" Eraser ")]),2)]),i("div",m,[c(i("input",{type:"color","onUpdate:modelValue":t[2]||(t[2]=e=>S.value=e),class:"w-14 h-14 rounded-full cursor-pointer shadow-xl hover:scale-110 transition",title:"Color"},null,512),[[v,S.value]]),i("div",b,[c(i("input",{type:"range","onUpdate:modelValue":t[3]||(t[3]=e=>M.value=e),min:"1",max:"50",class:"w-40 accent-purple-600"},null,512),[[v,M.value,void 0,{number:!0}]]),i("span",y,d(M.value),1)])]),i("div",k,[i("button",{onClick:X,class:"bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-xl shadow-lg transition"},"Clear All"),i("button",{onClick:Q,disabled:J.value<=0,class:"bg-gray-600 hover:bg-gray-700 disabled:opacity-40 text-white px-6 py-3 rounded-xl shadow-lg transition"},"Undo",8,R),i("button",{onClick:Z,disabled:0===A.value.length,class:"bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white px-6 py-3 rounded-xl shadow-lg transition flex items-center gap-2"},t[6]||(t[6]=[i("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.752 11.168l-6.718-3.873A1 1 0 007 8.135v7.73a1 1 0 001.034.968l6.718-3.873a1 1 0 000-1.792z"})],-1),u(" Replay ")]),8,P)]),i("div",C,[i("button",{onClick:te,class:"relative bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white px-6 py-3 rounded-xl shadow-lg transition flex items-center gap-2 overflow-hidden group"},t[7]||(t[7]=[i("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),u(" Paste BG "),i("span",{class:"absolute inset-0 bg-white/20 -translate-x-full group-hover:translate-x-0 transition-transform duration-500"},null,-1)])),z.value?(n(),l("button",{key:0,onClick:Y,class:"bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-xl shadow-lg transition flex items-center gap-2"},t[8]||(t[8]=[i("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),u(" Remove BG ")]))):r("",!0),i("button",{onClick:oe,class:"bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl shadow-lg transition"},"Save JSON"),i("label",j,[t[9]||(t[9]=u(" Load JSON ")),i("input",{type:"file",onChange:le,accept:".json",class:"hidden"},null,32)])])])]),i("div",L,[i("canvas",{ref_key:"canvas",ref:h,onPointerdown:_,onPointermove:H,onPointerup:W,onPointerleave:W,onPointercancel:W,class:s(["w-full block touch-none","eraser"===O.value?"cursor-eraser":"cursor-crosshair"]),style:{height:"calc(100vh - 280px)","min-height":"500px"}},null,34)]),T.value?(n(),l("div",B,[i("div",U," Replaying... "+d(Math.round(D.value))+"% ",1)])):r("",!0),t[12]||(t[12]=i("div",{class:"text-center mt-4 text-sm text-gray-500"},' Tip: Copy any image → Ctrl+V (or click "Paste BG") ',-1))])]))}}),[["__scopeId","data-v-520d9362"]]);export{I as default};
