import{p as e,u as t,Q as s,q as l,n as i,e as a,d as o,C as r,A as n,B as c,h as u,i as d,j as p,k as v,b as m}from"./app-BzjXrVp9.js";import{Q as f}from"./QSpinnerDots-CsCCDASU.js";import{Q as g}from"./QBadge-D2ciqrkO.js";import{Q as y}from"./QPage-DC7Lbtn5.js";import{Q as _}from"./QPageContainer--if2P0k6.js";import{Q as x}from"./QLayout-BkQn7DTH.js";import{f as h,a as b,k as w,o as q,H as k,I as j,J as z,b as P,M as Q,U as S,V as C,L as T,O as $,R as A,A as D,F as L,Q as E,Z as M}from"./vendor-EI0FRBVb.js";import{U as B}from"./QuestionSlide-CI00oUy6.js";import I from"./PlayerSidebar-DTCRvwxS.js";import O from"./SectionBanner-brdcxv_1.js";import F from"./SlideRenderer-8w63klYE.js";import N from"./NavigationFooter-uQOBQONt.js";import R from"./DrawingOverlay-CWYgKn3s.js";import V from"./SlideAnnotationOverlay-DjaS00m-.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./ui-B__oX9pK.js";import"./EnhancedQuestionEditor-z-4FgyOI.js";import"./QuestionEditor-B7HsQdH0.js";import"./RichTextEditor-CgI_Wije.js";import"./QColor-9nuGqmA9.js";import"./QSlider-Ca7ul8Gv.js";import"./QTabs-BwLFzVWR.js";import"./rtl-Cr6c3OOr.js";import"./QTab-Cx9aTRVb.js";import"./QTabPanels-C2OMgZHe.js";import"./use-panel-DdQZ_Vdk.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanel-BWvsj8on.js";import"./purify.es-C2Ba6vpb.js";import"./MathEditor-DTd-X9KR.js";import"./katex-BXKQVcz-.js";import"./MathPastePreview-D7IfRdxZ.js";import"./QSelect-CciNNEfD.js";import"./StepByStepEditor-CnjOsexu.js";import"./QuestionTypeSelector-BRH1uRly.js";import"./QuizEngine-DpGxhJ8D.js";import"./useQuizI18n-Bzgnl5cn.js";import"./QDrawer-0abd2rGn.js";import"./SectionCard-Bx7HC74v.js";import"./QLinearProgress-L5RdawR6.js";import"./FingerDrawingSlide-D-EXbGbC.js";import"./QPopupProxy-DuCU3AfJ.js";import"./QSpace-qzKo_-If.js";import"./DrawingCanvas-Ra21G5zo.js";import"./DrawingToolbar-WFwoXAYt.js";import"./QBtnToggle-CLBD-K6a.js";const U={class:"compact-header"},H={class:"row items-center q-pa-sm q-px-md"},J={class:"col ellipsis"},K={class:"text-subtitle1 text-weight-bold ellipsis"},Z={class:"content-wrapper q-pa-md"},G={class:"content-container"},Y={key:0,class:"flex flex-center",style:{"min-height":"400px"}},W={class:"text-center"},X={key:1,class:"locked-state"},ee={key:2},te={class:"row items-center justify-between q-mb-md"},se={key:1},le={class:"text-h6 text-weight-bold q-mb-sm"},ie={class:"text-grey-7 q-mb-md"},ae={class:"row q-gutter-md justify-center"},oe={class:"fullscreen-presentation"},re={key:0,class:"flex flex-center",style:{height:"100vh"}},ne={class:"text-center"},ce={key:1,class:"slide-wrapper"},ue={class:"slide-content-area"},de={class:"floating-nav"},pe={class:"floating-info"},ve={key:0,class:"section-menu-overlay"},me={class:"section-menu-header"},fe={key:2,class:"flex flex-center",style:{height:"100vh"}},ge={class:"text-center"},ye=e({__name:"LessonPlayer",props:{presentation:{type:Object,default:()=>({})},sections:{type:Array,default:()=>[]},slides:{type:Array,default:()=>[]},progress:{type:Object,default:null},loading:{type:Boolean,default:!1},isPreview:{type:Boolean,default:!1}},emits:["complete-learn","submit-practice"],setup(e,{emit:ye}){const _e=t(),xe=e,he=ye,be=h("learn"),we=h(null),qe=h(0),ke=h(!0),je=h(!1),ze=h({}),Pe=h(null),Qe=h(!1),Se=h(!1),Ce=h(null),Te=h(!1),$e=b(()=>xe.slides.filter(e=>e.section===be.value)),Ae=b(()=>$e.value[qe.value]||{}),De=b(()=>{var e,t;if(xe.isPreview)return!0;if("question"!==(null==(e=Ae.value)?void 0:e.slide_type))return!0;return((null==(t=Ae.value.slide_content)?void 0:t.questions)||[]).every(e=>ze.value[e.id])});b(()=>{if(!xe.progress)return 0;let e=0,t=xe.sections.length;return xe.progress.learn_completed_at&&e++,xe.progress.practice_submitted_at&&e++,xe.progress.quiz_passed&&e++,e/t*100});const Le=b(()=>!!xe.isPreview||!!xe.progress&&(xe.progress.learn_completed_at||"opened"!==xe.progress.status)),Ee=b(()=>!!xe.isPreview||!!xe.progress&&("quiz_unlocked"===xe.progress.status||"completed"===xe.progress.status||"failed"===xe.progress.status)),Me=e=>!!xe.isPreview||(!!["learn","objectives","warmup","homework"].includes(e)||("practice"===e?Le.value:"quiz"!==e||Ee.value)),Be=e=>!!xe.progress&&("learn"===e?!!xe.progress.learn_completed_at:"practice"===e?!!xe.progress.practice_submitted_at:"quiz"===e&&!!xe.progress.quiz_passed),Ie=()=>{Qe.value=!0},Oe=e=>({text:"description",image:"image",video:"videocam",audio:"audiotrack",pdf:"picture_as_pdf",question:"quiz",drawing:"brush"}[e]||"article"),Fe=e=>{if(Me(e)){be.value=e;const t=xe.sections.find(t=>t.id===e);we.value=t}else{let t="You cannot access this section yet.";"practice"===e?t="Please complete the Learn section first.":"quiz"===e&&(t="Please complete the Practice section first."),_e.notify({type:"warning",message:t,position:"top"})}},Ne=()=>{if(De.value)if(qe.value<$e.value.length-1)qe.value++;else{const e=xe.sections.findIndex(e=>e.id===be.value),t=xe.sections[e+1];t&&Me(t.id)?(be.value=t.id,qe.value=0,we.value=t,_e.notify({type:"positive",message:`Moving to ${t.title}`,icon:"arrow_forward",position:"top",timeout:1500})):Ve()}else _e.notify({type:"warning",message:"Please complete all questions before proceeding."})},Re=()=>{if(qe.value>0)qe.value--;else{const e=xe.sections.findIndex(e=>e.id===be.value),t=xe.sections[e-1];if(t&&Me(t.id)){be.value=t.id,we.value=t;const e=xe.slides.filter(e=>e.section===t.id);qe.value=Math.max(0,e.length-1),_e.notify({type:"info",message:`Back to ${t.title}`,icon:"arrow_back",position:"top",timeout:1500})}}},Ve=()=>{"learn"===be.value?xe.isPreview?(_e.notify({type:"positive",message:"[Preview] Learn section completed",icon:"celebration"}),be.value="practice"):he("complete-learn"):"practice"===be.value||"quiz"===be.value?je.value=!0:_e.notify({type:"positive",message:"Section completed!",icon:"celebration"})},Ue=()=>{xe.isPreview?_e.notify({type:"positive",message:"[Preview] Practice submitted"}):he("submit-practice")},He=()=>`attempt_${xe.presentation.id}_${Ae.value.id||qe.value}_${Date.now()}`,Je=async e=>{xe.isPreview},Ke=async e=>{xe.isPreview&&_e.notify({type:"positive",message:`[Preview] Quiz completed! Score: ${e.correct}/${e.total}`})},Ze=async()=>{if(xe.presentation.quiz_id)try{const e=await M.get(`/api/quizzes/${xe.presentation.quiz_id}`);Pe.value=e.data}catch(e){console.error("Failed to fetch quiz info:",e)}},Ge=()=>{_e.notify({type:"info",message:"Quiz engine integration coming soon!"})},Ye=e=>{console.log("Drawing mode:",e?"active":"inactive")},We=()=>{Te.value=!Te.value},Xe=()=>{const e=Ae.value;return(null==e?void 0:e.id)||`${be.value}-${qe.value}`};return w(be,()=>{qe.value=0,je.value=!1;const e=xe.sections.find(e=>e.id===be.value);we.value=e}),q(()=>{xe.progress?Ee.value?be.value="quiz":Le.value&&!xe.progress.practice_submitted_at?be.value="practice":xe.sections.length>0&&(be.value=xe.sections[0].id):xe.sections.length>0&&(be.value=xe.sections[0].id);const e=xe.sections.find(e=>e.id===be.value);we.value=e,qe.value=0,xe.presentation.quiz_id&&Ze()}),w(()=>xe.presentation.quiz_id,e=>{e?Ze():Pe.value=null}),(t,h)=>(j(),k(x,{view:"hHh lpR fFf",class:"student-lesson-view"},{default:z(()=>[P(I,{modelValue:ke.value,"onUpdate:modelValue":h[0]||(h[0]=e=>ke.value=e),sections:e.sections,"current-section":be.value,slides:e.slides,progress:e.progress,"can-access-section":Me,"is-section-completed":Be,onSectionSelect:Fe},null,8,["modelValue","sections","current-section","slides","progress"]),P(_,null,{default:z(()=>[P(y,{class:"student-lesson-page"},{default:z(()=>{var t;return[Q("div",U,[Q("div",H,[P(s,{flat:"",dense:"",round:"",icon:"menu",color:"primary",onClick:h[1]||(h[1]=e=>ke.value=!ke.value),class:"q-mr-sm"}),Q("div",J,[Q("div",K,S(e.presentation.name),1)]),P(s,{unelevated:"",color:"primary",icon:"fullscreen",label:"Present",onClick:Ie,class:"q-px-md"},{default:z(()=>[P(l,null,{default:z(()=>h[8]||(h[8]=[C("Enter Fullscreen Presentation Mode")])),_:1})]),_:1})])]),Q("div",Z,[Q("div",G,[e.loading?(j(),T("div",Y,[Q("div",W,[P(f,{color:"primary",size:"50px"}),h[9]||(h[9]=Q("div",{class:"text-grey-7 q-mt-md"},"Loading lesson...",-1))])])):e.isPreview||"locked"!==(null==(t=e.progress)?void 0:t.status)?(j(),T("div",ee,[P(O,{section:we.value,"current-slide":qe.value,"total-slides":$e.value.length,class:"q-mb-md"},null,8,["section","current-slide","total-slides"]),$e.value.length>0&&!je.value?(j(),k(i,{key:0,flat:"",bordered:"",class:"slide-card"},{default:z(()=>[P(o,{class:"q-pa-lg"},{default:z(()=>{return[Q("div",te,[P(g,{color:"grey-4","text-color":"grey-8",class:"q-px-md q-py-sm"},{default:z(()=>[P(a,{name:"article",size:"16px",class:"q-mr-xs"}),C(" Slide "+S(qe.value+1)+" of "+S($e.value.length),1)]),_:1}),P(r,{icon:Oe(Ae.value.slide_type),color:(e=Ae.value.slide_type,{text:"blue-6",image:"purple-6",video:"red-6",audio:"orange-6",pdf:"red-8",question:"green-6",drawing:"pink-6"}[e]||"grey-6"),"text-color":"white",class:"text-weight-bold"},{default:z(()=>{var e;return[C(S(null==(e=Ae.value.slide_type)?void 0:e.toUpperCase()),1)]}),_:1},8,["icon","color"])]),P(F,{slide:Ae.value,"attempt-id":He(),"legacy-mode":be.value,onAnswerSelected:Je,onQuizCompleted:Ke,class:"q-mt-lg"},null,8,["slide","attempt-id","legacy-mode"])];var e}),_:1}),P(N,{"current-slide":qe.value,"total-slides":$e.value.length,"can-proceed":De.value,"is-last-slide":qe.value>=$e.value.length-1,onPrev:Re,onNext:Ne},null,8,["current-slide","total-slides","can-proceed","is-last-slide"])]),_:1})):je.value||0===$e.value.length?(j(),T("div",se,["practice"===be.value?(j(),k(i,{key:0,flat:"",bordered:"",class:"q-pa-lg"},{default:z(()=>[e.progress||e.isPreview?(j(),k(B,{key:0,question:{type:"upload_draw",text:"Practice Submission",points:0},mode:"practice",onSubmitted:Ue})):$("",!0)]),_:1})):"quiz"===be.value?(j(),k(i,{key:1,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:z(()=>[P(n,{size:"100px",color:"positive","text-color":"white",class:"q-mb-md"},{default:z(()=>[P(a,{name:"quiz",size:"50px"})]),_:1}),h[12]||(h[12]=Q("div",{class:"text-h4 text-weight-bold q-mb-sm"},"Quiz Time!",-1)),h[13]||(h[13]=Q("div",{class:"text-subtitle1 text-grey-7 q-mb-lg"},"Ready to test your knowledge?",-1)),Pe.value?(j(),k(i,{key:0,flat:"",bordered:"",class:"q-pa-lg q-mb-lg",style:{"max-width":"500px",margin:"0 auto"}},{default:z(()=>[Q("div",le,S(Pe.value.name),1),Q("div",ie,S(Pe.value.description),1),Q("div",ae,[P(r,{icon:"help",color:"primary","text-color":"white"},{default:z(()=>[C(S(Pe.value.questions_count)+" Questions ",1)]),_:1}),Pe.value.time_limit_minutes?(j(),k(r,{key:0,icon:"timer",color:"orange","text-color":"white"},{default:z(()=>[C(S(Pe.value.time_limit_minutes)+" Minutes ",1)]),_:1})):$("",!0)])]),_:1})):$("",!0),Pe.value?(j(),k(s,{key:1,unelevated:"",color:"positive",icon:"play_arrow",label:"Start Quiz",onClick:Ge,size:"lg",class:"q-px-xl q-py-sm"})):$("",!0)]),_:1})):(j(),k(i,{key:2,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:z(()=>[P(a,{name:"folder_open",size:"80px",color:"grey-4",class:"q-mb-md"}),h[14]||(h[14]=Q("div",{class:"text-h6 text-grey-7"},"No content available",-1))]),_:1}))])):$("",!0)])):(j(),T("div",X,[P(i,{flat:"",bordered:"",class:"text-center q-pa-xl"},{default:z(()=>[P(a,{name:"lock",size:"80px",color:"grey-4",class:"q-mb-md"}),h[10]||(h[10]=Q("div",{class:"text-h5 text-weight-bold q-mb-sm"},"Lesson Locked",-1)),h[11]||(h[11]=Q("div",{class:"text-grey-7"}," This lesson has not been opened by your teacher yet. ",-1))]),_:1})]))])])]}),_:1})]),_:1}),P(m,{modelValue:Qe.value,"onUpdate:modelValue":h[7]||(h[7]=e=>Qe.value=e),maximized:""},{default:z(()=>[Q("div",oe,[e.loading?(j(),T("div",re,[Q("div",ne,[P(f,{color:"white",size:"50px"}),h[15]||(h[15]=Q("div",{class:"text-white q-mt-md"},"Loading...",-1))])])):$e.value.length>0?(j(),T("div",ce,[Q("div",ue,[P(F,{slide:Ae.value,"attempt-id":He(),"legacy-mode":be.value,onAnswerSelected:Je,onQuizCompleted:Ke},null,8,["slide","attempt-id","legacy-mode"])]),Q("div",de,[qe.value>0?(j(),k(s,{key:0,fab:"",color:"primary",icon:"chevron_left",onClick:Re,class:"nav-arrow nav-arrow-left"},{default:z(()=>[P(l,null,{default:z(()=>h[16]||(h[16]=[C("Previous")])),_:1})]),_:1})):$("",!0),De.value?(j(),k(s,{key:1,fab:"",color:qe.value<$e.value.length-1?"primary":"positive",icon:qe.value<$e.value.length-1?"chevron_right":"check_circle",onClick:Ne,class:"nav-arrow nav-arrow-right"},{default:z(()=>[P(l,null,{default:z(()=>[C(S(qe.value<$e.value.length-1?"Next":"Complete"),1)]),_:1})]),_:1},8,["color","icon"])):$("",!0)]),Q("div",pe,[P(r,{color:"rgba(0,0,0,0.7)","text-color":"white",class:"q-px-md"},{default:z(()=>[P(a,{name:Oe(Ae.value.slide_type),size:"18px",class:"q-mr-xs"},null,8,["name"]),C(" "+S(qe.value+1)+" / "+S($e.value.length),1)]),_:1}),we.value?(j(),k(r,{key:0,style:A({background:we.value.bg,color:we.value.textColor}),class:"q-ml-sm q-px-md"},{default:z(()=>[P(a,{name:we.value.qIcon||we.value.icon,size:"18px",class:"q-mr-xs"},null,8,["name"]),C(" "+S(we.value.title),1)]),_:1},8,["style"])):$("",!0)]),P(s,{flat:"",dense:"",round:"",icon:"list",color:"white",onClick:h[2]||(h[2]=e=>Se.value=!Se.value),class:"section-menu-btn"},{default:z(()=>[P(l,null,{default:z(()=>h[17]||(h[17]=[C("Sections")])),_:1})]),_:1}),P(D,{name:"slide-fade"},{default:z(()=>[Se.value?(j(),T("div",ve,[Q("div",me,[h[18]||(h[18]=Q("div",{class:"text-h6 text-white"},"Sections",-1)),P(s,{flat:"",dense:"",round:"",icon:"close",color:"white",onClick:h[3]||(h[3]=e=>Se.value=!1)})]),P(c,{class:"section-menu-list"},{default:z(()=>[P(u,{dark:""},{default:z(()=>[(j(!0),T(L,null,E(e.sections,e=>(j(),k(d,{key:e.id,clickable:"",active:be.value===e.id,disable:!Me(e.id),onClick:t=>(e=>{if(Me(e)){be.value=e,qe.value=0;const t=xe.sections.find(t=>t.id===e);we.value=t,Se.value=!1,_e.notify({type:"positive",message:`Jumped to ${t.title}`,icon:"check",position:"top",timeout:1500})}else _e.notify({type:"warning",message:"This section is locked",position:"top"})})(e.id),class:"section-menu-item"},{default:z(()=>[P(p,{avatar:""},{default:z(()=>[P(n,{style:A({background:e.bg,color:e.textColor})},{default:z(()=>[P(a,{name:e.qIcon||e.icon},null,8,["name"])]),_:2},1032,["style"])]),_:2},1024),P(p,null,{default:z(()=>[P(v,{class:"text-weight-medium"},{default:z(()=>[C(S(e.title),1)]),_:2},1024),P(v,{caption:"",class:"text-grey-4"},{default:z(()=>{return[C(S((t=e.id,xe.slides.filter(e=>e.section===t).length))+" slides ",1)];var t}),_:2},1024)]),_:2},1024),P(p,{side:""},{default:z(()=>[Be(e.id)?(j(),k(a,{key:0,name:"check_circle",color:"positive",size:"24px"})):Me(e.id)?$("",!0):(j(),k(a,{key:1,name:"lock",color:"grey-5",size:"20px"}))]),_:2},1024)]),_:2},1032,["active","disable","onClick"]))),128))]),_:1})]),_:1})])):$("",!0)]),_:1}),P(s,{flat:"",dense:"",round:"",icon:"close",color:"white",onClick:h[4]||(h[4]=e=>Qe.value=!1),class:"exit-fullscreen-btn"},{default:z(()=>[P(l,null,{default:z(()=>h[19]||(h[19]=[C("Exit Presentation")])),_:1})]),_:1}),P(s,{flat:"",dense:"",round:"",icon:Te.value?"edit_off":"edit_note",color:Te.value?"deep-orange":"white",onClick:We,class:"slide-annotation-btn"},{default:z(()=>[P(l,null,{default:z(()=>[C(S(Te.value?"Hide Slide Annotations":"Show Slide Annotations"),1)]),_:1})]),_:1},8,["icon","color"])])):(j(),T("div",fe,[Q("div",ge,[P(a,{name:"folder_open",size:"80px",color:"white",class:"q-mb-md"}),h[20]||(h[20]=Q("div",{class:"text-h6 text-white"},"No slides available in this section",-1)),P(s,{unelevated:"",color:"white","text-color":"black",label:"Close",onClick:h[5]||(h[5]=e=>Qe.value=!1),class:"q-mt-lg"})])]))]),Qe.value?(j(),k(R,{key:0,ref_key:"drawingOverlayRef",ref:Ce,onDrawingStateChanged:Ye},null,512)):$("",!0),Qe.value&&Te.value?(j(),k(V,{key:1,"current-slide-id":Xe(),"current-section":be.value,"current-slide-index":qe.value,onClose:h[6]||(h[6]=e=>Te.value=!1)},null,8,["current-slide-id","current-section","current-slide-index"])):$("",!0)]),_:1},8,["modelValue"])]),_:1}))}},[["__scopeId","data-v-22ddb122"]]);export{ye as default};
