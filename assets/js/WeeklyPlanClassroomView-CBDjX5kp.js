import{r as e,u as a,j as l,k as n,l as t,d as s,Q as o,G as i,b as d,t as r}from"./app-DraepSDZ.js";import{Q as c}from"./QSelect-B8X205mE.js";import{Q as p}from"./QSpinnerDots-chBci7-n.js";import{Q as u}from"./QSpace-CZ9CnKBh.js";import{Q as m}from"./QBadge-VPRr201m.js";import{Q as b}from"./QTd-ZXd3AVz0.js";import{Q as h}from"./QTable-lfCIUGXW.js";import{u as g}from"./i18n-B0T1C7j3.js";import{f as y,a as v,k as f,o as w,N as x,J as k,b as _,I as j,K as $,R as P,z as D,W as N,V as z,F as S,Q as T,_ as Q,a0 as C,S as q}from"./vendor-BWKGNkNB.js";import{u as E}from"./useWeeklyPlansStore-Cx5d735B.js";import"./offline-BzIlwqNM.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";import"./QMarkupTable-B8BpHV8_.js";import"./QLinearProgress-CYD1l_xP.js";import"./use-fullscreen-WQ56vCgJ.js";import"./schoolData-CWFtmgnE.js";const L={class:"q-pa-md"},I={class:"row q-gutter-md items-end"},V={class:"col-12 col-sm-6"},W={class:"col-12 col-sm-4"},H={key:0,class:"row justify-center q-pa-xl"},M={class:"text-h6 text-grey-7 q-mt-md"},U={class:"text-grey-6"},A={key:2,class:"classrooms-grid"},F={class:"classroom-header bg-primary text-white q-pa-md"},O={class:"q-ma-none flex items-center q-gutter-sm"},B={class:"plans-by-day"},R={class:"day-header-row"},Y={class:"day-info"},G={class:"day-name"},J={class:"day-meta"},K={class:"subject-teacher"},X={class:"teacher-name"},Z=["innerHTML"],ee={key:1,class:"text-grey-5"},ae=["innerHTML"],le={key:1,class:"text-grey-5"},ne=["innerHTML"],te={key:1,class:"text-grey-5"},se=e({__name:"WeeklyPlanClassroomView",setup(e){const{t:se,locale:oe}=g(),ie=E(),de=a(),re=y([]),ce=y([]),pe=y([]),ue=y([]),me=y(!1),be=y(!1),he=y({rowsPerPage:0}),ge=v(()=>[{label:se("weeklyPlans.shortDays.1"),value:1},{label:se("weeklyPlans.shortDays.2"),value:2},{label:se("weeklyPlans.shortDays.3"),value:3},{label:se("weeklyPlans.shortDays.4"),value:4},{label:se("weeklyPlans.shortDays.5"),value:5}]),ye=v(()=>[{name:"period",label:se("weeklyPlans.period"),field:"schedule.period_number",align:"center"},{name:"subject",label:se("weeklyPlans.subject"),field:"schedule.cst.subject_name",align:"left"},{name:"cw",label:se("weeklyPlans.classwork"),field:"cw",align:"left"},{name:"hw",label:se("weeklyPlans.homework"),field:"hw",align:"left"},{name:"notes",label:se("weeklyPlans.notes"),field:"notes",align:"left"}]),ve=v(()=>re.value.length>0&&ce.value.length===re.value.length),fe=v(()=>{var e;let a=ue.value;return(null==(e=pe.value)?void 0:e.length)&&(a=a.filter(e=>{var a;return pe.value.includes(null==(a=e.schedule)?void 0:a.day)})),a}),we=v(()=>{const e={};return fe.value.forEach(a=>{const l=a.classroom_id;if(!e[l]){const a=re.value.find(e=>e.id===l);e[l]={id:l,name:(null==a?void 0:a.name)||"Unknown",plans:[]}}e[l].plans.push(a)}),Object.values(e).forEach(e=>{e.plans.sort((e,a)=>{var l,n,t,s;const o=((null==(l=e.schedule)?void 0:l.day)||0)-((null==(n=a.schedule)?void 0:n.day)||0);return 0!==o?o:((null==(t=e.schedule)?void 0:t.period_number)||0)-((null==(s=a.schedule)?void 0:s.period_number)||0)})}),Object.values(e).sort((e,a)=>e.name.localeCompare(a.name))}),xe=()=>{ve.value?ce.value=[]:ce.value=re.value.map(e=>e.id)},ke=e=>{const a=(new Date).getFullYear();let l=new Date(a,0,1),n=0===l.getDay()?0:7-l.getDay(),t=new Date(a,0,1+n);const s=new Date(t);s.setDate(t.getDate()+7*(ie.weekNumber-1));const o=new Date(s);return o.setDate(s.getDate()+(e-1)),o.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},_e=e=>{const a={};return e.forEach(e=>{var l;const n=null==(l=e.schedule)?void 0:l.day;a[n]||(a[n]={dayNumber:n,dayName:se(`weeklyPlans.shortDays.${n}`)||`Day ${n}`,plans:[]}),a[n].plans.push(e)}),Object.values(a).forEach(e=>{e.plans.sort((e,a)=>{var l,n;return(null==(l=e.schedule)?void 0:l.period_number)-(null==(n=a.schedule)?void 0:n.period_number)})}),Object.values(a).sort((e,a)=>e.dayNumber-a.dayNumber)},je=async()=>{if(ie.selectedSchoolId){be.value=!0;try{const e=await Q.get(`/api/classrooms?school_id=${ie.selectedSchoolId}`);re.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching classrooms:",e)}finally{be.value=!1}}};return f(()=>ie.selectedSchoolId,()=>{je(),ce.value=[]}),f(()=>[ce.value,ie.weekNumber,ie.semesterNumber,ie.selectedAcademicYearId],()=>{(async()=>{if(ce.value.length){me.value=!0;try{const e=ce.value.map(e=>Q.get("/weekly-system/api/weekly-plans",{params:{classroom_id:e,week_number:ie.weekNumber,semester_number:ie.semesterNumber,academic_year_id:ie.selectedAcademicYearId}}).then(a=>({classroom_id:e,plans:a.data.data||a.data||[]}))),a=await Promise.all(e);ue.value=a.flatMap(e=>e.plans.map(a=>({...a,classroom_id:e.classroom_id})))}catch(e){console.error("Error fetching plans:",e),de.notify({type:"negative",message:"Failed to load weekly plans"})}finally{me.value=!1}}else ue.value=[]})()},{deep:!0}),w(async()=>{ie.selectedSchoolId&&je()}),(e,a)=>(k(),x("div",L,[_(s,{flat:"",bordered:"",class:"q-pa-md q-mb-lg"},{default:$(()=>[P("div",I,[P("div",V,[_(c,{modelValue:ce.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ce.value=e),options:re.value,"option-value":"id","option-label":"name",label:D(se)("weeklyPlans.filterClassrooms"),outlined:"",dense:"",multiple:"","use-chips":"","emit-value":"","map-options":"",loading:be.value},{"before-options":$(()=>[_(l,{clickable:"",onClick:xe},{default:$(()=>[_(n,null,{default:$(()=>[_(t,null,{default:$(()=>[N(z(ve.value?D(se)("weeklyPlans.deselectAll"):D(se)("weeklyPlans.selectAll")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","options","label","loading"])]),P("div",W,[_(c,{modelValue:pe.value,"onUpdate:modelValue":a[1]||(a[1]=e=>pe.value=e),options:ge.value,label:D(se)("weeklyPlans.filterByDay"),outlined:"",dense:"",multiple:"","use-chips":"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options","label"])])])]),_:1}),me.value?(k(),x("div",H,[_(p,{size:"50px",color:"primary"})])):we.value.length?(k(),x("div",A,[(k(!0),x(S,null,T(we.value,e=>(k(),x("div",{key:e.id,class:"classroom-card q-mb-lg"},[_(s,{flat:"",bordered:""},{default:$(()=>[P("div",F,[P("h5",O,[_(o,{name:"meeting_room"}),N(" "+z(e.name)+" ",1),_(i,{dense:"",label:`${e.plans.length} ${D(se)("weeklyPlans.classes")}`,"text-color":"white"},null,8,["label"]),_(u),_(d,{flat:"",dense:"",round:"",icon:"picture_as_pdf",color:"white",onClick:C(a=>(e=>{if(!e||!e.plans||!e.plans.length)return void de.notify({type:"warning",message:"No plans to save for this classroom"});const a=_e(e.plans);let l=`\n    <div class="page" dir="${"ar"===oe.value?"rtl":"ltr"}">\n      <div class="header-box">\n        <div class="header-title">${se("weeklyPlans.weeklyLearningPlan")}</div>\n        <div class="header-meta">${e.name} â€¢ ${se("weeklyPlans.week")} ${ie.weekNumber} â€¢ ${se("weeklyPlans.semester")} ${ie.semesterNumber}</div>\n      </div>\n  `;a.forEach(e=>{l+=`\n      <div class="day-container">\n        <div class="day-header">\n          <div class="day-pill">${e.dayName}</div>\n        </div>\n        <table>\n          <thead><tr><th class="period-col">${se("weeklyPlans.period")}</th><th class="subject-col">${se("weeklyPlans.subject")}</th><th>${se("weeklyPlans.classwork")}</th><th>${se("weeklyPlans.homework")}</th></tr></thead>\n          <tbody>\n    `,e.plans.forEach(e=>{var a,n,t,s,o,i,d,r,c;const p=(null==(n=null==(a=e.schedule)?void 0:a.cst)?void 0:n.subject_name)||"-",u=(null==(s=null==(t=e.schedule)?void 0:t.cst)?void 0:s.c_bg)||"#e0e0e0",m=(null==(i=null==(o=e.schedule)?void 0:o.cst)?void 0:i.c_text)||"#111",b=(null==(r=null==(d=e.schedule)?void 0:d.cst)?void 0:r.teacher_name)||"",h=e.cw||"-",g=e.hw||"-";l+=`\n        <tr>\n          <td class="period-col">${(null==(c=e.schedule)?void 0:c.period_number)||""}</td>\n          <td class="subject-col">\n            <div class="subject-badge" style="background:${u}; color:${m}">${p}</div>\n            ${b?`<div class="teacher-name">${b}</div>`:""}\n          </td>\n          <td>${"-"!==h?'<span class="label-tag cw-tag">CW</span>'+h:"-"}</td>\n          <td>${"-"!==g?'<span class="label-tag hw-tag">HW</span>'+g:"-"}</td>\n        </tr>\n      `}),l+="</tbody></table></div>"}),l+="</div>";const n=`WeeklyPlans_${String(e.name).replace(/\s+/g,"_")}_Week${ie.weekNumber}.pdf`,t=window.open("","_blank");if(!t)return void de.notify({type:"negative",message:"Popup blocked: allow popups to save PDF"});const s=`\n    var opt = { margin:0.3, filename: '${n}', image:{type:'jpeg', quality:0.98}, html2canvas:{scale:2, useCORS:true}, jsPDF:{unit:'in', format:'a4', orientation:'portrait'} };\n    function doSave(){ html2pdf().set(opt).from(document.body).save().then(function(){ setTimeout(function(){ window.close(); }, 1000); }); }\n    if (typeof html2pdf === 'undefined'){\n      var s = document.createElement('script'); s.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js'; s.onload = doSave; document.head.appendChild(s);\n    } else { doSave(); }\n  `;t.document.write(`<!doctype html><html><head><meta charset="utf-8"><title>PDF</title><style>\n    @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');\n    @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');\n    body { font-family: 'Nunito', 'Tajawal', 'Segoe UI', sans-serif; color: #374151; }\n    .page { width: 100%; padding: 20px; box-sizing: border-box; }\n    \n    .header-box { \n      background: #4f46e5; \n      color: white; \n      padding: 20px; \n      border-radius: 12px;\n      margin-bottom: 25px;\n    }\n    .header-title { font-size: 24px; font-weight: 800; margin: 0; }\n    .header-meta { margin-top: 8px; font-size: 14px; opacity: 0.9; }\n    \n    .day-container { margin-bottom: 20px; page-break-inside: avoid; }\n    .day-header { \n      display: flex; \n      align-items: center; \n      margin-bottom: 0px;\n    }\n    .day-pill {\n      background: #4f46e5;\n      color: white;\n      padding: 6px 14px;\n      border-radius: 12px 12px 0 0;\n      font-weight: 700;\n      font-size: 14px;\n      display: inline-block;\n    }\n\n    table { width: 100%; border-collapse: collapse; border: 1px solid #e5e7eb; border-radius: 0 8px 8px 8px; overflow: hidden; }\n    th { \n      background: #f3f4f6; \n      color: #374151; \n      font-weight: 700; \n      padding: 8px 10px; \n      text-align: left; \n      font-size: 12px;\n      border-bottom: 2px solid #e5e7eb;\n    }\n    td { \n      padding: 8px 10px; \n      border-bottom: 1px solid #e5e7eb; \n      font-size: 12px; \n      vertical-align: top;\n    }\n    tr:nth-child(even) { background-color: #f9fafb; }\n    \n    .period-col { width: 50px; text-align: center; color: #6b7280; font-weight: 700; }\n    .subject-col { width: 160px; }\n    \n    .subject-badge { \n      display: inline-block; \n      padding: 3px 8px; \n      border-radius: 4px; \n      font-weight: 700; \n      font-size: 11px;\n    }\n    .teacher-name { color: #6b7280; font-size: 11px; font-style: italic; margin-top: 2px; }\n    \n    .label-tag {\n      font-size: 9px;\n      font-weight: 700;\n      padding: 1px 4px;\n      border-radius: 3px;\n      margin-right: 4px;\n    }\n    .cw-tag { background: #dbeafe; color: #1e40af; }\n    .hw-tag { background: #fef3c7; color: #92400e; }\n  </style></head><body>${l}<script>${s} <\/script></body></html>`),t.document.close()})(e),["stop"]),disable:!e.plans||!e.plans.length},{default:$(()=>[_(r,null,{default:$(()=>[N(z(D(se)("weeklyPlans.savePdf")),1)]),_:1})]),_:2},1032,["onClick","disable"]),_(d,{flat:"",dense:"",round:"",icon:"print",color:"white",onClick:C(a=>(e=>{if(!e||!e.plans||!e.plans.length)return void de.notify({type:"warning",message:"No plans to print for this classroom"});const a=_e(e.plans);let l=`\n    <div class="page" dir="${"ar"===oe.value?"rtl":"ltr"}">\n      <div class="header-box">\n        <div class="header-title">${se("weeklyPlans.weeklyLearningPlan")} - ${e.name}</div>\n        <div class="header-meta">${se("weeklyPlans.week")} ${ie.weekNumber} â€¢ ${se("weeklyPlans.semester")} ${ie.semesterNumber} â€¢ ${(new Date).toLocaleDateString(oe.value,{weekday:"long",year:"numeric",month:"long",day:"numeric"})}</div>\n      </div>\n  `;a.forEach(e=>{l+=`\n      <div class="day-container">\n        <div class="day-header">\n          <div class="day-pill">${e.dayName}</div>\n          <div class="date-label">${ke(e.dayNumber)}</div>\n        </div>\n        <table>\n          <thead>\n            <tr>\n              <th class="period-col">${se("weeklyPlans.period")}</th>\n              <th class="subject-col">${se("weeklyPlans.subject")}</th>\n              <th class="cw-col">${se("weeklyPlans.classwork")}</th>\n              <th class="hw-col">${se("weeklyPlans.homework")}</th>\n            </tr>\n          </thead>\n          <tbody>\n    `,e.plans.forEach(e=>{var a,n,t,s,o,i,d,r,c;const p=(null==(n=null==(a=e.schedule)?void 0:a.cst)?void 0:n.subject_name)||"-",u=(null==(s=null==(t=e.schedule)?void 0:t.cst)?void 0:s.c_bg)||"#e0e0e0",m=(null==(i=null==(o=e.schedule)?void 0:o.cst)?void 0:i.c_text)||"#111",b=(null==(r=null==(d=e.schedule)?void 0:d.cst)?void 0:r.teacher_name)||"",h=e.cw?e.cw:"-",g=e.hw?e.hw:"-";l+=`\n        <tr>\n          <td class="period-col">${(null==(c=e.schedule)?void 0:c.period_number)||""}</td>\n          <td class="subject-col">\n            <div class="subject-badge" style="background:${u}; color:${m}">${p}</div>\n            ${b?`<div class="teacher-name">ðŸ‘¤ ${b}</div>`:""}\n          </td>\n          <td>${"-"!==h?'<span class="label-tag cw-tag">CW</span>'+h:'<span style="color:#9ca3af">-</span>'}</td>\n          <td>${"-"!==g?'<span class="label-tag hw-tag">HW</span>'+g:'<span style="color:#9ca3af">-</span>'}</td>\n        </tr>\n      `}),l+="</tbody></table></div>"}),l+="</div>";const n=window.open("","_blank");n?(n.document.write(`<!doctype html><html><head><meta charset="utf-8"><title>Plan - ${e.name}</title><style>\n    @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');\n    @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');\n    body { font-family: 'Nunito', 'Tajawal', 'Segoe UI', sans-serif; color: #374151; -webkit-print-color-adjust: exact; print-color-adjust: exact; }\n    .page { max-width: 210mm; margin: 0 auto; padding: 15mm; }\n    \n    .header-box { \n      background: linear-gradient(135deg, #4f46e5 0%, #3b82f6 100%); \n      color: white; \n      padding: 20px; \n      border-radius: 12px;\n      margin-bottom: 25px;\n      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n    }\n    .header-title { font-size: 24px; font-weight: 800; margin: 0; letter-spacing: -0.5px; }\n    .header-meta { margin-top: 8px; font-size: 14px; opacity: 0.9; font-weight: 500; }\n    \n    .day-container { margin-bottom: 25px; page-break-inside: avoid; }\n    .day-header { \n      display: flex; \n      align-items: center; \n      margin-bottom: 1px; /* connected to table */\n    }\n    .day-pill {\n      background: #4f46e5;\n      color: white;\n      padding: 8px 16px;\n      border-radius: 12px 12px 0 0;\n      font-weight: 700;\n      font-size: 15px;\n      display: inline-block;\n    }\n    .date-label {\n      color: #6b7280;\n      font-size: 13px;\n      margin-left: 12px;\n      font-weight: 600;\n    }\n\n    table { width: 100%; border-collapse: collapse; border-radius: 0 8px 8px 8px; overflow: hidden; border: 1px solid #e5e7eb; }\n    th { \n      background: #f3f4f6; \n      color: #374151; \n      font-weight: 700; \n      padding: 10px 12px; \n      text-align: left; \n      font-size: 13px;\n      border-bottom: 2px solid #e5e7eb;\n    }\n    td { \n      padding: 10px 12px; \n      border-bottom: 1px solid #e5e7eb; \n      font-size: 13px; \n      vertical-align: top;\n      line-height: 1.5;\n    }\n    tr:last-child td { border-bottom: none; }\n    tr:nth-child(even) { background-color: #f9fafb; }\n    \n    .period-col { width: 60px; text-align: center; color: #6b7280; font-weight: 700; }\n    .subject-col { width: 180px; }\n    .cw-col { width: 35%; }\n    .hw-col { width: 35%; }\n    \n    .subject-badge { \n      display: inline-block; \n      padding: 4px 10px; \n      border-radius: 6px; \n      font-weight: 700; \n      font-size: 12px;\n      margin-bottom: 4px;\n    }\n    .teacher-name { color: #6b7280; font-size: 12px; font-style: italic; display: flex; align-items: center; gap: 4px; }\n    \n    .label-tag {\n      display: inline-block;\n      font-size: 10px;\n      text-transform: uppercase;\n      font-weight: 700;\n      letter-spacing: 0.5px;\n      margin-right: 6px;\n      padding: 2px 6px;\n      border-radius: 4px;\n    }\n    .cw-tag { background: #dbeafe; color: #1e40af; }\n    .hw-tag { background: #fef3c7; color: #92400e; }\n    \n    @media print { \n      @page { margin: 10mm; } \n      body { -webkit-print-color-adjust: exact; }\n    }\n  </style></head><body>${l}</body></html>`),n.document.close(),n.onload=()=>{setTimeout(()=>{n.print(),n.close()},500)}):de.notify({type:"negative",message:"Popup blocked: allow popups to print"})})(e),["stop"]),disable:!e.plans||!e.plans.length},{default:$(()=>[_(r,null,{default:$(()=>[N(z(D(se)("weeklyPlans.print")),1)]),_:1})]),_:2},1032,["onClick","disable"])])]),P("div",B,[(k(!0),x(S,null,T(_e(e.plans),e=>(k(),x("div",{key:e.dayNumber,class:"day-group"},[P("div",R,[P("div",Y,[P("div",G,z(e.dayName),1),P("div",J,[P("span",null,z(D(se)("weeklyPlans.week"))+" "+z(D(ie).weekNumber),1),a[2]||(a[2]=P("span",{class:"separator"},"â€¢",-1)),P("span",null,z(ke(e.dayNumber)),1)])])]),_(h,{flat:"",bordered:"",rows:e.plans,columns:ye.value,"row-key":"id",dense:"",class:"classroom-table day-table","hide-header":"","hide-bottom":"",pagination:he.value,"rows-per-page-options":[]},{"body-cell-period":$(e=>[_(b,{props:e,class:"text-center period-cell"},{default:$(()=>{var a;return[_(m,{label:`P${null==(a=e.row.schedule)?void 0:a.period_number}`,color:"primary"},null,8,["label"])]}),_:2},1032,["props"])]),"body-cell-subject":$(e=>[_(b,{props:e,class:"subject-teacher-cell"},{default:$(()=>{var a,l,n,t,s,o,i,d;return[P("div",K,[P("div",{class:"subject-name",style:q({backgroundColor:null==(l=null==(a=e.row.schedule)?void 0:a.cst)?void 0:l.c_bg,color:null==(t=null==(n=e.row.schedule)?void 0:n.cst)?void 0:t.c_text})},z(null==(o=null==(s=e.row.schedule)?void 0:s.cst)?void 0:o.subject_name),5),P("div",X,z((null==(d=null==(i=e.row.schedule)?void 0:i.cst)?void 0:d.teacher_name)||"N/A"),1)])]}),_:2},1032,["props"])]),"body-cell-cw":$(e=>[_(b,{props:e,class:"content-preview"},{default:$(()=>[e.row.cw?(k(),x("div",{key:0,class:"text-info ellipsis-2-lines",innerHTML:e.row.cw},null,8,Z)):(k(),x("span",ee,"-"))]),_:2},1032,["props"])]),"body-cell-hw":$(e=>[_(b,{props:e,class:"content-preview"},{default:$(()=>[e.row.hw?(k(),x("div",{key:0,class:"text-warning ellipsis-2-lines",innerHTML:e.row.hw},null,8,ae)):(k(),x("span",le,"-"))]),_:2},1032,["props"])]),"body-cell-notes":$(e=>[_(b,{props:e,class:"content-preview"},{default:$(()=>[e.row.notes?(k(),x("div",{key:0,class:"text-info ellipsis-2-lines",innerHTML:e.row.notes},null,8,ne)):(k(),x("span",te,"-"))]),_:2},1032,["props"])]),_:2},1032,["rows","columns","pagination"])]))),128))])]),_:2},1024)]))),128))])):(k(),j(s,{key:1,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:$(()=>[_(o,{name:"meeting_room",size:"64px",color:"grey-5"}),P("p",M,z(D(se)("weeklyPlans.noDataAvailable")),1),P("p",U,z(D(se)("weeklyPlans.selectClassroomsToView")),1)]),_:1}))]))}},[["__scopeId","data-v-e0ba055b"]]);export{se as default};
