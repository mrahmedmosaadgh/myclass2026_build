import{bk as e,c as l,f as a,Q as o,l as t,m as s}from"./app-ggGwxJON.js";import{Q as u}from"./QCircularProgress-RDu5MLfe.js";import{Q as n}from"./QSelect-DOo83gJW.js";import{f as r,a as d,A as v,I as i,J as c,K as m,b as p,Q as k,O as f,V as y,N as b,F as h}from"./vendor-nQjeLEvd.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";import"./rtl-Cr6c3OOr.js";const g={class:"text-h6"},S={class:"text-subtitle2"},x={class:"text-h3"},w={class:"row q-mt-md"},C={class:"row q-mt-md justify-center"},V={class:"text-center q-mb-md"},_={key:0},D={class:"text-h6"},j={key:1},T={class:"text-subtitle1"},$={__name:"PomodoroTimer",props:{tasks:{type:Array,default:()=>[]}},emits:["close","session-completed","enter-focus-mode"],setup($,{emit:q}){const I=$,Q=q,M=e(),F=r(!1),N=r(!1),P=r(!1),U=r(!1),A=r(0),B=r(25),E=r(5),R=r(null),W=r(""),z=r(null),J=r(null),K=r(null),O=r(null),G=r(0),H=d(()=>I.tasks.map(e=>({id:e.id,title:e.title}))),L=d(()=>R.value?I.tasks.find(e=>e.id===R.value):null),X=d(()=>{if(U.value){const e=60*E.value;return(e-A.value)/e*100}{const e=60*B.value;return(e-A.value)/e*100}}),Y=()=>{F.value=!0,N.value=!1,P.value=!1,U.value=!1,A.value=60*B.value,K.value=Date.now(),G.value=0,M.fetchData({endpoint:"/developer/pomodoro/start",method:"post",data:{task_id:R.value,type:"work",duration:B.value},onSuccess:e=>{z.value=e.session,ee()}})},Z=()=>{F.value=!0,N.value=!1,P.value=!1,U.value=!0,A.value=60*E.value,K.value=Date.now(),G.value=0,M.fetchData({endpoint:"/developer/pomodoro/start",method:"post",data:{task_id:null,type:"break",duration:E.value},onSuccess:e=>{z.value=e.session,ee()}})},ee=()=>{clearInterval(J.value),J.value=setInterval(()=>{N.value||(A.value--,A.value<=0&&te())},1e3)},le=()=>{N.value=!0,O.value=Date.now()},ae=()=>{N.value=!1,G.value+=Date.now()-O.value,O.value=null},oe=()=>{clearInterval(J.value),z.value&&M.fetchData({endpoint:`/developer/pomodoro/${z.value.id}/end`,method:"post",data:{notes:"Session interrupted by user",status:"interrupted"},onSuccess:()=>{Q("session-completed")}}),se()},te=()=>{clearInterval(J.value),F.value=!1,re(),U.value?(U.value=!1,P.value=!1,z.value&&M.fetchData({endpoint:`/developer/pomodoro/${z.value.id}/end`,method:"post",data:{notes:"Break completed",status:"completed"},onSuccess:()=>{Q("session-completed"),z.value=null}})):P.value=!0},se=()=>{clearInterval(J.value),F.value=!1,N.value=!1,P.value=!1,U.value=!1,A.value=0,W.value="",z.value=null},ue=()=>{se(),Q("close")},ne=e=>{const l=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`},re=()=>{new Audio("/sounds/notification.mp3").play().catch(e=>console.error("Error playing sound:",e))},de=()=>{z.value&&M.fetchData({endpoint:`/developer/pomodoro/${z.value.id}/end`,method:"post",data:{notes:W.value||"Need more time to complete",status:"extended"},onSuccess:()=>{Q("session-completed"),Y()}})},ve=()=>{z.value&&M.fetchData({endpoint:`/developer/pomodoro/${z.value.id}/end`,method:"post",data:{notes:W.value||"Task completed",status:"completed"},onSuccess:()=>{Q("session-completed"),R.value?M.fetchData({endpoint:`/developer/tasks/${R.value}/toggle-complete`,method:"post",onSuccess:()=>{Z()}}):Z()}})},ie=()=>{z.value&&M.fetchData({endpoint:`/developer/pomodoro/${z.value.id}/end`,method:"post",data:{notes:W.value||"Taking a longer break",status:"completed"},onSuccess:()=>{Q("session-completed"),E.value=2*E.value,Z()}})},ce=()=>{console.log("Entering Focus Mode with task:",L.value),console.log("Current session:",z.value),Q("enter-focus-mode",L.value,z.value),Q("close")};return v(()=>{clearInterval(J.value)}),(e,r)=>(c(),i(s,{style:{width:"400px","max-width":"90vw"}},{default:m(()=>[p(l,{class:"text-center"},{default:m(()=>[f("div",g,y(U.value?"Break Time":"Pomodoro Timer"),1),f("div",S,y(U.value?"Relax and recharge":"Stay focused and productive"),1)]),_:1}),p(l,{class:"text-center"},{default:m(()=>[p(u,{value:X.value,size:"200px",thickness:.2,color:"primary","track-color":"grey-3",class:"q-ma-md"},{default:m(()=>[f("div",x,y(ne(A.value)),1)]),_:1},8,["value"])]),_:1}),U.value||F.value||P.value?k("",!0):(c(),i(l,{key:0},{default:m(()=>[p(n,{modelValue:R.value,"onUpdate:modelValue":r[0]||(r[0]=e=>R.value=e),options:H.value,label:"Select Task","option-value":"id","option-label":"title","emit-value":"","map-options":"",clearable:""},null,8,["modelValue","options"]),f("div",w,[p(a,{modelValue:B.value,"onUpdate:modelValue":r[1]||(r[1]=e=>B.value=e),modelModifiers:{number:!0},type:"number",label:"Duration (minutes)",min:"1",max:"60",class:"col-6 q-pr-sm"},null,8,["modelValue"]),p(a,{modelValue:E.value,"onUpdate:modelValue":r[2]||(r[2]=e=>E.value=e),modelModifiers:{number:!0},type:"number",label:"Break (minutes)",min:"1",max:"30",class:"col-6 q-pl-sm"},null,8,["modelValue"])])]),_:1})),P.value?(c(),i(l,{key:1},{default:m(()=>[r[4]||(r[4]=f("div",{class:"text-h6 text-center q-mb-md"},"Session Completed!",-1)),p(a,{modelValue:W.value,"onUpdate:modelValue":r[3]||(r[3]=e=>W.value=e),type:"textarea",label:"What did you accomplish?",rows:"3"},null,8,["modelValue"]),f("div",C,[p(o,{flat:"",color:"grey",label:"Need more time",onClick:de}),p(o,{flat:"",color:"positive",label:"Task completed",onClick:ve}),p(o,{flat:"",color:"primary",label:"Take a longer break",onClick:ie})])]),_:1})):k("",!0),F.value?(c(),i(l,{key:2},{default:m(()=>[f("div",V,[L.value?(c(),b("div",_,[r[5]||(r[5]=f("div",{class:"text-subtitle1"},"Working on:",-1)),f("div",D,y(L.value.title),1)])):(c(),b("div",j,[f("div",T,y(U.value?"Taking a break":"Focus session"),1)]))])]),_:1})):k("",!0),p(t,{align:"center"},{default:m(()=>[F.value||P.value?k("",!0):(c(),i(o,{key:0,color:"primary",label:"Start",icon:"play_arrow",onClick:Y})),F.value?(c(),b(h,{key:1},[p(o,{color:"negative",label:"Stop",icon:"stop",onClick:oe}),N.value?(c(),i(o,{key:1,color:"primary",label:"Resume",icon:"play_arrow",onClick:ae})):(c(),i(o,{key:0,color:"grey",label:"Pause",icon:"pause",onClick:le})),p(o,{color:"primary",flat:"",label:"Focus Mode",icon:"fullscreen",onClick:ce})],64)):k("",!0),P.value?(c(),i(o,{key:2,color:"primary",label:"Start New Session",icon:"refresh",onClick:se})):k("",!0),F.value?k("",!0):(c(),i(o,{key:3,flat:"",label:"Close",color:"grey",onClick:ue}))]),_:1})]),_:1}))}};export{$ as default};
