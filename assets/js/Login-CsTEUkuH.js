import{a7 as e,f as a,o as s,N as t,J as o,b as r,z as l,a4 as n,K as i,Q as m,O as c,V as d,I as u,W as p,P as g,U as f,a0 as w,F as h}from"./vendor-nQjeLEvd.js";import{A as b}from"./AuthenticationCard-DhnKwTDs.js";import{_ as y}from"./AuthenticationCardLogo-ChtFmYpG.js";import{_ as v}from"./Checkbox-CVlnRiNm.js";import{_ as x}from"./InputError-Cavcn2H3.js";import{_}from"./InputLabel-bFRC3oGQ.js";import{_ as S}from"./PrimaryButton-CsGumtxq.js";import{_ as j}from"./TextInput-Z6lyRUre.js";import"./app-ggGwxJON.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";const k={key:0,class:"mb-4 font-medium text-sm text-green-600"},I={key:0,class:"mt-4"},L={key:1,class:"block mt-4"},P={class:"flex items-center"},U={key:2,class:"flex items-center justify-end mt-4"},R={key:3,class:"mt-4 text-center text-sm text-gray-600"},V={__name:"Login",props:{canResetPassword:Boolean,status:String},setup(V){const A="myclass_user_email",F="myclass_school_slug",q=e({email:"",password:"",remember:!1}),B=a(!1);async function C(){if(q.email&&!(q.email.length<3)){B.value=!0;try{const e=await axios.post(route("detect.school"),{email:q.email});if(e.data.redirect){localStorage.setItem(A,q.email),localStorage.setItem(F,e.data.school_slug);let a=e.data.redirect;const s=new URLSearchParams;s.append("email",q.email);const t=new URLSearchParams(window.location.search).get("intended");t&&s.append("intended",t),a+="?"+s.toString(),window.location.href=a}}catch(e){console.log("No school detected, using default login")}finally{B.value=!1}}}a(""),s(async()=>{const e=localStorage.getItem(A);e&&(q.email=e);const a=localStorage.getItem(F);if(a)try{const s=await axios.post(route("validate.school"),{slug:a});if(s.data.valid){let a=s.data.login_url;const t=new URLSearchParams;e&&t.append("email",e);const o=new URLSearchParams(window.location.search).get("intended");o&&t.append("intended",o),t.toString()&&(a+="?"+t.toString()),window.location.href=a}else localStorage.removeItem(F)}catch(s){localStorage.removeItem(F)}});const E=()=>{q.transform(e=>({...e,remember:q.remember?"on":""})).post(route("login"),{onFinish:()=>q.reset("password")})};return(e,a)=>(o(),t(h,null,[r(l(n),{title:"Log in"}),r(b,null,{logo:i(()=>[r(y)]),default:i(()=>[V.status?(o(),t("div",k,d(V.status),1)):m("",!0),c("form",{onSubmit:w(E,["prevent"])},[c("div",null,[r(_,{for:"email",value:"Email"}),r(j,{id:"email",modelValue:l(q).email,"onUpdate:modelValue":a[0]||(a[0]=e=>l(q).email=e),class:"mt-1 block w-full",required:"",autofocus:"",autocomplete:"username",onBlur:C},null,8,["modelValue"]),r(x,{class:"mt-2",message:l(q).errors.email},null,8,["message"])]),B.value?m("",!0):(o(),t("div",I,[r(_,{for:"password",value:"Password"}),r(j,{id:"password",modelValue:l(q).password,"onUpdate:modelValue":a[1]||(a[1]=e=>l(q).password=e),type:"password",class:"mt-1 block w-full",required:"",autocomplete:"current-password"},null,8,["modelValue"]),r(x,{class:"mt-2",message:l(q).errors.password},null,8,["message"])])),B.value?m("",!0):(o(),t("div",L,[c("label",P,[r(v,{checked:l(q).remember,"onUpdate:checked":a[2]||(a[2]=e=>l(q).remember=e),name:"remember"},null,8,["checked"]),a[3]||(a[3]=c("span",{class:"ms-2 text-sm text-gray-600"},"Remember me",-1))])])),B.value?m("",!0):(o(),t("div",U,[V.canResetPassword?(o(),u(l(g),{key:0,href:e.route("password.request"),class:"underline text-sm text-gray-600 hover:text-gray-900 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},{default:i(()=>a[4]||(a[4]=[p(" Forgot your password? ")])),_:1},8,["href"])):m("",!0),r(S,{class:f(["ms-4",{"opacity-25":l(q).processing}]),disabled:l(q).processing},{default:i(()=>a[5]||(a[5]=[p(" Log in ")])),_:1},8,["class","disabled"])])),B.value?(o(),t("div",R," Detecting your school... ")):m("",!0)],32)]),_:1})],64))}};export{V as default};
