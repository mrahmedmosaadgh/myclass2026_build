const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/TopLeaderboard-BJGKiX2T.js","assets/js/app-CCwy2VVq.js","assets/js/vendor-BWKGNkNB.js","assets/js/offline-BzIlwqNM.js","assets/js/i18n-B0T1C7j3.js","assets/js/ui-B7TfxbV_.js","assets/css/app-o3SF-dGU.css","assets/js/QSelect-DZElG_R-.js","assets/js/rtl-Cr6c3OOr.js","assets/js/html2canvas.esm-Cq3pa7K9.js","assets/css/TopLeaderboard-Dw9a8_8K.css","assets/js/BehaviorIncidents-D5pRcNmg.js","assets/js/QBtnToggle-BvACGp_T.js","assets/js/QBadge-BmqcVL7P.js","assets/js/QToolbar-DxEXUWjs.js","assets/js/StudentCard-Cr9YaeTb.js","assets/js/AvatarManager-CixHYCoz.js","assets/js/CameraCapture-Dnqkv08W.js","assets/js/QFile-Dt6Is0Z6.js","assets/js/use-file-bC8hQva8.js","assets/js/QImg-BuaN7zGZ.js","assets/css/CameraCapture-BSPKVu_J.css","assets/css/AvatarManager-C1Pqt1hB.css","assets/css/StudentCard-DXXgkWNV.css","assets/js/IncidentPrintReport-Bv8Fl0To.js","assets/css/IncidentPrintReport-BcWCgfP6.css","assets/js/StudentGrouping-CSk8xccd.js","assets/js/vuedraggable.umd-DshT_Vng.js","assets/js/index-SlSKjXnq.js","assets/css/StudentGrouping-CRYXuU7Q.css"])))=>i.map(i=>d[i]);
import{r as e,u as a,f as t,Q as l,p as s,b as o,t as n,d as r,i,j as d,k as u,c,aR as v,e as m,o as p,l as g,g as b,h as f,_ as y,G as h,aS as x,s as w,m as _}from"./app-CCwy2VVq.js";import{Q as S}from"./QBtnToggle-BvACGp_T.js";import{Q as k}from"./QBadge-BmqcVL7P.js";import{Q as $}from"./QTab-Bsf5uinQ.js";import{Q as I}from"./QTabs-Ddh79dFw.js";import{Q as C}from"./QTabPanel-D3EMF9t6.js";import{Q as j}from"./QTabPanels-C7WMGDee.js";import{Q as A}from"./QSpace-B14M_epf.js";import{Q as V}from"./QSelect-DZElG_R-.js";import{u as z}from"./i18n-B0T1C7j3.js";import{_ as P,f as E,o as T,k as D,M as F,a as U,af as R,N as q,J as N,b as B,R as L,I as O,O as Q,K as M,V as W,z as H,l as G,W as Y,F as J,Q as Z,S as K,y as X,E as ee,ag as ae,ah as te,aS as le,U as se}from"./vendor-BWKGNkNB.js";import oe from"./PointsDisplaySettings-AxzPghsb.js";import ne from"./TimerRandomTools-C7Vy33K5.js";import re from"./ClassroomHelper-BrtlPVNK.js";import ie from"./StudentCard-Cr9YaeTb.js";import de from"./noise-DnN8h27T.js";import"./offline-BzIlwqNM.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";import"./use-panel-Bv0wrwFr.js";import"./use-render-cache-CmTcazfP.js";import"./QCircularProgress-BESIVsJq.js";import"./QTd-C7BujuXw.js";import"./QTable-CLyjuksl.js";import"./QMarkupTable-BdH3AZt5.js";import"./QLinearProgress--xrLPDag.js";import"./use-fullscreen-CGCy_LR0.js";import"./AvatarManager-CixHYCoz.js";import"./CameraCapture-Dnqkv08W.js";import"./QFile-Dt6Is0Z6.js";import"./use-file-bC8hQva8.js";import"./QImg-BuaN7zGZ.js";const ue="/api",ce={behaviors:`${ue}/behaviors`,studentBehaviors:`${ue}/student-behaviors`,pointActions:`${ue}/student-behaviors-point-actions`,leaderboard:`${ue}/leaderboard`,studentSummary:e=>`${ue}/student-behaviors/${e}/summary`,pointActionStatistics:e=>`${ue}/student-behaviors/${e}/statistics`,attendance:`${ue}/student-attendance`,attendanceBatch:`${ue}/student-attendance/batch`};async function ve({classroomId:e,startDate:a,endDate:t,limit:l=10}){var s,o;try{const s=await P.get(ce.leaderboard,{params:{classroom_id:e,start_date:a,end_date:t,limit:Math.min(l,50)}});return{success:!0,data:Array.isArray(s.data)?s.data:[]}}catch(n){return console.error("Error fetching leaderboard:",n),{success:!1,error:(null==(o=null==(s=n.response)?void 0:s.data)?void 0:o.message)||"Failed to fetch leaderboard",data:[],details:n}}}const me={addPoint:async function(e,a,t=null,l=""){var s,o;try{const s={student_behaviors_id:e,value:parseInt(a),reason_id:t?parseInt(t):null,note:l||null};return{success:!0,data:(await P.post(ce.pointActions,s)).data,message:`Point ${a>0?"added":"deducted"} successfully`}}catch(n){return console.error("Error adding point:",n),{success:!1,error:(null==(o=null==(s=n.response)?void 0:s.data)?void 0:o.message)||"Failed to add point",details:n}}},cancelPoint:async function(e,a){var t,l;try{return{success:!0,data:(await P.post(`${ce.pointActions}/${e}/cancel`,{cancel_reason:a})).data,message:"Point action canceled successfully"}}catch(s){return console.error("Error canceling point:",s),{success:!1,error:(null==(l=null==(t=s.response)?void 0:t.data)?void 0:l.message)||"Failed to cancel point",details:s}}},restorePoint:async function(e){var a,t;try{return{success:!0,data:(await P.post(`${ce.pointActions}/${e}/restore`)).data,message:"Point action restored successfully"}}catch(l){return console.error("Error restoring point:",l),{success:!1,error:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||"Failed to restore point",details:l}}},deletePoint:async function(e){var a,t;try{return{success:!0,data:(await P.delete(`${ce.pointActions}/${e}`)).data,message:"Point action deleted successfully"}}catch(l){return console.error("Error deleting point:",l),{success:!1,error:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||"Failed to delete point",details:l}}},createStudentBehavior:async function(e){var a,t;try{const a={school_id:e.schoolId,student_behaviors_mains_id:e.studentBehaviorsMainsId,student_id:e.studentId,attend:e.attend||null,points_plus:e.pointsPlus||0,points_minus:e.pointsMinus||0,points_details:e.pointsDetails||"",notes:e.notes||null};return{success:!0,data:(await P.post(ce.studentBehaviors,a)).data,message:"Student behavior record created successfully"}}catch(l){return console.error("Error creating student behavior:",l),{success:!1,error:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||"Failed to create behavior record",details:l}}},getStudentSummary:async function(e){var a,t;try{return{success:!0,data:(await P.get(ce.studentSummary(e))).data}}catch(l){return console.error("Error fetching student summary:",l),{success:!1,error:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||"Failed to fetch student summary",details:l}}},getPointActions:async function(e){var a,t;try{return{success:!0,data:(await P.get(ce.pointActions,{params:{student_behaviors_id:e}})).data}}catch(l){return console.error("Error fetching point actions:",l),{success:!1,error:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||"Failed to fetch point actions",details:l}}},getPointStatistics:async function(e){var a,t;try{return{success:!0,data:(await P.get(`${ce.pointActions}/statistics/${e}`)).data}}catch(l){return console.error("Error fetching point statistics:",l),{success:!1,error:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||"Failed to fetch statistics",details:l}}},fetchBehaviors:async function(){var e,a;try{const e=await P.get(ce.behaviors);return{success:!0,data:Array.isArray(e.data)?e.data:[]}}catch(t){return console.error("Error fetching behaviors:",t),{success:!1,error:(null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.message)||"Failed to fetch behaviors",data:[],details:t}}},applyBehaviorToStudents:async function(e,a,t={}){var l,s,o,n,r,i,d,u,c,v,m,p,g,b;try{const g=[],b=[],y="object"==typeof a?a.id:a;if(console.log("üéØ applyBehaviorToStudents called with:",{studentCount:e.length,behaviorIdInput:a,actualBehaviorId:y,behaviorIdType:typeof a}),!y||isNaN(y))return console.error("‚ùå Invalid behavior ID:",a),{success:!1,error:"Invalid behavior ID provided"};for(const a of e){const e={student_id:a,behavior_id:y,date:t.date||(new Date).toISOString().split("T")[0],period_code:t.periodCode||null,points_mode:t.points_mode||"session",notes:t.notes||null};console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"),console.log("üì§ Sending behavior application request"),console.log("   Student ID:",a),console.log("   Behavior ID:",y),console.log("   Date:",e.date),console.log("   Period Code:",e.period_code),console.log("   Payload:",JSON.stringify(e,null,2)),console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");try{const t=await P.post(`${ue}/student-behaviors/quick-create`,e);console.log("‚úÖ SUCCESS - Behavior applied for student:",a),console.log("   Response Status:",t.status),console.log("   Response Data:",t.data),g.push({studentId:a,success:!0,data:t.data})}catch(f){console.error("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"),console.error("‚ùå FAILED - Error applying behavior to student:",a),console.error("   HTTP Status:",null==(l=f.response)?void 0:l.status,null==(s=f.response)?void 0:s.statusText),console.error("   Error Message:",null==(n=null==(o=f.response)?void 0:o.data)?void 0:n.message),console.error("   Error Details:",null==(i=null==(r=f.response)?void 0:r.data)?void 0:i.error),console.error("   Validation Errors:",null==(u=null==(d=f.response)?void 0:d.data)?void 0:u.errors),console.error("   Full Response:",null==(c=f.response)?void 0:c.data),console.error("   Sent Payload:",e),console.error("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"),b.push({studentId:a,success:!1,error:(null==(m=null==(v=f.response)?void 0:v.data)?void 0:m.message)||"Failed to apply behavior",fullError:null==(p=f.response)?void 0:p.data})}}return console.log("üéØ BATCH RESULT:",{totalRequests:e.length,successful:g.length,failed:b.length,successRate:`${Math.round(g.length/e.length*100)}%`}),{success:0===b.length,results:g,errors:b,message:`Applied to ${g.length}/${e.length} students`}}catch(y){return console.error("‚ùå OUTER ERROR - Exception in applyBehaviorToStudents:",y),{success:!1,error:(null==(b=null==(g=y.response)?void 0:g.data)?void 0:b.message)||"Failed to apply behavior",details:y}}},fetchLeaderboard:ve,getTopStudentsByPeriod:async function({classroomId:e,period:a="week",limit:t=5}){try{const l=new Date;let s;switch(a){case"week":default:s=new Date(l.getTime()-6048e5);break;case"month":s=new Date(l.getFullYear(),l.getMonth(),1);break;case"all":s=new Date("2020-01-01")}const o=e=>e.toISOString().split("T")[0];return ve({classroomId:e,startDate:o(s),endDate:o(l),limit:t})}catch(l){return console.error("Error getting top students:",l),{success:!1,error:"Failed to get top students",data:[],details:l}}},updateAttendance:async function(e,a,t={}){var l,s,o;try{const r={student_id:parseInt(e),attend:Boolean(a),date:t.date||(new Date).toISOString().split("T")[0],period_code:t.periodCode||null,classroom_id:t.classroomId||null};try{const e=await P.post(ce.attendance,r);return{success:!0,data:e.data,message:(null==(l=e.data)?void 0:l.message)||"Student marked as "+(a?"present":"absent")}}catch(n){return console.warn("Attendance API call failed, falling back to client-only update:",null==(s=null==n?void 0:n.response)?void 0:s.status),{success:!0,data:{studentId:parseInt(e),isPresent:Boolean(a),updatedAt:(new Date).toISOString()},message:`Student marked as ${a?"present":"absent"} (local)`,warning:(null==(o=n.response)?void 0:o.data)||n.message}}}catch(r){return console.error("Error updating attendance:",r),{success:!1,error:"Failed to update attendance",details:r}}},batchUpdateAttendance:async function(e,a={}){var t,l,s;try{if(!e||"object"!=typeof e)return{success:!1,error:"Invalid attendance data"};const n=Object.entries(e).map(([e,t])=>({student_id:parseInt(e),attend:Boolean(t),date:a.date||(new Date).toISOString().split("T")[0],period_code:a.periodCode||null,classroom_id:a.classroomId||null,updated_at:(new Date).toISOString()}));try{const e=await P.post(ce.attendanceBatch,{attendance:n});return{success:!0,data:e.data,message:(null==(t=e.data)?void 0:t.message)||`Updated attendance for ${n.length} students`}}catch(o){return console.warn("Batch attendance API call failed, falling back to local update:",null==(l=null==o?void 0:o.response)?void 0:l.status),{success:!0,data:n,message:`Updated attendance for ${n.length} students (local)`,warning:(null==(s=o.response)?void 0:s.data)||o.message}}}catch(n){return console.error("Error batch updating attendance:",n),{success:!1,error:"Failed to batch update attendance",details:n}}},getRecentActions:async function({classroomId:e,date:a,limit:t=10}){var l,s;try{const l=await P.get(`${ue}/student-behaviors/recent-actions`,{params:{classroom_id:e,date:a,limit:t}});return{success:!0,data:Array.isArray(l.data.data)?l.data.data:[]}}catch(o){return console.error("Error fetching recent actions:",o),{success:!1,error:(null==(s=null==(l=o.response)?void 0:l.data)?void 0:s.message)||"Failed to fetch recent actions",data:[]}}},undoAction:async function(e,a="Undone by teacher"){var t,l;try{const t=await P.post(`${ue}/student-behaviors/actions/${e}/cancel`,{cancel_reason:a});return{success:!0,data:t.data.data,message:t.data.message||"Action undone successfully"}}catch(s){return console.error("Error undoing action:",s),{success:!1,error:(null==(l=null==(t=s.response)?void 0:t.data)?void 0:l.message)||"Failed to undo action"}}},formatPointValue:function(e){return e>0?`+${e} ‚≠ê`:e<0?`${e} ‚ö†Ô∏è`:"0"},getActionTypeLabel:function(e){return{plus:"Added",minus:"Deducted",cancel:"Canceled",revoke:"Revoked"}[e]||e},calculateTotalPoints:function(e,a=!1){return Array.isArray(e)?e.filter(e=>a||!e.canceled).reduce((e,a)=>e+(a.value||0),0):0},separatePoints:function(e){if(!Array.isArray(e))return{positive:0,negative:0};const a=e.filter(e=>!e.canceled);return{positive:a.filter(e=>e.value>0).reduce((e,a)=>e+a.value,0),negative:Math.abs(a.filter(e=>e.value<0).reduce((e,a)=>e+a.value,0))}},isActionEditable:function(e,a=24){try{const t=new Date(e);return(new Date-t)/36e5<a}catch(t){return!1}},getUserFriendlyErrorMessage:function(e){var a,t,l,s,o,n,r;return 401===(null==(a=e.response)?void 0:a.status)?"You are not authenticated. Please log in.":403===(null==(t=e.response)?void 0:t.status)?"You do not have permission to perform this action.":404===(null==(l=e.response)?void 0:l.status)?"The requested resource was not found.":422===(null==(s=e.response)?void 0:s.status)?"Invalid data provided. Please check your input.":500===(null==(o=e.response)?void 0:o.status)?"Server error. Please try again later.":"Network Error"===e.message?"Network error. Please check your connection.":(null==(r=null==(n=e.response)?void 0:n.data)?void 0:r.message)||"An unexpected error occurred."},retryWithBackoff:async function(e,a=3,t=1e3){let l;for(let o=0;o<a;o++)try{return await e()}catch(s){if(l=s,o<a-1){const e=t*Math.pow(2,o);await new Promise(a=>setTimeout(a,e))}}throw l}},pe=new Map;async function ge(e){const a=Object.entries(e).map(([e,a])=>pe.has(e)?Promise.resolve():new Promise(t=>{const l=new Audio(a);l.addEventListener("canplaythrough",()=>{pe.set(e,l),t()},{once:!0}),l.addEventListener("error",()=>{console.warn(`Failed to preload sound "${e}"`),t()},{once:!0}),l.load()}));await Promise.all(a)}const be={class:"p-6 space-y-6 bg-gradient-to-br from-gray-800 to-gray-900 min-h-screen"},fe={class:"text-3xl font-bold"},ye={class:"text-blue-100"},he={class:"flex items-center justify-between bg-white p-4 rounded-lg border border-gray-200 shadow-sm"},xe={class:"flex items-center gap-4"},we={class:"bg-blue-100 p-3 rounded-full text-blue-600"},_e={class:"text-sm text-gray-500 font-medium"},Se={class:"text-lg font-bold text-gray-800 flex items-center gap-2"},ke={key:0},$e={key:1,class:"text-gray-400 italic"},Ie={class:"text-blue-600 font-mono bg-blue-50 px-2 py-0.5 rounded text-base"},Ce={class:"text-xs text-gray-500 mt-1"},je={key:0,class:"bg-gradient-to-r from-blue-50 to-indigo-50 p-3 rounded-lg border border-blue-200 shadow-sm"},Ae={class:"flex items-center justify-between flex-wrap gap-3"},Ve={class:"flex items-center gap-2"},ze={class:"text-sm font-bold text-gray-700"},Pe={class:"flex items-center gap-3 flex-wrap"},Ee={key:0,class:"text-xs text-gray-500 bg-white px-2 py-1 rounded border border-dashed border-gray-300"},Te={class:"flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg border border-blue-200"},De={class:"flex flex-col"},Fe={class:"text-xs text-gray-500"},Ue={class:"text-lg font-bold text-blue-600"},Re={class:"flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg border border-green-200"},qe={class:"flex flex-col"},Ne={class:"text-xs text-gray-500"},Be={class:"text-lg font-bold text-green-600"},Le={class:"flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg border border-red-200"},Oe={class:"flex flex-col"},Qe={class:"text-xs text-gray-500"},Me={class:"text-lg font-bold text-red-600"},We={key:0,class:"mt-3 pt-3 border-t border-blue-200"},He={class:"text-xs font-semibold text-gray-600 mb-2 flex items-center gap-1"},Ge={class:"bg-white border border-red-200 rounded-lg p-2"},Ye={class:"flex flex-wrap gap-1.5"},Je={class:"sticky top-0 z-50 bg-white shadow-md border-b border-gray-200"},Ze={class:"q-pa-sm flex justify-between items-center flex-nowrap gap-2"},Ke={class:"flex items-center gap-2 flex-nowrap overflow-hidden"},Xe={class:"row no-wrap q-pa-md"},ea={key:0},aa={key:1,class:"column items-center",style:{"min-width":"180px"}},ta={class:"column q-gutter-y-sm full-width"},la={class:"q-py-sm"},sa={key:0,class:"flex items-center gap-1 overflow-hidden"},oa={class:"flex items-center gap-2"},na={style:{width:"420px","max-width":"90vw"}},ra={class:"row q-col-gutter-sm"},ia=["onClick"],da={class:"column items-center q-pa-sm bg-blue-50 rounded-xl border border-blue-100 shadow-sm hover:shadow-md hover:bg-blue-100 transition-all text-center h-full relative-position"},ua={class:"text-caption text-weight-bold text-grey-9 ellipsis-2-lines leading-tight min-h-[2.5em] flex items-center justify-center"},ca={class:"absolute-top-right q-ma-xs"},va={class:"row q-col-gutter-sm"},ma=["onClick"],pa={class:"column items-center q-pa-sm bg-red-50 rounded-xl border border-red-100 shadow-sm hover:shadow-md hover:bg-red-100 transition-all text-center h-full relative-position"},ga={class:"text-caption text-weight-bold text-grey-9 ellipsis-2-lines leading-tight min-h-[2.5em] flex items-center justify-center"},ba={class:"absolute-top-right q-ma-xs"},fa={key:0,class:"bg-orange-50 p-1 text-center border-b border-orange-100 text-xs text-orange-800 font-bold"},ya={class:"space-y-4"},ha={class:"flex justify-between items-center mb-4"},xa={class:"text-xl font-bold"},wa={class:"flex gap-2"},_a={class:"flex flex-wrap justify-center gap-6 p-4 bg-gray-400"},Sa={class:""},ka={class:"mt-6"},$a={class:"mb-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200 shadow-sm"},Ia={class:"flex items-center justify-between flex-wrap gap-3"},Ca={class:"flex items-center gap-2"},ja={class:"font-bold text-gray-700"},Aa={class:"flex items-center gap-2 flex-wrap"},Va={class:"row items-center q-gutter-x-sm"},za={class:"font-bold"},Pa={class:"font-bold"},Ea={class:"text-h6"},Ta={key:0,class:"text-gray-500 italic text-center py-4"},Da=["src"],Fa={key:0,class:"mb-3 p-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg border border-indigo-200"},Ua={class:"flex items-center justify-between"},Ra={class:"font-bold text-indigo-900 flex items-center gap-2"},qa={class:"flex gap-2"},Na={class:"flex flex-wrap justify-center gap-4"},Ba={class:"space-y-4"},La={class:"mb-4"},Oa={class:"text-xl font-bold mb-2"},Qa={class:"text-sm text-gray-600"},Ma={class:"p-4 bg-red-50 rounded-lg border border-red-200"},Wa={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Ha={class:"mt-2 text-sm"},Ga={class:"flex flex-wrap justify-center gap-6 p-4"},Ya={class:"space-y-4"},Ja={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Za=["onClick"],Ka={class:"flex items-start justify-between mb-3"},Xa={class:"flex-1"},et={class:"font-semibold text-lg"},at={class:"text-xs text-gray-600"},tt={key:0,class:"text-xs text-red-600 mt-1"},lt={class:"space-y-2"},st={class:"p-2 bg-green-100 rounded flex justify-between items-center"},ot={class:"text-sm font-bold text-green-900"},nt={class:"p-2 bg-red-100 rounded flex justify-between items-center"},rt={class:"text-sm font-bold text-red-900"},it={class:"p-2 bg-blue-100 rounded flex justify-between items-center"},dt={class:"text-lg font-bold text-blue-600"},ut={class:"space-y-4"},ct={class:"flex justify-between items-center mb-4"},vt={class:"text-xl font-bold"},mt={key:0,class:"text-center py-8"},pt={class:"text-gray-500 text-lg"},gt={class:"flex items-start justify-between"},bt={class:"flex-1"},ft={class:"flex items-center gap-2 mb-1"},yt={class:"font-bold text-lg"},ht={class:"text-2xl"},xt={class:"text-sm text-gray-700"},wt={class:"text-xs text-gray-500 mt-1"},_t={key:0,class:"text-xs text-gray-600 mt-1 italic"},St={key:1,class:"text-xs text-red-600 mt-1"},kt={class:"flex flex-col h-full gap-4"},$t={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},It={class:"space-y-6"},Ct={class:"flex justify-between items-center mb-6"},jt={class:"text-2xl font-bold text-gray-800"},At={class:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200"},Vt={class:"flex items-center gap-3 mb-4"},zt={class:"text-xl font-bold text-green-800"},Pt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Et={class:"flex items-start justify-between mb-2"},Tt={class:"flex items-center gap-2"},Dt={class:"text-3xl"},Ft={class:"font-bold text-gray-800"},Ut={class:"text-xs text-gray-500"},Rt={class:"flex gap-1"},qt={class:"flex items-center justify-between mt-3 pt-3 border-t border-green-100"},Nt={class:"text-lg font-bold text-green-600"},Bt={key:0,class:"text-center py-8 text-gray-400"},Lt={class:"bg-gradient-to-r from-red-50 to-rose-50 rounded-xl p-6 border border-red-200"},Ot={class:"flex items-center gap-3 mb-4"},Qt={class:"text-xl font-bold text-red-800"},Mt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Wt={class:"flex items-start justify-between mb-2"},Ht={class:"flex items-center gap-2"},Gt={class:"text-3xl"},Yt={class:"font-bold text-gray-800"},Jt={class:"text-xs text-gray-500"},Zt={class:"flex gap-1"},Kt={class:"flex items-center justify-between mt-3 pt-3 border-t border-red-100"},Xt={class:"text-lg font-bold text-red-600"},el={key:0,class:"text-center py-8 text-gray-400"},al={class:"text-2xl font-semibold text-gray-600"},tl={class:"p-4 border-b border-blue-200 bg-blue-100/50"},ll={class:"font-bold text-blue-900 flex items-center gap-2 text-lg"},sl={class:"flex-1 overflow-y-auto p-4 custom-scrollbar"},ol={key:0,class:"text-center py-8 text-gray-400 italic text-sm"},nl={key:1,class:"flex flex-col gap-2"},rl={class:"flex flex-col leading-tight overflow-hidden w-full"},il={class:"font-bold text-2xl truncate"},dl={class:"text-sm opacity-80 truncate"},ul={class:"p-3 border-t border-blue-200 bg-white"},cl={class:"grid grid-cols-3 gap-2"},vl={class:"flex-1 flex flex-col bg-white"},ml={class:"text-h6 font-bold flex items-center gap-2"},pl={class:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3"},gl=["onClick"],bl={class:"font-bold text-xl leading-tight text-gray-800 line-clamp-2"},fl={class:"flex justify-between items-center"},yl={class:"text-h6"},hl=e({__name:"reward_sys",props:{isDialog:{type:Boolean,default:!1},classroomId:{type:Number,default:null},subjectId:{type:Number,default:null},period:{type:Number,default:null},date:{type:String,default:null},week:{type:Number,default:null},initialTab:{type:String,default:"positive"}},setup(e){const ue=e,ce=le(()=>y(()=>import("./TopLeaderboard-BJGKiX2T.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),ve=le(()=>y(()=>import("./BehaviorIncidents-D5pRcNmg.js"),__vite__mapDeps([11,1,2,3,4,5,6,12,13,14,7,8,15,16,17,18,19,20,21,22,23,24,25]))),hl=le(()=>y(()=>import("./StudentGrouping-CSk8xccd.js"),__vite__mapDeps([26,1,2,3,4,5,6,27,28,29]))),xl={select:"/audio/click-234708.mp3",reward:"/audio/purchase-success-384963.mp3",penalty:"/audio/error-010-206498.mp3"},wl=E(null),_l=E(!1);T(()=>{!function(e){"requestIdleCallback"in window?requestIdleCallback(()=>ge(e),{timeout:2e3}):setTimeout(()=>ge(e),1e3)}(xl);const e=localStorage.getItem("reward-system-bg-music");_l.value="true"===e,wl.value&&(wl.value.volume=.1,_l.value&&wl.value.play().catch(e=>console.log("Autoplay prevented:",e)))}),D(_l,e=>{localStorage.setItem("reward-system-bg-music",e),wl.value&&(e?wl.value.play().catch(e=>console.log("Playback error:",e)):wl.value.pause())});const Sl=e=>{!async function(e,a){if(!a[e])return void console.warn(`Sound key "${e}" not found in soundFiles`);if(!pe.has(e)){const t=new Audio(a[e]);await new Promise((e,a)=>{t.addEventListener("canplaythrough",e,{once:!0}),t.addEventListener("error",a,{once:!0}),t.load()}).catch(a=>{console.warn(`Failed to load sound "${e}":`,a)}),pe.set(e,t)}const t=pe.get(e);t&&(t.currentTime=0,t.play().catch(e=>console.log("Sound play error:",e)))}(e,xl)},{t:kl,locale:$l}=z(),Il=e=>e?"ar"===$l.value&&e.name_ar?e.name_ar:e.name:"",Cl=F(),jl=U(()=>{var e,a;const t=null==(a=null==(e=Cl.props.auth)?void 0:e.user)?void 0:a.school;return Array.isArray(t)&&t.length>0?t[0].logo_url:null}),Al=U(()=>{const e=new Map;return Fl.value.forEach(a=>{a.subject_id&&!e.has(a.subject_id)&&e.set(a.subject_id,{id:a.subject_id,name:a.subject_name,name_ar:a.subject_name_ar})}),Array.from(e.values())});U(()=>Nl.value?Fl.value.filter(e=>e.subject_id===Nl.value):[]);const Vl=U(()=>{const e=Ul.value.length;if(0===e)return{present:0,absent:0,absentList:[]};const a=Ul.value.filter(e=>Jl.value[e.id]).length;return{present:a,absent:e-a,absentList:Ul.value.filter(e=>!Jl.value[e.id])}}),zl=()=>{const e=Vl.value.absentList.map(e=>"ar"===$l.value&&e.name_ar?e.name_ar:e.name).join("\n");e&&navigator.clipboard.writeText(e).then(()=>{Pl.notify({message:kl("rewardSys.session.copied"),color:"positive",icon:"content_copy",position:"top"})}).catch(e=>{console.error("Failed to copy: ",e)})};E("https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf");const Pl=a(),El=E(ue.initialTab||"positive"),Tl=E("positive");D(()=>ue.initialTab,e=>{e&&(El.value=e)});const Dl=E("behavior_incidents");D(El,(e,a)=>{localStorage.setItem("reward-system-active-tab",e),e!==a&&(Gl.value=[])});const Fl=E([]),Ul=E([]),Rl=E([]),ql=E(null),Nl=E(null),Bl=E((new Date).toISOString().split("T")[0]),Ll=E(1),Ol=E(1),Ql=E(1),Ml=E(1),Wl=E(null),Hl=E(null),Gl=E([]),Yl=E({}),Jl=E({}),Zl=E({}),Kl=E([]);E([]);const Xl=E(!1),es=E(!1),as=E(!1),ts=E(!1),ls=E(!1),ss=E(null),os=E(null),ns=E({message:"",created:0,skipped:0}),rs=E(!1),is=E(!1),ds=E(!1),us=E("positive"),cs=E(null),vs=E("no_groups"),ms=E([]),ps=E(!1),gs=E(null),bs=E(!1),fs=E(localStorage.getItem("points-display-mode")||"overall"),ys=E({}),hs=E(localStorage.getItem("competition-start-time")||null),xs=E(localStorage.getItem("custom-date-from")||null),ws=E(localStorage.getItem("custom-date-to")||null),_s=E(localStorage.getItem("leaderboard-mode")||"top5"),Ss=E(!1),ks=E(null),$s=E(!1),Is=E({name:"",type:"positive",points:0,icon:""});D(Nl,e=>{null!==e&&(localStorage.setItem("reward-system-selected-subject-id",e.toString()),console.log(`üíæ Saved subject to localStorage: ${e}`))}),D(ql,e=>{null!==e&&(localStorage.setItem("reward-system-selected-classroom-id",e.toString()),console.log(`üíæ Saved classroom to localStorage: ${e}`))}),D(Ll,e=>{null!==e&&(localStorage.setItem("reward-system-selected-semester",e.toString()),console.log(`üíæ Saved semester to localStorage: ${e}`))}),D(Ol,e=>{null!==e&&(localStorage.setItem("reward-system-selected-week",e.toString()),console.log(`üíæ Saved week to localStorage: ${e}`))}),D(Ql,e=>{null!==e&&(localStorage.setItem("reward-system-selected-day",e.toString()),console.log(`üíæ Saved day to localStorage: ${e}`))}),D(Ml,e=>{null!==e&&(localStorage.setItem("reward-system-selected-period-number",e.toString()),console.log(`üíæ Saved period number to localStorage: ${e}`))}),D(Bl,e=>{if(e){const a=new Date(e);Ql.value=a.getDay()+1,console.log(`üìÖ Date changed to ${e}, Day updated to ${Ql.value}`)}});const Cs=U(()=>`${Ll.value}.${Ol.value}.${Ql.value}.${Ml.value}`);U(()=>{const e=Fl.value.find(e=>e.classroom_id===ql.value);return e?e.classroom_name:kl("rewardSys.session.unknownClass")}),U(()=>{const e=Al.value.find(e=>e.subject_id===Nl.value);return e?"ar"===$l.value&&e.subject_name_ar?e.subject_name_ar:e.subject_name:""});const js=U(()=>Ul.value.filter(e=>Jl.value[e.id]).length),As=U(()=>Ul.value.filter(e=>!Jl.value[e.id]).length),Vs=E(!1),zs=E("present"),Ps=U(()=>Ul.value.filter(e=>"present"===zs.value?Jl.value[e.id]:!Jl.value[e.id]));function Es(e){zs.value=e,Vs.value=!0}function Ts(){const e=Ps.value.map(e=>e.name).join("\n");navigator.clipboard.writeText(e).then(()=>{})}function Ds(e){return e.avatar?e.avatar.startsWith("/")?e.avatar:`/${e.avatar}`:"/images/avatars/default-avatar.svg"}const Fs=U(()=>{console.log("üîç All behaviors:",Rl.value);const e=Rl.value.filter(e=>{if(e.type)return"positive"===e.type||"reward"===e.type;return(e.value||e.points||0)>0});return console.log("‚úÖ Positive behaviors:",e),e}),Us=U(()=>{const e=Rl.value.filter(e=>{if(e.type)return"negative"===e.type||"penalty"===e.type;return(e.value||e.points||0)<0});return console.log("‚ö†Ô∏è Negative behaviors:",e),e}),Rs=U(()=>[{label:"No Groups",value:"no_groups",icon:"grid_view"},{label:"Name (A‚ÜíZ)",value:"name_asc",icon:"sort_by_alpha"},{label:"Name (Z‚ÜíA)",value:"name_desc",icon:"sort_by_alpha"},...ms.value.map(e=>({label:e.name,value:e.id,icon:"groups"}))]);U(()=>{const e=Rs.value.find(e=>e.value===vs.value);return(null==e?void 0:e.icon)||"grid_view"});const qs=U(()=>{if("no_groups"===vs.value)return[{name:null,students:Ul.value}];if("name_asc"===vs.value){return[{name:null,students:[...Ul.value].sort((e,a)=>(e.firstName||"").localeCompare(a.firstName||""))}]}if("name_desc"===vs.value){return[{name:null,students:[...Ul.value].sort((e,a)=>(a.firstName||"").localeCompare(e.firstName||""))}]}const e=ms.value.find(e=>e.id===vs.value);if(!e)return[{name:null,students:Ul.value}];const a=e.groups.map(e=>({name:e.name,students:Ul.value.filter(a=>e.student_ids.includes(a.id))})),t=new Set(e.groups.flatMap(e=>e.student_ids)),l=Ul.value.filter(e=>!t.has(e.id));return l.length>0&&a.push({name:"Unassigned",students:l}),a});function Ns(){const e=Ul.value.filter(e=>Jl.value[e.id]);Gl.value=e.map(e=>e.id)}function Bs(){const e=Ul.value.filter(e=>Jl.value[e.id]),a=new Set(Gl.value),t=[];e.forEach(e=>{a.has(e.id)||t.push(e.id)}),Gl.value=t}async function Ls(){cs.value&&("positive"===us.value?(Wl.value=cs.value,await async function(){await eo(Wl.value),Wl.value=null}()):(Hl.value=cs.value,await Xs()),ds.value=!1,cs.value=null)}async function Os(e){var a,t;const l=ms.value.findIndex(a=>a.id===e.id);l>=0?ms.value[l]=e:ms.value.push(e);try{const a=await P.post("/api/classroom-layouts/save",{classroom_id:ql.value,layouts:ms.value});if(!a.data.success)throw new Error(a.data.message||"Failed to save layout");Pl.notify({message:`Layout "${e.name}" saved successfully!`,color:"positive",position:"top",icon:"check_circle"}),vs.value=e.id,ps.value=!1,gs.value=null}catch(s){if(console.error("Error saving layout:",s),Pl.notify({message:"Failed to save layout: "+((null==(t=null==(a=s.response)?void 0:a.data)?void 0:t.message)||s.message),color:"negative",position:"top",icon:"error"}),l>=0)ms.value.splice(l,1);else{const a=ms.value.findIndex(a=>a.id===e.id);a>=0&&ms.value.splice(a,1)}}}async function Qs(e){var a,t;const l=ms.value.findIndex(a=>a.id===e);if(l<0)return;const s=ms.value[l];ms.value.splice(l,1),vs.value===e&&(vs.value="no_groups");try{const e=await P.post("/api/classroom-layouts/save",{classroom_id:ql.value,layouts:ms.value});if(!e.data.success)throw new Error(e.data.message||"Failed to delete layout");Pl.notify({message:`Layout "${s.name}" deleted successfully!`,color:"positive",position:"top",icon:"delete"})}catch(o){console.error("Error deleting layout:",o),Pl.notify({message:"Failed to delete layout: "+((null==(t=null==(a=o.response)?void 0:a.data)?void 0:t.message)||o.message),color:"negative",position:"top",icon:"error"}),ms.value.splice(l,0,s),"no_groups"===vs.value&&(vs.value=e)}}function Ms(e){e?(ks.value=e,Is.value={name:e.name,type:e.type||(e.value>0?"positive":"negative"),points:e.value||e.points||0,icon:e.icon||""}):(ks.value=null,Is.value={name:"",type:"positive",points:0,icon:""}),Ss.value=!0}async function Ws(){var e,a;if(Is.value.name&&Is.value.type&&null!==Is.value.points){$s.value=!0;try{const e={name:Is.value.name,name_ar:Is.value.name_ar||null,type:Is.value.type,value:Is.value.points,points:Is.value.points,icon:Is.value.icon||null,school_id:1,year_id:2};if(ks.value){const a=await P.put(`/api/behaviors/${ks.value.id}`,e),t=Rl.value.findIndex(e=>e.id===ks.value.id);t>=0&&(Rl.value[t]=a.data),Pl.notify({message:"Behavior updated successfully!",color:"positive",icon:"check_circle"})}else{const a=await P.post("/api/behaviors",e);Rl.value.push(a.data),Pl.notify({message:"Behavior created successfully!",color:"positive",icon:"check_circle"})}Ss.value=!1,ks.value=null}catch(t){console.error("Error saving behavior:",t),Pl.notify({message:"Failed to save behavior: "+((null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.message)||t.message),color:"negative",icon:"error"})}finally{$s.value=!1}}else Pl.notify({message:"Please fill in all required fields",color:"warning",position:"top"})}function Hs(e){Pl.dialog({title:"Confirm Delete",message:`Are you sure you want to delete "${e.name}"? This action cannot be undone.`,cancel:!0,persistent:!0,color:"negative"}).onOk(()=>{!async function(e){var a,t;try{await P.delete(`/api/behaviors/${e.id}`);const a=Rl.value.findIndex(a=>a.id===e.id);a>=0&&Rl.value.splice(a,1),Pl.notify({message:"Behavior deleted successfully!",color:"positive",icon:"check_circle"})}catch(l){console.error("Error deleting behavior:",l),Pl.notify({message:"Failed to delete behavior: "+((null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||l.message),color:"negative",icon:"error"})}}(e)})}function Gs(e){if(!Jl.value[e])return void Pl.notify({message:"Cannot select absent students",color:"warning",position:"top",timeout:1e3});const a=Gl.value.indexOf(e);-1===a?(Gl.value.push(e),Sl("select")):Gl.value.splice(a,1)}function Ys(e,a){if(a){const a=e.filter(e=>Jl.value[e.id]).map(e=>e.id),t=new Set(Gl.value);a.forEach(e=>t.add(e)),Gl.value=Array.from(t),Sl("select")}else{const a=new Set(e.map(e=>e.id));Gl.value=Gl.value.filter(e=>!a.has(e))}}function Js(){Gl.value=[]}async function Zs(e){if(!e)return Ul.value=[],Gl.value=[],void(ms.value=[]);try{es.value=!0,Ul.value=[],Gl.value=[],os.value=null,ns.value={message:"",created:0,skipped:0},await async function(){if(ql.value)try{const e=await P.get("/api/classroom-layouts/load",{params:{classroom_id:ql.value}});e.data.success&&(ms.value=e.data.data||[])}catch(e){console.error("Error loading layouts:",e)}}()}catch(a){console.error("Failed to load classroom:",a),Pl.notify({message:"Failed to load classroom: "+a.message,color:"negative",position:"top"})}finally{es.value=!1}}async function Ks(){if(ql.value){es.value=!0,ns.value={message:"Initializing...",created:0,skipped:0};try{const e={classroom_id:ql.value,date:Bl.value,period_code:Cs.value,points_mode:"from_now"===fs.value?"overall":fs.value},a=await P.post("/api/student-behaviors/init-classroom",e);if(a&&a.data){const e=a.data;os.value=e.student_behaviors_mains_id,ns.value={message:`Session initialized (created ${e.created}, skipped ${e.skipped}, mode: ${e.points_mode})`,created:e.created,skipped:e.skipped};const t=e.student_behaviors||[],l=t.map(e=>e.student?{id:e.student.id,name:e.student.name||`Student ${e.student_id}`,name_ar:e.student.name_ar,firstName:e.student.first_name,secondName:e.student.second_name,lastName:e.student.last_name,avatar:e.student.avatar,behaviorRecordId:e.id}:null).filter(e=>null!==e);Ul.value=l,Gl.value=[];const s={};for(const a of t)Jl.value[a.student_id]=void 0===a.attend||a.attend,s[a.student_id]={attend:void 0===a.attend||a.attend,points_plus:a.points_plus||0,points_minus:a.points_minus||0,academic_tracker:a.academic_tracker||{},behavior_tracker:a.behavior_tracker||[],logistics_tracker:a.logistics_tracker||{}};Yl.value=s,Pl.notify({message:"Session initialized",color:"positive",position:"top"}),await so()}}catch(e){console.error("Failed to init classroom session:",e),ns.value={message:"Initialization failed",created:0,skipped:0},Pl.notify({message:"Failed to init session: "+(e.message||"error"),color:"negative",position:"top"})}finally{es.value=!1}}}async function Xs(){await eo(Hl.value),Hl.value=null}async function eo(e){if(Gl.value.length&&e)try{as.value=!0;const a=await me.applyBehaviorToStudents(Gl.value,e,{date:Bl.value,periodCode:Cs.value,classroomId:ql.value,points_mode:"from_now"===fs.value?"overall":fs.value});if(a.results&&a.results.length>0){a.results.forEach(e=>{if(e.success&&e.data){const a=e.studentId,t=e.data;Yl.value[a]||(Yl.value[a]={points_plus:0,points_minus:0,attend:!0}),Yl.value[a]&&(Yl.value[a].points_plus=t.points_plus,Yl.value[a].points_minus=t.points_minus,void 0!==t.attend&&(Yl.value[a].attend=t.attend,Jl.value[a]=t.attend))}});const t=Rl.value.find(a=>a.id===e);if(t){const e=t.value||t.points||0;e>0&&Sl("reward"),e<0&&Sl("penalty")}Pl.notify({message:`Applied behavior to ${a.results.length} students`+(a.errors&&a.errors.length?` (${a.errors.length} failed)`:""),color:a.errors&&a.errors.length?"warning":"positive",position:"top"}),await so(),Gl.value=[]}a.errors&&a.errors.length>0&&(console.error("Partial or full failure:",a.errors),0===a.results.length&&Pl.notify({message:a.error||"Failed to apply behavior to selected students",color:"negative",position:"top"}))}catch(a){console.error("Error applying behavior:",a),Pl.notify({message:a.message||"Error applying behavior",color:"negative",position:"top"})}finally{as.value=!1}}async function ao(e,a,t){Jl.value[e]=a,Zl.value[e]=!0,Sl("select");try{const t=await me.updateAttendance(e,a,{date:Bl.value,periodCode:Cs.value,classroomId:ql.value});if(!t.success)throw new Error(t.error||"Failed to update attendance");Pl.notify({message:t.message||"Attendance updated",color:"positive",position:"top"}),!1===a&&await Ks()}catch(l){console.error("Failed to persist attendance for",e,l),Jl.value[e]=t,Pl.notify({message:"Failed to update attendance. Reverted.",color:"negative",position:"top"})}finally{Zl.value[e]=!1}}async function to(){ts.value=!0;const e={};for(const t of Ul.value)e[t.id]=!0,Jl.value[t.id]=!0;try{(await me.batchUpdateAttendance(e,{date:Bl.value,periodCode:Cs.value,classroomId:ql.value})).success&&Pl.notify({message:"All students marked present",color:"positive",position:"top"})}catch(a){console.error("Failed to mark all present:",a),Pl.notify({message:"Failed to mark all present",color:"negative",position:"top"})}finally{ts.value=!1}}async function lo(){ts.value=!0;const e={};for(const t of Ul.value)e[t.id]=!1,Jl.value[t.id]=!1;try{(await me.batchUpdateAttendance(e,{date:Bl.value,periodCode:Cs.value,classroomId:ql.value})).success&&Pl.notify({message:"All students marked absent",color:"warning",position:"top"})}catch(a){console.error("Failed to mark all absent:",a),Pl.notify({message:"Failed to mark all absent",color:"negative",position:"top"})}finally{ts.value=!1}}async function so(){ls.value=!0;try{const e=await me.getRecentActions({classroomId:ql.value,date:Bl.value,limit:10});e.success?Kl.value=e.data:console.error("Failed to load history:",e.error)}catch(e){console.error("Error loading history:",e)}finally{ls.value=!1}}function oo(e){if(!e)return"";return new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function no(){localStorage.setItem("points-display-mode",fs.value),hs.value?localStorage.setItem("competition-start-time",hs.value):localStorage.removeItem("competition-start-time"),xs.value&&localStorage.setItem("custom-date-from",xs.value),ws.value&&localStorage.setItem("custom-date-to",ws.value),localStorage.setItem("leaderboard-mode",_s.value),bs.value=!1,ql.value&&Ks(),Pl.notify({message:"Points display settings applied",color:"positive",position:"top",icon:"check_circle"})}function ro(){fs.value="overall",hs.value=null,xs.value=null,ws.value=null,_s.value="top5",localStorage.removeItem("points-display-mode"),localStorage.removeItem("competition-start-time"),localStorage.removeItem("custom-date-from"),localStorage.removeItem("custom-date-to"),localStorage.removeItem("leaderboard-mode"),bs.value=!1,ql.value&&Ks(),Pl.notify({message:"Reset to normal view",color:"info",position:"top"})}async function io(e){console.log("Incident recorded:",e),await Ks(),Pl.notify({message:"Behavior incident recorded (-1 point)",color:"warning",position:"top"})}return D(fs,e=>{if("from_now"===e){const e={};for(const[a,t]of Object.entries(Yl.value))e[a]={plus:t.points_plus||0,minus:t.points_minus||0};ys.value=e}else Ks()}),T(async()=>{var e,a;if(rs.value)console.log("‚è≠Ô∏è Skipping re-initialization - component already initialized");else try{console.log("üöÄ Initializing reward system...");const l=await P.get("/my_classes_with_students");Fl.value=l.data,console.log(`‚úÖ Loaded ${Fl.value.length} classrooms`);let s=!1;if(ue.classroomId&&ue.subjectId){console.log("üéØ Props detected (dialog mode) - auto-initializing..."),ql.value=ue.classroomId,Nl.value=ue.subjectId;try{const t=null==(a=null==(e=F().props.auth)?void 0:e.school)?void 0:a.active_semester_id;t?(Ll.value=parseInt(t),console.log(`üè´ Active Semester from Inertia: ${Ll.value}`)):Ll.value=1}catch(t){console.warn("Could not fetch active semester, defaulting to 1",t),Ll.value=1}ue.date?Bl.value=ue.date:Bl.value=(new Date).toISOString().split("T")[0];const l=new Date(Bl.value);Ql.value=l.getDay()+1,ue.period&&(Ml.value=ue.period),ue.week&&(Ol.value=ue.week,console.log(`üìÖ Props Week: ${ue.week}`)),s=!0,console.log(`üìö Props Subject: ${ue.subjectId}`),console.log(`üè´ Props Classroom: ${ue.classroomId}`),console.log(`üìÖ Props Date: ${Bl.value}`),console.log(`‚ö° Calc Day: ${Ql.value}`),console.log(`üî¢ Props Period: ${ue.period}`)}else{const e=new URLSearchParams(window.location.search),a=e.get("classroom_id"),t=e.get("subject_id"),l=e.get("period"),o=e.get("date");if(a&&t)console.log("üîó URL parameters detected - auto-initializing..."),ql.value=parseInt(a),Nl.value=parseInt(t),Bl.value=o||(new Date).toISOString().split("T")[0],l&&(Ml.value=parseInt(l)),s=!0,console.log(`üìö URL Subject: ${t}`),console.log(`üè´ URL Classroom: ${a}`),console.log(`üìÖ URL Date: ${Bl.value}`),console.log(`üî¢ URL Period: ${l}`);else{const e=localStorage.getItem("reward-system-selected-subject-id"),a=localStorage.getItem("reward-system-selected-classroom-id");e&&Al.value.some(a=>a.id===parseInt(e))?(Nl.value=parseInt(e),console.log(`üìö Restored subject from localStorage: ${e}`)):Al.value.length>0&&(Nl.value=Al.value[0].id,console.log(`üìö Auto-selected first subject: ${Al.value[0].name}`)),a&&Fl.value.some(e=>e.classroom_id===parseInt(a))&&(ql.value=parseInt(a),console.log(`üè´ Restored classroom from localStorage: ${a}`));const t=localStorage.getItem("reward-system-active-tab");t&&(El.value=t);const l=localStorage.getItem("reward-system-selected-semester"),s=localStorage.getItem("reward-system-selected-week"),o=localStorage.getItem("reward-system-selected-day"),n=localStorage.getItem("reward-system-selected-period-number");l&&(Ll.value=parseInt(l),console.log(`üìÖ Restored semester from localStorage: ${l}`)),s&&(Ol.value=parseInt(s),console.log(`üìÖ Restored week from localStorage: ${s}`)),o&&(Ql.value=parseInt(o),console.log(`üìÖ Restored day from localStorage: ${o}`)),n&&(Ml.value=parseInt(n),console.log(`üìÖ Restored period number from localStorage: ${n}`))}}console.log(`üî¢ Active Period Code: ${Ll.value}.${Ol.value}.${Ql.value}.${Ml.value}`);const o=await me.fetchBehaviors();o.success?(Rl.value=o.data,console.log(`‚úÖ Loaded ${Rl.value.length} behaviors`),console.log("üìã Behaviors data:",Rl.value),Rl.value=Rl.value.map(e=>({...e,value:e.value||e.points||0})),console.log("üìã Normalized behaviors:",Rl.value)):(console.error("‚ùå Failed to load behaviors:",o.error),Pl.notify({message:"Failed to load behaviors: "+o.error,color:"negative",position:"top"})),console.log("‚úÖ Reward system initialized"),rs.value=!0,s&&ql.value&&(console.log("üöÄ Auto-initializing classroom session..."),await Zs(ql.value),await Ks(),Pl.notify({message:ue.isDialog?"Session loaded!":"Session loaded from schedule!",color:"positive",position:"top",icon:"stars"}))}catch(l){console.error("‚ùå Failed to initialize reward system:",l),Pl.notify({message:"Failed to initialize reward system: "+l.message,color:"negative",position:"top"})}}),(a,y)=>{const z=R("Head");return N(),q(J,null,[B(z,{title:"Reward System"}),L("div",be,[y[71]||(y[71]=L("div",{class:"p-1 scale-25"},null,-1)),e.isDialog?Q("",!0):(N(),O(r,{key:0,class:"shadow-lg rounded-2xl overflow-hidden"},{default:M(()=>[B(t,{class:"bg-gradient-to-r from-blue-500 to-indigo-600 text-white flex justify-between items-center"},{default:M(()=>[L("div",null,[L("h1",fe,"üèÜ "+W(a.$t("rewardSys.behaviors.management")),1),L("p",ye,W(a.$t("rewardSys.behaviors.management")),1)]),B(S,{modelValue:H($l),"onUpdate:modelValue":y[0]||(y[0]=e=>G($l)?$l.value=e:null),options:[{label:"üá¨üáß English",value:"en"},{label:"üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©",value:"ar"}],flat:"",color:"white","text-color":"white","toggle-color":"white","toggle-text-color":"primary",unelevated:""},null,8,["modelValue"])]),_:1}),B(t,{class:"p-6 space-y-4"},{default:M(()=>{var e;return[L("div",he,[L("div",xe,[L("div",we,[B(l,{name:"event_note",size:"md"})]),L("div",null,[L("div",_e,W(a.$t("rewardSys.session.current")),1),L("div",Se,[ql.value?(N(),q("span",ke,W((null==(e=Fl.value.find(e=>e.classroom_id===ql.value))?void 0:e.classroom_name)||a.$t("rewardSys.session.unknownClass")),1)):(N(),q("span",$e,W(a.$t("rewardSys.session.noClassroom")),1)),y[45]||(y[45]=L("span",{class:"text-gray-300"},"|",-1)),L("span",Ie,W(Cs.value),1)]),L("div",Ce,W(new Date(Bl.value).toLocaleDateString())+" ‚Ä¢ Period "+W(Ml.value),1)])])]),ql.value?(N(),q("div",je,[L("div",Ae,[L("div",Ve,[B(l,{name:"groups",class:"text-blue-600",size:"sm"}),L("span",ze,W(a.$t("rewardSys.session.classroomSummary")),1)]),L("div",Pe,[B(s,{modelValue:is.value,"onUpdate:modelValue":y[1]||(y[1]=e=>is.value=e),icon:"edit",label:"Edit Avatars",dense:"",color:"secondary",size:"sm",class:"bg-white px-2 py-1 rounded-lg border border-gray-200"},null,8,["modelValue"]),ns.value.message?(N(),q("div",Ee,W(ns.value.message)+" ("+W(ns.value.created)+") ",1)):Q("",!0),L("div",Te,[B(l,{name:"people",class:"text-blue-600",size:"sm"}),L("div",De,[L("span",Fe,W(a.$t("rewardSys.session.total")),1),L("span",Ue,W(Ul.value.length),1)])]),L("div",Re,[B(l,{name:"check_circle",class:"text-green-600",size:"sm"}),L("div",qe,[L("span",Ne,W(a.$t("rewardSys.session.present")),1),L("span",Be,W(Vl.value.present),1)])]),L("div",Le,[B(l,{name:"cancel",class:"text-red-600",size:"sm"}),L("div",Oe,[L("span",Qe,W(a.$t("rewardSys.session.absent")),1),L("span",Me,W(Vl.value.absent),1)])]),B(o,{dense:"",color:"primary",icon:"content_copy",label:a.$t("rewardSys.session.copyList"),onClick:zl,disable:0===Vl.value.absent,size:"sm",class:"shadow-sm"},{default:M(()=>[B(n,null,{default:M(()=>[Y(W(a.$t("rewardSys.session.copyToClipboard")),1)]),_:1})]),_:1},8,["label","disable"])])]),Vl.value.absent>0?(N(),q("div",We,[L("div",He,[B(l,{name:"person_off",size:"xs",color:"red"}),L("span",null,W(a.$t("rewardSys.session.absentStudentsList")),1),B(k,{color:"red",label:Vl.value.absent,class:"ml-1"},null,8,["label"])]),L("div",Ge,[L("div",Ye,[(N(!0),q(J,null,Z(Vl.value.absentList,e=>(N(),O(h,{key:e.id,color:"red","text-color":"white",size:"sm",dense:"",icon:"person"},{default:M(()=>[Y(W("ar"===H($l)&&e.name_ar?e.name_ar:e.name),1)]),_:2},1024))),128))])])])):Q("",!0)])):Q("",!0)]}),_:1})]),_:1})),L("audio",{ref_key:"bgMusic",ref:wl,loop:"",id:"bg-music"},y[46]||(y[46]=[L("source",{src:"/audio/background_music2.mp3",type:"audio/mpeg"},null,-1)]),512),Ul.value.length?(N(),O(r,{key:1,class:"shadow-lg rounded-2xl"},{default:M(()=>[L("div",Je,[L("div",Ze,[L("div",Ke,[B(v,{color:"primary",icon:"menu",label:H(Pl).screen.gt.xs?"Menu":"",class:"shadow-sm glossy","content-class":"bg-white",dense:""},{default:M(()=>[L("div",Xe,[L("div",{class:"column",style:K(H(Pl).screen.lt.sm?"min-width: 250px":"min-width: 220px")},[y[55]||(y[55]=L("div",{class:"text-subtitle1 text-weight-bold q-mb-sm text-grey-8"},"Navigation",-1)),B(i,{dense:""},{default:M(()=>[X((N(),O(d,{clickable:"",onClick:y[2]||(y[2]=e=>El.value="positive"),active:"positive"===El.value,"active-class":"bg-blue-50 text-primary"},{default:M(()=>[B(u,{avatar:""},{default:M(()=>[B(l,{name:"add_circle"})]),_:1}),B(u,null,{default:M(()=>[Y(W(a.$t("rewardSys.tabs.positivePoints")),1)]),_:1})]),_:1},8,["active"])),[[x]]),X((N(),O(d,{clickable:"",onClick:y[3]||(y[3]=e=>El.value="attendance"),active:"attendance"===El.value,"active-class":"bg-blue-50 text-primary"},{default:M(()=>[B(u,{avatar:""},{default:M(()=>[B(l,{name:"how_to_reg"})]),_:1}),B(u,null,{default:M(()=>[Y(W(a.$t("rewardSys.tabs.attendance")),1)]),_:1})]),_:1},8,["active"])),[[x]]),X((N(),O(d,{clickable:"",onClick:y[4]||(y[4]=e=>El.value="history"),active:"history"===El.value,"active-class":"bg-blue-50 text-primary"},{default:M(()=>[B(u,{avatar:""},{default:M(()=>[B(l,{name:"cancel"})]),_:1}),B(u,null,{default:M(()=>[Y(W(a.$t("rewardSys.tabs.history")),1)]),_:1})]),_:1},8,["active"])),[[x]]),X((N(),O(d,{clickable:"",onClick:y[5]||(y[5]=e=>El.value="classroom_helper"),active:"classroom_helper"===El.value,"active-class":"bg-blue-50 text-primary"},{default:M(()=>[B(u,{avatar:""},{default:M(()=>[B(l,{name:"assignment"})]),_:1}),B(u,null,{default:M(()=>y[47]||(y[47]=[Y("Classroom Helper")])),_:1})]),_:1},8,["active"])),[[x]]),X((N(),O(d,{clickable:"",onClick:y[6]||(y[6]=e=>El.value="timer_random"),active:"timer_random"===El.value,"active-class":"bg-blue-50 text-primary"},{default:M(()=>[B(u,{avatar:""},{default:M(()=>[B(l,{name:"timer"})]),_:1}),B(u,null,{default:M(()=>y[48]||(y[48]=[Y("Timer & Random")])),_:1})]),_:1},8,["active"])),[[x]]),X((N(),O(d,{clickable:"",onClick:y[7]||(y[7]=e=>{Xl.value=!0,El.value="champions"}),active:"champions"===El.value,"active-class":"bg-blue-50 text-primary"},{default:M(()=>[B(u,{avatar:""},{default:M(()=>[B(l,{name:"emoji_events"})]),_:1}),B(u,null,{default:M(()=>[Y(W(a.$t("rewardSys.tabs.champions")),1)]),_:1})]),_:1},8,["active"])),[[x]]),X((N(),O(d,{clickable:"",onClick:y[8]||(y[8]=e=>El.value="settings_reports"),active:"settings_reports"===El.value,"active-class":"bg-blue-50 text-primary"},{default:M(()=>[B(u,{avatar:""},{default:M(()=>[B(l,{name:"settings_applications"})]),_:1}),B(u,null,{default:M(()=>[Y(W(a.$t("rewardSys.tabs.settingsReports")),1)]),_:1})]),_:1},8,["active"])),[[x]])]),_:1}),B(c,{class:"q-my-md"}),y[56]||(y[56]=L("div",{class:"text-subtitle2 text-grey-7 q-mb-xs"},"Points Filter",-1)),B(i,{dense:""},{default:M(()=>[X((N(),O(d,{clickable:"",onClick:y[9]||(y[9]=e=>fs.value="overall"),active:"overall"===fs.value,"active-class":"text-orange-9 text-weight-bold"},{default:M(()=>[B(u,{avatar:""},{default:M(()=>[B(l,{name:"functions",size:"xs"})]),_:1}),B(u,null,{default:M(()=>y[49]||(y[49]=[Y("Overall (All Time)")])),_:1}),"overall"===fs.value?(N(),O(u,{key:0,side:""},{default:M(()=>[B(l,{name:"check",size:"xs",color:"orange"})]),_:1})):Q("",!0)]),_:1},8,["active"])),[[x]]),X((N(),O(d,{clickable:"",onClick:y[10]||(y[10]=e=>fs.value="all_subjects"),active:"all_subjects"===fs.value,"active-class":"text-orange-9 text-weight-bold"},{default:M(()=>[B(u,{avatar:""},{default:M(()=>[B(l,{name:"public",size:"xs"})]),_:1}),B(u,null,{default:M(()=>y[50]||(y[50]=[Y("Overall (All Subjects)")])),_:1}),"all_subjects"===fs.value?(N(),O(u,{key:0,side:""},{default:M(()=>[B(l,{name:"check",size:"xs",color:"orange"})]),_:1})):Q("",!0)]),_:1},8,["active"])),[[x]]),X((N(),O(d,{clickable:"",onClick:y[11]||(y[11]=e=>fs.value="session"),active:"session"===fs.value,"active-class":"text-orange-9 text-weight-bold"},{default:M(()=>[B(u,{avatar:""},{default:M(()=>[B(l,{name:"timer",size:"xs"})]),_:1}),B(u,null,{default:M(()=>y[51]||(y[51]=[Y("This Session")])),_:1}),"session"===fs.value?(N(),O(u,{key:0,side:""},{default:M(()=>[B(l,{name:"check",size:"xs",color:"orange"})]),_:1})):Q("",!0)]),_:1},8,["active"])),[[x]]),X((N(),O(d,{clickable:"",onClick:y[12]||(y[12]=e=>fs.value="competition"),active:"competition"===fs.value,"active-class":"text-orange-9 text-weight-bold"},{default:M(()=>[B(u,{avatar:""},{default:M(()=>[B(l,{name:"date_range",size:"xs"})]),_:1}),B(u,null,{default:M(()=>y[52]||(y[52]=[Y("Competition (Week)")])),_:1}),"competition"===fs.value?(N(),O(u,{key:0,side:""},{default:M(()=>[B(l,{name:"check",size:"xs",color:"orange"})]),_:1})):Q("",!0)]),_:1},8,["active"])),[[x]]),X((N(),O(d,{clickable:"",onClick:y[13]||(y[13]=e=>fs.value="from_now"),active:"from_now"===fs.value,"active-class":"text-orange-9 text-weight-bold"},{default:M(()=>[B(u,{avatar:""},{default:M(()=>[B(l,{name:"restart_alt",size:"xs"})]),_:1}),B(u,null,{default:M(()=>y[53]||(y[53]=[Y("From Now (Reset View)")])),_:1}),"from_now"===fs.value?(N(),O(u,{key:0,side:""},{default:M(()=>[B(l,{name:"check",size:"xs",color:"orange"})]),_:1})):Q("",!0)]),_:1},8,["active"])),[[x]])]),_:1}),B(c,{class:"q-my-md"}),y[57]||(y[57]=L("div",{class:"text-subtitle2 text-grey-7 q-mb-xs"},"Layout",-1)),B(i,{dense:""},{default:M(()=>[(N(!0),q(J,null,Z(Rs.value,e=>X((N(),O(d,{clickable:"",key:e.value,onClick:a=>vs.value=e.value,active:vs.value===e.value,"active-class":"text-orange-9 text-weight-bold"},{default:M(()=>[B(u,{avatar:""},{default:M(()=>[B(l,{name:e.icon,size:"xs"},null,8,["name"])]),_:2},1024),B(u,null,{default:M(()=>[Y(W(e.label),1)]),_:2},1024),vs.value===e.value?(N(),O(u,{key:0,side:""},{default:M(()=>[B(l,{name:"check",size:"xs",color:"orange"})]),_:1})):Q("",!0)]),_:2},1032,["onClick","active"])),[[x]])),128)),B(c,{class:"q-my-xs"}),X((N(),O(d,{clickable:"",onClick:y[14]||(y[14]=e=>ps.value=!0)},{default:M(()=>[B(u,{avatar:""},{default:M(()=>[B(l,{name:"settings",size:"xs",class:"text-grey-7"})]),_:1}),B(u,{class:"text-grey-8"},{default:M(()=>[Y(W(a.$t("rewardSys.manageGroups")),1)]),_:1})]),_:1})),[[x]])]),_:1}),H(Pl).screen.lt.sm?(N(),q("div",ea,[B(c,{class:"q-my-md"}),y[54]||(y[54]=L("div",{class:"text-subtitle1 text-weight-bold q-mb-md text-grey-8"},"Settings",-1)),B(s,{modelValue:_l.value,"onUpdate:modelValue":y[15]||(y[15]=e=>_l.value=e),"checked-icon":"music_note","unchecked-icon":"music_off",label:"Music On",color:"primary",dense:""},null,8,["modelValue"]),B(s,{modelValue:is.value,"onUpdate:modelValue":y[16]||(y[16]=e=>is.value=e),icon:"edit",label:"Edit Avatars",color:"secondary",dense:""},null,8,["modelValue"])])):Q("",!0)],4),H(Pl).screen.gt.xs?(N(),O(c,{key:0,vertical:"",inset:"",class:"q-mx-lg"})):Q("",!0),H(Pl).screen.gt.xs?(N(),q("div",aa,[y[58]||(y[58]=L("div",{class:"text-subtitle1 text-weight-bold q-mb-md text-grey-8"},"Settings",-1)),L("div",ta,[B(s,{modelValue:_l.value,"onUpdate:modelValue":y[17]||(y[17]=e=>_l.value=e),"checked-icon":"music_note","unchecked-icon":"music_off",label:"Music On",color:"primary",dense:""},null,8,["modelValue"]),B(s,{modelValue:is.value,"onUpdate:modelValue":y[18]||(y[18]=e=>is.value=e),icon:"edit",label:"Edit Avatars",color:"secondary",dense:""},null,8,["modelValue"])]),B(c,{class:"q-my-md full-width"}),L("div",la,[B(de,{class:"scale-90 transform-origin-center"})])])):Q("",!0)])]),_:1},8,["label"]),"positive"!==El.value||H(Pl).screen.gt.xs?(N(),q("div",sa,[B(k,{color:"blue-1","text-color":"blue-9",class:"q-py-xs q-px-sm text-subtitle2 whitespace-nowrap"},{default:M(()=>[Y(W("positive"===El.value?a.$t("rewardSys.tabs.positivePoints"):"attendance"===El.value?a.$t("rewardSys.tabs.attendance"):"history"===El.value?a.$t("rewardSys.tabs.history"):"champions"===El.value?a.$t("rewardSys.tabs.champions"):"classroom_helper"===El.value?"Classroom Helper":"timer_random"===El.value?"Timer & Random":a.$t("rewardSys.tabs.settingsReports")),1)]),_:1})])):Q("",!0)]),L("div",oa,[B(v,{color:"primary",icon:"stars",label:H(Pl).screen.gt.xs?"Give Feedback":"",disable:0===Gl.value.length,class:"shadow-sm glossy","content-class":"rounded-xl",dense:""},{default:M(()=>[L("div",na,[B(I,{modelValue:Tl.value,"onUpdate:modelValue":y[19]||(y[19]=e=>Tl.value=e),class:"text-grey-7 bg-grey-1","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":"",dense:""},{default:M(()=>[B($,{name:"positive",icon:"thumb_up",label:"Positive",class:"text-weight-bold"}),B($,{name:"needs_work",icon:"warning",label:"Needs Work",class:"text-weight-bold"})]),_:1},8,["modelValue"]),B(c),B(j,{modelValue:Tl.value,"onUpdate:modelValue":y[20]||(y[20]=e=>Tl.value=e),animated:"",class:"bg-white",style:{"max-height":"400px","overflow-y":"auto"}},{default:M(()=>[B(C,{name:"positive",class:"q-pa-md"},{default:M(()=>[L("div",ra,[(N(!0),q(J,null,Z(Fs.value,e=>(N(),q("div",{class:"col-4 cursor-pointer",key:e.id,onClick:a=>eo(e.id)},[X((N(),q("div",da,[B(l,{name:e.icon||"star",size:"2em",class:"q-mb-xs text-orange"},null,8,["name"]),L("div",ua,W(e.name),1),L("div",ca,[B(k,{color:"green-1","text-color":"green-9",class:"text-xs font-bold border border-green-200 shadow-sm rounded-full px-1.5"},{default:M(()=>[Y("+"+W(e.points||e.value),1)]),_:2},1024)])])),[[x]])],8,ia))),128))])]),_:1}),B(C,{name:"needs_work",class:"q-pa-md"},{default:M(()=>[L("div",va,[(N(!0),q(J,null,Z(Us.value,e=>(N(),q("div",{class:"col-4 cursor-pointer",key:e.id,onClick:a=>eo(e.id)},[X((N(),q("div",pa,[B(l,{name:e.icon||"warning",size:"2em",class:"q-mb-xs text-red"},null,8,["name"]),L("div",ga,W(e.name),1),L("div",ba,[B(k,{color:"red-1","text-color":"red-9",class:"text-xs font-bold border border-red-200 shadow-sm rounded-full px-1.5"},{default:M(()=>[Y(W(e.points||e.value),1)]),_:2},1024)])])),[[x]])],8,ma))),128))])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["label","disable"])])])]),"positive"===El.value&&"session"!==fs.value?(N(),q("div",fa," Viewing: "+W("overall"===fs.value?"Overall (All Time)":"all_subjects"===fs.value?"Overall (All Subjects)":"from_now"===fs.value?"From Now (Temporary)":"Competition (Week)"),1)):Q("",!0),B(c),B(j,{modelValue:El.value,"onUpdate:modelValue":y[28]||(y[28]=e=>El.value=e),animated:""},{default:M(()=>[B(C,{name:"attendance"},{default:M(()=>[L("div",ya,[L("div",ha,[L("h3",xa,W(a.$t("rewardSys.attendance.manage")),1),L("div",wa,[B(o,{color:"positive",label:a.$t("rewardSys.attendance.markAllPresent"),onClick:to,loading:ts.value},null,8,["label","loading"]),B(o,{color:"warning",label:a.$t("rewardSys.attendance.markAllAbsent"),onClick:lo,loading:ts.value},null,8,["label","loading"])])]),L("div",_a,[(N(!0),q(J,null,Z(Ul.value,e=>{var a,t,l,s;return N(),O(ie,{key:e.id,student:e,"disable-behavior":!Jl.value[e.id],"allow-disabled-click":!0,"avatar-edit-enabled":is.value,"student-summary":{positive:((null==(a=Yl.value[e.id])?void 0:a.points_plus)||0)-("from_now"===fs.value&&ys.value[e.id]?ys.value[e.id].plus:0),negative:((null==(t=Yl.value[e.id])?void 0:t.points_minus)||0)-("from_now"===fs.value&&ys.value[e.id]?ys.value[e.id].minus:0),total:((null==(l=Yl.value[e.id])?void 0:l.points_plus)||0)-("from_now"===fs.value&&ys.value[e.id]?ys.value[e.id].plus:0)-(((null==(s=Yl.value[e.id])?void 0:s.points_minus)||0)-("from_now"===fs.value&&ys.value[e.id]?ys.value[e.id].minus:0))},onSelect:a=>async function(e){const a=void 0===Jl.value[e]||Jl.value[e],t=!a;if(!1===t){const l=Yl.value[e];if(l&&(l.points_plus>0||l.points_minus>0))return void Pl.dialog({title:"Warning",message:`This student has ${l.points_plus} positive and ${l.points_minus} negative points for this session. Marking them absent will remove all their points for this session. Continue?`,cancel:!0,persistent:!0,ok:{label:"Yes, Mark Absent",color:"negative"},cancel:{label:"Cancel",color:"grey"}}).onOk(async()=>{await ao(e,t,a)})}await ao(e,t,a)}(e.id)},null,8,["student","disable-behavior","avatar-edit-enabled","student-summary","onSelect"])}),128))])])]),_:1}),B(C,{name:"classroom_helper"},{default:M(()=>[B(re,{students:Ul.value,"student-behaviors":Yl.value,"student-attendance":Jl.value,"period-info":{date:Bl.value,periodCode:Cs.value,classroomId:ql.value}},null,8,["students","student-behaviors","student-attendance","period-info"])]),_:1}),B(C,{name:"timer_random"},{default:M(()=>[B(ne,{students:Ul.value},null,8,["students"])]),_:1}),B(C,{name:"positive"},{default:M(()=>[L("div",Sa,[L("div",ka,[L("div",$a,[L("div",Ia,[L("div",Ca,[B(l,{name:"checklist",class:"text-blue-600",size:"sm"}),L("span",ja,W(a.$t("rewardSys.selected"))+": ",1),B(k,{label:Gl.value.length,color:"blue",class:"text-lg"},null,8,["label"])]),L("div",Aa,[B(o,{flat:"",dense:"",color:"primary",label:a.$t("rewardSys.selection.all"),size:"sm",onClick:Ns,icon:"check_box",class:"bg-blue-100/50"},null,8,["label"]),B(o,{flat:"",dense:"",color:"primary",label:a.$t("rewardSys.selection.inv"),size:"sm",onClick:Bs,icon:"swap_vert",class:"bg-blue-100/50"},null,8,["label"]),B(o,{flat:"",dense:"",color:"negative",label:a.$t("rewardSys.selection.clear"),size:"sm",onClick:Js,icon:"clear",class:"bg-red-100/50"},null,8,["label"]),B(o,{flat:"",dense:"",color:"negative",label:a.$t("rewardSys.selection.clear"),size:"sm",onClick:Js,icon:"clear",class:"bg-red-100/50"},null,8,["label"]),(N(),O(ee,{to:"#dialog-header-actions"},[L("div",Va,[B(o,{rounded:"",dense:"","no-caps":"",color:"positive",class:"px-3 shadow-sm",onClick:y[21]||(y[21]=e=>Es("present"))},{default:M(()=>[B(l,{name:"check_circle",class:"mr-1",size:"xs"}),L("span",za,W(js.value),1)]),_:1}),B(o,{rounded:"",dense:"","no-caps":"",color:"negative",class:"px-3 shadow-sm",onClick:y[22]||(y[22]=e=>Es("absent"))},{default:M(()=>[B(l,{name:"cancel",class:"mr-1",size:"xs"}),L("span",Pa,W(As.value),1)]),_:1})])])),B(c,{vertical:"",inset:"",class:"mx-2"}),B(m,{modelValue:Vs.value,"onUpdate:modelValue":y[23]||(y[23]=e=>Vs.value=e)},{default:M(()=>[B(r,{style:{"min-width":"350px"}},{default:M(()=>[B(t,{class:"row items-center"},{default:M(()=>[L("div",Ea,[Y(W("present"===zs.value?"Present Students":"Absent Students")+" ",1),B(k,{color:"present"===zs.value?"positive":"negative",class:"ml-2"},{default:M(()=>[Y(W(Ps.value.length),1)]),_:1},8,["color"])]),B(A),X(B(o,{icon:"close",flat:"",round:"",dense:""},null,512),[[x]])]),_:1}),B(t,{class:"q-pt-none",style:{"max-height":"50vh","overflow-y":"auto"}},{default:M(()=>[0===Ps.value.length?(N(),q("div",Ta," No students found. ")):(N(),O(i,{key:1,bordered:"",separator:"",class:"rounded-lg"},{default:M(()=>[(N(!0),q(J,null,Z(Ps.value,e=>(N(),O(d,{key:e.id},{default:M(()=>[B(u,{avatar:""},{default:M(()=>[B(w,{size:"sm"},{default:M(()=>[L("img",{src:Ds(e)},null,8,Da)]),_:2},1024)]),_:2},1024),B(u,null,{default:M(()=>[Y(W(e.name),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1}),B(p,{align:"right",class:"bg-gray-50"},{default:M(()=>[X(B(o,{flat:"",label:"Close",color:"primary"},null,512),[[x]]),B(o,{label:"Copy List",color:"primary",icon:"content_copy",onClick:Ts,disable:0===Ps.value.length},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])])]),(N(!0),q(J,null,Z(qs.value,(e,t)=>(N(),q("div",{key:t,class:"mb-6 bg-gray-400"},[e.name?(N(),q("div",Fa,[L("div",Ua,[L("h4",Ra,[B(l,{name:"groups"}),Y(" "+W(e.name)+" ",1),B(k,{label:e.students.length,color:"indigo"},null,8,["label"])]),L("div",qa,[B(o,{dense:"",size:"sm",color:"indigo",icon:"check_box",label:a.$t("rewardSys.selection.all"),onClick:a=>Ys(e.students,!0),outline:""},null,8,["label","onClick"]),B(o,{dense:"",size:"sm",color:"grey",icon:"check_box_outline_blank",label:a.$t("rewardSys.selection.clear"),onClick:a=>Ys(e.students,!1),outline:""},null,8,["label","onClick"])])])])):Q("",!0),L("div",Na,[(N(!0),q(J,null,Z(e.students,e=>{var a,t,l,s;return N(),O(ie,{key:e.id,student:e,selected:Gl.value.includes(e.id),"selected-id":Gl.value.includes(e.id)?e.id:null,"disable-behavior":!Jl.value[e.id],"is-absent":!Jl.value[e.id],"allow-disabled-click":!1,"avatar-edit-enabled":is.value,"student-summary":{positive:((null==(a=Yl.value[e.id])?void 0:a.points_plus)||0)-("from_now"===fs.value&&ys.value[e.id]?ys.value[e.id].plus:0),negative:((null==(t=Yl.value[e.id])?void 0:t.points_minus)||0)-("from_now"===fs.value&&ys.value[e.id]?ys.value[e.id].minus:0),total:((null==(l=Yl.value[e.id])?void 0:l.points_plus)||0)-("from_now"===fs.value&&ys.value[e.id]?ys.value[e.id].plus:0)-(((null==(s=Yl.value[e.id])?void 0:s.points_minus)||0)-("from_now"===fs.value&&ys.value[e.id]?ys.value[e.id].minus:0))},onSelect:a=>Gs(e.id)},null,8,["student","selected","selected-id","disable-behavior","is-absent","avatar-edit-enabled","student-summary","onSelect"])}),128))])]))),128))])])]),_:1}),B(C,{name:"negative"},{default:M(()=>[L("div",Ba,[L("div",La,[L("h3",Oa,W(a.$t("rewardSys.points.deduct")),1),L("p",Qa,W(a.$t("rewardSys.points.selectStudentsNegative")),1)]),L("div",Ma,[L("div",Wa,[B(V,{modelValue:Hl.value,"onUpdate:modelValue":y[24]||(y[24]=e=>Hl.value=e),options:Us.value,"option-value":"id","option-label":"name",outlined:"",dense:"",placeholder:a.$t("rewardSys.points.selectNegativeBehavior"),"emit-value":"","map-options":""},{option:M(e=>[B(d,ae(te(e.itemProps)),{default:M(()=>[B(u,null,{default:M(()=>[B(g,null,{default:M(()=>[Y(W(Il(e.opt)),1)]),_:2},1024),B(g,{caption:""},{default:M(()=>[Y(W(e.opt.value||e.opt.points||0)+" points",1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","placeholder"]),B(o,{color:"negative",icon:"remove_circle",label:a.$t("rewardSys.points.applyToSelected"),onClick:Xs,disable:!Gl.value.length||!Hl.value,loading:as.value},null,8,["label","disable","loading"])]),L("div",Ha,[y[59]||(y[59]=Y("Selected: ")),L("strong",null,W(Gl.value.length),1),y[60]||(y[60]=Y(" students"))])]),L("div",Ga,[(N(!0),q(J,null,Z(Ul.value,e=>{var a,t,l,s;return N(),O(ie,{key:e.id,student:e,selected:Gl.value.includes(e.id),"selected-id":Gl.value.includes(e.id)?e.id:null,"disable-behavior":!Jl.value[e.id],"allow-disabled-click":!1,"avatar-edit-enabled":is.value,"student-summary":{positive:(null==(a=Yl.value[e.id])?void 0:a.points_plus)||0,negative:(null==(t=Yl.value[e.id])?void 0:t.points_minus)||0,total:((null==(l=Yl.value[e.id])?void 0:l.points_plus)||0)-((null==(s=Yl.value[e.id])?void 0:s.points_minus)||0)},onSelect:a=>Gs(e.id)},null,8,["student","selected","selected-id","disable-behavior","avatar-edit-enabled","student-summary","onSelect"])}),128))])])]),_:1}),B(C,{name:"old_card"},{default:M(()=>[L("div",Ya,[y[64]||(y[64]=L("h3",{class:"text-xl font-bold mb-4"},"Old Card View",-1)),L("div",Ja,[(N(!0),q(J,null,Z(Ul.value,e=>{var a,t,l,s;return N(),q("div",{key:e.id,class:se(["p-4 border-2 rounded-lg transition",[Jl.value[e.id]?Gl.value.includes(e.id)?"bg-green-100 border-green-500 cursor-pointer":"bg-white border-gray-200 cursor-pointer":"bg-gray-100 border-gray-300 opacity-50 cursor-not-allowed"]]),onClick:a=>Jl.value[e.id]&&Gs(e.id)},[L("div",Ka,[L("div",Xa,[L("p",et,W(e.name),1),L("p",at,"ID: "+W(e.id),1),Jl.value[e.id]?Q("",!0):(N(),q("p",tt,"‚ùå Absent"))]),B(_,{"model-value":Gl.value.includes(e.id),"onUpdate:modelValue":a=>Gs(e.id),disable:!Jl.value[e.id],color:"positive",size:"lg"},null,8,["model-value","onUpdate:modelValue","disable"])]),L("div",lt,[L("div",st,[y[61]||(y[61]=L("span",{class:"text-xs font-semibold text-green-800"},"Positive",-1)),L("span",ot,"+"+W((null==(a=Yl.value[e.id])?void 0:a.points_plus)||0)+" ‚≠ê",1)]),L("div",nt,[y[62]||(y[62]=L("span",{class:"text-xs font-semibold text-red-800"},"Negative",-1)),L("span",rt,"-"+W((null==(t=Yl.value[e.id])?void 0:t.points_minus)||0)+" ‚ö†Ô∏è",1)]),L("div",it,[y[63]||(y[63]=L("span",{class:"text-xs font-semibold text-blue-800"},"Total",-1)),L("span",dt,W(((null==(l=Yl.value[e.id])?void 0:l.points_plus)||0)-((null==(s=Yl.value[e.id])?void 0:s.points_minus)||0)),1)])])],10,Za)}),128))])])]),_:1}),B(C,{name:"history"},{default:M(()=>[L("div",ut,[L("div",ct,[L("h3",vt,W(a.$t("rewardSys.history.title")),1),B(o,{color:"primary",icon:"refresh",label:a.$t("rewardSys.history.refresh"),onClick:so,loading:ls.value},null,8,["label","loading"])]),Kl.value.length?Q("",!0):(N(),q("div",mt,[L("p",pt,W(a.$t("rewardSys.history.empty")),1)])),(N(!0),q(J,null,Z(Kl.value,e=>{var t,l,s;return N(),q("div",{key:e.id,class:se(["p-4 bg-white rounded-lg border-l-4",[e.canceled?"border-gray-400 opacity-60":e.value>0?"border-green-500":"border-red-500"]])},[L("div",gt,[L("div",bt,[L("div",ft,[L("span",yt,W((null==(l=null==(t=e.student_behavior)?void 0:t.student)?void 0:l.name)||a.$t("rewardSys.history.unknown")),1),L("span",ht,W(e.value>0?"‚≠ê":"‚ö†Ô∏è"),1)]),L("p",xt,[L("strong",null,W(Il(e.behavior)||a.$t("rewardSys.history.unknownBehavior")),1),L("span",{class:se(e.value>0?"text-green-600":"text-red-600")}," ("+W(e.value>0?"+":"")+W(e.value)+" "+W(a.$t("rewardSys.points.title"))+") ",3)]),L("p",wt,W(oo(e.created_at))+" by "+W((null==(s=e.created_by)?void 0:s.name)||a.$t("rewardSys.history.unknown")),1),e.note?(N(),q("p",_t,W(a.$t("rewardSys.history.note"))+" "+W(e.note),1)):Q("",!0),e.canceled?(N(),q("p",St," ‚ùå "+W(a.$t("rewardSys.history.canceled"))+" "+W(e.cancel_reason)+" ("+W(oo(e.canceled_at))+") ",1)):Q("",!0)]),e.canceled?Q("",!0):(N(),O(o,{key:0,color:"warning",icon:"undo",label:a.$t("rewardSys.history.undo"),size:"sm",onClick:a=>async function(e){ss.value=e;try{const a=await me.undoAction(e,"Undone by teacher");a.success?(Pl.notify({message:"Action undone successfully",color:"positive",position:"top"}),await so(),await Ks()):Pl.notify({message:a.error||"Failed to undo action",color:"negative",position:"top"})}catch(a){console.error("Error undoing action:",a),Pl.notify({message:"Error undoing action",color:"negative",position:"top"})}finally{ss.value=null}}(e.id),loading:ss.value===e.id},null,8,["label","onClick","loading"]))])],2)}),128))])]),_:1}),B(C,{name:"settings_reports",class:"p-4"},{default:M(()=>[L("div",kt,[L("div",$t,[B(I,{modelValue:Dl.value,"onUpdate:modelValue":y[25]||(y[25]=e=>Dl.value=e),align:"left",class:"text-gray-600 bg-gray-50 border-b border-gray-200","active-color":"primary","indicator-color":"primary",dense:""},{default:M(()=>[B($,{name:"behavior_incidents",icon:"report_problem",label:a.$t("rewardSys.tabs.behaviorIncidents")},null,8,["label"]),B($,{name:"behaviors",icon:"settings",label:a.$t("rewardSys.tabs.behaviors")},null,8,["label"])]),_:1},8,["modelValue"]),B(j,{modelValue:Dl.value,"onUpdate:modelValue":y[27]||(y[27]=e=>Dl.value=e),animated:"",class:"bg-transparent"},{default:M(()=>[B(C,{name:"behavior_incidents"},{default:M(()=>[B(H(ve),{students:Ul.value,"classroom-id":ql.value,date:Bl.value,"period-code":Cs.value,onIncidentRecorded:io},null,8,["students","classroom-id","date","period-code"])]),_:1}),B(C,{name:"behaviors"},{default:M(()=>[L("div",It,[L("div",Ct,[L("h3",jt,W(a.$t("rewardSys.behaviors.management")),1),B(o,{color:"primary",icon:"add",label:a.$t("rewardSys.behaviors.addNew"),onClick:y[26]||(y[26]=e=>Ms(null)),size:"md",class:"shadow-md"},null,8,["label"])]),L("div",At,[L("div",Vt,[B(l,{name:"add_circle",size:"md",color:"positive"}),L("h4",zt,W(a.$t("rewardSys.behaviors.positiveSection")),1),B(k,{label:Fs.value.length,color:"positive"},null,8,["label"])]),L("div",Pt,[(N(!0),q(J,null,Z(Fs.value,e=>(N(),q("div",{key:e.id,class:"bg-white rounded-lg p-4 shadow-sm border border-green-100 hover:shadow-md transition-all"},[L("div",Et,[L("div",Tt,[L("div",Dt,W(e.icon||"‚≠ê"),1),L("div",null,[L("h5",Ft,W(Il(e)),1),L("p",Ut,"ID: "+W(e.id),1)])]),L("div",Rt,[B(o,{flat:"",round:"",dense:"",icon:"edit",color:"primary",size:"sm",onClick:a=>Ms(e)},{default:M(()=>[B(n,null,{default:M(()=>y[65]||(y[65]=[Y("Edit")])),_:1})]),_:2},1032,["onClick"]),B(o,{flat:"",round:"",dense:"",icon:"delete",color:"negative",size:"sm",onClick:a=>Hs(e)},{default:M(()=>[B(n,null,{default:M(()=>y[66]||(y[66]=[Y("Delete")])),_:1})]),_:2},1032,["onClick"])])]),L("div",qt,[y[67]||(y[67]=L("span",{class:"text-sm text-gray-600"},"Points:",-1)),L("span",Nt,"+"+W(e.value||e.points||0),1)])]))),128))]),0===Fs.value.length?(N(),q("div",Bt,[B(l,{name:"sentiment_neutral",size:"3rem",class:"mb-2"}),L("p",null,W(a.$t("rewardSys.behaviors.noPositive")),1)])):Q("",!0)]),L("div",Lt,[L("div",Ot,[B(l,{name:"remove_circle",size:"md",color:"negative"}),L("h4",Qt,W(a.$t("rewardSys.behaviors.negativeSection")),1),B(k,{label:Us.value.length,color:"negative"},null,8,["label"])]),L("div",Mt,[(N(!0),q(J,null,Z(Us.value,e=>(N(),q("div",{key:e.id,class:"bg-white rounded-lg p-4 shadow-sm border border-red-100 hover:shadow-md transition-all"},[L("div",Wt,[L("div",Ht,[L("div",Gt,W(e.icon||"‚ö†Ô∏è"),1),L("div",null,[L("h5",Yt,W(Il(e)),1),L("p",Jt,"ID: "+W(e.id),1)])]),L("div",Zt,[B(o,{flat:"",round:"",dense:"",icon:"edit",color:"primary",size:"sm",onClick:a=>Ms(e)},{default:M(()=>[B(n,null,{default:M(()=>y[68]||(y[68]=[Y("Edit")])),_:1})]),_:2},1032,["onClick"]),B(o,{flat:"",round:"",dense:"",icon:"delete",color:"negative",size:"sm",onClick:a=>Hs(e)},{default:M(()=>[B(n,null,{default:M(()=>y[69]||(y[69]=[Y("Delete")])),_:1})]),_:2},1032,["onClick"])])]),L("div",Kt,[y[70]||(y[70]=L("span",{class:"text-sm text-gray-600"},"Points:",-1)),L("span",Xt,W(e.value||e.points||0),1)])]))),128))]),0===Us.value.length?(N(),q("div",el,[B(l,{name:"sentiment_neutral",size:"3rem",class:"mb-2"}),L("p",null,W(a.$t("rewardSys.behaviors.noNegative")),1)])):Q("",!0)])])]),_:1})]),_:1},8,["modelValue"])])])]),_:1})]),_:1},8,["modelValue"])]),_:1})):Q("",!0),Ul.value.length?Q("",!0):(N(),O(r,{key:2,class:"shadow-lg rounded-2xl"},{default:M(()=>[B(t,{class:"text-center py-12"},{default:M(()=>[L("p",al,"üìö "+W(a.$t("rewardSys.messages.selectClassroom")),1)]),_:1})]),_:1})),B(m,{modelValue:Xl.value,"onUpdate:modelValue":y[29]||(y[29]=e=>Xl.value=e),maximized:""},{default:M(()=>[B(r,null,{default:M(()=>[B(p,{align:"right"},{default:M(()=>[X(B(o,{flat:"",label:"Close",color:"primary"},null,512),[[x]])]),_:1}),B(t,{class:"p-0"},{default:M(()=>[B(H(ce),{students:Ul.value,"student-behaviors":Yl.value,"period-code":Cs.value,date:Bl.value,"school-logo":jl.value},null,8,["students","student-behaviors","period-code","date","school-logo"])]),_:1}),B(p,{align:"right"},{default:M(()=>[X(B(o,{flat:"",label:"Close",color:"primary"},null,512),[[x]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),B(m,{modelValue:ds.value,"onUpdate:modelValue":y[30]||(y[30]=e=>ds.value=e),"full-width":"",maxWidth:"1000px"},{default:M(()=>[B(r,{class:"flex flex-col md:flex-row h-[80vh] md:h-[70vh]"},{default:M(()=>[B(t,{class:"w-full md:w-1/3 bg-blue-50 border-r border-blue-100 flex flex-col p-0"},{default:M(()=>[L("div",tl,[L("h4",ll,[B(l,{name:"checklist"}),Y(" "+W(a.$t("rewardSys.selected"))+" ("+W(Gl.value.length)+") ",1)])]),L("div",sl,[0===Gl.value.length?(N(),q("div",ol,W(a.$t("rewardSys.messages.clickToSelect")),1)):(N(),q("div",nl,[(N(!0),q(J,null,Z(Gl.value,e=>(N(),O(h,{key:e,removable:"",onRemove:a=>Gs(e),color:"white","text-color":"primary",class:"shadow-sm border border-blue-100 m-0 w-full"},{default:M(()=>{var a,t;return[B(w,{icon:"person",color:"primary","text-color":"white","font-size":"14px"}),L("div",rl,[L("span",il,[Y(W(null==(a=Ul.value.find(a=>a.id===e))?void 0:a.firstName)+" ",1),L("span",dl,W(null==(t=Ul.value.find(a=>a.id===e))?void 0:t.lastName),1)])])]}),_:2},1032,["onRemove"]))),128))]))]),L("div",ul,[L("div",cl,[B(o,{flat:"",dense:"",color:"primary",label:"All",size:"sm",onClick:Ns,class:"bg-blue-50"}),B(o,{flat:"",dense:"",color:"primary",label:"Inv",size:"sm",onClick:Bs,class:"bg-blue-50"}),B(o,{flat:"",dense:"",color:"negative",label:"Clear",size:"sm",onClick:Js,class:"bg-red-50"})])])]),_:1}),L("div",vl,[B(t,{class:se("positive"===us.value?"bg-green-50 border-b border-green-100":"bg-red-50 border-b border-red-100")},{default:M(()=>[L("div",ml,[B(l,{name:"positive"===us.value?"add_circle":"remove_circle",color:"positive"===us.value?"positive":"negative"},null,8,["name","color"]),Y(" "+W("positive"===us.value?a.$t("rewardSys.points.positiveTitle"):a.$t("rewardSys.points.negativeTitle")),1)])]),_:1},8,["class"]),B(t,{class:"flex-1 overflow-y-auto p-4 custom-scrollbar"},{default:M(()=>[L("div",pl,[(N(!0),q(J,null,Z("positive"===us.value?Fs.value:Us.value,e=>(N(),q("div",{key:e.id,class:"cursor-pointer transition-all duration-200 relative group",onClick:a=>cs.value=e.id},[L("div",{class:se(["h-full p-3 rounded-xl border-2 flex flex-col items-center text-center gap-2 hover:shadow-md transition-all",[cs.value===e.id?"positive"===us.value?"border-green-500 bg-green-50 scale-105":"border-red-500 bg-red-50 scale-105":"border-gray-100 bg-white hover:border-gray-300"]])},[L("div",{class:se(["text-3xl p-3 rounded-full mb-1","positive"===us.value?"bg-green-100 text-green-600":"bg-red-100 text-red-600"])},W(e.icon||("positive"===us.value?"‚≠ê":"‚ö†Ô∏è")),3),L("div",bl,W(Il(e)),1),L("div",{class:se(["text-xl font-bold px-3 py-1 rounded-full mt-auto","positive"===us.value?"bg-green-200 text-green-800":"bg-red-200 text-red-800"])},W("positive"===us.value?"+":"")+W(e.value||e.points||0),3),cs.value===e.id?(N(),q("div",{key:0,class:se(["absolute top-2 right-2 text-xl drop-shadow-sm","positive"===us.value?"text-green-600":"text-red-600"])},[B(l,{name:"check_circle"})],2)):Q("",!0)],2)],8,gl))),128))])]),_:1}),B(p,{align:"right",class:"p-4 border-t border-gray-100 bg-gray-50 gap-3"},{default:M(()=>[X(B(o,{flat:"",label:a.$t("rewardSys.tabs.cancel"),color:"grey-7",size:"lg",class:"font-bold"},null,8,["label"]),[[x]]),B(o,{color:"positive"===us.value?"positive":"negative",label:"positive"===us.value?a.$t("rewardSys.points.applyPositive"):a.$t("rewardSys.points.applyNegative"),icon:"positive"===us.value?"check_circle":"warning",onClick:Ls,disable:!cs.value,loading:as.value,size:"lg",class:"px-8 font-bold shadow-md",push:""},null,8,["color","label","icon","disable","loading"])]),_:1})])]),_:1})]),_:1},8,["modelValue"]),B(m,{modelValue:Ss.value,"onUpdate:modelValue":y[36]||(y[36]=e=>Ss.value=e),persistent:""},{default:M(()=>[B(r,{class:"min-w-[500px]"},{default:M(()=>[B(t,{class:"bg-primary text-white"},{default:M(()=>[L("div",fl,[L("div",yl,W(ks.value?a.$t("rewardSys.behaviors.edit"):a.$t("rewardSys.behaviors.create")),1),ks.value&&!ks.value.teacher_id?(N(),O(k,{key:0,color:"blue",label:"üîí "+a.$t("rewardSys.behaviors.schoolDefault")},null,8,["label"])):Q("",!0)])]),_:1}),B(t,{class:"q-pt-md space-y-4"},{default:M(()=>[ks.value&&!ks.value.teacher_id?(N(),O(b,{key:0,class:"bg-blue-50 text-blue-900",rounded:"",dense:""},{avatar:M(()=>[B(l,{name:"info",color:"blue"})]),default:M(()=>[Y(" "+W(a.$t("rewardSys.behaviors.readOnlyWarning")),1)]),_:1})):Q("",!0),B(f,{modelValue:Is.value.name,"onUpdate:modelValue":y[31]||(y[31]=e=>Is.value.name=e),label:"üá¨üáß "+a.$t("rewardSys.behaviors.form.nameEn")+" *",outlined:"",dense:"",rules:[e=>!!e||"Name is required"],readonly:ks.value&&!ks.value.teacher_id},{prepend:M(()=>[B(l,{name:"translate"})]),_:1},8,["modelValue","label","rules","readonly"]),B(f,{modelValue:Is.value.name_ar,"onUpdate:modelValue":y[32]||(y[32]=e=>Is.value.name_ar=e),label:"üá∏üá¶ "+a.$t("rewardSys.behaviors.form.nameAr"),outlined:"",dense:"",dir:"rtl",readonly:ks.value&&!ks.value.teacher_id},{prepend:M(()=>[B(l,{name:"translate"})]),_:1},8,["modelValue","label","readonly"]),B(V,{modelValue:Is.value.type,"onUpdate:modelValue":y[33]||(y[33]=e=>Is.value.type=e),options:[{label:a.$t("rewardSys.behaviors.form.types.positive"),value:"positive"},{label:a.$t("rewardSys.behaviors.form.types.negative"),value:"negative"}],label:a.$t("rewardSys.behaviors.form.type")+" *",outlined:"",dense:"","emit-value":"","map-options":"",rules:[e=>!!e||"Type is required"],readonly:ks.value&&!ks.value.teacher_id},null,8,["modelValue","options","label","rules","readonly"]),B(f,{modelValue:Is.value.points,"onUpdate:modelValue":y[34]||(y[34]=e=>Is.value.points=e),modelModifiers:{number:!0},label:a.$t("rewardSys.behaviors.form.points")+" *",type:"number",outlined:"",dense:"",rules:[e=>null!==e&&""!==e||"Points are required"],hint:"positive"===Is.value.type?"Positive number (e.g., 5)":"Negative number (e.g., -3)",readonly:ks.value&&!ks.value.teacher_id},null,8,["modelValue","label","rules","hint","readonly"]),B(f,{modelValue:Is.value.icon,"onUpdate:modelValue":y[35]||(y[35]=e=>Is.value.icon=e),label:a.$t("rewardSys.behaviors.form.icon"),outlined:"",dense:"",hint:"Optional emoji, e.g., ‚≠ê üéâ ‚ö†Ô∏è üö´",readonly:ks.value&&!ks.value.teacher_id},null,8,["modelValue","label","readonly"])]),_:1}),B(p,{align:"right",class:"q-px-md q-pb-md"},{default:M(()=>[X(B(o,{flat:"",label:a.$t("rewardSys.tabs.cancel")},null,8,["label"]),[[x]]),!ks.value||ks.value.teacher_id?(N(),O(o,{key:0,color:"primary",label:ks.value?a.$t("common.update"):a.$t("common.create"),onClick:Ws,loading:$s.value},null,8,["label","loading"])):Q("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),B(m,{modelValue:ps.value,"onUpdate:modelValue":y[38]||(y[38]=e=>ps.value=e),maximized:""},{default:M(()=>[B(H(hl),{students:Ul.value,"saved-layouts":ms.value,"editing-layout":gs.value,onSave:Os,onDelete:Qs,onClose:y[37]||(y[37]=e=>ps.value=!1)},null,8,["students","saved-layouts","editing-layout"])]),_:1},8,["modelValue"]),B(m,{modelValue:bs.value,"onUpdate:modelValue":y[44]||(y[44]=e=>bs.value=e)},{default:M(()=>[B(oe,{mode:fs.value,"competition-start-time":hs.value,"date-from":xs.value,"date-to":ws.value,"leaderboard-mode":_s.value,"onUpdate:mode":y[39]||(y[39]=e=>fs.value=e),"onUpdate:competitionStartTime":y[40]||(y[40]=e=>hs.value=e),"onUpdate:dateFrom":y[41]||(y[41]=e=>xs.value=e),"onUpdate:dateTo":y[42]||(y[42]=e=>ws.value=e),"onUpdate:leaderboardMode":y[43]||(y[43]=e=>_s.value=e),onApply:no,onReset:ro},null,8,["mode","competition-start-time","date-from","date-to","leaderboard-mode"])]),_:1},8,["modelValue"])])],64)}}},[["__scopeId","data-v-7781d191"]]);export{hl as default};
