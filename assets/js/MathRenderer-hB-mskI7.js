import{k as e}from"./katex-BXKQVcz-.js";import{o as t}from"./app-C-WHvmzS.js";import a from"./purify.es-C2Ba6vpb.js";import{f as l,k as o,o as i,N as s,J as r,y as n,O as d,F as c,R as p,S as u,Q as m,ac as g,V as v,ab as y}from"./vendor-nQjeLEvd.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";const h={class:"math-input-container"},w={key:0,class:"math-editor"},b=["placeholder"],f={class:"flex justify-between items-center mt-2"},x={class:"flex gap-2"},S=["onClick","title"],C={class:"flex items-center gap-2 mt-2"},k=["innerHTML"],M={class:"absolute top-0 right-0 flex gap-1"},z=t({__name:"MathRenderer",props:{initialValue:{type:String,default:""},placeholder:{type:String,default:"Enter mathematical expression (e.g., \\frac{1}{2})"},editable:{type:Boolean,default:!0},displayMode:{type:Boolean,default:!0},fontSize:{type:String,default:"1.1em"}},emits:["update:content","get_data","update:fontSize"],setup(t,{emit:z}){const L=t,j=z,T=l(L.initialValue),I=l(!1),V=l(""),_=l(L.fontSize),H=[{symbol:"\\frac{}{}",display:"a/b",description:"Fraction"},{symbol:"\\sqrt{}",display:"√",description:"Square root"},{symbol:"\\sum_{}^{}",display:"∑",description:"Summation"},{symbol:"\\int_{}^{}",display:"∫",description:"Integral"},{symbol:"\\infty",display:"∞",description:"Infinity"},{symbol:"\\pm",display:"±",description:"Plus-minus"}],R=()=>{try{const t=T.value.replace(/\\\(/g,"").replace(/\\\)/g,"").trim(),l=e.renderToString(t,{displayMode:L.displayMode,throwOnError:!1,strict:!1,trust:!0});V.value=a.sanitize(l),j("update:content",V.value)}catch(t){console.warn("KaTeX rendering error:",t),V.value=`<span class="text-red-500">Error: ${t.message}</span>`}},E=()=>{L.editable&&(I.value=!I.value,I.value||R())},U=async()=>{try{const e=`\n            <svg xmlns="http://www.w3.org/2000/svg" width="800" height="200">\n                <foreignObject width="100%" height="100%">\n                    <div xmlns="http://www.w3.org/1999/xhtml" style="font-family: KaTeX_Main, Times New Roman, serif; padding: 8px;">\n                        ${V.value}\n                    </div>\n                </foreignObject>\n            </svg>\n        `,t=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),a=URL.createObjectURL(t),l=new Image;l.src=a,await new Promise((e,t)=>{l.onload=e,l.onerror=t});const o=document.createElement("canvas"),i=o.getContext("2d");o.width=l.width,o.height=l.height,i.fillStyle="white",i.fillRect(0,0,o.width,o.height),i.drawImage(l,0,0);const s=o.toDataURL("image/png"),r=await fetch(s),n=await r.blob();await navigator.clipboard.write([new ClipboardItem({"image/png":n})]),URL.revokeObjectURL(a),j("get_data",{type:"image",data:s}),O("Image")}catch(e){console.error("Failed to copy as image:",e);const t=document.querySelector('[title="Copy as Image"]');t.setAttribute("title","Failed to copy"),setTimeout(()=>{t.setAttribute("title","Copy as Image")},2e3)}},B=async()=>{try{await navigator.clipboard.writeText(V.value),j("get_data",{type:"html",data:V.value}),O("HTML")}catch(e){console.error("Failed to copy HTML:",e)}},O=e=>{const t=document.querySelector(`[title="Copy as ${e}"]`),a=t.getAttribute("title");t.setAttribute("title","Copied!"),setTimeout(()=>{t.setAttribute("title",a)},2e3)},q=()=>{j("update:fontSize",_.value),R()};return o(()=>L.initialValue,e=>{T.value=e,R()}),o(()=>L.fontSize,e=>{_.value=e,R()}),i(()=>{T.value=L.initialValue,R()}),(e,a)=>(r(),s("div",h,[I.value?(r(),s("div",w,[n(d("textarea",{"onUpdate:modelValue":a[0]||(a[0]=e=>T.value=e),class:"w-full p-2 border rounded-md font-mono text-sm",rows:"3",onInput:R,placeholder:t.placeholder},null,40,b),[[g,T.value]]),d("div",f,[d("div",x,[(r(),s(c,null,p(H,e=>d("button",{key:e.symbol,onClick:t=>(e=>{const t=document.querySelector(".math-editor textarea");if(!t)return;const a=t.selectionStart,l=t.selectionEnd;T.value=T.value.substring(0,a)+e+T.value.substring(l),R()})(e.symbol),class:"px-2 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded",title:e.description},v(e.display),9,S)),64))]),d("button",{onClick:E,class:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm"}," Done ")]),d("div",C,[a[3]||(a[3]=d("label",{class:"text-sm text-gray-600"},"Size:",-1)),n(d("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>_.value=e),class:"text-sm border rounded-md",onChange:q},a[2]||(a[2]=[d("option",{value:"0.8em"},"Small",-1),d("option",{value:"1.1em"},"Normal",-1),d("option",{value:"1.5em"},"Large",-1),d("option",{value:"2em"},"Extra Large",-1)]),544),[[y,_.value]])])])):(r(),s("div",{key:1,class:"math-preview relative",onDblclick:E,style:u({"--katex-font-size":_.value})},[d("div",{class:"math-content prose",innerHTML:V.value},null,8,k),d("div",M,[d("button",{onClick:B,class:"p-1 text-gray-400 hover:text-gray-600",title:"Copy as HTML"},a[4]||(a[4]=[d("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[d("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),d("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"})],-1)])),d("button",{onClick:U,class:"p-1 text-gray-400 hover:text-gray-600",title:"Copy as Image"},a[5]||(a[5]=[d("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[d("path",{"fill-rule":"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z","clip-rule":"evenodd"})],-1)])),t.editable?(r(),s("button",{key:0,onClick:E,class:"p-1 text-gray-400 hover:text-gray-600",title:"Edit"},a[6]||(a[6]=[d("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[d("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})],-1)]))):m("",!0)])],36))]))}},[["__scopeId","data-v-5b46028b"]]);export{z as default};
