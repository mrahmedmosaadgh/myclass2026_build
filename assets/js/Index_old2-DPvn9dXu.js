import{l as e}from"./ui-BITzTqrO.js";import{_ as l}from"./AppLayout-OZsHDu4T.js";import o from"./DialogModal_8-DLfkR3qP.js";import a from"./RadioButtonGroup-DwBL5nrd.js";import{_ as s}from"./FilterSelectV2-BPyEW8J1.js";import r from"./Dropdown2-S-A-0b-g.js";import t from"./card2-Cf2E0ue_.js";import{f as d,k as n,a as u,I as c,J as i,K as v,N as p,Q as m,V as _,b,M as y,R as f,F as h,z as g,_ as j}from"./vendor-DuKqz2x4.js";import{o as x}from"./app-BB4Fw2oM.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./NameAbbreviator2-YPtuS-BT.js";const w={class:"p-0 flex flex-wrap justify-center"},k={class:"mb-6 space-y-4"},S={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},V={class:"bg-white rounded-lg shadow overflow-x-auto"},$={class:"min-w-full divide-y divide-gray-200"},C={class:"bg-gray-50"},D={class:"bg-white divide-y divide-gray-200"},U={class:"px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900 border-r"},A={class:"p-0"},T=["onClick"],E={class:"p-0"},z=["onClick"],M={class:"py-1"},N=x({__name:"Index_old2",props:{records:{type:Object,default:()=>({data:[]})},records2:{type:Object,default:()=>({data:[]})},options:{type:Object,default:()=>({})},periodDetails:{type:Array,default:()=>[]}},setup(x){d("Cozy"),d([{value:"Cozy2",label:"Cozy"}]);const N=x;d(null==N?void 0:N.records);const F=d(N.records||[]),I=d({});console.log("Props received:",{records:N.records,options:N.options,periodDetails:N.periodDetails});const O=[{name:"Sunday",number:1},{name:"Monday",number:2},{name:"Tuesday",number:3},{name:"Wednesday",number:4},{name:"Thursday",number:5}],P=Array.from({length:8},(e,l)=>l+1),R=d(!1),Z=d(N.records||[]),q=d(!1),B=d({day:null,period_number:null}),G=d(null),J=d(!1),K=d({school:null,school_object:{},classroom:null,classroom_object:{},schedule:null,schedule_object:{}});d(!1);const L=d(null);n(()=>N.records,e=>{Z.value=e},{deep:!0});const Q=u(()=>{var e;console.log("CSTs from options:",null==(e=N.options)?void 0:e.csts);const l=N.records||[],o=[...new Set(l.map(e=>{var l,o;return null==(o=null==(l=e.cst)?void 0:l.classroom)?void 0:o.id}))].map(e=>{var o,a,s,r,t,d;const n=l.find(l=>{var o,a;return(null==(a=null==(o=l.cst)?void 0:o.classroom)?void 0:a.id)===e});return{id:null==(a=null==(o=n.cst)?void 0:o.classroom)?void 0:a.id,name:null==(r=null==(s=n.cst)?void 0:s.classroom)?void 0:r.name,grade:null==(d=null==(t=n.cst)?void 0:t.classroom)?void 0:d.grade}});return console.log("Processed classrooms:",o),o});u(()=>{var e,l;console.log("CSTs from options:",null==(e=N.options)?void 0:e.csts);const o=(null==(l=N.options)?void 0:l.csts)||[],a=[...new Set(o.map(e=>e.classroom.id))].map(e=>{const l=o.find(l=>l.classroom.id===e);return{id:l.classroom.id,name:l.classroom.name,grade:l.classroom.grade}});return console.log("Processed classrooms:",a),a}),u(()=>{const e={};return Q.value.forEach(l=>{e[l.id]={};for(let o=1;o<=5;o++){e[l.id][o]={};for(let a=1;a<=8;a++)e[l.id][o][a]=null}}),N.records.forEach(l=>{const o=l.cst.classroom.id;e[o]&&(e[o][l.day][l.period_number]={id:l.id,subject:l.cst.subject.name,teacher:l.cst.teacher.name,is_disabled:!l.active,color_bg:l.cst.subject.color_bg,color_text:l.cst.subject.color_text})}),e});const W=u(()=>{var e;return(null==(e=N.records)?void 0:e.length)?N.records.reduce((e,l)=>{var o,a,s,r,t,d,n,u;if(!(null==l?void 0:l.day)||!(null==l?void 0:l.period_number))return e;return e[`${l.day}-${l.period_number}`]={subject:(null==(a=null==(o=l.cst)?void 0:o.subject)?void 0:a.name)||"",teacher:(null==(r=null==(s=l.cst)?void 0:s.teacher)?void 0:r.name)||"",color_bg:(null==(d=null==(t=l.cst)?void 0:t.subject)?void 0:d.color_bg)||"#ffffff",color_text:(null==(u=null==(n=l.cst)?void 0:n.subject)?void 0:u.color_text)||"#000000",cst:l.cst||null,schedule:l,id:null==l?void 0:l.id},e},{}):{}}),Y=(e,l,o)=>W.value[`${l.number}-${o}`]||null,H=(e,l,o)=>{var a;return console.log(l,o),B.value.day=l.number,B.value.period_number=o,F.value=null==(a=N.records)?void 0:a.filter(l=>{var o,a;return(null==(a=null==(o=l.cst)?void 0:o.classroom)?void 0:a.id)===e}),console.log("Filtered records:",F.value),F.value},X=()=>{q.value=!1,G.value=null,J.value=!1},ee=async(l,o,a,s)=>{var r,t,d,n,u;const c={...l,id:l.id,day:a.number,period_number:s,school_id:l.school_id,copy_id:l.copy_id,active:null==(r=l.active)||r};try{return console.log("formData22222222___________",c),void console.log("3333___________",l,o,a,s)}catch(i){const l=(null==(d=null==(t=i.response)?void 0:t.data)?void 0:d.message)||"An unexpected error occurred";onError((null==(u=null==(n=i.response)?void 0:n.data)?void 0:u.errors)||{error:[l]}),e.error(l)}finally{J.value=!1}},le=async({form:l,onSuccess:o,onError:a})=>{var s,r,t,d,n;if(J.value)return;J.value=!0,L.value=null;const u={...l,day:B.value.day,period_number:B.value.period_number,school_id:G.value.school_id,copy_id:G.value.copy_id,active:null==(s=G.value.active)||s};try{const l="/admin/schedule/update2",a=await j.post(l,u);Z.value=u.id?Z.value.map(e=>e.id===G.value.id?a.data:e):[...Z.value,a.data],X(),o(),e.success(`Schedule ${u.id?"updated":"created"} successfully`)}catch(c){const l=(null==(t=null==(r=c.response)?void 0:r.data)?void 0:t.message)||"An unexpected error occurred";a((null==(n=null==(d=c.response)?void 0:d.data)?void 0:n.errors)||{error:[l]}),e.error(l)}finally{J.value=!1}},oe=u(()=>{var e;return[{name:"cst_id",label:"Class-Subject-Teacher",type:"select",required:!0,options:(null==(e=F.value)?void 0:e.map(e=>({value:e.id,label:`${e.classroom}`})))||[]}]});d(null),d(null),d({row:null,col:null}),d(null),u(()=>{var e;return{school_id:null==(e=selected_school_object.value)?void 0:e.id,period_number:null,day:null,cst_id:null,place:"",active:!0,notes:""}}),u(()=>{var e;return(null==(e=N.records2)?void 0:e.filter(e=>{var l,o,a,s,r;return!Y(null==(o=null==(l=e.cst)?void 0:l.classroom)||o.id,e.day,e.period_number)&&(null==(s=null==(a=e.cst)?void 0:a.classroom)?void 0:s.id)===(null==(r=selected_classroom.value)?void 0:r.id)}))||[]});const ae=u(()=>{var e;return(null==(e=F.value)?void 0:e.filter(e=>null!=e))||[]});return(e,d)=>(i(),c(l,{title:"Schedule Management"},{default:v(()=>{var l,n,u;return[p("details",null,[p("pre",null,"    props.options?.classrooms:"+_(null==(n=null==(l=N.options)?void 0:l.csts[0])?void 0:n.classroom)+"\n\n\n",1)]),p("details",null,[p("div",w,[b(a,{modelValue:I.value,"onUpdate:modelValue":d[0]||(d[0]=e=>I.value=e),name:"officeType",my_class:"flex flex-wrap justify-center gap-1",options:ae.value,period_day:{day:null==(u=e.day)?void 0:u.number,period:e.period}},null,8,["modelValue","options","period_day"])])]),p("details",null,[p("pre",null,"                props.records:"+_(N.records2)+"\n\n            ",1)]),p("div",k,[p("div",S,[b(s,{modelValue:K.value.school,"onUpdate:modelValue":d[1]||(d[1]=e=>K.value.school=e),object:K.value.school_object,"onUpdate:object":d[2]||(d[2]=e=>K.value.school_object=e),options:e.$page.props.auth.user.school,"value-key":"id","label-key":["name","hr.name"],placeholder:"Select School","label-separator":" - ","default-selected-index":0,label_only:!1},null,8,["modelValue","object","options"]),b(s,{modelValue:K.value.classroom,"onUpdate:modelValue":d[3]||(d[3]=e=>K.value.classroom=e),object:K.value.classroom_object,"onUpdate:object":d[4]||(d[4]=e=>K.value.classroom_object=e),options:e.$page.props.auth.user.classroom,"value-key":"id","label-key":["name"],placeholder:"Select Classroom"},null,8,["modelValue","object","options"]),b(s,{modelValue:K.value.schedule,"onUpdate:modelValue":d[5]||(d[5]=e=>K.value.schedule=e),object:K.value.schedule_object,"onUpdate:object":d[6]||(d[6]=e=>K.value.schedule_object=e),options:e.$page.props.auth.user.schedule,"value-key":"id","label-key":["cst.classroom_name","cst.subject_name","cst.teacher_name"],placeholder:"Select Schedule"},null,8,["modelValue","object","options"])])]),p("div",V,[p("table",$,[p("thead",C,[p("tr",null,[d[8]||(d[8]=p("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Classroom ",-1)),(i(),y(h,null,f(O,e=>p("th",{key:e,colspan:8,class:"px-4 py-2 text-center text-sm font-medium text-gray-700 border-l"},_(e.name),1)),64))]),p("tr",null,[d[9]||(d[9]=p("th",null,null,-1)),(i(),y(h,null,f(O,e=>(i(),y(h,{key:`periods-${e}`},[(i(!0),y(h,null,f(g(P),l=>(i(),y("th",{key:`${e}-${l}`,class:"px-2 py-2 text-center text-xs font-medium text-gray-500 uppercase border-l first:border-l-0"},_(l),1))),128))],64))),64))])]),p("tbody",D,[(i(!0),y(h,null,f(Q.value,e=>(i(),y("tr",{key:e.id},[p("td",U,_(e.name),1),(i(),y(h,null,f(O,l=>(i(),y(h,{key:`${e.id}-${l}`},[(i(!0),y(h,null,f(g(P),o=>(i(),y("td",{key:`${e.id}-${l}-${o}`,class:"px-2 py-2 border-l first:border-l-0"},[p("div",A,[p("button",{onClick:a=>{return s=Y(e.id,l,o),void console.log(s);var s}},"wwww",8,T),b(r,{width:"56",align:"left","auto-hide":!0},{trigger:v(()=>{var a,s,r,d;return[p("div",E,[(null==(s=null==(a=Y(e.id,l,o))?void 0:a.schedule)?void 0:s.period_number)==o&&(null==(d=null==(r=Y(e.id,l,o))?void 0:r.schedule)?void 0:d.day)==l.number?(i(),c(t,{key:0,option:Y(e.id,l,o),name:"radioName",my_class:"custom-class",onClick:a=>H(e.id,l,o),onSet_data:a=>((e,l,o,a)=>{console.log("setSelectedSession________",e),R.value=e,ee(R.value,l,o,a)})(a,e.id,l,o)},null,8,["option","onClick","onSet_data"])):(i(),y("button",{key:1,onClick:a=>H(e.id,l,o),class:"px-2 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded"}," filter ",8,z))])]}),content:v(()=>[p("div",M,[b(a,{class:"scale-75",modelValue:I.value,"onUpdate:modelValue":d[7]||(d[7]=e=>I.value=e),name:"officeType",my_class:"flex flex-wrap justify-center gap-1",options:F.value,period_day:{classroom:e.id,day:l.number,period:o}},null,8,["modelValue","options","period_day"])])]),_:2},1024)])]))),128))],64))),64))]))),128))])])]),q.value?(i(),c(o,{key:0,show:q.value,title:G.value?"Edit Schedule":"Add New Schedule",fields:oe.value,formData:G.value,onClose:X,onSubmitted:le},null,8,["show","title","fields","formData"])):m("",!0)]}),_:1}))}},[["__scopeId","data-v-2d9eb6c3"]]);export{N as default};
