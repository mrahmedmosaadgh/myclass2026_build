import{f as e,a,k as s,N as l,J as o,b as t,R as r,z as i,a4 as n,O as d,K as c,W as m,V as u,F as p,Q as v,y as b,ab as _,ad as h,$ as y}from"./vendor-BWKGNkNB.js";import{_ as k}from"./PrimaryButton-DVJXOzHH.js";import{_ as f}from"./SecondaryButton-WaufSYeJ.js";import{_ as g}from"./Pagination-DMF9MOGD.js";import{_ as j}from"./DataTable-zMwSNXZH.js";import w from"./DialogModal_7-8gWhV6Hu.js";import{_ as x}from"./ImportExcel-B39KHUJp.js";import{utils as C,writeFile as S}from"./xlsx-BHXqx-YI.js";import{a$ as q}from"./app-CWAnT6CT.js";import"./LucideIcon-CYYJCXCs.js";import"./createLucideIcon-bevK9Pnz.js";import"./printer-yyUpIzJF.js";import"./image-T1FtDBZI.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./Modal-B3qkoeWC.js";const A={class:"py-12"},N={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},T={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-6"},I={class:"flex justify-between items-center mb-6"},M={class:"flex space-x-2"},$={key:0,class:"mt-4"},D={class:"space-y-4"},E=["for"],U=["id","onUpdate:modelValue"],V={value:""},W=["value"],O=["type","id","onUpdate:modelValue","min"],P="/admin/classroom-subject-teacher",B={__name:"Index",props:{records:Object,options:{type:Object,default:()=>({schools:[],grades:[],classrooms:[],subjects:[],teachers:[]})}},setup(B){const F=B,G=e(!1),K=e(null),L=a(()=>{var e;return(null==(e=F.records)?void 0:e.data)||[]}),z=a(()=>{var e;return(null==(e=F.records)?void 0:e.links)||null}),J=[{key:"school.name",label:"School"},{key:"grade.name",label:"Grade"},{key:"classroom.name",label:"Classroom"},{key:"subject.name",label:"Subject"},{key:"teacher.name",label:"Teacher"},{key:"classes_per_week",label:"Classes/Week"}],Q=a(()=>{var e,a,s,l,o,t,r,i;return[{name:"school_id",label:"School",type:"select",required:!0,options:(null==(a=null==(e=F.options)?void 0:e.schools)?void 0:a.map(e=>({value:e.id,label:e.name})))||[]},{name:"classroom_id",label:"Classroom",type:"select",required:!0,options:(null==(l=null==(s=F.options)?void 0:s.classrooms)?void 0:l.map(e=>({value:e.id,label:e.name})))||[]},{name:"subject_id",label:"Subject",type:"select",required:!0,options:(null==(t=null==(o=F.options)?void 0:o.subjects)?void 0:t.map(e=>({value:e.id,label:e.name})))||[]},{name:"teacher_id",label:"Teacher",type:"select",required:!0,options:(null==(i=null==(r=F.options)?void 0:r.teachers)?void 0:i.map(e=>({value:e.id,label:e.name})))||[]},{name:"classes_per_week",label:"Classes per Week",type:"number",required:!0,min:1}]}),R=e({school_id:"",classroom_id:"",subject_id:"",teacher_id:"",classes_per_week:""});s(K,e=>{R.value=e?{school_id:e.school_id,classroom_id:e.classroom_id,subject_id:e.subject_id,teacher_id:e.teacher_id,classes_per_week:e.classes_per_week}:{school_id:"",classroom_id:"",subject_id:"",teacher_id:"",classes_per_week:""}});const X=(e=null)=>{K.value=e,G.value=!0},H=()=>{G.value=!1,K.value=null,R.value={school_id:"",classroom_id:"",subject_id:"",teacher_id:"",classes_per_week:""}},Y=()=>{q.start(),y.reload({only:["records"],preserveScroll:!0,preserveState:!0}).then(()=>{q.done()})},Z=()=>{q.start();const e=K.value?`${P}/${K.value.id}`:P;axios.post(e,{...K.value&&{_method:"PUT"},...R.value}).then(()=>{H(),Y()}).catch(e=>{var a,s;(null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.errors)&&console.error(e.response.data.errors)}).finally(()=>{q.done()})},ee=async e=>{if(confirm("Are you sure you want to delete this record?")){q.start();try{await axios.delete(`${P}/${e.id}`),Y()}catch(a){console.error("Delete error:",a)}finally{q.done()}}},ae=()=>{q.start();try{const e=[["School","Grade","Classroom","Subject","Teacher","Classes/Week"],...L.value.map(e=>{var a,s,l,o,t;return[(null==(a=e.school)?void 0:a.name)||"",(null==(s=e.grade)?void 0:s.name)||"",(null==(l=e.classroom)?void 0:l.name)||"",(null==(o=e.subject)?void 0:o.name)||"",(null==(t=e.teacher)?void 0:t.name)||"",e.classes_per_week]})],a=C.aoa_to_sheet(e),s=C.book_new();C.book_append_sheet(s,a,"Teacher Assignments");const l=`teacher_assignments_${(new Date).toISOString().split("T")[0]}.xlsx`;S(s,l)}catch(e){console.error("Export failed:",e),alert("Failed to export data")}finally{q.done()}},se=[{key:"school",label:"School Name",required:!0,description:"Must match an existing school name"},{key:"grade",label:"Grade Name",required:!0,description:"Must match an existing grade name"},{key:"classroom",label:"Classroom Name",required:!0,description:"Must match an existing classroom name"},{key:"subject",label:"Subject Name",required:!0,description:"Must match an existing subject name"},{key:"teacher",label:"Teacher Name",required:!0,description:"Must match an existing teacher name"},{key:"classes_per_week",label:"Classes per Week",required:!0,type:"number",description:"Number of classes per week"}];return(e,a)=>(o(),l(p,null,[t(i(n),{title:"Classroom Subject Teachers"}),r("div",A,[r("div",N,[r("div",T,[r("div",I,[r("div",M,[t(k,{onClick:a[0]||(a[0]=e=>X())},{default:c(()=>a[1]||(a[1]=[m(" Add New Assignment ")])),_:1}),t(x,{onImported:Y,"validate-url":P+"/validate-import","import-url":P+"/import",columns:se,"button-text":"Import Assignments","preview-title":"Preview Data"},null,8,["validate-url","import-url"]),t(f,{onClick:ae},{default:c(()=>a[2]||(a[2]=[m(" Export ")])),_:1})])]),t(j,{items:L.value,columns:J,onEdit:X,onDelete:ee},null,8,["items"]),z.value?(o(),l("div",$,[t(g,{links:z.value},null,8,["links"])])):d("",!0)])])]),t(w,{show:G.value,title:K.value?"Edit Assignment":"Add New Assignment",fields:Q.value,editing:!!K.value,onClose:H,onSubmitted:Z},{title:c(()=>[m(u(K.value?"Edit Assignment":"Add New Assignment"),1)]),content:c(()=>[r("div",D,[(o(!0),l(p,null,v(Q.value,e=>(o(),l("div",{key:e.name,class:"grid grid-cols-1 gap-2"},[r("label",{for:e.name,class:"block text-sm font-medium text-gray-700"},u(e.label),9,E),"select"===e.type?b((o(),l("select",{key:0,id:e.name,"onUpdate:modelValue":a=>R.value[e.name]=a,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[r("option",V,"Select "+u(e.label),1),(o(!0),l(p,null,v(e.options,e=>(o(),l("option",{key:e.value,value:e.value},u(e.label),9,W))),128))],8,U)),[[_,R.value[e.name]]]):b((o(),l("input",{key:1,type:e.type,id:e.name,"onUpdate:modelValue":a=>R.value[e.name]=a,min:e.min,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,8,O)),[[h,R.value[e.name]]])]))),128))])]),footer:c(()=>[t(f,{onClick:H},{default:c(()=>a[3]||(a[3]=[m(" Cancel ")])),_:1}),t(k,{class:"ml-3",onClick:Z},{default:c(()=>[m(u(K.value?"Update":"Create"),1)]),_:1})]),_:1},8,["show","title","fields","editing"])],64))}};export{B as default};
