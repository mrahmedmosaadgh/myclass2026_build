import{Q as e}from"./QSpace-CfcdpSpD.js";import{o as t,c as a,Q as s,m as l,C as r,a as o,g as d,h as n,i,d as c,f as u,l as m,e as p}from"./app-BB4Fw2oM.js";import{Q as v}from"./QForm-zhfWFjRn.js";import{f,r as b,a as _,af as g,M as x,J as q,b as w,N as k,K as h,I as y,Q as M,V as Q,W as G,F as j,R as A,z as H,$ as S}from"./vendor-DuKqz2x4.js";import{s as L}from"./i18n-DE5KxGn8.js";import{r as T}from"./katex-BAATRBTg.js";import{d as V}from"./date-BcHEbKQH.js";import"./offline-BzIlwqNM.js";import"./ui-BITzTqrO.js";import"./katex-BXKQVcz-.js";const C={class:"q-pa-md"},N={class:"row items-center"},U={class:"col"},E={class:"text-h5"},F={class:"text-subtitle2"},O={class:"row q-gutter-md"},R={class:"col-12 col-sm-6 col-md-3"},Y={class:"text-h6"},z={class:"col-12 col-sm-6 col-md-3"},D={class:"text-h6"},$={class:"col-12 col-sm-6 col-md-3"},I={class:"text-h6"},P={class:"col-12 col-sm-6 col-md-3"},B={class:"row items-start"},J={class:"col"},K={class:"text-subtitle1 text-weight-bold q-mb-sm"},W=["innerHTML"],X={class:"q-mb-sm"},Z={class:"col-auto text-center"},ee={class:"text-subtitle1 text-weight-bold q-mb-sm"},te=["innerHTML"],ae={key:0,class:"q-mb-md"},se=["innerHTML"],le={class:"q-mb-md"},re=["innerHTML"],oe={class:"row q-gutter-md"},de={class:"col-12 col-sm-3"},ne={class:"col"},ie=t({__name:"QuGrading",props:{attempt:Object,autoGraded:Array,manualQuestions:Array,totalMarks:Number},setup(t){const ie=t,ce=f(!1),ue=b({});ie.manualQuestions.forEach(e=>{var t,a;ue[e.answer.id]={answer_id:e.answer.id,marks_obtained:null!=(t=e.answer.marks_obtained)?t:0,feedback:null!=(a=e.answer.feedback)?a:""}});const me=_(()=>{let e=0;return ie.autoGraded.forEach(t=>{e+=parseFloat(t.answer.marks_obtained)||0}),Object.values(ue).forEach(t=>{e+=parseFloat(t.marks_obtained)||0}),Math.round(e)}),pe=_(()=>{const e=ie.attempt.grading_status;return"completed"===e?"positive":"partial"===e?"orange":"grey"}),ve=_(()=>{const e=ie.attempt.grading_status;return e.charAt(0).toUpperCase()+e.slice(1)}),fe=e=>{var t;if("mcq"===e.question.question_type)return e.answer.selected_options||"No answer";if("true_false"===e.question.question_type){const a=null==(t=e.answer.selected_options)?void 0:t[0];return a?a.charAt(0).toUpperCase()+a.slice(1):"No answer"}return"No answer"},be=()=>{ce.value=!0,S.post(L("qu-grading.save",ie.attempt.id),{grades:Object.values(ue)},{onSuccess:()=>{ce.value=!1},onError:()=>{ce.value=!1}})},_e=()=>{S.visit(L("qu-grading.index"))};return(f,b)=>{const _=g("Head");return q(),x(j,null,[w(_,{title:"Grade Exam Attempt"}),k("div",C,[w(l,null,{default:h(()=>[w(a,{class:"bg-primary text-white"},{default:h(()=>[k("div",N,[k("div",U,[k("div",E,Q(t.attempt.exam.title),1),k("div",F,"Grading: "+Q(t.attempt.user.name),1)]),w(e),w(s,{flat:"",dense:"",round:"",icon:"close",onClick:_e})])]),_:1}),w(a,null,{default:h(()=>[k("div",O,[k("div",R,[w(l,{flat:"",bordered:""},{default:h(()=>[w(a,{class:"text-center"},{default:h(()=>[k("div",Y,Q(t.attempt.user.name),1),b[0]||(b[0]=k("div",{class:"text-caption text-grey-7"},"Student",-1))]),_:1})]),_:1})]),k("div",z,[w(l,{flat:"",bordered:""},{default:h(()=>[w(a,{class:"text-center"},{default:h(()=>{return[k("div",D,Q((e=t.attempt.completed_at,V.formatDate(e,"YYYY-MM-DD HH:mm"))),1),b[1]||(b[1]=k("div",{class:"text-caption text-grey-7"},"Submitted",-1))];var e}),_:1})]),_:1})]),k("div",$,[w(l,{flat:"",bordered:""},{default:h(()=>[w(a,{class:"text-center"},{default:h(()=>[k("div",I,Q(me.value)+" / "+Q(t.totalMarks),1),b[2]||(b[2]=k("div",{class:"text-caption text-grey-7"},"Current Score",-1))]),_:1})]),_:1})]),k("div",P,[w(l,{flat:"",bordered:""},{default:h(()=>[w(a,{class:"text-center"},{default:h(()=>[w(r,{color:pe.value,"text-color":"white"},{default:h(()=>[G(Q(ve.value),1)]),_:1},8,["color"]),b[3]||(b[3]=k("div",{class:"text-caption text-grey-7"},"Status",-1))]),_:1})]),_:1})])])]),_:1}),w(o),t.autoGraded.length>0?(q(),y(a,{key:0},{default:h(()=>[b[5]||(b[5]=k("div",{class:"text-h6 q-mb-md"},"Auto-Graded Questions",-1)),w(d,{separator:""},{default:h(()=>[(q(!0),x(j,null,A(t.autoGraded,(e,t)=>(q(),y(n,{key:"auto-"+e.question.id,class:"q-pa-md"},{default:h(()=>[w(i,null,{default:h(()=>[k("div",B,[k("div",J,[k("div",K," Question "+Q(t+1),1),k("div",{class:"text-body1 q-mb-md",innerHTML:H(T)(e.question.question_text)},null,8,W),k("div",X,[b[4]||(b[4]=k("div",{class:"text-caption text-grey-7"},"Student Answer:",-1)),w(r,{color:e.is_correct?"positive":"negative","text-color":"white"},{default:h(()=>[G(Q(fe(e)),1)]),_:2},1032,["color"])])]),k("div",Z,[w(r,{color:e.is_correct?"positive":"negative","text-color":"white",size:"lg"},{default:h(()=>[w(c,{name:e.is_correct?"check_circle":"cancel",size:"sm",class:"q-mr-sm"},null,8,["name"]),G(" "+Q(e.answer.marks_obtained)+" / "+Q(e.question.marks),1)]),_:2},1032,["color"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):M("",!0),t.autoGraded.length>0&&t.manualQuestions.length>0?(q(),y(o,{key:1})):M("",!0),t.manualQuestions.length>0?(q(),y(a,{key:2},{default:h(()=>[b[8]||(b[8]=k("div",{class:"text-h6 q-mb-md"},"Questions Requiring Manual Grading",-1)),w(v,{onSubmit:be},{default:h(()=>[w(d,{separator:""},{default:h(()=>[(q(!0),x(j,null,A(t.manualQuestions,(e,a)=>(q(),y(n,{key:"manual-"+e.question.id,class:"q-pa-md"},{default:h(()=>[w(i,null,{default:h(()=>[k("div",ee," Question "+Q(t.autoGraded.length+a+1),1),k("div",{class:"text-body1 q-mb-md",innerHTML:H(T)(e.question.question_text)},null,8,te),e.question.correct_answer?(q(),x("div",ae,[b[6]||(b[6]=k("div",{class:"text-caption text-grey-7 q-mb-xs"},"Model Answer:",-1)),w(l,{flat:"",bordered:"",class:"q-pa-sm bg-green-1"},{default:h(()=>[k("div",{innerHTML:H(T)(e.question.correct_answer)},null,8,se)]),_:2},1024)])):M("",!0),k("div",le,[b[7]||(b[7]=k("div",{class:"text-caption text-grey-7 q-mb-xs"},"Student Answer:",-1)),w(l,{flat:"",bordered:"",class:"q-pa-sm bg-grey-1"},{default:h(()=>[k("div",{innerHTML:H(T)(e.answer.answer_text||"No answer provided")},null,8,re)]),_:2},1024)]),k("div",oe,[k("div",de,[w(u,{modelValue:ue[e.answer.id].marks_obtained,"onUpdate:modelValue":t=>ue[e.answer.id].marks_obtained=t,modelModifiers:{number:!0},type:"number",label:"Marks Awarded",hint:`Out of ${e.question.marks}`,rules:[e=>null!==e&&""!==e||"Required",e=>e>=0||"Must be >= 0",t=>t<=e.question.marks||`Max ${e.question.marks}`],outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue","hint","rules"])]),k("div",ne,[w(u,{modelValue:ue[e.answer.id].feedback,"onUpdate:modelValue":t=>ue[e.answer.id].feedback=t,type:"textarea",label:"Feedback (Optional)",hint:"Provide feedback to help the student improve",outlined:"",dense:"",rows:"3"},null,8,["modelValue","onUpdate:modelValue"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),w(m,{align:"right",class:"q-pa-md"},{default:h(()=>[w(s,{flat:"",label:"Cancel",color:"grey",onClick:_e}),w(s,{type:"submit",label:"Save Grades",color:"primary",icon:"save",loading:ce.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})):t.autoGraded.length>0?(q(),y(a,{key:3},{default:h(()=>[w(p,{class:"bg-positive text-white"},{avatar:h(()=>[w(c,{name:"check_circle"})]),default:h(()=>[b[9]||(b[9]=G(" All questions have been auto-graded. No manual grading required. "))]),_:1}),w(m,{align:"center",class:"q-pa-md"},{default:h(()=>[w(s,{label:"Back to Grading List",color:"primary",icon:"arrow_back",onClick:_e})]),_:1})]),_:1})):M("",!0)]),_:1})])],64)}}},[["__scopeId","data-v-3553814a"]]);export{ie as default};
