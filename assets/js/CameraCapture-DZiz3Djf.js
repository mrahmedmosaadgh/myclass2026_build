import{o as e}from"./app-C-WHvmzS.js";import{f as a,a as l,N as t,J as u,Q as n,y as v,O as i,a0 as o,Y as c,n as s}from"./vendor-nQjeLEvd.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";const r={class:"camera-capture"},h={key:0},d={class:"section"},f={class:"section"},g={class:"camera-controls"},p={key:0,class:"section-title"},y={key:1,class:"crop-instruction"},m={key:2,class:"crop-instruction success"},w=["width","height"],x={key:4,class:"crop-buttons"},k=["disabled"],C={key:5,class:"cropped-preview"},b=["src"],R=e({__name:"CameraCapture",emits:["captured"],setup(e,{emit:R}){const T=R,I=a(null),M=a(null),S=a(!1),j=a(!1),E=a(!1),U=a({x:0,y:0}),_=a({x:0,y:0}),D=a(null),A=l(()=>D.value&&D.value.w>2&&D.value.h>2),P=a(null),W=a(null),F=a(300),L=a(300);let Y=null;function B(e){const a=e.target.files[0];if(!a)return;const l=new FileReader;l.onload=e=>{return a=e.target.result,P.value=new Image,P.value.src=a,void(P.value.onload=()=>{j.value=!0,F.value=P.value.width,L.value=P.value.height,s(N)});var a},l.readAsDataURL(a)}const O=a("user");function X(){Y&&Y.getTracks().forEach(e=>e.stop()),navigator.mediaDevices.getUserMedia({video:{facingMode:O.value}}).then(e=>{Y=e,S.value=!0,s(()=>I.value.srcObject=Y)})}function H(){O.value="user"===O.value?"environment":"user",X()}function J(){const e=I.value,a=M.value;if(!a||!e)return;a.width=e.videoWidth,a.height=e.videoHeight;a.getContext("2d").drawImage(e,0,0,a.width,a.height),P.value=new Image,P.value.src=a.toDataURL("image/png"),P.value.onload=()=>{j.value=!0,S.value=!1,Y&&Y.getTracks().forEach(e=>e.stop()),s(N)}}function N(){const e=M.value;if(!e||!P.value)return;const a=e.getContext("2d");if(a.clearRect(0,0,e.width,e.height),a.drawImage(P.value,0,0,e.width,e.height),D.value){a.fillStyle="rgba(0, 0, 0, 0.6)",a.fillRect(0,0,e.width,e.height),a.clearRect(D.value.x,D.value.y,D.value.w,D.value.h),a.drawImage(P.value,D.value.x,D.value.y,D.value.w,D.value.h,D.value.x,D.value.y,D.value.w,D.value.h),a.fillStyle="rgba(76, 175, 80, 0.4)",a.fillRect(D.value.x,D.value.y,D.value.w,D.value.h),a.strokeStyle="#4CAF50",a.lineWidth=3,a.strokeRect(D.value.x,D.value.y,D.value.w,D.value.h);const l=20,t=[{x:D.value.x,y:D.value.y},{x:D.value.x+D.value.w,y:D.value.y},{x:D.value.x,y:D.value.y+D.value.h},{x:D.value.x+D.value.w,y:D.value.y+D.value.h}];a.fillStyle="#4CAF50",a.strokeStyle="#ffffff",a.lineWidth=2,t.forEach(e=>{a.beginPath(),a.arc(e.x,e.y,l/2,0,2*Math.PI),a.fill(),a.stroke()});const u=D.value.x+D.value.w/2,n=D.value.y+D.value.h/2,v=15;a.strokeStyle="#ffffff",a.lineWidth=2,a.beginPath(),a.moveTo(u-v,n),a.lineTo(u+v,n),a.moveTo(u,n-v),a.lineTo(u,n+v),a.stroke()}}function Q(e){const a=M.value.getBoundingClientRect(),l=M.value.width/a.width,t=M.value.height/a.height;return{x:(e.clientX-a.left)*l,y:(e.clientY-a.top)*t}}function q(e){const a=M.value.getBoundingClientRect(),l=M.value.width/a.width,t=M.value.height/a.height,u=e.touches[0]||e.changedTouches[0];return{x:(u.clientX-a.left)*l,y:(u.clientY-a.top)*t}}function z(e){j.value&&(E.value=!0,U.value=Q(e),D.value=null)}function G(e){E.value&&(_.value=Q(e),ee())}function K(){E.value=!1}function V(e){j.value&&(E.value=!0,U.value=q(e),D.value=null)}function Z(e){E.value&&(_.value=q(e),ee())}function $(){E.value=!1}function ee(){D.value={x:Math.min(U.value.x,_.value.x),y:Math.min(U.value.y,_.value.y),w:Math.abs(_.value.x-U.value.x),h:Math.abs(_.value.y-U.value.y)},N()}const ae=a(0);function le(){if(!A.value)return;const e=document.createElement("canvas");e.width=D.value.w,e.height=D.value.h;e.getContext("2d").drawImage(P.value,D.value.x,D.value.y,D.value.w,D.value.h,0,0,e.width,e.height),W.value=e.toDataURL("image/png"),D.value=null,E.value=!1,ae.value=1,s(N)}function te(){T("captured",{dataUrl:W.value}),Y&&(Y.getTracks().forEach(e=>e.stop()),Y=null),S.value=!1}function ue(){D.value=null,W.value=null,ae.value=0,E.value=!1,j.value=!1,P.value=null,Y&&(Y.getTracks().forEach(e=>e.stop()),Y=null),S.value=!1;const e=M.value;if(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}F.value=300,L.value=300}return(e,a)=>(u(),t("div",r,[j.value?n("",!0):(u(),t("div",h,[i("div",d,[a[0]||(a[0]=i("div",{class:"section-title"},"ğŸ“‚ Upload Image",-1)),i("input",{type:"file",accept:"image/*",onChange:B},null,32)]),i("div",f,[a[1]||(a[1]=i("div",{class:"section-title"},"ğŸ“¸ Camera",-1)),i("div",g,[i("button",{class:"touch-btn primary",onClick:X},"Start Camera"),i("button",{class:"touch-btn warning",onClick:H},"ğŸ”„ Switch Camera"),v(i("video",{ref_key:"video",ref:I,autoplay:"",playsinline:"",class:"video"},null,512),[[c,S.value]]),S.value?(u(),t("button",{key:0,class:"touch-btn success",onClick:J},"Capture")):n("",!0)])])])),v(i("div",null,[j.value?(u(),t("div",p,"âœ‚ï¸ Crop Image")):n("",!0),j.value&&!D.value?(u(),t("div",y," ğŸ‘† Drag on the image to select the area you want to crop ")):n("",!0),j.value&&D.value?(u(),t("div",m,' âœ… Selection made! Adjust or tap "Crop" to continue ')):n("",!0),W.value?n("",!0):v((u(),t("canvas",{key:3,ref_key:"canvas",ref:M,width:F.value,height:L.value,onMousedown:z,onMousemove:G,onMouseup:K,onTouchstart:o(V,["prevent"]),onTouchmove:o(Z,["prevent"]),onTouchend:o($,["prevent"]),class:"crop-canvas"},null,40,w)),[[c,j.value]]),j.value&&!W.value?(u(),t("div",x,[i("button",{class:"touch-btn success",onClick:le,disabled:!A.value},"âœ‚ï¸ Crop",8,k),i("button",{class:"touch-btn danger",onClick:ue},"âŒ Cancel")])):n("",!0),W.value?(u(),t("div",C,[a[2]||(a[2]=i("div",{class:"section-title"},"âœ… Preview",-1)),i("img",{src:W.value,class:"preview-img"},null,8,b),i("div",{class:"cropped-actions"},[i("button",{class:"touch-btn primary",onClick:te},"ğŸ’¾ Save"),i("button",{class:"touch-btn warning",onClick:ue},"ğŸ”„ Retake")])])):n("",!0)],512),[[c,!0]])]))}},[["__scopeId","data-v-0c843920"]]);export{R as default};
