import{u as e,c as l,d as a,a as s,l as t,Q as o,m as i,b as d}from"./app-CqJgtQaN.js";import{Q as u}from"./QSelect-DIrzf0A1.js";import{Q as n}from"./QForm-B30T44oJ.js";import{Q as c}from"./QBadge-Coi-CloS.js";import{a3 as m,f as r,k as p,a as v,_ as g,I as h,J as y,K as f,b as x,N as q,z as _,Q as b,V as w}from"./vendor-DuKqz2x4.js";import{u as S}from"./schoolData-CkY39Iur.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";import"./rtl-Cr6c3OOr.js";const V={class:"row q-col-gutter-md"},j={class:"col-12"},k={class:"row q-col-gutter-md q-mt-none"},z={class:"col-12 col-md-4"},I={class:"col-12 col-md-4"},C={class:"col-12 col-md-4"},Q={class:"row justify-center q-gutter-md"},U={class:"text-weight-medium"},F={class:"text-weight-medium"},Y={class:"text-weight-medium"},A={class:"text-weight-medium"},B={__name:"SchoolSettingsDialog",props:{modelValue:{type:Boolean,default:!1},schoolId:{type:Number,required:!1,default:null}},emits:["update:modelValue","saved","cancel"],setup(B,{emit:D}){const N=e(),J=S(),{schools:K}=m(J),O=B,P=D,R=r(!1),T=r(null),$=r(null),E=r(null),G=r(null),H=r([]),L=r([]),M=r([]);p(()=>O.modelValue,e=>{R.value=e,e&&(O.schoolId&&(T.value=O.schoolId),ee())}),p(R,e=>{P("update:modelValue",e)}),p(T,async e=>{e&&R.value&&await ee()});const W=v(()=>T.value&&$.value&&E.value&&G.value),X=e=>{const l=K.value.find(l=>l.id===e);return l?l.name:"Unknown School"},Z=async e=>{e&&await J.setSchool(e)},ee=async()=>{var e,l;try{if(H.value=J.academicYears,L.value=J.semesters,M.value=J.scheduleCopies,0===H.value.length){const e=await g.get("/api/academic-years");H.value=e.data.data||e.data}if(0===L.value.length){const e=await g.get("/api/semesters");L.value=e.data.data||e.data}if(T.value){if(0===M.value.length){const e=await g.get("/api/schedule-copies",{params:{school_id:T.value}});M.value=e.data}}else M.value=[];T.value&&await le()}catch(a){N.notify({type:"negative",message:"Failed to load options",caption:(null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||a.message})}},le=async()=>{var e,l;try{J.academicYearId&&($.value=H.value.find(e=>e.id===J.academicYearId)||null),J.semesterId&&(E.value=L.value.find(e=>e.id===J.semesterId)||null),J.scheduleCopyId&&(G.value=M.value.find(e=>e.id===J.scheduleCopyId)||null)}catch(a){N.notify({type:"negative",message:"Failed to load current settings",caption:(null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||a.message})}},ae=async()=>{var e,l,a,s,t;if(W.value)try{await J.updateSchoolSettings({academic_year_id:(null==(e=$.value)?void 0:e.id)||null,semester_id:(null==(l=E.value)?void 0:l.id)||null,schedule_copy_id:(null==(a=G.value)?void 0:a.id)||null}),N.notify({type:"positive",message:"School settings saved successfully"}),P("saved"),R.value=!1}catch(o){N.notify({type:"negative",message:"Failed to save settings",caption:(null==(t=null==(s=o.response)?void 0:s.data)?void 0:t.message)||o.message})}else N.notify({type:"warning",message:"Please fill in all required fields",caption:"All fields marked with * are required"})};return(e,m)=>(y(),h(d,{modelValue:R.value,"onUpdate:modelValue":m[5]||(m[5]=e=>R.value=e),persistent:"",maximized:""},{default:f(()=>[x(i,{style:{"max-width":"800px",margin:"auto"},class:"q-pa-lg"},{default:f(()=>[x(l,{class:"text-center"},{default:f(()=>m[6]||(m[6]=[q("div",{class:"text-h5 text-primary q-mb-sm"},"School Configuration",-1),q("div",{class:"text-subtitle1 text-grey"},"Set up school context for the weekly planning system",-1)])),_:1}),x(l,null,{default:f(()=>[x(n,{class:"q-gutter-y-md"},{default:f(()=>[q("div",V,[q("div",j,[x(u,{modelValue:T.value,"onUpdate:modelValue":[m[0]||(m[0]=e=>T.value=e),Z],options:_(J).schools,"option-value":"id","option-label":"name",label:"Select School *",outlined:"",dense:"","emit-value":"","map-options":"",loading:_(J).loading,rules:[e=>!!e||"School selection is required"],class:"full-width"},{prepend:f(()=>[x(a,{name:"school",color:"primary"})]),_:1},8,["modelValue","options","loading","rules"])])]),q("div",k,[q("div",z,[x(u,{modelValue:$.value,"onUpdate:modelValue":m[1]||(m[1]=e=>$.value=e),options:H.value,"option-value":"id","option-label":"name",label:"Academic Year *",outlined:"",dense:"","map-options":"",rules:[e=>!!e||"Academic year is required"]},{prepend:f(()=>[x(a,{name:"calendar_month",color:"blue"})]),_:1},8,["modelValue","options","rules"])]),q("div",I,[x(u,{modelValue:E.value,"onUpdate:modelValue":m[2]||(m[2]=e=>E.value=e),options:L.value,"option-value":"id","option-label":"name",label:"Semester *",outlined:"",dense:"","map-options":"",rules:[e=>!!e||"Semester is required"]},{prepend:f(()=>[x(a,{name:"event",color:"indigo"})]),_:1},8,["modelValue","options","rules"])]),q("div",C,[x(u,{modelValue:G.value,"onUpdate:modelValue":m[3]||(m[3]=e=>G.value=e),options:M.value,"option-value":"id","option-label":"name",label:"Schedule Copy *",outlined:"",dense:"","map-options":"",rules:[e=>!!e||"Schedule copy is required"]},{prepend:f(()=>[x(a,{name:"schedule",color:"teal"})]),_:1},8,["modelValue","options","rules"])])])]),_:1})]),_:1}),x(s,{class:"q-my-md"}),x(l,{class:"text-center"},{default:f(()=>[m[7]||(m[7]=q("div",{class:"text-h6 text-weight-medium text-primary q-mb-md"},"Current Selection",-1)),q("div",Q,[T.value?(y(),h(c,{key:0,color:"primary",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:f(()=>[x(a,{name:"school",size:"18px",class:"q-mr-xs"}),q("span",U,w(X(T.value)),1)]),_:1})):b("",!0),$.value?(y(),h(c,{key:1,color:"blue-6",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:f(()=>[x(a,{name:"calendar_month",size:"18px",class:"q-mr-xs"}),q("span",F,w($.value.name),1)]),_:1})):b("",!0),E.value?(y(),h(c,{key:2,color:"indigo-6",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:f(()=>[x(a,{name:"event",size:"18px",class:"q-mr-xs"}),q("span",Y,w(E.value.name),1)]),_:1})):b("",!0),G.value?(y(),h(c,{key:3,color:"teal-6",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:f(()=>[x(a,{name:"schedule",size:"18px",class:"q-mr-xs"}),q("span",A,w(G.value.name),1)]),_:1})):b("",!0)])]),_:1}),x(t,{align:"right",class:"q-pt-lg"},{default:f(()=>[x(o,{label:"Cancel",color:"grey",flat:"",onClick:m[4]||(m[4]=l=>e.$emit("cancel")),class:"q-px-md"}),x(o,{label:"Save Settings",icon:"save",color:"primary",onClick:ae,disable:!W.value,class:"q-px-xl"},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{B as default};
