import{p as e,u as a,Q as l,q as o}from"./app-BXm70mdJ.js";import{Q as t}from"./QLinearProgress-Cix0cchl.js";import{f as r,a as u,k as n,o as i,e as s,L as v,I as d,M as c,O as f,b as p,U as m,J as y,V as h,n as g}from"./vendor-DNM7Y6Xn.js";import"./offline-BzIlwqNM.js";import"./i18n-CBOKL2HS.js";import"./ui-BP0GJNn5.js";const w={class:"voice-player"},k={class:"row items-center q-gutter-sm"},_={class:"col"},C={class:"text-caption text-grey-7 time-display"},R=["src"],b=e({__name:"VoicePlayer",props:{audioUrl:{type:String,required:!0},showWaveform:{type:Boolean,default:!1},autoplay:{type:Boolean,default:!1}},setup(e){const b=e,W=a(),x=r(null),E=r(null),j=r(null),S=r(!1),z=r(!1),U=r(0),q=r(0),B=r(!1),M=r(1),T=r([]),L=[.5,.75,1,1.25,1.5,2],N=u(()=>q.value>0?U.value/q.value:0),P=async()=>{if(x.value)try{S.value?x.value.pause():(z.value=!0,await x.value.play())}catch(e){console.error("Error playing audio:",e),W.notify({type:"negative",message:"Failed to play audio",position:"top"})}finally{z.value=!1}},Q=e=>{if(!x.value||0===q.value)return;const a=e.target.getBoundingClientRect(),l=(e.clientX-a.left)/a.width*q.value;x.value.currentTime=l},$=e=>{if(!x.value||0===q.value)return;const a=E.value.getBoundingClientRect(),l=(e.clientX-a.left)/a.width*q.value;x.value.currentTime=l},A=()=>{x.value&&(B.value=!B.value,x.value.muted=B.value)},D=()=>{const e=(L.indexOf(M.value)+1)%L.length;M.value=L[e],x.value&&(x.value.playbackRate=M.value)},I=()=>{const e=document.createElement("a");e.href=b.audioUrl,e.download=`voice-note-${Date.now()}.wav`,document.body.appendChild(e),e.click(),document.body.removeChild(e)},O=e=>{if(!e||isNaN(e))return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`},V=()=>{if(!E.value||!T.value.length)return;const e=E.value,a=e.getContext("2d"),l=e.width,o=e.height;a.clearRect(0,0,l,o),a.fillStyle="#1976d2";const t=l/T.value.length;T.value.forEach((e,l)=>{const r=e*o,u=l*t,n=(o-r)/2;a.fillRect(u,n,t-1,r)}),N.value>0&&(a.fillStyle="rgba(25, 118, 210, 0.3)",a.fillRect(0,0,l*N.value,o))},X=()=>{q.value=x.value.duration,b.autoplay&&P(),b.showWaveform&&(async()=>{if(b.showWaveform&&x.value)try{const e=100,a=[];for(let l=0;l<e;l++)a.push(.8*Math.random()+.1);T.value=a,await g(),V()}catch(e){console.error("Error generating waveform:",e)}})()},F=()=>{U.value=x.value.currentTime,b.showWaveform&&V()},J=()=>{S.value=!1,U.value=0,b.showWaveform&&V()},G=e=>{console.error("Audio error:",e),z.value=!1,W.notify({type:"negative",message:"Error loading audio file",position:"top"})};return n(()=>{var e;return null==(e=x.value)?void 0:e.paused},e=>{S.value=!e}),n(()=>b.audioUrl,()=>{x.value&&x.value.load()}),i(()=>{if(E.value&&b.showWaveform){const e=E.value;e.width=e.offsetWidth,e.height=60}}),s(()=>{x.value&&x.value.pause()}),(a,r)=>(d(),v("div",w,[c("div",k,[p(l,{icon:S.value?"pause":"play_arrow",round:"",color:"primary",size:"sm",onClick:P,loading:z.value},null,8,["icon","loading"]),c("div",_,[p(t,{value:N.value,color:"primary","track-color":"grey-3",size:"8px",rounded:"",class:"cursor-pointer",onClick:Q},null,8,["value"])]),c("div",C,m(O(U.value))+" / "+m(O(q.value)),1),p(l,{icon:B.value?"volume_off":"volume_up",flat:"",round:"",size:"sm",onClick:A},null,8,["icon"]),p(l,{icon:"download",flat:"",round:"",size:"sm",onClick:I},{default:y(()=>[p(o,null,{default:y(()=>r[0]||(r[0]=[h("Download Audio")])),_:1})]),_:1}),p(l,{flat:"",round:"",size:"sm",onClick:D,class:"speed-btn"},{default:y(()=>[h(m(M.value)+"x ",1),p(o,null,{default:y(()=>r[1]||(r[1]=[h("Playback Speed")])),_:1})]),_:1})]),e.showWaveform?(d(),v("div",{key:0,class:"waveform-container q-mt-sm",ref_key:"waveformRef",ref:j},[c("canvas",{ref_key:"canvasRef",ref:E,class:"waveform-canvas",onClick:$},null,512)],512)):f("",!0),c("audio",{ref_key:"audioRef",ref:x,src:e.audioUrl,preload:"metadata",onLoadedmetadata:X,onTimeupdate:F,onEnded:J,onError:G},null,40,R)]))}},[["__scopeId","data-v-7967f027"]]);export{b as default};
