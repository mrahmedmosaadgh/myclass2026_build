import{p as e,u as l,e as a,o as n,Q as t,n as o,b as s,q as r}from"./app-BzjXrVp9.js";import{Q as i}from"./QSelect-CciNNEfD.js";import{Q as u}from"./QLinearProgress-L5RdawR6.js";import{Q as c}from"./QSpinnerDots-CsCCDASU.js";import{Q as d}from"./QTab-Cx9aTRVb.js";import{Q as m}from"./QTabs-BwLFzVWR.js";import{Q as p}from"./QSpace-qzKo_-If.js";import{Q as v,a as y}from"./QToolbar-BqA_2ejV.js";import{f as b,a as w,k as h,o as g,ac as f,L as k,I as x,b as P,M as _,H as j,x as V,V as q,U as Q,y as T,J as D,O as M,F as C,Q as S,Z as z,X as E,S as L,R as H}from"./vendor-EI0FRBVb.js";import F from"./WeekSelector-Cn9kyFTI.js";import U from"./WeeklyPlanEditor-jaQDfVyn.js";import W from"./WeeklyPlanClassroomList-_9V8ptNR.js";import $ from"./StatusBadge-D6cZlTBs.js";import N from"./WeeklyPlanMenu-DQoKCqg-.js";import{u as I}from"./i18n-BbKXhR_S.js";import"./offline-BzIlwqNM.js";import"./ui-B__oX9pK.js";import"./rtl-Cr6c3OOr.js";import"./QEditor-BUWuwjqA.js";import"./use-fullscreen-BnDnBhbA.js";import"./QTd-DUSBgVC_.js";import"./QBadge-D2ciqrkO.js";import"./QTable-BcXT6C-J.js";import"./QMarkupTable-_1wJRVO3.js";import"./WeeklySystemGuide-B84Ji3tk.js";import"./QTabPanel-BWvsj8on.js";import"./use-panel-DdQZ_Vdk.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-C2OMgZHe.js";import"./MainSchoolData-CJWlOJsc.js";import"./schoolData-BnE_O2cp.js";import"./SchoolSettingsDialog-Dnqkq0FS.js";import"./QForm-qY0qTz8Q.js";const A={class:"q-pa-md"},O={class:"row items-center q-mb-lg"},B={class:"col"},G={class:"q-ma-none text-weight-bold"},J={class:"text-grey-7 q-mb-none"},R={class:"row q-gutter-md items-center"},K={class:"col-12 col-sm-6 col-md-4"},Y={class:"col-12 col-sm-3 col-md-2"},Z={class:"col-auto q-ml-auto"},X={class:"absolute-full flex flex-center"},ee={class:"text-caption text-weight-bold"},le={class:"row q-gutter-md items-center q-mt-sm"},ae={class:"col-12 col-sm-6 col-md-4"},ne={class:"col-12 col-sm-6 col-md-4"},te={class:"col-auto"},oe={key:0,class:"col-12 col-sm-6 col-md-auto q-gutter-sm"},se={key:0,class:"row justify-center q-pa-xl"},re={class:"text-h6 text-grey-7 q-mt-md"},ie={class:"text-grey-6"},ue={class:"plans-grid"},ce={class:"day-header"},de=["onClick"],me={class:"period-badge"},pe={class:"subject-name"},ve={class:"flex q-gutter-xs"},ye={class:"classroom text-caption text-grey-7"},be={class:"plan-status"},we={key:0,class:"plan-preview text-caption"},he={key:0,class:"preview-item"},ge={key:1,class:"preview-item"},fe={class:"preview-container q-pa-md"},ke={id:"print-area",class:"a4-page"},xe={class:"print-header q-mb-lg"},Pe={class:"q-ma-none"},_e={class:"q-ma-xs text-grey-7"},je={class:"q-ma-xs text-grey-7"},Ve={class:"q-ma-xs text-grey-7"},qe={class:"print-table"},Qe={class:"text-center"},Te=["innerHTML"],De=["innerHTML"],Me=["innerHTML"],Ce={class:"print-footer q-mt-lg"},Se={class:"text-caption text-grey-6"},ze=e({__name:"MyWeeklyPlans",setup(e){const{t:ze,locale:Ee}=I(),Le=l(),He=b([]),Fe=b(null),Ue=b(1),We=b(1),$e=b(18),Ne=b(1),Ie=b([]),Ae=b([]),Oe=b(null),Be=b(null),Ge=b(!1),Je=b(null),Re=b(!1),Ke=b(!1),Ye=b("by-classroom"),Ze=b(!1),Xe=b({}),el=b(!1),ll=w(()=>[{label:`${ze("weeklyPlans.semester")} 1`,value:1},{label:`${ze("weeklyPlans.semester")} 2`,value:2}]),al=w(()=>[{label:ze("weeklyPlans.fullDays.1"),value:1},{label:ze("weeklyPlans.fullDays.2"),value:2},{label:ze("weeklyPlans.fullDays.3"),value:3},{label:ze("weeklyPlans.fullDays.4"),value:4},{label:ze("weeklyPlans.fullDays.5"),value:5}]),nl=w(()=>{const e={};return al.value.forEach(l=>{e[l.value]=l.label}),e}),tl=w(()=>{const e=new Set;return He.value.forEach(l=>{var a,n;(null==(n=null==(a=l.schedule)?void 0:a.cst)?void 0:n.classroom_name)&&e.add(l.schedule.cst.classroom_name)}),Array.from(e).sort()}),ol=w(()=>{var e,l;let a=He.value;return(null==(e=Ie.value)?void 0:e.length)&&(a=a.filter(e=>{var l,a;return Ie.value.includes(null==(a=null==(l=e.schedule)?void 0:l.cst)?void 0:a.classroom_name)})),(null==(l=Ae.value)?void 0:l.length)&&(a=a.filter(e=>{var l;return Ae.value.includes(null==(l=e.schedule)?void 0:l.day)})),a}),sl=w(()=>{const e={};return ol.value.forEach(l=>{var a;const n=null==(a=l.schedule)?void 0:a.day;e[n]||(e[n]={dayNumber:n,dayName:ze(`weeklyPlans.fullDays.${n}`)||`Day ${n}`,plans:[]}),e[n].plans.push(l)}),Object.values(e).forEach(e=>{e.plans.sort((e,l)=>{var a,n;return(null==(a=e.schedule)?void 0:a.period_number)-(null==(n=l.schedule)?void 0:n.period_number)})}),Object.values(e).sort((e,l)=>e.dayNumber-l.dayNumber)}),rl=w(()=>{const e=He.value.length;if(!e)return 0;const l=He.value.filter(e=>"completed"===e.status).length;return Math.round(l/e*100)}),il=w(()=>{const e=rl.value;return 100===e?"positive":e>=50?"warning":"negative"}),ul=e=>{var l,a;const n=!!(null==(l=e.cw)?void 0:l.trim()),t=!!(null==(a=e.hw)?void 0:a.trim());return n||t?n&&t?"completed":"partial":"empty"},cl=e=>{var l,a,n,t;return{backgroundColor:(null==(a=null==(l=e.schedule)?void 0:l.cst)?void 0:a.c_bg)||"#e0e0e0",color:(null==(t=null==(n=e.schedule)?void 0:n.cst)?void 0:t.c_text)||"#333"}},dl=async()=>{el.value=!0;try{const e=await z.get("/weekly-system/api/teacher/my-weekly-plans",{params:{week_number:Ue.value,semester_number:We.value}});He.value=(e.data.data||e.data||[]).map(e=>({...e,...e.schedule,status:ul(e)}))}catch(e){console.error("Error fetching plans:",e),Le.notify({type:"negative",message:"Failed to load weekly plans"})}finally{el.value=!1}},ml=e=>{Oe.value||(Je.value=e,Ge.value=!0)},pl=async e=>{Re.value=!0;try{await z.put(`/weekly-system/api/weekly-plans/${e.id}`,{cw:e.cw,hw:e.hw,notes:e.notes}),Le.notify({type:"positive",message:"Weekly plan saved!"}),Ge.value=!1,await dl()}catch(l){console.error("Error saving plan:",l),Le.notify({type:"negative",message:"Failed to save plan"})}finally{Re.value=!1}},vl=async e=>{if(!Xe.value[e.id]){Xe.value[e.id]=!0;try{await z.put(`/weekly-system/api/weekly-plans/${e.id}`,{cw:e.cw,hw:e.hw,notes:e.notes}),e.status=ul(e),Le.notify({type:"positive",message:"Saved!",timeout:1e3,position:"top"})}catch(l){console.error("Error saving inline edit:",l),Le.notify({type:"negative",message:"Failed to save changes"})}finally{delete Xe.value[e.id]}}},yl=()=>{const e=document.getElementById("print-area");if(!e)return void Le.notify({type:"negative",message:"Print area not found"});const l=window.open("","_blank");l.document.write(`\n    <!DOCTYPE html>\n    <html lang="en">\n    <head>\n      <meta charset="UTF-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      <title>Weekly Plans - Print</title>\n      <style>\n        * {\n          margin: 0;\n          padding: 0;\n          box-sizing: border-box;\n        }\n        \n        @page {\n          size: A4;\n          margin: 10mm;\n        }\n        \n        body {\n          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n          background-color: white;\n          color: #333;\n          line-height: 1.4;\n        }\n        \n        .print-header {\n          margin-bottom: 24px;\n          border-bottom: 2px solid #1976d2;\n          padding-bottom: 12px;\n        }\n        \n        .print-header h2 {\n          font-size: 24px;\n          color: #1976d2;\n          margin-bottom: 8px;\n        }\n        \n        .print-header p {\n          font-size: 12px;\n          color: #666;\n          margin: 4px 0;\n        }\n        \n        .print-table {\n          width: 100%;\n          border-collapse: collapse;\n          margin-bottom: 20px;\n          font-size: 11px;\n        }\n        \n        .print-table thead {\n          background-color: #f5f5f5;\n          border-bottom: 2px solid #1976d2;\n        }\n        \n        .print-table th {\n          padding: 10px;\n          text-align: left;\n          font-weight: 600;\n          color: #1976d2;\n          border: 1px solid #ddd;\n        }\n        \n        .print-table td {\n          padding: 10px;\n          border: 1px solid #ddd;\n          word-wrap: break-word;\n          overflow-wrap: break-word;\n        }\n        \n        .print-table tbody tr:nth-child(even) {\n          background-color: #f9f9f9;\n        }\n        \n        .print-table tbody tr:hover {\n          background-color: #f0f0f0;\n        }\n        \n        .text-center {\n          text-align: center;\n        }\n        \n        .content-cell {\n          max-width: 120px;\n          white-space: pre-wrap;\n          line-height: 1.5;\n        }\n        \n        .content-cell a {\n          color: #1976d2;\n          text-decoration: underline;\n        }\n        \n        .content-cell p {\n          margin: 4px 0;\n        }\n        \n        .content-cell ul,\n        .content-cell ol {\n          margin: 4px 0;\n          padding-left: 20px;\n        }\n        \n        .content-cell li {\n          margin: 2px 0;\n        }\n        \n        .content-cell strong {\n          font-weight: 600;\n        }\n        \n        .content-cell em {\n          font-style: italic;\n        }\n        \n        \n        .print-footer {\n          margin-top: 20px;\n          border-top: 1px solid #ddd;\n          padding-top: 10px;\n          text-align: right;\n          font-size: 10px;\n          color: #999;\n        }\n        \n        @media print {\n          body {\n            background-color: white;\n          }\n          \n          .print-table {\n            page-break-inside: avoid;\n          }\n          \n          .print-table tbody tr {\n            page-break-inside: avoid;\n          }\n        }\n      </style>\n    </head>\n    <body>\n      ${e.innerHTML}\n    </body>\n    </html>\n  `),l.document.close(),l.onload=()=>{setTimeout(()=>{l.print(),l.close()},250)}},bl=()=>{Fe.value&&(Fe.value.openMobilePrint(),setTimeout(()=>{Fe.value.downloadPDF()},100))};return h(()=>Ue.value,()=>{dl()}),h(()=>We.value,()=>{dl()}),g(()=>{const e=new Date,l=new Date(e.getFullYear(),0,1),a=Math.ceil(((e.getTime()-l.getTime())/864e5+l.getDay()+1)/7);Ne.value=Math.min(a,18),Ue.value=Ne.value,dl()}),(e,l)=>{const b=f("Head");return x(),k(C,null,[P(b,{title:"My Weekly Plans"}),_("div",A,[P(N),_("div",O,[_("div",B,[_("h4",G,[P(a,{name:"edit_note",class:"q-mr-sm",color:"primary"}),q(" "+Q(T(ze)("weeklyPlans.teacher.myWeeklyPlans")),1)]),_("p",J,Q(T(ze)("weeklyPlans.teacher.fillInContent")),1)])]),P(o,{flat:"",bordered:"",class:"q-pa-md q-mb-lg"},{default:D(()=>{var e;return[_("div",R,[_("div",K,[P(F,{modelValue:Ue.value,"onUpdate:modelValue":l[0]||(l[0]=e=>Ue.value=e),"max-weeks":$e.value,"current-week":Ne.value},null,8,["modelValue","max-weeks","current-week"])]),_("div",Y,[P(i,{modelValue:We.value,"onUpdate:modelValue":l[1]||(l[1]=e=>We.value=e),options:ll.value,label:T(ze)("weeklyPlans.semester"),outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","label"])]),_("div",Z,[P(u,{value:rl.value/100,size:"25px",color:il.value,"track-color":"grey-3",rounded:"",style:{width:"150px"}},{default:D(()=>[_("div",X,[_("span",ee,Q(rl.value)+"%",1)])]),_:1},8,["value","color"])])]),_("div",le,[_("div",ae,[P(i,{modelValue:Ie.value,"onUpdate:modelValue":l[2]||(l[2]=e=>Ie.value=e),options:tl.value,label:T(ze)("weeklyPlans.teacher.selectToView"),outlined:"",dense:"",multiple:"","use-chips":"",clearable:""},null,8,["modelValue","options","label"])]),_("div",ne,[P(i,{modelValue:Ae.value,"onUpdate:modelValue":l[3]||(l[3]=e=>Ae.value=e),options:al.value,label:T(ze)("weeklyPlans.filterByDay"),outlined:"",dense:"",multiple:"","use-chips":"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options","label"])]),_("div",te,[P(n,{modelValue:Ze.value,"onUpdate:modelValue":l[4]||(l[4]=e=>Ze.value=e),label:T(ze)("weeklyPlans.teacher.inlineEditMode"),color:"primary",icon:"edit"},null,8,["modelValue","label"])]),(null==(e=Ie.value)?void 0:e.length)>0?(x(),k("div",oe,[P(t,{color:"primary",label:T(ze)("weeklyPlans.teacher.previewAndPrint"),icon:"print",onClick:l[5]||(l[5]=e=>Ke.value=!0),outline:""},null,8,["label"]),P(t,{color:"secondary",label:T(ze)("weeklyPlans.teacher.mobilePrint"),icon:"phone_iphone",onClick:l[6]||(l[6]=e=>{var l;return null==(l=Fe.value)?void 0:l.openMobilePrint()}),outline:""},null,8,["label"]),P(t,{color:"red-7",label:T(ze)("weeklyPlans.teacher.downloadPdf"),icon:"picture_as_pdf",onClick:bl,outline:""},null,8,["label"])])):M("",!0)])]}),_:1}),el.value?(x(),k("div",se,[P(c,{size:"50px",color:"primary"})])):He.value.length?(x(),j(o,{key:2,flat:"",bordered:"",class:"q-mb-lg"},{default:D(()=>[P(m,{modelValue:Ye.value,"onUpdate:modelValue":l[7]||(l[7]=e=>Ye.value=e),dense:"",class:"text-grey-7","active-color":"primary","indicator-color":"primary",align:"left"},{default:D(()=>[P(d,{name:"by-classroom",label:T(ze)("weeklyPlans.teacher.byClassroom"),icon:"meeting_room",disable:!Ie.value||0===Ie.value.length},null,8,["label","disable"]),P(d,{name:"by-day",label:T(ze)("weeklyPlans.teacher.byDay"),icon:"calendar_today"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1})):(x(),j(o,{key:1,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:D(()=>[P(a,{name:"event_note",size:"64px",color:"grey-5"}),_("p",re,Q(T(ze)("weeklyPlans.teacher.noPlans")),1),_("p",ie,Q(T(ze)("weeklyPlans.teacher.waitAdminGen")),1)]),_:1})),V(_("div",ue,[(x(!0),k(C,null,S(sl.value,e=>(x(),k("div",{key:e.dayNumber,class:"day-column"},[_("div",ce,Q(e.dayName),1),(x(!0),k(C,null,S(e.plans,e=>{var n,o,s,i,u;return x(),k("div",{key:e.id,class:L(["plan-card",{"is-completed":"completed"===e.status,"is-partial":"partial"===e.status}]),onClick:l=>ml(e)},[_("div",{class:"plan-header",style:H(cl(e))},[_("span",me,"P"+Q(null==(n=e.schedule)?void 0:n.period_number),1),_("span",pe,Q(null==(s=null==(o=e.schedule)?void 0:o.cst)?void 0:s.subject_name),1),P(p),_("div",ve,[Be.value===e.id?(x(),j(t,{key:0,icon:"close",size:"xs",flat:"",round:"",color:"white",onClick:l[8]||(l[8]=e=>(e.stopPropagation(),Oe.value=null,void(Be.value=null)))},{default:D(()=>[P(r,null,{default:D(()=>[q(Q(T(ze)("weeklyPlans.teacher.cancelCopy")),1)]),_:1})]),_:1})):Oe.value?M("",!0):(x(),j(t,{key:1,icon:"content_copy",size:"xs",flat:"",round:"",color:"white",onClick:l=>((e,l)=>{l.stopPropagation(),Oe.value={cw:e.cw,hw:e.hw,notes:e.notes},Be.value=e.id,Le.notify({message:ze("weeklyPlans.teacher.copy"),color:"info",icon:"content_copy",timeout:2e3})})(e,l)},{default:D(()=>[P(r,null,{default:D(()=>[q(Q(T(ze)("weeklyPlans.teacher.copy")),1)]),_:1})]),_:2},1032,["onClick"])),Oe.value&&Be.value!==e.id?(x(),j(t,{key:2,icon:"content_paste",size:"xs",flat:"",round:"",color:"white",onClick:l=>(async(e,l)=>{if(l.stopPropagation(),Oe.value)try{await z.put(`/weekly-system/api/weekly-plans/${e.id}`,{...Oe.value}),e.cw=Oe.value.cw,e.hw=Oe.value.hw,e.notes=Oe.value.notes,e.status=ul(e),Le.notify({type:"positive",message:ze("weeklyPlans.teacher.paste")})}catch(a){console.error("Error pasting plan:",a),Le.notify({type:"negative",message:"Failed to paste data"})}})(e,l)},{default:D(()=>[P(r,null,{default:D(()=>[q(Q(T(ze)("weeklyPlans.teacher.paste")),1)]),_:1})]),_:2},1032,["onClick"])):M("",!0)])],4),_("div",ye,[P(a,{name:"meeting_room",size:"xs"}),q(" "+Q(null==(u=null==(i=e.schedule)?void 0:i.cst)?void 0:u.classroom_name),1)]),_("div",be,[P($,{status:e.status},null,8,["status"])]),e.cw||e.hw?(x(),k("div",we,[e.cw?(x(),k("div",he,[P(a,{name:"school",size:"xs",color:"blue"}),q(" "+Q(T(ze)("weeklyPlans.teacher.cwFilled")),1)])):M("",!0),e.hw?(x(),k("div",ge,[P(a,{name:"home_work",size:"xs",color:"orange"}),q(" "+Q(T(ze)("weeklyPlans.teacher.hwFilled")),1)])):M("",!0)])):M("",!0)],10,de)}),128))]))),128))],512),[[E,"by-day"===Ye.value]]),V(_("div",null,[P(W,{ref_key:"classroomListRef",ref:Fe,plans:ol.value,days:nl.value,"inline-edit-mode":Ze.value,"copied-data":Oe.value,"week-number":Ue.value,"semester-number":We.value,onEdit:ml,onSave:vl},null,8,["plans","days","inline-edit-mode","copied-data","week-number","semester-number"])],512),[[E,"by-classroom"===Ye.value]]),P(U,{modelValue:Ge.value,"onUpdate:modelValue":l[9]||(l[9]=e=>Ge.value=e),plan:Je.value,saving:Re.value,onSubmit:pl},null,8,["modelValue","plan","saving"]),P(s,{modelValue:Ke.value,"onUpdate:modelValue":l[11]||(l[11]=e=>Ke.value=e),maximized:""},{default:D(()=>[P(o,{class:"full-height print-preview-card"},{default:D(()=>[P(v,{class:"bg-primary text-white"},{default:D(()=>[P(y,null,{default:D(()=>[q(Q(T(ze)("weeklyPlans.teacher.previewAndPrint")),1)]),_:1}),P(p),P(t,{icon:"print",label:T(ze)("weeklyPlans.print"),color:"white",flat:"",onClick:yl},null,8,["label"]),P(t,{icon:"close",flat:"",round:"",dense:"",onClick:l[10]||(l[10]=e=>Ke.value=!1)})]),_:1}),_("div",fe,[_("div",ke,[_("div",xe,[_("h2",Pe,Q(T(ze)("weeklyPlans.teacher.myWeeklyPlans")),1),_("p",_e,Q(T(ze)("weeklyPlans.week"))+" "+Q(Ue.value)+" - "+Q(T(ze)("weeklyPlans.semester"))+" "+Q(We.value),1),_("p",je,Q(T(ze)("weeklyPlans.classroom"))+": "+Q(Ie.value.join(", ")),1),_("p",Ve,Q((new Date).toLocaleDateString(T(Ee),{year:"numeric",month:"long",day:"numeric"})),1)]),_("table",qe,[_("thead",null,[_("tr",null,[_("th",null,Q(T(ze)("weeklyPlans.day")),1),_("th",null,Q(T(ze)("weeklyPlans.period")),1),_("th",null,Q(T(ze)("weeklyPlans.subject")),1),_("th",null,Q(T(ze)("weeklyPlans.classroom")),1),_("th",null,Q(T(ze)("weeklyPlans.classwork")),1),_("th",null,Q(T(ze)("weeklyPlans.homework")),1),_("th",null,Q(T(ze)("weeklyPlans.notes")),1)])]),_("tbody",null,[(x(!0),k(C,null,S(ol.value,e=>{var l,a,n,t,o,s;return x(),k("tr",{key:e.id},[_("td",null,Q(nl.value[null==(l=e.schedule)?void 0:l.day]||"N/A"),1),_("td",Qe,"P"+Q(null==(a=e.schedule)?void 0:a.period_number),1),_("td",null,Q(null==(t=null==(n=e.schedule)?void 0:n.cst)?void 0:t.subject_name),1),_("td",null,Q(null==(s=null==(o=e.schedule)?void 0:o.cst)?void 0:s.classroom_name),1),_("td",{class:"content-cell",innerHTML:e.cw||"-"},null,8,Te),_("td",{class:"content-cell",innerHTML:e.hw||"-"},null,8,De),_("td",{class:"content-cell",innerHTML:e.notes||"-"},null,8,Me)])}),128))])]),_("div",Ce,[_("p",Se,Q(T(ze)("weeklyPlans.teacher.generated"))+" "+Q((new Date).toLocaleString()),1)])])])]),_:1})]),_:1},8,["modelValue"])])],64)}}},[["__scopeId","data-v-795e0751"]]);export{ze as default};
