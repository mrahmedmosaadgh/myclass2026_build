import{r as e,u as a,b as l,f as i,H as t,t as o,G as u,d as s,o as n,e as d,h as r,m as c,c as m}from"./app-Dtv5Fi9L.js";import{Q as v}from"./QTd-DkPAnXdW.js";import{Q as p}from"./QTable-DjEJtvgI.js";import{Q as g}from"./QSelect-BslHFD89.js";import{Q as f}from"./QSpace-D-IrDQfo.js";import b from"./CurriculumLessonsManager-CFdXFwUa.js";import{E as _}from"./ExcelManager-DUoVM-wb.js";import{f as y,r as h,a as j,o as w,N as V,J as C,R as k,b as x,K as U,W as S,V as Q,I as $,O as q,_ as A}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./QMarkupTable-BGpv7gz2.js";import"./QLinearProgress-D6iXPeG1.js";import"./use-fullscreen-GpMU35jG.js";import"./rtl-Cr6c3OOr.js";import"./vuedraggable.umd-DshT_Vng.js";import"./index-SlSKjXnq.js";import"./QTab-C3dKeHww.js";import"./QTabs-Djj_zpNj.js";import"./QTabPanel-DJnQc_xc.js";import"./use-panel-CKffL4LQ.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-DIsvTADE.js";import"./QFile-BHtDPtDY.js";import"./use-file-ByEwQH_I.js";import"./QTr-Mh4SFFWh.js";import"./xlsx-BHXqx-YI.js";const N={class:"q-pa-md"},P={class:"row items-center q-mb-lg"},F={class:"col-auto q-gutter-sm"},T={class:"q-gutter-md"},E={class:"text-h6"},I={class:"q-gutter-md"},D=e({__name:"CurriculumManagement",setup(e){const D=a(),G=y([]),M=y([]),z=y([]),L=y([]),B=y([]),R=y([]),J=y(!1),O=y(!1),H=y(!1),K=y(!1),W=y(!1),X=y(!1),Y=y(!1),Z=y(!1),ee=y(!1),ae=y(!1),le=y(!1),ie=y(null),te=y(null),oe=h({school_id:null,subject_id:null,grade_id:null,active:null}),ue=h({school_id:null,subject_id:null,grade_id:null,name:"",description:"",active:!1}),se=[{name:"name",required:!0,label:"Curriculum Name",align:"left",field:"name",sortable:!0},{name:"school",label:"School",align:"left",field:e=>{var a;return(null==(a=e.school)?void 0:a.name)||"N/A"},sortable:!1},{name:"subject",label:"Subject",align:"left",field:e=>{var a;return(null==(a=e.subject)?void 0:a.name)||"N/A"},sortable:!1},{name:"grade",label:"Grade",align:"left",field:e=>{var a;return(null==(a=e.grade)?void 0:a.name)||"N/A"},sortable:!1},{name:"active",label:"Status",align:"center",field:"active",sortable:!0},{name:"created_at",label:"Created",align:"left",field:"created_at",format:e=>new Date(e).toLocaleDateString(),sortable:!0},{name:"actions",label:"Actions",align:"center",field:"actions",sortable:!1}],ne=y({sortBy:"created_at",descending:!0,page:1,rowsPerPage:15,rowsNumber:0}),de=[{label:"Active",value:1},{label:"Inactive",value:0}],re=j(()=>G.value.map(e=>{var a,l,i;return{name:e.name,school:(null==(a=e.school)?void 0:a.name)||"",subject:(null==(l=e.subject)?void 0:l.name)||"",grade:(null==(i=e.grade)?void 0:i.name)||"",description:e.description||"",active:1===e.active?"Yes":"No"}})),ce=async e=>{if(e){K.value=!0;try{const a=await A.get(`/api/curriculum/school/${e}/subjects`);B.value=a.data}catch(a){D.notify({type:"negative",message:"Failed to load subjects"})}finally{K.value=!1}}else B.value=[]},me=async e=>{if(e){W.value=!0;try{const a=await A.get(`/api/curriculum/school/${e}/grades`);R.value=a.data}catch(a){D.notify({type:"negative",message:"Failed to load grades"})}finally{W.value=!1}}else R.value=[]},ve=async()=>{var e,a,l;X.value=!0;try{const i=new URLSearchParams,t=(null==(e=oe.school_id)?void 0:e.id)||oe.school_id,o=(null==(a=oe.subject_id)?void 0:a.id)||oe.subject_id,u=(null==(l=oe.grade_id)?void 0:l.id)||oe.grade_id;t&&i.append("school_id",t),o&&i.append("subject_id",o),u&&i.append("grade_id",u),null!==oe.active&&i.append("active",oe.active);const s=await A.get(`/api/curriculum/curricula?${i}`);G.value=s.data.data,ne.value.rowsNumber=s.data.total}catch(i){D.notify({type:"negative",message:"Failed to load curricula"})}finally{X.value=!1}},pe=e=>{const a=(null==e?void 0:e.id)||e;oe.school_id=a,oe.subject_id=null,oe.grade_id=null,a?((async e=>{if(e){O.value=!0;try{const a=await A.get(`/api/curriculum/school/${e}/subjects`);z.value=a.data}catch(a){D.notify({type:"negative",message:"Failed to load subjects"})}finally{O.value=!1}}else z.value=[]})(a),(async e=>{if(e){H.value=!0;try{const a=await A.get(`/api/curriculum/school/${e}/grades`);L.value=a.data}catch(a){D.notify({type:"negative",message:"Failed to load grades"})}finally{H.value=!1}}else L.value=[]})(a)):(z.value=[],L.value=[])},ge=e=>{const a=(null==e?void 0:e.id)||e;ue.school_id=a,ue.subject_id=null,ue.grade_id=null,a?(ce(a),me(a)):(B.value=[],R.value=[])},fe=e=>{const{page:a,rowsPerPage:l,sortBy:i,descending:t}=e.pagination;ne.value.page=a,ne.value.rowsPerPage=l,ne.value.sortBy=i,ne.value.descending=t,ve()},be=()=>{ee.value=!1,ve()},_e=()=>{oe.school_id=null,oe.subject_id=null,oe.grade_id=null,oe.active=null,z.value=[],L.value=[]},ye=async e=>{var a,l;try{const a=e.filter(e=>e.name&&e.school&&e.subject&&e.grade);if(0===a.length)return void D.notify({type:"negative",message:"No valid curricula found in imported data"});const l=await A.post("/api/curriculum/bulk-import",{curricula:a});D.notify({type:"positive",message:`Successfully imported ${l.data.imported} curricula`}),le.value=!1,ve()}catch(i){D.notify({type:"negative",message:(null==(l=null==(a=i.response)?void 0:a.data)?void 0:l.message)||"Failed to import curricula"})}},he=e=>{D.notify({type:"positive",message:`Exported ${e.recordCount} curricula to ${e.fileName}`})},je=()=>{we(),Z.value=!0},we=()=>{ue.school_id=null,ue.subject_id=null,ue.grade_id=null,ue.name="",ue.description="",ue.active=!1,B.value=[],R.value=[],ie.value=null},Ve=()=>{Z.value=!1,we()},Ce=async()=>{var e,a,l,i,t;if(ue.school_id)if(ue.subject_id)if(ue.grade_id)if(ue.name&&""!==ue.name.trim()){Y.value=!0;try{const i={name:ue.name.trim(),description:ue.description.trim(),school_id:(null==(e=ue.school_id)?void 0:e.id)||ue.school_id,subject_id:(null==(a=ue.subject_id)?void 0:a.id)||ue.subject_id,grade_id:(null==(l=ue.grade_id)?void 0:l.id)||ue.grade_id,active:ue.active?1:0};ie.value?(await A.put(`/api/curriculum/curricula/${ie.value.id}`,i),D.notify({type:"positive",message:"Curriculum updated successfully"})):(await A.post("/api/curriculum/curricula",i),D.notify({type:"positive",message:"Curriculum created successfully"})),Ve(),ve()}catch(o){D.notify({type:"negative",message:(null==(t=null==(i=o.response)?void 0:i.data)?void 0:t.message)||"Failed to save curriculum"})}finally{Y.value=!1}}else D.notify({type:"negative",message:"Please enter a curriculum name"});else D.notify({type:"negative",message:"Please select a grade"});else D.notify({type:"negative",message:"Please select a subject"});else D.notify({type:"negative",message:"Please select a school"})};return w(()=>{(async()=>{J.value=!0;try{const e=await A.get("/api/curriculum/user-schools");M.value=e.data}catch(e){D.notify({type:"negative",message:"Failed to load schools"})}finally{J.value=!1}})(),ve()}),(e,a)=>(C(),V("div",N,[k("div",P,[a[19]||(a[19]=k("div",{class:"col"},[k("h4",{class:"text-h4 q-my-none"},"Curriculum Management"),k("p",{class:"text-grey-6 q-mb-none"},"Manage curricula for your schools and subjects")],-1)),k("div",F,[x(l,{color:"primary",icon:"add",label:"Add Curriculum",onClick:je,unelevated:""}),x(l,{color:"primary",icon:"filter_list",label:"Filter",onClick:a[0]||(a[0]=e=>ee.value=!0),unelevated:""}),x(l,{color:"primary",icon:"import_export",label:"Import/Export",onClick:a[1]||(a[1]=e=>le.value=!0),unelevated:""})])]),x(s,null,{default:U(()=>[x(i,null,{default:U(()=>[x(p,{rows:G.value,columns:se,"row-key":"id",loading:X.value,pagination:ne.value,onRequest:fe,"binary-state-sort":""},{"body-cell-active":U(e=>[x(v,{props:e},{default:U(()=>[x(u,{color:1===e.value?"green":"grey","text-color":1===e.value?"white":"black",size:"sm"},{default:U(()=>[S(Q(1===e.value?"Active":"Inactive"),1)]),_:2},1032,["color","text-color"])]),_:2},1032,["props"])]),"body-cell-actions":U(e=>[x(v,{props:e},{default:U(()=>[x(t,{flat:""},{default:U(()=>[x(l,{flat:"",dense:"",color:"info",icon:"visibility",onClick:a=>{return l=e.row,te.value=l,void(ae.value=!0);var l},size:"sm"},{default:U(()=>[x(o,null,{default:U(()=>a[20]||(a[20]=[S("View Lessons")])),_:1})]),_:2},1032,["onClick"]),x(l,{flat:"",dense:"",color:"primary",icon:"edit",onClick:a=>{return l=e.row,ie.value=l,ue.school_id=l.school||{id:l.school_id,name:"Unknown"},ue.subject_id=l.subject||{id:l.subject_id,name:"Unknown"},ue.grade_id=l.grade||{id:l.grade_id,name:"Unknown"},ue.name=l.name,ue.description=l.description||"",ue.active=1===l.active,B.value=[l.subject||{id:l.subject_id,name:"Unknown"}],R.value=[l.grade||{id:l.grade_id,name:"Unknown"}],ce(l.school_id),me(l.school_id),void(Z.value=!0);var l},size:"sm"},{default:U(()=>[x(o,null,{default:U(()=>a[21]||(a[21]=[S("Edit")])),_:1})]),_:2},1032,["onClick"]),x(l,{flat:"",dense:"",color:1===e.row.active?"orange":"green",icon:1===e.row.active?"pause":"play_arrow",onClick:a=>(async e=>{const a=1===e.active?"deactivate":"activate",l=1===e.active?"deactivate":"activate";D.dialog({title:"Confirm Action",message:`Are you sure you want to ${l} this curriculum?${"activate"===a?" This will deactivate other curricula for the same subject and grade.":""}`,cancel:!0,persistent:!0}).onOk(async()=>{var i,t;try{await A.post(`/api/curriculum/curricula/${e.id}/${a}`),D.notify({type:"positive",message:`Curriculum ${l}d successfully`}),ve()}catch(o){D.notify({type:"negative",message:(null==(t=null==(i=o.response)?void 0:i.data)?void 0:t.message)||`Failed to ${l} curriculum`})}})})(e.row),size:"sm"},{default:U(()=>[x(o,null,{default:U(()=>[S(Q(1===e.row.active?"Deactivate":"Activate"),1)]),_:2},1024)]),_:2},1032,["color","icon","onClick"]),x(l,{flat:"",dense:"",color:"negative",icon:"delete",onClick:a=>(async e=>{D.dialog({title:"Confirm Deletion",message:`Are you sure you want to delete "${e.name}"? This action cannot be undone.`,cancel:!0,persistent:!0,color:"negative"}).onOk(async()=>{var a,l;try{await A.delete(`/api/curriculum/curricula/${e.id}`),D.notify({type:"positive",message:"Curriculum deleted successfully"}),ve()}catch(i){D.notify({type:"negative",message:(null==(l=null==(a=i.response)?void 0:a.data)?void 0:l.message)||"Failed to delete curriculum"})}})})(e.row),size:"sm"},{default:U(()=>[x(o,null,{default:U(()=>a[22]||(a[22]=[S("Delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])]),_:1})]),_:1}),x(d,{modelValue:ee.value,"onUpdate:modelValue":a[7]||(a[7]=e=>ee.value=e)},{default:U(()=>[x(s,{style:{"min-width":"500px"}},{default:U(()=>[x(i,null,{default:U(()=>a[23]||(a[23]=[k("div",{class:"text-h6"},"Filter Curricula",-1)])),_:1}),x(i,{class:"q-pt-none"},{default:U(()=>[k("div",T,[x(g,{modelValue:oe.school_id,"onUpdate:modelValue":[a[2]||(a[2]=e=>oe.school_id=e),pe],options:M.value,"option-value":"id","option-label":"name",label:"Select School",outlined:"",clearable:"",loading:J.value},null,8,["modelValue","options","loading"]),x(g,{modelValue:oe.subject_id,"onUpdate:modelValue":a[3]||(a[3]=e=>oe.subject_id=e),options:z.value,"option-value":"id","option-label":"name",label:"Select Subject",outlined:"",clearable:"",disable:!oe.school_id,loading:O.value},null,8,["modelValue","options","disable","loading"]),x(g,{modelValue:oe.grade_id,"onUpdate:modelValue":a[4]||(a[4]=e=>oe.grade_id=e),options:L.value,"option-value":"id","option-label":"name",label:"Select Grade",outlined:"",clearable:"",disable:!oe.school_id,loading:H.value},null,8,["modelValue","options","disable","loading"]),x(g,{modelValue:oe.active,"onUpdate:modelValue":a[5]||(a[5]=e=>oe.active=e),options:de,label:"Status",outlined:"",clearable:""},null,8,["modelValue"])])]),_:1}),x(n,{align:"right"},{default:U(()=>[x(l,{flat:"",label:"Clear",onClick:_e}),x(l,{flat:"",label:"Cancel",onClick:a[6]||(a[6]=e=>ee.value=!1)}),x(l,{color:"primary",label:"Apply",onClick:be,loading:X.value,unelevated:""},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),x(d,{modelValue:Z.value,"onUpdate:modelValue":a[14]||(a[14]=e=>Z.value=e),persistent:""},{default:U(()=>[x(s,{style:{"min-width":"500px"}},{default:U(()=>[x(i,null,{default:U(()=>[k("div",E,Q(ie.value?"Edit Curriculum":"Add New Curriculum"),1)]),_:1}),x(i,{class:"q-pt-none"},{default:U(()=>[k("div",I,[x(g,{modelValue:ue.school_id,"onUpdate:modelValue":[a[8]||(a[8]=e=>ue.school_id=e),ge],options:M.value,"option-value":"id","option-label":"name",label:"School *",outlined:"",rules:[e=>!!e||"School is required"],loading:J.value,disable:ie.value},null,8,["modelValue","options","rules","loading","disable"]),x(g,{modelValue:ue.subject_id,"onUpdate:modelValue":a[9]||(a[9]=e=>ue.subject_id=e),options:B.value,"option-value":"id","option-label":"name",label:"Subject *",outlined:"",rules:[e=>!!e||"Subject is required"],disable:!ue.school_id||ie.value,loading:K.value},null,8,["modelValue","options","rules","disable","loading"]),x(g,{modelValue:ue.grade_id,"onUpdate:modelValue":a[10]||(a[10]=e=>ue.grade_id=e),options:R.value,"option-value":"id","option-label":"name",label:"Grade *",outlined:"",rules:[e=>!!e||"Grade is required"],disable:!ue.school_id||ie.value,loading:W.value},null,8,["modelValue","options","rules","disable","loading"]),x(r,{modelValue:ue.name,"onUpdate:modelValue":a[11]||(a[11]=e=>ue.name=e),label:"Curriculum Name *",outlined:"",rules:[e=>!!e||"Name is required"]},null,8,["modelValue","rules"]),x(r,{modelValue:ue.description,"onUpdate:modelValue":a[12]||(a[12]=e=>ue.description=e),label:"Description",type:"textarea",rows:"3",outlined:""},null,8,["modelValue"]),x(c,{modelValue:ue.active,"onUpdate:modelValue":a[13]||(a[13]=e=>ue.active=e),label:"Set as Active (will deactivate other curricula for this subject and grade)",color:"primary"},null,8,["modelValue"])])]),_:1}),x(n,{align:"right"},{default:U(()=>[x(l,{flat:"",label:"Cancel",onClick:Ve}),x(l,{color:"primary",label:"Save",onClick:Ce,loading:Y.value,unelevated:""},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),x(d,{modelValue:ae.value,"onUpdate:modelValue":a[16]||(a[16]=e=>ae.value=e),"full-width":"","full-height":""},{default:U(()=>[te.value?(C(),$(b,{key:0,curriculum:te.value,onClose:a[15]||(a[15]=e=>ae.value=!1),onUpdated:ve},null,8,["curriculum"])):q("",!0)]),_:1},8,["modelValue"]),x(d,{modelValue:le.value,"onUpdate:modelValue":a[18]||(a[18]=e=>le.value=e),"full-width":""},{default:U(()=>[x(s,null,{default:U(()=>[x(i,{class:"row items-center q-pb-none"},{default:U(()=>[a[24]||(a[24]=k("div",{class:"text-h6"},"Import/Export Curricula",-1)),x(f),x(l,{icon:"close",flat:"",round:"",dense:"",onClick:a[17]||(a[17]=e=>le.value=!1)})]),_:1}),x(m),x(i,null,{default:U(()=>[x(_,{"export-data":re.value,"export-file-name":"curricula_template.xlsx",onImportedJson:ye,onExported:he},null,8,["export-data"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-6c71d093"]]);export{D as default};
