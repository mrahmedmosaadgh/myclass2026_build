import{Q as e}from"./QSelect-DOo83gJW.js";import{o as a,u as l,h as t,i as s,j as o,m as n,d,C as i,Q as r,p as c}from"./app-ggGwxJON.js";import{Q as u}from"./QSpinnerDots-xIVaxwwk.js";import{Q as p}from"./QSpace-DKhB4IlP.js";import{Q as m}from"./QBadge-DVUbh_5M.js";import{Q as v}from"./QTd-D6gdMIVj.js";import{Q as h}from"./QTable-D7jFdT1k.js";import{f as b,a as g,k as f,o as y,N as w,J as x,b as _,I as k,K as j,O as $,W as S,V as D,z as P,F as V,R as W,_ as C,a0 as N,S as z}from"./vendor-nQjeLEvd.js";import Q from"./WeekSelector-BDOvUr-G.js";import"./rtl-Cr6c3OOr.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";import"./QMarkupTable-BbwJTHXP.js";import"./QLinearProgress-DJHuJoTJ.js";import"./use-fullscreen-DuZ9ifcT.js";const q={class:"q-pa-md"},E={class:"row q-gutter-md items-end"},T={class:"col-12 col-sm-4"},U={class:"col-12 col-sm-3"},F={class:"col-12 col-sm-2"},A={class:"col-12 col-sm-6"},I={class:"col-12 col-sm-4"},H={key:0,class:"row justify-center q-pa-xl"},O={key:2,class:"classrooms-grid"},M={class:"classroom-header bg-primary text-white q-pa-md"},G={class:"q-ma-none flex items-center q-gutter-sm"},L={class:"plans-by-day"},Y={class:"day-header-row"},B={class:"day-info"},J={class:"day-name"},K={class:"day-meta"},R={class:"subject-teacher"},Z={class:"teacher-name"},X={key:0,class:"text-info"},ee={class:"q-ml-xs"},ae={key:1,class:"text-grey-5"},le={key:0,class:"text-warning"},te={class:"q-ml-xs"},se={key:1,class:"text-grey-5"},oe={key:0,class:"text-info"},ne={key:1,class:"text-grey-5"},de=a({__name:"WeeklyPlanClassroomView2",props:{initialWeek:Number,initialCopyId:[Number,String]},setup(a){const de=a,ie=l(),re=b([]),ce=b([]),ue=b([]),pe=b([]),me=b(de.initialCopyId),ve=b(de.initialWeek||1),he=b(1),be=b(18),ge=b(1),fe=b([]),ye=b(!1),we=b(!1),xe=b(!1),_e=b({rowsPerPage:0}),ke={1:"Sunday",2:"Monday",3:"Tuesday",4:"Wednesday",5:"Thursday"},je=Object.entries(ke).map(([e,a])=>({label:a,value:parseInt(e)})),$e=[{name:"period",label:"Period",field:"schedule.period_number",align:"center"},{name:"subject",label:"Subject",field:"schedule.cst.subject_name",align:"left"},{name:"cw",label:"Classwork (CW)",field:"cw",align:"left"},{name:"hw",label:"Homework (HW)",field:"hw",align:"left"},{name:"notes",label:"Notes",field:"notes",align:"left"}],Se=g(()=>ce.value.length>0&&ue.value.length===ce.value.length),De=g(()=>{var e;let a=fe.value;return(null==(e=pe.value)?void 0:e.length)&&(a=a.filter(e=>{var a;return pe.value.includes(null==(a=e.schedule)?void 0:a.day)})),a}),Pe=g(()=>{const e={};return De.value.forEach(a=>{const l=a.classroom_id;if(!e[l]){const a=ce.value.find(e=>e.id===l);e[l]={id:l,name:(null==a?void 0:a.name)||"Unknown",plans:[]}}e[l].plans.push(a)}),Object.values(e).forEach(e=>{e.plans.sort((e,a)=>{var l,t,s,o;const n=((null==(l=e.schedule)?void 0:l.day)||0)-((null==(t=a.schedule)?void 0:t.day)||0);return 0!==n?n:((null==(s=e.schedule)?void 0:s.period_number)||0)-((null==(o=a.schedule)?void 0:o.period_number)||0)})}),Object.values(e).sort((e,a)=>e.name.localeCompare(a.name))}),Ve=()=>{Se.value?ue.value=[]:ue.value=ce.value.map(e=>e.id)},We=(e,a)=>e?e.length>a?e.substring(0,a)+"...":e:"",Ce=e=>{const a=(new Date).getFullYear();(new Date).getMonth();let l=new Date(a,0,1),t=0===l.getDay()?0:7-l.getDay(),s=new Date(a,0,1+t);const o=new Date(s);o.setDate(s.getDate()+7*(ve.value-1));const n=new Date(o);return n.setDate(o.getDate()+(e-1)),n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},Ne=e=>{const a={};return e.forEach(e=>{var l;const t=null==(l=e.schedule)?void 0:l.day;a[t]||(a[t]={dayNumber:t,dayName:ke[t]||`Day ${t}`,plans:[]}),a[t].plans.push(e)}),Object.values(a).forEach(e=>{e.plans.sort((e,a)=>{var l,t;return(null==(l=e.schedule)?void 0:l.period_number)-(null==(t=a.schedule)?void 0:t.period_number)})}),Object.values(a).sort((e,a)=>e.dayNumber-a.dayNumber)};return f(me,()=>{(async()=>{if(!me.value)return;const e=re.value.find(e=>e.id===me.value);if(e){xe.value=!0;try{const a=await C.get(`/api/classrooms?school_id=${e.school_id}`);ce.value=a.data.data||a.data||[]}catch(a){console.error("Error fetching classrooms:",a)}finally{xe.value=!1}}})(),ue.value=[]}),f([ue,ve,he],()=>{(async()=>{if(ue.value.length){ye.value=!0;try{const e=re.value.find(e=>e.id===me.value);if(!e)return;const a=ue.value.map(a=>C.get("/weekly-system/api/weekly-plans",{params:{classroom_id:a,week_number:ve.value,semester_number:he.value,academic_year_id:e.academic_year_id}}).then(e=>({classroom_id:a,plans:e.data.data||e.data||[]}))),l=await Promise.all(a);fe.value=l.flatMap(e=>e.plans.map(a=>({...a,classroom_id:e.classroom_id})))}catch(e){console.error("Error fetching plans:",e),ie.notify({type:"negative",message:"Failed to load weekly plans"})}finally{ye.value=!1}}else fe.value=[]})()}),y(async()=>{const e=new Date,a=new Date(e.getFullYear(),0,1),l=Math.ceil(((e-a)/864e5+a.getDay()+1)/7);ge.value=l>be.value?1:l,ve.value=de.initialWeek||ge.value,await(async()=>{we.value=!0;try{const e=await C.get("/admin/schedule-copies",{params:{status:"active"}});re.value=(e.data.data||e.data||[]).filter(e=>"active"===e.status),re.value.length&&!me.value&&(me.value=re.value[0].id)}catch(e){console.error("Error fetching copies:",e)}finally{we.value=!1}})()}),(a,l)=>(x(),w("div",q,[_(n,{flat:"",bordered:"",class:"q-pa-md q-mb-lg"},{default:j(()=>[$("div",E,[$("div",T,[_(e,{modelValue:me.value,"onUpdate:modelValue":l[0]||(l[0]=e=>me.value=e),options:re.value,"option-value":"id","option-label":"name",label:"Active Schedule",outlined:"",dense:"","emit-value":"","map-options":"",loading:we.value},null,8,["modelValue","options","loading"])]),$("div",U,[_(Q,{modelValue:ve.value,"onUpdate:modelValue":l[1]||(l[1]=e=>ve.value=e),"max-weeks":be.value,"current-week":ge.value},null,8,["modelValue","max-weeks","current-week"])]),$("div",F,[_(e,{modelValue:he.value,"onUpdate:modelValue":l[2]||(l[2]=e=>he.value=e),options:[{label:"Semester 1",value:1},{label:"Semester 2",value:2}],label:"Semester",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue"])]),$("div",A,[_(e,{modelValue:ue.value,"onUpdate:modelValue":l[3]||(l[3]=e=>ue.value=e),options:ce.value,"option-value":"id","option-label":"name",label:"Select Classrooms",outlined:"",dense:"",multiple:"","use-chips":"","emit-value":"","map-options":"",loading:xe.value},{"before-options":j(()=>[_(t,{clickable:"",onClick:Ve},{default:j(()=>[_(s,null,{default:j(()=>[_(o,null,{default:j(()=>[S(D(Se.value?"Deselect All":"Select All"),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","options","loading"])]),$("div",I,[_(e,{modelValue:pe.value,"onUpdate:modelValue":l[4]||(l[4]=e=>pe.value=e),options:P(je),label:"Filter by Day",outlined:"",dense:"",multiple:"","use-chips":"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"])])])]),_:1}),ye.value?(x(),w("div",H,[_(u,{size:"50px",color:"primary"})])):Pe.value.length?(x(),w("div",O,[(x(!0),w(V,null,W(Pe.value,e=>(x(),w("div",{key:e.id,class:"classroom-card q-mb-lg"},[_(n,{flat:"",bordered:""},{default:j(()=>[$("div",M,[$("h5",G,[_(d,{name:"meeting_room"}),S(" "+D(e.name)+" ",1),_(i,{dense:"",label:`${e.plans.length} classes`,"text-color":"white"},null,8,["label"]),_(p),_(r,{flat:"",dense:"",round:"",icon:"picture_as_pdf",color:"white",onClick:N(a=>(e=>{if(!e||!e.plans||!e.plans.length)return void ie.notify({type:"warning",message:"No plans to save for this classroom"});const a=Ne(e.plans);let l=`<div class="page"><div class="header"><div class="title">Weekly Plans - ${e.name}</div><div class="meta">Week ${ve.value} • Semester ${he.value} • Generated ${(new Date).toLocaleString()}</div></div>`;a.forEach(e=>{l+=`<div class="day-header">${e.dayName} - ${Ce(e.dayNumber)}</div>`,l+='<table><thead><tr><th class="period">Period</th><th class="subject">Subject</th><th>Classwork (CW)</th><th>Homework (HW)</th></tr></thead><tbody>',e.plans.forEach(e=>{var a,t,s,o,n,d,i,r,c;const u=(null==(t=null==(a=e.schedule)?void 0:a.cst)?void 0:t.subject_name)||"-",p=(null==(o=null==(s=e.schedule)?void 0:s.cst)?void 0:o.c_bg)||"#e0e0e0",m=(null==(d=null==(n=e.schedule)?void 0:n.cst)?void 0:d.c_text)||"#111",v=(null==(r=null==(i=e.schedule)?void 0:i.cst)?void 0:r.teacher_name)||"-",h=e.cw?e.cw.replace(/\n/g,"<br/>"):"-",b=e.hw?e.hw.replace(/\n/g,"<br/>"):"-";l+="<tr>",l+=`<td class="period">P${(null==(c=e.schedule)?void 0:c.period_number)||""}</td>`,l+=`<td class="subject"><div class="subject-badge" style="background:${p}; color:${m}">${u}</div><div class="teacher">${v}</div></td>`,l+=`<td>${h}</td>`,l+=`<td>${b}</td>`,l+="</tr>"}),l+="</tbody></table>"}),l+="</div>";const t=`WeeklyPlans - ${String(e.name).replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_\-\.]/g,"")} - Week_${ve.value}.pdf`,s=window.open("","_blank");if(!s)return void ie.notify({type:"negative",message:"Popup blocked: allow popups to save PDF"});const o=`\n    var opt = { margin:0.5, filename: '${t}', image:{type:'jpeg', quality:0.98}, html2canvas:{scale:2}, jsPDF:{unit:'in', format:'a4', orientation:'portrait'} };\n    function doSave(){ html2pdf().set(opt).from(document.body).save().then(function(){ setTimeout(function(){ window.close(); }, 800); }); }\n    if (typeof html2pdf === 'undefined'){\n      var s = document.createElement('script'); s.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js'; s.onload = doSave; document.head.appendChild(s);\n    } else { doSave(); }\n  `;s.document.write(`<!doctype html><html><head><meta charset="utf-8"><title>PDF - ${e.name}</title><style>\n    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #333; }\n    .page { width: 210mm; padding: 12mm; box-sizing: border-box; }\n    .header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }\n    .title { font-size: 20px; color: #1976d2; font-weight:700 }\n    .meta { font-size: 12px; color:#666 }\n    table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }\n    th, td { border: 1px solid #ddd; padding: 8px; vertical-align: top; }\n    th { background: #f5f5f5; color: #1976d2; font-weight:600; }\n    .period { width: 70px; text-align: center; font-weight:700 }\n    .subject { width: 220px }\n    .subject-badge { display:inline-block; padding:6px 10px; border-radius:6px; font-weight:700 }\n    .teacher { font-size: 12px; color:#666; font-style:italic; margin-top:6px }\n    .day-header { background:#1976d2; color:white; padding:8px; font-weight:700; margin-top:12px }\n    @media print { @page { size:A4; margin:10mm } }\n  </style></head><body>${l}<script>${o} <\/script></body></html>`),s.document.close()})(e),["stop"]),disable:!e.plans||!e.plans.length},{default:j(()=>[_(c,null,{default:j(()=>l[7]||(l[7]=[S("Save as PDF")])),_:1})]),_:2},1032,["onClick","disable"]),_(r,{flat:"",dense:"",round:"",icon:"print",color:"white",onClick:N(a=>(e=>{if(!e||!e.plans||!e.plans.length)return void ie.notify({type:"warning",message:"No plans to print for this classroom"});const a=Ne(e.plans);let l=`<div class="page"><div class="header"><div class="title">Weekly Plans - ${e.name}</div><div class="meta">Week ${ve.value} • Semester ${he.value} • Generated ${(new Date).toLocaleString()}</div></div>`;a.forEach(e=>{l+=`<div class="day-header">${e.dayName} - ${Ce(e.dayNumber)}</div>`,l+='<table><thead><tr><th class="period">Period</th><th class="subject">Subject</th><th>Classwork (CW)</th><th>Homework (HW)</th></tr></thead><tbody>',e.plans.forEach(e=>{var a,t,s,o,n,d,i,r,c;const u=(null==(t=null==(a=e.schedule)?void 0:a.cst)?void 0:t.subject_name)||"-",p=(null==(o=null==(s=e.schedule)?void 0:s.cst)?void 0:o.c_bg)||"#e0e0e0",m=(null==(d=null==(n=e.schedule)?void 0:n.cst)?void 0:d.c_text)||"#111",v=(null==(r=null==(i=e.schedule)?void 0:i.cst)?void 0:r.teacher_name)||"-",h=e.cw?e.cw.replace(/\n/g,"<br/>"):"-",b=e.hw?e.hw.replace(/\n/g,"<br/>"):"-";l+="<tr>",l+=`<td class="period">P${(null==(c=e.schedule)?void 0:c.period_number)||""}</td>`,l+=`<td class="subject"><div class="subject-badge" style="background:${p}; color:${m}">${u}</div><div class="teacher">${v}</div></td>`,l+=`<td>${h}</td>`,l+=`<td>${b}</td>`,l+="</tr>"}),l+="</tbody></table>"}),l+="</div>";const t=window.open("","_blank");t?(t.document.write(`<!doctype html><html><head><meta charset="utf-8"><title>Print - ${e.name}</title><style>\n    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #333; }\n    .page { width: 210mm; padding: 12mm; box-sizing: border-box; }\n    .header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }\n    .title { font-size: 20px; color: #1976d2; font-weight:700 }\n    .meta { font-size: 12px; color:#666 }\n    table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }\n    th, td { border: 1px solid #ddd; padding: 8px; vertical-align: top; }\n    th { background: #f5f5f5; color: #1976d2; font-weight:600; }\n    .period { width: 70px; text-align: center; font-weight:700 }\n    .subject { width: 120px }\n    .subject-badge { display:inline-block; padding:6px 10px; border-radius:6px; font-weight:700 }\n    .teacher { font-size: 12px; color:#666; font-style:italic; margin-top:6px }\n    .day-header { background:#1976d2; color:white; padding:8px; font-weight:700; margin-top:12px }\n    @media print { @page { size:A4; margin:10mm } }\n  </style></head><body>${l}</body></html>`),t.document.close(),t.onload=()=>{setTimeout(()=>{t.print(),t.close()},200)}):ie.notify({type:"negative",message:"Popup blocked: allow popups to print"})})(e),["stop"]),disable:!e.plans||!e.plans.length},{default:j(()=>[_(c,null,{default:j(()=>l[8]||(l[8]=[S("Print this classroom")])),_:1})]),_:2},1032,["onClick","disable"])])]),$("div",L,[(x(!0),w(V,null,W(Ne(e.plans),e=>(x(),w("div",{key:e.dayNumber,class:"day-group"},[$("div",Y,[$("div",B,[$("div",J,D(e.dayName),1),$("div",K,[$("span",null,"Week "+D(ve.value),1),l[9]||(l[9]=$("span",{class:"separator"},"•",-1)),$("span",null,D(Ce(e.dayNumber)),1)])])]),_(h,{flat:"",bordered:"",rows:e.plans,columns:$e,"row-key":"id",dense:"",class:"classroom-table day-table","hide-header":"","hide-bottom":"",pagination:_e.value,"rows-per-page-options":[]},{"body-cell-period":j(e=>[_(v,{props:e,class:"text-center period-cell"},{default:j(()=>{var a;return[_(m,{label:`P${null==(a=e.row.schedule)?void 0:a.period_number}`,color:"primary"},null,8,["label"])]}),_:2},1032,["props"])]),"body-cell-subject":j(e=>[_(v,{props:e,class:"subject-teacher-cell"},{default:j(()=>{var a,l,t,s,o,n,d,i;return[$("div",R,[$("div",{class:"subject-name",style:z({backgroundColor:null==(l=null==(a=e.row.schedule)?void 0:a.cst)?void 0:l.c_bg,color:null==(s=null==(t=e.row.schedule)?void 0:t.cst)?void 0:s.c_text})},D(null==(n=null==(o=e.row.schedule)?void 0:o.cst)?void 0:n.subject_name),5),$("div",Z,D((null==(i=null==(d=e.row.schedule)?void 0:d.cst)?void 0:i.teacher_name)||"N/A"),1)])]}),_:2},1032,["props"])]),"body-cell-cw":j(e=>[_(v,{props:e,class:"content-preview"},{default:j(()=>[e.row.cw?(x(),w("div",X,[_(d,{name:"school",size:"xs"}),$("span",ee,D(We(e.row.cw,30)),1)])):(x(),w("span",ae,"-"))]),_:2},1032,["props"])]),"body-cell-hw":j(e=>[_(v,{props:e,class:"content-preview"},{default:j(()=>[e.row.hw?(x(),w("div",le,[_(d,{name:"home_work",size:"xs"}),$("span",te,D(We(e.row.hw,30)),1)])):(x(),w("span",se,"-"))]),_:2},1032,["props"])]),"body-cell-notes":j(e=>[_(v,{props:e,class:"content-preview"},{default:j(()=>[e.row.notes?(x(),w("span",oe,D(We(e.row.notes,20)),1)):(x(),w("span",ne,"-"))]),_:2},1032,["props"])]),_:2},1032,["rows","pagination"])]))),128))])]),_:2},1024)]))),128))])):(x(),k(n,{key:1,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:j(()=>[_(d,{name:"meeting_room",size:"64px",color:"grey-5"}),l[5]||(l[5]=$("p",{class:"text-h6 text-grey-7 q-mt-md"},"No data available",-1)),l[6]||(l[6]=$("p",{class:"text-grey-6"},"Select classrooms to view weekly plans",-1))]),_:1}))]))}},[["__scopeId","data-v-0f6d8eec"]]);export{de as default};
