import{Q as e}from"./QTab-CnAf4tCv.js";import{Q as l}from"./QTabs-D_ZwIIJm.js";import{o,u as a,c as i,a as t,d,f as r,Q as s,m as u,p as n}from"./app-B77gjd5a.js";import{Q as c}from"./QTabPanel-B_PJ80R0.js";import{Q as v}from"./QLinearProgress-B9hMkhRG.js";import{Q as m}from"./QTabPanels-B5JhG1n5.js";import{f as p,a as f,k as y,M as g,J as b,b as U,N as h,K as V,W as w,Q as x,V as _,_ as k}from"./vendor-DuKqz2x4.js";import"./rtl-Cr6c3OOr.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";import"./use-panel-N2fkKyR_.js";import"./use-render-cache-CmTcazfP.js";const q={class:"video-slide-container"},P={key:0,class:"upload-area"},z={class:"column items-center"},S={class:"column items-center"},M={class:"column items-center"},j={key:0,class:"upload-progress q-mt-md full-width"},L={class:"text-caption text-center"},D={key:1,class:"video-viewer"},G={class:"col"},R={class:"text-weight-medium"},T={class:"text-caption text-grey-6"},Q=["src"],O=["src"],Y=["src"],C=o({__name:"VideoSlide",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(o,{emit:C}){var F,B,$,A,I,W,E;const K=o,N=C,J=a(),H=p(null),X=p(null),Z=p(!1),ee=p(0),le=p("url"),oe=p(""),ae=p({type:(null==(F=K.modelValue)?void 0:F.type)||null,videoUrl:(null==(B=K.modelValue)?void 0:B.videoUrl)||null,embedUrl:(null==($=K.modelValue)?void 0:$.embedUrl)||null,videoPath:(null==(A=K.modelValue)?void 0:A.videoPath)||null,originalUrl:(null==(I=K.modelValue)?void 0:I.originalUrl)||null,filename:(null==(W=K.modelValue)?void 0:W.filename)||"",fileSize:(null==(E=K.modelValue)?void 0:E.fileSize)||0}),ie=f(()=>!!ae.value.videoUrl||!!ae.value.embedUrl);y(()=>K.modelValue,e=>{e&&(ae.value={type:e.type||null,videoUrl:e.videoUrl||null,embedUrl:e.embedUrl||null,videoPath:e.videoPath||null,originalUrl:e.originalUrl||null,filename:e.filename||"",fileSize:e.fileSize||0})},{deep:!0});const te=e=>{try{return new URL(e),!0}catch(l){return!1}},de=()=>{if(!oe.value||!te(oe.value))return;const e=oe.value.trim(),l=(e=>{const l=[/(?:youtube\.com\/watch\?v=|youtu.be\/)([^&\s]+)/,/youtube\.com\/embed\/([^&\s]+)/];for(const o of l){const l=e.match(o);if(l)return l[1]}return null})(e);if(l)return ae.value={type:"youtube",embedUrl:`https://www.youtube.com/embed/${l}`,originalUrl:e,videoUrl:null,videoPath:null,filename:"YouTube Video",fileSize:0},N("update:modelValue",ae.value),oe.value="",void J.notify({type:"positive",message:"YouTube video added successfully",icon:"check_circle",position:"top"});const o=(e=>{const l=e.match(/\/file\/d\/([^\/]+)/);return l?l[1]:null})(e);return o?(ae.value={type:"gdrive",embedUrl:`https://drive.google.com/file/d/${o}/preview`,originalUrl:e,videoUrl:null,videoPath:null,filename:"Google Drive Video",fileSize:0},N("update:modelValue",ae.value),oe.value="",void J.notify({type:"positive",message:"Google Drive video added successfully",icon:"check_circle",position:"top"})):e.match(/\.(mp4|webm|ogg)$/i)||e.includes("blob:")||e.includes("data:")?(ae.value={type:"direct",videoUrl:e,embedUrl:null,originalUrl:e,videoPath:null,filename:e.split("/").pop()||"Direct Video",fileSize:0},N("update:modelValue",ae.value),oe.value="",void J.notify({type:"positive",message:"Video URL added successfully",icon:"check_circle",position:"top"})):void J.notify({type:"warning",message:"URL format not recognized. Please use YouTube, Google Drive, or direct video links.",icon:"warning",position:"top",timeout:3e3})},re=()=>{var e;null==(e=H.value)||e.click()},se=async e=>{var l,o;const a=e.target.files[0];if(!a)return;if(!["video/mp4","video/webm","video/ogg"].includes(a.type))return void J.notify({type:"negative",message:"Please select a valid video file (MP4, WebM, or OGG)",icon:"error",position:"top"});if(a.size>52428800)J.notify({type:"negative",message:"File size exceeds 50MB limit. Please use YouTube or Google Drive for larger files.",icon:"error",position:"top",timeout:4e3});else{try{Z.value=!0,ee.value=0;const e=new FormData;e.append("video",a),e.append("type","lesson_video");const l=await k.post("/api/upload-media",e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{ee.value=Math.round(100*e.loaded/e.total)}});ae.value={type:"upload",videoUrl:l.data.url,videoPath:l.data.path,embedUrl:null,originalUrl:null,filename:a.name,fileSize:a.size},N("update:modelValue",ae.value),J.notify({type:"positive",message:"Video uploaded successfully",icon:"check_circle",position:"top"})}catch(i){console.error("Video upload error:",i),J.notify({type:"negative",message:(null==(o=null==(l=i.response)?void 0:l.data)?void 0:o.message)||"Failed to upload video",icon:"error",position:"top"})}finally{Z.value=!1,ee.value=0}e.target.value=""}},ue=()=>{var e;null==(e=X.value)||e.click()},ne=e=>{const l=e.target.files[0];if(!l)return;if(!["video/mp4","video/webm","video/ogg"].includes(l.type))return void J.notify({type:"negative",message:"Please select a valid video file (MP4, WebM, or OGG)",icon:"error",position:"top"});const o=URL.createObjectURL(l);ae.value={type:"local",videoUrl:o,embedUrl:null,videoPath:null,originalUrl:null,filename:l.name,fileSize:l.size},N("update:modelValue",ae.value),J.notify({type:"positive",message:"Video loaded from device",icon:"check_circle",position:"top"}),e.target.value=""},ce=()=>{J.dialog({title:"Remove Video",message:"Are you sure you want to remove this video?",cancel:!0,persistent:!0}).onOk(async()=>{if("local"===ae.value.type&&ae.value.videoUrl&&URL.revokeObjectURL(ae.value.videoUrl),"upload"===ae.value.type&&ae.value.videoPath)try{await k.delete("/api/delete-media",{data:{path:ae.value.videoPath}})}catch(e){console.error("Failed to delete video from server:",e)}ae.value={type:null,videoUrl:null,embedUrl:null,videoPath:null,originalUrl:null,filename:"",fileSize:0},N("update:modelValue",ae.value),J.notify({type:"info",message:"Video removed",icon:"info",position:"top"})})},ve=e=>{if(0===e)return"0 Bytes";const l=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,l)*100)/100+" "+["Bytes","KB","MB"][l]};return(o,a)=>(b(),g("div",q,[ie.value?(b(),g("div",D,[U(u,{flat:"",bordered:"",class:"info-bar q-mb-sm"},{default:V(()=>[U(i,{class:"row items-center q-pa-sm"},{default:V(()=>[U(d,{name:"youtube"===ae.value.type?"smart_display":"videocam",color:"red-6",size:"24px",class:"q-mr-sm"},null,8,["name"]),h("div",G,[h("div",R,_("youtube"===ae.value.type?"YouTube Video":"gdrive"===ae.value.type?"Google Drive Video":ae.value.filename||"Video"),1),h("div",T,_("youtube"===ae.value.type?"Embedded from YouTube":"gdrive"===ae.value.type?"Embedded from Google Drive":"direct"===ae.value.type?"Direct URL":"local"===ae.value.type?`Local file - ${ve(ae.value.fileSize)}`:"upload"===ae.value.type?`Uploaded - ${ve(ae.value.fileSize)}`:"Video"),1)]),U(s,{flat:"",round:"",dense:"",icon:"close",color:"negative",onClick:ce},{default:V(()=>[U(n,null,{default:V(()=>a[12]||(a[12]=[w("Remove Video")])),_:1})]),_:1})]),_:1})]),_:1}),U(u,{flat:"",bordered:"",class:"video-preview"},{default:V(()=>["youtube"===ae.value.type?(b(),g("iframe",{key:0,src:ae.value.embedUrl,class:"video-iframe",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""},null,8,Q)):"gdrive"===ae.value.type?(b(),g("iframe",{key:1,src:ae.value.embedUrl,class:"video-iframe",frameborder:"0",allow:"autoplay",allowfullscreen:""},null,8,O)):(b(),g("video",{key:2,src:ae.value.videoUrl,class:"video-player",controls:"",controlsList:"nodownload",preload:"metadata"}," Your browser does not support the video tag. ",8,Y))]),_:1})])):(b(),g("div",P,[U(u,{flat:"",bordered:"",class:"upload-card"},{default:V(()=>[U(i,{class:"q-pa-lg"},{default:V(()=>[U(l,{modelValue:le.value,"onUpdate:modelValue":a[0]||(a[0]=e=>le.value=e),dense:"",class:"text-grey-7 q-mb-md","active-color":"primary","indicator-color":"primary",align:"justify"},{default:V(()=>[U(e,{name:"url",icon:"link",label:"URL / Embed"}),U(e,{name:"local",icon:"folder_open",label:"Open from Device"}),U(e,{name:"upload",icon:"cloud_upload",label:"Upload to Server"})]),_:1},8,["modelValue"]),U(t,{class:"q-mb-lg"}),U(m,{modelValue:le.value,"onUpdate:modelValue":a[2]||(a[2]=e=>le.value=e),animated:""},{default:V(()=>[U(c,{name:"url",class:"q-pa-none"},{default:V(()=>[h("div",z,[U(d,{name:"play_circle",size:"60px",color:"primary",class:"q-mb-md"}),a[3]||(a[3]=h("div",{class:"text-h6 text-grey-8 q-mb-sm"},"Add Video Link",-1)),a[4]||(a[4]=h("div",{class:"text-caption text-grey-6 q-mb-lg text-center"}," Paste a YouTube link, Google Drive link, or direct video URL ",-1)),U(r,{modelValue:oe.value,"onUpdate:modelValue":a[1]||(a[1]=e=>oe.value=e),outlined:"",dense:"",placeholder:"https://www.youtube.com/watch?v=...",class:"full-width q-mb-md",rules:[e=>!e||te(e)||"Please enter a valid URL"]},{prepend:V(()=>[U(d,{name:"link"})]),_:1},8,["modelValue","rules"]),U(s,{unelevated:"",color:"primary",icon:"add",label:"Add Video",onClick:de,disable:!oe.value||!te(oe.value),class:"full-width"},null,8,["disable"]),a[5]||(a[5]=h("div",{class:"q-mt-md text-caption text-grey-6"},[h("div",{class:"q-mb-xs"},[h("strong",null,"Supported:")]),h("div",null,"• YouTube: youtube.com/watch?v=... or youtu.be/..."),h("div",null,"• Google Drive: drive.google.com/file/d/.../view"),h("div",null,"• Direct URLs: .mp4, .webm, .ogg files")],-1))])]),_:1}),U(c,{name:"local",class:"q-pa-none"},{default:V(()=>[h("div",S,[U(d,{name:"folder_open",size:"60px",color:"orange-6",class:"q-mb-md"}),a[6]||(a[6]=h("div",{class:"text-h6 text-grey-7 q-mb-sm"},"Open from Device",-1)),a[7]||(a[7]=h("div",{class:"text-caption text-grey-6 q-mb-lg text-center"},[w(" Select a video file from your device to display"),h("br"),h("strong",null,"Note:"),w(" File stays on your device (not uploaded) ")],-1)),U(s,{unelevated:"",color:"orange-6",icon:"folder_open",label:"Choose Video from Device",onClick:ue,class:"full-width"}),a[8]||(a[8]=h("div",{class:"q-mt-md text-caption text-grey-6"},[h("div",{class:"q-mb-xs"},[h("strong",null,"Supported formats:")]),h("div",null,"MP4, WebM, OGG"),h("div",{class:"q-mt-sm text-warning"},"⚠️ File will only be accessible on this device")],-1))])]),_:1}),U(c,{name:"upload",class:"q-pa-none"},{default:V(()=>[h("div",M,[U(d,{name:"cloud_upload",size:"60px",color:"grey-5",class:"q-mb-md"}),a[9]||(a[9]=h("div",{class:"text-h6 text-grey-7 q-mb-sm"},"Upload to Server",-1)),a[10]||(a[10]=h("div",{class:"text-caption text-grey-6 q-mb-lg text-center"},[w(" Upload video to server for permanent storage"),h("br"),w(" Maximum file size: 50MB ")],-1)),U(s,{unelevated:"",color:"primary",icon:"cloud_upload",label:"Upload Video to Server",onClick:re,loading:Z.value,class:"full-width"},null,8,["loading"]),ee.value>0&&ee.value<100?(b(),g("div",j,[U(v,{value:ee.value/100,color:"primary",class:"q-mb-xs"},null,8,["value"]),h("div",L,_(ee.value)+"% uploaded",1)])):x("",!0),a[11]||(a[11]=h("div",{class:"q-mt-md text-caption text-grey-6"},[h("div",null,"✅ Accessible from any device"),h("div",null,"✅ Permanent storage")],-1))])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),h("input",{ref_key:"fileInput",ref:H,type:"file",accept:"video/mp4,video/webm,video/ogg",onChange:se,style:{display:"none"}},null,544),h("input",{ref_key:"localFileInput",ref:X,type:"file",accept:"video/mp4,video/webm,video/ogg",onChange:ne,style:{display:"none"}},null,544)]))]))}},[["__scopeId","data-v-b52366fe"]]);export{C as default};
