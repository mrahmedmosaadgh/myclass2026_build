import{Q as e}from"./QSpace-CZ9CnKBh.js";import{u as a,b as l,H as o,d as t,f as n,h as r,o as u,aS as i,e as s}from"./app-DraepSDZ.js";import{Q as d}from"./QTd-ZXd3AVz0.js";import{Q as m}from"./QTable-lfCIUGXW.js";import{Q as c}from"./QSelect-B8X205mE.js";import{Q as p}from"./QForm-Dm5DeIFc.js";import{_ as v}from"./AppLayout-B3PyevP7.js";import{a as f,f as h,o as b,I as g,J as _,K as y,R as V,b as w,V as j,y as q}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./QMarkupTable-B8BpHV8_.js";import"./QLinearProgress-CYD1l_xP.js";import"./use-fullscreen-WQ56vCgJ.js";import"./rtl-Cr6c3OOr.js";const C={class:"q-pa-md"},Q={class:"row q-mb-md"},S={class:"text-h6"},k={__name:"TeacherManagement",props:{teachers:{type:Array,required:!1,default:()=>[]},schools:{type:Array,required:!0}},setup(k){const x=a(),A=k,T=f(()=>A.schools.map(e=>({value:e.id,label:e.name}))),U=h([]),N=h(!1),E=h(!1),R=h(!1),L=h(!1),P=h(!1),D=h(null),F=h(null),O=h({page:1,rowsPerPage:10,rowsNumber:0}),$=h({name:"",name_ar:"",email:"",school_id:null,phone_number:"",gender:null,date_of_birth:null}),I=[{name:"t_id",label:"Teacher ID",field:"t_id",sortable:!0},{name:"name",label:"Name",field:"name",sortable:!0},{name:"name_ar",label:"Arabic Name",field:"name_ar",sortable:!0},{name:"email",label:"Email",field:"email",sortable:!0},{name:"school",label:"School",field:"school",sortable:!0},{name:"phone_number",label:"Phone",field:"phone_number",sortable:!0},{name:"gender",label:"Gender",field:"gender",sortable:!0},{name:"actions",label:"Actions",field:"actions"}],M=e=>{console.log("onRequest",e)},G=()=>{N.value=!0,axios.get("/admin/teachers",{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},withCredentials:!0}).then(e=>{U.value=e.data.data,O.value.rowsNumber=e.data.total}).catch(e=>{x.notify({color:"negative",message:"Failed to load teachers"})}).finally(()=>{N.value=!1})},H=(e=null)=>{e?(D.value=e,$.value={...e}):(D.value=null,$.value={name:"",name_ar:"",email:"",school_id:null,phone_number:"",gender:null,date_of_birth:null}),E.value=!0},J=async()=>{var e,a,l,o,t;L.value=!0;try{const o={...$.value,school_id:(null==(a=null==(e=$.value)?void 0:e.school_id)?void 0:a.value)||$.value.school_id,gender:(null==(l=$.value.gender)?void 0:l.value)||$.value.gender};D.value?await axios.put(`/api/teachers/${D.value.id}`,o):await axios.post("/api/teachers",o),await G(),E.value=!1,x.notify({color:"positive",message:`Teacher ${D.value?"updated":"created"} successfully`})}catch(n){x.notify({color:"negative",message:(null==(t=null==(o=n.response)?void 0:o.data)?void 0:t.message)||"Operation failed"})}finally{L.value=!1}},W=async()=>{if(F.value){P.value=!0;try{await axios.delete(`/api/teachers/${F.value.id}`),await G(),R.value=!1,x.notify({color:"positive",message:"Teacher deleted successfully"})}catch(e){x.notify({color:"negative",message:"Failed to delete teacher"})}finally{P.value=!1,F.value=null}}},X=async()=>{try{const e=(await axios.get("/api/teachers/export")).data,a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),l=window.URL.createObjectURL(a),o=document.createElement("a");o.href=l,o.setAttribute("download",`teachers_${(new Date).toISOString()}.json`),document.body.appendChild(o),o.click(),document.body.removeChild(o)}catch(e){x.notify({color:"negative",message:"Failed to export data"})}};return b(()=>{G()}),(a,f)=>(_(),g(v,{title:"teacher"},{default:y(()=>[V("div",C,[V("div",Q,[w(e),w(l,{color:"primary",icon:"add",label:"Add Teacher",onClick:f[0]||(f[0]=e=>H())}),w(l,{color:"secondary",icon:"download",label:"Export",class:"q-ml-sm",onClick:X})]),w(m,{rows:U.value,columns:I,"row-key":"id",loading:N.value,pagination:O.value,onRequest:M},{"body-cell-actions":y(e=>[w(d,{props:e},{default:y(()=>[w(o,{flat:""},{default:y(()=>[w(l,{flat:"",round:"",color:"info",icon:"edit",onClick:a=>H(e.row)},null,8,["onClick"]),w(l,{flat:"",round:"",color:"negative",icon:"delete",onClick:a=>{return l=e.row,F.value=l,void(R.value=!0);var l}},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"]),w(s,{modelValue:E.value,"onUpdate:modelValue":f[7]||(f[7]=e=>E.value=e),persistent:""},{default:y(()=>[w(t,{style:{"min-width":"350px"}},{default:y(()=>[w(n,null,{default:y(()=>[V("div",S,j(D.value?"Edit Teacher":"Add Teacher"),1)]),_:1}),w(n,null,{default:y(()=>[w(p,{onSubmit:J,class:"q-gutter-md"},{default:y(()=>[w(r,{modelValue:$.value.name,"onUpdate:modelValue":f[1]||(f[1]=e=>$.value.name=e),label:"Name",rules:[e=>!!e||"Name is required"]},null,8,["modelValue","rules"]),w(r,{modelValue:$.value.name_ar,"onUpdate:modelValue":f[2]||(f[2]=e=>$.value.name_ar=e),label:"Arabic Name"},null,8,["modelValue"]),w(r,{modelValue:$.value.email,"onUpdate:modelValue":f[3]||(f[3]=e=>$.value.email=e),label:"Email",type:"email",rules:[e=>!!e||"Email is required"]},null,8,["modelValue","rules"]),w(c,{modelValue:$.value.school_id,"onUpdate:modelValue":f[4]||(f[4]=e=>$.value.school_id=e),options:T.value,label:"School",rules:[e=>!!e||"School is required"]},null,8,["modelValue","options","rules"]),w(r,{modelValue:$.value.phone_number,"onUpdate:modelValue":f[5]||(f[5]=e=>$.value.phone_number=e),label:"Phone Number"},null,8,["modelValue"]),w(c,{modelValue:$.value.gender,"onUpdate:modelValue":f[6]||(f[6]=e=>$.value.gender=e),options:["male","female"],label:"Gender","emit-value":"","map-options":""},null,8,["modelValue"])]),_:1})]),_:1}),w(u,{align:"right"},{default:y(()=>[q(w(l,{flat:"",label:"Cancel",color:"primary"},null,512),[[i]]),w(l,{flat:"",label:"Save",color:"primary",onClick:J,loading:L.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),w(s,{modelValue:R.value,"onUpdate:modelValue":f[8]||(f[8]=e=>R.value=e)},{default:y(()=>[w(t,null,{default:y(()=>[w(n,{class:"row items-center"},{default:y(()=>f[9]||(f[9]=[V("span",{class:"q-ml-sm"},"Are you sure you want to delete this teacher?",-1)])),_:1}),w(u,{align:"right"},{default:y(()=>[q(w(l,{flat:"",label:"Cancel",color:"primary"},null,512),[[i]]),w(l,{flat:"",label:"Delete",color:"negative",onClick:W,loading:P.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1}))}};export{k as default};
