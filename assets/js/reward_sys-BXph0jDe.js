const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/TopLeaderboard-xiAmevkX.js","assets/js/app-CWAnT6CT.js","assets/js/vendor-BWKGNkNB.js","assets/js/offline-BzIlwqNM.js","assets/js/i18n-B0T1C7j3.js","assets/js/ui-B7TfxbV_.js","assets/css/app-o3SF-dGU.css","assets/js/QSelect-5P1Qxg14.js","assets/js/rtl-Cr6c3OOr.js","assets/js/html2canvas.esm-Cq3pa7K9.js","assets/css/TopLeaderboard-Dw9a8_8K.css","assets/js/BehaviorIncidents-NgrEihuG.js","assets/js/QBtnToggle-C3Hu2Kxl.js","assets/js/QBadge-D8mJvg-f.js","assets/js/QToolbar-oT7Dn8Ft.js","assets/js/StudentCard-D0mpi14p.js","assets/js/AvatarManager-DfJqhGG0.js","assets/js/CameraCapture-Co9q_7wr.js","assets/css/CameraCapture-DNCA1XZm.css","assets/css/AvatarManager-CvFCMAcw.css","assets/css/StudentCard-DXXgkWNV.css","assets/js/IncidentPrintReport-BQ9UTNF4.js","assets/css/IncidentPrintReport-BcWCgfP6.css","assets/js/StudentGrouping-C_j3R2gb.js","assets/js/vuedraggable.umd-DshT_Vng.js","assets/js/index-SlSKjXnq.js","assets/css/StudentGrouping-CRYXuU7Q.css"])))=>i.map(i=>d[i]);
import{r as e,u as a,f as t,Q as l,p as s,b as o,t as n,d as r,i,j as d,k as u,c,aR as v,e as m,o as p,l as g,g as b,h as f,_ as y,G as h,aS as x,s as w,m as _}from"./app-CWAnT6CT.js";import{Q as S}from"./QBtnToggle-C3Hu2Kxl.js";import{Q as k}from"./QBadge-D8mJvg-f.js";import{Q as $}from"./QTab-BMD61nU3.js";import{Q as I}from"./QTabs-BXUhAxYJ.js";import{Q as C}from"./QTabPanel-16_gtepn.js";import{Q as j}from"./QTabPanels-BZNF5OxK.js";import{Q as A}from"./QSpace-DC5Rdnaf.js";import{Q as V}from"./QSelect-5P1Qxg14.js";import{u as z}from"./i18n-B0T1C7j3.js";import{_ as P,f as E,o as D,k as F,M as T,a as U,af as R,N as q,J as N,b as B,R as L,I as O,O as M,K as Q,V as W,z as G,l as Y,W as H,F as J,Q as Z,S as K,y as X,E as ee,ag as ae,ah as te,aS as le,U as se}from"./vendor-BWKGNkNB.js";import oe from"./PointsDisplaySettings-C96NWCCl.js";import ne from"./StudentCard-D0mpi14p.js";import re from"./noise-BNFIEDwf.js";import"./offline-BzIlwqNM.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";import"./use-panel-BQUWxHno.js";import"./use-render-cache-CmTcazfP.js";import"./AvatarManager-DfJqhGG0.js";import"./CameraCapture-Co9q_7wr.js";const ie="/api",de={behaviors:`${ie}/behaviors`,studentBehaviors:`${ie}/student-behaviors`,pointActions:`${ie}/student-behaviors-point-actions`,leaderboard:`${ie}/leaderboard`,studentSummary:e=>`${ie}/student-behaviors/${e}/summary`,pointActionStatistics:e=>`${ie}/student-behaviors/${e}/statistics`,attendance:`${ie}/student-attendance`,attendanceBatch:`${ie}/student-attendance/batch`};async function ue({classroomId:e,startDate:a,endDate:t,limit:l=10}){var s,o;try{const s=await P.get(de.leaderboard,{params:{classroom_id:e,start_date:a,end_date:t,limit:Math.min(l,50)}});return{success:!0,data:Array.isArray(s.data)?s.data:[]}}catch(n){return console.error("Error fetching leaderboard:",n),{success:!1,error:(null==(o=null==(s=n.response)?void 0:s.data)?void 0:o.message)||"Failed to fetch leaderboard",data:[],details:n}}}const ce={addPoint:async function(e,a,t=null,l=""){var s,o;try{const s={student_behaviors_id:e,value:parseInt(a),reason_id:t?parseInt(t):null,note:l||null};return{success:!0,data:(await P.post(de.pointActions,s)).data,message:`Point ${a>0?"added":"deducted"} successfully`}}catch(n){return console.error("Error adding point:",n),{success:!1,error:(null==(o=null==(s=n.response)?void 0:s.data)?void 0:o.message)||"Failed to add point",details:n}}},cancelPoint:async function(e,a){var t,l;try{return{success:!0,data:(await P.post(`${de.pointActions}/${e}/cancel`,{cancel_reason:a})).data,message:"Point action canceled successfully"}}catch(s){return console.error("Error canceling point:",s),{success:!1,error:(null==(l=null==(t=s.response)?void 0:t.data)?void 0:l.message)||"Failed to cancel point",details:s}}},restorePoint:async function(e){var a,t;try{return{success:!0,data:(await P.post(`${de.pointActions}/${e}/restore`)).data,message:"Point action restored successfully"}}catch(l){return console.error("Error restoring point:",l),{success:!1,error:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||"Failed to restore point",details:l}}},deletePoint:async function(e){var a,t;try{return{success:!0,data:(await P.delete(`${de.pointActions}/${e}`)).data,message:"Point action deleted successfully"}}catch(l){return console.error("Error deleting point:",l),{success:!1,error:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||"Failed to delete point",details:l}}},createStudentBehavior:async function(e){var a,t;try{const a={school_id:e.schoolId,student_behaviors_mains_id:e.studentBehaviorsMainsId,student_id:e.studentId,attend:e.attend||null,points_plus:e.pointsPlus||0,points_minus:e.pointsMinus||0,points_details:e.pointsDetails||"",notes:e.notes||null};return{success:!0,data:(await P.post(de.studentBehaviors,a)).data,message:"Student behavior record created successfully"}}catch(l){return console.error("Error creating student behavior:",l),{success:!1,error:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||"Failed to create behavior record",details:l}}},getStudentSummary:async function(e){var a,t;try{return{success:!0,data:(await P.get(de.studentSummary(e))).data}}catch(l){return console.error("Error fetching student summary:",l),{success:!1,error:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||"Failed to fetch student summary",details:l}}},getPointActions:async function(e){var a,t;try{return{success:!0,data:(await P.get(de.pointActions,{params:{student_behaviors_id:e}})).data}}catch(l){return console.error("Error fetching point actions:",l),{success:!1,error:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||"Failed to fetch point actions",details:l}}},getPointStatistics:async function(e){var a,t;try{return{success:!0,data:(await P.get(`${de.pointActions}/statistics/${e}`)).data}}catch(l){return console.error("Error fetching point statistics:",l),{success:!1,error:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||"Failed to fetch statistics",details:l}}},fetchBehaviors:async function(){var e,a;try{const e=await P.get(de.behaviors);return{success:!0,data:Array.isArray(e.data)?e.data:[]}}catch(t){return console.error("Error fetching behaviors:",t),{success:!1,error:(null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.message)||"Failed to fetch behaviors",data:[],details:t}}},applyBehaviorToStudents:async function(e,a,t={}){var l,s,o,n,r,i,d,u,c,v,m,p,g,b;try{const g=[],b=[],y="object"==typeof a?a.id:a;if(console.log("üéØ applyBehaviorToStudents called with:",{studentCount:e.length,behaviorIdInput:a,actualBehaviorId:y,behaviorIdType:typeof a}),!y||isNaN(y))return console.error("‚ùå Invalid behavior ID:",a),{success:!1,error:"Invalid behavior ID provided"};for(const a of e){const e={student_id:a,behavior_id:y,date:t.date||(new Date).toISOString().split("T")[0],period_code:t.periodCode||null,points_mode:t.points_mode||"session",notes:t.notes||null};console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"),console.log("üì§ Sending behavior application request"),console.log("   Student ID:",a),console.log("   Behavior ID:",y),console.log("   Date:",e.date),console.log("   Period Code:",e.period_code),console.log("   Payload:",JSON.stringify(e,null,2)),console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");try{const t=await P.post(`${ie}/student-behaviors/quick-create`,e);console.log("‚úÖ SUCCESS - Behavior applied for student:",a),console.log("   Response Status:",t.status),console.log("   Response Data:",t.data),g.push({studentId:a,success:!0,data:t.data})}catch(f){console.error("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"),console.error("‚ùå FAILED - Error applying behavior to student:",a),console.error("   HTTP Status:",null==(l=f.response)?void 0:l.status,null==(s=f.response)?void 0:s.statusText),console.error("   Error Message:",null==(n=null==(o=f.response)?void 0:o.data)?void 0:n.message),console.error("   Error Details:",null==(i=null==(r=f.response)?void 0:r.data)?void 0:i.error),console.error("   Validation Errors:",null==(u=null==(d=f.response)?void 0:d.data)?void 0:u.errors),console.error("   Full Response:",null==(c=f.response)?void 0:c.data),console.error("   Sent Payload:",e),console.error("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"),b.push({studentId:a,success:!1,error:(null==(m=null==(v=f.response)?void 0:v.data)?void 0:m.message)||"Failed to apply behavior",fullError:null==(p=f.response)?void 0:p.data})}}return console.log("üéØ BATCH RESULT:",{totalRequests:e.length,successful:g.length,failed:b.length,successRate:`${Math.round(g.length/e.length*100)}%`}),{success:0===b.length,results:g,errors:b,message:`Applied to ${g.length}/${e.length} students`}}catch(y){return console.error("‚ùå OUTER ERROR - Exception in applyBehaviorToStudents:",y),{success:!1,error:(null==(b=null==(g=y.response)?void 0:g.data)?void 0:b.message)||"Failed to apply behavior",details:y}}},fetchLeaderboard:ue,getTopStudentsByPeriod:async function({classroomId:e,period:a="week",limit:t=5}){try{const l=new Date;let s;switch(a){case"week":default:s=new Date(l.getTime()-6048e5);break;case"month":s=new Date(l.getFullYear(),l.getMonth(),1);break;case"all":s=new Date("2020-01-01")}const o=e=>e.toISOString().split("T")[0];return ue({classroomId:e,startDate:o(s),endDate:o(l),limit:t})}catch(l){return console.error("Error getting top students:",l),{success:!1,error:"Failed to get top students",data:[],details:l}}},updateAttendance:async function(e,a,t={}){var l,s,o;try{const r={student_id:parseInt(e),attend:Boolean(a),date:t.date||(new Date).toISOString().split("T")[0],period_code:t.periodCode||null,classroom_id:t.classroomId||null};try{const e=await P.post(de.attendance,r);return{success:!0,data:e.data,message:(null==(l=e.data)?void 0:l.message)||"Student marked as "+(a?"present":"absent")}}catch(n){return console.warn("Attendance API call failed, falling back to client-only update:",null==(s=null==n?void 0:n.response)?void 0:s.status),{success:!0,data:{studentId:parseInt(e),isPresent:Boolean(a),updatedAt:(new Date).toISOString()},message:`Student marked as ${a?"present":"absent"} (local)`,warning:(null==(o=n.response)?void 0:o.data)||n.message}}}catch(r){return console.error("Error updating attendance:",r),{success:!1,error:"Failed to update attendance",details:r}}},batchUpdateAttendance:async function(e,a={}){var t,l,s;try{if(!e||"object"!=typeof e)return{success:!1,error:"Invalid attendance data"};const n=Object.entries(e).map(([e,t])=>({student_id:parseInt(e),attend:Boolean(t),date:a.date||(new Date).toISOString().split("T")[0],period_code:a.periodCode||null,classroom_id:a.classroomId||null,updated_at:(new Date).toISOString()}));try{const e=await P.post(de.attendanceBatch,{attendance:n});return{success:!0,data:e.data,message:(null==(t=e.data)?void 0:t.message)||`Updated attendance for ${n.length} students`}}catch(o){return console.warn("Batch attendance API call failed, falling back to local update:",null==(l=null==o?void 0:o.response)?void 0:l.status),{success:!0,data:n,message:`Updated attendance for ${n.length} students (local)`,warning:(null==(s=o.response)?void 0:s.data)||o.message}}}catch(n){return console.error("Error batch updating attendance:",n),{success:!1,error:"Failed to batch update attendance",details:n}}},getRecentActions:async function({classroomId:e,date:a,limit:t=10}){var l,s;try{const l=await P.get(`${ie}/student-behaviors/recent-actions`,{params:{classroom_id:e,date:a,limit:t}});return{success:!0,data:Array.isArray(l.data.data)?l.data.data:[]}}catch(o){return console.error("Error fetching recent actions:",o),{success:!1,error:(null==(s=null==(l=o.response)?void 0:l.data)?void 0:s.message)||"Failed to fetch recent actions",data:[]}}},undoAction:async function(e,a="Undone by teacher"){var t,l;try{const t=await P.post(`${ie}/student-behaviors/actions/${e}/cancel`,{cancel_reason:a});return{success:!0,data:t.data.data,message:t.data.message||"Action undone successfully"}}catch(s){return console.error("Error undoing action:",s),{success:!1,error:(null==(l=null==(t=s.response)?void 0:t.data)?void 0:l.message)||"Failed to undo action"}}},formatPointValue:function(e){return e>0?`+${e} ‚≠ê`:e<0?`${e} ‚ö†Ô∏è`:"0"},getActionTypeLabel:function(e){return{plus:"Added",minus:"Deducted",cancel:"Canceled",revoke:"Revoked"}[e]||e},calculateTotalPoints:function(e,a=!1){return Array.isArray(e)?e.filter(e=>a||!e.canceled).reduce((e,a)=>e+(a.value||0),0):0},separatePoints:function(e){if(!Array.isArray(e))return{positive:0,negative:0};const a=e.filter(e=>!e.canceled);return{positive:a.filter(e=>e.value>0).reduce((e,a)=>e+a.value,0),negative:Math.abs(a.filter(e=>e.value<0).reduce((e,a)=>e+a.value,0))}},isActionEditable:function(e,a=24){try{const t=new Date(e);return(new Date-t)/36e5<a}catch(t){return!1}},getUserFriendlyErrorMessage:function(e){var a,t,l,s,o,n,r;return 401===(null==(a=e.response)?void 0:a.status)?"You are not authenticated. Please log in.":403===(null==(t=e.response)?void 0:t.status)?"You do not have permission to perform this action.":404===(null==(l=e.response)?void 0:l.status)?"The requested resource was not found.":422===(null==(s=e.response)?void 0:s.status)?"Invalid data provided. Please check your input.":500===(null==(o=e.response)?void 0:o.status)?"Server error. Please try again later.":"Network Error"===e.message?"Network error. Please check your connection.":(null==(r=null==(n=e.response)?void 0:n.data)?void 0:r.message)||"An unexpected error occurred."},retryWithBackoff:async function(e,a=3,t=1e3){let l;for(let o=0;o<a;o++)try{return await e()}catch(s){if(l=s,o<a-1){const e=t*Math.pow(2,o);await new Promise(a=>setTimeout(a,e))}}throw l}},ve=new Map;async function me(e){const a=Object.entries(e).map(([e,a])=>ve.has(e)?Promise.resolve():new Promise(t=>{const l=new Audio(a);l.addEventListener("canplaythrough",()=>{ve.set(e,l),t()},{once:!0}),l.addEventListener("error",()=>{console.warn(`Failed to preload sound "${e}"`),t()},{once:!0}),l.load()}));await Promise.all(a)}const pe={class:"p-6 space-y-6 bg-gradient-to-br from-gray-800 to-gray-900 min-h-screen"},ge={class:"text-3xl font-bold"},be={class:"text-blue-100"},fe={class:"flex items-center justify-between bg-white p-4 rounded-lg border border-gray-200 shadow-sm"},ye={class:"flex items-center gap-4"},he={class:"bg-blue-100 p-3 rounded-full text-blue-600"},xe={class:"text-sm text-gray-500 font-medium"},we={class:"text-lg font-bold text-gray-800 flex items-center gap-2"},_e={key:0},Se={key:1,class:"text-gray-400 italic"},ke={class:"text-blue-600 font-mono bg-blue-50 px-2 py-0.5 rounded text-base"},$e={class:"text-xs text-gray-500 mt-1"},Ie={key:0,class:"bg-gradient-to-r from-blue-50 to-indigo-50 p-3 rounded-lg border border-blue-200 shadow-sm"},Ce={class:"flex items-center justify-between flex-wrap gap-3"},je={class:"flex items-center gap-2"},Ae={class:"text-sm font-bold text-gray-700"},Ve={class:"flex items-center gap-3 flex-wrap"},ze={key:0,class:"text-xs text-gray-500 bg-white px-2 py-1 rounded border border-dashed border-gray-300"},Pe={class:"flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg border border-blue-200"},Ee={class:"flex flex-col"},De={class:"text-xs text-gray-500"},Fe={class:"text-lg font-bold text-blue-600"},Te={class:"flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg border border-green-200"},Ue={class:"flex flex-col"},Re={class:"text-xs text-gray-500"},qe={class:"text-lg font-bold text-green-600"},Ne={class:"flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg border border-red-200"},Be={class:"flex flex-col"},Le={class:"text-xs text-gray-500"},Oe={class:"text-lg font-bold text-red-600"},Me={key:0,class:"mt-3 pt-3 border-t border-blue-200"},Qe={class:"text-xs font-semibold text-gray-600 mb-2 flex items-center gap-1"},We={class:"bg-white border border-red-200 rounded-lg p-2"},Ge={class:"flex flex-wrap gap-1.5"},Ye={class:"sticky top-0 z-50 bg-white shadow-md border-b border-gray-200"},He={class:"q-pa-sm flex justify-between items-center flex-nowrap gap-2"},Je={class:"flex items-center gap-2 flex-nowrap overflow-hidden"},Ze={class:"row no-wrap q-pa-md"},Ke={key:0},Xe={key:1,class:"column items-center",style:{"min-width":"180px"}},ea={class:"column q-gutter-y-sm full-width"},aa={class:"q-py-sm"},ta={key:0,class:"flex items-center gap-1 overflow-hidden"},la={class:"flex items-center gap-2"},sa={style:{width:"420px","max-width":"90vw"}},oa={class:"row q-col-gutter-sm"},na=["onClick"],ra={class:"column items-center q-pa-sm bg-blue-50 rounded-xl border border-blue-100 shadow-sm hover:shadow-md hover:bg-blue-100 transition-all text-center h-full relative-position"},ia={class:"text-caption text-weight-bold text-grey-9 ellipsis-2-lines leading-tight min-h-[2.5em] flex items-center justify-center"},da={class:"absolute-top-right q-ma-xs"},ua={class:"row q-col-gutter-sm"},ca=["onClick"],va={class:"column items-center q-pa-sm bg-red-50 rounded-xl border border-red-100 shadow-sm hover:shadow-md hover:bg-red-100 transition-all text-center h-full relative-position"},ma={class:"text-caption text-weight-bold text-grey-9 ellipsis-2-lines leading-tight min-h-[2.5em] flex items-center justify-center"},pa={class:"absolute-top-right q-ma-xs"},ga={key:0,class:"bg-orange-50 p-1 text-center border-b border-orange-100 text-xs text-orange-800 font-bold"},ba={class:"space-y-4"},fa={class:"flex justify-between items-center mb-4"},ya={class:"text-xl font-bold"},ha={class:"flex gap-2"},xa={class:"flex flex-wrap justify-center gap-6 p-4 bg-gray-400"},wa={class:""},_a={class:"mt-6"},Sa={class:"mb-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200 shadow-sm"},ka={class:"flex items-center justify-between flex-wrap gap-3"},$a={class:"flex items-center gap-2"},Ia={class:"font-bold text-gray-700"},Ca={class:"flex items-center gap-2 flex-wrap"},ja={class:"row items-center q-gutter-x-sm"},Aa={class:"font-bold"},Va={class:"font-bold"},za={class:"text-h6"},Pa={key:0,class:"text-gray-500 italic text-center py-4"},Ea=["src"],Da={key:0,class:"mb-3 p-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg border border-indigo-200"},Fa={class:"flex items-center justify-between"},Ta={class:"font-bold text-indigo-900 flex items-center gap-2"},Ua={class:"flex gap-2"},Ra={class:"flex flex-wrap justify-center gap-4"},qa={class:"space-y-4"},Na={class:"mb-4"},Ba={class:"text-xl font-bold mb-2"},La={class:"text-sm text-gray-600"},Oa={class:"p-4 bg-red-50 rounded-lg border border-red-200"},Ma={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Qa={class:"mt-2 text-sm"},Wa={class:"flex flex-wrap justify-center gap-6 p-4"},Ga={class:"space-y-4"},Ya={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Ha=["onClick"],Ja={class:"flex items-start justify-between mb-3"},Za={class:"flex-1"},Ka={class:"font-semibold text-lg"},Xa={class:"text-xs text-gray-600"},et={key:0,class:"text-xs text-red-600 mt-1"},at={class:"space-y-2"},tt={class:"p-2 bg-green-100 rounded flex justify-between items-center"},lt={class:"text-sm font-bold text-green-900"},st={class:"p-2 bg-red-100 rounded flex justify-between items-center"},ot={class:"text-sm font-bold text-red-900"},nt={class:"p-2 bg-blue-100 rounded flex justify-between items-center"},rt={class:"text-lg font-bold text-blue-600"},it={class:"space-y-4"},dt={class:"flex justify-between items-center mb-4"},ut={class:"text-xl font-bold"},ct={key:0,class:"text-center py-8"},vt={class:"text-gray-500 text-lg"},mt={class:"flex items-start justify-between"},pt={class:"flex-1"},gt={class:"flex items-center gap-2 mb-1"},bt={class:"font-bold text-lg"},ft={class:"text-2xl"},yt={class:"text-sm text-gray-700"},ht={class:"text-xs text-gray-500 mt-1"},xt={key:0,class:"text-xs text-gray-600 mt-1 italic"},wt={key:1,class:"text-xs text-red-600 mt-1"},_t={class:"flex flex-col h-full gap-4"},St={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},kt={class:"space-y-6"},$t={class:"flex justify-between items-center mb-6"},It={class:"text-2xl font-bold text-gray-800"},Ct={class:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200"},jt={class:"flex items-center gap-3 mb-4"},At={class:"text-xl font-bold text-green-800"},Vt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},zt={class:"flex items-start justify-between mb-2"},Pt={class:"flex items-center gap-2"},Et={class:"text-3xl"},Dt={class:"font-bold text-gray-800"},Ft={class:"text-xs text-gray-500"},Tt={class:"flex gap-1"},Ut={class:"flex items-center justify-between mt-3 pt-3 border-t border-green-100"},Rt={class:"text-lg font-bold text-green-600"},qt={key:0,class:"text-center py-8 text-gray-400"},Nt={class:"bg-gradient-to-r from-red-50 to-rose-50 rounded-xl p-6 border border-red-200"},Bt={class:"flex items-center gap-3 mb-4"},Lt={class:"text-xl font-bold text-red-800"},Ot={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Mt={class:"flex items-start justify-between mb-2"},Qt={class:"flex items-center gap-2"},Wt={class:"text-3xl"},Gt={class:"font-bold text-gray-800"},Yt={class:"text-xs text-gray-500"},Ht={class:"flex gap-1"},Jt={class:"flex items-center justify-between mt-3 pt-3 border-t border-red-100"},Zt={class:"text-lg font-bold text-red-600"},Kt={key:0,class:"text-center py-8 text-gray-400"},Xt={class:"text-2xl font-semibold text-gray-600"},el={class:"p-4 border-b border-blue-200 bg-blue-100/50"},al={class:"font-bold text-blue-900 flex items-center gap-2 text-lg"},tl={class:"flex-1 overflow-y-auto p-4 custom-scrollbar"},ll={key:0,class:"text-center py-8 text-gray-400 italic text-sm"},sl={key:1,class:"flex flex-col gap-2"},ol={class:"flex flex-col leading-tight overflow-hidden w-full"},nl={class:"font-bold text-2xl truncate"},rl={class:"text-sm opacity-80 truncate"},il={class:"p-3 border-t border-blue-200 bg-white"},dl={class:"grid grid-cols-3 gap-2"},ul={class:"flex-1 flex flex-col bg-white"},cl={class:"text-h6 font-bold flex items-center gap-2"},vl={class:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3"},ml=["onClick"],pl={class:"font-bold text-xl leading-tight text-gray-800 line-clamp-2"},gl={class:"flex justify-between items-center"},bl={class:"text-h6"},fl=e({__name:"reward_sys",props:{isDialog:{type:Boolean,default:!1},classroomId:{type:Number,default:null},subjectId:{type:Number,default:null},period:{type:Number,default:null},date:{type:String,default:null},week:{type:Number,default:null},initialTab:{type:String,default:"positive"}},setup(e){const ie=e,de=le(()=>y(()=>import("./TopLeaderboard-xiAmevkX.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),ue=le(()=>y(()=>import("./BehaviorIncidents-NgrEihuG.js"),__vite__mapDeps([11,1,2,3,4,5,6,12,13,14,7,8,15,16,17,18,19,20,21,22]))),fl=le(()=>y(()=>import("./StudentGrouping-C_j3R2gb.js"),__vite__mapDeps([23,1,2,3,4,5,6,24,25,26]))),yl={select:"/audio/click-234708.mp3",reward:"/audio/purchase-success-384963.mp3",penalty:"/audio/error-010-206498.mp3"},hl=E(null),xl=E(!1);D(()=>{!function(e){"requestIdleCallback"in window?requestIdleCallback(()=>me(e),{timeout:2e3}):setTimeout(()=>me(e),1e3)}(yl);const e=localStorage.getItem("reward-system-bg-music");xl.value="true"===e,hl.value&&(hl.value.volume=.1,xl.value&&hl.value.play().catch(e=>console.log("Autoplay prevented:",e)))}),F(xl,e=>{localStorage.setItem("reward-system-bg-music",e),hl.value&&(e?hl.value.play().catch(e=>console.log("Playback error:",e)):hl.value.pause())});const wl=e=>{!async function(e,a){if(!a[e])return void console.warn(`Sound key "${e}" not found in soundFiles`);if(!ve.has(e)){const t=new Audio(a[e]);await new Promise((e,a)=>{t.addEventListener("canplaythrough",e,{once:!0}),t.addEventListener("error",a,{once:!0}),t.load()}).catch(a=>{console.warn(`Failed to load sound "${e}":`,a)}),ve.set(e,t)}const t=ve.get(e);t&&(t.currentTime=0,t.play().catch(e=>console.log("Sound play error:",e)))}(e,yl)},{t:_l,locale:Sl}=z(),kl=e=>e?"ar"===Sl.value&&e.name_ar?e.name_ar:e.name:"",$l=T(),Il=U(()=>{var e,a;const t=null==(a=null==(e=$l.props.auth)?void 0:e.user)?void 0:a.school;return Array.isArray(t)&&t.length>0?t[0].logo_url:null}),Cl=U(()=>{const e=new Map;return Dl.value.forEach(a=>{a.subject_id&&!e.has(a.subject_id)&&e.set(a.subject_id,{id:a.subject_id,name:a.subject_name,name_ar:a.subject_name_ar})}),Array.from(e.values())});U(()=>Rl.value?Dl.value.filter(e=>e.subject_id===Rl.value):[]);const jl=U(()=>{const e=Fl.value.length;if(0===e)return{present:0,absent:0,absentList:[]};const a=Fl.value.filter(e=>Yl.value[e.id]).length;return{present:a,absent:e-a,absentList:Fl.value.filter(e=>!Yl.value[e.id])}}),Al=()=>{const e=jl.value.absentList.map(e=>"ar"===Sl.value&&e.name_ar?e.name_ar:e.name).join("\n");e&&navigator.clipboard.writeText(e).then(()=>{Vl.notify({message:_l("rewardSys.session.copied"),color:"positive",icon:"content_copy",position:"top"})}).catch(e=>{console.error("Failed to copy: ",e)})};E("https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf");const Vl=a(),zl=E(ie.initialTab||"positive"),Pl=E("positive");F(()=>ie.initialTab,e=>{e&&(zl.value=e)});const El=E("behavior_incidents");F(zl,(e,a)=>{localStorage.setItem("reward-system-active-tab",e),e!==a&&(Wl.value=[])});const Dl=E([]),Fl=E([]),Tl=E([]),Ul=E(null),Rl=E(null),ql=E((new Date).toISOString().split("T")[0]),Nl=E(1),Bl=E(1),Ll=E(1),Ol=E(1),Ml=E(null),Ql=E(null),Wl=E([]),Gl=E({}),Yl=E({}),Hl=E({}),Jl=E([]);E([]);const Zl=E(!1),Kl=E(!1),Xl=E(!1),es=E(!1),as=E(!1),ts=E(null),ls=E(null),ss=E({message:"",created:0,skipped:0}),os=E(!1),ns=E(!1),rs=E(!1),is=E("positive"),ds=E(null),us=E("no_groups"),cs=E([]),vs=E(!1),ms=E(null),ps=E(!1),gs=E(localStorage.getItem("points-display-mode")||"overall"),bs=E({}),fs=E(localStorage.getItem("competition-start-time")||null),ys=E(localStorage.getItem("custom-date-from")||null),hs=E(localStorage.getItem("custom-date-to")||null),xs=E(localStorage.getItem("leaderboard-mode")||"top5"),ws=E(!1),_s=E(null),Ss=E(!1),ks=E({name:"",type:"positive",points:0,icon:""});F(Rl,e=>{null!==e&&(localStorage.setItem("reward-system-selected-subject-id",e.toString()),console.log(`üíæ Saved subject to localStorage: ${e}`))}),F(Ul,e=>{null!==e&&(localStorage.setItem("reward-system-selected-classroom-id",e.toString()),console.log(`üíæ Saved classroom to localStorage: ${e}`))}),F(Nl,e=>{null!==e&&(localStorage.setItem("reward-system-selected-semester",e.toString()),console.log(`üíæ Saved semester to localStorage: ${e}`))}),F(Bl,e=>{null!==e&&(localStorage.setItem("reward-system-selected-week",e.toString()),console.log(`üíæ Saved week to localStorage: ${e}`))}),F(Ll,e=>{null!==e&&(localStorage.setItem("reward-system-selected-day",e.toString()),console.log(`üíæ Saved day to localStorage: ${e}`))}),F(Ol,e=>{null!==e&&(localStorage.setItem("reward-system-selected-period-number",e.toString()),console.log(`üíæ Saved period number to localStorage: ${e}`))}),F(ql,e=>{if(e){const a=new Date(e);Ll.value=a.getDay()+1,console.log(`üìÖ Date changed to ${e}, Day updated to ${Ll.value}`)}});const $s=U(()=>`${Nl.value}.${Bl.value}.${Ll.value}.${Ol.value}`);U(()=>{const e=Dl.value.find(e=>e.classroom_id===Ul.value);return e?e.classroom_name:_l("rewardSys.session.unknownClass")}),U(()=>{const e=Cl.value.find(e=>e.subject_id===Rl.value);return e?"ar"===Sl.value&&e.subject_name_ar?e.subject_name_ar:e.subject_name:""});const Is=U(()=>Fl.value.filter(e=>Yl.value[e.id]).length),Cs=U(()=>Fl.value.filter(e=>!Yl.value[e.id]).length),js=E(!1),As=E("present"),Vs=U(()=>Fl.value.filter(e=>"present"===As.value?Yl.value[e.id]:!Yl.value[e.id]));function zs(e){As.value=e,js.value=!0}function Ps(){const e=Vs.value.map(e=>e.name).join("\n");navigator.clipboard.writeText(e).then(()=>{})}function Es(e){return e.avatar?e.avatar.startsWith("/")?e.avatar:`/${e.avatar}`:"/images/avatars/default-avatar.svg"}const Ds=U(()=>{console.log("üîç All behaviors:",Tl.value);const e=Tl.value.filter(e=>{if(e.type)return"positive"===e.type||"reward"===e.type;return(e.value||e.points||0)>0});return console.log("‚úÖ Positive behaviors:",e),e}),Fs=U(()=>{const e=Tl.value.filter(e=>{if(e.type)return"negative"===e.type||"penalty"===e.type;return(e.value||e.points||0)<0});return console.log("‚ö†Ô∏è Negative behaviors:",e),e}),Ts=U(()=>[{label:"No Groups",value:"no_groups",icon:"grid_view"},{label:"Name (A‚ÜíZ)",value:"name_asc",icon:"sort_by_alpha"},{label:"Name (Z‚ÜíA)",value:"name_desc",icon:"sort_by_alpha"},...cs.value.map(e=>({label:e.name,value:e.id,icon:"groups"}))]);U(()=>{const e=Ts.value.find(e=>e.value===us.value);return(null==e?void 0:e.icon)||"grid_view"});const Us=U(()=>{if("no_groups"===us.value)return[{name:null,students:Fl.value}];if("name_asc"===us.value){return[{name:null,students:[...Fl.value].sort((e,a)=>(e.firstName||"").localeCompare(a.firstName||""))}]}if("name_desc"===us.value){return[{name:null,students:[...Fl.value].sort((e,a)=>(a.firstName||"").localeCompare(e.firstName||""))}]}const e=cs.value.find(e=>e.id===us.value);if(!e)return[{name:null,students:Fl.value}];const a=e.groups.map(e=>({name:e.name,students:Fl.value.filter(a=>e.student_ids.includes(a.id))})),t=new Set(e.groups.flatMap(e=>e.student_ids)),l=Fl.value.filter(e=>!t.has(e.id));return l.length>0&&a.push({name:"Unassigned",students:l}),a});function Rs(){const e=Fl.value.filter(e=>Yl.value[e.id]);Wl.value=e.map(e=>e.id)}function qs(){const e=Fl.value.filter(e=>Yl.value[e.id]),a=new Set(Wl.value),t=[];e.forEach(e=>{a.has(e.id)||t.push(e.id)}),Wl.value=t}async function Ns(){ds.value&&("positive"===is.value?(Ml.value=ds.value,await async function(){await Ks(Ml.value),Ml.value=null}()):(Ql.value=ds.value,await Zs()),rs.value=!1,ds.value=null)}async function Bs(e){var a,t;const l=cs.value.findIndex(a=>a.id===e.id);l>=0?cs.value[l]=e:cs.value.push(e);try{const a=await P.post("/api/classroom-layouts/save",{classroom_id:Ul.value,layouts:cs.value});if(!a.data.success)throw new Error(a.data.message||"Failed to save layout");Vl.notify({message:`Layout "${e.name}" saved successfully!`,color:"positive",position:"top",icon:"check_circle"}),us.value=e.id,vs.value=!1,ms.value=null}catch(s){if(console.error("Error saving layout:",s),Vl.notify({message:"Failed to save layout: "+((null==(t=null==(a=s.response)?void 0:a.data)?void 0:t.message)||s.message),color:"negative",position:"top",icon:"error"}),l>=0)cs.value.splice(l,1);else{const a=cs.value.findIndex(a=>a.id===e.id);a>=0&&cs.value.splice(a,1)}}}async function Ls(e){var a,t;const l=cs.value.findIndex(a=>a.id===e);if(l<0)return;const s=cs.value[l];cs.value.splice(l,1),us.value===e&&(us.value="no_groups");try{const e=await P.post("/api/classroom-layouts/save",{classroom_id:Ul.value,layouts:cs.value});if(!e.data.success)throw new Error(e.data.message||"Failed to delete layout");Vl.notify({message:`Layout "${s.name}" deleted successfully!`,color:"positive",position:"top",icon:"delete"})}catch(o){console.error("Error deleting layout:",o),Vl.notify({message:"Failed to delete layout: "+((null==(t=null==(a=o.response)?void 0:a.data)?void 0:t.message)||o.message),color:"negative",position:"top",icon:"error"}),cs.value.splice(l,0,s),"no_groups"===us.value&&(us.value=e)}}function Os(e){e?(_s.value=e,ks.value={name:e.name,type:e.type||(e.value>0?"positive":"negative"),points:e.value||e.points||0,icon:e.icon||""}):(_s.value=null,ks.value={name:"",type:"positive",points:0,icon:""}),ws.value=!0}async function Ms(){var e,a;if(ks.value.name&&ks.value.type&&null!==ks.value.points){Ss.value=!0;try{const e={name:ks.value.name,name_ar:ks.value.name_ar||null,type:ks.value.type,value:ks.value.points,points:ks.value.points,icon:ks.value.icon||null,school_id:1,year_id:2};if(_s.value){const a=await P.put(`/api/behaviors/${_s.value.id}`,e),t=Tl.value.findIndex(e=>e.id===_s.value.id);t>=0&&(Tl.value[t]=a.data),Vl.notify({message:"Behavior updated successfully!",color:"positive",icon:"check_circle"})}else{const a=await P.post("/api/behaviors",e);Tl.value.push(a.data),Vl.notify({message:"Behavior created successfully!",color:"positive",icon:"check_circle"})}ws.value=!1,_s.value=null}catch(t){console.error("Error saving behavior:",t),Vl.notify({message:"Failed to save behavior: "+((null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.message)||t.message),color:"negative",icon:"error"})}finally{Ss.value=!1}}else Vl.notify({message:"Please fill in all required fields",color:"warning",position:"top"})}function Qs(e){Vl.dialog({title:"Confirm Delete",message:`Are you sure you want to delete "${e.name}"? This action cannot be undone.`,cancel:!0,persistent:!0,color:"negative"}).onOk(()=>{!async function(e){var a,t;try{await P.delete(`/api/behaviors/${e.id}`);const a=Tl.value.findIndex(a=>a.id===e.id);a>=0&&Tl.value.splice(a,1),Vl.notify({message:"Behavior deleted successfully!",color:"positive",icon:"check_circle"})}catch(l){console.error("Error deleting behavior:",l),Vl.notify({message:"Failed to delete behavior: "+((null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.message)||l.message),color:"negative",icon:"error"})}}(e)})}function Ws(e){if(!Yl.value[e])return void Vl.notify({message:"Cannot select absent students",color:"warning",position:"top",timeout:1e3});const a=Wl.value.indexOf(e);-1===a?(Wl.value.push(e),wl("select")):Wl.value.splice(a,1)}function Gs(e,a){if(a){const a=e.filter(e=>Yl.value[e.id]).map(e=>e.id),t=new Set(Wl.value);a.forEach(e=>t.add(e)),Wl.value=Array.from(t),wl("select")}else{const a=new Set(e.map(e=>e.id));Wl.value=Wl.value.filter(e=>!a.has(e))}}function Ys(){Wl.value=[]}async function Hs(e){if(!e)return Fl.value=[],Wl.value=[],void(cs.value=[]);try{Kl.value=!0,Fl.value=[],Wl.value=[],ls.value=null,ss.value={message:"",created:0,skipped:0},await async function(){if(Ul.value)try{const e=await P.get("/api/classroom-layouts/load",{params:{classroom_id:Ul.value}});e.data.success&&(cs.value=e.data.data||[])}catch(e){console.error("Error loading layouts:",e)}}()}catch(a){console.error("Failed to load classroom:",a),Vl.notify({message:"Failed to load classroom: "+a.message,color:"negative",position:"top"})}finally{Kl.value=!1}}async function Js(){if(Ul.value){Kl.value=!0,ss.value={message:"Initializing...",created:0,skipped:0};try{const e={classroom_id:Ul.value,date:ql.value,period_code:$s.value,points_mode:"from_now"===gs.value?"overall":gs.value},a=await P.post("/api/student-behaviors/init-classroom",e);if(a&&a.data){const e=a.data;ls.value=e.student_behaviors_mains_id,ss.value={message:`Session initialized (created ${e.created}, skipped ${e.skipped}, mode: ${e.points_mode})`,created:e.created,skipped:e.skipped};const t=e.student_behaviors||[],l=t.map(e=>e.student?{id:e.student.id,name:e.student.name||`Student ${e.student_id}`,name_ar:e.student.name_ar,firstName:e.student.first_name,secondName:e.student.second_name,lastName:e.student.last_name,avatar:e.student.avatar,behaviorRecordId:e.id}:null).filter(e=>null!==e);Fl.value=l,Wl.value=[];const s={};for(const a of t)Yl.value[a.student_id]=void 0===a.attend||a.attend,s[a.student_id]={attend:void 0===a.attend||a.attend,points_plus:a.points_plus||0,points_minus:a.points_minus||0};Gl.value=s,Vl.notify({message:"Session initialized",color:"positive",position:"top"}),await to()}}catch(e){console.error("Failed to init classroom session:",e),ss.value={message:"Initialization failed",created:0,skipped:0},Vl.notify({message:"Failed to init session: "+(e.message||"error"),color:"negative",position:"top"})}finally{Kl.value=!1}}}async function Zs(){await Ks(Ql.value),Ql.value=null}async function Ks(e){if(Wl.value.length&&e)try{Xl.value=!0;const a=await ce.applyBehaviorToStudents(Wl.value,e,{date:ql.value,periodCode:$s.value,classroomId:Ul.value,points_mode:"from_now"===gs.value?"overall":gs.value});if(a.results&&a.results.length>0){a.results.forEach(e=>{if(e.success&&e.data){const a=e.studentId,t=e.data;Gl.value[a]||(Gl.value[a]={points_plus:0,points_minus:0,attend:!0}),Gl.value[a]&&(Gl.value[a].points_plus=t.points_plus,Gl.value[a].points_minus=t.points_minus,void 0!==t.attend&&(Gl.value[a].attend=t.attend,Yl.value[a]=t.attend))}});const t=Tl.value.find(a=>a.id===e);if(t){const e=t.value||t.points||0;e>0&&wl("reward"),e<0&&wl("penalty")}Vl.notify({message:`Applied behavior to ${a.results.length} students`+(a.errors&&a.errors.length?` (${a.errors.length} failed)`:""),color:a.errors&&a.errors.length?"warning":"positive",position:"top"}),await to(),Wl.value=[]}a.errors&&a.errors.length>0&&(console.error("Partial or full failure:",a.errors),0===a.results.length&&Vl.notify({message:a.error||"Failed to apply behavior to selected students",color:"negative",position:"top"}))}catch(a){console.error("Error applying behavior:",a),Vl.notify({message:a.message||"Error applying behavior",color:"negative",position:"top"})}finally{Xl.value=!1}}async function Xs(e,a,t){Yl.value[e]=a,Hl.value[e]=!0,wl("select");try{const t=await ce.updateAttendance(e,a,{date:ql.value,periodCode:$s.value,classroomId:Ul.value});if(!t.success)throw new Error(t.error||"Failed to update attendance");Vl.notify({message:t.message||"Attendance updated",color:"positive",position:"top"}),!1===a&&await Js()}catch(l){console.error("Failed to persist attendance for",e,l),Yl.value[e]=t,Vl.notify({message:"Failed to update attendance. Reverted.",color:"negative",position:"top"})}finally{Hl.value[e]=!1}}async function eo(){es.value=!0;const e={};for(const t of Fl.value)e[t.id]=!0,Yl.value[t.id]=!0;try{(await ce.batchUpdateAttendance(e,{date:ql.value,periodCode:$s.value,classroomId:Ul.value})).success&&Vl.notify({message:"All students marked present",color:"positive",position:"top"})}catch(a){console.error("Failed to mark all present:",a),Vl.notify({message:"Failed to mark all present",color:"negative",position:"top"})}finally{es.value=!1}}async function ao(){es.value=!0;const e={};for(const t of Fl.value)e[t.id]=!1,Yl.value[t.id]=!1;try{(await ce.batchUpdateAttendance(e,{date:ql.value,periodCode:$s.value,classroomId:Ul.value})).success&&Vl.notify({message:"All students marked absent",color:"warning",position:"top"})}catch(a){console.error("Failed to mark all absent:",a),Vl.notify({message:"Failed to mark all absent",color:"negative",position:"top"})}finally{es.value=!1}}async function to(){as.value=!0;try{const e=await ce.getRecentActions({classroomId:Ul.value,date:ql.value,limit:10});e.success?Jl.value=e.data:console.error("Failed to load history:",e.error)}catch(e){console.error("Error loading history:",e)}finally{as.value=!1}}function lo(e){if(!e)return"";return new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function so(){localStorage.setItem("points-display-mode",gs.value),fs.value?localStorage.setItem("competition-start-time",fs.value):localStorage.removeItem("competition-start-time"),ys.value&&localStorage.setItem("custom-date-from",ys.value),hs.value&&localStorage.setItem("custom-date-to",hs.value),localStorage.setItem("leaderboard-mode",xs.value),ps.value=!1,Ul.value&&Js(),Vl.notify({message:"Points display settings applied",color:"positive",position:"top",icon:"check_circle"})}function oo(){gs.value="overall",fs.value=null,ys.value=null,hs.value=null,xs.value="top5",localStorage.removeItem("points-display-mode"),localStorage.removeItem("competition-start-time"),localStorage.removeItem("custom-date-from"),localStorage.removeItem("custom-date-to"),localStorage.removeItem("leaderboard-mode"),ps.value=!1,Ul.value&&Js(),Vl.notify({message:"Reset to normal view",color:"info",position:"top"})}async function no(e){console.log("Incident recorded:",e),await Js(),Vl.notify({message:"Behavior incident recorded (-1 point)",color:"warning",position:"top"})}return F(gs,e=>{if("from_now"===e){const e={};for(const[a,t]of Object.entries(Gl.value))e[a]={plus:t.points_plus||0,minus:t.points_minus||0};bs.value=e}else Js()}),D(async()=>{var e,a;if(os.value)console.log("‚è≠Ô∏è Skipping re-initialization - component already initialized");else try{console.log("üöÄ Initializing reward system...");const l=await P.get("/my_classes_with_students");Dl.value=l.data,console.log(`‚úÖ Loaded ${Dl.value.length} classrooms`);let s=!1;if(ie.classroomId&&ie.subjectId){console.log("üéØ Props detected (dialog mode) - auto-initializing..."),Ul.value=ie.classroomId,Rl.value=ie.subjectId;try{const t=null==(a=null==(e=T().props.auth)?void 0:e.school)?void 0:a.active_semester_id;t?(Nl.value=parseInt(t),console.log(`üè´ Active Semester from Inertia: ${Nl.value}`)):Nl.value=1}catch(t){console.warn("Could not fetch active semester, defaulting to 1",t),Nl.value=1}ie.date?ql.value=ie.date:ql.value=(new Date).toISOString().split("T")[0];const l=new Date(ql.value);Ll.value=l.getDay()+1,ie.period&&(Ol.value=ie.period),ie.week&&(Bl.value=ie.week,console.log(`üìÖ Props Week: ${ie.week}`)),s=!0,console.log(`üìö Props Subject: ${ie.subjectId}`),console.log(`üè´ Props Classroom: ${ie.classroomId}`),console.log(`üìÖ Props Date: ${ql.value}`),console.log(`‚ö° Calc Day: ${Ll.value}`),console.log(`üî¢ Props Period: ${ie.period}`)}else{const e=new URLSearchParams(window.location.search),a=e.get("classroom_id"),t=e.get("subject_id"),l=e.get("period"),o=e.get("date");if(a&&t)console.log("üîó URL parameters detected - auto-initializing..."),Ul.value=parseInt(a),Rl.value=parseInt(t),ql.value=o||(new Date).toISOString().split("T")[0],l&&(Ol.value=parseInt(l)),s=!0,console.log(`üìö URL Subject: ${t}`),console.log(`üè´ URL Classroom: ${a}`),console.log(`üìÖ URL Date: ${ql.value}`),console.log(`üî¢ URL Period: ${l}`);else{const e=localStorage.getItem("reward-system-selected-subject-id"),a=localStorage.getItem("reward-system-selected-classroom-id");e&&Cl.value.some(a=>a.id===parseInt(e))?(Rl.value=parseInt(e),console.log(`üìö Restored subject from localStorage: ${e}`)):Cl.value.length>0&&(Rl.value=Cl.value[0].id,console.log(`üìö Auto-selected first subject: ${Cl.value[0].name}`)),a&&Dl.value.some(e=>e.classroom_id===parseInt(a))&&(Ul.value=parseInt(a),console.log(`üè´ Restored classroom from localStorage: ${a}`));const t=localStorage.getItem("reward-system-active-tab");t&&(zl.value=t);const l=localStorage.getItem("reward-system-selected-semester"),s=localStorage.getItem("reward-system-selected-week"),o=localStorage.getItem("reward-system-selected-day"),n=localStorage.getItem("reward-system-selected-period-number");l&&(Nl.value=parseInt(l),console.log(`üìÖ Restored semester from localStorage: ${l}`)),s&&(Bl.value=parseInt(s),console.log(`üìÖ Restored week from localStorage: ${s}`)),o&&(Ll.value=parseInt(o),console.log(`üìÖ Restored day from localStorage: ${o}`)),n&&(Ol.value=parseInt(n),console.log(`üìÖ Restored period number from localStorage: ${n}`))}}console.log(`üî¢ Active Period Code: ${Nl.value}.${Bl.value}.${Ll.value}.${Ol.value}`);const o=await ce.fetchBehaviors();o.success?(Tl.value=o.data,console.log(`‚úÖ Loaded ${Tl.value.length} behaviors`),console.log("üìã Behaviors data:",Tl.value),Tl.value=Tl.value.map(e=>({...e,value:e.value||e.points||0})),console.log("üìã Normalized behaviors:",Tl.value)):(console.error("‚ùå Failed to load behaviors:",o.error),Vl.notify({message:"Failed to load behaviors: "+o.error,color:"negative",position:"top"})),console.log("‚úÖ Reward system initialized"),os.value=!0,s&&Ul.value&&(console.log("üöÄ Auto-initializing classroom session..."),await Hs(Ul.value),await Js(),Vl.notify({message:ie.isDialog?"Session loaded!":"Session loaded from schedule!",color:"positive",position:"top",icon:"stars"}))}catch(l){console.error("‚ùå Failed to initialize reward system:",l),Vl.notify({message:"Failed to initialize reward system: "+l.message,color:"negative",position:"top"})}}),(a,y)=>{const z=R("Head");return N(),q(J,null,[B(z,{title:"Reward System"}),L("div",pe,[y[67]||(y[67]=L("div",{class:"p-1 scale-25"},null,-1)),e.isDialog?M("",!0):(N(),O(r,{key:0,class:"shadow-lg rounded-2xl overflow-hidden"},{default:Q(()=>[B(t,{class:"bg-gradient-to-r from-blue-500 to-indigo-600 text-white flex justify-between items-center"},{default:Q(()=>[L("div",null,[L("h1",ge,"üèÜ "+W(a.$t("rewardSys.behaviors.management")),1),L("p",be,W(a.$t("rewardSys.behaviors.management")),1)]),B(S,{modelValue:G(Sl),"onUpdate:modelValue":y[0]||(y[0]=e=>Y(Sl)?Sl.value=e:null),options:[{label:"üá¨üáß English",value:"en"},{label:"üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©",value:"ar"}],flat:"",color:"white","text-color":"white","toggle-color":"white","toggle-text-color":"primary",unelevated:""},null,8,["modelValue"])]),_:1}),B(t,{class:"p-6 space-y-4"},{default:Q(()=>{var e;return[L("div",fe,[L("div",ye,[L("div",he,[B(l,{name:"event_note",size:"md"})]),L("div",null,[L("div",xe,W(a.$t("rewardSys.session.current")),1),L("div",we,[Ul.value?(N(),q("span",_e,W((null==(e=Dl.value.find(e=>e.classroom_id===Ul.value))?void 0:e.classroom_name)||a.$t("rewardSys.session.unknownClass")),1)):(N(),q("span",Se,W(a.$t("rewardSys.session.noClassroom")),1)),y[43]||(y[43]=L("span",{class:"text-gray-300"},"|",-1)),L("span",ke,W($s.value),1)]),L("div",$e,W(new Date(ql.value).toLocaleDateString())+" ‚Ä¢ Period "+W(Ol.value),1)])])]),Ul.value?(N(),q("div",Ie,[L("div",Ce,[L("div",je,[B(l,{name:"groups",class:"text-blue-600",size:"sm"}),L("span",Ae,W(a.$t("rewardSys.session.classroomSummary")),1)]),L("div",Ve,[B(s,{modelValue:ns.value,"onUpdate:modelValue":y[1]||(y[1]=e=>ns.value=e),icon:"edit",label:"Edit Avatars",dense:"",color:"secondary",size:"sm",class:"bg-white px-2 py-1 rounded-lg border border-gray-200"},null,8,["modelValue"]),ss.value.message?(N(),q("div",ze,W(ss.value.message)+" ("+W(ss.value.created)+") ",1)):M("",!0),L("div",Pe,[B(l,{name:"people",class:"text-blue-600",size:"sm"}),L("div",Ee,[L("span",De,W(a.$t("rewardSys.session.total")),1),L("span",Fe,W(Fl.value.length),1)])]),L("div",Te,[B(l,{name:"check_circle",class:"text-green-600",size:"sm"}),L("div",Ue,[L("span",Re,W(a.$t("rewardSys.session.present")),1),L("span",qe,W(jl.value.present),1)])]),L("div",Ne,[B(l,{name:"cancel",class:"text-red-600",size:"sm"}),L("div",Be,[L("span",Le,W(a.$t("rewardSys.session.absent")),1),L("span",Oe,W(jl.value.absent),1)])]),B(o,{dense:"",color:"primary",icon:"content_copy",label:a.$t("rewardSys.session.copyList"),onClick:Al,disable:0===jl.value.absent,size:"sm",class:"shadow-sm"},{default:Q(()=>[B(n,null,{default:Q(()=>[H(W(a.$t("rewardSys.session.copyToClipboard")),1)]),_:1})]),_:1},8,["label","disable"])])]),jl.value.absent>0?(N(),q("div",Me,[L("div",Qe,[B(l,{name:"person_off",size:"xs",color:"red"}),L("span",null,W(a.$t("rewardSys.session.absentStudentsList")),1),B(k,{color:"red",label:jl.value.absent,class:"ml-1"},null,8,["label"])]),L("div",We,[L("div",Ge,[(N(!0),q(J,null,Z(jl.value.absentList,e=>(N(),O(h,{key:e.id,color:"red","text-color":"white",size:"sm",dense:"",icon:"person"},{default:Q(()=>[H(W("ar"===G(Sl)&&e.name_ar?e.name_ar:e.name),1)]),_:2},1024))),128))])])])):M("",!0)])):M("",!0)]}),_:1})]),_:1})),L("audio",{ref_key:"bgMusic",ref:hl,loop:"",id:"bg-music"},y[44]||(y[44]=[L("source",{src:"/audio/background_music2.mp3",type:"audio/mpeg"},null,-1)]),512),Fl.value.length?(N(),O(r,{key:1,class:"shadow-lg rounded-2xl"},{default:Q(()=>[L("div",Ye,[L("div",He,[L("div",Je,[B(v,{color:"primary",icon:"menu",label:G(Vl).screen.gt.xs?"Menu":"",class:"shadow-sm glossy","content-class":"bg-white",dense:""},{default:Q(()=>[L("div",Ze,[L("div",{class:"column",style:K(G(Vl).screen.lt.sm?"min-width: 250px":"min-width: 220px")},[y[51]||(y[51]=L("div",{class:"text-subtitle1 text-weight-bold q-mb-sm text-grey-8"},"Navigation",-1)),B(i,{dense:""},{default:Q(()=>[X((N(),O(d,{clickable:"",onClick:y[2]||(y[2]=e=>zl.value="positive"),active:"positive"===zl.value,"active-class":"bg-blue-50 text-primary"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"add_circle"})]),_:1}),B(u,null,{default:Q(()=>[H(W(a.$t("rewardSys.tabs.positivePoints")),1)]),_:1})]),_:1},8,["active"])),[[x]]),X((N(),O(d,{clickable:"",onClick:y[3]||(y[3]=e=>zl.value="attendance"),active:"attendance"===zl.value,"active-class":"bg-blue-50 text-primary"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"how_to_reg"})]),_:1}),B(u,null,{default:Q(()=>[H(W(a.$t("rewardSys.tabs.attendance")),1)]),_:1})]),_:1},8,["active"])),[[x]]),X((N(),O(d,{clickable:"",onClick:y[4]||(y[4]=e=>zl.value="history"),active:"history"===zl.value,"active-class":"bg-blue-50 text-primary"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"cancel"})]),_:1}),B(u,null,{default:Q(()=>[H(W(a.$t("rewardSys.tabs.history")),1)]),_:1})]),_:1},8,["active"])),[[x]]),X((N(),O(d,{clickable:"",onClick:y[5]||(y[5]=e=>{Zl.value=!0,zl.value="champions"}),active:"champions"===zl.value,"active-class":"bg-blue-50 text-primary"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"emoji_events"})]),_:1}),B(u,null,{default:Q(()=>[H(W(a.$t("rewardSys.tabs.champions")),1)]),_:1})]),_:1},8,["active"])),[[x]]),X((N(),O(d,{clickable:"",onClick:y[6]||(y[6]=e=>zl.value="settings_reports"),active:"settings_reports"===zl.value,"active-class":"bg-blue-50 text-primary"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"settings_applications"})]),_:1}),B(u,null,{default:Q(()=>[H(W(a.$t("rewardSys.tabs.settingsReports")),1)]),_:1})]),_:1},8,["active"])),[[x]])]),_:1}),B(c,{class:"q-my-md"}),y[52]||(y[52]=L("div",{class:"text-subtitle2 text-grey-7 q-mb-xs"},"Points Filter",-1)),B(i,{dense:""},{default:Q(()=>[X((N(),O(d,{clickable:"",onClick:y[7]||(y[7]=e=>gs.value="overall"),active:"overall"===gs.value,"active-class":"text-orange-9 text-weight-bold"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"functions",size:"xs"})]),_:1}),B(u,null,{default:Q(()=>y[45]||(y[45]=[H("Overall (All Time)")])),_:1}),"overall"===gs.value?(N(),O(u,{key:0,side:""},{default:Q(()=>[B(l,{name:"check",size:"xs",color:"orange"})]),_:1})):M("",!0)]),_:1},8,["active"])),[[x]]),X((N(),O(d,{clickable:"",onClick:y[8]||(y[8]=e=>gs.value="all_subjects"),active:"all_subjects"===gs.value,"active-class":"text-orange-9 text-weight-bold"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"public",size:"xs"})]),_:1}),B(u,null,{default:Q(()=>y[46]||(y[46]=[H("Overall (All Subjects)")])),_:1}),"all_subjects"===gs.value?(N(),O(u,{key:0,side:""},{default:Q(()=>[B(l,{name:"check",size:"xs",color:"orange"})]),_:1})):M("",!0)]),_:1},8,["active"])),[[x]]),X((N(),O(d,{clickable:"",onClick:y[9]||(y[9]=e=>gs.value="session"),active:"session"===gs.value,"active-class":"text-orange-9 text-weight-bold"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"timer",size:"xs"})]),_:1}),B(u,null,{default:Q(()=>y[47]||(y[47]=[H("This Session")])),_:1}),"session"===gs.value?(N(),O(u,{key:0,side:""},{default:Q(()=>[B(l,{name:"check",size:"xs",color:"orange"})]),_:1})):M("",!0)]),_:1},8,["active"])),[[x]]),X((N(),O(d,{clickable:"",onClick:y[10]||(y[10]=e=>gs.value="competition"),active:"competition"===gs.value,"active-class":"text-orange-9 text-weight-bold"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"date_range",size:"xs"})]),_:1}),B(u,null,{default:Q(()=>y[48]||(y[48]=[H("Competition (Week)")])),_:1}),"competition"===gs.value?(N(),O(u,{key:0,side:""},{default:Q(()=>[B(l,{name:"check",size:"xs",color:"orange"})]),_:1})):M("",!0)]),_:1},8,["active"])),[[x]]),X((N(),O(d,{clickable:"",onClick:y[11]||(y[11]=e=>gs.value="from_now"),active:"from_now"===gs.value,"active-class":"text-orange-9 text-weight-bold"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"restart_alt",size:"xs"})]),_:1}),B(u,null,{default:Q(()=>y[49]||(y[49]=[H("From Now (Reset View)")])),_:1}),"from_now"===gs.value?(N(),O(u,{key:0,side:""},{default:Q(()=>[B(l,{name:"check",size:"xs",color:"orange"})]),_:1})):M("",!0)]),_:1},8,["active"])),[[x]])]),_:1}),B(c,{class:"q-my-md"}),y[53]||(y[53]=L("div",{class:"text-subtitle2 text-grey-7 q-mb-xs"},"Layout",-1)),B(i,{dense:""},{default:Q(()=>[(N(!0),q(J,null,Z(Ts.value,e=>X((N(),O(d,{clickable:"",key:e.value,onClick:a=>us.value=e.value,active:us.value===e.value,"active-class":"text-orange-9 text-weight-bold"},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:e.icon,size:"xs"},null,8,["name"])]),_:2},1024),B(u,null,{default:Q(()=>[H(W(e.label),1)]),_:2},1024),us.value===e.value?(N(),O(u,{key:0,side:""},{default:Q(()=>[B(l,{name:"check",size:"xs",color:"orange"})]),_:1})):M("",!0)]),_:2},1032,["onClick","active"])),[[x]])),128)),B(c,{class:"q-my-xs"}),X((N(),O(d,{clickable:"",onClick:y[12]||(y[12]=e=>vs.value=!0)},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(l,{name:"settings",size:"xs",class:"text-grey-7"})]),_:1}),B(u,{class:"text-grey-8"},{default:Q(()=>[H(W(a.$t("rewardSys.manageGroups")),1)]),_:1})]),_:1})),[[x]])]),_:1}),G(Vl).screen.lt.sm?(N(),q("div",Ke,[B(c,{class:"q-my-md"}),y[50]||(y[50]=L("div",{class:"text-subtitle1 text-weight-bold q-mb-md text-grey-8"},"Settings",-1)),B(s,{modelValue:xl.value,"onUpdate:modelValue":y[13]||(y[13]=e=>xl.value=e),"checked-icon":"music_note","unchecked-icon":"music_off",label:"Music On",color:"primary",dense:""},null,8,["modelValue"]),B(s,{modelValue:ns.value,"onUpdate:modelValue":y[14]||(y[14]=e=>ns.value=e),icon:"edit",label:"Edit Avatars",color:"secondary",dense:""},null,8,["modelValue"])])):M("",!0)],4),G(Vl).screen.gt.xs?(N(),O(c,{key:0,vertical:"",inset:"",class:"q-mx-lg"})):M("",!0),G(Vl).screen.gt.xs?(N(),q("div",Xe,[y[54]||(y[54]=L("div",{class:"text-subtitle1 text-weight-bold q-mb-md text-grey-8"},"Settings",-1)),L("div",ea,[B(s,{modelValue:xl.value,"onUpdate:modelValue":y[15]||(y[15]=e=>xl.value=e),"checked-icon":"music_note","unchecked-icon":"music_off",label:"Music On",color:"primary",dense:""},null,8,["modelValue"]),B(s,{modelValue:ns.value,"onUpdate:modelValue":y[16]||(y[16]=e=>ns.value=e),icon:"edit",label:"Edit Avatars",color:"secondary",dense:""},null,8,["modelValue"])]),B(c,{class:"q-my-md full-width"}),L("div",aa,[B(re,{class:"scale-90 transform-origin-center"})])])):M("",!0)])]),_:1},8,["label"]),"positive"!==zl.value||G(Vl).screen.gt.xs?(N(),q("div",ta,[B(k,{color:"blue-1","text-color":"blue-9",class:"q-py-xs q-px-sm text-subtitle2 whitespace-nowrap"},{default:Q(()=>[H(W("positive"===zl.value?a.$t("rewardSys.tabs.positivePoints"):"attendance"===zl.value?a.$t("rewardSys.tabs.attendance"):"history"===zl.value?a.$t("rewardSys.tabs.history"):"champions"===zl.value?a.$t("rewardSys.tabs.champions"):a.$t("rewardSys.tabs.settingsReports")),1)]),_:1})])):M("",!0)]),L("div",la,[B(v,{color:"primary",icon:"stars",label:G(Vl).screen.gt.xs?"Give Feedback":"",disable:0===Wl.value.length,class:"shadow-sm glossy","content-class":"rounded-xl",dense:""},{default:Q(()=>[L("div",sa,[B(I,{modelValue:Pl.value,"onUpdate:modelValue":y[17]||(y[17]=e=>Pl.value=e),class:"text-grey-7 bg-grey-1","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":"",dense:""},{default:Q(()=>[B($,{name:"positive",icon:"thumb_up",label:"Positive",class:"text-weight-bold"}),B($,{name:"needs_work",icon:"warning",label:"Needs Work",class:"text-weight-bold"})]),_:1},8,["modelValue"]),B(c),B(j,{modelValue:Pl.value,"onUpdate:modelValue":y[18]||(y[18]=e=>Pl.value=e),animated:"",class:"bg-white",style:{"max-height":"400px","overflow-y":"auto"}},{default:Q(()=>[B(C,{name:"positive",class:"q-pa-md"},{default:Q(()=>[L("div",oa,[(N(!0),q(J,null,Z(Ds.value,e=>(N(),q("div",{class:"col-4 cursor-pointer",key:e.id,onClick:a=>Ks(e.id)},[X((N(),q("div",ra,[B(l,{name:e.icon||"star",size:"2em",class:"q-mb-xs text-orange"},null,8,["name"]),L("div",ia,W(e.name),1),L("div",da,[B(k,{color:"green-1","text-color":"green-9",class:"text-xs font-bold border border-green-200 shadow-sm rounded-full px-1.5"},{default:Q(()=>[H("+"+W(e.points||e.value),1)]),_:2},1024)])])),[[x]])],8,na))),128))])]),_:1}),B(C,{name:"needs_work",class:"q-pa-md"},{default:Q(()=>[L("div",ua,[(N(!0),q(J,null,Z(Fs.value,e=>(N(),q("div",{class:"col-4 cursor-pointer",key:e.id,onClick:a=>Ks(e.id)},[X((N(),q("div",va,[B(l,{name:e.icon||"warning",size:"2em",class:"q-mb-xs text-red"},null,8,["name"]),L("div",ma,W(e.name),1),L("div",pa,[B(k,{color:"red-1","text-color":"red-9",class:"text-xs font-bold border border-red-200 shadow-sm rounded-full px-1.5"},{default:Q(()=>[H(W(e.points||e.value),1)]),_:2},1024)])])),[[x]])],8,ca))),128))])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["label","disable"])])])]),"positive"===zl.value&&"session"!==gs.value?(N(),q("div",ga," Viewing: "+W("overall"===gs.value?"Overall (All Time)":"all_subjects"===gs.value?"Overall (All Subjects)":"from_now"===gs.value?"From Now (Temporary)":"Competition (Week)"),1)):M("",!0),B(c),B(j,{modelValue:zl.value,"onUpdate:modelValue":y[26]||(y[26]=e=>zl.value=e),animated:""},{default:Q(()=>[B(C,{name:"attendance"},{default:Q(()=>[L("div",ba,[L("div",fa,[L("h3",ya,W(a.$t("rewardSys.attendance.manage")),1),L("div",ha,[B(o,{color:"positive",label:a.$t("rewardSys.attendance.markAllPresent"),onClick:eo,loading:es.value},null,8,["label","loading"]),B(o,{color:"warning",label:a.$t("rewardSys.attendance.markAllAbsent"),onClick:ao,loading:es.value},null,8,["label","loading"])])]),L("div",xa,[(N(!0),q(J,null,Z(Fl.value,e=>{var a,t,l,s;return N(),O(ne,{key:e.id,student:e,"disable-behavior":!Yl.value[e.id],"allow-disabled-click":!0,"avatar-edit-enabled":ns.value,"student-summary":{positive:((null==(a=Gl.value[e.id])?void 0:a.points_plus)||0)-("from_now"===gs.value&&bs.value[e.id]?bs.value[e.id].plus:0),negative:((null==(t=Gl.value[e.id])?void 0:t.points_minus)||0)-("from_now"===gs.value&&bs.value[e.id]?bs.value[e.id].minus:0),total:((null==(l=Gl.value[e.id])?void 0:l.points_plus)||0)-("from_now"===gs.value&&bs.value[e.id]?bs.value[e.id].plus:0)-(((null==(s=Gl.value[e.id])?void 0:s.points_minus)||0)-("from_now"===gs.value&&bs.value[e.id]?bs.value[e.id].minus:0))},onSelect:a=>async function(e){const a=void 0===Yl.value[e]||Yl.value[e],t=!a;if(!1===t){const l=Gl.value[e];if(l&&(l.points_plus>0||l.points_minus>0))return void Vl.dialog({title:"Warning",message:`This student has ${l.points_plus} positive and ${l.points_minus} negative points for this session. Marking them absent will remove all their points for this session. Continue?`,cancel:!0,persistent:!0,ok:{label:"Yes, Mark Absent",color:"negative"},cancel:{label:"Cancel",color:"grey"}}).onOk(async()=>{await Xs(e,t,a)})}await Xs(e,t,a)}(e.id)},null,8,["student","disable-behavior","avatar-edit-enabled","student-summary","onSelect"])}),128))])])]),_:1}),B(C,{name:"positive"},{default:Q(()=>[L("div",wa,[L("div",_a,[L("div",Sa,[L("div",ka,[L("div",$a,[B(l,{name:"checklist",class:"text-blue-600",size:"sm"}),L("span",Ia,W(a.$t("rewardSys.selected"))+": ",1),B(k,{label:Wl.value.length,color:"blue",class:"text-lg"},null,8,["label"])]),L("div",Ca,[B(o,{flat:"",dense:"",color:"primary",label:a.$t("rewardSys.selection.all"),size:"sm",onClick:Rs,icon:"check_box",class:"bg-blue-100/50"},null,8,["label"]),B(o,{flat:"",dense:"",color:"primary",label:a.$t("rewardSys.selection.inv"),size:"sm",onClick:qs,icon:"swap_vert",class:"bg-blue-100/50"},null,8,["label"]),B(o,{flat:"",dense:"",color:"negative",label:a.$t("rewardSys.selection.clear"),size:"sm",onClick:Ys,icon:"clear",class:"bg-red-100/50"},null,8,["label"]),B(o,{flat:"",dense:"",color:"negative",label:a.$t("rewardSys.selection.clear"),size:"sm",onClick:Ys,icon:"clear",class:"bg-red-100/50"},null,8,["label"]),(N(),O(ee,{to:"#dialog-header-actions"},[L("div",ja,[B(o,{rounded:"",dense:"","no-caps":"",color:"positive",class:"px-3 shadow-sm",onClick:y[19]||(y[19]=e=>zs("present"))},{default:Q(()=>[B(l,{name:"check_circle",class:"mr-1",size:"xs"}),L("span",Aa,W(Is.value),1)]),_:1}),B(o,{rounded:"",dense:"","no-caps":"",color:"negative",class:"px-3 shadow-sm",onClick:y[20]||(y[20]=e=>zs("absent"))},{default:Q(()=>[B(l,{name:"cancel",class:"mr-1",size:"xs"}),L("span",Va,W(Cs.value),1)]),_:1})])])),B(c,{vertical:"",inset:"",class:"mx-2"}),B(m,{modelValue:js.value,"onUpdate:modelValue":y[21]||(y[21]=e=>js.value=e)},{default:Q(()=>[B(r,{style:{"min-width":"350px"}},{default:Q(()=>[B(t,{class:"row items-center"},{default:Q(()=>[L("div",za,[H(W("present"===As.value?"Present Students":"Absent Students")+" ",1),B(k,{color:"present"===As.value?"positive":"negative",class:"ml-2"},{default:Q(()=>[H(W(Vs.value.length),1)]),_:1},8,["color"])]),B(A),X(B(o,{icon:"close",flat:"",round:"",dense:""},null,512),[[x]])]),_:1}),B(t,{class:"q-pt-none",style:{"max-height":"50vh","overflow-y":"auto"}},{default:Q(()=>[0===Vs.value.length?(N(),q("div",Pa," No students found. ")):(N(),O(i,{key:1,bordered:"",separator:"",class:"rounded-lg"},{default:Q(()=>[(N(!0),q(J,null,Z(Vs.value,e=>(N(),O(d,{key:e.id},{default:Q(()=>[B(u,{avatar:""},{default:Q(()=>[B(w,{size:"sm"},{default:Q(()=>[L("img",{src:Es(e)},null,8,Ea)]),_:2},1024)]),_:2},1024),B(u,null,{default:Q(()=>[H(W(e.name),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1}),B(p,{align:"right",class:"bg-gray-50"},{default:Q(()=>[X(B(o,{flat:"",label:"Close",color:"primary"},null,512),[[x]]),B(o,{label:"Copy List",color:"primary",icon:"content_copy",onClick:Ps,disable:0===Vs.value.length},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])])]),(N(!0),q(J,null,Z(Us.value,(e,t)=>(N(),q("div",{key:t,class:"mb-6 bg-gray-400"},[e.name?(N(),q("div",Da,[L("div",Fa,[L("h4",Ta,[B(l,{name:"groups"}),H(" "+W(e.name)+" ",1),B(k,{label:e.students.length,color:"indigo"},null,8,["label"])]),L("div",Ua,[B(o,{dense:"",size:"sm",color:"indigo",icon:"check_box",label:a.$t("rewardSys.selection.all"),onClick:a=>Gs(e.students,!0),outline:""},null,8,["label","onClick"]),B(o,{dense:"",size:"sm",color:"grey",icon:"check_box_outline_blank",label:a.$t("rewardSys.selection.clear"),onClick:a=>Gs(e.students,!1),outline:""},null,8,["label","onClick"])])])])):M("",!0),L("div",Ra,[(N(!0),q(J,null,Z(e.students,e=>{var a,t,l,s;return N(),O(ne,{key:e.id,student:e,selected:Wl.value.includes(e.id),"selected-id":Wl.value.includes(e.id)?e.id:null,"disable-behavior":!Yl.value[e.id],"is-absent":!Yl.value[e.id],"allow-disabled-click":!1,"avatar-edit-enabled":ns.value,"student-summary":{positive:((null==(a=Gl.value[e.id])?void 0:a.points_plus)||0)-("from_now"===gs.value&&bs.value[e.id]?bs.value[e.id].plus:0),negative:((null==(t=Gl.value[e.id])?void 0:t.points_minus)||0)-("from_now"===gs.value&&bs.value[e.id]?bs.value[e.id].minus:0),total:((null==(l=Gl.value[e.id])?void 0:l.points_plus)||0)-("from_now"===gs.value&&bs.value[e.id]?bs.value[e.id].plus:0)-(((null==(s=Gl.value[e.id])?void 0:s.points_minus)||0)-("from_now"===gs.value&&bs.value[e.id]?bs.value[e.id].minus:0))},onSelect:a=>Ws(e.id)},null,8,["student","selected","selected-id","disable-behavior","is-absent","avatar-edit-enabled","student-summary","onSelect"])}),128))])]))),128))])])]),_:1}),B(C,{name:"negative"},{default:Q(()=>[L("div",qa,[L("div",Na,[L("h3",Ba,W(a.$t("rewardSys.points.deduct")),1),L("p",La,W(a.$t("rewardSys.points.selectStudentsNegative")),1)]),L("div",Oa,[L("div",Ma,[B(V,{modelValue:Ql.value,"onUpdate:modelValue":y[22]||(y[22]=e=>Ql.value=e),options:Fs.value,"option-value":"id","option-label":"name",outlined:"",dense:"",placeholder:a.$t("rewardSys.points.selectNegativeBehavior"),"emit-value":"","map-options":""},{option:Q(e=>[B(d,ae(te(e.itemProps)),{default:Q(()=>[B(u,null,{default:Q(()=>[B(g,null,{default:Q(()=>[H(W(kl(e.opt)),1)]),_:2},1024),B(g,{caption:""},{default:Q(()=>[H(W(e.opt.value||e.opt.points||0)+" points",1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","placeholder"]),B(o,{color:"negative",icon:"remove_circle",label:a.$t("rewardSys.points.applyToSelected"),onClick:Zs,disable:!Wl.value.length||!Ql.value,loading:Xl.value},null,8,["label","disable","loading"])]),L("div",Qa,[y[55]||(y[55]=H("Selected: ")),L("strong",null,W(Wl.value.length),1),y[56]||(y[56]=H(" students"))])]),L("div",Wa,[(N(!0),q(J,null,Z(Fl.value,e=>{var a,t,l,s;return N(),O(ne,{key:e.id,student:e,selected:Wl.value.includes(e.id),"selected-id":Wl.value.includes(e.id)?e.id:null,"disable-behavior":!Yl.value[e.id],"allow-disabled-click":!1,"avatar-edit-enabled":ns.value,"student-summary":{positive:(null==(a=Gl.value[e.id])?void 0:a.points_plus)||0,negative:(null==(t=Gl.value[e.id])?void 0:t.points_minus)||0,total:((null==(l=Gl.value[e.id])?void 0:l.points_plus)||0)-((null==(s=Gl.value[e.id])?void 0:s.points_minus)||0)},onSelect:a=>Ws(e.id)},null,8,["student","selected","selected-id","disable-behavior","avatar-edit-enabled","student-summary","onSelect"])}),128))])])]),_:1}),B(C,{name:"old_card"},{default:Q(()=>[L("div",Ga,[y[60]||(y[60]=L("h3",{class:"text-xl font-bold mb-4"},"Old Card View",-1)),L("div",Ya,[(N(!0),q(J,null,Z(Fl.value,e=>{var a,t,l,s;return N(),q("div",{key:e.id,class:se(["p-4 border-2 rounded-lg transition",[Yl.value[e.id]?Wl.value.includes(e.id)?"bg-green-100 border-green-500 cursor-pointer":"bg-white border-gray-200 cursor-pointer":"bg-gray-100 border-gray-300 opacity-50 cursor-not-allowed"]]),onClick:a=>Yl.value[e.id]&&Ws(e.id)},[L("div",Ja,[L("div",Za,[L("p",Ka,W(e.name),1),L("p",Xa,"ID: "+W(e.id),1),Yl.value[e.id]?M("",!0):(N(),q("p",et,"‚ùå Absent"))]),B(_,{"model-value":Wl.value.includes(e.id),"onUpdate:modelValue":a=>Ws(e.id),disable:!Yl.value[e.id],color:"positive",size:"lg"},null,8,["model-value","onUpdate:modelValue","disable"])]),L("div",at,[L("div",tt,[y[57]||(y[57]=L("span",{class:"text-xs font-semibold text-green-800"},"Positive",-1)),L("span",lt,"+"+W((null==(a=Gl.value[e.id])?void 0:a.points_plus)||0)+" ‚≠ê",1)]),L("div",st,[y[58]||(y[58]=L("span",{class:"text-xs font-semibold text-red-800"},"Negative",-1)),L("span",ot,"-"+W((null==(t=Gl.value[e.id])?void 0:t.points_minus)||0)+" ‚ö†Ô∏è",1)]),L("div",nt,[y[59]||(y[59]=L("span",{class:"text-xs font-semibold text-blue-800"},"Total",-1)),L("span",rt,W(((null==(l=Gl.value[e.id])?void 0:l.points_plus)||0)-((null==(s=Gl.value[e.id])?void 0:s.points_minus)||0)),1)])])],10,Ha)}),128))])])]),_:1}),B(C,{name:"history"},{default:Q(()=>[L("div",it,[L("div",dt,[L("h3",ut,W(a.$t("rewardSys.history.title")),1),B(o,{color:"primary",icon:"refresh",label:a.$t("rewardSys.history.refresh"),onClick:to,loading:as.value},null,8,["label","loading"])]),Jl.value.length?M("",!0):(N(),q("div",ct,[L("p",vt,W(a.$t("rewardSys.history.empty")),1)])),(N(!0),q(J,null,Z(Jl.value,e=>{var t,l,s;return N(),q("div",{key:e.id,class:se(["p-4 bg-white rounded-lg border-l-4",[e.canceled?"border-gray-400 opacity-60":e.value>0?"border-green-500":"border-red-500"]])},[L("div",mt,[L("div",pt,[L("div",gt,[L("span",bt,W((null==(l=null==(t=e.student_behavior)?void 0:t.student)?void 0:l.name)||a.$t("rewardSys.history.unknown")),1),L("span",ft,W(e.value>0?"‚≠ê":"‚ö†Ô∏è"),1)]),L("p",yt,[L("strong",null,W(kl(e.behavior)||a.$t("rewardSys.history.unknownBehavior")),1),L("span",{class:se(e.value>0?"text-green-600":"text-red-600")}," ("+W(e.value>0?"+":"")+W(e.value)+" "+W(a.$t("rewardSys.points.title"))+") ",3)]),L("p",ht,W(lo(e.created_at))+" by "+W((null==(s=e.created_by)?void 0:s.name)||a.$t("rewardSys.history.unknown")),1),e.note?(N(),q("p",xt,W(a.$t("rewardSys.history.note"))+" "+W(e.note),1)):M("",!0),e.canceled?(N(),q("p",wt," ‚ùå "+W(a.$t("rewardSys.history.canceled"))+" "+W(e.cancel_reason)+" ("+W(lo(e.canceled_at))+") ",1)):M("",!0)]),e.canceled?M("",!0):(N(),O(o,{key:0,color:"warning",icon:"undo",label:a.$t("rewardSys.history.undo"),size:"sm",onClick:a=>async function(e){ts.value=e;try{const a=await ce.undoAction(e,"Undone by teacher");a.success?(Vl.notify({message:"Action undone successfully",color:"positive",position:"top"}),await to(),await Js()):Vl.notify({message:a.error||"Failed to undo action",color:"negative",position:"top"})}catch(a){console.error("Error undoing action:",a),Vl.notify({message:"Error undoing action",color:"negative",position:"top"})}finally{ts.value=null}}(e.id),loading:ts.value===e.id},null,8,["label","onClick","loading"]))])],2)}),128))])]),_:1}),B(C,{name:"settings_reports",class:"p-4"},{default:Q(()=>[L("div",_t,[L("div",St,[B(I,{modelValue:El.value,"onUpdate:modelValue":y[23]||(y[23]=e=>El.value=e),align:"left",class:"text-gray-600 bg-gray-50 border-b border-gray-200","active-color":"primary","indicator-color":"primary",dense:""},{default:Q(()=>[B($,{name:"behavior_incidents",icon:"report_problem",label:a.$t("rewardSys.tabs.behaviorIncidents")},null,8,["label"]),B($,{name:"behaviors",icon:"settings",label:a.$t("rewardSys.tabs.behaviors")},null,8,["label"])]),_:1},8,["modelValue"]),B(j,{modelValue:El.value,"onUpdate:modelValue":y[25]||(y[25]=e=>El.value=e),animated:"",class:"bg-transparent"},{default:Q(()=>[B(C,{name:"behavior_incidents"},{default:Q(()=>[B(G(ue),{students:Fl.value,"classroom-id":Ul.value,date:ql.value,"period-code":$s.value,onIncidentRecorded:no},null,8,["students","classroom-id","date","period-code"])]),_:1}),B(C,{name:"behaviors"},{default:Q(()=>[L("div",kt,[L("div",$t,[L("h3",It,W(a.$t("rewardSys.behaviors.management")),1),B(o,{color:"primary",icon:"add",label:a.$t("rewardSys.behaviors.addNew"),onClick:y[24]||(y[24]=e=>Os(null)),size:"md",class:"shadow-md"},null,8,["label"])]),L("div",Ct,[L("div",jt,[B(l,{name:"add_circle",size:"md",color:"positive"}),L("h4",At,W(a.$t("rewardSys.behaviors.positiveSection")),1),B(k,{label:Ds.value.length,color:"positive"},null,8,["label"])]),L("div",Vt,[(N(!0),q(J,null,Z(Ds.value,e=>(N(),q("div",{key:e.id,class:"bg-white rounded-lg p-4 shadow-sm border border-green-100 hover:shadow-md transition-all"},[L("div",zt,[L("div",Pt,[L("div",Et,W(e.icon||"‚≠ê"),1),L("div",null,[L("h5",Dt,W(kl(e)),1),L("p",Ft,"ID: "+W(e.id),1)])]),L("div",Tt,[B(o,{flat:"",round:"",dense:"",icon:"edit",color:"primary",size:"sm",onClick:a=>Os(e)},{default:Q(()=>[B(n,null,{default:Q(()=>y[61]||(y[61]=[H("Edit")])),_:1})]),_:2},1032,["onClick"]),B(o,{flat:"",round:"",dense:"",icon:"delete",color:"negative",size:"sm",onClick:a=>Qs(e)},{default:Q(()=>[B(n,null,{default:Q(()=>y[62]||(y[62]=[H("Delete")])),_:1})]),_:2},1032,["onClick"])])]),L("div",Ut,[y[63]||(y[63]=L("span",{class:"text-sm text-gray-600"},"Points:",-1)),L("span",Rt,"+"+W(e.value||e.points||0),1)])]))),128))]),0===Ds.value.length?(N(),q("div",qt,[B(l,{name:"sentiment_neutral",size:"3rem",class:"mb-2"}),L("p",null,W(a.$t("rewardSys.behaviors.noPositive")),1)])):M("",!0)]),L("div",Nt,[L("div",Bt,[B(l,{name:"remove_circle",size:"md",color:"negative"}),L("h4",Lt,W(a.$t("rewardSys.behaviors.negativeSection")),1),B(k,{label:Fs.value.length,color:"negative"},null,8,["label"])]),L("div",Ot,[(N(!0),q(J,null,Z(Fs.value,e=>(N(),q("div",{key:e.id,class:"bg-white rounded-lg p-4 shadow-sm border border-red-100 hover:shadow-md transition-all"},[L("div",Mt,[L("div",Qt,[L("div",Wt,W(e.icon||"‚ö†Ô∏è"),1),L("div",null,[L("h5",Gt,W(kl(e)),1),L("p",Yt,"ID: "+W(e.id),1)])]),L("div",Ht,[B(o,{flat:"",round:"",dense:"",icon:"edit",color:"primary",size:"sm",onClick:a=>Os(e)},{default:Q(()=>[B(n,null,{default:Q(()=>y[64]||(y[64]=[H("Edit")])),_:1})]),_:2},1032,["onClick"]),B(o,{flat:"",round:"",dense:"",icon:"delete",color:"negative",size:"sm",onClick:a=>Qs(e)},{default:Q(()=>[B(n,null,{default:Q(()=>y[65]||(y[65]=[H("Delete")])),_:1})]),_:2},1032,["onClick"])])]),L("div",Jt,[y[66]||(y[66]=L("span",{class:"text-sm text-gray-600"},"Points:",-1)),L("span",Zt,W(e.value||e.points||0),1)])]))),128))]),0===Fs.value.length?(N(),q("div",Kt,[B(l,{name:"sentiment_neutral",size:"3rem",class:"mb-2"}),L("p",null,W(a.$t("rewardSys.behaviors.noNegative")),1)])):M("",!0)])])]),_:1})]),_:1},8,["modelValue"])])])]),_:1})]),_:1},8,["modelValue"])]),_:1})):M("",!0),Fl.value.length?M("",!0):(N(),O(r,{key:2,class:"shadow-lg rounded-2xl"},{default:Q(()=>[B(t,{class:"text-center py-12"},{default:Q(()=>[L("p",Xt,"üìö "+W(a.$t("rewardSys.messages.selectClassroom")),1)]),_:1})]),_:1})),B(m,{modelValue:Zl.value,"onUpdate:modelValue":y[27]||(y[27]=e=>Zl.value=e),maximized:""},{default:Q(()=>[B(r,null,{default:Q(()=>[B(p,{align:"right"},{default:Q(()=>[X(B(o,{flat:"",label:"Close",color:"primary"},null,512),[[x]])]),_:1}),B(t,{class:"p-0"},{default:Q(()=>[B(G(de),{students:Fl.value,"student-behaviors":Gl.value,"period-code":$s.value,date:ql.value,"school-logo":Il.value},null,8,["students","student-behaviors","period-code","date","school-logo"])]),_:1}),B(p,{align:"right"},{default:Q(()=>[X(B(o,{flat:"",label:"Close",color:"primary"},null,512),[[x]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),B(m,{modelValue:rs.value,"onUpdate:modelValue":y[28]||(y[28]=e=>rs.value=e),"full-width":"",maxWidth:"1000px"},{default:Q(()=>[B(r,{class:"flex flex-col md:flex-row h-[80vh] md:h-[70vh]"},{default:Q(()=>[B(t,{class:"w-full md:w-1/3 bg-blue-50 border-r border-blue-100 flex flex-col p-0"},{default:Q(()=>[L("div",el,[L("h4",al,[B(l,{name:"checklist"}),H(" "+W(a.$t("rewardSys.selected"))+" ("+W(Wl.value.length)+") ",1)])]),L("div",tl,[0===Wl.value.length?(N(),q("div",ll,W(a.$t("rewardSys.messages.clickToSelect")),1)):(N(),q("div",sl,[(N(!0),q(J,null,Z(Wl.value,e=>(N(),O(h,{key:e,removable:"",onRemove:a=>Ws(e),color:"white","text-color":"primary",class:"shadow-sm border border-blue-100 m-0 w-full"},{default:Q(()=>{var a,t;return[B(w,{icon:"person",color:"primary","text-color":"white","font-size":"14px"}),L("div",ol,[L("span",nl,[H(W(null==(a=Fl.value.find(a=>a.id===e))?void 0:a.firstName)+" ",1),L("span",rl,W(null==(t=Fl.value.find(a=>a.id===e))?void 0:t.lastName),1)])])]}),_:2},1032,["onRemove"]))),128))]))]),L("div",il,[L("div",dl,[B(o,{flat:"",dense:"",color:"primary",label:"All",size:"sm",onClick:Rs,class:"bg-blue-50"}),B(o,{flat:"",dense:"",color:"primary",label:"Inv",size:"sm",onClick:qs,class:"bg-blue-50"}),B(o,{flat:"",dense:"",color:"negative",label:"Clear",size:"sm",onClick:Ys,class:"bg-red-50"})])])]),_:1}),L("div",ul,[B(t,{class:se("positive"===is.value?"bg-green-50 border-b border-green-100":"bg-red-50 border-b border-red-100")},{default:Q(()=>[L("div",cl,[B(l,{name:"positive"===is.value?"add_circle":"remove_circle",color:"positive"===is.value?"positive":"negative"},null,8,["name","color"]),H(" "+W("positive"===is.value?a.$t("rewardSys.points.positiveTitle"):a.$t("rewardSys.points.negativeTitle")),1)])]),_:1},8,["class"]),B(t,{class:"flex-1 overflow-y-auto p-4 custom-scrollbar"},{default:Q(()=>[L("div",vl,[(N(!0),q(J,null,Z("positive"===is.value?Ds.value:Fs.value,e=>(N(),q("div",{key:e.id,class:"cursor-pointer transition-all duration-200 relative group",onClick:a=>ds.value=e.id},[L("div",{class:se(["h-full p-3 rounded-xl border-2 flex flex-col items-center text-center gap-2 hover:shadow-md transition-all",[ds.value===e.id?"positive"===is.value?"border-green-500 bg-green-50 scale-105":"border-red-500 bg-red-50 scale-105":"border-gray-100 bg-white hover:border-gray-300"]])},[L("div",{class:se(["text-3xl p-3 rounded-full mb-1","positive"===is.value?"bg-green-100 text-green-600":"bg-red-100 text-red-600"])},W(e.icon||("positive"===is.value?"‚≠ê":"‚ö†Ô∏è")),3),L("div",pl,W(kl(e)),1),L("div",{class:se(["text-xl font-bold px-3 py-1 rounded-full mt-auto","positive"===is.value?"bg-green-200 text-green-800":"bg-red-200 text-red-800"])},W("positive"===is.value?"+":"")+W(e.value||e.points||0),3),ds.value===e.id?(N(),q("div",{key:0,class:se(["absolute top-2 right-2 text-xl drop-shadow-sm","positive"===is.value?"text-green-600":"text-red-600"])},[B(l,{name:"check_circle"})],2)):M("",!0)],2)],8,ml))),128))])]),_:1}),B(p,{align:"right",class:"p-4 border-t border-gray-100 bg-gray-50 gap-3"},{default:Q(()=>[X(B(o,{flat:"",label:a.$t("rewardSys.tabs.cancel"),color:"grey-7",size:"lg",class:"font-bold"},null,8,["label"]),[[x]]),B(o,{color:"positive"===is.value?"positive":"negative",label:"positive"===is.value?a.$t("rewardSys.points.applyPositive"):a.$t("rewardSys.points.applyNegative"),icon:"positive"===is.value?"check_circle":"warning",onClick:Ns,disable:!ds.value,loading:Xl.value,size:"lg",class:"px-8 font-bold shadow-md",push:""},null,8,["color","label","icon","disable","loading"])]),_:1})])]),_:1})]),_:1},8,["modelValue"]),B(m,{modelValue:ws.value,"onUpdate:modelValue":y[34]||(y[34]=e=>ws.value=e),persistent:""},{default:Q(()=>[B(r,{class:"min-w-[500px]"},{default:Q(()=>[B(t,{class:"bg-primary text-white"},{default:Q(()=>[L("div",gl,[L("div",bl,W(_s.value?a.$t("rewardSys.behaviors.edit"):a.$t("rewardSys.behaviors.create")),1),_s.value&&!_s.value.teacher_id?(N(),O(k,{key:0,color:"blue",label:"üîí "+a.$t("rewardSys.behaviors.schoolDefault")},null,8,["label"])):M("",!0)])]),_:1}),B(t,{class:"q-pt-md space-y-4"},{default:Q(()=>[_s.value&&!_s.value.teacher_id?(N(),O(b,{key:0,class:"bg-blue-50 text-blue-900",rounded:"",dense:""},{avatar:Q(()=>[B(l,{name:"info",color:"blue"})]),default:Q(()=>[H(" "+W(a.$t("rewardSys.behaviors.readOnlyWarning")),1)]),_:1})):M("",!0),B(f,{modelValue:ks.value.name,"onUpdate:modelValue":y[29]||(y[29]=e=>ks.value.name=e),label:"üá¨üáß "+a.$t("rewardSys.behaviors.form.nameEn")+" *",outlined:"",dense:"",rules:[e=>!!e||"Name is required"],readonly:_s.value&&!_s.value.teacher_id},{prepend:Q(()=>[B(l,{name:"translate"})]),_:1},8,["modelValue","label","rules","readonly"]),B(f,{modelValue:ks.value.name_ar,"onUpdate:modelValue":y[30]||(y[30]=e=>ks.value.name_ar=e),label:"üá∏üá¶ "+a.$t("rewardSys.behaviors.form.nameAr"),outlined:"",dense:"",dir:"rtl",readonly:_s.value&&!_s.value.teacher_id},{prepend:Q(()=>[B(l,{name:"translate"})]),_:1},8,["modelValue","label","readonly"]),B(V,{modelValue:ks.value.type,"onUpdate:modelValue":y[31]||(y[31]=e=>ks.value.type=e),options:[{label:a.$t("rewardSys.behaviors.form.types.positive"),value:"positive"},{label:a.$t("rewardSys.behaviors.form.types.negative"),value:"negative"}],label:a.$t("rewardSys.behaviors.form.type")+" *",outlined:"",dense:"","emit-value":"","map-options":"",rules:[e=>!!e||"Type is required"],readonly:_s.value&&!_s.value.teacher_id},null,8,["modelValue","options","label","rules","readonly"]),B(f,{modelValue:ks.value.points,"onUpdate:modelValue":y[32]||(y[32]=e=>ks.value.points=e),modelModifiers:{number:!0},label:a.$t("rewardSys.behaviors.form.points")+" *",type:"number",outlined:"",dense:"",rules:[e=>null!==e&&""!==e||"Points are required"],hint:"positive"===ks.value.type?"Positive number (e.g., 5)":"Negative number (e.g., -3)",readonly:_s.value&&!_s.value.teacher_id},null,8,["modelValue","label","rules","hint","readonly"]),B(f,{modelValue:ks.value.icon,"onUpdate:modelValue":y[33]||(y[33]=e=>ks.value.icon=e),label:a.$t("rewardSys.behaviors.form.icon"),outlined:"",dense:"",hint:"Optional emoji, e.g., ‚≠ê üéâ ‚ö†Ô∏è üö´",readonly:_s.value&&!_s.value.teacher_id},null,8,["modelValue","label","readonly"])]),_:1}),B(p,{align:"right",class:"q-px-md q-pb-md"},{default:Q(()=>[X(B(o,{flat:"",label:a.$t("rewardSys.tabs.cancel")},null,8,["label"]),[[x]]),!_s.value||_s.value.teacher_id?(N(),O(o,{key:0,color:"primary",label:_s.value?a.$t("common.update"):a.$t("common.create"),onClick:Ms,loading:Ss.value},null,8,["label","loading"])):M("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),B(m,{modelValue:vs.value,"onUpdate:modelValue":y[36]||(y[36]=e=>vs.value=e),maximized:""},{default:Q(()=>[B(G(fl),{students:Fl.value,"saved-layouts":cs.value,"editing-layout":ms.value,onSave:Bs,onDelete:Ls,onClose:y[35]||(y[35]=e=>vs.value=!1)},null,8,["students","saved-layouts","editing-layout"])]),_:1},8,["modelValue"]),B(m,{modelValue:ps.value,"onUpdate:modelValue":y[42]||(y[42]=e=>ps.value=e)},{default:Q(()=>[B(oe,{mode:gs.value,"competition-start-time":fs.value,"date-from":ys.value,"date-to":hs.value,"leaderboard-mode":xs.value,"onUpdate:mode":y[37]||(y[37]=e=>gs.value=e),"onUpdate:competitionStartTime":y[38]||(y[38]=e=>fs.value=e),"onUpdate:dateFrom":y[39]||(y[39]=e=>ys.value=e),"onUpdate:dateTo":y[40]||(y[40]=e=>hs.value=e),"onUpdate:leaderboardMode":y[41]||(y[41]=e=>xs.value=e),onApply:so,onReset:oo},null,8,["mode","competition-start-time","date-from","date-to","leaderboard-mode"])]),_:1},8,["modelValue"])])],64)}}},[["__scopeId","data-v-306db8b6"]]);export{fl as default};
