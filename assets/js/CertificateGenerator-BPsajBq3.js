import{Q as e}from"./QSpace-DuS_4lXE.js";import{o as t,u as l,Q as a,a as o,n as i,d as s,f as n,m as r,b as u,aP as d}from"./app-DOc39CFu.js";import{Q as c}from"./QBar-Crr1vFzF.js";import{Q as v}from"./QSlider-XDiT4A1X.js";import m from"./html2canvas.esm-Cq3pa7K9.js";import{E as p}from"./jspdf.es.min-DQFOCZ-H.js";import{a as f,f as g,k as h,o as b,e as w,I as y,J as x,K as k,b as S,N as V,y as C,M as _,R as j,F as z,Q as L,W as $,V as N,S as M,U as D,n as O}from"./vendor-DuKqz2x4.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";const Y={class:"flex-1 flex flex-col lg:flex-row overflow-hidden print:block print:overflow-visible"},J={class:"w-full lg:w-96 bg-gray-800 p-6 overflow-y-auto border-r border-gray-700 flex flex-col gap-6 print:hidden shadow-xl z-20"},Q={class:"grid grid-cols-2 gap-3"},U=["onClick"],I=["src"],P={key:0,class:"absolute bottom-1 right-1 bg-primary text-white text-xs px-1.5 py-0.5 rounded-full shadow-sm"},A={class:"space-y-4"},E={class:"flex items-center justify-between"},F={key:0,class:"bg-gray-700 p-3 rounded-lg space-y-3"},T={class:"text-xs text-yellow-500 font-bold mb-1"},G={class:"text-xs text-gray-300 mb-2"},R={class:"text-xs text-gray-400 mb-1"},X={class:"grid grid-cols-2 gap-3"},B={class:"grid grid-cols-1 gap-3 mt-auto"},W={class:"flex-1 bg-gray-900 relative p-4 lg:p-8 overflow-auto print:p-0 print:block flex flex-col items-center"},H={key:0,class:"w-full max-w-4xl mb-4 print:hidden"},K={class:"bg-gray-800 rounded-lg p-3 flex items-center justify-between"},q={class:"text-yellow-400 font-bold"},Z={class:"text-white ml-2"},ee=["src"],te=["src"],le={class:"absolute inset-0 text-black font-serif z-20 pointer-events-none"},ae=t({__name:"CertificateGenerator",props:{modelValue:Boolean,student:Object,students:{type:Array,default:()=>[]},defaultDate:String,schoolLogo:String},emits:["update:modelValue"],setup(t,{emit:ae}){const oe=l(),ie=t,se=ae,ne=f({get:()=>ie.modelValue,set:e=>se("update:modelValue",e)}),re=f(()=>ie.students&&ie.students.length>0),ue=g(0),de=f(()=>re.value?ie.students[ue.value]||ie.students[0]:ie.student),ce=g({academicYear:"2024-2025",week:"1",date:ie.defaultDate||(new Date).toLocaleDateString(),message:"For your outstanding performance and excellent behavior."}),ve=[{id:1,name:"Classic Gold",image:"/images/certificate1.png",styles:{name:{top:"301px",left:"0",right:"0",width:"100%",textAlign:"center",color:"#111827"},message:{top:"436px",left:"112px",right:"112px",width:"899px",textAlign:"center",color:"#4b5563",fontSize:"1.5rem"},year:{top:"635px",left:"168px",fontSize:"1.5rem",color:"#374151"},date:{top:"635px",left:"800px",fontSize:"1.5rem",color:"#374151"},week:{top:"198px",left:"800px",fontSize:"1.5rem",color:"#374151"},logo:{top:"63px",left:"460px",height:"80px",opacity:"0.9"}}},{id:2,name:"Modern Blue",image:"/images/certificate2.png",styles:{name:{top:"333px",left:"0",width:"80%",textAlign:"center",color:"#1e3a8a"},message:{top:"476px",left:"112px",width:"65%",textAlign:"center",color:"#1e3a8a",fontSize:"1.25rem"},year:{top:"680px",left:"471px",color:"#1e3a8a",fontSize:"1.25rem"},date:{top:"680px",left:"112px",color:"#1e3a8a",fontSize:"1.25rem"},week:{top:"238px",left:"101px",color:"#1e3a8a",fontSize:"1.25rem"},logo:{top:"40px",left:"56px",height:"90px"}}}],me=g(ve),pe=g(me.value[0]),fe=g(JSON.parse(JSON.stringify(me.value[0].styles))),ge=g(!1);function he(e){const t=localStorage.getItem(`cert_styles_${e}`);if(t)fe.value=JSON.parse(t);else{const t=ve.find(t=>t.id===e);t&&(fe.value=JSON.parse(JSON.stringify(t.styles)))}}function be(){localStorage.setItem(`cert_styles_${pe.value.id}`,JSON.stringify(fe.value)),oe.notify({message:"Layout saved!",color:"positive",position:"top",timeout:1e3})}function we(){const e=ve.find(e=>e.id===pe.value.id);e&&(fe.value=JSON.parse(JSON.stringify(e.styles)),be())}h(pe,e=>{he(e.id)});const ye=g({active:!1,element:null,startX:0,startY:0,initialTop:0,initialLeft:0});function xe(e,t){if(!ge.value)return;e.preventDefault(),ye.value.active=!0,ye.value.element=t,ye.value.startX=e.clientX,ye.value.startY=e.clientY;const l=fe.value[t];ye.value.initialTop=parseInt(l.top)||0,ye.value.initialLeft=parseInt(l.left)||0,window.addEventListener("mousemove",ke),window.addEventListener("mouseup",Se)}function ke(e){if(!ye.value.active)return;const t=(e.clientX-ye.value.startX)/_e.value,l=(e.clientY-ye.value.startY)/_e.value,a=ye.value.element;fe.value[a]&&(fe.value[a].top=`${ye.value.initialTop+l}px`,fe.value[a].left=`${ye.value.initialLeft+t}px`,delete fe.value[a].right,delete fe.value[a].bottom)}function Se(){ye.value.active=!1,window.removeEventListener("mousemove",ke),window.removeEventListener("mouseup",Se),be()}const Ve=g(!1),Ce=g(null),_e=g(1);async function je(){Ve.value=!0,ge.value=!1;try{const e=Ce.value;if(!e)throw new Error("Certificate element not found");const t=new p({orientation:"landscape",unit:"px",format:[1123,794]}),l=re.value?ie.students:[ie.student];for(let o=0;o<l.length;o++){re.value&&oe.notify({message:`Generating certificate ${o+1} of ${l.length}...`,color:"info",position:"top",timeout:500}),ue.value=o,await O(),await new Promise(e=>setTimeout(e,100));const a=e.style.transform;e.style.transform="none";const i=await m(e,{scale:2,useCORS:!0,logging:!1,allowTaint:!0});e.style.transform=a;const s=i.toDataURL("image/png");o>0&&t.addPage(),t.addImage(s,"PNG",0,0,1123,794)}const a=re.value?`Certificates_${l.length}_Students.pdf`:`${ie.student.firstName}_Certificate.pdf`;t.save(a),oe.notify({message:re.value?`${l.length} certificates downloaded!`:"Certificate downloaded!",color:"positive"})}catch(e){console.error(e),oe.notify({message:"Failed to generate PDF",color:"negative"})}finally{Ve.value=!1,ue.value=0}}function ze(){ge.value=!1,window.print()}return b(()=>{he(pe.value.id)}),w(()=>{window.removeEventListener("mousemove",ke),window.removeEventListener("mouseup",Se)}),(l,m)=>(x(),y(u,{modelValue:ne.value,"onUpdate:modelValue":m[14]||(m[14]=e=>ne.value=e),maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:k(()=>[S(r,{class:"bg-gray-900 text-white flex flex-col print:bg-white print:text-black"},{default:k(()=>{var r,u,p,f;return[S(c,{class:"bg-gray-800 p-4 print:hidden border-b border-gray-700"},{default:k(()=>[m[15]||(m[15]=V("div",{class:"text-h6 flex items-center gap-2"}," ðŸŽ“ Certificate Generator ",-1)),S(e),C(S(a,{dense:"",flat:"",icon:"close"},null,512),[[d]])]),_:1}),V("div",Y,[V("div",J,[V("div",null,[m[17]||(m[17]=V("div",{class:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-3"},"Select Template",-1)),V("div",Q,[(x(!0),_(z,null,j(me.value,e=>(x(),_("div",{key:e.id,class:D(["cursor-pointer rounded-lg overflow-hidden transition-all duration-300 relative group",pe.value.id===e.id?"ring-2 ring-primary shadow-lg scale-[1.02]":"opacity-70 hover:opacity-100 hover:scale-[1.02]"]),onClick:t=>pe.value=e},[V("img",{src:e.image,class:"w-full h-24 object-cover"},null,8,I),m[16]||(m[16]=V("div",{class:"absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors"},null,-1)),pe.value.id===e.id?(x(),_("div",P,[S(s,{name:"check",size:"xs"})])):L("",!0)],10,U))),128))])]),S(o,{dark:""}),V("div",A,[V("div",E,[m[18]||(m[18]=V("div",{class:"text-xs font-bold text-gray-400 uppercase tracking-wider"},"Certificate Details",-1)),S(i,{modelValue:ge.value,"onUpdate:modelValue":m[0]||(m[0]=e=>ge.value=e),label:l.$t("rewardSys.certificate.editLayout"),dense:"",color:"secondary",class:"text-xs"},null,8,["modelValue","label"])]),ge.value?(x(),_("div",F,[V("div",T,[S(s,{name:"warning",class:"mr-1"}),$(" "+N(l.$t("rewardSys.certificate.editModeActive")),1)]),V("div",G,N(l.$t("rewardSys.certificate.dragInstruction")),1),V("div",null,[V("div",R,N(l.$t("rewardSys.certificate.logoHeight")),1),S(v,{modelValue:fe.value.logo.height,"onUpdate:modelValue":m[1]||(m[1]=e=>fe.value.logo.height=e),min:40,max:200,label:"","label-value":fe.value.logo.height+"px",color:"secondary"},null,8,["modelValue","label-value"])]),S(a,{outline:"",dense:"",color:"warning",icon:"restore",label:l.$t("rewardSys.certificate.resetLayout"),size:"sm",class:"w-full",onClick:we},null,8,["label"])])):L("",!0),S(n,{modelValue:ce.value.academicYear,"onUpdate:modelValue":m[2]||(m[2]=e=>ce.value.academicYear=e),label:"Academic Year",dark:"",outlined:"",dense:"","bg-color":"gray-900",color:"white","label-color":"grey-4"},{prepend:k(()=>[S(s,{name:"event"})]),_:1},8,["modelValue"]),V("div",X,[S(n,{modelValue:ce.value.week,"onUpdate:modelValue":m[3]||(m[3]=e=>ce.value.week=e),label:"Week",dark:"",outlined:"",dense:"","bg-color":"gray-900",color:"white","label-color":"grey-4"},null,8,["modelValue"]),S(n,{modelValue:ce.value.date,"onUpdate:modelValue":m[4]||(m[4]=e=>ce.value.date=e),label:"Date",dark:"",outlined:"",dense:"","bg-color":"gray-900",color:"white","label-color":"grey-4"},null,8,["modelValue"])]),S(n,{modelValue:ce.value.message,"onUpdate:modelValue":m[5]||(m[5]=e=>ce.value.message=e),label:"Custom Message",dark:"",outlined:"",dense:"",autogrow:"","bg-color":"gray-900",color:"white","label-color":"grey-4",hint:"Short appreciation text"},null,8,["modelValue"])]),S(e,{class:"hidden lg:block"}),V("div",B,[S(a,{color:"primary",icon:"download",label:"Download PDF",class:"py-3 font-bold shadow-lg",onClick:je,loading:Ve.value},null,8,["loading"]),S(a,{color:"white","text-color":"black",icon:"print",label:"Print Certificate",class:"py-2",onClick:ze})])]),V("div",W,[re.value?(x(),_("div",H,[V("div",K,[S(a,{flat:"",dense:"",icon:"chevron_left",color:"yellow-500",onClick:m[6]||(m[6]=e=>ue.value=Math.max(0,ue.value-1)),disable:0===ue.value},null,8,["disable"]),V("div",q,[$(" Student "+N(ue.value+1)+" of "+N(t.students.length)+" ",1),V("span",Z,N(null==(r=de.value)?void 0:r.firstName)+" "+N(null==(u=de.value)?void 0:u.lastName),1)]),S(a,{flat:"",dense:"",icon:"chevron_right",color:"yellow-500",onClick:m[7]||(m[7]=e=>ue.value=Math.min(t.students.length-1,ue.value+1)),disable:ue.value===t.students.length-1},null,8,["disable"])])])):L("",!0),m[19]||(m[19]=V("div",{class:"text-center absolute top-2 left-0 right-0 text-gray-500 text-sm italic lg:hidden print:hidden z-10 pointer-events-none"}," Scroll to view full certificate ",-1)),V("div",{ref_key:"certificateRef",ref:Ce,class:"certificate-container relative shadow-2xl overflow-hidden bg-white print:shadow-none print:m-0 shrink-0",style:M({width:"1123px",height:"794px",transform:`scale(${_e.value})`,transformOrigin:"top center"})},[V("img",{src:pe.value.image,class:"absolute inset-0 w-full h-full object-cover select-none pointer-events-none"},null,8,ee),t.schoolLogo?(x(),_("img",{key:0,src:t.schoolLogo,class:D(["absolute object-contain z-30",{"cursor-move hover:outline-dashed hover:outline-2 hover:outline-blue-500":ge.value}]),style:M({...fe.value.logo,height:"number"==typeof fe.value.logo.height?fe.value.logo.height+"px":fe.value.logo.height}),onMousedown:m[8]||(m[8]=e=>xe(e,"logo"))},null,46,te)):L("",!0),V("div",le,[V("div",{class:D(["absolute pointer-events-auto",{"cursor-move hover:outline-dashed hover:outline-2 hover:outline-blue-500":ge.value}]),style:M(fe.value.name),onMousedown:m[9]||(m[9]=e=>xe(e,"name"))},[V("h1",{class:"font-bold capitalize leading-none select-none",style:M({fontFamily:"'Pinyon Script', cursive, serif",color:fe.value.name.color||"#111827",fontSize:"5rem"})},N(null==(p=de.value)?void 0:p.firstName)+" "+N(null==(f=de.value)?void 0:f.lastName),5)],38),V("div",{class:D(["absolute font-medium italic pointer-events-auto select-none",{"cursor-move hover:outline-dashed hover:outline-2 hover:outline-blue-500":ge.value}]),style:M(fe.value.message),onMousedown:m[10]||(m[10]=e=>xe(e,"message"))},' "'+N(ce.value.message)+'" ',39),V("div",{class:D(["absolute font-bold pointer-events-auto select-none",{"cursor-move hover:outline-dashed hover:outline-2 hover:outline-blue-500":ge.value}]),style:M(fe.value.year),onMousedown:m[11]||(m[11]=e=>xe(e,"year"))},N(ce.value.academicYear),39),V("div",{class:D(["absolute font-bold pointer-events-auto select-none",{"cursor-move hover:outline-dashed hover:outline-2 hover:outline-blue-500":ge.value}]),style:M(fe.value.date),onMousedown:m[12]||(m[12]=e=>xe(e,"date"))},N(ce.value.date),39),V("div",{class:D(["absolute font-bold pointer-events-auto select-none",{"cursor-move hover:outline-dashed hover:outline-2 hover:outline-blue-500":ge.value}]),style:M(fe.value.week),onMousedown:m[13]||(m[13]=e=>xe(e,"week"))}," Week: "+N(ce.value.week),39)])],4)])])]}),_:1})]),_:1},8,["modelValue"]))}},[["__scopeId","data-v-d6d71f28"]]);export{ae as default};
