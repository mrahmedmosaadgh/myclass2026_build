import{o as e,u as a,c as s,h as t,i as l,j as o,f as i,n,Q as u,m as r,d as c,g as d,A as v,s as p,z as m,t as _,v as f}from"./app-Buylb2AA.js";import{Q as g}from"./QSelect-CcTxzM62.js";import{Q as y}from"./QBadge-Dt5ch-CZ.js";import{f as b,o as h,e as w,L as q,I as S,b as x,M as k,y as z,a3 as V,J as j,af as C,ag as F,V as T,U as A,H as Q,O as I,S as U,F as L,Q as M,Z as $}from"./vendor-CUZ9QTQV.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";import"./rtl-Cr6c3OOr.js";const N={class:"teacher-test-page"},O={key:0,class:"session-setup"},P={class:"question-selector"},E={class:"session-settings"},G={key:1,class:"session-control"},H={class:"access-code"},J={class:"row items-center q-gutter-sm"},R={class:"control-buttons-grid"},B=e({__name:"TeacherTestPage",setup(e){const B=a(),D=b(null),Z=b(null),K=b({questions:[]}),W=b([]),X=b(!1),Y=b(0),ee=b(null),ae=b({timer:60,auto_submit:!0,show_correct_answer:!1});let se=null;const te=async()=>{try{const e=await $.get("/api/questions");K.value=e.data.data||e.data}catch(e){console.error("Failed to load questions:",e),B.notify({type:"negative",message:"Failed to load questions"})}},le=(e,a)=>{a(()=>{""===e?te():e.toLowerCase()})},oe=async()=>{X.value=!0;try{const e=await $.post("/api/quiz-sessions",{settings:ae.value});D.value=e.data.session;const a=p(_,`quiz_sessions/${D.value.access_code}`);await m(a,{status:"waiting",current_question_id:null,participants:{}}),ie(),B.notify({type:"positive",message:"Session created successfully"})}catch(e){console.error("Failed to create session:",e),B.notify({type:"negative",message:"Failed to create session"})}finally{X.value=!1}},ie=()=>{console.log("Setting up Firebase listeners for code:",D.value.access_code);const e=p(_,`quiz_sessions/${D.value.access_code}/participants`);se=f(e,e=>{const a=e.val();console.log("Firebase participants update:",a),a?(W.value=Object.values(a),console.log("Participants array:",W.value)):W.value=[]})},ne=async()=>{var e;if(Z.value)try{await $.post(`/api/quiz-sessions/${D.value.id}/state`,{action:"start",question_id:Z.value.id});const a=p(_,`quiz_sessions/${D.value.access_code}`),s=JSON.parse(JSON.stringify(Z.value));await m(a,{status:"active",current_question_id:Z.value.id,current_question:s}),D.value.status="active",ae.value.timer&&(e=ae.value.timer,Y.value=e,ee.value&&clearInterval(ee.value),ee.value=setInterval(()=>{Y.value--,Y.value<=0&&clearInterval(ee.value)},1e3)),B.notify({type:"positive",message:"Session started"})}catch(a){console.error("Failed to start session:",a)}},ue=async()=>{try{await $.post(`/api/quiz-sessions/${D.value.id}/state`,{action:"pause"}),ee.value&&clearInterval(ee.value),B.notify({type:"info",message:"Session paused"})}catch(e){console.error("Failed to pause session:",e)}},re=async()=>{try{await $.post(`/api/quiz-sessions/${D.value.id}/state`,{action:"end"}),D.value.status="completed",ee.value&&clearInterval(ee.value),B.notify({type:"positive",message:"Session ended"})}catch(e){console.error("Failed to end session:",e)}};return h(()=>{te()}),w(()=>{se&&se(),ee.value&&clearInterval(ee.value)}),(e,a)=>(S(),q(L,null,[x(z(V),{title:"Live Quiz - Teacher Control"}),k("div",N,[a[10]||(a[10]=k("div",{class:"page-header"},[k("h1",null,"Live Quiz Session"),k("p",null,"Create and control a live quiz session for your students")],-1)),D.value?(S(),q("div",G,[x(r,{class:"access-code-card"},{default:j(()=>[x(s,{class:"text-center"},{default:j(()=>[a[7]||(a[7]=k("h2",null,"Access Code",-1)),k("div",H,A(D.value.access_code),1),a[8]||(a[8]=k("p",null,[T(" Students can join at: "),k("strong",null,"/quiz/live/join")],-1))]),_:1})]),_:1}),"active"===D.value.status?(S(),Q(r,{key:0,class:"timer-card q-mb-md"},{default:j(()=>[x(s,{class:"text-center"},{default:j(()=>[k("div",{class:U(["text-h4 text-weight-bold",{"text-negative":Y.value<=10,"text-primary":Y.value>10}])},[x(c,{name:"timer"}),T(" "+A(Y.value)+"s ",1)],2)]),_:1})]),_:1})):I("",!0),x(r,{class:"participants-card"},{default:j(()=>[x(s,null,{default:j(()=>[k("h3",null,"Participants ("+A(W.value.length)+")",1),x(d,{separator:""},{default:j(()=>[(S(!0),q(L,null,M(W.value,e=>(S(),Q(t,{key:e.id},{default:j(()=>[x(l,{avatar:""},{default:j(()=>[x(v,{color:"primary","text-color":"white"},{default:j(()=>{var a,s;return[T(A((null==(s=null==(a=e.student)?void 0:a.name)?void 0:s.charAt(0))||"?"),1)]}),_:2},1024)]),_:2},1024),x(l,null,{default:j(()=>[x(o,null,{default:j(()=>{var a;return[T(A((null==(a=e.student)?void 0:a.name)||"Unknown"),1)]}),_:2},1024),x(o,{caption:""},{default:j(()=>[T("Score: "+A(e.score),1)]),_:2},1024)]),_:2},1024),x(l,{side:""},{default:j(()=>{var a;return[k("div",J,[e.last_answered_question_id===(null==(a=D.value)?void 0:a.current_question_id)?(S(),Q(y,{key:0,color:"positive",label:"Answered"},{default:j(()=>[x(c,{name:"check",color:"white",class:"q-ml-xs"})]),_:1})):(S(),Q(y,{key:1,color:"warning","text-color":"black",label:"Thinking..."},{default:j(()=>[x(c,{name:"more_horiz",class:"q-ml-xs"})]),_:1})),x(y,{color:"active"===e.status?"primary":"grey",outline:""},{default:j(()=>[T(A(e.status),1)]),_:2},1032,["color"])])]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),x(r,{class:"controls-card bounce-in"},{default:j(()=>[x(s,null,{default:j(()=>[a[9]||(a[9]=k("h3",{class:"text-center text-primary text-weight-bold q-mb-lg"},"ðŸŽ® Game Controls",-1)),k("div",R,["waiting"===D.value.status?(S(),Q(u,{key:0,push:"",color:"positive",label:"START GAME! ðŸš€",onClick:ne,size:"xl",class:"game-btn start-btn"})):I("",!0),"active"===D.value.status?(S(),Q(u,{key:1,push:"",color:"warning","text-color":"black",label:"PAUSE â¸ï¸",onClick:ue,size:"lg",class:"game-btn pause-btn"})):I("",!0),x(u,{push:"",color:"negative",label:"END GAME ðŸ›‘",onClick:re,size:"lg",class:"game-btn end-btn"})])]),_:1})]),_:1})])):(S(),q("div",O,[x(r,{class:"setup-card"},{default:j(()=>[x(s,null,{default:j(()=>{var e;return[a[6]||(a[6]=k("h2",null,"Create New Session",-1)),k("div",P,[x(g,{modelValue:Z.value,"onUpdate:modelValue":a[0]||(a[0]=e=>Z.value=e),options:(null==(e=K.value)?void 0:e.questions)||[],"option-label":"question_text","option-value":"id",label:"Select a Question",outlined:"","use-input":"",onFilter:le},{"no-option":j(()=>[x(t,null,{default:j(()=>[x(l,{class:"text-grey"},{default:j(()=>a[4]||(a[4]=[T(" No questions found ")])),_:1})]),_:1})]),option:j(e=>[x(t,C(F(e.itemProps)),{default:j(()=>[x(l,null,{default:j(()=>[x(o,{innerHTML:e.opt.question_text},null,8,["innerHTML"]),x(o,{caption:""},{default:j(()=>{var a;return[T(A((null==(a=e.opt.options)?void 0:a.length)||0)+" options ",1)]}),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])]),k("div",E,[a[5]||(a[5]=k("h3",null,"Session Settings",-1)),x(i,{modelValue:ae.value.timer,"onUpdate:modelValue":a[1]||(a[1]=e=>ae.value.timer=e),modelModifiers:{number:!0},type:"number",label:"Timer (seconds)",outlined:"",min:"10"},null,8,["modelValue"]),x(n,{modelValue:ae.value.auto_submit,"onUpdate:modelValue":a[2]||(a[2]=e=>ae.value.auto_submit=e),label:"Auto-submit when timer ends"},null,8,["modelValue"]),x(n,{modelValue:ae.value.show_correct_answer,"onUpdate:modelValue":a[3]||(a[3]=e=>ae.value.show_correct_answer=e),label:"Show correct answer after submission"},null,8,["modelValue"])]),x(u,{color:"primary",label:"Create Session",onClick:oe,loading:X.value,disable:!Z.value,size:"lg",class:"full-width"},null,8,["loading","disable"])]}),_:1})]),_:1})]))])],64))}},[["__scopeId","data-v-206f255c"]]);export{B as default};
