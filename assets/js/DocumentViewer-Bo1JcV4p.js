import{r as e,u as l,f as n,Q as t,H as a,b as o,i,l as c,j as r,k as s,d,e as u}from"./app-4gpSDtVV.js";import{Q as m}from"./QSpace-BaiVAeLS.js";import{Q as v}from"./QSpinnerDots-BRGXnI5e.js";import{Q as p}from"./QDrawer-DXCDYsb6.js";import{f as y,a as g,k as f,_ as h,I as k,J as b,K as w,b as x,O as L,R as H,V as T,W as M,N as _,F as $,Q as q,U as C}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";const V={class:"col"},j={class:"row items-center"},z={class:"text-h5 text-weight-bold"},Q={class:"text-subtitle2 text-grey-7"},E={key:0},A={class:"col-auto"},I={key:0,class:"text-center q-py-xl"},S={key:1,class:"text-center q-py-xl"},F={class:"text-body2 text-grey-7 q-mt-sm"},D={key:2,class:"content-display"},O={key:0,class:"rendered-content"},R=["innerHTML"],U={key:1,class:"database-content"},B={key:0,class:"rich-content"},J=["innerHTML"],N=["innerHTML"],P=["innerHTML"],K=["innerHTML"],W={key:4,class:"code-block"},G=["innerHTML"],X={key:5},Y=["innerHTML"],Z=["innerHTML"],ee=["innerHTML"],le={key:1,class:"source-content"},ne={class:"source-code"},te=e({__name:"DocumentViewer",props:{modelValue:Boolean,document:Object},emits:["update:modelValue","close"],setup(e,{emit:te}){const ae=l(),oe=e,ie=y(!1),ce=y(null),re=y("rendered"),se=y(!1),de=y(""),ue=y(""),me=y([]),ve=g(()=>{var e,l;return"file"===(null==(e=oe.document)?void 0:e.source)?de.value:(null==(l=oe.document)?void 0:l.content)?"string"==typeof oe.document.content?oe.document.content:JSON.stringify(oe.document.content,null,2):""});f(()=>oe.document,e=>{e&&oe.modelValue&&pe()},{immediate:!0}),f(()=>oe.modelValue,e=>{e&&oe.document&&pe()});const pe=async()=>{var e,l;if(oe.document){ie.value=!0,ce.value=null;try{if("file"===oe.document.source){const e=await h.get("/admin/documentation-portal/file-content",{params:{path:oe.document.path}});de.value=e.data.content,ue.value=await ye(e.data.content),ge(e.data.content)}else de.value=ve.value,Array.isArray(oe.document.content)&&fe(oe.document.content)}catch(n){ce.value=(null==(l=null==(e=n.response)?void 0:e.data)?void 0:l.error)||"Failed to load content"}finally{ie.value=!1}}},ye=async e=>e.replace(/^# (.+)$/gm,"<h1>$1</h1>").replace(/^## (.+)$/gm,"<h2>$1</h2>").replace(/^### (.+)$/gm,"<h3>$1</h3>").replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/`(.+?)`/g,"<code>$1</code>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>").replace(/\n/g,"<br>"),ge=e=>{const l=e.match(/^#{1,6}\s+.+$/gm)||[];me.value=l.map((e,l)=>({id:`heading-${l}`,level:e.match(/^#+/)[0].length,text:e.replace(/^#+\s+/,"")}))},fe=e=>{me.value=e.filter(e=>["heading1","heading2","heading3"].includes(e.type)).map((e,l)=>({id:`heading-${l}`,level:parseInt(e.type.replace("heading","")),text:e.content.replace(/<[^>]*>/g,"")}))},he=()=>{var e,l;return{code:"code",tutorial:"school",guide:"map",api:"api",reference:"book",note:"note",research:"science",question:"help",comment:"comment",idea:"lightbulb"}[null==(l=null==(e=oe.document)?void 0:e.type)?void 0:l.toLowerCase()]||"description"},ke=()=>{var e,l;return{code:"green",tutorial:"blue",guide:"purple",api:"red",reference:"indigo",note:"yellow",research:"teal",question:"pink",comment:"cyan",idea:"amber"}[null==(l=null==(e=oe.document)?void 0:e.type)?void 0:l.toLowerCase()]||"primary"},be=()=>{window.print()},we=()=>{ae.notify({type:"info",message:"Export functionality coming soon",position:"top"})},xe=()=>{var e;"database"===(null==(e=oe.document)?void 0:e.source)&&window.open(`/admin/documentation/${oe.document.id}/edit`,"_blank")},Le=()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()};return(l,y)=>(b(),k(u,{"model-value":e.modelValue,"onUpdate:modelValue":y[5]||(y[5]=e=>l.$emit("update:modelValue",e)),maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:w(()=>[x(d,{class:"document-viewer"},{default:w(()=>[x(n,{class:"viewer-header row items-center"},{default:w(()=>{var n,i,c,r;return[H("div",V,[H("div",j,[x(t,{name:he(),color:ke(),size:"2rem",class:"q-mr-md"},null,8,["name","color"]),H("div",null,[H("div",z,T(null==(n=e.document)?void 0:n.title),1),H("div",Q,[M(T(null==(i=e.document)?void 0:i.category)+" • "+T(null==(c=e.document)?void 0:c.source)+" ",1),(null==(r=e.document)?void 0:r.author)?(b(),_("span",E," • by "+T(e.document.author.name),1)):L("",!0)])])])]),H("div",A,[x(a,{outline:""},{default:w(()=>[x(o,{color:"rendered"===re.value?"primary":"grey",icon:"visibility",label:"Rendered",onClick:y[0]||(y[0]=e=>re.value="rendered"),disable:ie.value},null,8,["color","disable"]),x(o,{color:"source"===re.value?"primary":"grey",icon:"code",label:"Source",onClick:y[1]||(y[1]=e=>re.value="source"),disable:ie.value},null,8,["color","disable"])]),_:1}),x(o,{flat:"",round:"",icon:"close",onClick:y[2]||(y[2]=e=>l.$emit("close")),class:"q-ml-md"})])]}),_:1}),x(n,{class:"viewer-toolbar row items-center q-py-sm"},{default:w(()=>{var l;return[x(o,{flat:"",icon:"print",label:"Print",onClick:be,size:"sm",class:"q-mr-sm"}),x(o,{flat:"",icon:"download",label:"Export",onClick:we,size:"sm",class:"q-mr-sm"}),"database"===(null==(l=e.document)?void 0:l.source)?(b(),k(o,{key:0,flat:"",icon:"edit",label:"Edit",onClick:xe,size:"sm",class:"q-mr-sm"})):L("",!0),x(m),x(o,{flat:"",icon:"fullscreen",onClick:Le,size:"sm"})]}),_:1}),x(n,{class:"viewer-content"},{default:w(()=>{var l,n,a;return[ie.value?(b(),_("div",I,[x(v,{size:"3rem",color:"primary"}),y[6]||(y[6]=H("div",{class:"text-subtitle1 q-mt-md"},"Loading content...",-1))])):ce.value?(b(),_("div",S,[x(t,{name:"error",size:"3rem",color:"negative"}),y[7]||(y[7]=H("div",{class:"text-h6 text-negative q-mt-md"},"Error loading content",-1)),H("div",F,T(ce.value),1),x(o,{color:"primary",icon:"refresh",label:"Retry",onClick:pe,class:"q-mt-md"})])):(b(),_("div",D,["rendered"===re.value?(b(),_("div",O,["file"===(null==(l=e.document)?void 0:l.source)?(b(),_("div",{key:0,class:"markdown-content",innerHTML:ue.value},null,8,R)):(b(),_("div",U,[Array.isArray(null==(n=e.document)?void 0:n.content)?(b(),_("div",B,[(b(!0),_($,null,q(e.document.content,(e,l)=>(b(),_("div",{key:l,class:"content-block q-mb-md"},["paragraph"===e.type?(b(),_("div",{key:0,innerHTML:e.content},null,8,J)):"heading1"===e.type?(b(),_("h1",{key:1,innerHTML:e.content},null,8,N)):"heading2"===e.type?(b(),_("h2",{key:2,innerHTML:e.content},null,8,P)):"heading3"===e.type?(b(),_("h3",{key:3,innerHTML:e.content},null,8,K)):"code"===e.type?(b(),_("pre",W,[H("code",{innerHTML:e.content},null,8,G)])):"list"===e.type?(b(),_("ul",X,[(b(!0),_($,null,q(e.items,(e,l)=>(b(),_("li",{key:l,innerHTML:e},null,8,Y))),128))])):(b(),_("div",{key:6,innerHTML:e.content},null,8,Z))]))),128))])):(b(),_("div",{key:1,class:"simple-content",innerHTML:null==(a=e.document)?void 0:a.content},null,8,ee))]))])):(b(),_("div",le,[H("pre",ne,[H("code",null,T(ve.value),1)])]))]))]}),_:1}),me.value.length>0?(b(),k(p,{key:0,modelValue:se.value,"onUpdate:modelValue":y[3]||(y[3]=e=>se.value=e),side:"right",overlay:"",bordered:"",width:300,class:"toc-drawer"},{default:w(()=>[x(i,null,{default:w(()=>[x(c,{header:""},{default:w(()=>y[8]||(y[8]=[M("Table of Contents")])),_:1}),(b(!0),_($,null,q(me.value,(e,l)=>(b(),k(r,{key:l,clickable:"",onClick:l=>(e=>{const l=document.getElementById(e);l&&l.scrollIntoView({behavior:"smooth"})})(e.id),class:C(`toc-level-${e.level}`)},{default:w(()=>[x(s,null,{default:w(()=>[x(c,null,{default:w(()=>[M(T(e.text),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick","class"]))),128))]),_:1})]),_:1},8,["modelValue"])):L("",!0),me.value.length>0?(b(),k(o,{key:1,fab:"",icon:"list",color:"primary",onClick:y[4]||(y[4]=e=>se.value=!se.value),class:"toc-toggle"})):L("",!0)]),_:1})]),_:1},8,["model-value"]))}},[["__scopeId","data-v-ec111f36"]]);export{te as default};
