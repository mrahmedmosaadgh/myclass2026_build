import{u as l,c as e,f as a,Q as n,a as t,p as s,b as o,m as i,l as u,aP as r}from"./app-CqJgtQaN.js";import{u as c}from"./i18n-DE5KxGn8.js";import{f as d,k as p,a as m,I as v,J as w,K as y,b as k,N as b,V as f,z as g,M as h,Q as P,y as _,W as V}from"./vendor-DuKqz2x4.js";import"./offline-BzIlwqNM.js";import"./ui-BITzTqrO.js";const $={class:"text-h6"},x={class:"q-gutter-md"},q={key:0,class:"row q-col-gutter-md"},C={class:"col-12 col-sm-6"},L={class:"row items-center q-gutter-sm q-mt-xs"},T={class:"row items-center q-gutter-sm q-mt-xs"},U={class:"row items-center q-gutter-sm q-mt-xs"},M={class:"text-subtitle2 q-mb-sm"},j={class:"q-gutter-md"},H=["innerHTML"],D={class:"text-caption text-grey-7"},I=["innerHTML"],K={class:"text-caption text-grey-7"},N=["innerHTML"],W={class:"text-h6"},B={__name:"WeeklyPlanEditor",props:{modelValue:{type:Boolean,required:!0},plan:{type:Object,required:!0},saving:{type:Boolean,default:!1}},emits:["update:modelValue","submit","close"],setup(B,{emit:E}){const F=B,O=E,Q=l(),{t:z}=c(),A=d(F.modelValue),J=d({...F.plan});p(()=>F.plan,l=>{J.value={...l}},{immediate:!0}),p(()=>F.modelValue,l=>{A.value=l}),p(()=>A.value,l=>{O("update:modelValue",l)});const S=()=>{J.value&&(J.value.cw="",J.value.hw="",J.value.notes="")},G=l=>{J.value&&(J.value[l]="")},R=async l=>{var e,a;try{await navigator.clipboard.writeText(null!=(a=null==(e=J.value)?void 0:e[l])?a:""),Q.notify({type:"positive",message:z("weeklyPlans.notifications.copied")})}catch(n){Q.notify({type:"negative",message:z("weeklyPlans.notifications.copyFailed")})}},X=async l=>{try{const e=await navigator.clipboard.readText();J.value[l]=e}catch(e){Q.notify({type:"negative",message:z("weeklyPlans.notifications.pasteFailed")})}},Y=d(!1),Z=d("cw"),ll=d(""),el=d(""),al=l=>{Z.value=l,ll.value="",el.value="",Y.value=!0},nl=()=>{const l=(ll.value||"").trim(),e=(el.value||"").trim();if(!l)return void Q.notify({type:"warning",message:z("weeklyPlans.notifications.enterUrl")});const a=e?`[${e}](${l})`:l,n=Z.value,t=J.value[n]||"";J.value[n]=t?`${t}\n${a}`:a,Y.value=!1},tl=l=>{let e=(l=>(l||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#039;"))(String(l||""));const a=[];e=e.replace(/\[([^\]]+)\]\((https?:\/\/[^\s)]+)\)/g,(l,e,n)=>{const t=`__LINK_${a.length}__`;return a.push(`<a href="${n}" target="_blank" rel="noopener">${e}</a>`),t}),e=e.replace(/(https?:\/\/[\w\-._~:/?#\[\]@!$&'()*+,;=%]+)/g,'<a href="$1" target="_blank" rel="noopener">$1</a>'),a.forEach((l,a)=>{e=e.replace(`__LINK_${a}__`,l)}),e=e.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>");const n=e.split(/\n/);let t="",s=!1,o=!1;const i=()=>{s&&(t+="</ul>",s=!1),o&&(t+="</ol>",o=!1)};for(let u=0;u<n.length;u++){const l=n[u];if(!l.trim()){i();continue}let e;(e=l.match(/^\s*###\s+(.+)/))?(i(),t+=`<h3>${e[1]}</h3>`):(e=l.match(/^\s*##\s+(.+)/))?(i(),t+=`<h2>${e[1]}</h2>`):(e=l.match(/^\s*#\s+(.+)/))?(i(),t+=`<h1>${e[1]}</h1>`):(e=l.match(/^\s*[-*]\s+(.+)/))?(s||(i(),t+="<ul>",s=!0),t+=`<li>${e[1]}</li>`):(e=l.match(/^\s*\d+\.\s+(.+)/))?(o||(i(),t+="<ol>",o=!0),t+=`<li>${e[1]}</li>`):(i(),t+=`<p>${l}</p>`)}return i(),t||""},sl=m(()=>{var l;return tl(null==(l=J.value)?void 0:l.cw)}),ol=m(()=>{var l;return tl(null==(l=J.value)?void 0:l.hw)}),il=m(()=>{var l;return tl(null==(l=J.value)?void 0:l.notes)});return(l,c)=>(w(),v(o,{modelValue:A.value,"onUpdate:modelValue":c[21]||(c[21]=l=>A.value=l),persistent:""},{default:y(()=>[k(i,{style:{"min-width":"600px"}},{default:y(()=>[k(e,null,{default:y(()=>[b("div",$,f(g(z)("weeklyPlans.editPlan")),1)]),_:1}),k(e,null,{default:y(()=>{var l,e;return[b("div",x,[(null==(e=null==(l=J.value)?void 0:l.schedule)?void 0:e.id)?(w(),h("div",q,[b("div",C,[k(a,{modelValue:J.value.schedule.period_order,"onUpdate:modelValue":c[0]||(c[0]=l=>J.value.schedule.period_order=l),modelModifiers:{number:!0},type:"number",min:"1",label:g(z)("weeklyPlans.periodOrder"),dense:"",outlined:""},null,8,["modelValue","label"])])])):P("",!0),b("div",null,[k(a,{modelValue:J.value.cw,"onUpdate:modelValue":c[1]||(c[1]=l=>J.value.cw=l),label:g(z)("weeklyPlans.classwork"),type:"textarea",rows:4},null,8,["modelValue","label"]),b("div",L,[k(n,{dense:"",flat:"",icon:"link",label:g(z)("weeklyPlans.insertLink"),onClick:c[2]||(c[2]=l=>al("cw"))},null,8,["label"]),k(n,{dense:"",flat:"",icon:"content_copy",label:g(z)("weeklyPlans.copy"),onClick:c[3]||(c[3]=l=>R("cw"))},null,8,["label"]),k(n,{dense:"",flat:"",icon:"content_paste",label:g(z)("weeklyPlans.paste"),onClick:c[4]||(c[4]=l=>X("cw"))},null,8,["label"]),k(n,{dense:"",flat:"",icon:"clear",label:g(z)("weeklyPlans.clear"),onClick:c[5]||(c[5]=l=>G("cw"))},null,8,["label"])])]),b("div",null,[k(a,{modelValue:J.value.hw,"onUpdate:modelValue":c[6]||(c[6]=l=>J.value.hw=l),label:g(z)("weeklyPlans.homework"),type:"textarea",rows:4},null,8,["modelValue","label"]),b("div",T,[k(n,{dense:"",flat:"",icon:"link",label:g(z)("weeklyPlans.insertLink"),onClick:c[7]||(c[7]=l=>al("hw"))},null,8,["label"]),k(n,{dense:"",flat:"",icon:"content_copy",label:g(z)("weeklyPlans.copy"),onClick:c[8]||(c[8]=l=>R("hw"))},null,8,["label"]),k(n,{dense:"",flat:"",icon:"content_paste",label:g(z)("weeklyPlans.paste"),onClick:c[9]||(c[9]=l=>X("hw"))},null,8,["label"]),k(n,{dense:"",flat:"",icon:"clear",label:g(z)("weeklyPlans.clear"),onClick:c[10]||(c[10]=l=>G("hw"))},null,8,["label"])])]),b("div",null,[k(a,{modelValue:J.value.notes,"onUpdate:modelValue":c[11]||(c[11]=l=>J.value.notes=l),label:g(z)("weeklyPlans.notes"),type:"textarea",rows:4},null,8,["modelValue","label"]),b("div",U,[k(n,{dense:"",flat:"",icon:"link",label:g(z)("weeklyPlans.insertLink"),onClick:c[12]||(c[12]=l=>al("notes"))},null,8,["label"]),k(n,{dense:"",flat:"",icon:"content_copy",label:g(z)("weeklyPlans.copy"),onClick:c[13]||(c[13]=l=>R("notes"))},null,8,["label"]),k(n,{dense:"",flat:"",icon:"content_paste",label:g(z)("weeklyPlans.paste"),onClick:c[14]||(c[14]=l=>X("notes"))},null,8,["label"]),k(n,{dense:"",flat:"",icon:"clear",label:g(z)("weeklyPlans.clear"),onClick:c[15]||(c[15]=l=>G("notes"))},null,8,["label"])])])])]}),_:1}),k(t),k(e,null,{default:y(()=>[b("div",M,f(g(z)("weeklyPlans.preview")),1),b("div",j,[b("div",null,[c[22]||(c[22]=b("div",{class:"text-caption text-grey-7"},"CW",-1)),b("div",{class:"q-pa-sm preview-content",innerHTML:sl.value},null,8,H)]),b("div",null,[b("div",D,f(g(z)("weeklyPlans.teacher.hwLabel")),1),b("div",{class:"q-pa-sm preview-content",innerHTML:ol.value},null,8,I)]),b("div",null,[b("div",K,f(g(z)("weeklyPlans.teacher.notesLabel")),1),b("div",{class:"q-pa-sm preview-content",innerHTML:il.value},null,8,N)])])]),_:1}),k(e,{align:"right"},{default:y(()=>[k(n,{flat:"",label:g(z)("weeklyPlans.clear"),color:"negative",onClick:S,class:"q-mr-sm"},{default:y(()=>[k(s,null,{default:y(()=>[V(f(g(z)("weeklyPlans.clearAllTooltip")),1)]),_:1})]),_:1},8,["label"]),_(k(n,{flat:"",label:g(z)("weeklyPlans.cancel"),onClick:c[16]||(c[16]=e=>l.$emit("close")),color:"primary"},null,8,["label"]),[[r]]),k(n,{flat:"",label:g(z)("weeklyPlans.save"),onClick:c[17]||(c[17]=e=>l.$emit("submit",J.value)),color:"primary",loading:B.saving},null,8,["label","loading"])]),_:1}),k(o,{modelValue:Y.value,"onUpdate:modelValue":c[20]||(c[20]=l=>Y.value=l)},{default:y(()=>[k(i,{style:{"min-width":"420px"}},{default:y(()=>[k(e,null,{default:y(()=>[b("div",W,f(g(z)("weeklyPlans.linkDialog.title")),1)]),_:1}),k(e,{class:"q-gutter-md"},{default:y(()=>[k(a,{modelValue:ll.value,"onUpdate:modelValue":c[18]||(c[18]=l=>ll.value=l),label:g(z)("weeklyPlans.linkDialog.urlLabel"),type:"url"},null,8,["modelValue","label"]),k(a,{modelValue:el.value,"onUpdate:modelValue":c[19]||(c[19]=l=>el.value=l),label:g(z)("weeklyPlans.linkDialog.textLabel")},null,8,["modelValue","label"])]),_:1}),k(u,{align:"right"},{default:y(()=>[_(k(n,{flat:"",label:g(z)("weeklyPlans.linkDialog.cancel")},null,8,["label"]),[[r]]),k(n,{flat:"",label:g(z)("weeklyPlans.linkDialog.insert"),color:"primary",onClick:nl},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]))}};export{B as default};
