import{I as e,Y as n,Z as t,O as l,aI as a,Q as i,m as d,P as r,q as o,aw as c}from"./app-CWAnT6CT.js";import{p as s,f as u,G as y,a as k,k as f,h as p,n as v,y as h,Y as b}from"./vendor-BWKGNkNB.js";const g=["none","strict","leaf","leaf-filtered"],x=e({name:"QTree",props:{...n,nodes:{type:Array,required:!0},nodeKey:{type:String,required:!0},labelKey:{type:String,default:"label"},childrenKey:{type:String,default:"children"},dense:Boolean,color:String,controlColor:String,textColor:String,selectedColor:String,icon:String,tickStrategy:{type:String,default:"none",validator:e=>g.includes(e)},ticked:Array,expanded:Array,selected:{},noSelectionUnset:Boolean,defaultExpandAll:Boolean,accordion:Boolean,filter:String,filterMethod:Function,duration:{},noConnectors:Boolean,noTransition:Boolean,noNodesLabel:String,noResultsLabel:String},emits:["update:expanded","update:ticked","update:selected","lazyLoad","afterShow","afterHide"],setup(e,{slots:n,emit:g}){const{proxy:x}=s(),{$q:m}=x,_=t(e,m),q=u({}),K=u(e.ticked||[]),S=u(e.expanded||[]);let T={};y(()=>{T={}});const A=k(()=>"q-tree q-tree--"+(!0===e.dense?"dense":"standard")+(!0===e.noConnectors?" q-tree--no-connectors":"")+(!0===_.value?" q-tree--dark":"")+(void 0!==e.color?` text-${e.color}`:"")),C=k(()=>void 0!==e.selected),w=k(()=>e.icon||m.iconSet.tree.icon),E=k(()=>e.controlColor||e.color),F=k(()=>void 0!==e.textColor?` text-${e.textColor}`:""),z=k(()=>{const n=e.selectedColor||e.color;return n?` text-${n}`:""}),$=k(()=>void 0!==e.filterMethod?e.filterMethod:(n,t)=>{const l=t.toLowerCase();return n[e.labelKey]&&-1!==n[e.labelKey].toLowerCase().indexOf(l)}),L=k(()=>{const n={},t=(l,a)=>{const i=l.tickStrategy||(a?a.tickStrategy:e.tickStrategy),d=l[e.nodeKey],r=l[e.childrenKey]&&Array.isArray(l[e.childrenKey])&&0!==l[e.childrenKey].length,o=!0!==l.disabled&&!0===C.value&&!1!==l.selectable,c=!0!==l.disabled&&!1!==l.expandable,s="none"!==i,u="strict"===i,y="leaf-filtered"===i,k="leaf"===i||"leaf-filtered"===i;let f=!0!==l.disabled&&!1!==l.tickable;!0===k&&!0===f&&a&&!0!==a.tickable&&(f=!1);let p=l.lazy;!0===p&&void 0!==q.value[d]&&!0===Array.isArray(l[e.childrenKey])&&(p=q.value[d]);const v={key:d,parent:a,isParent:r,lazy:p,disabled:l.disabled,link:!0!==l.disabled&&(!0===o||!0===c&&(!0===r||!0===p)),children:[],matchesFilter:!e.filter||$.value(l,e.filter),selected:d===e.selected&&!0===o,selectable:o,expanded:!0===r&&S.value.includes(d),expandable:c,noTick:!0===l.noTick||!0!==u&&p&&"loaded"!==p,tickable:f,tickStrategy:i,hasTicking:s,strictTicking:u,leafFilteredTicking:y,leafTicking:k,ticked:(!0===u||!0!==r)&&K.value.includes(d)};if(n[d]=v,!0===r&&(v.children=l[e.childrenKey].map(e=>t(e,v)),e.filter&&(!0!==v.matchesFilter?v.matchesFilter=v.children.some(e=>e.matchesFilter):!0!==v.noTick&&!0!==v.disabled&&!0===v.tickable&&!0===y&&!0===v.children.every(e=>!0!==e.matchesFilter||!0===e.noTick||!0!==e.tickable)&&(v.tickable=!1)),!0===v.matchesFilter&&(!0!==v.noTick&&!0!==u&&!0===v.children.every(e=>e.noTick)&&(v.noTick=!0),k))){if(v.ticked=!1,v.indeterminate=v.children.some(e=>!0===e.indeterminate),v.tickable=!0===v.tickable&&v.children.some(e=>e.tickable),!0!==v.indeterminate){const e=v.children.reduce((e,n)=>!0===n.ticked?e+1:e,0);e===v.children.length?v.ticked=!0:e>0&&(v.indeterminate=!0)}!0===v.indeterminate&&(v.indeterminateNextState=v.children.every(e=>!0!==e.tickable||!0!==e.ticked))}return v};return e.nodes.forEach(e=>t(e,null)),n});function N(n){const t=[].reduce,l=(a,i)=>a||!i?a:!0===Array.isArray(i)?t.call(Object(i),l,a):i[e.nodeKey]===n?i:i[e.childrenKey]?l(null,i[e.childrenKey]):void 0;return l(null,e.nodes)}function B(){const n=[],t=l=>{l[e.childrenKey]&&0!==l[e.childrenKey].length&&!1!==l.expandable&&!0!==l.disabled&&(n.push(l[e.nodeKey]),l[e.childrenKey].forEach(t))};e.nodes.forEach(t),void 0!==e.expanded?g("update:expanded",n):S.value=n}function O(n,t,l=N(n),a=L.value[n]){if(a.lazy&&"loaded"!==a.lazy){if("loading"===a.lazy)return;q.value[n]="loading",!0!==Array.isArray(l[e.childrenKey])&&(l[e.childrenKey]=[]),g("lazyLoad",{node:l,key:n,done:t=>{q.value[n]="loaded",l[e.childrenKey]=!0===Array.isArray(t)?t:[],v(()=>{const e=L.value[n];!0===(null==e?void 0:e.isParent)&&P(n,!0)})},fail:()=>{delete q.value[n],0===l[e.childrenKey].length&&delete l[e.childrenKey]}})}else!0===a.isParent&&!0===a.expandable&&P(n,t)}function P(n,t){let l=S.value;const a=void 0!==e.expanded;if(!0===a&&(l=l.slice()),t){if(e.accordion&&L.value[n]){const t=[];L.value[n].parent?L.value[n].parent.children.forEach(e=>{e.key!==n&&!0===e.expandable&&t.push(e.key)}):e.nodes.forEach(l=>{const a=l[e.nodeKey];a!==n&&t.push(a)}),0!==t.length&&(l=l.filter(e=>!1===t.includes(e)))}l=l.concat([n]).filter((e,n,t)=>t.indexOf(e)===n)}else l=l.filter(e=>e!==n);!0===a?g("update:expanded",l):S.value=l}function j(n,t){let l=K.value;const a=void 0!==e.ticked;!0===a&&(l=l.slice()),l=t?l.concat(n).filter((e,n,t)=>t.indexOf(e)===n):l.filter(e=>!1===n.includes(e)),!0===a&&g("update:ticked",l)}function H(t){return(e.filter?t.filter(n=>L.value[n[e.nodeKey]].matchesFilter):t).map(t=>function(t){const s=t[e.nodeKey],u=L.value[s],y=t.header&&n[`header-${t.header}`]||n["default-header"],k=!0===u.isParent?H(t[e.childrenKey]):[],f=0!==k.length||u.lazy&&"loaded"!==u.lazy;let v=t.body&&n[`body-${t.body}`]||n["default-body"];const g=void 0!==y||void 0!==v?function(n,t,l){const a={tree:x,node:n,key:l,color:e.color,dark:_.value};return c(a,"expanded",()=>t.expanded,e=>{e!==t.expanded&&O(l,e)}),c(a,"ticked",()=>t.ticked,e=>{e!==t.ticked&&j([l],e)}),a}(t,u,s):null;void 0!==v&&(v=p("div",{class:"q-tree__node-body relative-position"},[p("div",{class:F.value},[v(g)])]));return p("div",{key:s,class:"q-tree__node relative-position q-tree__node--"+(!0===f?"parent":"child")},[p("div",{class:"q-tree__node-header relative-position row no-wrap items-center"+(!0===u.link?" q-tree__node--link q-hoverable q-focusable":"")+(!0===u.selected?" q-tree__node--selected":"")+(!0===u.disabled?" q-tree__node--disabled":""),tabindex:!0===u.link?0:-1,ariaExpanded:k.length>0?u.expanded:null,role:"treeitem",onClick:e=>{I(t,u,e)},onKeypress(e){!0!==l(e)&&(13===e.keyCode?I(t,u,e,!0):32===e.keyCode&&V(t,u,e,!0))}},[p("div",{class:"q-focus-helper",tabindex:-1,ref:e=>{T[u.key]=e}}),"loading"===u.lazy?p(a,{class:"q-tree__spinner",color:E.value}):!0===f?p(i,{class:"q-tree__arrow"+(!0===u.expanded?" q-tree__arrow--rotate":""),name:w.value,onClick(e){V(t,u,e)}}):null,!0===u.hasTicking&&!0!==u.noTick?p(d,{class:"q-tree__tickbox",modelValue:!0===u.indeterminate?null:u.ticked,color:E.value,dark:_.value,dense:!0,keepColor:!0,disable:!0!==u.tickable,onKeydown:r,"onUpdate:modelValue":e=>{!function(e,n){!0===e.indeterminate&&(n=e.indeterminateNextState);if(e.strictTicking)j([e.key],n);else if(e.leafTicking){const t=[],l=e=>{e.isParent?(!0!==n&&!0!==e.noTick&&!0===e.tickable&&t.push(e.key),!0===e.leafTicking&&e.children.forEach(l)):!0===e.noTick||!0!==e.tickable||!0===e.leafFilteredTicking&&!0!==e.matchesFilter||t.push(e.key)};l(e),j(t,n)}}(u,e)}}):null,p("div",{class:"q-tree__node-header-content col row no-wrap items-center"+(!0===u.selected?z.value:F.value)},[y?y(g):[M(t),p("div",t[e.labelKey])]])]),!0===f?!0===e.noTransition?!0===u.expanded?p("div",{class:"q-tree__node-collapsible"+F.value,key:`${s}__q`},[v,p("div",{class:"q-tree__children"+(!0===u.disabled?" q-tree__node--disabled":""),role:"group"},k)]):null:p(o,{duration:e.duration,onShow:Q,onHide:R},()=>h(p("div",{class:"q-tree__node-collapsible"+F.value,key:`${s}__q`},[v,p("div",{class:"q-tree__children"+(!0===u.disabled?" q-tree__node--disabled":""),role:"group"},k)]),[[b,u.expanded]])):v])}(t))}function M(e){if(void 0!==e.icon)return p(i,{class:"q-tree__icon q-mr-sm",name:e.icon,color:e.iconColor});const n=e.img||e.avatar;return n?p("img",{class:`q-tree__${e.img?"img":"avatar"} q-mr-sm`,src:n}):void 0}function Q(){g("afterShow")}function R(){g("afterHide")}function U(e){var n;null==(n=T[e])||n.focus()}function I(n,t,l,a){!0!==a&&!1!==t.selectable&&U(t.key),C.value&&t.selectable?!1===e.noSelectionUnset?g("update:selected",t.key!==e.selected?t.key:null):t.key!==e.selected&&g("update:selected",void 0===t.key?null:t.key):V(n,t,l,a),"function"==typeof n.handler&&n.handler(n)}function V(e,n,t,l){void 0!==t&&r(t),!0!==l&&!1!==n.selectable&&U(n.key),O(n.key,!n.expanded,e,n)}return f(()=>e.ticked,e=>{K.value=e}),f(()=>e.expanded,e=>{S.value=e}),!0===e.defaultExpandAll&&B(),Object.assign(x,{getNodeByKey:N,getTickedNodes:function(){return K.value.map(e=>N(e))},getExpandedNodes:function(){return S.value.map(e=>N(e))},isExpanded:function(e){return!(!e||!L.value[e])&&L.value[e].expanded},collapseAll:function(){void 0!==e.expanded?g("update:expanded",[]):S.value=[]},expandAll:B,setExpanded:O,isTicked:function(e){return!(!e||!L.value[e])&&L.value[e].ticked},setTicked:j}),()=>{const n=H(e.nodes);return p("div",{class:A.value,role:"tree"},0===n.length?e.filter?e.noResultsLabel||m.lang.tree.noResults:e.noNodesLabel||m.lang.tree.noNodes:n)}}});export{x as Q};
