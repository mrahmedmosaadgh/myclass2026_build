import{o as e,d as l,Q as a,C as s,m as t,a as n,b as o,p as u}from"./app-DOc39CFu.js";import{Q as i}from"./QLinearProgress-DkNjmMsH.js";import{Q as d}from"./QTab-Dldfuhzv.js";import{Q as r}from"./QTabs-CQbEg8iR.js";import{Q as c}from"./QTabPanels-D4WV1jNy.js";import{u as m}from"./i18n-DE5KxGn8.js";import{f as v,k as y,o as p,a as k,af as w,M as b,J as f,b as h,N as g,z as _,W as x,V as q,K as P,Q as S,F as W,R as j,_ as C,I as V,U as z}from"./vendor-DuKqz2x4.js";import N from"./WeekSelector-CgA-FaGE.js";import Q from"./WeeklyPlanEditor-D_Qo6L_5.js";import E from"./StatusBadge-oIYIv2hg.js";import"./offline-BzIlwqNM.js";import"./ui-BITzTqrO.js";import"./rtl-Cr6c3OOr.js";import"./use-panel-Ddka6S_L.js";import"./use-render-cache-CmTcazfP.js";import"./QSelect-Dkiz84LX.js";const M={class:"q-pa-md"},U={class:"row items-center q-mb-lg"},D={class:"col"},$={class:"q-ma-none text-weight-bold"},A={class:"text-grey-7 q-mb-none"},F={class:"row q-gutter-md items-center"},T={class:"col-auto"},H={class:"row items-center"},I={class:"col-auto q-ml-auto"},O={class:"col-auto"},J={class:"weekly-plans-grid"},L={class:"q-mb-md text-weight-bold"},B={class:"plans-grid"},K={class:"plan-header row items-center q-px-md q-py-sm"},R={class:"col"},Y={class:"text-subtitle2 text-weight-bold"},G={class:"text-caption"},X={class:"col-auto"},Z={class:"plan-content q-px-md q-py-sm"},ee={class:"plan-section q-mb-sm"},le={class:"plan-label"},ae={key:0},se={key:1,class:"text-grey-5"},te={class:"plan-section q-mb-sm"},ne={class:"plan-label"},oe={key:0},ue={key:1,class:"text-grey-5"},ie={class:"plan-section"},de={class:"plan-label"},re={key:0},ce={key:1,class:"text-grey-5"},me={class:"plan-actions row justify-end q-px-md q-py-sm"},ve={key:0,class:"text-center q-pa-xl"},ye={class:"text-h6 text-grey-7 q-mt-md"},pe={class:"text-grey-6"},ke=e({__name:"SimpleWeeklyPlans",setup(e){const{t:ke}=m(),we=v(!1),be=v(1),fe=v(1),he=v(18),ge=v(1),_e=v([]),xe=v(null),qe=v(null),Pe=v(!1),Se=v(null),We=v(!1),je=v("table"),Ce=e=>{const l=`weeklyPlans.fullDays.${e}`,a=ke(l);return a!==l?a:`Day ${e}`};async function Ve(){var e,l;try{const{data:a}=await C.get("/weekly-system/api/teacher/my-weekly-plans",{params:{week_number:be.value,semester_number:fe.value}}),s=Array.isArray(null==a?void 0:a.data)?a.data:Array.isArray(a)?a:[],t={};for(const n of s){const a=null!=(l=null==(e=null==n?void 0:n.schedule)?void 0:e.day)?l:0;t[a]||(t[a]={dayNumber:a,dayName:Ce(a),plans:[]}),t[a].plans.push({id:n.id,data:n,isEditing:!1,saving:!1})}Object.values(t).forEach(e=>{e.plans.sort((e,l)=>{var a,s,t,n;return((null==(s=null==(a=e.data)?void 0:a.schedule)?void 0:s.period_number)||0)-((null==(n=null==(t=l.data)?void 0:t.schedule)?void 0:n.period_number)||0)})}),_e.value=Object.values(t).sort((e,l)=>e.dayNumber-l.dayNumber)}catch(a){console.error("Error loading weekly plans:",a)}}function ze(){be.value>1&&(be.value--,Ve())}function Ne(){be.value<he.value&&(be.value++,Ve())}y(()=>be.value,e=>{e&&Ve()}),p(()=>{const e=new Date,l=new Date(e.getFullYear(),0,1),a=Math.floor((e-l)/864e5),s=Math.ceil((a+l.getDay()+1)/7);ge.value=Math.min(s,he.value),be.value=ge.value,Ve()});const Qe=k(()=>_e.value),Ee=k(()=>{if(0===_e.value.length)return 0;const e=_e.value.reduce((e,l)=>e+l.plans.length,0);if(0===e)return 0;const l=_e.value.reduce((e,l)=>e+l.plans.filter(e=>{var l;return"completed"===(null==(l=e.data)?void 0:l.status)}).length,0);return Math.round(l/e*100)}),Me=k(()=>{const e=Ee.value;return e<30?"negative":e<70?"warning":"positive"});k(()=>_e.value.flatMap(e=>e.plans.map(e=>e.data)));const Ue=async e=>{var l,a,s,t,n,o,u,i,d;if(null==(l=Se.value)?void 0:l.id)try{Pe.value=!0;const l=Number(null==(a=null==e?void 0:e.schedule)?void 0:a.period_order),r=Number(null==(t=null==(s=Se.value)?void 0:s.schedule)?void 0:t.period_order),c=null==(o=null==(n=Se.value)?void 0:n.schedule)?void 0:o.id;c&&Number.isFinite(l)&&l>0&&l!==r&&await C.put(`/weekly-system/api/schedules/${c}/period-order`,{period_order:l}),await C.put(`/weekly-system/api/weekly-plans/${Se.value.id}`,{cw:null!=(u=null==e?void 0:e.cw)?u:"",hw:null!=(i=null==e?void 0:e.hw)?i:"",notes:null!=(d=null==e?void 0:e.notes)?d:""}),We.value=!1,await Ve()}catch(r){console.error("Failed to save weekly plan",r)}finally{Pe.value=!1}};return(e,m)=>{const v=w("Head");return f(),b(W,null,[h(v,{title:_(ke)("weeklySystem.myWeeklyPlans.title")},null,8,["title"]),g("div",M,[g("div",U,[g("div",D,[g("h4",$,[h(l,{name:"edit_note",class:"q-mr-sm",color:"primary"}),x(" "+q(_(ke)("weeklySystem.myWeeklyPlans.title")),1)]),g("p",A,q(_(ke)("weeklySystem.myWeeklyPlans.subtitle")),1)])]),h(t,{flat:"",bordered:"",class:"q-pa-md q-mb-lg"},{default:P(()=>[g("div",F,[g("div",T,[g("div",H,[h(a,{icon:"chevron_left",color:"primary",round:"",flat:"",onClick:ze,disable:be.value<=1},null,8,["disable"]),h(N,{modelValue:be.value,"onUpdate:modelValue":m[0]||(m[0]=e=>be.value=e),"max-weeks":he.value,"current-week":ge.value,class:"q-mx-md"},null,8,["modelValue","max-weeks","current-week"]),h(a,{icon:"chevron_right",color:"primary",round:"",flat:"",onClick:Ne,disable:be.value>=he.value},null,8,["disable"])])]),g("div",I,[h(i,{value:Ee.value/100,size:"25px",color:Me.value,"track-color":"grey-3",rounded:"",style:{width:"150px"}},null,8,["value","color"])]),g("div",O,[h(s,{color:Me.value,"text-color":"white",label:`${Ee.value}%`},null,8,["color","label"])])])]),_:1}),h(r,{modelValue:je.value,"onUpdate:modelValue":m[1]||(m[1]=e=>je.value=e),dense:"",class:"text-primary q-mb-sm"},{default:P(()=>[h(d,{name:"table",icon:"table_chart",label:_(ke)("weeklySystem.myWeeklyPlans.tableView")},null,8,["label"])]),_:1},8,["modelValue"]),h(n,{class:"q-mb-md"}),h(c,{modelValue:je.value,"onUpdate:modelValue":m[2]||(m[2]=e=>je.value=e),animated:""},{default:P(()=>[g("div",J,[(f(!0),b(W,null,j(Qe.value,e=>(f(),b("div",{key:e.dayNumber,class:"day-section q-mb-xl"},[g("h5",L,[x(q(Ce(e.dayNumber))+" ",1),h(s,{dense:"",color:Me.value,"text-color":"white",label:e.plans.length},null,8,["color","label"])]),g("div",B,[(f(!0),b(W,null,j(e.plans,e=>(f(),V(t,{key:e.id,flat:"",bordered:"",class:z(["plan-card q-mr-sm q-mb-sm",{copied:xe.value===e.id}])},{default:P(()=>{var s,t,n,o,i,d,r,c,m,v,y,p,k;return[g("div",K,[g("div",R,[g("div",Y,[h(l,{name:"meeting_room",size:"sm",color:"primary"}),x(" "+q((null==(n=null==(t=null==(s=e.data)?void 0:s.schedule)?void 0:t.cst)?void 0:n.classroom_name)||_(ke)("weeklySystem.myWeeklyPlans.noClassroom")),1)]),g("div",G,[h(l,{name:"school",size:"xs",color:"primary"}),x(" "+q((null==(d=null==(i=null==(o=e.data)?void 0:o.schedule)?void 0:i.cst)?void 0:d.subject_name)||_(ke)("weeklySystem.myWeeklyPlans.noSubject")),1)])]),g("div",X,[h(E,{status:(null==(r=e.data)?void 0:r.status)||"empty"},null,8,["status"])])]),g("div",Z,[g("div",ee,[g("div",le,q(_(ke)("weeklySystem.myWeeklyPlans.classwork"))+" (CW)",1),g("div",{class:z(["plan-content-text",{empty:!(null==(c=e.data)?void 0:c.cw)}])},[h(l,{name:"school",size:"xs",color:"primary"}),(null==(m=e.data)?void 0:m.cw)?(f(),b("span",ae,q(e.data.cw),1)):(f(),b("span",se,q(_(ke)("weeklySystem.myWeeklyPlans.noClasswork")),1))],2)]),g("div",te,[g("div",ne,q(_(ke)("weeklySystem.myWeeklyPlans.homework"))+" (HW)",1),g("div",{class:z(["plan-content-text",{empty:!(null==(v=e.data)?void 0:v.hw)}])},[h(l,{name:"home_work",size:"xs",color:"amber"}),(null==(y=e.data)?void 0:y.hw)?(f(),b("span",oe,q(e.data.hw),1)):(f(),b("span",ue,q(_(ke)("weeklySystem.myWeeklyPlans.noHomework")),1))],2)]),g("div",ie,[g("div",de,q(_(ke)("weeklySystem.myWeeklyPlans.notes")),1),g("div",{class:z(["plan-content-text",{empty:!(null==(p=e.data)?void 0:p.notes)}])},[h(l,{name:"note",size:"xs",color:"secondary"}),(null==(k=e.data)?void 0:k.notes)?(f(),b("span",re,q(e.data.notes),1)):(f(),b("span",ce,q(_(ke)("weeklySystem.myWeeklyPlans.noNotes")),1))],2)])]),g("div",me,[we.value||qe.value&&xe.value===e.id?S("",!0):(f(),V(a,{key:0,icon:"content_copy",size:"sm",flat:"",color:"primary",onClick:l=>(e=>{var l,a,s,t;xe.value=null!=(l=null==e?void 0:e.id)?l:null,qe.value={cw:(null==(a=null==e?void 0:e.data)?void 0:a.cw)||"",hw:(null==(s=null==e?void 0:e.data)?void 0:s.hw)||"",notes:(null==(t=null==e?void 0:e.data)?void 0:t.notes)||""}})(e),class:"q-mr-sm"},{default:P(()=>[h(u,null,{default:P(()=>[x(q(_(ke)("weeklySystem.myWeeklyPlans.copied")),1)]),_:1})]),_:2},1032,["onClick"])),!we.value&&qe.value&&xe.value!==e.id?(f(),V(a,{key:1,icon:"content_paste",size:"sm",flat:"",color:"primary",onClick:l=>(async e=>{var l,a;qe.value&&(Se.value=null!=(l=null==e?void 0:e.data)?l:null,(null==(a=Se.value)?void 0:a.id)&&await Ue({cw:qe.value.cw,hw:qe.value.hw,notes:qe.value.notes}))})(e),class:"q-mr-sm"},{default:P(()=>[h(u,null,{default:P(()=>[x(q(_(ke)("weeklySystem.myWeeklyPlans.paste")),1)]),_:1})]),_:2},1032,["onClick"])):S("",!0),we.value?S("",!0):(f(),V(a,{key:2,icon:"edit",size:"sm",flat:"",color:"primary",onClick:l=>(e=>{var l;Se.value=null!=(l=null==e?void 0:e.data)?l:null,Se.value&&(We.value=!0)})(e)},{default:P(()=>[h(u,null,{default:P(()=>[x(q(_(ke)("weeklySystem.myWeeklyPlans.edit")),1)]),_:1})]),_:2},1032,["onClick"])),we.value&&e.isEditing?(f(),V(a,{key:3,icon:"save",size:"sm",flat:"",color:"green",loading:e.saving,onClick:l=>(async e=>{(null==e?void 0:e.data)&&(Se.value=e.data,await Ue(e.data))})(e)},{default:P(()=>[h(u,null,{default:P(()=>[x(q(_(ke)("weeklySystem.myWeeklyPlans.save")),1)]),_:1})]),_:2},1032,["loading","onClick"])):S("",!0),we.value&&e.isEditing?(f(),V(a,{key:4,icon:"cancel",size:"sm",flat:"",color:"red",onClick:e=>{}},{default:P(()=>[h(u,null,{default:P(()=>[x(q(_(ke)("weeklySystem.myWeeklyPlans.cancel")),1)]),_:1})]),_:2},1032,["onClick"])):S("",!0)])]}),_:2},1032,["class"]))),128))])]))),128))]),_e.value.length?S("",!0):(f(),b("div",ve,[h(l,{name:"edit_note",size:"64px",color:"grey-5"}),g("p",ye,q(_(ke)("weeklySystem.myWeeklyPlans.noPlans")),1),g("p",pe,q(_(ke)("weeklySystem.myWeeklyPlans.selectWeek")),1)]))]),_:1},8,["modelValue"]),h(o,{modelValue:We.value,"onUpdate:modelValue":m[5]||(m[5]=e=>We.value=e),persistent:""},{default:P(()=>[h(Q,{modelValue:We.value,"onUpdate:modelValue":m[3]||(m[3]=e=>We.value=e),plan:Se.value,saving:Pe.value,onSubmit:Ue,onClose:m[4]||(m[4]=e=>We.value=!1)},null,8,["modelValue","plan","saving"])]),_:1},8,["modelValue"])])],64)}}},[["__scopeId","data-v-608fe1db"]]);export{ke as default};
