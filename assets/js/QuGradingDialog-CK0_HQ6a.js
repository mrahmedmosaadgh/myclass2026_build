import{p as e,u as a,e as t,aD as s,Q as l,q as d,aq as o,B as r,n as i,d as n,C as u,a as c,h as m,i as v,j as p,g as f,m as g,f as b,b as _}from"./app-BXm70mdJ.js";import{Q as q}from"./QSpace-Bu8V-QDa.js";import{Q as x}from"./QBar-ulmxe8C-.js";import{Q as w}from"./QForm-DyZk5PSh.js";import{s as y}from"./i18n-CBOKL2HS.js";import{r as h}from"./katex-BAATRBTg.js";import{d as k}from"./date-Dajz2muc.js";import{a as M,f as V,r as j,k as Q,H,I as L,J as A,b as F,L as S,M as T,x as U,U as C,V as G,O as I,Q as N,y as O,F as D}from"./vendor-DNM7Y6Xn.js";import"./offline-BzIlwqNM.js";import"./ui-BP0GJNn5.js";import"./katex-BXKQVcz-.js";const E={class:"text-subtitle1"},Y={key:0,class:"row justify-center items-center full-height q-pa-xl"},z={class:"q-pa-md"},B={class:"row q-gutter-md q-mb-md"},R={class:"col-12 col-sm-6 col-md-3"},$={class:"text-subtitle1"},J={class:"col-12 col-sm-6 col-md-3"},P={class:"text-subtitle1"},K={class:"col-12 col-sm-6 col-md-3"},W={class:"text-subtitle1"},X={class:"col-12 col-sm-6 col-md-3"},Z={class:"row items-start"},ee={class:"col"},ae={class:"text-subtitle1 text-weight-bold q-mb-sm"},te=["innerHTML"],se={class:"q-mb-sm"},le={class:"col-auto text-center"},de={class:"text-subtitle1 text-weight-bold q-mb-sm"},oe=["innerHTML"],re={key:0,class:"q-mb-md"},ie=["innerHTML"],ne={class:"q-mb-md"},ue=["innerHTML"],ce={class:"row q-gutter-md"},me={class:"col-12 col-sm-3"},ve={class:"col"},pe=e({__name:"QuGradingDialog",props:{modelValue:Boolean,attemptId:Number},emits:["update:modelValue","graded"],setup(e,{emit:pe}){const fe=e,ge=pe,be=a(),_e=M({get:()=>fe.modelValue,set:e=>ge("update:modelValue",e)}),qe=V(!1),xe=V(!1),we=V(null),ye=V([]),he=V([]),ke=V(0),Me=j({});Q(()=>fe.attemptId,e=>{e&&fe.modelValue&&Ve(e)}),Q(()=>fe.modelValue,e=>{e&&fe.attemptId&&Ve(fe.attemptId)});const Ve=async e=>{qe.value=!0;try{const a=await window.axios.get(y("qu-exams.grading-data",e));we.value=a.data.attempt,ye.value=a.data.autoGraded,he.value=a.data.manualQuestions,ke.value=a.data.totalMarks,Object.keys(Me).forEach(e=>delete Me[e]),he.value.forEach(e=>{var a,t;Me[e.answer.id]={answer_id:e.answer.id,marks_obtained:null!=(a=e.answer.marks_obtained)?a:0,feedback:null!=(t=e.answer.feedback)?t:""}})}catch(a){console.error("Failed to load grading data",a),be.notify({type:"negative",message:"Failed to load grading data"})}finally{qe.value=!1}},je=M(()=>{let e=0;return ye.value&&ye.value.forEach(a=>{e+=parseFloat(a.answer.marks_obtained)||0}),Object.values(Me).forEach(a=>{e+=parseFloat(a.marks_obtained)||0}),Math.round(e)}),Qe=M(()=>{var e;const a=null==(e=we.value)?void 0:e.grading_status;return"completed"===a?"positive":"partial"===a?"orange":"grey"}),He=M(()=>{var e;const a=null==(e=we.value)?void 0:e.grading_status;return a?a.charAt(0).toUpperCase()+a.slice(1):""}),Le=e=>{var a;if("mcq"===e.question.question_type)return e.answer.selected_options||"No answer";if("true_false"===e.question.question_type){const t=null==(a=e.answer.selected_options)?void 0:a[0];return t?t.charAt(0).toUpperCase()+t.slice(1):"No answer"}return"No answer"},Ae=async()=>{var e,a,t;xe.value=!0;try{await window.axios.post(y("qu-grading.save",we.value.id),{grades:Object.values(Me)}),be.notify({type:"positive",message:"Grades saved successfully"}),ge("graded"),_e.value=!1}catch(s){console.error("Failed to save grades",s);let l="Failed to save grades";(null==(t=null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.errors)?void 0:t.grades)&&(l=s.response.data.errors.grades),be.notify({type:"negative",message:l})}finally{xe.value=!1}};return(e,a)=>(L(),H(_,{modelValue:_e.value,"onUpdate:modelValue":a[0]||(a[0]=e=>_e.value=e),maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:A(()=>[F(i,{class:"column no-wrap"},{default:A(()=>[F(x,{class:"bg-primary text-white"},{default:A(()=>{var e,o,r,i;return[F(t,{name:"edit_note"}),T("div",E," Grading: "+C(null==(o=null==(e=we.value)?void 0:e.user)?void 0:o.name)+" - "+C(null==(i=null==(r=we.value)?void 0:r.exam)?void 0:i.title),1),F(q),U((L(),H(l,{dense:"",flat:"",icon:"close"},{default:A(()=>[F(d,null,{default:A(()=>a[1]||(a[1]=[G("Close")])),_:1})]),_:1})),[[s]])]}),_:1}),qe.value?(L(),S("div",Y,[F(o,{color:"primary",size:"3em"}),a[2]||(a[2]=T("div",{class:"q-ml-sm"},"Loading grading data...",-1))])):(L(),H(r,{key:1,class:"col"},{default:A(()=>[T("div",z,[T("div",B,[T("div",R,[F(i,{flat:"",bordered:""},{default:A(()=>[F(n,{class:"text-center q-pa-sm"},{default:A(()=>{var e,t;return[T("div",$,C(null==(t=null==(e=we.value)?void 0:e.user)?void 0:t.name),1),a[3]||(a[3]=T("div",{class:"text-caption text-grey-7"},"Student",-1))]}),_:1})]),_:1})]),T("div",J,[F(i,{flat:"",bordered:""},{default:A(()=>[F(n,{class:"text-center q-pa-sm"},{default:A(()=>{var e,t;return[T("div",P,C((t=null==(e=we.value)?void 0:e.completed_at,t?k.formatDate(t,"YYYY-MM-DD HH:mm"):"")),1),a[4]||(a[4]=T("div",{class:"text-caption text-grey-7"},"Submitted",-1))]}),_:1})]),_:1})]),T("div",K,[F(i,{flat:"",bordered:""},{default:A(()=>[F(n,{class:"text-center q-pa-sm"},{default:A(()=>[T("div",W,C(je.value)+" / "+C(ke.value),1),a[5]||(a[5]=T("div",{class:"text-caption text-grey-7"},"Current Score",-1))]),_:1})]),_:1})]),T("div",X,[F(i,{flat:"",bordered:""},{default:A(()=>[F(n,{class:"text-center q-pa-sm"},{default:A(()=>[F(u,{color:Qe.value,"text-color":"white",dense:""},{default:A(()=>[G(C(He.value),1)]),_:1},8,["color"]),a[6]||(a[6]=T("div",{class:"text-caption text-grey-7"},"Status",-1))]),_:1})]),_:1})])]),F(c,{class:"q-mb-md"}),ye.value.length>0?(L(),H(i,{key:0,flat:"",bordered:"",class:"q-mb-md"},{default:A(()=>[F(n,null,{default:A(()=>a[7]||(a[7]=[T("div",{class:"text-h6"},"Auto-Graded Questions",-1)])),_:1}),F(m,{separator:""},{default:A(()=>[(L(!0),S(D,null,N(ye.value,(e,s)=>(L(),H(v,{key:"auto-"+e.question.id,class:"q-pa-md"},{default:A(()=>[F(p,null,{default:A(()=>[T("div",Z,[T("div",ee,[T("div",ae," Question "+C(s+1),1),T("div",{class:"text-body1 q-mb-md",innerHTML:O(h)(e.question.question_text)},null,8,te),T("div",se,[a[8]||(a[8]=T("div",{class:"text-caption text-grey-7"},"Student Answer:",-1)),F(u,{color:e.is_correct?"positive":"negative","text-color":"white",dense:""},{default:A(()=>[G(C(Le(e)),1)]),_:2},1032,["color"])])]),T("div",le,[F(u,{color:e.is_correct?"positive":"negative","text-color":"white"},{default:A(()=>[F(t,{name:e.is_correct?"check_circle":"cancel",size:"sm",class:"q-mr-sm"},null,8,["name"]),G(" "+C(e.answer.marks_obtained)+" / "+C(e.question.marks),1)]),_:2},1032,["color"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):I("",!0),he.value.length>0?(L(),H(i,{key:1,flat:"",bordered:""},{default:A(()=>[F(n,null,{default:A(()=>a[9]||(a[9]=[T("div",{class:"text-h6"},"Questions Requiring Manual Grading",-1)])),_:1}),F(w,{onSubmit:Ae},{default:A(()=>[F(m,{separator:""},{default:A(()=>[(L(!0),S(D,null,N(he.value,(e,t)=>(L(),H(v,{key:"manual-"+e.question.id,class:"q-pa-md"},{default:A(()=>[F(p,null,{default:A(()=>[T("div",de," Question "+C(ye.value.length+t+1),1),T("div",{class:"text-body1 q-mb-md",innerHTML:O(h)(e.question.question_text)},null,8,oe),e.question.correct_answer?(L(),S("div",re,[a[10]||(a[10]=T("div",{class:"text-caption text-grey-7 q-mb-xs"},"Model Answer:",-1)),F(i,{flat:"",bordered:"",class:"q-pa-sm bg-green-1"},{default:A(()=>[T("div",{innerHTML:O(h)(e.question.correct_answer)},null,8,ie)]),_:2},1024)])):I("",!0),T("div",ne,[a[11]||(a[11]=T("div",{class:"text-caption text-grey-7 q-mb-xs"},"Student Answer:",-1)),F(i,{flat:"",bordered:"",class:"q-pa-sm bg-grey-1"},{default:A(()=>[T("div",{innerHTML:O(h)(e.answer.answer_text||"No answer provided")},null,8,ue)]),_:2},1024)]),T("div",ce,[T("div",me,[F(f,{modelValue:Me[e.answer.id].marks_obtained,"onUpdate:modelValue":a=>Me[e.answer.id].marks_obtained=a,modelModifiers:{number:!0},type:"number",label:"Marks Awarded",hint:`Out of ${e.question.marks}`,rules:[e=>null!==e&&""!==e||"Required",e=>e>=0||"Must be >= 0",a=>a<=e.question.marks||`Max ${e.question.marks}`],outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue","hint","rules"])]),T("div",ve,[F(f,{modelValue:Me[e.answer.id].feedback,"onUpdate:modelValue":a=>Me[e.answer.id].feedback=a,type:"textarea",label:"Feedback (Optional)",hint:"Provide feedback to help the student improve",outlined:"",dense:"",rows:"3"},null,8,["modelValue","onUpdate:modelValue"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),F(g,{align:"right",class:"q-pa-md"},{default:A(()=>[U(F(l,{flat:"",label:"Cancel",color:"grey"},null,512),[[s]]),F(l,{type:"submit",label:"Save Grades",color:"primary",icon:"save",loading:xe.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})):ye.value.length>0?(L(),H(b,{key:2,class:"bg-positive text-white q-mt-md"},{avatar:A(()=>[F(t,{name:"check_circle"})]),default:A(()=>[a[12]||(a[12]=G(" All questions have been auto-graded. No manual grading required. "))]),_:1})):I("",!0)])]),_:1}))]),_:1})]),_:1},8,["modelValue"]))}},[["__scopeId","data-v-fce6dee0"]]);export{pe as default};
