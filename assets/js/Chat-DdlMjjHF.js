import{f as e,a,o as s,e as t,L as r,I as i,b as o,M as l,y as n,a3 as d,U as c,J as u,V as g,P as v,F as m,Q as y,S as p,$ as f,x,ab as b,n as h,Z as k}from"./vendor-EI0FRBVb.js";import{u as w,a_ as _}from"./app-BzjXrVp9.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./ui-B__oX9pK.js";const j={class:"flex justify-between items-center"},E={class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},N={class:"py-12"},S={class:"max-w-4xl mx-auto sm:px-6 lg:px-8"},C={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},I={class:"flex flex-col h-[600px]"},U={class:"p-4 border-b dark:border-gray-700 flex items-center"},A={class:"flex-shrink-0"},F=["src"],L={class:"ml-3"},T={class:"text-lg font-medium text-gray-900 dark:text-gray-100"},J={class:"text-sm text-gray-500 dark:text-gray-400"},P={key:0,class:"flex items-center justify-center h-full"},R={class:"break-words"},V={class:"text-xs mt-1 opacity-70"},$={class:"p-4 border-t dark:border-gray-700"},B=["disabled"],D=["disabled"],H={__name:"Chat",props:{conversation:Object,messages:Array},setup(H){const M=H,O=e(null),Q=e(""),Z=e(!1),q=e([]),z=w(),G=a(()=>[...M.messages,...q.value]),K=e=>{if(!e)return"Just now";try{return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(a){return console.error("Error formatting time:",a),"Invalid time"}},W=async()=>{O.value&&(await h(),O.value.scrollTop=O.value.scrollHeight)},X=async()=>{if(Q.value.trim()&&!Z.value){Z.value=!0;try{const e=await k.post(route("private-chat.send-message",M.conversation.id),{message:Q.value.trim()});q.value.push(e.data),Q.value="",await W()}catch(e){console.error("Error sending message:",e),z.notify({message:"Failed to send message",caption:"Please try again",color:"negative",icon:"error",position:"top",timeout:3e3})}finally{Z.value=!1}}},Y=async()=>{try{const e=(await k.get(route("private-chat.get-messages",M.conversation.id))).data,a=[...M.messages,...q.value].map(e=>e.id);let s=0;e.forEach(e=>{a.includes(e.id)||(q.value.push(e),s++)}),s>0&&W()}catch(e){console.error("Error refreshing messages:",e),e.response&&z.notify({message:"Error refreshing messages",color:"warning",icon:"sync_problem",position:"bottom-right",timeout:3e3})}},ee=e(null);return s(()=>{W(),(()=>{const e=M.conversation.user.id;_.markNotificationAsRead(e,M.conversation.id),_.listenForNotifications(e,a=>{if(!a)return;const s=a[M.conversation.id];s&&!s.is_read&&(_.markNotificationAsRead(e,M.conversation.id),Y())})})(),ee.value=setInterval(()=>{Y()},1e4)}),t(()=>{ee.value&&clearInterval(ee.value),_.removeNotificationListener(M.conversation.user.id)}),(e,a)=>(i(),r(m,null,[o(n(d),{title:`Chat with ${H.conversation.user.name}`},null,8,["title"]),l("div",j,[l("h2",E," Chat with "+c(H.conversation.user.name),1),o(n(v),{href:e.route("private-chat.index"),class:"px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition"},{default:u(()=>a[1]||(a[1]=[g(" Back to Users ")])),_:1},8,["href"])]),l("div",N,[l("div",S,[l("div",C,[l("div",I,[l("div",U,[l("div",A,[l("img",{src:H.conversation.user.profile_photo_url,alt:"User avatar",class:"h-10 w-10 rounded-full"},null,8,F)]),l("div",L,[l("h3",T,c(H.conversation.user.name),1),l("p",J,c(H.conversation.user.email),1)])]),l("div",{class:"flex-1 p-4 overflow-y-auto",ref_key:"messagesContainer",ref:O},[0===G.value.length?(i(),r("div",P,a[2]||(a[2]=[l("p",{class:"text-gray-500 dark:text-gray-400"}," No messages yet. Start the conversation! ",-1)]))):(i(!0),r(m,{key:1},y(G.value,e=>(i(),r("div",{key:e.id,class:p(["mb-4",e.is_mine?"flex justify-end":"flex justify-start"])},[l("div",{class:p(["max-w-[70%] rounded-lg p-3",e.is_mine?"bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-700 dark:text-gray-200"])},[l("div",R,c(e.body),1),l("div",V,c(K(e.created_at)),1)],2)],2))),128))],512),l("div",$,[l("form",{onSubmit:f(X,["prevent"]),class:"flex gap-2"},[x(l("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>Q.value=e),type:"text",placeholder:"Type a message...",class:"flex-1 px-4 py-2 border dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-600",disabled:Z.value},null,8,B),[[b,Q.value]]),l("button",{type:"submit",class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 transition",disabled:!Q.value.trim()||Z.value}," Send ",8,D)],32)])])])])])],64))}};export{H as default};
