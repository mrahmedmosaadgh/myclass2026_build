import{p as e}from"./app-Dccx8xF5.js";import{f as t,a as n,o,z as l,L as a,I as s,M as i,V as u,x as r,ab as c,$ as p}from"./vendor-EI0FRBVb.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./ui-B__oX9pK.js";const v={class:"pad"},d={class:"toolbar"},f=["disabled"],h=["disabled"],m=["disabled"],g=["disabled"],x={class:"canvas-wrapper"},y=800,b=500,w=e({__name:"FingerDrawingDemo copy",emits:["export-json"],setup(e,{emit:w}){const C=t(null);let T=null;const k=t([]),j=t([]);let _=null,R=!1;const z=t(!1),I=t("#111111"),L=t(3);let M=null,A=null;const F=w;function S(){T.clearRect(0,0,y,b),M?T.drawImage(M,0,0,y,b):A&&(T.font="16px sans-serif",T.fillStyle="#888",T.fillText(A,20,40));for(const e of k.value)q(e);_&&q(_)}function U(e){const t=C.value.getBoundingClientRect();return e.touches&&e.touches[0]?{x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}:{x:e.clientX-t.left,y:e.clientY-t.top}}function q(e){const t=e.points;if(!(t.length<2)){T.strokeStyle=e.color,T.lineWidth=e.size,T.beginPath(),T.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length-1;e++){const n=(t[e].x+t[e+1].x)/2,o=(t[e].y+t[e+1].y)/2;T.quadraticCurveTo(t[e].x,t[e].y,n,o)}T.lineTo(t[t.length-1].x,t[t.length-1].y),T.stroke()}}function D(e){R=!0;const t=U(e);_={points:[{x:t.x,y:t.y,t:0}],color:I.value,size:L.value,_startTime:performance.now()}}function E(e){if(!R||!_)return;const t=U(e),n=performance.now()-_._startTime;_.points.push({x:t.x,y:t.y,t:n}),S()}function P(){R&&(R=!1,_&&(delete _._startTime,k.value.push(_),j.value=[]),_=null,S())}function J(){k.value.length>0&&(j.value.push(k.value.pop()),S())}function O(){j.value.length>0&&(k.value.push(j.value.pop()),S())}function V(){k.value=[],j.value=[],S()}const W=n(()=>k.value.length>0),X=n(()=>j.value.length>0);function Y(){if(z.value||0===k.value.length)return;z.value=!0;let e=0,t=performance.now();requestAnimationFrame(function n(o){S();for(let t=0;t<e;t++)q(k.value[t]);if(e>=k.value.length)return void(z.value=!1);const l=k.value[e],a=o-t,s=l.points,i=s[s.length-1].t,u=s.findIndex(e=>e.t>a),r=-1===u?s.length:u;q({...l,points:s.slice(0,r)}),a>=i&&(e++,t=o),requestAnimationFrame(n)})}function B(e){const t=e.clipboardData.items;for(const n of t){if(n.type.startsWith("image/")){const e=n.getAsFile(),t=new Image;return t.onload=()=>{M=t,A=null,S()},void(t.src=URL.createObjectURL(e))}if("text/plain"===n.type)return void n.getAsString(e=>{A=e,M=null,S()})}}function N(){const e={version:1,width:y,height:b,strokes:k.value.map(e=>({points:e.points,color:e.color,size:e.size}))};F("export-json",e)}return o(()=>{!function(){const e=C.value,t=window.devicePixelRatio||1;e.width=y*t,e.height=b*t,e.style.width=y+"px",e.style.height=b+"px",T=e.getContext("2d"),T.scale(t,t),T.lineCap="round",T.lineJoin="round",S()}(),window.addEventListener("paste",B)}),l(()=>{window.removeEventListener("paste",B)}),(e,t)=>(s(),a("div",v,[i("div",d,[i("label",null,[t[1]||(t[1]=u(" Pen Color: ")),r(i("input",{type:"color","onUpdate:modelValue":t[0]||(t[0]=e=>I.value=e)},null,512),[[c,I.value]])]),i("button",{onClick:J,disabled:!W.value},"Undo",8,f),i("button",{onClick:O,disabled:!X.value},"Redo",8,h),i("button",{onClick:V},"Clear"),i("button",{onClick:Y,disabled:z.value||0===k.value.length},"Replay",8,m),i("button",{onClick:N,disabled:0===k.value.length},"Export JSON",8,g)]),i("div",x,[i("canvas",{ref_key:"canvas",ref:C,class:"canvas",onMousedown:D,onMousemove:E,onMouseup:P,onMouseleave:P,onTouchstart:p(D,["prevent"]),onTouchmove:p(E,["prevent"]),onTouchend:p(P,["prevent"])},null,544)])]))}},[["__scopeId","data-v-352d3a0b"]]);export{w as default};
