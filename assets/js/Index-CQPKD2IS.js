import{a as e,f as r,L as s,I as a,b as t,M as l,y as i,a3 as o,H as n,O as u,U as c,J as d,V as m,F as p,Z as b,_ as j}from"./vendor-EI0FRBVb.js";import{_ as y}from"./PrimaryButton-D4MqeasW.js";import{_ as v}from"./Pagination-wcG7j81T.js";import{_ as f}from"./DataTable-ByHcWWGX.js";import{_}from"./FormModal-D0sNxqUR.js";import"./LucideIcon-DP3BSI4t.js";import"./createLucideIcon-APVJ2SH-.js";import"./align-right-CnRMXp62.js";import"./underline-PDlIMkNx.js";import"./image-CpjPXLZL.js";import"./printer-DTcC0fi8.js";import"./Modal-Bpd3oPmg.js";import"./app-DXXarK7I.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./ui-B__oX9pK.js";import"./SecondaryButton-UHI6KqaH.js";const g={class:"py-12"},h={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},A={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-6"},S={class:"flex justify-between mb-6"},x="Grades",w="/admin/grade",k={__name:"Index",props:{records:{type:Object,required:!0},schools:{type:Array,required:!0},stages:{type:Array,required:!0},subjects:{type:Array,required:!0}},setup(k){const q=k,N=e(()=>{var e;return(null==(e=q.records)?void 0:e.data)||[]}),O=e(()=>{var e;return(null==(e=q.records)?void 0:e.links)||null}),E=x+" Management",D=[{key:"name",label:"Name"},{key:"stage.name",label:"Stage"},{key:"school.name",label:"School"},{key:"subjects",label:"Subjects",formatter:(e,r)=>{if(Array.isArray(e))return e.map(e=>e.name).join(", ");if(!e&&!(null==r?void 0:r.subjects))return"";if((null==r?void 0:r.subjects)&&Array.isArray(r.subjects))return r.subjects.map(e=>e.name).join(", ");if(null==r?void 0:r.subject_ids)try{const e="string"==typeof r.subject_ids?JSON.parse(r.subject_ids):r.subject_ids;return Array.isArray(e)?q.subjects.filter(r=>e.includes(r.id)).map(e=>e.name).join(", "):""}catch(s){return console.error("Error parsing subject_ids:",s),""}return""}}],I=[{name:"name",label:"Name",type:"text",required:!0,autofocus:!0},{name:"school_id",label:"School",type:"select",required:!0,options:e(()=>q.schools.map(e=>({value:e.id,label:e.name})))},{name:"stage_id",label:"Stage",type:"select",required:!0,options:e(()=>q.stages.map(e=>({value:e.id,label:e.name})))},{name:"subject_ids",label:"Subjects",type:"multiselect",options:e(()=>q.subjects.map(e=>({value:e.id,label:e.name}))),multiple:!0,clearable:!0,searchable:!0,required:!1}],J=r(!1),M=r(null),P=r(!1),$=(e=null)=>{if(e){let s=[];if(e.subjects&&Array.isArray(e.subjects))s=e.subjects.map(e=>e.id);else if(e.subject_ids)try{s="string"==typeof e.subject_ids?JSON.parse(e.subject_ids):e.subject_ids}catch(r){console.error("Error parsing subject_ids:",r),s=[]}M.value={...e,subject_ids:s}}else M.value={name:"",school_id:"",stage_id:"",subject_ids:[]};J.value=!0},L=()=>{J.value=!1,M.value=null},B=async({form:e,onSuccess:r,onError:s})=>{var a,t,l;if(P.value)return;P.value=!0;const i=null==(a=M.value)?void 0:a.id,o=i?`${w}/${i}`:w,n={...e,subject_ids:JSON.stringify(Array.isArray(e.subject_ids)?e.subject_ids:[])};try{await b.post(o,{...i&&{_method:"PUT"},...n}),r(),L(),F()}catch(u){console.error("Submission error:",u),s((null==(l=null==(t=u.response)?void 0:t.data)?void 0:l.errors)||{error:["An error occurred"]})}finally{P.value=!1}},C=async e=>{if(confirm("Are you sure you want to delete this grade?"))try{await b.delete(`${w}/${e.id}`),F()}catch(r){console.error("Deletion error:",r),alert("An error occurred while deleting the record.")}},F=()=>{j.reload({only:["records"],preserveScroll:!0,preserveState:!0})};return(e,r)=>(a(),s(p,null,[t(i(o),{title:E}),l("div",g,[l("div",h,[l("div",A,[l("div",S,[l("h2",{class:"text-2xl font-bold"},c(x)),t(y,{onClick:r[0]||(r[0]=e=>$())},{default:d(()=>r[1]||(r[1]=[m("Add New")])),_:1})]),t(f,{columns:D,items:N.value,loading:!1,onEdit:$,onDelete:C},null,8,["items"]),O.value?(a(),n(v,{key:0,links:O.value},null,8,["links"])):u("",!0)])])]),t(_,{show:J.value,title:"Grade",fields:I,editing:M.value,onClose:L,onSubmitted:B},null,8,["show","editing"])],64))}};export{k as default};
