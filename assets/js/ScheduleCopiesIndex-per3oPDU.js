import{p as e,u as a,e as l,q as s,Q as o,n as t,d as i,m as r,b as c,aD as n}from"./app-BXm70mdJ.js";import{Q as u}from"./QSpinnerDots-BY_P7fmL.js";import{f as m,a as d,o as p,ac as v,L as y,I as g,b as h,M as f,y as b,H as j,V as w,U as _,J as S,F as x,Q as C,x as V,Z as k}from"./vendor-DNM7Y6Xn.js";import Q from"./ScheduleCopyCard-DopWIY_h.js";import q from"./ScheduleCopyForm-gCHXMTRK.js";import D from"./ScheduleCopyFilters-BWdZRY2G.js";import T from"./ScheduleSyncDialog-8jvkCYk4.js";import E from"./CSTOverviewDialog-CetnCaJU.js";import F from"./WeeklyPlanMenu-CPPNbbnB.js";import{u as U}from"./i18n-CBOKL2HS.js";import"./offline-BzIlwqNM.js";import"./ui-BP0GJNn5.js";import"./StatusBadge-B2Mh2wJ8.js";import"./QSpace-Bu8V-QDa.js";import"./QSelect-CnZtzPIC.js";import"./rtl-Cr6c3OOr.js";import"./QForm-DyZk5PSh.js";import"./schoolData-lzO9rVwn.js";import"./QTd-BIxMTYzb.js";import"./QTable-rnEofRem.js";import"./QMarkupTable-Dmg3C5Wm.js";import"./QLinearProgress-Cix0cchl.js";import"./use-fullscreen-FlxrEg_V.js";import"./QBadge-ZzhN1X9C.js";import"./date-Dajz2muc.js";import"./QTab-DhKL91H_.js";import"./QTabs-CDJ215OP.js";import"./WeeklySystemGuide-e9afDUCT.js";import"./QTabPanel-sB32VrK8.js";import"./use-panel-D2HepUiw.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-LFwTBPSC.js";import"./MainSchoolData-poTNtOLu.js";import"./SchoolSettingsDialog-D2VgwIPk.js";const z={class:"q-pa-md"},B={class:"row items-center q-mb-lg"},M={class:"col"},P={class:"q-ma-none text-weight-bold"},$={class:"text-grey-7 q-mb-none"},A={class:"col-auto"},I={key:0,class:"row justify-center q-pa-xl"},L={class:"text-h6 text-grey-7 q-mt-md"},O={class:"text-grey-6"},H={key:2,class:"row q-gutter-md"},J={class:"text-h6"},W=e({__name:"ScheduleCopiesIndex",setup(e){const{t:W}=U(),G=a(),K=m([]),N=m([]),R=m([]),Z=m([]),X=m(!1),Y=m(!1),ee=m(!1),ae=m(!1),le=m(!1),se=m(!1),oe=m(!1),te=m(!1),ie=m(!1),re=m(!1),ce=m(null),ne=m(null),ue=m(null),me=m({school_id:null,academic_year_id:null,semester_id:null,status:null}),de=d(()=>{let e=[...K.value];return me.value.school_id&&(e=e.filter(e=>e.school_id===me.value.school_id)),me.value.academic_year_id&&(e=e.filter(e=>e.academic_year_id===me.value.academic_year_id)),me.value.semester_id&&(e=e.filter(e=>e.semester_id===me.value.semester_id)),me.value.status&&(e=e.filter(e=>e.status===me.value.status)),e}),pe=async()=>{X.value=!0;try{const e=await k.get("/admin/schedule-copies");K.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching schedule copies:",e),G.notify({type:"negative",message:W("common.errors.fetchFailed")})}finally{X.value=!1}},ve=async()=>{Y.value=!0;try{const e=await k.get("/api/schools");N.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching schools:",e)}finally{Y.value=!1}},ye=async()=>{ee.value=!0;try{const e=await k.get("/api/academic-years");R.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching academic years:",e)}finally{ee.value=!1}},ge=async()=>{ae.value=!0;try{const e=await k.get("/api/semesters");Z.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching semesters:",e)}finally{ae.value=!1}},he=()=>{ce.value=null,oe.value=!0},fe=e=>{ce.value={...e},oe.value=!0},be=async e=>{le.value=!0;try{if(e.isEdit)await k.put(`/admin/schedule-copies/${ce.value.id}`,e),G.notify({type:"positive",message:W("common.updatedSuccessfully")});else{const a=await k.post("/admin/schedule-copies",e);e.auto_generate&&a.data.id?(await k.post("/admin/schedule-copies/create-entries",{schedule_copy_id:a.data.id}),G.notify({type:"positive",message:"Schedule copy created with schedule slots"})):G.notify({type:"positive",message:W("common.createdSuccessfully")})}oe.value=!1,await pe()}catch(a){console.error("Error saving schedule copy:",a),G.notify({type:"negative",message:W("common.errors.submitFailed")})}finally{le.value=!1}},je=async e=>{try{await k.put(`/admin/schedule-copies/${e.id}`,{status:"active"}),G.notify({type:"positive",message:W("common.activatedSuccessfully")}),await pe()}catch(a){console.error("Error activating:",a),G.notify({type:"negative",message:W("common.errors.activateFailed")})}},we=async e=>{try{await k.put(`/admin/schedule-copies/${e.id}`,{status:"archived"}),G.notify({type:"info",message:W("common.archivedSuccessfully")}),await pe()}catch(a){console.error("Error archiving:",a),G.notify({type:"negative",message:W("common.errors.archiveFailed")})}},_e=e=>{ne.value=e,te.value=!0},Se=async()=>{se.value=!0;try{await k.delete(`/admin/schedule-copies/${ne.value.id}`),G.notify({type:"positive",message:W("common.deletedSuccessfully")}),te.value=!1,await pe()}catch(e){console.error("Error deleting:",e),G.notify({type:"negative",message:W("common.errors.deleteFailed")})}finally{se.value=!1}},xe=()=>{},Ce=e=>{ue.value=e,ie.value=!0},Ve=()=>{G.notify({type:"positive",message:"Schedule synchronization updated",position:"top"})};return p(async()=>{await Promise.all([pe(),ve(),ye(),ge()])}),(e,a)=>{var m,d;const p=v("Head");return g(),y(x,null,[h(p,{title:b(W)("weeklySystem.scheduleCopies.title")},null,8,["title"]),f("div",z,[h(F),f("div",B,[f("div",M,[f("h4",P,[h(l,{name:"content_copy",class:"q-mr-sm",color:"primary"}),w(" "+_(b(W)("weeklySystem.scheduleCopies.title")),1)]),f("p",$,_(b(W)("weeklySystem.scheduleCopies.subtitle")),1)]),f("div",A,[h(o,{color:"teal",icon:"preview",label:"CST Overview",outline:"",onClick:a[0]||(a[0]=e=>re.value=!0),class:"q-mr-sm"},{default:S(()=>[h(s,null,{default:S(()=>a[6]||(a[6]=[w("View subject-teacher assignments overview")])),_:1})]),_:1}),h(o,{color:"primary",icon:"add",label:b(W)("common.create"),onClick:he},null,8,["label"])])]),h(D,{modelValue:me.value,"onUpdate:modelValue":a[1]||(a[1]=e=>me.value=e),schools:N.value,"academic-years":R.value,semesters:Z.value,"loading-schools":Y.value,"loading-years":ee.value,"loading-semesters":ae.value,onFilter:xe,class:"q-mb-lg"},null,8,["modelValue","schools","academic-years","semesters","loading-schools","loading-years","loading-semesters"]),X.value?(g(),y("div",I,[h(u,{size:"50px",color:"primary"})])):de.value.length?(g(),y("div",H,[(g(!0),y(x,null,C(de.value,e=>(g(),y("div",{key:e.id,class:"col-12 col-sm-6 col-md-4 col-lg-3"},[h(Q,{copy:e,onEdit:fe,onActivate:je,onArchive:we,onDelete:_e,onSync:Ce},null,8,["copy"])]))),128))])):(g(),j(t,{key:1,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:S(()=>[h(l,{name:"folder_open",size:"64px",color:"grey-5"}),f("p",L,_(b(W)("weeklySystem.schoolBrowser.noDataTitle")),1),f("p",O,_(b(W)("common.noResults")),1),h(o,{color:"primary",icon:"add",label:b(W)("common.create"),onClick:he,class:"q-mt-md"},null,8,["label"])]),_:1})),h(q,{modelValue:oe.value,"onUpdate:modelValue":a[2]||(a[2]=e=>oe.value=e),"edit-data":ce.value,schools:N.value,"academic-years":R.value,semesters:Z.value,"loading-schools":Y.value,"loading-years":ee.value,"loading-semesters":ae.value,saving:le.value,onSubmit:be},null,8,["modelValue","edit-data","schools","academic-years","semesters","loading-schools","loading-years","loading-semesters","saving"]),h(c,{modelValue:te.value,"onUpdate:modelValue":a[3]||(a[3]=e=>te.value=e)},{default:S(()=>[h(t,{style:{"min-width":"350px"}},{default:S(()=>[h(i,{class:"row items-center"},{default:S(()=>[h(l,{name:"warning",color:"negative",size:"md",class:"q-mr-sm"}),f("span",J,_(b(W)("common.delete"))+" "+_(b(W)("weeklySystem.scheduleCopies.title")),1)]),_:1}),h(i,null,{default:S(()=>{var e;return[w(_(b(W)("common.confirmDelete"))+' "',1),f("strong",null,_(null==(e=ne.value)?void 0:e.name),1),w('"? '+_(b(W)("common.actionCannotBeUndone")),1)]}),_:1}),h(r,{align:"right"},{default:S(()=>[V(h(o,{flat:"",label:b(W)("common.cancel")},null,8,["label"]),[[n]]),h(o,{flat:"",label:b(W)("common.delete"),color:"negative",loading:se.value,onClick:Se},null,8,["label","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),h(T,{modelValue:ie.value,"onUpdate:modelValue":a[4]||(a[4]=e=>ie.value=e),"copy-id":null==(m=ue.value)?void 0:m.id,"copy-name":null==(d=ue.value)?void 0:d.name,onSynced:Ve},null,8,["modelValue","copy-id","copy-name"]),h(E,{modelValue:re.value,"onUpdate:modelValue":a[5]||(a[5]=e=>re.value=e)},null,8,["modelValue"])])],64)}}},[["__scopeId","data-v-9338a7c2"]]);export{W as default};
