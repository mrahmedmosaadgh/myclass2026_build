import{p as e,e as l,g as a,C as n,q as o,Q as t}from"./app-Dccx8xF5.js";import{Q as i}from"./QTree-C0rmTvcZ.js";import{f as r,a as s,k as d,L as c,I as u,b as p,J as v,M as f,S as g,H as k,O as m,a1 as y,$ as h,U as b,V as A}from"./vendor-EI0FRBVb.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./ui-B__oX9pK.js";const _={class:"task-tree"},w={class:"drag-handle-container q-mr-sm"},T={key:0,class:"editable-field"},C=["onDblclick"],x={class:"col-auto"},j={class:"description-area"},z={key:0,class:"editable-field description-editor"},V={class:"action-buttons"},B=e({__name:"TaskTree",props:{tasks:{type:Array,required:!0},expandAll:{type:Boolean,default:!1}},emits:["toggle-complete","edit-task","delete-task","reorder-tasks","add-subtask"],setup(e,{emit:B}){const U=e,E=B,I=r([]),D=r(!1),K=r(null),L=r(null),S=r(""),q=r(null),Q=s(()=>(console.log("Formatting tasks for tree:",U.tasks),$(U.tasks))),$=e=>e&&Array.isArray(e)&&e.length?e.map(e=>F(e)):(console.warn("formatTasksForTree: Invalid tasks input:",e),[]),F=e=>{if(!e||"object"!=typeof e)return console.warn("formatTask: Invalid task input:",e),null;const l={id:e.id||0,label:e.title||"Untitled Task",original:e,due_date:e.due_date||null,classification:e.classification||null,completed_at:e.completed_at||null,children:[]};return e.children&&Array.isArray(e.children)&&e.children.length>0&&(l.children=e.children.filter(e=>e).map(e=>F(e)).filter(e=>e)),l},M=e=>{try{if(!Array.isArray(e))return void console.warn("updateTicked: ticked is not an array:",e);const l=new Set(I.value||[]),a=new Set(e);for(const e of a)if(!l.has(e)){const l=H(e,U.tasks);l&&E("toggle-complete",l)}for(const e of l)if(!a.has(e)){const l=H(e,U.tasks);l&&E("toggle-complete",l)}I.value=e}catch(l){console.error("Error in updateTicked:",l)}},H=(e,l)=>{try{if(!l||!Array.isArray(l))return null;for(const a of l)if(a){if(a.id===e)return a;if(a.children&&Array.isArray(a.children)&&a.children.length){const l=H(e,a.children);if(l)return l}}}catch(a){console.error("Error in findTaskById:",a)}return null},J=e=>{if(!e)return"";return new Date(e).toLocaleDateString()},N=e=>{let l=0;for(let n=0;n<e.length;n++)l=e.charCodeAt(n)+((l<<5)-l);const a=["red","pink","purple","deep-purple","indigo","blue","light-blue","cyan","teal","green","light-green","lime","yellow","amber","orange","deep-orange","brown","grey","blue-grey"];return a[Math.abs(l)%a.length]},O=(e,l)=>{P(),K.value=e.id,L.value=l,S.value="title"===l?e.title:e.description||""},P=()=>{q.value&&(clearTimeout(q.value),q.value=null),K.value=null,L.value=null,S.value=""},G=e=>{if(q.value&&(clearTimeout(q.value),q.value=null),"title"===L.value&&S.value!==e.title){const l={...e,title:S.value};E("edit-task",l)}else if("description"===L.value&&S.value!==e.description){const l={...e,description:S.value};E("edit-task",l)}K.value=null,L.value=null,S.value=""},R=e=>{q.value&&clearTimeout(q.value),q.value=setTimeout(()=>{K.value===e.id&&G(e)},5e3)},W=e=>{D.value=!1;const l=X(e);E("reorder-tasks",l)};document.addEventListener("dragstart",()=>{D.value=!0}),document.addEventListener("dragend",()=>{D.value=!1});const X=e=>e.map((e,l)=>{const a={...e.original,position:l};return e.children&&e.children.length>0&&(a.children=X(e.children)),a});return d(()=>U.tasks,e=>{const l=[],a=e=>{if(e&&Array.isArray(e))for(const n of e)n&&n.completed_at&&l.push(n.id),n&&n.children&&Array.isArray(n.children)&&n.children.length&&a(n.children);else console.warn("Tasks is not an array:",e)};e&&Array.isArray(e)?(console.log("Processing tasks for completion status:",e),a(e),I.value=l):(console.warn("New tasks is not an array:",e),I.value=[])},{immediate:!0}),(r,s)=>(u(),c("div",_,[p(i,{nodes:Q.value,"node-key":"id","tick-strategy":"leaf",ticked:I.value,"onUpdate:ticked":M,"onUpdate:nodes":W,"no-connectors":"","default-expand-all":e.expandAll,draggable:""},{"default-header":v(e=>{return[f("div",{class:g(["row items-center full-width task-header",{"is-dragging":D.value}])},[f("div",w,[p(l,{name:"drag_indicator",size:"sm",class:"drag-handle cursor-grab"})]),f("div",{class:g(["col-grow task-title",{"completed-task":(i=e.node,null!==i.completed_at)}])},[K.value===e.node.id&&"title"===L.value?(u(),c("div",T,[p(a,{modelValue:S.value,"onUpdate:modelValue":s[0]||(s[0]=e=>S.value=e),dense:"",autofocus:"",onKeyup:[l=>R(e.node.original),y(l=>G(e.node.original),["enter"]),y(P,["esc"])],onBlur:l=>G(e.node.original)},null,8,["modelValue","onKeyup","onBlur"])])):(u(),c("div",{key:1,onDblclick:h(l=>O(e.node.original,"title"),["stop"])},b(e.node.label),41,C)),e.node.classification?(u(),k(n,{key:2,size:"sm",color:N(e.node.classification),"text-color":"white"},{default:v(()=>[A(b(e.node.classification),1)]),_:2},1032,["color"])):m("",!0),e.node.due_date?(u(),k(n,{key:3,size:"sm",color:"blue-grey-2","text-color":"black",icon:"event"},{default:v(()=>[A(b(J(e.node.due_date)),1)]),_:2},1024)):m("",!0)],2),f("div",x,[f("div",j,[K.value===e.node.id&&"description"===L.value?(u(),c("div",z,[p(a,{modelValue:S.value,"onUpdate:modelValue":s[1]||(s[1]=e=>S.value=e),type:"textarea",autofocus:"",dense:"",onKeyup:[l=>R(e.node.original),y(P,["esc"])],onBlur:l=>G(e.node.original)},null,8,["modelValue","onKeyup","onBlur"])])):(u(),k(t,{key:1,flat:"",round:"",dense:"",icon:e.node.original.description?"description":"add_comment",size:"sm",color:e.node.original.description?"blue-grey":"grey",onClick:h(l=>O(e.node.original,"description"),["stop"]),class:g({"has-description":e.node.original.description})},{default:v(()=>[p(o,null,{default:v(()=>[A(b(e.node.original.description?"Edit description":"Add description"),1)]),_:2},1024)]),_:2},1032,["icon","color","onClick","class"]))]),f("div",V,[p(t,{flat:"",round:"",dense:"",icon:"add",size:"sm",color:"positive",onClick:h(l=>{return a=e.node.original,void E("add-subtask",a);var a},["stop"])},null,8,["onClick"]),p(t,{flat:"",round:"",dense:"",icon:"edit",size:"sm",onClick:h(l=>r.$emit("edit-task",e.node.original),["stop"])},null,8,["onClick"]),p(t,{flat:"",round:"",dense:"",icon:"delete",size:"sm",color:"negative",onClick:h(l=>r.$emit("delete-task",e.node.original),["stop"])},null,8,["onClick"])])])],2)];var i}),_:1},8,["nodes","ticked","default-expand-all"])]))}},[["__scopeId","data-v-0f3816c7"]]);export{B as default};
