import{Q as e}from"./QSpace-CtVAwmqA.js";import{u as l,m as a,c as s,aP as t,Q as u,l as o,b as i}from"./app-BwCflFkV.js";import{f as n,k as d,o as r,L as c,I as m,M as p,b as f,x as v,aa as b,F as g,Q as y,U as x,J as h,ab as _,ad as w,Z as z}from"./vendor-CUZ9QTQV.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";const q={class:"space-y-3"},V={class:"flex items-center gap-3 flex-wrap"},j={class:"flex items-center gap-2"},I=["value"],Q={class:"flex items-center gap-2"},k=["value"],U={class:"flex items-center gap-2"},N=["value"],S=["value"],C={class:"space-y-4"},F={class:"flex items-center gap-4"},A={class:"flex items-center gap-2"},E={class:"flex items-center gap-2"},G={__name:"QuizSelector",props:{modelValue:{type:Number,default:null},schoolId:{type:Number,required:!0},gradeId:{type:Number,default:null},subjectId:{type:Number,default:null}},emits:["update:modelValue"],setup(G,{emit:L}){const O=G,P=L,D=l(),J=n([]),M=n([]),T=n([]),Z=n(O.gradeId),$=n(O.subjectId),B=n(!1),H=n(!1),K=n({name:"",description:"",time_limit_minutes:null,shuffle_questions:!1,shuffle_options:!1,allow_review:!0}),R=async()=>{var e,l;try{const a={school_id:O.schoolId,status:"active"};Z.value&&(a.grade_id=Z.value),$.value&&(a.subject_id=$.value);const s=await z.get("/api/quizzes",{params:a});s.data.quizzes?(J.value=s.data.quizzes,M.value=(null==(e=s.data.filters)?void 0:e.grades)||[],T.value=(null==(l=s.data.filters)?void 0:l.subjects)||[]):J.value=s.data}catch(a){console.error("Failed to fetch quizzes:",a),D.notify({type:"negative",message:"Failed to load quizzes",icon:"error",position:"top"})}},W=async()=>{if(K.value.name){H.value=!0;try{const e=await z.post("/api/quizzes",{...K.value,school_id:O.schoolId,grade_id:Z.value||O.gradeId,subject_id:$.value||O.subjectId,status:"active"});D.notify({type:"positive",message:"Quiz created successfully!",icon:"check_circle",position:"top"}),await R(),P("update:modelValue",e.data.id),K.value={name:"",description:"",time_limit_minutes:null,shuffle_questions:!1,shuffle_options:!1,allow_review:!0},B.value=!1}catch(e){console.error("Failed to create quiz:",e),D.notify({type:"negative",message:"Failed to create quiz",icon:"error",position:"top"})}finally{H.value=!1}}else D.notify({type:"warning",message:"Please enter a quiz name",icon:"warning",position:"top"})};return d(()=>O.modelValue,e=>{"create-new"===e&&(B.value=!0,P("update:modelValue",null))}),d([Z,$],()=>{R()}),d([()=>O.gradeId,()=>O.subjectId],()=>{Z.value=O.gradeId,$.value=O.subjectId,R()}),r(()=>{R()}),(l,n)=>(m(),c("div",null,[p("div",q,[p("div",V,[p("div",j,[n[10]||(n[10]=p("label",{class:"text-sm font-medium text-gray-700"},"Grade:",-1)),v(p("select",{"onUpdate:modelValue":n[0]||(n[0]=e=>Z.value=e),class:"border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 text-sm px-3 py-2 min-w-[150px]"},[n[9]||(n[9]=p("option",{value:null},"All Grades",-1)),(m(!0),c(g,null,y(M.value,e=>(m(),c("option",{key:e.id,value:e.id},x(e.name),9,I))),128))],512),[[b,Z.value]])]),p("div",Q,[n[12]||(n[12]=p("label",{class:"text-sm font-medium text-gray-700"},"Subject:",-1)),v(p("select",{"onUpdate:modelValue":n[1]||(n[1]=e=>$.value=e),class:"border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 text-sm px-3 py-2 min-w-[150px]"},[n[11]||(n[11]=p("option",{value:null},"All Subjects",-1)),(m(!0),c(g,null,y(T.value,e=>(m(),c("option",{key:e.id,value:e.id},x(e.name),9,k))),128))],512),[[b,$.value]])])]),p("div",U,[n[15]||(n[15]=p("label",{class:"text-sm font-medium text-gray-700"},"Quiz:",-1)),p("select",{value:G.modelValue,onChange:n[2]||(n[2]=e=>l.$emit("update:modelValue",e.target.value?parseInt(e.target.value):null)),class:"border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 text-sm px-3 py-2 min-w-[200px]"},[n[13]||(n[13]=p("option",{value:null},"No Quiz Assigned",-1)),(m(!0),c(g,null,y(J.value,e=>(m(),c("option",{key:e.id,value:e.id},x(e.name)+" ("+x(e.questions_count)+" questions) ",9,S))),128)),n[14]||(n[14]=p("option",{value:"create-new",class:"font-semibold text-blue-600"}," + Create New Quiz ",-1))],40,N)])]),f(i,{modelValue:B.value,"onUpdate:modelValue":n[8]||(n[8]=e=>B.value=e),persistent:""},{default:h(()=>[f(a,{style:{"min-width":"500px"}},{default:h(()=>[f(s,{class:"row items-center bg-primary text-white"},{default:h(()=>[n[16]||(n[16]=p("div",{class:"text-h6"},"Create New Quiz",-1)),f(e),v(f(u,{icon:"close",flat:"",round:"",dense:""},null,512),[[t]])]),_:1}),f(s,{class:"q-pt-md"},{default:h(()=>[p("div",C,[p("div",null,[n[17]||(n[17]=p("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Quiz Name *",-1)),v(p("input",{"onUpdate:modelValue":n[3]||(n[3]=e=>K.value.name=e),type:"text",class:"w-full border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500",placeholder:"Enter quiz name"},null,512),[[_,K.value.name]])]),p("div",null,[n[18]||(n[18]=p("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Description",-1)),v(p("textarea",{"onUpdate:modelValue":n[4]||(n[4]=e=>K.value.description=e),rows:"3",class:"w-full border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500",placeholder:"Enter quiz description (optional)"},null,512),[[_,K.value.description]])]),p("div",null,[n[19]||(n[19]=p("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Time Limit (minutes)",-1)),v(p("input",{"onUpdate:modelValue":n[5]||(n[5]=e=>K.value.time_limit_minutes=e),type:"number",min:"1",class:"w-full border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500",placeholder:"Optional"},null,512),[[_,K.value.time_limit_minutes,void 0,{number:!0}]])]),p("div",F,[p("label",A,[v(p("input",{"onUpdate:modelValue":n[6]||(n[6]=e=>K.value.shuffle_questions=e),type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[w,K.value.shuffle_questions]]),n[20]||(n[20]=p("span",{class:"text-sm text-gray-700"},"Shuffle Questions",-1))]),p("label",E,[v(p("input",{"onUpdate:modelValue":n[7]||(n[7]=e=>K.value.shuffle_options=e),type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[w,K.value.shuffle_options]]),n[21]||(n[21]=p("span",{class:"text-sm text-gray-700"},"Shuffle Options",-1))])])])]),_:1}),f(o,{align:"right",class:"q-px-md q-pb-md"},{default:h(()=>[v(f(u,{flat:"",label:"Cancel",color:"grey"},null,512),[[t]]),f(u,{unelevated:"",label:"Create Quiz",color:"primary",onClick:W,loading:H.value,disable:!K.value.name},null,8,["loading","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{G as default};
