import{Q as e}from"./app-Dccx8xF5.js";import{Q as a}from"./QBadge-BoQNzKR2.js";import{f as t,a as l,L as r,I as n,b as o,M as s,V as u,y as i,a3 as d,J as c,am as m,F as v,_ as p}from"./vendor-EI0FRBVb.js";import{_ as b}from"./PrimaryButton-D4MqeasW.js";import{_ as y}from"./SecondaryButton-UHI6KqaH.js";import{_ as f}from"./FormModal-Dj8hAH9k.js";import{_ as h}from"./ImportExcel-DM5J6xgV.js";import{u as k,w as g}from"./xlsx-cMC2LkxH.js";import{F as w}from"./FullCalendar-HOImPLIn.js";import x from"./SchoolGradeSelector-0FRw4y1w.js";import _ from"./BulkAttendanceActions-DuPb71P5.js";import j from"./StudentAttendanceTable-CfBHX-yT.js";import S from"./AttendanceHistory-CN600V2q.js";import D from"./img_trans-dasNjS2l.js";import C from"./1_use-9uTntsk9.js";import q from"./box_use-BWzSdc7t.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./ui-B__oX9pK.js";import"./Modal-CflByj1N.js";import"./QSpinnerDots-VYKIYOSs.js";import"./QSpace-BWA-UIs7.js";import"./AttendanceStatusBadge-PzpK0dBZ.js";import"./TimeCalculator-BdKM0SNh.js";import"./1-27Cqll8-.js";import"./QSelect-aOnYle6d.js";import"./rtl-Cr6c3OOr.js";import"./QTd-DLHUpL0m.js";import"./QTable-D3jRDWU3.js";import"./QMarkupTable-D7D4aY0S.js";import"./QLinearProgress-BYmNETNA.js";import"./use-fullscreen-CBorX6t8.js";import"./DraggableBox-D9ABnf7K.js";import"./DropZone-CWkOERLA.js";const E={class:"q-pa-md q-gutter-sm"},A={class:"bg-white rounded-lg shadow-md p-6 mb-8 transition-all duration-300 hover:shadow-lg"},M={class:"flex justify-between items-center mb-4"},T={class:"flex space-x-2"},N={class:"py-12"},O={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Q={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-6"},B={class:"flex justify-between items-center mb-6"},I={class:"flex space-x-2"},F="/admin/calendar",L={__name:"Index",props:{records:Object,options:Object},setup(L){const $=t(!1),H=t("");t(Y(new Date)),Y(new Date);const U=t([{id:1,name:"Ahmed Ali"},{id:2,name:"Sara Hassan"},{id:3,name:"Mohamed Youssef"}]),R=t({1:{status:"present",time:0},2:{status:"late",time:15},3:{status:"absent",time:0}}),W=t([{id:1,date:"2025-04-24",status:"present"},{id:2,date:"2025-04-23",status:"late"}]);function Y(e){const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`}function J(e){$.value=!0,setTimeout(()=>{console.log("Selection changed:",e),$.value=!1},1e3)}function P(e){$.value=!0,setTimeout(()=>{U.value.forEach(a=>{R.value[a.id]=R.value[a.id]||{status:"present",time:0},R.value[a.id].status=e,R.value[a.id].time="late"===e?10:"leftEarly"===e?5:0}),$.value=!1},500)}function V({studentId:e,status:a}){R.value[e].status=a,R.value[e].time="late"===a?10:"leftEarly"===a?5:0,console.log(`Updated student ${e} status to ${a}`)}t(!1),l(()=>{if(!H.value)return U.value;const e=H.value.toLowerCase();return U.value.filter(a=>a.name.toLowerCase().includes(e))});const z=L,Z=t(!1),G=t(null),K=l(()=>{var e;return(null==(e=z.records)?void 0:e.data)||[]}),X=t({loading:!1,error:null}),ee=()=>{X.value.loading=!0,p.reload({only:["records"],preserveScroll:!0,preserveState:!0,onFinish:()=>{X.value.loading=!1}})},ae=[{name:"date",label:"Date",type:"date",required:!0},{name:"week",label:"Week",type:"number",required:!0},{name:"day",label:"Day",type:"text",required:!0},{name:"day_number",label:"Day Number",type:"select",required:!0,options:[{value:1,label:"Sunday"},{value:2,label:"Monday"},{value:3,label:"Tuesday"},{value:4,label:"Wednesday"},{value:5,label:"Thursday"},{value:6,label:"Friday"},{value:7,label:"Saturday"}]},{name:"week_number",label:"Week Number",type:"number",required:!0},{name:"semester_number",label:"Semester Number",type:"number",required:!0},{name:"academic_year_id",label:"Academic Year",type:"select",required:!0,options:l(()=>{var e,a;return(null==(a=null==(e=z.options)?void 0:e.academicYears)?void 0:a.map(e=>({value:e.id,label:e.name})))||[]})},{name:"school_id",label:"School",type:"select",required:!0,options:l(()=>{var e,a;return(null==(a=null==(e=z.options)?void 0:e.schools)?void 0:a.map(e=>({value:e.id,label:e.name})))||[]})},{name:"status",label:"Status",type:"select",required:!0,options:[{value:1,label:"Active"},{value:0,label:"Day Off"},{value:2,label:"Activity"},{value:3,label:"Test"},{value:4,label:"Final Exam"}]},{name:"event",label:"Event",type:"text"},{name:"event_academic",label:"Academic Event",type:"text"},{name:"vacation",label:"Vacation",type:"number"}],te=[{key:"date",label:"Date",required:!0},{key:"academic_year",label:"Academic Year (ID or Name)",required:!0},{key:"school",label:"School (ID or Name)",required:!0},{key:"week",label:"Week",required:!1},{key:"day",label:"Day",required:!1},{key:"day_number",label:"Day Number (1-7)",required:!1},{key:"week_number",label:"Week Number",required:!1},{key:"semester_number",label:"Semester Number",required:!1},{key:"status",label:"Status (1=Active, 0=Day Off, 2=Activity, 3=Test, 4=Final Exam)",required:!1},{key:"event",label:"Event",required:!1},{key:"event_academic",label:"Academic Event",required:!1},{key:"vacation",label:"Vacation",required:!1}],le=()=>{Z.value=!1,G.value=null},re=(e=null)=>{G.value=e,Z.value=!0},ne=({form:e})=>{G.value?p.put(`${F}/${G.value.id}`,e):p.post(F,e),le()},oe=()=>{const e=K.value.map(e=>{var a;return{date:e.date,week:e.week,day:e.day,day_number:e.day_number,week_number:e.week_number,semester_number:e.semester_number,school:null==(a=e.school)?void 0:a.name,status:e.status,event:e.event,event_academic:e.event_academic,vacation:e.vacation}}),a=k.json_to_sheet(e),t=k.book_new();k.book_append_sheet(t,a,"Calendar"),g(t,"calendar_export.xlsx")},se=l(()=>K.value.map(e=>({id:e.id,title:e.event||ue(e.status),date:e.date,status:e.status}))),ue=e=>({1:"Work Day",0:"Day Off",2:"Activity",3:"Test",4:"Final Exam"}[e]||"Unknown"),ie=e=>{const a=K.value.find(a=>a.id===e.id);a&&re(a)},de=()=>{re(null)},ce=()=>{try{const e={students:U.value,attendanceData:R.value,attendanceHistory:W.value,exportDate:(new Date).toISOString()},a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),t=URL.createObjectURL(a),l=document.createElement("a"),r=`attendance_data_${(new Date).toISOString().slice(0,19).replace(/[:]/g,"-")}.json`;l.href=t,l.download=r,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(t),toast.success("Attendance data exported successfully")}catch(e){console.error("Error exporting attendance data:",e),toast.error("Error exporting attendance data: "+e.message)}},me=()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async e=>{try{const a=e.target.files[0];if(!a)return;const t=await a.text(),l=JSON.parse(t);if(!l.students||!l.attendanceData||!l.attendanceHistory)throw new Error("Invalid attendance data format");U.value=l.students,R.value=l.attendanceData,W.value=l.attendanceHistory,toast.success("Attendance data imported successfully")}catch(a){console.error("Error importing attendance data:",a),toast.error("Error importing attendance data: "+a.message)}},e.click()};return(t,l)=>(n(),r(v,null,[o(i(d),{title:"Calendar Management"}),l[10]||(l[10]=s("br",null,null,-1)),o(q),l[11]||(l[11]=s("br",null,null,-1)),l[12]||(l[12]=s("br",null,null,-1)),l[13]||(l[13]=s("br",null,null,-1)),l[14]||(l[14]=s("br",null,null,-1)),l[15]||(l[15]=s("br",null,null,-1)),l[16]||(l[16]=s("br",null,null,-1)),l[17]||(l[17]=s("br",null,null,-1)),l[18]||(l[18]=s("br",null,null,-1)),l[19]||(l[19]=s("br",null,null,-1)),l[20]||(l[20]=s("br",null,null,-1)),l[21]||(l[21]=s("br",null,null,-1)),l[22]||(l[22]=s("br",null,null,-1)),l[23]||(l[23]=s("br",null,null,-1)),l[24]||(l[24]=s("br",null,null,-1)),l[25]||(l[25]=s("br",null,null,-1)),l[26]||(l[26]=s("br",null,null,-1)),l[27]||(l[27]=u("v ")),l[28]||(l[28]=s("br",null,null,-1)),o(C),l[29]||(l[29]=s("br",null,null,-1)),l[30]||(l[30]=s("br",null,null,-1)),o(e,{label:"Click me",color:"primary"}),s("div",E,[o(e,{push:"",color:"white","text-color":"primary",label:"Unread Mails"},{default:c(()=>[o(a,{color:"orange",floating:""},{default:c(()=>l[1]||(l[1]=[u("22")])),_:1})]),_:1}),o(e,{dense:"",color:"purple",round:"",icon:"email",class:"q-ml-md"},{default:c(()=>[o(a,{color:"red",floating:""},{default:c(()=>l[2]||(l[2]=[u("4")])),_:1})]),_:1})]),o(D),l[31]||(l[31]=s("div",{class:"p-4"},null,-1)),s("div",A,[s("div",M,[l[4]||(l[4]=s("h2",{class:"text-xl font-bold"},"Attendance Management",-1)),s("div",T,[o(b,{onClick:ee,class:"flex items-center"},{default:c(()=>l[3]||(l[3]=[s("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),u(" Refresh ")])),_:1})])]),l[5]||(l[5]=m('<div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4 rounded"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg></div><div class="ml-3"><p class="text-sm text-blue-700"> Select a school and grade to manage attendance for students. </p></div></div></div>',1)),o(x,{onSelectionChanged:J}),o(_,{onBulkAction:P}),o(j,{students:U.value,attendanceData:R.value,onStatusChanged:V},null,8,["students","attendanceData"]),o(S,{history:W.value},null,8,["history"])]),s("div",N,[s("div",O,[s("div",Q,[s("div",B,[s("div",I,[o(b,{onClick:l[0]||(l[0]=e=>re())},{default:c(()=>l[6]||(l[6]=[u(" Add New Calendar Entry ")])),_:1}),o(h,{onImported:ee,"validate-url":F+"/validate-import","import-url":F+"/import",columns:te,"button-text":"Import Calendar","preview-title":"Preview Calendar Data"},null,8,["validate-url","import-url"]),o(y,{onClick:oe},{default:c(()=>l[7]||(l[7]=[u(" Export ")])),_:1}),o(y,{onClick:ce,class:"ml-2"},{default:c(()=>l[8]||(l[8]=[s("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),u(" Save as JSON ")])),_:1}),o(y,{onClick:me,class:"ml-2"},{default:c(()=>l[9]||(l[9]=[s("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1),u(" Import JSON ")])),_:1})])]),o(w,{events:se.value,onEventClick:ie,onDateClick:de},null,8,["events"])])])]),o(f,{show:Z.value,title:"Calendar Entry",fields:ae,editing:G.value,onClose:le,onSubmitted:ne},null,8,["show","editing"])],64))}};export{L as default};
