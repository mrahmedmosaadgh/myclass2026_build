import{Q as e}from"./QSpace-Bu8V-QDa.js";import{d as l,Q as a,q as t,C as o,n as s,m as r,aD as u,b as i,e as n}from"./app-BXm70mdJ.js";import{Q as d}from"./QSelect-CnZtzPIC.js";import{Q as m}from"./QTd-BIxMTYzb.js";import{Q as c}from"./QBadge-ZzhN1X9C.js";import{Q as p}from"./QTable-rnEofRem.js";import{Q as v}from"./QPagination-CaPaC77P.js";import{Q as b}from"./QBar-ulmxe8C-.js";import{f,r as g,a as _,ac as y,L as x,I as w,b as j,M as h,J as k,H as V,O as C,y as Q,V as q,F as S,Q as U,U as A,x as T,_ as E}from"./vendor-DNM7Y6Xn.js";import{s as D}from"./i18n-CBOKL2HS.js";import G from"./QuExamForm-CWa-xZDB.js";import M from"./QuGradingDialog-CK0_HQ6a.js";import"./offline-BzIlwqNM.js";import"./ui-BP0GJNn5.js";import"./rtl-Cr6c3OOr.js";import"./QMarkupTable-Dmg3C5Wm.js";import"./QLinearProgress-Cix0cchl.js";import"./use-fullscreen-FlxrEg_V.js";import"./QBtnToggle-BZ2426G6.js";import"./QForm-DyZk5PSh.js";import"./QuExamQuestionSelector-BooOgn8f.js";import"./QuQuestionDisplay-oq3osrSd.js";import"./katex-BAATRBTg.js";import"./katex-BXKQVcz-.js";import"./date-Dajz2muc.js";const z={class:"q-pa-md"},P={class:"row items-center"},F={class:"row q-gutter-md"},B={class:"text-subtitle2"},L={key:0,class:"text-caption text-grey-7"},O={key:0,class:"row q-gutter-xs"},R={class:"row justify-center"},H={class:"text-h6"},I=["src"],N={class:"row q-col-gutter-md q-mb-md"},J={class:"col-12 col-md-3"},K={class:"col-12 col-md-3"},$={__name:"QuExamList",props:{exams:Object,subjects:Array,grades:Array,classrooms:Array,customGroups:Array,examTypes:Array,markCalculationMethods:Array,publishResultsTimings:Array,filters:Object},setup($){var W,X,Y,Z,ee;const le=f(!1),ae=f(null),te=$,oe=g({subject_id:(null==(W=te.filters)?void 0:W.subject_id)||(te.subjects.length>0?te.subjects[0].id:null),exam_type:(null==(X=te.filters)?void 0:X.exam_type)||null,custom_group:(null==(Y=te.filters)?void 0:Y.custom_group)||null,status:(null==(Z=te.filters)?void 0:Z.status)||null}),se=f(te.exams.current_page),re=f(!1),ue=f(!1),ie=f(null),ne=f(null),de=e=>e?e.charAt(0).toUpperCase()+e.slice(1):"",me=te.examTypes.map(e=>({value:e,label:de(e)})),ce=[{value:"draft",label:"Draft"},{value:"upcoming",label:"Upcoming"},{value:"active",label:"Active"},{value:"ended",label:"Ended"}],pe=[{name:"id",label:"ID",field:"id",align:"left",sortable:!0},{name:"title",label:"Title",field:"title",align:"left"},{name:"subject",label:"Subject",field:"subject",align:"left"},{name:"exam_type",label:"Type",field:"exam_type",align:"center"},{name:"custom_group",label:"Group",field:"custom_group",align:"center"},{name:"questions_count",label:"Questions",field:"questions_count",align:"center"},{name:"total_marks",label:"Marks",field:"total_marks",align:"center"},{name:"duration_minutes",label:"Duration (min)",field:"duration_minutes",align:"center"},{name:"status",label:"Status",field:"status",align:"center"},{name:"actions",label:"Actions",align:"center"}],ve=_(()=>({page:te.exams.current_page,rowsPerPage:te.exams.per_page,rowsNumber:te.exams.total})),be=()=>{E.get(D("qu-exams.index"),oe,{preserveState:!0,preserveScroll:!0})},fe=e=>{E.get(D("qu-exams.index",{...oe,page:e}),{},{preserveState:!0,preserveScroll:!0})};!(null==(ee=te.filters)?void 0:ee.subject_id)&&oe.subject_id&&be();const ge=e=>{fe(e.pagination.page)},_e=()=>{E.delete(D("qu-exams.destroy",ie.value.id),{onSuccess:()=>{re.value=!1,ie.value=null}})},ye=f(!1),xe=f([]),we=f(!1),je=f(null),he=g({grading_status:null,classroom_id:null}),ke=async()=>{if(je.value){we.value=!0;try{const e=await window.axios.get(D("qu-exams.grading-attempts",je.value.id),{params:he});xe.value=e.data.attempts}catch(e){console.error("Failed to load grading attempts",e)}finally{we.value=!1}}},Ve=e=>{var l;if(!(null==(l=je.value)?void 0:l.passing_score))return"primary";return e.score/je.value.total_marks*100>=je.value.passing_score?"positive":"negative"},Ce=[{name:"student",label:"Student",field:e=>e.user.name,align:"left"},{name:"classroom",label:"Classroom",field:e=>e.user.classroom,align:"left"},{name:"score",label:"Score",field:"score",align:"center"},{name:"status",label:"Status",field:"status",align:"center"},{name:"submitted",label:"Submitted",field:"submitted_at",align:"center"},{name:"actions",label:"Actions",align:"center"}],Qe=e=>{(async e=>{je.value=e,ye.value=!0,he.grading_status=null,he.classroom_id=null,await ke()})(e)},qe=()=>{ue.value=!1,ne.value=null,E.reload({only:["exams"]})},Se=f(!1),Ue=f(null),Ae=()=>{ke()};return(f,g)=>{const _=y("Head");return w(),x(S,null,[j(_,{title:"Exam Management"}),h("div",z,[j(s,null,{default:k(()=>[j(l,null,{default:k(()=>[h("div",P,[g[14]||(g[14]=h("div",{class:"text-h5"},"Exam Management",-1)),j(e),j(a,{color:"primary",label:"Create Exam",icon:"add",onClick:g[0]||(g[0]=e=>ue.value=!0)})])]),_:1}),j(l,null,{default:k(()=>[h("div",F,[j(d,{modelValue:oe.subject_id,"onUpdate:modelValue":[g[1]||(g[1]=e=>oe.subject_id=e),be],options:$.subjects,"option-value":"id","option-label":"name",label:"Subject",clearable:"","emit-value":"","map-options":"",style:{"min-width":"200px"}},null,8,["modelValue","options"]),j(d,{modelValue:oe.exam_type,"onUpdate:modelValue":[g[2]||(g[2]=e=>oe.exam_type=e),be],options:Q(me),label:"Exam Type",clearable:"",style:{"min-width":"150px"}},null,8,["modelValue","options"]),j(d,{modelValue:oe.custom_group,"onUpdate:modelValue":[g[3]||(g[3]=e=>oe.custom_group=e),be],options:$.customGroups,label:"Custom Group",clearable:"",style:{"min-width":"150px"}},null,8,["modelValue","options"]),j(d,{modelValue:oe.status,"onUpdate:modelValue":[g[4]||(g[4]=e=>oe.status=e),be],options:ce,label:"Status",clearable:"",style:{"min-width":"150px"}},null,8,["modelValue"])])]),_:1}),j(l,null,{default:k(()=>[j(p,{rows:$.exams.data,columns:pe,"row-key":"id",flat:"",bordered:"",pagination:ve.value,onRequest:ge},{"body-cell-title":k(e=>[j(m,{props:e},{default:k(()=>{return[h("div",B,A(e.row.title),1),e.row.description?(w(),x("div",L,A((l=e.row.description,a=50,l&&l.length>a?l.substring(0,a)+"...":l)),1)):C("",!0)];var l,a}),_:2},1032,["props"])]),"body-cell-subject":k(e=>[j(m,{props:e},{default:k(()=>[j(o,{dense:"",color:"primary","text-color":"white"},{default:k(()=>{var l;return[q(A(null==(l=e.row.subject)?void 0:l.name),1)]}),_:2},1024)]),_:2},1032,["props"])]),"body-cell-exam_type":k(e=>[j(m,{props:e},{default:k(()=>{return[j(o,{dense:"",color:(l=e.row.exam_type,{practice:"cyan",quiz:"purple",midterm:"orange",final:"red",survey:"teal"}[l]||"grey"),"text-color":"white"},{default:k(()=>[q(A(de(e.row.exam_type)),1)]),_:2},1032,["color"])];var l}),_:2},1032,["props"])]),"body-cell-custom_group":k(e=>[j(m,{props:e},{default:k(()=>[e.row.custom_group?(w(),V(o,{key:0,dense:"",outline:"",color:"purple"},{default:k(()=>[q(A(e.row.custom_group),1)]),_:2},1024)):C("",!0)]),_:2},1032,["props"])]),"body-cell-status":k(e=>[j(m,{props:e},{default:k(()=>{return[j(c,{color:(l=e.row.status,{draft:"grey",upcoming:"blue",active:"green",ended:"orange"}[l]||"grey"),label:de(e.row.status)},null,8,["color","label"])];var l}),_:2},1032,["props"])]),"body-cell-bloom_distribution":k(e=>[j(m,{props:e},{default:k(()=>[e.row.bloom_distribution?(w(),x("div",O,[(w(!0),x(S,null,U(e.row.bloom_distribution,(e,l)=>(w(),x(S,{key:l},[e>0?(w(),V(o,{key:0,dense:"",size:"sm",color:"purple-2"},{default:k(()=>[q(A(l)+": "+A(e),1)]),_:2},1024)):C("",!0)],64))),128))])):C("",!0)]),_:2},1032,["props"])]),"body-cell-actions":k(e=>[j(m,{props:e},{default:k(()=>[j(a,{flat:"",dense:"",round:"",color:"primary",icon:"visibility",onClick:l=>{return a=e.row,void E.visit(D("qu-exams.show",a.id));var a}},{default:k(()=>[j(t,null,{default:k(()=>g[15]||(g[15]=[q("View")])),_:1})]),_:2},1032,["onClick"]),j(a,{flat:"",dense:"",round:"",color:"primary",icon:"edit",onClick:l=>(async e=>{try{const l=await window.axios.get(D("qu-exams.edit",e.id));ne.value=l.data,ue.value=!0}catch(l){console.error("Failed to load exam data",l)}})(e.row)},{default:k(()=>[j(t,null,{default:k(()=>g[16]||(g[16]=[q("Edit")])),_:1})]),_:2},1032,["onClick"]),j(a,{flat:"",dense:"",round:"",color:"secondary",icon:"content_copy",onClick:l=>(e=>{const l={...e,title:`${e.title} (Copy)`,is_published:!1};ne.value=l,ue.value=!0})(e.row)},{default:k(()=>[j(t,null,{default:k(()=>g[17]||(g[17]=[q("Duplicate")])),_:1})]),_:2},1032,["onClick"]),j(a,{flat:"",dense:"",round:"",color:"indigo",icon:"print",onClick:l=>{return a=e.row,ae.value=a,void(le.value=!0);var a}},{default:k(()=>[j(t,null,{default:k(()=>g[18]||(g[18]=[q("Print Preview")])),_:1})]),_:2},1032,["onClick"]),j(a,{flat:"",dense:"",round:"",color:"orange",icon:"grading",onClick:l=>Qe(e.row)},{default:k(()=>[j(t,null,{default:k(()=>g[19]||(g[19]=[q("View Grading")])),_:1})]),_:2},1032,["onClick"]),j(a,{flat:"",dense:"",round:"",color:"negative",icon:"delete",onClick:l=>{return a=e.row,ie.value=a,void(re.value=!0);var a}},{default:k(()=>[j(t,null,{default:k(()=>g[20]||(g[20]=[q("Delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","pagination"])]),_:1}),$.exams.last_page>1?(w(),V(l,{key:0,class:"q-pt-none"},{default:k(()=>[h("div",R,[j(v,{modelValue:se.value,"onUpdate:modelValue":[g[5]||(g[5]=e=>se.value=e),fe],max:$.exams.last_page,"max-pages":7,"direction-links":"","boundary-links":""},null,8,["modelValue","max"])])]),_:1})):C("",!0)]),_:1}),j(i,{modelValue:re.value,"onUpdate:modelValue":g[6]||(g[6]=e=>re.value=e)},{default:k(()=>[j(s,null,{default:k(()=>[j(l,null,{default:k(()=>g[21]||(g[21]=[h("div",{class:"text-h6"},"Confirm Delete",-1)])),_:1}),j(l,null,{default:k(()=>g[22]||(g[22]=[q(" Are you sure you want to delete this exam? This action cannot be undone. ")])),_:1}),j(r,{align:"right"},{default:k(()=>[T(j(a,{flat:"",label:"Cancel",color:"primary"},null,512),[[u]]),j(a,{flat:"",label:"Delete",color:"negative",onClick:_e})]),_:1})]),_:1})]),_:1},8,["modelValue"]),j(i,{modelValue:ue.value,"onUpdate:modelValue":g[8]||(g[8]=e=>ue.value=e),maximized:""},{default:k(()=>[j(s,null,{default:k(()=>[j(l,{class:"row items-center q-pb-none"},{default:k(()=>[h("div",H,A(ne.value?"Edit Exam":"Create Exam"),1),j(e),T(j(a,{icon:"close",flat:"",round:"",dense:""},null,512),[[u]])]),_:1}),j(l,null,{default:k(()=>[j(G,{subjects:$.subjects,grades:$.grades,classrooms:$.classrooms,"exam-types":$.examTypes,"mark-calculation-methods":$.markCalculationMethods,"publish-results-timings":$.publishResultsTimings,"custom-groups":$.customGroups,"selected-subject-id":oe.subject_id,exam:ne.value,onSuccess:qe,onCancel:g[7]||(g[7]=e=>ue.value=!1)},null,8,["subjects","grades","classrooms","exam-types","mark-calculation-methods","publish-results-timings","custom-groups","selected-subject-id","exam"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),j(i,{modelValue:le.value,"onUpdate:modelValue":g[9]||(g[9]=e=>le.value=e),maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:k(()=>[j(s,{class:"bg-white text-black"},{default:k(()=>[j(b,{class:"bg-primary text-white"},{default:k(()=>{var l;return[j(n,{name:"print"}),h("div",null,"Print Preview: "+A(null==(l=ae.value)?void 0:l.title),1),j(e),T((w(),V(a,{dense:"",flat:"",icon:"close"},{default:k(()=>[j(t,null,{default:k(()=>g[23]||(g[23]=[q("Close")])),_:1})]),_:1})),[[u]])]}),_:1}),j(l,{class:"q-pa-none",style:{height:"calc(100vh - 50px)"}},{default:k(()=>{var e;return[ae.value?(w(),x("iframe",{key:0,id:"printFrame",src:Q(D)("qu-student.exams.print",null==(e=ae.value)?void 0:e.id),style:{width:"100%",height:"100%",border:"none"}},null,8,I)):C("",!0)]}),_:1})]),_:1})]),_:1},8,["modelValue"]),j(i,{modelValue:ye.value,"onUpdate:modelValue":g[12]||(g[12]=e=>ye.value=e),maximized:""},{default:k(()=>[j(s,null,{default:k(()=>[j(b,{class:"bg-primary text-white"},{default:k(()=>{var l;return[j(n,{name:"grading"}),h("div",null,"Grading: "+A(null==(l=je.value)?void 0:l.title),1),j(e),T((w(),V(a,{dense:"",flat:"",icon:"close"},{default:k(()=>[j(t,null,{default:k(()=>g[24]||(g[24]=[q("Close")])),_:1})]),_:1})),[[u]])]}),_:1}),j(l,null,{default:k(()=>[h("div",N,[h("div",J,[j(d,{modelValue:he.grading_status,"onUpdate:modelValue":[g[10]||(g[10]=e=>he.grading_status=e),ke],options:ce,"option-value":"value","option-label":"label",label:"Grading Status",clearable:"","emit-value":"","map-options":"",dense:"",outlined:""},null,8,["modelValue"])]),h("div",K,[j(d,{modelValue:he.classroom_id,"onUpdate:modelValue":[g[11]||(g[11]=e=>he.classroom_id=e),ke],options:$.classrooms,"option-value":"id","option-label":"name",label:"Classroom",clearable:"","emit-value":"","map-options":"",dense:"",outlined:""},null,8,["modelValue","options"])])]),j(p,{rows:xe.value,columns:Ce,"row-key":"id",flat:"",bordered:"",loading:we.value},{"body-cell-score":k(e=>[j(m,{props:e},{default:k(()=>[j(o,{color:Ve(e.row),"text-color":"white",size:"sm"},{default:k(()=>{var l;return[q(A(Math.round(e.row.score||0))+" / "+A(null==(l=je.value)?void 0:l.total_marks),1)]}),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-status":k(e=>[j(m,{props:e},{default:k(()=>{return[j(c,{color:(l=e.row.status,{pending:"grey",partial:"orange",completed:"positive"}[l]||"grey"),label:de(e.row.status)},null,8,["color","label"])];var l}),_:2},1032,["props"])]),"body-cell-actions":k(e=>[j(m,{props:e},{default:k(()=>[j(a,{color:"primary",icon:"edit",label:"Grade",size:"sm",onClick:l=>{return a=e.row,Ue.value=a.id,void(Se.value=!0);var a}},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),j(M,{modelValue:Se.value,"onUpdate:modelValue":g[13]||(g[13]=e=>Se.value=e),"attempt-id":Ue.value,onGraded:Ae},null,8,["modelValue","attempt-id"])])],64)}}};export{$ as default};
