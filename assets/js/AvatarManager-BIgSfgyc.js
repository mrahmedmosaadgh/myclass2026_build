import{r as e,u as a,s as t,Q as o,d as s,f as l,o as r,b as i,e as n,aS as d}from"./app-CmR0nRZC.js";import{f as u,a as p,N as v,J as c,R as m,b as f,O as g,K as h,a0 as b,U as w,y,_ as x}from"./vendor-BWKGNkNB.js";import j from"./CameraCapture-RHzPPMh0.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./QFile-iF9I6X9U.js";import"./use-file-CoHYSI0L.js";import"./QImg-DP5hPvFf.js";const _=["src"],C={key:0,class:"absolute bottom-0 right-0 flex gap-1 z-20 pointer-events-auto"},z=e({__name:"AvatarManager",props:{student:{type:Object,required:!0},size:{type:String,default:"80px"},editEnabled:{type:Boolean,default:!1}},emits:["update:avatar"],setup(e,{emit:z}){const A=e,k=z,S=a(),U=u(!1),$=u(!1),O=u(null),F=p(()=>{const e=O.value||A.student.avatar;return e?e.startsWith("http")||e.startsWith("data:")||e.startsWith("/")?e:`/${e}`:null}),M=p(()=>""),W=p(()=>{const e=(A.student.name||"Student").split(" ").map(e=>e[0]||"").slice(0,2).join("").toUpperCase();return`data:image/svg+xml,${encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 96 96">\n    <rect width="96" height="96" fill="#e2e8f0" rx="48" ry="48"/>\n    <text x="48" y="48" dy="8" text-anchor="middle" font-family="Comic Sans MS, Arial" font-size="32" font-weight="bold" fill="#475569">${e}</text>\n  </svg>`)}`});function E(){S.dialog({title:"Remove Avatar",message:"Are you sure you want to remove this photo?",cancel:!0,persistent:!0}).onOk(()=>{!async function(){try{await x.delete(`/api/students/${A.student.id}/avatar`),O.value=null,A.student.avatar=null,k("update:avatar",null),S.notify({message:"Avatar removed",color:"positive",position:"top"})}catch(e){console.error("Failed to remove avatar",e),S.notify({message:"Failed to remove avatar",color:"negative",position:"top"})}}()})}async function I({dataUrl:e}){try{const a=await fetch(e),t=await a.blob(),o=new FormData;o.append("avatar",t,"avatar.png"),o.append("student_id",A.student.id);const s=await x.post(`/api/students/${A.student.id}/avatar`,o,{headers:{"Content-Type":"multipart/form-data"}});O.value=s.data.avatar||s.data.url||e,k("update:avatar",O.value),$.value=!1,S.notify({message:"Awesome new photo! ðŸŒŸ",color:"positive",icon:"star",position:"top"})}catch(a){console.error("Avatar upload failed",a),S.notify({message:"Oops! Could not save photo.",color:"negative",position:"top"})}}return(a,u)=>(c(),v("div",{class:"avatar-manager relative inline-block",onMouseenter:u[2]||(u[2]=e=>U.value=!0),onMouseleave:u[3]||(u[3]=e=>U.value=!1)},[m("div",{class:w(["avatar-container relative rounded-full border-4 transition-all duration-300 transform pointer-events-none",[M.value,U.value?"scale-105 shadow-xl border-yellow-400":"shadow-lg  ",(e.editEnabled,"")]])},[f(t,{size:e.size,class:"bg-gray-200"},{default:h(()=>[m("img",{src:F.value||W.value,class:"object-cover w-full h-full rounded-full",alt:"Student Avatar"},null,8,_)]),_:1},8,["size"]),e.editEnabled&&U.value?(c(),v("div",C,[F.value?(c(),v("div",{key:0,class:"bg-red-500 text-white rounded-full p-1.5 shadow-lg border-2 border-white cursor-pointer hover:bg-red-600 transition-colors",onClick:b(E,["stop"])},[f(o,{name:"delete",size:"xs"})])):g("",!0),m("div",{class:"bg-blue-600 text-white rounded-full p-1.5 shadow-lg border-2 border-white cursor-pointer hover:bg-blue-700 transition-colors",onClick:u[0]||(u[0]=b(e=>$.value=!0,["stop"]))},[f(o,{name:"edit",size:"xs"})])])):g("",!0)],2),f(n,{modelValue:$.value,"onUpdate:modelValue":u[1]||(u[1]=e=>$.value=e),maximized:"$q.screen.lt.sm"},{default:h(()=>[f(s,{style:{width:"100%","max-width":"500px"},class:"rounded-2xl overflow-hidden"},{default:h(()=>[f(l,{class:"bg-blue-500 text-white p-4"},{default:h(()=>u[4]||(u[4]=[m("div",{class:"text-h6 font-bold"},"ðŸ“¸ Update Photo",-1)])),_:1}),f(l,{class:"p-0"},{default:h(()=>[f(j,{onCaptured:I})]),_:1}),f(r,{align:"right",class:"bg-gray-100"},{default:h(()=>[y(f(i,{flat:"",label:"Cancel",color:"grey"},null,512),[[d]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],32))}},[["__scopeId","data-v-d2b32b5d"]]);export{z as default};
