import{d as e,f as t,o as a,e as l,L as o,I as i,M as n,O as r,S as s,V as u,x as d,U as c,ab as v}from"./vendor-DNM7Y6Xn.js";const h={class:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 p-4"},p={class:"max-w-5xl mx-auto"},g={class:"bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl p-6 mb-8 border border-white/30"},x={class:"flex flex-wrap gap-4 justify-center items-center"},f={class:"flex rounded-xl overflow-hidden shadow-lg"},b={class:"flex items-center gap-6"},w={class:"flex items-center gap-3"},m={class:"font-bold text-lg w-12 text-right"},y={class:"flex gap-3"},k=["disabled"],R=["disabled"],P={class:"flex gap-3"},C={class:"bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-xl shadow-lg cursor-pointer transition"},O={class:"bg-white/90 backdrop-blur-xl rounded-3xl shadow-2xl overflow-hidden border border-white/40"},S={key:0,class:"fixed inset-0 pointer-events-none flex items-end justify-center pb-12"},j={class:"bg-black/80 text-white px-8 py-4 rounded-full text-xl font-bold shadow-2xl animate-pulse"},L=e({__name:"draw copy",setup(e){const L=t(null);let U=null;const B=t("pen"),E=t("#8B5CF6"),M=t(6),T=t(!1),A=t(!1),I=t(0),J=t([]),z=t([]),D=t(0);function N(){if(!L.value||!U)return;const e=L.value.getBoundingClientRect(),t=L.value.width,a=L.value.height;L.value.width=e.width*devicePixelRatio,L.value.height=e.height*devicePixelRatio,null==U||U.scale(devicePixelRatio,devicePixelRatio),t>0&&a>0&&Y(),H()}function V(e){if(!L.value)return{x:0,y:0};const t=L.value.getBoundingClientRect();return{x:(e.clientX-t.left)*devicePixelRatio,y:(e.clientY-t.top)*devicePixelRatio}}function F(e){if(A.value||!U)return;T.value=!0;const t=V(e),a={tool:B.value,color:"pen"===B.value?E.value:null,width:M.value,path:[t]};J.value.push(a),U.beginPath(),U.moveTo(t.x/devicePixelRatio,t.y/devicePixelRatio),"eraser"===B.value?U.globalCompositeOperation="destination-out":(U.globalCompositeOperation="source-over",U.strokeStyle=E.value,U.lineWidth=M.value)}function W(e){if(!T.value||!U||0===J.value.length)return;const t=V(e);J.value[J.value.length-1].path.push(t),U.lineTo(t.x/devicePixelRatio,t.y/devicePixelRatio),U.stroke()}function _(){T.value&&(T.value=!1,H())}function H(){if(!U||!L.value)return;const e=U.getImageData(0,0,L.value.width,L.value.height);z.value=z.value.slice(0,D.value+1),z.value.push(e),D.value=z.value.length-1}function q(){D.value<=0||(D.value--,function(){if(!U||!L.value||D.value<0)return;U.putImageData(z.value[D.value],0,0)}())}function X(){U&&L.value&&(U.clearRect(0,0,L.value.width,L.value.height),J.value=[],z.value=[],D.value=-1,H())}function Y(){U&&L.value&&(U.clearRect(0,0,L.value.width,L.value.height),J.value.forEach(e=>{if(!(e.path.length<2)){U.beginPath(),U.moveTo(e.path[0].x/devicePixelRatio,e.path[0].y/devicePixelRatio),"eraser"===e.tool?U.globalCompositeOperation="destination-out":(U.globalCompositeOperation="source-over",U.strokeStyle=e.color,U.lineWidth=e.width);for(let t=1;t<e.path.length;t++)U.lineTo(e.path[t].x/devicePixelRatio,e.path[t].y/devicePixelRatio);U.stroke()}}))}async function $(){if(0===J.value.length||!U||!L.value)return;A.value=!0,I.value=0,U.clearRect(0,0,L.value.width,L.value.height);let e=0;J.value.forEach(t=>e+=t.path.length);let t=0;for(const a of J.value)if(!(a.path.length<2)){U.beginPath(),U.moveTo(a.path[0].x/devicePixelRatio,a.path[0].y/devicePixelRatio),"eraser"===a.tool?U.globalCompositeOperation="destination-out":(U.globalCompositeOperation="source-over",U.strokeStyle=a.color,U.lineWidth=a.width);for(let l=1;l<a.path.length;l++){const o=a.path[l];U.lineTo(o.x/devicePixelRatio,o.y/devicePixelRatio),U.stroke(),t++,I.value=t/e*100,await new Promise(requestAnimationFrame)}}A.value=!1,I.value=0}function G(){const e={version:2,strokes:J.value,createdAt:(new Date).toISOString()},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.download=`drawing-${(new Date).toISOString().slice(0,10)}.json`,l.click(),URL.revokeObjectURL(a)}function K(e){var t;const a=null==(t=e.target.files)?void 0:t[0];if(!a)return;const l=new FileReader;l.onload=()=>{try{const e=JSON.parse(l.result);e.strokes&&Array.isArray(e.strokes)&&(J.value=e.strokes,Y(),H())}catch(e){alert("Invalid file!")}},l.readAsText(a)}return a(()=>{!function(){if(!L.value)return;if(U=L.value.getContext("2d"),!U)return;U.lineCap="round",U.lineJoin="round",N(),H()}(),window.addEventListener("resize",N)}),l(()=>{window.removeEventListener("resize",N)}),(e,t)=>(i(),o("div",h,[n("div",p,[t[8]||(t[8]=n("h1",{class:"text-center text-5xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2"}," Magic Canvas ",-1)),t[9]||(t[9]=n("p",{class:"text-center text-gray-600 mb-8"},"Draw • Erase • Replay • Save as JSON",-1)),n("div",g,[n("div",x,[n("div",f,[n("button",{onClick:t[0]||(t[0]=e=>B.value="pen"),class:s(["pen"===B.value?"bg-gradient-to-r from-purple-500 to-pink-500 text-white":"bg-gray-100 text-gray-700","flex items-center gap-2 px-6 py-4 font-medium transition"])},t[4]||(t[4]=[n("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})],-1),u(" Pen ")]),2),n("button",{onClick:t[1]||(t[1]=e=>B.value="eraser"),class:s(["eraser"===B.value?"bg-gradient-to-r from-red-500 to-orange-500 text-white":"bg-gray-100 text-gray-700","flex items-center gap-2 px-6 py-4 font-medium transition"])},t[5]||(t[5]=[n("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"}),n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 7v4m0 4v.01"})],-1),u(" Eraser ")]),2)]),n("div",b,[d(n("input",{type:"color","onUpdate:modelValue":t[2]||(t[2]=e=>E.value=e),class:"w-14 h-14 rounded-full cursor-pointer shadow-xl hover:scale-110 transition"},null,512),[[v,E.value]]),n("div",w,[d(n("input",{type:"range","onUpdate:modelValue":t[3]||(t[3]=e=>M.value=e),min:"1",max:"50",class:"w-40 accent-purple-600"},null,512),[[v,M.value,void 0,{number:!0}]]),n("span",m,c(M.value),1)])]),n("div",y,[n("button",{onClick:X,class:"bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-xl shadow-lg transition"},"Clear"),n("button",{onClick:q,disabled:0===D.value,class:"bg-gray-600 hover:bg-gray-700 disabled:opacity-40 text-white px-6 py-3 rounded-xl shadow-lg transition"},"Undo",8,k),n("button",{onClick:$,disabled:0===J.value.length,class:"bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white px-6 py-3 rounded-xl shadow-lg transition flex items-center gap-2"},t[6]||(t[6]=[n("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.752 11.168l-6.718-3.873A1 1 0 007 8.135v7.73a1 1 0 001.034.968l6.718-3.873a1 1 0 000-1.792z"})],-1),u(" Replay ")]),8,R)]),n("div",P,[n("button",{onClick:G,class:"bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl shadow-lg transition"},"Save JSON"),n("label",C,[t[7]||(t[7]=u(" Load JSON ")),n("input",{type:"file",onChange:K,accept:".json",class:"hidden"},null,32)])])])]),n("div",O,[n("canvas",{ref_key:"canvas",ref:L,onPointerdown:F,onPointermove:W,onPointerup:_,onPointerleave:_,onPointercancel:_,class:s(["w-full block touch-none","eraser"===B.value?"cursor-eraser":"cursor-crosshair"]),style:{height:"calc(100vh - 280px)","min-height":"500px"}},null,34)]),A.value?(i(),o("div",S,[n("div",j," Replaying... "+c(Math.round(I.value))+"% ",1)])):r("",!0)])]))}});export{L as default};
