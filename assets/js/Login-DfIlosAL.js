import{a7 as e,f as a,o as s,N as t,J as o,b as r,z as l,a4 as n,K as m,O as i,R as c,V as d,I as u,W as p,P as g,U as f,a0 as w,F as h}from"./vendor-BWKGNkNB.js";import{A as y}from"./AuthenticationCard-Bb0uXJb6.js";import{_ as v}from"./AuthenticationCardLogo-Ds0_QHOW.js";import{_ as b}from"./Checkbox-CIyeGr69.js";import{_ as x}from"./InputError-DEGVtjzl.js";import{_}from"./InputLabel-Ch3YeqCE.js";import{_ as S}from"./PrimaryButton-DVJXOzHH.js";import{_ as j}from"./TextInput-QkZjzCho.js";import"./app-Dtv5Fi9L.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";const k={key:0,class:"mb-4 font-medium text-sm text-green-600"},I={key:0,class:"mt-4"},L={key:1,class:"block mt-4"},P={class:"flex items-center"},R={key:2,class:"flex items-center justify-end mt-4"},U={key:3,class:"mt-4 text-center text-sm text-gray-600"},V={__name:"Login",props:{canResetPassword:Boolean,status:String},setup(V){const q="myclass_user_email",A="myclass_school_slug",B=e({email:"",password:"",remember:!1}),C=a(!1);async function F(){if(B.email&&!(B.email.length<3)){C.value=!0;try{const e=await axios.post(route("detect.school"),{email:B.email});if(e.data.redirect){localStorage.setItem(q,B.email),localStorage.setItem(A,e.data.school_slug);let a=e.data.redirect;const s=new URLSearchParams;s.append("email",B.email);const t=new URLSearchParams(window.location.search).get("intended");t&&s.append("intended",t),a+="?"+s.toString(),window.location.href=a}}catch(e){console.log("No school detected, using default login")}finally{C.value=!1}}}a(""),s(async()=>{const e=localStorage.getItem(q);e&&(B.email=e);const a=localStorage.getItem(A);if(a)try{const s=await axios.post(route("validate.school"),{slug:a});if(s.data.valid){let a=s.data.login_url;const t=new URLSearchParams;e&&t.append("email",e);const o=new URLSearchParams(window.location.search).get("intended");o&&t.append("intended",o),t.toString()&&(a+="?"+t.toString()),window.location.href=a}else localStorage.removeItem(A)}catch(s){localStorage.removeItem(A)}});const E=()=>{B.transform(e=>({...e,remember:B.remember?"on":""})).post(route("login"),{onFinish:()=>B.reset("password")})};return(e,a)=>(o(),t(h,null,[r(l(n),{title:"Log in"}),r(y,null,{logo:m(()=>[r(v)]),default:m(()=>[V.status?(o(),t("div",k,d(V.status),1)):i("",!0),c("form",{onSubmit:w(E,["prevent"])},[c("div",null,[r(_,{for:"email",value:"Email"}),r(j,{id:"email",modelValue:l(B).email,"onUpdate:modelValue":a[0]||(a[0]=e=>l(B).email=e),class:"mt-1 block w-full",required:"",autofocus:"",autocomplete:"username",onBlur:F},null,8,["modelValue"]),r(x,{class:"mt-2",message:l(B).errors.email},null,8,["message"])]),C.value?i("",!0):(o(),t("div",I,[r(_,{for:"password",value:"Password"}),r(j,{id:"password",modelValue:l(B).password,"onUpdate:modelValue":a[1]||(a[1]=e=>l(B).password=e),type:"password",class:"mt-1 block w-full",required:"",autocomplete:"current-password"},null,8,["modelValue"]),r(x,{class:"mt-2",message:l(B).errors.password},null,8,["message"])])),C.value?i("",!0):(o(),t("div",L,[c("label",P,[r(b,{checked:l(B).remember,"onUpdate:checked":a[2]||(a[2]=e=>l(B).remember=e),name:"remember"},null,8,["checked"]),a[3]||(a[3]=c("span",{class:"ms-2 text-sm text-gray-600"},"Remember me",-1))])])),C.value?i("",!0):(o(),t("div",R,[V.canResetPassword?(o(),u(l(g),{key:0,href:e.route("password.request"),class:"underline text-sm text-gray-600 hover:text-gray-900 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},{default:m(()=>a[4]||(a[4]=[p(" Forgot your password? ")])),_:1},8,["href"])):i("",!0),r(S,{class:f(["ms-4",{"opacity-25":l(B).processing}]),disabled:l(B).processing},{default:m(()=>a[5]||(a[5]=[p(" Log in ")])),_:1},8,["class","disabled"])])),C.value?(o(),t("div",U," Detecting your school... ")):i("",!0)],32)]),_:1})],64))}};export{V as default};
