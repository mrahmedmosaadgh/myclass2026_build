import{M as e}from"./Modal-CxCPTite.js";import{f as t,k as l,N as s,J as r,O as a,b as o,V as n,a0 as u,U as i,K as d,Q as c,F as p,R as v,W as m,_ as x}from"./vendor-BJyC5yAd.js";import{read as g,utils as f}from"./xlsx-BHXqx-YI.js";import{r as y}from"./app-DTyzyps1.js";import"./offline-BzIlwqNM.js";import"./i18n-BDgsCcB6.js";import"./ui-DFn3cvMd.js";const h={class:"flex flex-col items-center justify-center space-y-3 cursor-pointer"},w={class:"text-lg font-medium text-gray-700"},b={class:"p-6"},k={class:"flex justify-between items-center mb-4"},C={class:"text-lg font-medium text-gray-900"},T={class:"text-sm text-gray-500"},S={key:0,class:"overflow-x-auto mb-6 rounded-lg border border-gray-200 shadow"},j={class:"min-w-full divide-y divide-gray-200"},B={class:"bg-blue-50"},U={key:0,class:"text-red-500 ml-1"},_={class:"bg-white divide-y divide-gray-200"},I={key:0},z={key:1,class:"text-gray-400 italic"},M={class:"px-6 py-4 whitespace-nowrap text-sm"},A={class:"flex justify-end space-x-3"},q=["disabled"],E={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},D={class:"p-6"},V={class:"flex items-center justify-between mb-6"},F={class:"text-xl font-semibold text-gray-900"},N={key:0,class:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4"},P={class:"flex items-center mb-3"},R={class:"text-green-800 font-medium"},W={class:"pl-7"},$={class:"text-sm text-green-700 space-y-1 max-h-40 overflow-y-auto"},H={key:1,class:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4"},L={class:"flex items-center mb-3"},J={class:"text-red-800 font-medium"},K={class:"pl-7"},O={class:"text-sm text-red-700 space-y-1 max-h-40 overflow-y-auto"},Q={class:"mt-6 flex justify-end space-x-3"},X=["disabled"],G={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-red-700",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Y={key:1,class:"-ml-1 mr-2 h-4 w-4 text-red-700",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Z=y({__name:"ImportExcel",props:{validateUrl:{type:String,required:!0},importUrl:{type:String,required:!0},undoUrl:{type:String,required:!1,default:""},columns:{type:Array,required:!0},buttonText:{type:String,default:"Choose Excel File"},previewTitle:{type:String,default:"Preview Import Data"},confirmButtonText:{type:String,default:"Confirm Import"},cancelButtonText:{type:String,default:"Cancel"},processingText:{type:String,default:"Processing..."},resultsTitle:{type:String,default:"Import Results"},undoButtonText:{type:String,default:"Undo Import"},undoingText:{type:String,default:"Undoing..."},closeButtonText:{type:String,default:"Close"}},emits:["imported"],setup(y,{emit:Z}){const ee=y,te=Z,le=t(null),se=t(!1),re=t(!1),ae=t(!1),oe=t(!1),ne=t([]),ue=t({success:[],errors:[]}),ie=t(!1),de=t(null),ce=t(!1);l(()=>ee.columns,()=>{ne.value.length>0&&(ne.value=ne.value.map(e=>{const t={};return ee.columns.forEach(l=>{t[l.key]=e.data[l.key]}),{...e,data:t}}))},{deep:!0});const pe=e=>{if(!e)return;const t=new FileReader;t.onload=e=>{const t=new Uint8Array(e.target.result),l=g(t,{type:"array"}),s=l.Sheets[l.SheetNames[0]],r=f.sheet_to_json(s,{header:1});r.shift(),ne.value=r.filter(e=>e.length).map(e=>{const t={};return ee.columns.forEach((l,s)=>{t[l.key]=e[s]}),{data:t,status:"new"}}),xe(),ae.value=!0},t.readAsArrayBuffer(e)},ve=e=>{const t=e.target.files[0];pe(t)},me=e=>{ce.value=!1;const t=e.dataTransfer.files[0];pe(t)},xe=async()=>{try{const e=ee.columns.filter(e=>e.required).map(e=>e.key),t=await x.post(ee.validateUrl,{data:ne.value.map(e=>e.data),required_fields:e,columns:ee.columns});ne.value=ne.value.map((e,l)=>({...e,status:t.data.stats.invalid_rows>0?"warning":"valid"})),te("validation-success",t.data)}catch(e){console.error("Validation error:",e)}},ge=async()=>{var e,t;se.value=!0,NProgress.start();try{const e=await x.post(ee.importUrl,{data:ne.value.map(e=>e.data),columns:ee.columns});te("imported"),ue.value=e.data.results,de.value=e.data.importId,ie.value=!!ee.undoUrl,ae.value=!1,oe.value=!0}catch(l){console.error("Import error:",l),ue.value={success:[],errors:[(null==(t=null==(e=l.response)?void 0:e.data)?void 0:t.message)||"An error occurred during import"]},oe.value=!0}finally{se.value=!1,le.value.value=""}},fe=async()=>{if(de.value&&ee.undoUrl){re.value=!0,NProgress.start();try{await x.post(`${ee.undoUrl}/${de.value}`),ie.value=!1,te("imported"),he()}catch(e){alert("Failed to undo the import")}finally{re.value=!1}}},ye=()=>{ae.value=!1,ne.value=[],le.value.value=""},he=()=>{oe.value=!1,ue.value={success:[],errors:[]},de.value=null,ie.value=!1};return(t,l)=>(r(),s("div",null,[a("input",{type:"file",ref_key:"fileInput",ref:le,class:"hidden",accept:".xlsx,.xls",onChange:ve},null,544),a("div",{class:i(["border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition-colors duration-200",{"border-blue-500 bg-blue-50":ce.value}]),onDragover:l[0]||(l[0]=u(e=>ce.value=!0,["prevent"])),onDragleave:l[1]||(l[1]=u(e=>ce.value=!1,["prevent"])),onDrop:u(me,["prevent"]),onClick:l[2]||(l[2]=e=>t.$refs.fileInput.click())},[a("div",h,[l[3]||(l[3]=a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),a("div",w,n(y.buttonText),1),l[4]||(l[4]=a("p",{class:"text-sm text-gray-500"},"Drag and drop your Excel file here, or click to browse",-1)),l[5]||(l[5]=a("div",{class:"text-xs text-gray-400"},"Supported formats: .xlsx, .xls",-1))])],34),o(e,{show:ae.value,onClose:ye,maxWidth:"4xl"},{default:d(()=>[a("div",b,[a("div",k,[a("h3",C,n(y.previewTitle),1),a("div",T," Total Records: "+n(ne.value.length),1)]),ae.value?(r(),s("div",S,[a("table",j,[a("thead",B,[a("tr",null,[(r(!0),s(p,null,v(y.columns.filter(e=>!e.hidden),e=>(r(),s("th",{key:e.key,class:"px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider"},[m(n(e.label)+" ",1),e.required?(r(),s("span",U,"*")):c("",!0)]))),128)),l[6]||(l[6]=a("th",{class:"px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider"}," Status ",-1))])]),a("tbody",_,[(r(!0),s(p,null,v(ne.value,(e,t)=>(r(),s("tr",{key:t,class:"hover:bg-gray-50 transition-colors duration-150"},[(r(!0),s(p,null,v(y.columns.filter(e=>!e.hidden),t=>(r(),s("td",{key:t.key,class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},[e.data[t.key]?(r(),s("span",I,n(e.data[t.key]),1)):(r(),s("span",z,"Empty"))]))),128)),a("td",M,[a("span",{class:i({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":"valid"===e.status,"bg-yellow-100 text-yellow-800":"warning"===e.status||"new"===e.status,"bg-red-100 text-red-800":"error"===e.status})},n(e.status),3)])]))),128))])])])):c("",!0),a("div",A,[a("button",{onClick:ye,class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"},n(y.cancelButtonText),1),a("button",{onClick:ge,disabled:se.value||!ne.value.length,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"},[se.value?(r(),s("svg",E,l[7]||(l[7]=[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):c("",!0),m(" "+n(se.value?y.processingText:y.confirmButtonText),1)],8,q)])])]),_:1},8,["show"]),o(e,{show:oe.value,onClose:he,maxWidth:"2xl"},{default:d(()=>[a("div",D,[a("div",V,[a("h3",F,n(y.resultsTitle),1),l[8]||(l[8]=a("div",{class:"bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full"}," Import Complete ",-1))]),ue.value.success.length?(r(),s("div",N,[a("div",P,[l[9]||(l[9]=a("svg",{class:"w-5 h-5 text-green-500 mr-2",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)),a("h4",R,"Success ("+n(ue.value.success.length)+")",1)]),a("div",W,[a("ul",$,[(r(!0),s(p,null,v(ue.value.success,(e,t)=>(r(),s("li",{key:t,class:"flex items-start"},[l[10]||(l[10]=a("span",{class:"mr-1"},"•",-1)),a("span",null,n(e),1)]))),128))])])])):c("",!0),ue.value.errors.length?(r(),s("div",H,[a("div",L,[l[11]||(l[11]=a("svg",{class:"w-5 h-5 text-red-500 mr-2",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),a("h4",J,"Errors ("+n(ue.value.errors.length)+")",1)]),a("div",K,[a("ul",O,[(r(!0),s(p,null,v(ue.value.errors,(e,t)=>(r(),s("li",{key:t,class:"flex items-start"},[l[12]||(l[12]=a("span",{class:"mr-1"},"•",-1)),a("span",null,n(e),1)]))),128))])])])):c("",!0),a("div",Q,[ie.value?(r(),s("button",{key:0,onClick:fe,disabled:re.value,class:"px-4 py-2 border border-red-300 text-red-700 rounded-lg hover:bg-red-50 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"},[re.value?(r(),s("svg",G,l[13]||(l[13]=[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(r(),s("svg",Y,l[14]||(l[14]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"},null,-1)]))),m(" "+n(re.value?y.undoingText:y.undoButtonText),1)],8,X)):c("",!0),a("button",{onClick:he,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},n(y.closeButtonText),1)])])]),_:1},8,["show"])]))}},[["__scopeId","data-v-3d3783a1"]]);export{Z as default};
