import{o as e,c as a,d as l,aF as t,Q as o,p as n,a as s,m as i}from"./app-B77gjd5a.js";import{Q as r}from"./QColor-wHZP5dke.js";import{Q as c}from"./QPopupProxy-DUcqDdBR.js";import{Q as u}from"./QSlider-DfH-qdFu.js";import{Q as d}from"./QSpace-Bk4F2b8L.js";import{Q as f}from"./QBadge-ZkvAqPBD.js";import{f as p,a as m,o as v,k as g,M as b,J as h,b as x,K as y,N as _,W as w,V as k,S as j,I as q,a0 as C}from"./vendor-DuKqz2x4.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";import"./QTabs-D_ZwIIJm.js";import"./rtl-Cr6c3OOr.js";import"./QTab-CnAf4tCv.js";import"./QTabPanels-B5JhG1n5.js";import"./use-panel-N2fkKyR_.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanel-B_PJ80R0.js";const T={class:"finger-drawing-container"},Q={class:"row items-center q-gutter-sm"},V={class:"col-auto"},R={class:"text-caption text-grey-7 q-mb-xs"},S={class:"col-auto"},U={class:"text-caption text-grey-7 q-mb-xs"},I={class:"row items-center q-gutter-sm"},O={class:"brush-size-control"},P={class:"col-auto"},z={class:"text-caption text-grey-7 q-mb-xs"},L={class:"col-auto"},F={class:"text-caption text-grey-7 q-mb-xs"},J={class:"col-auto"},M={class:"canvas-wrapper"},A=800,D=500,N=e({__name:"FingerDrawingSlide",props:{modelValue:{type:Object,default:()=>({})}},emits:["export-json","update:modelValue"],setup(e,{emit:N}){const B=e,E=N,W=p(null);let X=null;const Y=p([]),$=p([]);let K=null;const H=p(!1),G=p(!1),Z=p("#111111"),ee=p(3);let ae=null,le=null,te=null,oe=null;function ne(){if(X){X.clearRect(0,0,A,D),ae?X.drawImage(ae,0,0,te,oe):le&&(X.font="16px sans-serif",X.fillStyle="#888",X.fillText(le,20,40));for(const e of Y.value)ie(e);K&&ie(K)}}function se(e){const a=W.value.getBoundingClientRect();return e.touches&&e.touches[0]?{x:e.touches[0].clientX-a.left,y:e.touches[0].clientY-a.top}:{x:e.clientX-a.left,y:e.clientY-a.top}}function ie(e){const a=e.points;if(!(a.length<2)){X.strokeStyle=e.color,X.lineWidth=e.size,X.beginPath(),X.moveTo(a[0].x,a[0].y);for(let e=1;e<a.length-1;e++){const l=(a[e].x+a[e+1].x)/2,t=(a[e].y+a[e+1].y)/2;X.quadraticCurveTo(a[e].x,a[e].y,l,t)}X.lineTo(a[a.length-1].x,a[a.length-1].y),X.stroke()}}function re(e){H.value=!0;const a=se(e);K={points:[{x:a.x,y:a.y,t:0}],color:Z.value,size:ee.value,_startTime:performance.now()}}function ce(e){if(!H.value||!K)return;const a=se(e),l=performance.now()-K._startTime;K.points.push({x:a.x,y:a.y,t:l}),ne()}function ue(){H.value&&(H.value=!1,K&&(delete K._startTime,Y.value.push(K),$.value=[],de()),K=null,ne())}function de(){let e=null;if(ae){const a=document.createElement("canvas");a.width=te,a.height=oe;a.getContext("2d").drawImage(ae,0,0,te,oe),e={type:"image",data:a.toDataURL(),width:te,height:oe}}else le&&(e={type:"text",data:le});const a={strokes:Y.value,background:e};E("update:modelValue",a)}function fe(){const e=B.modelValue||{};if(e.strokes&&Array.isArray(e.strokes)&&(Y.value=e.strokes),e.background)if("image"===e.background.type){const a=new Image;a.onload=()=>{ae=a,te=e.background.width,oe=e.background.height,ne()},a.src=e.background.data}else"text"===e.background.type&&(le=e.background.data);ne()}function pe(){Y.value.length>0&&($.value.push(Y.value.pop()),ne(),de())}function me(){$.value.length>0&&(Y.value.push($.value.pop()),ne(),de())}function ve(){Y.value=[],$.value=[],ae=null,le=null,ne(),de()}const ge=m(()=>Y.value.length>0),be=m(()=>$.value.length>0),he=m(()=>Y.value.length>0);function xe(){if(G.value||0===Y.value.length)return;G.value=!0;let e=0,a=0;requestAnimationFrame(function l(){X.clearRect(0,0,A,D),ae?X.drawImage(ae,0,0,te,oe):le&&(X.font="16px sans-serif",X.fillStyle="#888",X.fillText(le,20,40));for(let a=0;a<e;a++)ie(Y.value[a]);if(e<Y.value.length){const t=Y.value[e],o=t.points,n=Math.floor(o.length*a);n>0&&ie({...t,points:o.slice(0,n+1)}),a+=.03,a>=1&&(a=0,e++),requestAnimationFrame(l)}else G.value=!1})}async function ye(){try{const e=await navigator.clipboard.read();for(const l of e)for(const e of l.types)if(e.startsWith("image/")){const a=await l.getType(e),t=new Image;return t.onload=()=>{ae=t,te=t.width,oe=t.height,le=null,ne(),de()},void(t.src=URL.createObjectURL(a))}const a=await navigator.clipboard.readText();a&&(le=a,ae=null,ne(),de())}catch(e){console.error("Clipboard paste failed:",e)}}function _e(){const e=B.modelValue||{strokes:Y.value},a=new Blob([JSON.stringify(e)],{type:"application/json"}),l=URL.createObjectURL(a),t=document.createElement("a");t.href=l,t.download=`drawing-${Date.now()}.json`,t.click(),URL.revokeObjectURL(l)}function we(){const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async e=>{const a=e.target.files[0];if(a)try{const e=await a.text(),l=JSON.parse(e);E("update:modelValue",l),fe()}catch(l){alert("Failed to load.")}},e.click()}return v(()=>{!function(){const e=W.value;if(!e)return;const a=window.devicePixelRatio||1;e.width=A*a,e.height=D*a,e.style.width=A+"px",e.style.height=D+"px",X=e.getContext("2d"),X.scale(a,a),X.lineCap="round",X.lineJoin="round",ne()}(),fe()}),g(()=>B.modelValue,e=>{H.value||fe()},{deep:!0}),(e,p)=>(h(),b("div",T,[x(i,{flat:"",bordered:"",class:"toolbar-card q-mb-md"},{default:y(()=>[x(a,{class:"q-pa-sm"},{default:y(()=>[_("div",Q,[_("div",V,[_("div",R,[x(l,{name:"brush",size:"xs",class:"q-mr-xs"}),p[2]||(p[2]=w(" Drawing Tools "))]),x(t,{flat:""},{default:y(()=>[x(o,{flat:"",dense:"",icon:"undo",disable:!ge.value,onClick:pe,color:"primary"},{default:y(()=>[x(n,null,{default:y(()=>[w("Undo ("+k(Y.value.length)+" strokes)",1)]),_:1})]),_:1},8,["disable"]),x(o,{flat:"",dense:"",icon:"redo",disable:!be.value,onClick:me,color:"primary"},{default:y(()=>[x(n,null,{default:y(()=>[w("Redo ("+k($.value.length)+" available)",1)]),_:1})]),_:1},8,["disable"]),x(o,{flat:"",dense:"",icon:"delete",onClick:ve,color:"negative"},{default:y(()=>[x(n,null,{default:y(()=>p[3]||(p[3]=[w("Clear All")])),_:1})]),_:1})]),_:1})]),x(s,{vertical:"",inset:""}),_("div",S,[_("div",U,[x(l,{name:"palette",size:"xs",class:"q-mr-xs"}),p[4]||(p[4]=w(" Brush Settings "))]),_("div",I,[x(o,{flat:"",dense:"",round:"",style:j({backgroundColor:Z.value,border:"2px solid #ccc"}),size:"md"},{default:y(()=>[x(c,null,{default:y(()=>[x(r,{modelValue:Z.value,"onUpdate:modelValue":p[0]||(p[0]=e=>Z.value=e),"no-header":"","no-footer":""},null,8,["modelValue"])]),_:1}),x(n,null,{default:y(()=>p[5]||(p[5]=[w("Pen Color")])),_:1})]),_:1},8,["style"]),_("div",O,[x(u,{modelValue:ee.value,"onUpdate:modelValue":p[1]||(p[1]=e=>ee.value=e),min:1,max:50,step:1,label:"","label-always":"",color:"primary",style:{"min-width":"120px"},class:"q-mx-sm"},{label:y(({value:e})=>[w(k(e)+"px ",1)]),_:1},8,["modelValue"])])])]),x(s,{vertical:"",inset:""}),_("div",P,[_("div",z,[x(l,{name:"movie",size:"xs",class:"q-mr-xs"}),p[6]||(p[6]=w(" Actions "))]),x(t,{flat:""},{default:y(()=>[x(o,{flat:"",dense:"",icon:"play_arrow",disable:G.value||!he.value,onClick:xe,color:"accent",loading:G.value},{default:y(()=>[x(n,null,{default:y(()=>p[7]||(p[7]=[w("Replay Drawing")])),_:1})]),_:1},8,["disable","loading"]),x(o,{flat:"",dense:"",icon:"content_paste",onClick:ye,color:"secondary"},{default:y(()=>[x(n,null,{default:y(()=>p[8]||(p[8]=[w("Paste Background Image")])),_:1})]),_:1})]),_:1})]),x(s,{vertical:"",inset:""}),_("div",L,[_("div",F,[x(l,{name:"folder",size:"xs",class:"q-mr-xs"}),p[9]||(p[9]=w(" File "))]),x(t,{flat:""},{default:y(()=>[x(o,{flat:"",dense:"",icon:"save_alt",disable:!he.value,onClick:_e,color:"positive"},{default:y(()=>[x(n,null,{default:y(()=>p[10]||(p[10]=[w("Download as JSON")])),_:1})]),_:1},8,["disable"]),x(o,{flat:"",dense:"",icon:"folder_open",onClick:we,color:"info"},{default:y(()=>[x(n,null,{default:y(()=>p[11]||(p[11]=[w("Load JSON File")])),_:1})]),_:1})]),_:1})]),x(d),_("div",J,[he.value?(h(),q(f,{key:0,color:"primary",label:`${Y.value.length} stroke${1!==Y.value.length?"s":""}`,class:"q-px-sm"},null,8,["label"])):(h(),q(f,{key:1,color:"grey-5",label:"Empty Canvas",class:"q-px-sm"}))])])]),_:1})]),_:1}),x(i,{flat:"",bordered:"",class:"canvas-card"},{default:y(()=>[_("div",M,[_("canvas",{ref_key:"canvas",ref:W,class:"drawing-canvas",onMousedown:re,onMousemove:ce,onMouseup:ue,onMouseleave:ue,onTouchstart:C(re,["prevent"]),onTouchmove:C(ce,["prevent"]),onTouchend:C(ue,["prevent"])},null,544)])]),_:1})]))}},[["__scopeId","data-v-0c09af57"]]);export{N as default};
