import{M as e}from"./Modal-BpNx4aeD.js";import{o as t,aU as l}from"./app-C-WHvmzS.js";import{f as s,k as r,N as a,J as o,O as n,b as u,V as i,a0 as d,U as c,K as p,Q as v,F as m,R as x,W as g,_ as f}from"./vendor-nQjeLEvd.js";import{r as y,u as h}from"./xlsx-cMC2LkxH.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";const w={class:"flex flex-col items-center justify-center space-y-3 cursor-pointer"},b={class:"text-lg font-medium text-gray-700"},k={class:"p-6"},C={class:"flex justify-between items-center mb-4"},T={class:"text-lg font-medium text-gray-900"},S={class:"text-sm text-gray-500"},j={key:0,class:"overflow-x-auto mb-6 rounded-lg border border-gray-200 shadow"},B={class:"min-w-full divide-y divide-gray-200"},U={class:"bg-blue-50"},_={key:0,class:"text-red-500 ml-1"},I={class:"bg-white divide-y divide-gray-200"},z={key:0},M={key:1,class:"text-gray-400 italic"},A={class:"px-6 py-4 whitespace-nowrap text-sm"},q={class:"flex justify-end space-x-3"},E=["disabled"],D={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},V={class:"p-6"},F={class:"flex items-center justify-between mb-6"},R={class:"text-xl font-semibold text-gray-900"},W={key:0,class:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4"},$={class:"flex items-center mb-3"},H={class:"text-green-800 font-medium"},L={class:"pl-7"},N={class:"text-sm text-green-700 space-y-1 max-h-40 overflow-y-auto"},P={key:1,class:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4"},J={class:"flex items-center mb-3"},K={class:"text-red-800 font-medium"},O={class:"pl-7"},Q={class:"text-sm text-red-700 space-y-1 max-h-40 overflow-y-auto"},G={class:"mt-6 flex justify-end space-x-3"},X=["disabled"],Y={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-red-700",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Z={key:1,class:"-ml-1 mr-2 h-4 w-4 text-red-700",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ee=t({__name:"ImportExcel",props:{validateUrl:{type:String,required:!0},importUrl:{type:String,required:!0},undoUrl:{type:String,required:!1,default:""},columns:{type:Array,required:!0},buttonText:{type:String,default:"Choose Excel File"},previewTitle:{type:String,default:"Preview Import Data"},confirmButtonText:{type:String,default:"Confirm Import"},cancelButtonText:{type:String,default:"Cancel"},processingText:{type:String,default:"Processing..."},resultsTitle:{type:String,default:"Import Results"},undoButtonText:{type:String,default:"Undo Import"},undoingText:{type:String,default:"Undoing..."},closeButtonText:{type:String,default:"Close"}},emits:["imported"],setup(t,{emit:ee}){const te=t,le=ee,se=s(null),re=s(!1),ae=s(!1),oe=s(!1),ne=s(!1),ue=s([]),ie=s({success:[],errors:[]}),de=s(!1),ce=s(null),pe=s(!1);r(()=>te.columns,()=>{ue.value.length>0&&(ue.value=ue.value.map(e=>{const t={};return te.columns.forEach(l=>{t[l.key]=e.data[l.key]}),{...e,data:t}}))},{deep:!0});const ve=e=>{if(!e)return;const t=new FileReader;t.onload=e=>{const t=new Uint8Array(e.target.result),l=y(t,{type:"array"}),s=l.Sheets[l.SheetNames[0]],r=h.sheet_to_json(s,{header:1});r.shift(),ue.value=r.filter(e=>e.length).map(e=>{const t={};return te.columns.forEach((l,s)=>{t[l.key]=e[s]}),{data:t,status:"new"}}),ge(),oe.value=!0},t.readAsArrayBuffer(e)},me=e=>{const t=e.target.files[0];ve(t)},xe=e=>{pe.value=!1;const t=e.dataTransfer.files[0];ve(t)},ge=async()=>{try{const e=te.columns.filter(e=>e.required).map(e=>e.key),t=await f.post(te.validateUrl,{data:ue.value.map(e=>e.data),required_fields:e,columns:te.columns});ue.value=ue.value.map((e,l)=>({...e,status:t.data.stats.invalid_rows>0?"warning":"valid"})),le("validation-success",t.data)}catch(e){console.error("Validation error:",e)}},fe=async()=>{var e,t;re.value=!0,l.start();try{const e=await f.post(te.importUrl,{data:ue.value.map(e=>e.data),columns:te.columns});le("imported"),ie.value=e.data.results,ce.value=e.data.importId,de.value=!!te.undoUrl,oe.value=!1,ne.value=!0}catch(s){console.error("Import error:",s),ie.value={success:[],errors:[(null==(t=null==(e=s.response)?void 0:e.data)?void 0:t.message)||"An error occurred during import"]},ne.value=!0}finally{re.value=!1,l.done(),se.value.value=""}},ye=async()=>{if(ce.value&&te.undoUrl){ae.value=!0,l.start();try{await f.post(`${te.undoUrl}/${ce.value}`),de.value=!1,le("imported"),we()}catch(e){alert("Failed to undo the import")}finally{ae.value=!1,l.done()}}},he=()=>{oe.value=!1,ue.value=[],se.value.value=""},we=()=>{ne.value=!1,ie.value={success:[],errors:[]},ce.value=null,de.value=!1};return(l,s)=>(o(),a("div",null,[n("input",{type:"file",ref_key:"fileInput",ref:se,class:"hidden",accept:".xlsx,.xls",onChange:me},null,544),n("div",{class:c(["border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition-colors duration-200",{"border-blue-500 bg-blue-50":pe.value}]),onDragover:s[0]||(s[0]=d(e=>pe.value=!0,["prevent"])),onDragleave:s[1]||(s[1]=d(e=>pe.value=!1,["prevent"])),onDrop:d(xe,["prevent"]),onClick:s[2]||(s[2]=e=>l.$refs.fileInput.click())},[n("div",w,[s[3]||(s[3]=n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),n("div",b,i(t.buttonText),1),s[4]||(s[4]=n("p",{class:"text-sm text-gray-500"},"Drag and drop your Excel file here, or click to browse",-1)),s[5]||(s[5]=n("div",{class:"text-xs text-gray-400"},"Supported formats: .xlsx, .xls",-1))])],34),u(e,{show:oe.value,onClose:he,maxWidth:"4xl"},{default:p(()=>[n("div",k,[n("div",C,[n("h3",T,i(t.previewTitle),1),n("div",S," Total Records: "+i(ue.value.length),1)]),oe.value?(o(),a("div",j,[n("table",B,[n("thead",U,[n("tr",null,[(o(!0),a(m,null,x(t.columns.filter(e=>!e.hidden),e=>(o(),a("th",{key:e.key,class:"px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider"},[g(i(e.label)+" ",1),e.required?(o(),a("span",_,"*")):v("",!0)]))),128)),s[6]||(s[6]=n("th",{class:"px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider"}," Status ",-1))])]),n("tbody",I,[(o(!0),a(m,null,x(ue.value,(e,l)=>(o(),a("tr",{key:l,class:"hover:bg-gray-50 transition-colors duration-150"},[(o(!0),a(m,null,x(t.columns.filter(e=>!e.hidden),t=>(o(),a("td",{key:t.key,class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},[e.data[t.key]?(o(),a("span",z,i(e.data[t.key]),1)):(o(),a("span",M,"Empty"))]))),128)),n("td",A,[n("span",{class:c({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":"valid"===e.status,"bg-yellow-100 text-yellow-800":"warning"===e.status||"new"===e.status,"bg-red-100 text-red-800":"error"===e.status})},i(e.status),3)])]))),128))])])])):v("",!0),n("div",q,[n("button",{onClick:he,class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"},i(t.cancelButtonText),1),n("button",{onClick:fe,disabled:re.value||!ue.value.length,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"},[re.value?(o(),a("svg",D,s[7]||(s[7]=[n("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),n("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):v("",!0),g(" "+i(re.value?t.processingText:t.confirmButtonText),1)],8,E)])])]),_:1},8,["show"]),u(e,{show:ne.value,onClose:we,maxWidth:"2xl"},{default:p(()=>[n("div",V,[n("div",F,[n("h3",R,i(t.resultsTitle),1),s[8]||(s[8]=n("div",{class:"bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full"}," Import Complete ",-1))]),ie.value.success.length?(o(),a("div",W,[n("div",$,[s[9]||(s[9]=n("svg",{class:"w-5 h-5 text-green-500 mr-2",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)),n("h4",H,"Success ("+i(ie.value.success.length)+")",1)]),n("div",L,[n("ul",N,[(o(!0),a(m,null,x(ie.value.success,(e,t)=>(o(),a("li",{key:t,class:"flex items-start"},[s[10]||(s[10]=n("span",{class:"mr-1"},"•",-1)),n("span",null,i(e),1)]))),128))])])])):v("",!0),ie.value.errors.length?(o(),a("div",P,[n("div",J,[s[11]||(s[11]=n("svg",{class:"w-5 h-5 text-red-500 mr-2",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),n("h4",K,"Errors ("+i(ie.value.errors.length)+")",1)]),n("div",O,[n("ul",Q,[(o(!0),a(m,null,x(ie.value.errors,(e,t)=>(o(),a("li",{key:t,class:"flex items-start"},[s[12]||(s[12]=n("span",{class:"mr-1"},"•",-1)),n("span",null,i(e),1)]))),128))])])])):v("",!0),n("div",G,[de.value?(o(),a("button",{key:0,onClick:ye,disabled:ae.value,class:"px-4 py-2 border border-red-300 text-red-700 rounded-lg hover:bg-red-50 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"},[ae.value?(o(),a("svg",Y,s[13]||(s[13]=[n("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),n("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(o(),a("svg",Z,s[14]||(s[14]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"},null,-1)]))),g(" "+i(ae.value?t.undoingText:t.undoButtonText),1)],8,X)):v("",!0),n("button",{onClick:we,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},i(t.closeButtonText),1)])])]),_:1},8,["show"])]))}},[["__scopeId","data-v-aacced2c"]]);export{ee as default};
