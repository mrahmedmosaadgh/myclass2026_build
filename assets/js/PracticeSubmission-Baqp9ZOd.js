import{o as e,u as a,c as l,a as t,d as o,aF as s,Q as i,aP as u,l as n,m as r}from"./app-DOc39CFu.js";import{Q as d}from"./QTab-Dldfuhzv.js";import{Q as c}from"./QTabs-CQbEg8iR.js";import{Q as v}from"./QFile-Dhj0vy9l.js";import{Q as p}from"./QTabPanel-C5l4w7rK.js";import{Q as m}from"./QSlider-XDiT4A1X.js";import{Q as f}from"./QSpace-DuS_4lXE.js";import{Q as g}from"./QTabPanels-D4WV1jNy.js";import{f as b,a as h,k as y,n as F,o as w,I as x,J as _,K as j,b as C,N as S,M as k,Q,W as P,R as V,S as R,F as T,V as U,y as q,_ as D}from"./vendor-DuKqz2x4.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";import"./rtl-Cr6c3OOr.js";import"./use-file-BqyVk4Qc.js";import"./use-panel-Ddka6S_L.js";import"./use-render-cache-CmTcazfP.js";const I={class:"column q-gutter-md"},M={key:0,class:"preview-container"},z=["src"],L={class:"column q-gutter-md"},J={class:"row q-gutter-sm items-center"},N={class:"row items-center q-gutter-xs"},O={class:"row items-center q-gutter-xs"},W={class:"text-caption"},E={class:"canvas-container"},G=e({__name:"PracticeSubmission",props:{progressId:{type:Number,required:!0},existingSubmission:{type:Object,default:null}},emits:["submitted","close"],setup(e,{emit:G}){const X=a(),B=e,K=G,Y=b("upload"),A=b(null),$=b(null),H=b(null),Z=b(null),ee=b(!1),ae=b("pen"),le=b("#000000"),te=b(3),oe=["#000000","#FF0000","#0000FF","#00FF00","#FFFF00","#FF00FF"],se=b(!1),ie=h(()=>"upload"===Y.value?null!==A.value:H.value&&!me()),ue=e=>{if(e){const a=new FileReader;a.onload=e=>{$.value=e.target.result},a.readAsDataURL(e)}else $.value=null},ne=()=>{if(H.value){const e=H.value.parentElement;H.value.width=e.offsetWidth,H.value.height=400,Z.value=H.value.getContext("2d"),Z.value.lineCap="round",Z.value.lineJoin="round",Z.value.fillStyle="#FFFFFF",Z.value.fillRect(0,0,H.value.width,H.value.height)}};y(Y,e=>{"draw"===e&&F(()=>{ne()})}),w(()=>{"draw"===Y.value&&F(()=>{ne()})});const re=e=>{const a=H.value.getBoundingClientRect(),l=H.value.width/a.width,t=H.value.height/a.height;return e.touches?{x:(e.touches[0].clientX-a.left)*l,y:(e.touches[0].clientY-a.top)*t}:{x:(e.clientX-a.left)*l,y:(e.clientY-a.top)*t}},de=e=>{if(!Z.value)return;e.preventDefault(),ee.value=!0;const a=re(e);Z.value.beginPath(),Z.value.moveTo(a.x,a.y)},ce=e=>{if(!ee.value)return;e.preventDefault();const a=re(e);"pen"===ae.value?(Z.value.strokeStyle=le.value,Z.value.lineWidth=te.value,Z.value.globalCompositeOperation="source-over"):"eraser"===ae.value&&(Z.value.strokeStyle="#FFFFFF",Z.value.lineWidth=2*te.value,Z.value.globalCompositeOperation="destination-out"),Z.value.lineTo(a.x,a.y),Z.value.stroke()},ve=()=>{ee.value=!1},pe=()=>{Z.value.fillStyle="#FFFFFF",Z.value.fillRect(0,0,H.value.width,H.value.height)},me=()=>{const e=document.createElement("canvas");e.width=H.value.width,e.height=H.value.height;const a=e.getContext("2d");return a.fillStyle="#FFFFFF",a.fillRect(0,0,e.width,e.height),H.value.toDataURL()===e.toDataURL()},fe=async()=>{var e,a;se.value=!0;try{const e=new FormData;"upload"===Y.value?(e.append("submission_type","upload"),e.append("file",A.value)):(e.append("submission_type","drawing"),e.append("drawing_data",H.value.toDataURL("image/png")));const a=await D.post(route("lesson-presentation.progress.submit-practice",{id:B.progressId}),e,{headers:{"Content-Type":"multipart/form-data"}});X.notify({type:"positive",message:"Practice submitted successfully!",position:"top"}),K("submitted",a.data),K("close")}catch(l){console.error("Submission error:",l),X.notify({type:"negative",message:(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.error)||"Failed to submit practice",position:"top"})}finally{se.value=!1}};return(e,a)=>(_(),x(r,{style:{"min-width":"700px","max-width":"90vw"}},{default:j(()=>[C(l,null,{default:j(()=>a[6]||(a[6]=[S("div",{class:"text-h6"},"Submit Practice Solution",-1),S("div",{class:"text-caption text-grey-7"},"Upload an image or draw your solution",-1)])),_:1}),C(t),C(l,null,{default:j(()=>[C(c,{modelValue:Y.value,"onUpdate:modelValue":a[0]||(a[0]=e=>Y.value=e),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify"},{default:j(()=>[C(d,{name:"upload",label:"Upload Image",icon:"upload_file"}),C(d,{name:"draw",label:"Draw Solution",icon:"draw"})]),_:1},8,["modelValue"]),C(t,{class:"q-my-md"}),C(g,{modelValue:Y.value,"onUpdate:modelValue":a[5]||(a[5]=e=>Y.value=e),animated:""},{default:j(()=>[C(p,{name:"upload"},{default:j(()=>[S("div",I,[C(v,{modelValue:A.value,"onUpdate:modelValue":[a[1]||(a[1]=e=>A.value=e),ue],label:"Choose an image",accept:"image/*","max-file-size":"5242880",outlined:"",clearable:""},{prepend:j(()=>[C(o,{name:"attach_file"})]),hint:j(()=>a[7]||(a[7]=[P(" Max file size: 5MB. Supported formats: JPG, PNG, GIF ")])),_:1},8,["modelValue"]),$.value?(_(),k("div",M,[a[8]||(a[8]=S("div",{class:"text-subtitle2 q-mb-sm"},"Preview:",-1)),S("img",{src:$.value,alt:"Preview",class:"preview-image"},null,8,z)])):Q("",!0)])]),_:1}),C(p,{name:"draw"},{default:j(()=>[S("div",L,[S("div",J,[C(s,{outline:""},{default:j(()=>[C(i,{outline:"pen"!==ae.value,unelevated:"pen"===ae.value,color:"primary",icon:"edit",label:"Pen",onClick:a[2]||(a[2]=e=>ae.value="pen")},null,8,["outline","unelevated"]),C(i,{outline:"eraser"!==ae.value,unelevated:"eraser"===ae.value,color:"primary",icon:"cleaning_services",label:"Eraser",onClick:a[3]||(a[3]=e=>ae.value="eraser")},null,8,["outline","unelevated"])]),_:1}),C(t,{vertical:""}),S("div",N,[a[9]||(a[9]=S("span",{class:"text-caption text-grey-7"},"Color:",-1)),(_(),k(T,null,V(oe,e=>C(i,{key:e,style:R({backgroundColor:e}),outline:le.value!==e,size:"sm",round:"",onClick:a=>le.value=e,class:"color-btn"},{default:j(()=>[le.value===e?(_(),x(o,{key:0,name:"check",color:"white",size:"xs"})):Q("",!0)]),_:2},1032,["style","outline","onClick"])),64))]),C(t,{vertical:""}),S("div",O,[a[10]||(a[10]=S("span",{class:"text-caption text-grey-7"},"Size:",-1)),C(m,{modelValue:te.value,"onUpdate:modelValue":a[4]||(a[4]=e=>te.value=e),min:1,max:10,step:1,style:{width:"100px"},color:"primary"},null,8,["modelValue"]),S("span",W,U(te.value),1)]),C(f),C(i,{flat:"",color:"negative",icon:"delete",label:"Clear",onClick:pe})]),S("div",E,[S("canvas",{ref_key:"canvas",ref:H,onMousedown:de,onMousemove:ce,onMouseup:ve,onMouseleave:ve,onTouchstart:de,onTouchmove:ce,onTouchend:ve,class:"drawing-canvas"},null,544)])])]),_:1})]),_:1},8,["modelValue"])]),_:1}),C(t),C(n,{align:"right"},{default:j(()=>[q(C(i,{flat:"",label:"Cancel",color:"grey"},null,512),[[u]]),C(i,{unelevated:"",label:"Submit",color:"primary",onClick:fe,loading:se.value,disable:!ie.value},null,8,["loading","disable"])]),_:1})]),_:1}))}},[["__scopeId","data-v-87a7c7e7"]]);export{G as default};
