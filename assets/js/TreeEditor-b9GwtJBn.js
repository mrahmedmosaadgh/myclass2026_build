import{o as e,n as l,d as n,f as i,Q as o,L as a}from"./app-BB4Fw2oM.js";import{Q as d}from"./QTree-B3oN0HAc.js";import t from"./DraggableItem-CoeRlpJ1.js";import{f as r,k as u,M as s,J as c,b as f,W as m,V as p,K as v,N as h,Q as g,I as V,a2 as b,a0 as y}from"./vendor-DuKqz2x4.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";const k={class:"row items-center justify-between full-width"},w={class:"row items-center text-xs"},N={key:0},j={key:0,class:"row items-center text-xs full-width-row"},x=e({__name:"TreeEditor",props:{modelValue:{type:Array,required:!0},filter:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:x}){const C=e,J=x,S=r(JSON.parse(JSON.stringify(C.modelValue))),_=r(null),O=r([]),D=r(null),I=r(!1),T=r(!1);function Q(){J("update:modelValue",JSON.parse(JSON.stringify(S.value)))}function U(e){e.editing=!1,Q()}function z(e,l){for(let n=0;n<e.length;n++){if(e[n].id==l){const l=e[n];return e.splice(n,1),l}if(e[n].children){const i=z(e[n].children,l);if(i)return i}}}function K(e,l,n){for(const i of e){if(i.id==l)return i.children||(i.children=[]),i.children.push(n),!0;if(i.children){if(K(i.children,l,n))return!0}}}function q(e,l){if(!e.children)return!1;for(const n of e.children)if(n.id===l||q(n,l))return!0;return!1}function B({draggedId:e,targetId:l}){if(e===l)return;const n=z(S.value,e),i=A(S.value,l);if(n&&i){if(q(n,l))return console.warn("Cannot move parent into its child"),void Q();K(S.value,l,n),O.value.push(l),Q()}}function A(e,l){for(const n of e){if(n.id==l)return n;if(n.children){const e=A(n.children,l);if(e)return e}}}function E(e){clearTimeout(D.value),D.value=setTimeout(()=>{O.value.includes(e)||O.value.push(e)},500)}function L(){clearTimeout(D.value)}return u(()=>C.modelValue,e=>{S.value=JSON.parse(JSON.stringify(e))},{deep:!0}),(r,u)=>(c(),s("div",null,[f(l,{modelValue:I.value,"onUpdate:modelValue":u[0]||(u[0]=e=>I.value=e),label:"edit_mood"},null,8,["modelValue"]),m(" "+p(I.value)+" ",1),f(l,{modelValue:T.value,"onUpdate:modelValue":u[1]||(u[1]=e=>T.value=e),label:"isDraggable"},null,8,["modelValue"]),m(" "+p(T.value)+" ",1),f(d,{nodes:S.value,"node-key":"id",selected:_.value,expanded:O.value,filter:e.filter},{"default-header":v(e=>[f(t,{draggable:T.value,id:e.node.id,onDrop:B,onDragover:E,onDragleave:L},{default:v(()=>[h("div",k,[h("div",w,[f(n,{name:e.node.icon||"folder",class:"q-mr-sm"},null,8,["name"]),e.node.editing?(c(),V(i,{key:1,modelValue:e.node.label,"onUpdate:modelValue":l=>e.node.label=l,dense:"",autofocus:"",onBlur:l=>U(e.node),onKeyup:b(l=>U(e.node),["enter"])},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeyup"])):(c(),s("div",N,p(e.node.label),1))]),I.value?(c(),s("div",j,[f(o,{flat:"",dense:"",icon:"edit",size:"sm",onClick:y(l=>{e.node.editing=!0},["stop"])},null,8,["onClick"]),f(o,{flat:"",dense:"",icon:"add",size:"sm",onClick:y(l=>function(e){const l={id:a(),label:"New Node",children:[]};e.children||(e.children=[]),e.children.push(l),O.value.push(e.id),Q()}(e.node),["stop"])},null,8,["onClick"]),f(o,{flat:"",dense:"",icon:"delete",size:"sm",color:"negative",onClick:y(l=>{return n=e.node,S.value=function e(l,n){return l.filter(l=>l.id!==n&&(l.children&&(l.children=e(l.children,n)),!0))}(S.value,n.id),void Q();var n},["stop"])},null,8,["onClick"])])):g("",!0)])]),_:2},1032,["draggable","id"])]),_:1},8,["nodes","selected","expanded","filter"])]))}},[["__scopeId","data-v-34f90fc2"]]);export{x as default};
