import{p as e,u as s,Q as a,D as o,aC as t,h as l,aD as r,j as i,e as n,i as p,a as c,n as d,d as u,g as m,m as g,b as v}from"./app-BXm70mdJ.js";import{Q as y}from"./QBadge-ZzhN1X9C.js";import{Q as f}from"./QTd-BIxMTYzb.js";import{Q as _}from"./QTable-rnEofRem.js";import{f as b,o as k,L as w,I as h,M as x,b as C,U as F,J as q,x as z,O as j,H as I,V as P,R as L,Z as Q}from"./vendor-DNM7Y6Xn.js";import"./offline-BzIlwqNM.js";import"./i18n-CBOKL2HS.js";import"./ui-BP0GJNn5.js";import"./QMarkupTable-Dmg3C5Wm.js";import"./QSelect-CnZtzPIC.js";import"./rtl-Cr6c3OOr.js";import"./QLinearProgress-Cix0cchl.js";import"./use-fullscreen-FlxrEg_V.js";const S={class:"teacher-dashboard q-pa-md"},V={class:"row items-center q-mb-lg"},O={class:"col"},E={class:"text-grey-7 q-mb-none"},A={class:"col-auto"},B={class:"row items-center q-gutter-xs"},T={class:"text-caption"},D={key:0},R={key:1},U={key:2,class:"text-grey-5"},$={key:0},G={class:"text-caption q-ml-xs"},M={key:1},N={class:"text-caption"},H={class:"text-caption text-grey-7"},J={key:2,class:"text-grey-5"},K={class:"text-caption text-grey-7"},Z={key:0,class:"q-mb-md"},W={key:0,class:"submission-preview"},X=["src"],Y={key:1,class:"submission-preview"},ee=["src"],se=e({__name:"TeacherProgressDashboard",props:{lessonId:{type:Number,required:!0},teacherId:{type:Number,required:!0}},setup(e){const se=s(),ae=e,oe=b(null),te=b([]),le=b(!1),re=b(!1),ie=b(null),ne=b(null),pe=b(null),ce=b(""),de=b(!1),ue=[{name:"name",label:"Student Name",field:"name",align:"left",sortable:!0},{name:"status",label:"Status",field:"status",align:"center"},{name:"color",label:"Color",field:"color",align:"center"},{name:"learn",label:"Learn",field:"learn",align:"center"},{name:"practice",label:"Practice",field:"practice",align:"center"},{name:"quiz",label:"Quiz",field:"quiz",align:"center"},{name:"actions",label:"Actions",field:"actions",align:"center"}],me={gray:"#9E9E9E",light_blue:"#03A9F4",blue:"#2196F3",purple:"#9C27B0",green:"#4CAF50",yellow:"#FFEB3B",dark_yellow:"#FFC107",orange:"#FF9800",red:"#F44336"},ge=async()=>{le.value=!0;try{const e=await Q.get(route("lesson-presentation.show",{id:ae.lessonId}));oe.value=e.data;const s=await Q.get(route("lesson-presentation.progress.lesson",{lessonId:ae.lessonId}));s.data.forEach(e=>{}),te.value=s.data.map(e=>{var s;return{id:e.student_id,name:(null==(s=e.student)?void 0:s.name)||`Student ${e.student_id}`,progress:e}})}catch(e){console.error("Failed to fetch progress:",e),se.notify({type:"negative",message:"Failed to load progress data",position:"top"})}finally{le.value=!1}},ve=e=>e&&"locked"!==e.status?e.status.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"Locked",ye=async()=>{se.dialog({title:"Confirm",message:"Open this lesson for all students?",cancel:!0}).onOk(async()=>{try{const e=te.value.map(e=>e.id);await Q.post(route("lesson-presentation.progress.open"),{lesson_id:ae.lessonId,student_ids:e,teacher_id:ae.teacherId}),se.notify({type:"positive",message:"Lesson opened for all students",position:"top"}),ge()}catch(e){se.notify({type:"negative",message:"Failed to open lesson for all",position:"top"})}})},fe=async e=>{ie.value=e,pe.value=null,ce.value="";try{const s=await Q.get(route("lesson-presentation.progress.submission",{progressId:e.progress.id}));ne.value=s.data.submission,re.value=!0}catch(s){se.notify({type:"negative",message:"Failed to load practice submission",position:"top"})}},_e=async()=>{de.value=!0;try{await Q.put(route("lesson-presentation.progress.grade-practice",{id:ie.value.progress.id}),{score:pe.value,feedback:ce.value}),se.notify({type:"positive",message:"Practice graded successfully",position:"top"}),re.value=!1,ge()}catch(e){se.notify({type:"negative",message:"Failed to submit grade",position:"top"})}finally{de.value=!1}};return k(()=>{ge()}),(e,s)=>{var b;return h(),w("div",S,[x("div",V,[x("div",O,[s[3]||(s[3]=x("h4",{class:"text-h4 q-my-none"},"Student Progress Dashboard",-1)),x("p",E,F(null==(b=oe.value)?void 0:b.name),1)]),x("div",A,[C(o,{outline:""},{default:q(()=>[C(a,{label:"Open for All",icon:"lock_open",color:"positive",onClick:ye}),C(a,{label:"Refresh",icon:"refresh",onClick:ge})]),_:1})])]),C(_,{rows:te.value,columns:ue,"row-key":"id",loading:le.value,flat:"",bordered:"",class:"shadow-2"},{"body-cell-status":q(e=>[C(f,{props:e},{default:q(()=>{return[C(y,{color:(s=e.row.progress,s?"completed"===s.status?"positive":"failed"===s.status?"negative":"practice_submitted"===s.status?"purple":"info":"grey"),label:ve(e.row.progress)},null,8,["color","label"])];var s}),_:2},1032,["props"])]),"body-cell-color":q(e=>[C(f,{props:e},{default:q(()=>{var s,a,o;return[x("div",B,[x("div",{class:"color-indicator",style:L({backgroundColor:(o=null==(s=e.row.progress)?void 0:s.color_status,me[o]||me.gray)})},null,4),x("span",T,F((null==(a=e.row.progress)?void 0:a.color_status)||"gray"),1)])]}),_:2},1032,["props"])]),"body-cell-learn":q(e=>[C(f,{props:e},{default:q(()=>{var s,a;return[C(n,{name:(null==(s=e.row.progress)?void 0:s.learn_completed_at)?"check_circle":"radio_button_unchecked",color:(null==(a=e.row.progress)?void 0:a.learn_completed_at)?"positive":"grey",size:"sm"},null,8,["name","color"])]}),_:2},1032,["props"])]),"body-cell-practice":q(e=>[C(f,{props:e},{default:q(()=>{var s,o;return[null!==(null==(s=e.row.progress)?void 0:s.practice_score)?(h(),w("div",D,[C(y,{color:e.row.progress.practice_score>=6?"positive":"negative"},{default:q(()=>[P(F(e.row.progress.practice_score)+"/10 ",1)]),_:2},1032,["color"])])):"practice_submitted"===(null==(o=e.row.progress)?void 0:o.status)?(h(),w("div",R,[C(a,{size:"sm",color:"primary",label:"Grade",onClick:s=>fe(e.row)},null,8,["onClick"])])):(h(),w("span",U,"-"))]}),_:2},1032,["props"])]),"body-cell-quiz":q(e=>[C(f,{props:e},{default:q(()=>{var a,o;return[(null==(a=e.row.progress)?void 0:a.quiz_passed)?(h(),w("div",$,[C(n,{name:"check_circle",color:"positive",size:"sm"}),x("span",G,F(e.row.progress.quiz_best_score)+"%",1)])):(null==(o=e.row.progress)?void 0:o.quiz_attempts)>0?(h(),w("div",M,[x("span",N,F(e.row.progress.quiz_attempts)+" attempts",1),s[4]||(s[4]=x("br",null,null,-1)),x("span",H,"Best: "+F(e.row.progress.quiz_best_score)+"%",1)])):(h(),w("span",J,"-"))]}),_:2},1032,["props"])]),"body-cell-actions":q(e=>[C(f,{props:e},{default:q(()=>[C(t,{size:"sm",color:"primary",label:"Actions",dense:""},{default:q(()=>[C(l,null,{default:q(()=>{var a,o,t,l;return[e.row.progress&&"locked"!==e.row.progress.status?z((h(),I(p,{key:1,clickable:"",onClick:s=>(async e=>{try{await Q.post(route("lesson-presentation.progress.lock"),{progress_id:e.progress.id}),se.notify({type:"positive",message:`Lesson locked for ${e.name}`,position:"top"}),ge()}catch(s){se.notify({type:"negative",message:"Failed to lock lesson",position:"top"})}})(e.row)},{default:q(()=>[C(i,{avatar:""},{default:q(()=>[C(n,{name:"lock",color:"negative"})]),_:1}),C(i,null,{default:q(()=>s[6]||(s[6]=[P("Lock Lesson")])),_:1})]),_:2},1032,["onClick"])),[[r]]):z((h(),I(p,{key:0,clickable:"",onClick:s=>(async e=>{try{await Q.post(route("lesson-presentation.progress.open"),{lesson_id:ae.lessonId,student_ids:[e.id],teacher_id:ae.teacherId}),se.notify({type:"positive",message:`Lesson opened for ${e.name}`,position:"top"}),ge()}catch(s){se.notify({type:"negative",message:"Failed to open lesson",position:"top"})}})(e.row)},{default:q(()=>[C(i,{avatar:""},{default:q(()=>[C(n,{name:"lock_open",color:"positive"})]),_:1}),C(i,null,{default:q(()=>s[5]||(s[5]=[P("Open Lesson")])),_:1})]),_:2},1032,["onClick"])),[[r]]),C(c),(null==(a=e.row.progress)?void 0:a.practice_submitted_at)?z((h(),I(p,{key:2,clickable:"",onClick:s=>(async e=>{fe(e)})(e.row)},{default:q(()=>[C(i,{avatar:""},{default:q(()=>[C(n,{name:"visibility",color:"info"})]),_:1}),C(i,null,{default:q(()=>s[7]||(s[7]=[P("View Practice")])),_:1})]),_:2},1032,["onClick"])),[[r]]):j("",!0),(null==(o=e.row.progress)?void 0:o.quiz_attempts)>=3&&!(null==(t=e.row.progress)?void 0:t.quiz_passed)?z((h(),I(p,{key:3,clickable:"",onClick:s=>(async e=>{try{await Q.post(route("lesson-presentation.progress.grant-attempt"),{progress_id:e.progress.id}),se.notify({type:"positive",message:"Extra attempt granted",position:"top"}),ge()}catch(s){se.notify({type:"negative",message:"Failed to grant attempt",position:"top"})}})(e.row)},{default:q(()=>[C(i,{avatar:""},{default:q(()=>[C(n,{name:"add_circle",color:"warning"})]),_:1}),C(i,null,{default:q(()=>s[8]||(s[8]=[P("Grant Extra Attempt")])),_:1})]),_:2},1032,["onClick"])),[[r]]):j("",!0),"failed"===(null==(l=e.row.progress)?void 0:l.status)?z((h(),I(p,{key:4,clickable:"",onClick:s=>(async e=>{se.dialog({title:"Confirm Force Pass",message:`Force pass ${e.name}? This will mark the lesson as completed.`,cancel:!0}).onOk(async()=>{try{await Q.post(route("lesson-presentation.progress.force-pass"),{progress_id:e.progress.id}),se.notify({type:"positive",message:"Student force passed",position:"top"}),ge()}catch(s){se.notify({type:"negative",message:"Failed to force pass",position:"top"})}})})(e.row)},{default:q(()=>[C(i,{avatar:""},{default:q(()=>[C(n,{name:"done_all",color:"positive"})]),_:1}),C(i,null,{default:q(()=>s[9]||(s[9]=[P("Force Pass")])),_:1})]),_:2},1032,["onClick"])),[[r]]):j("",!0),C(c),e.row.progress?z((h(),I(p,{key:5,clickable:"",onClick:s=>(async e=>{se.dialog({title:"Confirm Reset",message:`Reset all progress for ${e.name}? This cannot be undone.`,cancel:!0}).onOk(async()=>{try{await Q.post(route("lesson-presentation.progress.reset"),{progress_id:e.progress.id}),se.notify({type:"positive",message:"Progress reset successfully",position:"top"}),ge()}catch(s){se.notify({type:"negative",message:"Failed to reset progress",position:"top"})}})})(e.row)},{default:q(()=>[C(i,{avatar:""},{default:q(()=>[C(n,{name:"restart_alt",color:"negative"})]),_:1}),C(i,null,{default:q(()=>s[10]||(s[10]=[P("Reset Progress")])),_:1})]),_:2},1032,["onClick"])),[[r]]):j("",!0)]}),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading"]),C(v,{modelValue:re.value,"onUpdate:modelValue":s[2]||(s[2]=e=>re.value=e),persistent:""},{default:q(()=>[C(d,{style:{"min-width":"600px"}},{default:q(()=>[C(u,null,{default:q(()=>{var e;return[s[11]||(s[11]=x("div",{class:"text-h6"},"Grade Practice Submission",-1)),x("div",K,"Student: "+F(null==(e=ie.value)?void 0:e.name),1)]}),_:1}),C(u,null,{default:q(()=>[ne.value?(h(),w("div",Z,[s[12]||(s[12]=x("div",{class:"text-subtitle2 q-mb-sm"},"Submission:",-1)),"upload"===ne.value.submission_type?(h(),w("div",W,[x("img",{src:ne.value.file_url,alt:"Practice submission",style:{"max-width":"100%","max-height":"400px"}},null,8,X)])):(h(),w("div",Y,[x("img",{src:ne.value.drawing_data,alt:"Drawing submission",style:{"max-width":"100%","max-height":"400px"}},null,8,ee)]))])):j("",!0),C(m,{modelValue:pe.value,"onUpdate:modelValue":s[0]||(s[0]=e=>pe.value=e),modelModifiers:{number:!0},type:"number",label:"Score (0-10)",min:0,max:10,outlined:"",class:"q-mb-md"},{append:q(()=>s[13]||(s[13]=[x("span",{class:"text-caption"},"/10",-1)])),_:1},8,["modelValue"]),C(m,{modelValue:ce.value,"onUpdate:modelValue":s[1]||(s[1]=e=>ce.value=e),type:"textarea",label:"Feedback (optional)",rows:"3",outlined:"",maxlength:"500",counter:""},null,8,["modelValue"])]),_:1}),C(g,{align:"right"},{default:q(()=>[z(C(a,{flat:"",label:"Cancel",color:"grey"},null,512),[[r]]),C(a,{unelevated:"",label:"Submit Grade",color:"primary",onClick:_e,disable:null===pe.value||pe.value<0||pe.value>10,loading:de.value},null,8,["disable","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-b88a3da5"]]);export{se as default};
