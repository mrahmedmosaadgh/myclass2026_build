import{l as e}from"./ui-BITzTqrO.js";import l from"./FormModal10-B3jc-U7v.js";import o from"./RadioButtonGroup-Ba1uLkD4.js";import{_ as a}from"./FilterSelectV2-BPyEW8J1.js";import s from"./Dropdown2-DmyVlgjo.js";import t from"./card2-Bh0aQ0Ga.js";import{f as r,k as d,a as i,af as n,I as u,J as c,K as v,N as m,M as p,Q as b,b as y,V as g,W as h,R as f,U as x,F as _,z as w,a0 as k,y as j,ab as C,ac as S,ae as V,_ as $}from"./vendor-DuKqz2x4.js";import{o as U}from"./app-CqJgtQaN.js";import"./NameAbbreviator2-CKBZOpNd.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";const A={class:"mb-6 space-y-4"},N={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},T={class:"p-4 mb-6"},F={class:"mb-2 absolute flex gap-2"},R=["onClick"],D={key:0,class:"bg-white rounded-lg shadow overflow-x-auto"},z={key:0,class:"min-w-full divide-y divide-gray-200"},I={class:"bg-gray-50"},M={class:"bg-white divide-y divide-gray-200"},E={class:"p-0"},q={class:"p-0"},B={class:"p-0"},P={class:"p-0 overflow-visible"},H=["onClick"],O=["onClick"],W={class:"py-1"},G={key:1,class:"bg-white rounded-lg shadow overflow-x-auto"},J={class:"min-w-full divide-y divide-gray-200"},K={class:"bg-gray-50"},L={colspan:8,class:"px-4 py-2 text-center text-sm font-medium text-gray-700 border-l"},Q={class:"bg-white divide-y divide-gray-200"},Z={class:"p-0"},X={class:"p-0"},Y={class:"p-0 overflow-visible"},ee=["onClick"],le=["onClick"],oe={class:"py-1"},ae={class:"space-y-4"},se={class:"text-lg font-medium text-gray-900"},te=["value"],re={key:0,class:"mt-1 text-sm text-red-600"},de={class:"grid grid-cols-2 gap-4"},ie={class:"mt-1 text-sm text-gray-900"},ne={class:"mt-1 text-sm text-gray-900"},ue={class:"flex items-center"},ce={class:"mt-6 flex justify-end space-x-3"},ve=["disabled"],me=U({__name:"Index",props:{records:{type:Object,default:()=>({data:[]})},options:{type:Object,default:()=>({})},periodDetails:{type:Array,default:()=>[]},school_id:{type:Number,required:!0},copy_id:{type:Number,required:!0}},setup(U){var me;r("Cozy");const pe=r(null),be=r(!1),ye=r(null);r([{value:"Cozy2",label:"Cozy"}]),r({day:null,period:null});const ge=U,he=r(ge.records||[]),fe=r(ge.options||{});r(null==ge?void 0:ge.records);const xe=r(null==ge?void 0:ge.records);r((null==(me=null==ge?void 0:ge.records)?void 0:me.filter(e=>null!=(null==e?void 0:e.day)&&null!=(null==e?void 0:e.period_number)))||[]),console.log("Props received:",{records:he.value,options:fe.value,periodDetails:ge.periodDetails});const _e=[{name:"Sunday",number:1},{name:"Monday",number:2},{name:"Tuesday",number:3},{name:"Wednesday",number:4},{name:"Thursday",number:5}],we=Array.from({length:8},(e,l)=>l+1);r(!1);const ke=r(!1),je=r(!1),Ce=r({cst_id:null,notes:"",active:!0}),Se=r({}),Ve=r({day:null,period_number:null}),$e=r(null),Ue=r({school:null,school_object:{},classroom:null,classroom_object:{},schedule:null,schedule_object:{}});r(!1),r(null),d(()=>ge.options,e=>{fe.value=e},{deep:!0});const Ae=i(()=>{var e;console.log("CSTs from options:",null==(e=fe.value)?void 0:e.csts);const l=he.value||[],o=[...new Set(l.map(e=>{var l,o;return null==(o=null==(l=e.cst)?void 0:l.classroom)?void 0:o.id}))].map(e=>{var o,a,s,t,r,d;const i=l.find(l=>{var o,a;return(null==(a=null==(o=l.cst)?void 0:o.classroom)?void 0:a.id)===e});return{id:null==(a=null==(o=i.cst)?void 0:o.classroom)?void 0:a.id,name:null==(t=null==(s=i.cst)?void 0:s.classroom)?void 0:t.name,grade:null==(d=null==(r=i.cst)?void 0:r.classroom)?void 0:d.grade}});return console.log("Processed classrooms:",o),o});r({});const Ne=i(()=>{var e;return(null==(e=he.value)?void 0:e.length)?he.value.reduce((e,l)=>{var o,a,s,t,r,d,i,n;return e[`${l.day}-${l.period_number}`]={subject:null==(a=null==(o=l.cst)?void 0:o.subject)?void 0:a.name,teacher:null==(t=null==(s=l.cst)?void 0:s.teacher)?void 0:t.name,color_bg:null==(d=null==(r=l.cst)?void 0:r.subject)?void 0:d.color_bg,color_text:null==(n=null==(i=l.cst)?void 0:i.subject)?void 0:n.color_text,cst:l.cst,schedule:l,id:null==l?void 0:l.id},e},{}):{}}),Te=(e,l,o)=>Ne.value[`${l.number}-${o}`]||null,Fe=async(l,o,a,s)=>{var t,r,d;if(!je.value&&l){je.value=!0;try{const o={id:l.id,cst_id:l.cst_id,day:null==a?void 0:a.number,period_number:s,active:!0,school_id:(null==(t=Ue.value.school_object)?void 0:t.id)||ge.school_id},r=await $.post("/admin/schedule/update2",o);if(!r.data.success)throw new Error(r.data.message||"Update failed");if(r.data.record){const l=r.data.record;he.value&&(he.value=he.value.map(e=>e.id===l.id?l:e)),e.success(r.data.message),await Ee()}else console.error("No record in response:",r.data),e.error("No updated record received from server")}catch(i){console.error("Full error:",i);const l=(null==(d=null==(r=i.response)?void 0:r.data)?void 0:d.message)||i.message||"An error occurred while updating the schedule";e.error(l)}finally{je.value=!1}}},Re=(e,l,o,a)=>{confirm("Are you sure you want to delete this ?")&&De(e)},De=async(l,o,a,s)=>{var t,r,d;if(je.value)return;if(!(null==l?void 0:l.id))return void e.error("Invalid schedule ID");je.value=!0;const i={id:l.id,school_id:l.school_id,copy_id:l.copy_id,remove_session:1,day:null,id:(null==l?void 0:l.id)||null,period_number:null};try{console.log("Removing schedule with data:",i);const l=await $.post("/admin/schedule/update2",i);if(!l.data.success)throw new Error(l.data.message);he.value=he.value.map(e=>e.id===i.id?l.data.record:e),e.success(l.data.message),await Ee()}catch(n){console.error("Error details:",{formData:i,error:(null==(t=n.response)?void 0:t.data)||n.message});const l=(null==(d=null==(r=n.response)?void 0:r.data)?void 0:d.message)||"Failed to clear schedule slot";e.error(l)}finally{je.value=!1}},ze=(e,l,o)=>{var a;return console.log(l,o),Ve.value.day=l.number,Ve.value.period_number=o,xe.value=null==(a=he.value)?void 0:a.filter(l=>{var o,a;return(null==(a=null==(o=l.cst)?void 0:o.classroom)?void 0:a.id)===e}),console.log("Filtered records:",xe.value),xe.value},Ie=r(null==ge?void 0:ge.records),Me=()=>{ke.value=!1,Ce.value={cst_id:null,notes:"",active:!0},Se.value={}};r(!0);const Ee=async()=>{be.value=!0;try{const e=await $.get("/admin/schedule/load_data");e.data.success&&(be.value=!1,he.value=e.data.records)}catch(l){be.value=!1,console.error("Failed to refresh data:",l),e.error("Failed to refresh schedule data")}},qe=async()=>{var l,o,a,s,t,r;if(!je.value){je.value=!0;try{const a={...Ce.value,school_id:(null==(l=Ue.value.school_object)?void 0:l.id)||ge.school_id,day:Ve.value.day,period_number:Ve.value.period_number,copy_id:null==(o=ge.options)?void 0:o.copy_id},s=await $.post("/admin/schedule/update2",a);records.value=records.value.map(e=>e.id===a.id?s.data.record:e),e.success(s.data.message),await Ee(),Me()}catch(d){if(null==(s=null==(a=d.response)?void 0:a.data)?void 0:s.conflict)e.error(d.response.data.message,{duration:5e3,position:"bottom-right",closeButton:!0}),console.error("Conflict details:",d.response.data.conflict);else{const l=(null==(r=null==(t=d.response)?void 0:t.data)?void 0:r.message)||"An unexpected error occurred";e.error(l)}}finally{je.value=!1}}};i(()=>{var e;return[{name:"cst_id",label:"Class-Subject-Teacher",type:"select",required:!0,options:(null==(e=xe.value)?void 0:e.map(e=>({value:e.id,label:`${e.classroom}`})))||[]}]});const Be=r(null);return r(null),r({row:null,col:null,day:null}),r(null),i(()=>{var e;return{school_id:null==(e=selected_school_object.value)?void 0:e.id,period_number:null,day:null,cst_id:null,place:"",active:!0,notes:""}}),i(()=>{var e;return(null==(e=he.value)?void 0:e.filter(e=>{var l,o,a,s,t;return!Te(null==(o=null==(l=e.cst)?void 0:l.classroom)||o.id,e.day,e.period_number)&&(null==(s=null==(a=e.cst)?void 0:a.classroom)?void 0:s.id)===(null==(t=selected_classroom.value)?void 0:t.id)}))||[]}),(e,r)=>{const d=n("AppLayout");return c(),u(d,{title:"Schedule Management"},{default:v(()=>{var d,i;return[m("button",{onClick:r[0]||(r[0]=e=>(()=>{var e;return Ie.value=null==(e=he.value)?void 0:e.filter(e=>null!==e.day&&null!==e.period_number),Ie.value})())},g(null==(d=Ie.value)?void 0:d.length)+" / "+g(null==(i=he.value.value)?void 0:i.length),1),m("div",A,[m("div",N,[y(a,{modelValue:Ue.value.school,"onUpdate:modelValue":r[1]||(r[1]=e=>Ue.value.school=e),object:Ue.value.school_object,"onUpdate:object":r[2]||(r[2]=e=>Ue.value.school_object=e),options:e.$page.props.auth.user.school,"value-key":"id","label-key":["name","hr.name"],placeholder:"Select School","label-separator":" - ","default-selected-index":0,label_only:!1},null,8,["modelValue","object","options"]),y(a,{modelValue:Ue.value.classroom,"onUpdate:modelValue":r[3]||(r[3]=e=>Ue.value.classroom=e),object:Ue.value.classroom_object,"onUpdate:object":r[4]||(r[4]=e=>Ue.value.classroom_object=e),options:e.$page.props.auth.user.classroom,"value-key":"id","label-key":["name"],placeholder:"Select Classroom"},null,8,["modelValue","object","options"]),y(a,{modelValue:Ue.value.schedule,"onUpdate:modelValue":r[5]||(r[5]=e=>Ue.value.schedule=e),object:Ue.value.schedule_object,"onUpdate:object":r[6]||(r[6]=e=>Ue.value.schedule_object=e),options:e.$page.props.auth.user.schedule,"value-key":"id","label-key":["cst.classroom_name","cst.subject_name","cst.teacher_name"],placeholder:"Select Schedule"},null,8,["modelValue","object","options"])])]),m("div",{class:"mb-4 flex justify-end"},[m("button",{onClick:Ee,class:"inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 focus:bg-gray-700 active:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition ease-in-out duration-150"},r[13]||(r[13]=[m("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),h(" Refresh Table ")]))]),m("div",T,[r[14]||(r[14]=m("hr",null,null,-1)),r[15]||(r[15]=h(" by day : ")),m("div",F,[(c(),p(_,null,f(_e,e=>{var l;return m("div",{class:"p-0",key:e},[m("button",{onClick:l=>pe.value=e,class:x(["px-2 py-1 rounded-full text-xs border-4 border-solid hover:scale-150",(null==(l=pe.value)?void 0:l.number)===(null==e?void 0:e.number)?"bg-yellow-400 border-black text-black":"border-gray-200 text-white bg-gray-500"])},g(null==e?void 0:e.name)+"["+g(null==e?void 0:e.number)+"] ",11,R)])}),64)),m("button",{onClick:r[7]||(r[7]=e=>pe.value=null),class:x(["px-2 py-1 rounded-full text-xs border-4 border-solid hover:scale-150 bg-gray-400 text-white hover:bg-gray-300",pe.value?"border-gray-200":"border-blue-700"])}," all ",2)])]),be.value?b("",!0):(c(),p("div",D,[pe.value?b("",!0):(c(),p("table",z,[m("thead",I,[m("tr",null,[r[16]||(r[16]=m("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Classroom ",-1)),(c(),p(_,null,f(_e,e=>m("th",{key:e,colspan:8,class:"px-4 py-2 text-center text-sm font-medium text-gray-700 border-l"},g(e.name)+": ",1)),64))]),m("tr",null,[r[17]||(r[17]=m("th",null,null,-1)),(c(),p(_,null,f(_e,e=>(c(),p(_,{key:`periods-${e}`},[(c(!0),p(_,null,f(w(we),l=>(c(),p("th",{key:`${e}-${l}`,class:"px-2 py-2 text-center text-xs font-medium text-gray-500 uppercase border-l first:border-l-0"},g(l),1))),128))],64))),64))])]),m("tbody",M,[(c(!0),p(_,null,f(Ae.value,e=>(c(),p("tr",{key:e.id},[m("td",{class:x(["px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900 border-r sticky left-0 bg-white",{"hover-row":Be.value===e.id}])},[m("div",E,g(e.name),1)],2),(c(),p(_,null,f(_e,l=>(c(),p(_,{key:`${e.id}-${l}`},[(c(!0),p(_,null,f(w(we),a=>(c(),p("td",{key:`${e.id}-${l}-${a}`,class:"px-2 py-2 border-l first:border-l-4 first:border-l-black first:border-l-solid"},[m("div",q,[y(s,{width:"56",align:"left","auto-hide":!0},{trigger:v(()=>{var o,s,r,d,i,n,b,y;return[m("div",B,[(null==(s=null==(o=Te(e.id,l,a))?void 0:o.schedule)?void 0:s.period_number)==a&&(null==(d=null==(r=Te(e.id,l,a))?void 0:r.schedule)?void 0:d.day)==(null==l?void 0:l.number)&&(null==(y=null==(b=null==(n=null==(i=Te(e.id,l,a))?void 0:i.schedule)?void 0:n.cst)?void 0:b.classroom)?void 0:y.id)==e.id?(c(),u(t,{key:0,option:Te(e.id,l,a),name:"radioName",my_class:"custom-class",onClick:o=>ze(e.id,l,a),onRemove_session:e=>Re(e)},{main:v(()=>[m("div",P,[m("button",{class:"scale-75 overflow-visible px-3 absolute rounded-full pb-1 -right-4 -top-4 bg-red-500 z-40 mb-6 hover:scale-150 hover:bg-red-800 hover:text-white",onClick:o=>Re(Te(e.id,l,a))}," x ",8,H)])]),_:2},1032,["option","onClick","onRemove_session"])):(c(),p("button",{key:1,onClick:o=>ze(e.id,l,a),class:"px-2 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded"}," + ",8,O))])]}),content:v(()=>[m("div",W,[y(o,{modelValue:ye.value,"onUpdate:modelValue":r[8]||(r[8]=e=>ye.value=e),name:"officeType",my_class:"flex flex-wrap justify-center gap-1",options:xe.value,onSet_data:o=>Fe(o,e.id,l,a),period_day:{classroom:e.id,day:null==l?void 0:l.number,period:a}},null,8,["modelValue","options","onSet_data","period_day"])])]),_:2},1024)])]))),128))],64))),64))]))),128))])]))])),pe.value?(c(),p("div",G,[m("table",J,[m("thead",K,[m("tr",null,[r[18]||(r[18]=m("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Classroom ",-1)),m("th",L,g(pe.value.name)+": ",1)]),m("tr",null,[r[19]||(r[19]=m("th",null,null,-1)),(c(!0),p(_,null,f(w(we),e=>(c(),p("th",{key:` ${e}`,class:"px-2 py-2 text-center text-xs font-medium text-gray-500 uppercase border-l first:border-l-0"},g(e),1))),128))])]),m("tbody",Q,[(c(!0),p(_,null,f(Ae.value,e=>(c(),p("tr",{key:e.id},[m("td",{class:x(["px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900 border-r sticky left-0 bg-white",{"hover-row":Be.value===e.id}])},g(e.name),3),(c(!0),p(_,null,f(w(we),l=>(c(),p("td",{key:`${e.id} -${l}`,class:"px-2 py-2 border-l first:border-l-4 first:border-l-black first:border-l-solid"},[m("div",Z,[y(s,{width:"56",align:"left","auto-hide":!0},{trigger:v(()=>{var o,a,s,r,d,i,n,b,y;return[m("div",X,[(null==(a=null==(o=Te(e.id,pe.value,l))?void 0:o.schedule)?void 0:a.period_number)==l&&(null==(r=null==(s=Te(e.id,pe.value,l))?void 0:s.schedule)?void 0:r.day)==(null==(d=pe.value)?void 0:d.number)&&(null==(y=null==(b=null==(n=null==(i=Te(e.id,pe.value,l))?void 0:i.schedule)?void 0:n.cst)?void 0:b.classroom)?void 0:y.id)==e.id?(c(),u(t,{key:0,option:Te(e.id,pe.value,l),name:"radioName",my_class:"custom-class",onClick:o=>ze(e.id,pe.value,l),onRemove_session:e=>Re(e)},{main:v(()=>[m("div",Y,[m("button",{class:"scale-75 overflow-visible px-2 absolute rounded-full pb-1 -right-4 -top-4 bg-red-500 z-40 mb-6 hover:scale-100 hover:bg-red-800 hover:text-white",onClick:o=>Re(Te(e.id,pe.value,l))}," x ",8,ee)])]),_:2},1032,["option","onClick","onRemove_session"])):(c(),p("button",{key:1,onClick:o=>ze(e.id,pe.value,l),class:"px-2 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded"}," + ",8,le))])]}),content:v(()=>{var a;return[m("div",oe,[y(o,{modelValue:ye.value,"onUpdate:modelValue":r[9]||(r[9]=e=>ye.value=e),name:"officeType",my_class:"flex flex-wrap justify-center gap-1",options:xe.value,onSet_data:o=>Fe(o,e.id,pe.value,l),period_day:{classroom:e.id,day:null==(a=pe.value)?void 0:a.number,period:l}},null,8,["modelValue","options","onSet_data","period_day"])])]}),_:2},1024)])]))),128))]))),128))])])])):b("",!0),y(l,{show:ke.value,onClose:Me},{default:v(()=>{var e;return[m("div",ae,[m("h2",se,g($e.value?"Edit Schedule":"Add Schedule"),1),m("form",{onSubmit:k(qe,["prevent"]),class:"space-y-4"},[m("div",null,[r[21]||(r[21]=m("label",{class:"block text-sm font-medium text-gray-700"}," Class-Subject-Teacher ",-1)),j(m("select",{"onUpdate:modelValue":r[10]||(r[10]=e=>Ce.value.cst_id=e),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[r[20]||(r[20]=m("option",{value:""},"Select CST",-1)),(c(!0),p(_,null,f(xe.value,e=>(c(),p("option",{key:e.id,value:e.id},g(e.classroom),9,te))),128))],512),[[C,Ce.value.cst_id]]),(null==(e=Se.value)?void 0:e.cst_id)?(c(),p("div",re,g(Se.value.cst_id[0]),1)):b("",!0)]),m("div",de,[m("div",null,[r[22]||(r[22]=m("label",{class:"block text-sm font-medium text-gray-700"},"Day",-1)),m("div",ie,g(Ve.value.day),1)]),m("div",null,[r[23]||(r[23]=m("label",{class:"block text-sm font-medium text-gray-700"},"Period",-1)),m("div",ne,g(Ve.value.period_number),1)])]),m("div",null,[r[24]||(r[24]=m("label",{class:"block text-sm font-medium text-gray-700"},"Notes",-1)),j(m("textarea",{"onUpdate:modelValue":r[11]||(r[11]=e=>Ce.value.notes=e),rows:"3",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[S,Ce.value.notes]])]),m("div",ue,[j(m("input",{type:"checkbox","onUpdate:modelValue":r[12]||(r[12]=e=>Ce.value.active=e),class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"},null,512),[[V,Ce.value.active]]),r[25]||(r[25]=m("label",{class:"ml-2 block text-sm text-gray-900"},"Active",-1))]),m("div",ce,[m("button",{type:"button",class:"inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md font-semibold text-xs text-gray-700 uppercase tracking-widest shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-25 transition",onClick:Me}," Cancel "),m("button",{type:"submit",class:"inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 focus:bg-gray-700 active:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition",disabled:je.value},g(je.value?"Saving...":"Save"),9,ve)])],32)])]}),_:1},8,["show"])]}),_:1})}}},[["__scopeId","data-v-394d25a7"]]);export{me as default};
