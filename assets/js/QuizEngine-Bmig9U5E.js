import{u as e}from"./useQuizI18n-COVRmzJR.js";import{d as a,a as l,f as t,k as i,o as n,e as o,N as s,J as r,F as u,R as v,O as c,z as d,V as p,S as m,U as g,Q as b,a2 as f,a0 as h}from"./vendor-BWKGNkNB.js";import{r as w}from"./app-4gpSDtVV.js";const q={click:"/audio/click-234708.mp3",success:"/audio/purchase-success-384963.mp3",error:"/audio/error-010-206498.mp3"},y=new Map;if("undefined"!=typeof window)for(const[de,pe]of Object.entries(q)){const e=new Audio(pe);e.preload="auto",y.set(de,e)}const k=e=>{const a=y.get(e);a&&(a.currentTime=0,a.volume="click"===e?.5:1,a.play().catch(e=>console.debug("Audio play failed",e)))},x=()=>k("click"),I=()=>k("success"),M=()=>k("error"),$={class:"quiz-engine",role:"main","aria-label":"Quiz Assessment"},z={class:"quiz-header",role:"banner"},C=["aria-valuenow","aria-label"],O={class:"progress-info"},R={class:"question-counter"},T={class:"progress-percentage"},D={class:"progress-bar"},S=["aria-label"],Q={"aria-hidden":"true"},N={class:"sr-only",role:"status","aria-live":"polite","aria-atomic":"true"},A={key:0},_={id:"quiz-content",class:"question-content",role:"region","aria-label":"Question content"},L={class:"question-header"},j={class:"question-number",id:"current-question-heading"},E=["innerHTML"],B=["aria-label"],K=["aria-label"],H={class:"hints-list",role:"list"},P=["aria-label","aria-activedescendant"],F=["id","aria-selected","aria-disabled","tabindex","onClick","onKeydown"],J={class:"option-content"},U={class:"option-label"},V={class:"option-text"},G={key:0,class:"option-feedback"},W={key:0,class:"feedback-icon correct"},X={key:1,class:"feedback-icon incorrect"},Y={key:2,class:"rationale"},Z=["aria-label"],ee={id:"explanation-heading"},ae={"aria-labelledby":"explanation-heading"},le={class:"quiz-footer",role:"contentinfo"},te=["aria-label"],ie=["disabled","aria-label"],ne=["disabled","aria-label"],oe=["aria-label"],se={class:"navigator-label"},re={class:"navigator-dots"},ue=["aria-label","aria-current","onClick"],ve=w(a({__name:"QuizEngine",props:{quiz:{},config:{default:()=>({})},attemptId:{default:void 0}},emits:["answer-selected","question-changed","quiz-completed","quiz-review-enter","time-warning"],setup(a,{emit:w}){const{progress:q,complete:y,questionNumber:k,next:I,previous:M,finish:ve,explanation:ce,hint:de,timeRemaining:pe,a11yProgressBar:me,a11yQuestionOptions:ge,a11yAnnounceProgress:be,a11yNavigationControls:fe,a11yQuestionNavigator:he,isRtl:we}=e(),qe=e=>`${Math.floor(e/60)}:${String(e%60).padStart(2,"0")}`,ye=a,ke=w,xe={allowReviewMode:!1,autoAdvance:!1,showRationaleOnCorrect:!0,timeLimit:void 0,shuffleQuestions:!1,shuffleOptions:!1},Ie=l(()=>({...xe,...ye.config})),Me=t(0),$e=t([]),ze=t(new Date),Ce=t(new Date),Oe=t(Ie.value.timeLimit);let Re;const Te=e=>{const a=[...e];for(let l=a.length-1;l>0;l--){const e=Math.floor(Math.random()*(l+1));[a[l],a[e]]=[a[e],a[l]]}return a},De=l(()=>{let e=[...ye.quiz];return Ie.value.shuffleQuestions&&(e=Te(e)),Ie.value.shuffleOptions&&(e=e.map(e=>({...e,answerOptions:Te(e.answerOptions)}))),e.map((e,a)=>({...e,questionNumber:a+1}))}),Se=l(()=>De.value[Me.value]),Qe=l(()=>$e.value.some(e=>e.questionId===Se.value.id)),Ne=l(()=>{const e=$e.value.find(e=>e.questionId===Se.value.id);return e?e.selectedIndex:null}),Ae=l(()=>Se.value.answerOptions.findIndex(e=>e.isCorrect)),_e=l(()=>{const e=$e.value.length,a=De.value.length;return a>0?e/a*100:0}),Le=l(()=>Me.value===De.value.length-1),je=l(()=>De.value.length),Ee=()=>{const e=new Date,a=Math.floor((e.getTime()-Ce.value.getTime())/1e3);return Math.max(0,a)},Be=e=>{if(Qe.value&&!Ie.value.allowReviewMode)return;x();const a=Se.value,l=a.answerOptions[e],t=a.answerOptions[Ae.value],i={questionId:a.id,questionNumber:a.questionNumber,selectedIndex:e,selectedOptionId:l.id,selectedText:l.text,correct:l.isCorrect,question:a.question,correctText:t.text,timeSpentSec:Ee(),answeredAt:new Date},n=$e.value.findIndex(e=>e.questionId===a.id);-1!==n?$e.value[n]=i:$e.value.push(i),ke("answer-selected",i),Ie.value.autoAdvance&&i.correct&&setTimeout(()=>{Ke()},1e3)},Ke=()=>{Le.value?Pe():(Me.value++,Ce.value=new Date,ke("question-changed",Me.value))},He=e=>{if(!Ie.value.allowReviewMode){if(e>$e.value.length)return}e<0||e>=De.value.length||(Me.value=e,Ce.value=new Date,ke("question-changed",e))},Pe=()=>{void 0!==Re&&(clearInterval(Re),Re=void 0);const e=$e.value.filter(e=>e.correct).length,a=De.value.length,l=a>0?e/a*100:0,t={attemptId:ye.attemptId||`attempt-${Date.now()}`,total:a,correct:e,percentage:Math.round(100*l)/100,answers:[...$e.value],completedAt:new Date,metadata:{startTime:ze.value,totalTimeSec:Math.floor(((new Date).getTime()-ze.value.getTime())/1e3)}};ke("quiz-completed",t)},Fe=e=>{const a=e.key;if("Home"===a){e.preventDefault();const a=document.getElementById(`option-${Se.value.id}-0`);null==a||a.focus()}if("End"===a){e.preventDefault();const a=Se.value.answerOptions.length-1,l=document.getElementById(`option-${Se.value.id}-${a}`);null==l||l.focus()}};i(()=>$e.value.length,e=>{e===De.value.length&&Ie.value.allowReviewMode&&ke("quiz-review-enter")}),i(Oe,e=>{if(void 0===e)return;[300,120,60].includes(e)&&ke("time-warning",e),e<=0&&Pe()});return n(()=>{void 0!==Ie.value.timeLimit&&Ie.value.timeLimit>0&&(Oe.value=Ie.value.timeLimit,Re=window.setInterval(()=>{void 0!==Oe.value&&Oe.value>0&&Oe.value--},1e3))}),o(()=>{void 0!==Re&&(clearInterval(Re),Re=void 0)}),(e,a)=>(r(),s(u,null,[a[2]||(a[2]=v("div",{class:"skip-links"},[v("a",{href:"#quiz-content",class:"skip-link"},"Skip to quiz content"),v("a",{href:"#quiz-navigation",class:"skip-link"},"Skip to navigation")],-1)),v("div",$,[v("div",z,[v("div",{class:"progress-bar-container",role:"progressbar","aria-valuenow":Math.round(_e.value),"aria-valuemin":"0","aria-valuemax":"100","aria-label":d(me)(Math.round(_e.value))},[v("div",O,[v("span",R,p(d(q)(Me.value+1,je.value)),1),v("span",T,p(d(y)(Math.round(_e.value))),1)]),v("div",D,[v("div",{class:"progress-bar-fill",style:m({width:`${_e.value}%`})},null,4)])],8,C),void 0!==Oe.value?(r(),s("div",{key:0,class:g(["time-remaining",{"time-warning":Oe.value<120}]),role:"timer","aria-label":d(pe)(qe(Oe.value))},[v("span",Q,p(d(pe)(qe(Oe.value))),1)],10,S)):c("",!0),v("div",N,[Qe.value?(r(),s("span",A,p(d(be)(Me.value+1,je.value)),1)):c("",!0)])]),v("div",_,[v("div",L,[v("h2",j,p(d(k)(Se.value.questionNumber)),1)]),v("div",{class:"question-text",innerHTML:Se.value.question,role:"heading","aria-level":"3","aria-labelledby":"current-question-heading"},null,8,E),Se.value.hints&&Se.value.hints.length>0&&!Qe.value?(r(),s("div",{key:0,class:"hints-section",role:"complementary","aria-label":d(de)()},[v("details",null,[v("summary",{"aria-label":`${d(de)()}`},p(d(de)()),9,K),v("ul",H,[(r(!0),s(u,null,b(Se.value.hints,(e,a)=>(r(),s("li",{key:a,role:"listitem"},p(e),1))),128))])])],8,B)):c("",!0),v("ol",{class:"options-list",role:"listbox","aria-label":d(ge)(Se.value.questionNumber),"aria-activedescendant":null!==Ne.value?`option-${Se.value.id}-${Ne.value}`:void 0,onKeydown:Fe},[(r(!0),s(u,null,b(Se.value.answerOptions,(e,a)=>(r(),s("li",{key:e.id,id:`option-${Se.value.id}-${a}`,class:g(["option-item",{selected:Ne.value===a,correct:Qe.value&&e.isCorrect,incorrect:Qe.value&&Ne.value===a&&!e.isCorrect,"unselected-correct":Qe.value&&Ne.value!==a&&e.isCorrect}]),role:"option","aria-selected":Ne.value===a,"aria-disabled":Qe.value&&!Ie.value.allowReviewMode,tabindex:0===a?0:-1,onClick:e=>Be(a),onKeydown:[f(h(e=>Be(a),["prevent"]),["enter"]),f(h(e=>Be(a),["prevent"]),["space"]),f(h(e=>(e=>{if(e>0){const a=document.getElementById(`option-${Se.value.id}-${e-1}`);null==a||a.focus()}})(a),["prevent"]),["up"]),f(h(e=>(e=>{if(e<Se.value.answerOptions.length-1){const a=document.getElementById(`option-${Se.value.id}-${e+1}`);null==a||a.focus()}})(a),["prevent"]),["down"])]},[v("div",J,[v("span",U,p(String.fromCharCode(65+a)),1),v("span",V,p(e.text),1)]),Qe.value?(r(),s("div",G,[e.isCorrect?(r(),s("span",W,"✓")):Ne.value===a?(r(),s("span",X,"✗")):c("",!0),e.rationale&&(Ne.value===a||e.isCorrect&&Ie.value.showRationaleOnCorrect)?(r(),s("div",Y,p(e.rationale),1)):c("",!0)])):c("",!0)],42,F))),128))],40,P),Qe.value&&Se.value.explanation?(r(),s("div",{key:1,class:"explanation-panel",role:"region","aria-label":d(ce)(),"aria-live":"polite"},[v("strong",ee,p(d(ce)()),1),v("p",ae,p(Se.value.explanation),1)],8,Z)):c("",!0)]),v("div",le,[v("div",{id:"quiz-navigation",class:"navigation-controls",role:"navigation","aria-label":d(fe)()},[Ie.value.allowReviewMode?(r(),s("button",{key:0,class:"nav-button prev-button",disabled:0===Me.value,"aria-label":d(M)(),onClick:a[0]||(a[0]=()=>{He(Me.value-1),d(x)()})},p(d(we)?`${d(M)()} ←`:`← ${d(M)()}`),9,ie)):c("",!0),v("button",{class:g(["nav-button next-button",{"finish-button":Le.value}]),disabled:!Qe.value&&!Ie.value.allowReviewMode,"aria-label":Le.value?d(ve)():d(I)(),onClick:a[1]||(a[1]=()=>{Ke(),d(x)()})},p(Le.value?d(ve)():d(we)?`${d(I)()} ←`:`${d(I)()} →`),11,ne)],8,te),Ie.value.allowReviewMode&&$e.value.length===je.value?(r(),s("div",{key:0,class:"question-navigator",role:"navigation","aria-label":d(he)()},[v("div",se,p(d(he)()),1),v("div",re,[(r(!0),s(u,null,b(De.value,(e,a)=>(r(),s("button",{key:e.id,class:g(["nav-dot",{current:a===Me.value,answered:$e.value.some(a=>a.questionId===e.id)}]),"aria-label":d(k)(a+1),"aria-current":a===Me.value?"true":"false",onClick:e=>He(a)},p(a+1),11,ue))),128))])],8,oe)):c("",!0)])])],64))}}),[["__scopeId","data-v-6c4ff01f"]]),ce=Object.freeze(Object.defineProperty({__proto__:null,default:ve},Symbol.toStringTag,{value:"Module"}));export{ve as Q,I as a,M as b,ce as c,x as p};
