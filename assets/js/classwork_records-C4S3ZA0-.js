import{o as e,u as t,c as a,Q as l,p as s,d as o,l as n,m as i,a as r,n as d,f as c,aP as u,b as m,A as g,C as v}from"./app-C-NJhdpe.js";import{Q as p}from"./QSelect-B3f0Rrq3.js";import{Q as f}from"./QTable-D-FHlyjj.js";import{Q as y}from"./QBtnToggle-CGKDwXD9.js";import{Q as b}from"./QSpinnerHourglass-C9iL9ziH.js";import{Q as h}from"./QImg-BFE9nef2.js";import{Q as w}from"./QLinearProgress-DLQRR2k-.js";import _ from"./CameraCapture-e0nNdgCw.js";import S from"./neontext-V-ZsLocv.js";import{f as x,e as E,k,a as I,o as C,Z as z,n as A,L as N,I as $,b as V,M as j,J as O,S as D,V as T,U,H as F,O as R,y as M,F as J,Q as P,x as Q,X as L,$ as B}from"./vendor-CUZ9QTQV.js";import W from"./BehaviorManager-Cv8V0Yk_.js";import{u as q}from"./i18n-CP46N9fu.js";import"./offline-BzIlwqNM.js";import"./ui-LrZmvB2D.js";import"./rtl-Cr6c3OOr.js";import"./QMarkupTable-CDVIpyWz.js";import"./use-fullscreen-iiJPvjW2.js";import"./QTab-C_vkYR0k.js";import"./QTabs-C8Sz98qV.js";import"./QTabPanel-zhJc0Joi.js";import"./use-panel-CGzbevm7.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-bY91sdlT.js";const H={class:"p-6 space-y-6"},K={class:"control-panel"},Y={class:"flex flex-col gap-4"},G={class:"flex flex-row justify-center gap-4"},X={class:"mt-4 grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 items-end"},Z={class:"flex flex-wrap justify-center gap-4 p-4 font-kid"},ee={class:"relative rounded-t-xl"},te=["src"],ae={class:"absolute inset-0 bg-opacity-0 hover:bg-opacity-30 transition-all duration-300 flex items-center justify-center opacity-0 hover:opacity-100 avatar-overlay-enabled"},le={class:"flex gap-2 scale-125"},se={class:"absolute inset-0 bg-opacity-0 hover:bg-opacity-20 hover:bg-gray-500 transition-all duration-300 flex items-center justify-center opacity-0 hover:opacity-100 avatar-overlay-disabled"},oe={class:"flex gap-2 scale-125"},ne={class:"font-bold text-blue-800 mb-1"},ie={key:0,class:"text-sm text-gray-600 mb-1"},re={key:1,class:"text-xs text-gray-500"},de={class:"flex flex-col items-center text-sm"},ce={class:"text-lg font-bold text-primary"},ue={key:0,class:"text-green-600"},me={key:1,class:"text-red-500"},ge={class:"selection-controls mt-6 space-y-4"},ve={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},pe={key:0},fe={key:0,class:"text-gray-500 text-center"},ye={key:1},be={class:"mb-4 font-semibold"},he={class:"font-semibold mb-2"},we={class:"text-h6"},_e={class:"text-subtitle1 mb-3 font-semibold flex items-center gap-2"},Se={class:"settings-toggle-container enhanced-toggle-container"},xe={class:"toggle-status-indicator enhanced-status-indicator"},Ee={class:"text-caption text-grey-6 ml-8 mt-2"},ke={class:"header-content"},Ie={class:"selector-content"},Ce={key:0,class:"loading-state"},ze={key:1,class:"empty-state"},Ae={key:2,class:"leaderboard-list"},Ne={key:0,class:"podium-section"},$e={class:"podium"},Ve={key:0,class:"podium-position second-place"},je={class:"podium-student"},Oe={class:"student-avatar-large"},De={class:"student-name"},Te={class:"student-points silver-points"},Ue={key:1,class:"podium-position first-place"},Fe={class:"podium-student"},Re={class:"student-avatar-large"},Me={class:"student-name champion"},Je={class:"student-points gold-points"},Pe={key:2,class:"podium-position third-place"},Qe={class:"podium-student"},Le={class:"student-avatar-large"},Be={class:"student-name"},We={class:"student-points bronze-points"},qe={key:1,class:"remaining-students"},He={class:"row-position"},Ke={class:"row-avatar"},Ye={class:"row-info"},Ge={class:"row-name"},Xe={class:"row-points"},Ze={class:"row-badge"},et={key:2,class:"recognition-section"},tt={class:"recognition-cards"},at={key:0,class:"recognition-card"},lt={class:"card-name"},st={key:1,class:"recognition-card"},ot={class:"card-name"},nt={key:2,class:"recognition-card"},it={class:"card-name"},rt={class:"footer-content"},dt={class:"text-h6 flex items-center gap-2"},ct={class:"text-subtitle1 mb-3 font-semibold flex items-center gap-2"},ut={class:"settings-toggle-container enhanced-toggle-container"},mt={class:"toggle-status-indicator enhanced-status-indicator"},gt={class:"text-caption text-grey-6 ml-8 mt-2"},vt={class:"attendance-list max-h-80 overflow-y-auto"},pt={class:"flex items-center gap-3"},ft={class:"relative attendance-avatar-container"},yt={class:"absolute -top-1 -right-1 attendance-status-badge"},bt={class:"student-info"},ht={class:"flex items-center gap-3"},wt={class:"flex gap-2 mt-4 pt-4 border-t border-grey-3"},_t={class:"mt-3 p-3 bg-grey-1 rounded-lg attendance-summary"},St={class:"flex items-center justify-between text-sm"},xt={class:"flex items-center gap-2"},Et={class:"flex items-center gap-4"},kt={class:"flex items-center gap-1"},It={class:"text-positive font-medium"},Ct={class:"flex items-center gap-1"},zt={class:"text-negative font-medium"},At={class:"mt-2"},Nt={class:"text-center text-grey-6 py-8"},$t="reward-system-last-selection",Vt=e({__name:"classwork_records",setup(e){const Vt=()=>{ga.value=!1},jt=async({dataUrl:e})=>{if(!ma.value||!e)return;const t=function(e){const t=e.split(","),a=t[0].match(/:(.*?);/)[1],l=atob(t[1]),s=l.length,o=new Uint8Array(s);for(let n=0;n<s;n++)o[n]=l.charCodeAt(n);return new Blob([o],{type:a})}(e);await wa(ma.value.id,t,"capture.png"),ga.value=!1},{notsafe_t:Ot}=q(),Dt=e=>{if(!e||"string"!=typeof e)return e||"";try{return Ot(e)}catch(t){return e}},Tt=t(),Ut=x(""),Ft=x(""),Rt=x(null),Mt=x(null),Jt=x(null),Pt=x(null),Qt=x(""),Lt=x([]),Bt=Array.from({length:4},(e,t)=>({label:`Semester ${t+1}`,value:t+1})),Wt=Array.from({length:16},(e,t)=>({label:`Week ${t+1}`,value:t+1})),qt=Array.from({length:7},(e,t)=>({label:`Day ${t+1}`,value:t+1})),Ht=Array.from({length:8},(e,t)=>({label:`Period ${t+1}`,value:t+1}));function Kt(){try{const e={semester:Rt.value,week:Mt.value,day:Jt.value,periodNumber:Pt.value,classroomId:Ut.value||Na.value.currentClassroomId||null,classroomName:Qt.value||null,period_code:Ft.value||null};return localStorage.setItem($t,JSON.stringify(e)),!0}catch(e){return console.warn("saveLastSelection failed",e),!1}}x(["P-01","P-02","P-03","P-04"]),E(()=>{Kt()});const Yt=x({classes:[],subjects:[],my_classes:[],my_subjects:[],teacher:null,teacher_classes:[]}),Gt=x([]),Xt=x([{name:"key",label:"Field",field:"key",align:"left",sortable:!0},{name:"label",label:"Label",field:"label",align:"left",sortable:!0},{name:"type",label:"Type",field:"type",align:"left",sortable:!0},{name:"visible",label:"Visible",field:"visible",align:"center"}]),Zt=x(""),ea=x(!1),ta=()=>{try{const e=JSON.parse(Zt.value);if(Lt.value=Array.isArray(e)?e:[e],Lt.value.length>0){const e=Lt.value[0];Gt.value=Object.keys(e).map(e=>({key:e,label:e,type:"text",visible:!0}))}ea.value=!1,Tt.notify({type:"positive",message:"JSON Loaded"})}catch(e){console.error("JSON parsing error:",e),Tt.notify({type:"negative",message:"Invalid JSON format"})}},aa=()=>{try{const e=Zt.value.split("\n").filter(e=>""!==e.trim());e.length>0&&(Lt.value=e.map(e=>({value:e})),Gt.value=[{key:"value",label:"Value",type:"text",visible:!0}]),ea.value=!1,Tt.notify({type:"positive",message:"Text Loaded"})}catch(e){console.error("Text loading error:",e),Tt.notify({type:"negative",message:"Failed to load text data"})}};x([{label:"LMS System",children:[{label:"Authentication"},{label:"Class Management"},{label:"Quiz System"},{label:"Behavior Points"},{label:"Weekly Plan"},{label:"Lesson Planner"}]}]);const la=x(!1),sa=x({name:null,id:null,f_l_name:""}),oa=x({}),na=x(!1),ia=x([]),ra=x(!1),da=x("week"),ca=x(!1),ua=x(null),ma=x(null),ga=x(!1),va=x(null);x(null);const pa=x(null),fa=x(!1),ya=x(!1),ba=e=>{const t=(e||"").split(" ").map(e=>e[0]||"").slice(0,2).join("").toUpperCase();return`https://via.placeholder.com/96x96.png?text=${encodeURIComponent(t||"NA")}`},ha=async e=>{var t;const a=e.target.files||(null==(t=e.dataTransfer)?void 0:t.files);if(!a||!a.length)return;const l=a[0];ma.value&&(await wa(ma.value.id,l),e.target.value="")},wa=async(e,t,a=null)=>{var l,s;try{fa.value=!0;const l=new FormData,s=t instanceof Blob?new File([t],a||"avatar.png",{type:t.type||"image/png"}):t;l.append("avatar",s),l.append("student_id",e);const o=await z.post(`/api/students/${e}/avatar`,l,{headers:{"Content-Type":"multipart/form-data"}});Tt.notify({message:"Avatar uploaded",color:"positive"});const n=(Ia.value.my_sel_classroom_students||[]).find(t=>t.id===e);n&&(n.avatar=o.data.avatar||o.data.url||n.avatar||null)}catch(o){console.error("avatar upload failed",o),Tt.notify({message:(null==(s=null==(l=o.response)?void 0:l.data)?void 0:s.message)||"Avatar upload failed",color:"negative"})}finally{fa.value=!1}},_a=async e=>{if(e)try{const t=await z.get(`/api/student-behaviors/${e}`);oa.value[e]=t.data}catch(t){console.warn("Failed to load student summary",t),oa.value[e]={positive:0,negative:0,total:0}}},Sa=async()=>{var e;if(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length){ya.value=!0;try{const e=Ia.value.my_sel_classroom_students,t=e.map(e=>_a(e.id));await Promise.all(t),Tt.notify({message:`Successfully loaded summaries for ${e.length} students!`,color:"positive",position:"top",icon:"assessment"})}catch(t){console.error("Failed to load all student summaries:",t),Tt.notify({message:"Failed to load some student summaries",color:"negative",position:"top"})}finally{ya.value=!1}}else Tt.notify({message:"No students found in selected classroom!",color:"warning",position:"top"})},xa=async()=>{var e;(null==(e=sa.value)?void 0:e.id)&&(await _a(sa.value.id),na.value&&await Ea())},Ea=async()=>{var e;if(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length){ra.value=!0;try{const e=Ut.value,t=new Date;let a=new Date;switch(da.value){case"week":const e=t.getDay(),l=0===e?6:e-1;a.setDate(t.getDate()-l),a.setHours(0,0,0,0);break;case"month":a=new Date(t.getFullYear(),t.getMonth(),1);break;case"all":const s=t.getFullYear(),o=t.getMonth()>=8?s:s-1;a=new Date(o,8,1)}const l=(await z.get("/api/leaderboard",{params:{classroom_id:e,start_date:a.toISOString().split("T")[0],end_date:t.toISOString().split("T")[0],limit:5}})).data.map(e=>{const t=Ia.value.my_sel_classroom_students.find(t=>t.id===e.student_id);return{...e,name:(null==t?void 0:t.name)||"Unknown Student",avatar:(null==t?void 0:t.avatar)||null}}).filter(e=>e.total>0);ia.value=l,l.length>0&&ka()}catch(t){console.error("Failed to load leaderboard:",t);const e=Object.entries(oa.value).map(([e,t])=>{var a;const l=null==(a=Ia.value.my_sel_classroom_students)?void 0:a.find(t=>t.id==e);return{student_id:parseInt(e),name:(null==l?void 0:l.name)||"Unknown Student",avatar:(null==l?void 0:l.avatar)||null,total:t.total||0,positive:t.positive||0,negative:t.negative||0}}).filter(e=>e.total>0).sort((e,t)=>t.total-e.total).slice(0,5);ia.value=e,0===e.length&&Tt.notify({message:"No student data available yet. Start recording some behaviors!",color:"info",position:"top"})}finally{ra.value=!1}}else Tt.notify({message:"Please select a classroom first!",color:"warning",position:"top"})},ka=()=>{try{const e=new(window.AudioContext||window.webkitAudioContext),t=(t,a,l)=>{const s=e.createOscillator(),o=e.createGain();s.connect(o),o.connect(e.destination),s.frequency.setValueAtTime(t,a),s.type="triangle",o.gain.setValueAtTime(0,a),o.gain.linearRampToValueAtTime(.3,a+.01),o.gain.exponentialRampToValueAtTime(.01,a+l),s.start(a),s.stop(a+l)},a=e.currentTime;t(523.25,a,.3),t(659.25,a+.15,.3),t(783.99,a+.3,.3),t(1046.5,a+.45,.5)}catch(e){console.log("Audio not available")}},Ia=x({});const Ca=e=>{if(!e||"string"!=typeof e)return{firstName:null,lastName:null};const t=e.trim().split(/\s+/);if(0===t.length)return{firstName:null,lastName:null};const a=t[0];let l=null;return t.length>1&&(l=t[t.length-1]),a+" "+l};function za(e){if(!e||"string"!=typeof e)return{firstName:"",secondName:"",lastName:""};const t=e.trim().split(/\s+/).filter(e=>e.length>0),a=t[0]||"",l=t.length>1?t[t.length-1]:"";return{firstName:a,secondName:t.length>2?t.slice(1,-1).join(" "):"",lastName:l}}!async function(e,t,a=null){const l=await z.get(e,{params:a});console.log(l.data),Ia.value[t]=l.data}("my_classes_with_students","my_classes_with_students");const Aa=x([]),Na=x({avatarEditingEnabled:!0,readingAloudEnabled:!0,attendance:{},currentClassroomId:null}),$a=()=>{try{if(console.log("Starting settings save operation..."),"undefined"==typeof Storage||!window.localStorage)return console.warn("localStorage is not available"),Tt.notify({message:"Settings cannot be saved - browser storage unavailable",color:"warning",position:"top",timeout:3e3,icon:"warning"}),Va();let i;try{if(i=Fa(Na.value),!i)throw new Error("Settings validation returned null/undefined")}catch(e){throw console.error("Settings validation failed:",e),new Error("Settings validation failed: "+e.message)}const r={...i,lastUpdated:(new Date).toISOString(),version:"1.1",userAgent:navigator.userAgent.substring(0,100),classroomId:i.currentClassroomId,attendanceCount:Object.keys(i.attendance||{}).length};try{const e="reward-system-settings-test-"+Date.now();localStorage.setItem(e,"test"),localStorage.removeItem(e)}catch(t){throw"QuotaExceededError"===t.name?new Error("localStorage quota exceeded during test write"):new Error("localStorage write test failed: "+t.message)}let d;try{d=JSON.stringify(r)}catch(a){throw console.error("Settings serialization failed:",a),new Error("Failed to serialize settings: "+a.message)}const c=5e6;if(d.length>c){console.warn(`Settings data too large: ${d.length} bytes (limit: ${c})`);try{return Oa()}catch(l){throw new Error(`Settings data too large for localStorage: ${d.length} bytes`)}}let u=null;try{u=localStorage.getItem("reward-system-settings")}catch(s){console.warn("Could not create backup of existing settings:",s)}try{localStorage.setItem("reward-system-settings",d)}catch(o){if(u)try{localStorage.setItem("reward-system-settings",u)}catch(n){console.error("Failed to restore backup settings:",n)}throw o}return console.log("Settings saved successfully:",{size:d.length,attendanceEntries:Object.keys(i.attendance||{}).length,avatarEditingEnabled:i.avatarEditingEnabled,currentClassroomId:i.currentClassroomId}),!0}catch(i){console.error("Failed to save settings to localStorage:",i);let e="Failed to save settings",t=[];return"QuotaExceededError"===i.name||i.message.includes("quota exceeded")?(e="Storage quota exceeded - cannot save settings",t=[{label:"Clear Old Data",color:"white",handler:()=>Ja()},{label:"Compress Data",color:"white",handler:()=>Oa()}]):i.message.includes("localStorage write test failed")||i.message.includes("disabled")?(e="Browser storage is disabled or unavailable",t=[{label:"Use Session Storage",color:"white",handler:()=>Va()},{label:"Use Memory Storage",color:"white",handler:()=>ja()}]):i.message.includes("too large")?(e="Settings data is too large to save",t=[{label:"Compress Data",color:"white",handler:()=>Oa()},{label:"Sanitize Data",color:"white",handler:()=>Da()}]):(i.message.includes("validation failed")||i.message.includes("serialize"))&&(e="Settings data is corrupted",t=[{label:"Sanitize & Retry",color:"white",handler:()=>Da()},{label:"Reset to Defaults",color:"white",handler:()=>{Ra(),$a()}}]),t.unshift({label:"Retry",color:"white",handler:()=>{setTimeout(()=>$a(),1e3)}}),Tt.notify({message:e,caption:i.message,color:"negative",position:"top",timeout:6e3,icon:"error",actions:t}),Xa(i,"save"),!1}},Va=()=>{try{if("undefined"!=typeof sessionStorage&&sessionStorage){const e={...Fa(Na.value),lastUpdated:(new Date).toISOString(),version:"1.0",fallbackMode:"sessionStorage"};return sessionStorage.setItem("reward-system-settings-fallback",JSON.stringify(e)),Tt.notify({message:"Settings saved to session storage (temporary)",color:"warning",position:"top",timeout:3e3,icon:"warning"}),console.log("Settings saved to sessionStorage as fallback"),!0}throw new Error("sessionStorage not available")}catch(e){return console.error("sessionStorage fallback failed:",e),ja(),!1}},ja=()=>{try{return window.rewardSystemSettingsMemory={...Fa(Na.value),lastUpdated:(new Date).toISOString(),version:"1.0",fallbackMode:"memory"},Tt.notify({message:"Settings saved in memory only (will be lost on refresh)",color:"warning",position:"top",timeout:4e3,icon:"warning"}),console.log("Settings saved to memory as fallback"),!0}catch(e){return console.error("Memory fallback failed:",e),Tt.notify({message:"Unable to save settings - all storage methods failed",color:"negative",position:"top",timeout:5e3,icon:"error"}),!1}},Oa=()=>{try{const t={avatarEditingEnabled:Na.value.avatarEditingEnabled,attendance:Na.value.attendance,currentClassroomId:Na.value.currentClassroomId},a={};Object.entries(t.attendance||{}).forEach(([e,t])=>{!1===t&&(a[e]=!1)}),t.attendance=a;const l=JSON.stringify(t);if(l.length>5e6)throw new Error("Even compressed data is too large");try{localStorage.setItem("reward-system-settings-test","test"),localStorage.removeItem("reward-system-settings-test")}catch(e){throw new Error("localStorage write test failed after compression: "+e.message)}return localStorage.setItem("reward-system-settings",l),Tt.notify({message:"Settings saved in compressed format",color:"info",position:"top",timeout:3e3,icon:"compress"}),console.log("Settings saved in compressed format:",{originalSize:JSON.stringify(Na.value).length,compressedSize:l.length,compressionRatio:Math.round(100*(1-l.length/JSON.stringify(Na.value).length))}),!0}catch(t){return console.error("Compression fallback failed:",t),Tt.notify({message:"Compression failed, trying alternative storage",color:"warning",position:"top",timeout:3e3,icon:"warning"}),Va()}},Da=()=>{var e;try{console.log("Starting settings sanitization process...");const a=JSON.parse(JSON.stringify(Na.value)),l={avatarEditingEnabled:Boolean(Na.value.avatarEditingEnabled),attendance:{},currentClassroomId:Na.value.currentClassroomId?String(Na.value.currentClassroomId):null};let s=0,o=0;if(Na.value.attendance&&"object"==typeof Na.value.attendance&&Object.entries(Na.value.attendance).forEach(([e,t])=>{const a=parseInt(e);!isNaN(a)&&a>0?"boolean"==typeof t?(l.attendance[String(e)]=t,s++):"true"===t||"false"===t?(l.attendance[String(e)]="true"===t,s++):1===t||0===t?(l.attendance[String(e)]=Boolean(t),s++):(console.warn(`Removed invalid attendance value for student ${e}:`,t),o++):(console.warn("Removed invalid student ID from attendance:",e),o++)}),null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length){const e=new Set(Ia.value.my_sel_classroom_students.filter(e=>e&&e.id).map(e=>e.id.toString()));Object.keys(l.attendance).forEach(t=>{e.has(t)||(delete l.attendance[t],o++,console.warn(`Removed attendance for student not in current classroom: ${t}`))})}const n=JSON.stringify(l);if(n.length>5e6)throw new Error("Sanitized data still too large for localStorage");try{localStorage.setItem("reward-system-settings-test","test"),localStorage.removeItem("reward-system-settings-test")}catch(t){throw new Error("localStorage write test failed after sanitization: "+t.message)}localStorage.setItem("reward-system-settings",n),Object.assign(Na.value,l);const i=`Settings sanitized: ${s} entries kept, ${o} invalid entries removed`;return Tt.notify({message:i,color:"positive",position:"top",timeout:4e3,icon:"cleaning_services"}),console.log("Settings sanitization completed:",{sanitizedCount:s,removedCount:o,sanitizedSettings:l,originalSize:JSON.stringify(a).length,sanitizedSize:n.length}),!0}catch(a){return console.error("Sanitization failed:",a),Tt.notify({message:`Sanitization failed: ${a.message}`,color:"negative",position:"top",timeout:4e3,icon:"error"}),Va()}},Ta=()=>{try{if("undefined"==typeof Storage||!window.localStorage)return console.warn("localStorage is not available, using default settings"),Ra(),!1;const t=localStorage.getItem("reward-system-settings");if(!t)return console.log("No saved settings found, using defaults"),Ra(),!0;let a;try{a=JSON.parse(t)}catch(e){throw new Error("Invalid JSON in saved settings: "+e.message)}if(!a||"object"!=typeof a)throw new Error("Invalid settings data structure");const{lastUpdated:l,version:s,...o}=a,n=Fa(o);return Object.assign(Na.value,n),console.log("Settings loaded successfully:",n),s&&console.log("Loaded settings version:",s),!0}catch(t){console.error("Failed to load settings from localStorage:",t);let e="Settings reset to defaults due to loading error";t.message.includes("Invalid JSON")?e="Settings file corrupted - reset to defaults":t.message.includes("Invalid settings data")&&(e="Invalid settings format - reset to defaults");const a=Ua();return a||(Ra(),Tt.notify({message:e,color:"info",position:"top",timeout:3e3,icon:"refresh",actions:[{label:"OK",color:"white",handler:()=>{}}]})),a}},Ua=()=>{try{if("undefined"!=typeof sessionStorage&&sessionStorage){const t=sessionStorage.getItem("reward-system-settings-fallback");if(t)try{const e=JSON.parse(t),{lastUpdated:a,version:l,fallbackMode:s,...o}=e,n=Fa(o);return Object.assign(Na.value,n),Tt.notify({message:"Settings loaded from session storage backup",color:"warning",position:"top",timeout:3e3,icon:"backup"}),console.log("Settings loaded from sessionStorage fallback"),!0}catch(e){console.warn("sessionStorage fallback data corrupted:",e)}}if(window.rewardSystemSettingsMemory)try{const{lastUpdated:e,version:t,fallbackMode:a,...l}=window.rewardSystemSettingsMemory,s=Fa(l);return Object.assign(Na.value,s),Tt.notify({message:"Settings loaded from memory backup",color:"warning",position:"top",timeout:3e3,icon:"memory"}),console.log("Settings loaded from memory fallback"),!0}catch(t){console.warn("Memory fallback data corrupted:",t)}return!1}catch(a){return console.error("All fallback loading methods failed:",a),!1}},Fa=e=>{const t={avatarEditingEnabled:!0,attendance:{},currentClassroomId:null};if(!e||"object"!=typeof e)return console.warn("Invalid settings data, using defaults"),t;const a={...t};if("boolean"==typeof e.avatarEditingEnabled?a.avatarEditingEnabled=e.avatarEditingEnabled:console.warn("Invalid avatarEditingEnabled value, using default:",e.avatarEditingEnabled),e.attendance&&"object"==typeof e.attendance&&!Array.isArray(e.attendance)){const t={};Object.entries(e.attendance).forEach(([e,a])=>{const l=parseInt(e);!isNaN(l)&&l>0?"boolean"==typeof a?t[e]=a:(console.warn(`Invalid attendance value for student ${e}:`,a),t[e]=!0):console.warn("Invalid student ID in attendance:",e)}),a.attendance=t}else console.warn("Invalid attendance data, using empty object:",e.attendance);return null===e.currentClassroomId||"string"==typeof e.currentClassroomId&&e.currentClassroomId.length>0||"number"==typeof e.currentClassroomId&&e.currentClassroomId>0?a.currentClassroomId=e.currentClassroomId:console.warn("Invalid currentClassroomId, using null:",e.currentClassroomId),a},Ra=()=>{Na.value={avatarEditingEnabled:!0,attendance:{},currentClassroomId:null},console.log("Initialized default settings")},Ma=()=>{var e;try{if(!(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length))return console.log("No students in current classroom to validate against"),!0;const a=Ia.value.my_sel_classroom_students.filter(e=>!e.id||"string"!=typeof e.id&&"number"!=typeof e.id);a.length>0&&(console.error("Found students with invalid IDs:",a),Tt.notify({message:`Warning: ${a.length} students have invalid IDs`,color:"warning",position:"top",timeout:4e3,icon:"warning"}));const l=new Set;if(Ia.value.my_sel_classroom_students.forEach(e=>{e.id&&l.add(e.id.toString())}),0===l.size)return console.warn("No valid student IDs found in current classroom"),!0;if(!Na.value.attendance||"object"!=typeof Na.value.attendance)return console.warn("Invalid attendance data structure, resetting"),Na.value.attendance={},!0;const s=Object.keys(Na.value.attendance).filter(e=>{if(!l.has(e))return!0;const t=Na.value.attendance[e];return"boolean"!=typeof t&&(console.warn(`Invalid attendance value for student ${e}:`,t),!0)});if(s.length>0){console.warn("Found invalid student IDs or values in attendance:",s);const e={...Na.value.attendance};try{const e={...Na.value.attendance};let t=0,a=0;s.forEach(s=>{const o=Na.value.attendance[s];l.has(s)?"boolean"!=typeof o&&(e[s]=!0,a++):(delete e[s],t++)}),Na.value.attendance=e;let o="";return t>0&&a>0?o=`Removed ${t} invalid student records and fixed ${a} invalid values`:t>0?o=`Removed ${t} invalid student records from attendance`:a>0&&(o=`Fixed ${a} invalid attendance values`),Tt.notify({message:o,color:"info",position:"top",timeout:3e3,icon:"cleaning_services"}),console.log("Attendance validation completed:",{removed:t,fixed:a,cleanedAttendance:e}),!1}catch(t){return console.error("Error during attendance cleanup:",t),Na.value.attendance=e,Tt.notify({message:"Failed to clean invalid attendance data",color:"negative",position:"top",timeout:3e3,icon:"error"}),!1}}return console.log("All student IDs in attendance are valid"),!0}catch(a){return console.error("Error during student ID validation:",a),Tt.notify({message:"Error validating student data - some features may not work correctly",color:"negative",position:"top",timeout:4e3,icon:"error"}),!1}},Ja=()=>{try{const e=[];for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);a&&a.startsWith("reward-system-")&&e.push(a)}return e.forEach(e=>{(e.includes("backup")||e.includes("old"))&&(localStorage.removeItem(e),console.log("Removed old settings:",e))}),$a()}catch(e){return console.error("Failed to handle storage quota exceeded:",e),Tt.notify({message:"Storage full - settings cannot be saved. Please clear browser data.",color:"negative",position:"top",timeout:5e3,icon:"storage"}),!1}},Pa=(e,t)=>{console.log(`Handling classroom selection: ${e}`),Ut.value=e,Ia.value.my_sel_classroom_students=t||[]},Qa=()=>{var e;if(console.log("Testing classroom switching behavior..."),!(null==(e=Ia.value.my_classes_with_students)?void 0:e.length))return void console.warn("No classrooms available for testing");const t=Ia.value.my_classes_with_students;let a=0;const l=()=>{if(a<t.length){const e=t[a];console.log(`Switching to classroom ${a+1}: ${e.classroom_name}`),console.log("Current settings before switch:",JSON.parse(JSON.stringify(Na.value))),Pa(e.id,e.students),setTimeout(()=>{console.log("Settings after switch:",JSON.parse(JSON.stringify(Na.value))),console.log("LocalStorage content:",localStorage.getItem("reward-system-settings")),a++,a<t.length?setTimeout(l,2e3):console.log("Classroom switching test completed")},100)}};l()},La=()=>{console.log("Starting comprehensive error handling tests...");const e=[];[{name:"localStorage Unavailable Test",test:()=>{const e=window.localStorage;Object.defineProperty(window,"localStorage",{value:null,writable:!0});const t=$a();return Object.defineProperty(window,"localStorage",{value:e,writable:!0}),!t}},{name:"Invalid Settings Data Test",test:()=>{const e={...Na.value};Na.value={avatarEditingEnabled:"invalid",attendance:"not an object",currentClassroomId:[]};const t=Fa(Na.value);return Na.value=e,t&&"boolean"==typeof t.avatarEditingEnabled&&"object"==typeof t.attendance&&!Array.isArray(t.attendance)}},{name:"Student ID Validation Test",test:()=>{const e={...Na.value.attendance};Na.value.attendance={valid_id_1:!0,invalid_id_abc:!1,"":!0,null:null,999999:"not_boolean"};const t=Ma();return Na.value.attendance=e,"boolean"==typeof t}},{name:"Settings Dialog Error Boundary Test",test:()=>{try{const e=Ia.value;return Ia.value=null,Za(),Ia.value=e,!0}catch(e){return!1}}},{name:"Compression Fallback Test",test:()=>{const e={...Na.value.attendance},t={};for(let l=0;l<1e4;l++)t[`student_${l}`]=Math.random()>.5;Na.value.attendance=t;const a=Oa();return Na.value.attendance=e,"boolean"==typeof a}},{name:"Sanitization Test",test:()=>{const e={...Na.value};Na.value.attendance={123:!0,invalid:"not_boolean",456:!1,"":!0,null:null};const t=Da();return Na.value=e,"boolean"==typeof t}}].forEach(({name:t,test:a})=>{try{const l=Date.now(),s=a(),o=Date.now()-l;e.push({name:t,passed:s,duration:o,error:null}),console.log(`âœ… ${t}: ${s?"PASSED":"FAILED"} (${o}ms)`)}catch(l){e.push({name:t,passed:!1,duration:0,error:l.message}),console.error(`âŒ ${t}: ERROR - ${l.message}`)}});const t=e.filter(e=>e.passed).length,a=e.length;return console.log(`\nðŸ“Š Error Handling Test Results: ${t}/${a} tests passed`),t===a?Tt.notify({message:`All ${a} error handling tests passed!`,color:"positive",position:"top",timeout:3e3,icon:"check_circle"}):Tt.notify({message:`${t}/${a} error handling tests passed`,color:"warning",position:"top",timeout:4e3,icon:"warning"}),e};"undefined"!=typeof window&&(window.testClassroomSwitching=Qa,window.testErrorHandling=La,window.testSettingsValidation=()=>Ma(),window.testSettingsCompression=()=>Oa(),window.testSettingsSanitization=()=>Da()),k(Na,()=>{try{Ba&&clearTimeout(Ba),Ba=setTimeout(()=>{$a()},500)}catch(e){console.error("Error in settings watcher:",e),Tt.notify({message:"Error monitoring settings changes",color:"warning",position:"top",timeout:2e3,icon:"warning"})}},{deep:!0}),k(()=>Ia.value.my_sel_classroom_students,(e,t)=>{try{if(!e||!Array.isArray(e))return void console.log("No valid students array provided");if(e.length>0){const a={...Na.value.attendance};let l=!1,s=0,o=0;if(e.forEach(e=>{e&&e.id?e.id in a||(a[e.id]=!0,l=!0,s++):console.warn("Invalid student data:",e)}),t&&Array.isArray(t)&&t.length>0){const t=new Set(e.filter(e=>e&&e.id).map(e=>e.id.toString()));Object.keys(a).forEach(e=>{t.has(e.toString())||(delete a[e],l=!0,o++)})}l&&(Na.value.attendance=a,console.log(`Updated attendance: +${s} students, -${o} students`),(s>0||o>0)&&Tt.notify({message:`Attendance updated: ${s} added, ${o} removed`,color:"info",position:"top",timeout:2e3,icon:"update"}))}else Object.keys(Na.value.attendance).length>0&&(Na.value.attendance={},console.log("Cleared attendance - no students in classroom"))}catch(a){console.error("Error updating attendance for student changes:",a),Tt.notify({message:`Error updating attendance: ${a.message}`,color:"warning",position:"top",timeout:3e3,icon:"warning"});try{Ma()}catch(l){console.error("Failed to validate student IDs during recovery:",l)}}},{deep:!0});let Ba=null;const Wa=e=>!1!==Na.value.attendance[e];I(()=>{const e={};return Ia.value.my_sel_classroom_students&&Ia.value.my_sel_classroom_students.forEach(t=>{e[t.id]=!1!==Na.value.attendance[t.id]}),e});const qa=I(()=>Na.value.avatarEditingEnabled),Ha=I(()=>e=>{const t="student-card cursor-pointer transition-all duration-300";return Wa(e)?`${t} hover:shadow-xl hover:-translate-y-1`:`${t} student-absent opacity-50 grayscale cursor-not-allowed`}),Ka=I(()=>e=>!Wa(e)),Ya=()=>{var e;try{if(!(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length))throw new Error("No students found in current classroom");let t=0;const a=[];Ia.value.my_sel_classroom_students.forEach(e=>{try{if(!e.id)throw new Error("Invalid student data: missing ID");Na.value.attendance[e.id]=!0,t++}catch(l){a.push(`Student ${e.name||"Unknown"}: ${l.message}`)}}),a.length>0?(console.warn("Errors marking students present:",a),Tt.notify({message:`Marked ${t} students present, ${a.length} errors occurred`,color:"warning",position:"top",timeout:4e3,icon:"warning"})):Tt.notify({message:`All ${t} students marked present`,color:"positive",position:"top",timeout:2e3,icon:"people"}),console.log(`Marked all students present: ${t} successful, ${a.length} errors`)}catch(t){console.error("Error marking all students present:",t),Tt.notify({message:`Failed to mark all present: ${t.message}`,color:"negative",position:"top",timeout:3e3,icon:"error"})}},Ga=()=>{var e;try{if(!(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length))throw new Error("No students found in current classroom");let t=0;const a=[];Ia.value.my_sel_classroom_students.forEach(e=>{try{if(!e.id)throw new Error("Invalid student data: missing ID");Na.value.attendance[e.id]=!1,t++}catch(l){a.push(`Student ${e.name||"Unknown"}: ${l.message}`)}}),a.length>0?(console.warn("Errors marking students absent:",a),Tt.notify({message:`Marked ${t} students absent, ${a.length} errors occurred`,color:"warning",position:"top",timeout:4e3,icon:"warning"})):Tt.notify({message:`All ${t} students marked absent`,color:"warning",position:"top",timeout:2e3,icon:"person_off"}),console.log(`Marked all students absent: ${t} successful, ${a.length} errors`)}catch(t){console.error("Error marking all students absent:",t),Tt.notify({message:`Failed to mark all absent: ${t.message}`,color:"negative",position:"top",timeout:3e3,icon:"error"})}},Xa=(e,t)=>{var a;console.error(`Settings dialog error during ${t}:`,e);const l={operation:t,error:e.message,stack:e.stack,timestamp:(new Date).toISOString(),settingsState:Na.value?JSON.stringify(Na.value):"null",classroomId:Ut.value,studentCount:(null==(a=Ia.value.my_sel_classroom_students)?void 0:a.length)||0};console.error("Settings error report:",l);const s=[];"open"===t?(s.push({label:"Retry",color:"white",handler:()=>Za()}),s.push({label:"Reset & Open",color:"white",handler:()=>{Ra(),Za()}})):"save"===t?(s.push({label:"Retry",color:"white",handler:()=>$a()}),s.push({label:"Compress & Save",color:"white",handler:()=>Oa()}),s.push({label:"Sanitize & Save",color:"white",handler:()=>Da()})):"load"===t?(s.push({label:"Retry",color:"white",handler:()=>Ta()}),s.push({label:"Use Defaults",color:"white",handler:()=>Ra()})):"validate"===t?(s.push({label:"Fix Data",color:"white",handler:()=>Da()}),s.push({label:"Reset",color:"white",handler:()=>Ra()})):s.push({label:"Retry",color:"white",handler:()=>{"reset"===t&&el()}}),Tt.notify({message:{open:"Failed to open settings dialog",close:"Failed to close settings dialog",save:"Failed to save settings",load:"Failed to load settings",reset:"Failed to reset settings",validate:"Settings validation failed",initialize:"Settings initialization failed"}[t]||"Settings dialog error occurred",caption:e.message,color:"negative",position:"top",timeout:5e3,icon:"error",actions:s})},Za=()=>{var e;try{if(console.log("Attempting to open settings dialog..."),!Ia.value)throw new Error("Application data not initialized");"undefined"==typeof Storage&&console.warn("Browser storage not available, settings will not persist"),Ia.value.my_sel_classroom_students||(console.warn("No classroom selected, initializing empty student list"),Ia.value.my_sel_classroom_students=[]),Na.value&&"object"==typeof Na.value?("boolean"!=typeof Na.value.avatarEditingEnabled&&(console.warn("avatarEditingEnabled corrupted, resetting to default"),Na.value.avatarEditingEnabled=!0),Na.value.attendance&&"object"==typeof Na.value.attendance&&!Array.isArray(Na.value.attendance)||(console.warn("Attendance data corrupted, reinitializing"),Na.value.attendance={}),null!==Na.value.currentClassroomId&&"string"!=typeof Na.value.currentClassroomId&&"number"!=typeof Na.value.currentClassroomId&&(console.warn("currentClassroomId corrupted, resetting to null"),Na.value.currentClassroomId=null)):(console.warn("Settings object corrupted, reinitializing"),Ra());try{Ma()||console.warn("Student ID validation returned false, but continuing with dialog open")}catch(t){console.warn("Student ID validation failed, attempting recovery:",t);try{Da()}catch(a){console.error("Recovery failed, using default settings:",a),Ra()}}if(ca.value)return void console.log("Settings dialog already open");if(!Tt)throw new Error("Quasar instance not available");ca.value=!0,console.log("Settings dialog opened successfully"),console.log("Settings dialog state:",{settingsValid:!!Na.value,studentsCount:(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length)||0,attendanceEntries:Object.keys(Na.value.attendance||{}).length,currentClassroom:Na.value.currentClassroomId})}catch(l){console.error("Critical error opening settings dialog:",l),Xa(l,"open")}},el=()=>{try{Tt.dialog({title:"Reset Settings",message:"Are you sure you want to reset all settings to defaults? This will clear all attendance data.",cancel:!0,persistent:!1,color:"negative"}).onOk(()=>{try{Ra(),$a(),Tt.notify({message:"Settings reset to defaults",color:"info",position:"top",timeout:2e3,icon:"refresh"}),console.log("Settings reset to defaults successfully")}catch(e){Xa(e,"reset")}})}catch(e){Xa(e,"reset")}};C(async()=>{try{console.log("Initializing reward system component...");try{Ta()||(console.warn("Settings loading failed, using defaults"),Ra())}catch(e){console.error("Critical error loading settings:",e),Xa(e,"load"),Ra()}try{const e=await z.get("/api/behaviors");e.data&&Array.isArray(e.data)?(Aa.value=e.data,console.log(`Loaded ${e.data.length} behaviors`)):(console.warn("Invalid behaviors data received:",e.data),Aa.value=[])}catch(t){console.error("Failed to load behaviors:",t),Aa.value=[],Tt.notify({message:"Failed to load behavior options",color:"warning",position:"top",timeout:3e3,icon:"warning"})}A(()=>{var e;try{if(Ut.value&&(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length)){if(console.log("Initializing settings for existing classroom selection..."),"string"!=typeof Ut.value&&"number"!=typeof Ut.value)return void console.warn("Invalid classroom ID detected:",Ut.value);Na.value.currentClassroomId!==Ut.value&&(Na.value.currentClassroomId=Ut.value,console.log("Updated current classroom ID:",Ut.value));const e=Ia.value.my_sel_classroom_students.filter(e=>e&&e.id&&"string"==typeof e.name);e.length!==Ia.value.my_sel_classroom_students.length&&console.warn(`Found ${Ia.value.my_sel_classroom_students.length-e.length} invalid student records`);const l={...Na.value.attendance};let s=!1,o=0;if(e.forEach(e=>{e.id in l||(l[e.id]=!0,s=!0,o++)}),s){Na.value.attendance=l,console.log(`Initialized attendance for ${o} students in existing classroom`);try{$a()}catch(t){console.warn("Failed to save initial attendance settings:",t)}}try{Ma()}catch(a){console.warn("Post-initialization validation failed:",a)}}else console.log("No classroom selected during initialization")}catch(l){console.error("Error during settings initialization:",l),Xa(l,"initialize")}});try{!function(){var e,t,a,l,s,o;try{const n=localStorage.getItem($t);if(!n)return Rt.value=null,Mt.value=null,Jt.value=null,Pt.value=null,Ut.value="",Qt.value="",Ft.value="",!1;const i=JSON.parse(n);return Rt.value=null!=(e=i.semester)?e:null,Mt.value=null!=(t=i.week)?t:null,Jt.value=null!=(a=i.day)?a:null,Pt.value=null!=(l=i.periodNumber)?l:null,Qt.value=null!=(s=i.classroomName)?s:"",Ft.value=null!=(o=i.period_code)?o:"",!0}catch(n){return Rt.value=null,Mt.value=null,Jt.value=null,Pt.value=null,Ut.value="",Qt.value="",Ft.value="",console.warn("loadLastSelection failed",n),!1}}()}catch(a){console.warn("Failed to load last selection on init",a)}console.log("Reward system component initialization completed")}catch(l){console.error("Critical error during component mounting:",l),Tt.notify({message:"Application initialization failed",caption:l.message,color:"negative",position:"top",timeout:5e3,icon:"error",actions:[{label:"Reload Page",color:"white",handler:()=>window.location.reload()}]})}});let tl=null;return k([Rt,Mt,Jt,Pt,Ut,Ft],()=>{try{try{const e=Rt.value,t=Mt.value,a=Jt.value,l=Pt.value;null!=e&&null!=t&&null!=a&&null!=l&&(Ft.value=`${e}.${t}.${a}.${l}`)}catch(e){console.warn("Failed to generate period_code",e)}tl&&clearTimeout(tl),tl=setTimeout(()=>{Kt()},300)}catch(t){console.warn("Failed to auto-save last selection",t)}}),k(Ut,e=>{try{const t=(Ia.value.my_classes_with_students||[]).find(t=>t.id==e);Qt.value=(null==t?void 0:t.classroom_name)||""}catch(t){console.warn("Failed to sync classroom name for id",e,t)}},{immediate:!0}),(e,t)=>($(),N("div",H,[V(i,{class:"main-container-card shadow-lg rounded-2xl overflow-hidden"},{default:O(()=>[V(a,{class:"bg-white"},{default:O(()=>{var e,r;return[j("div",K,[j("div",Y,[j("div",G,[V(l,{color:"amber",icon:"emoji_events",label:"ðŸ† Show Leaderboard ðŸ†",onClick:t[0]||(t[0]=e=>{na.value=!0,Ea()}),class:"shadow-sm rounded-lg leaderboard-btn",size:"md",disable:!(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length)},{default:O(()=>{var e;return[V(s,{class:D((null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length)?"bg-amber text-white":"bg-grey-8 text-white"),anchor:"top middle",self:"bottom middle"},{default:O(()=>{var e,t;return[V(o,{name:(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length)?"emoji_events":"warning",size:"xs",class:"mr-1"},null,8,["name"]),T(" "+U((null==(t=Ia.value.my_sel_classroom_students)?void 0:t.length)?"View top 5 students with highest star points!":"Select a classroom first to view leaderboard"),1)]}),_:1},8,["class"])]}),_:1},8,["disable"]),V(l,{color:"grey-7",icon:"settings",label:"Settings",onClick:t[1]||(t[1]=e=>ca.value=!0),class:"shadow-sm rounded-lg settings-main-btn",size:"md"},{default:O(()=>[V(s,{class:"bg-grey-8 text-white",anchor:"top middle",self:"bottom middle"},{default:O(()=>[V(o,{name:"tune",size:"xs",class:"mr-1"}),t[22]||(t[22]=T(" Open classroom settings - manage avatar editing and attendance "))]),_:1})]),_:1})]),j("div",X,[V(p,{filled:"",modelValue:Rt.value,"onUpdate:modelValue":t[2]||(t[2]=e=>Rt.value=e),options:M(Bt),"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"Semester",class:"rounded-lg"},null,8,["modelValue","options"]),V(p,{filled:"",modelValue:Mt.value,"onUpdate:modelValue":t[3]||(t[3]=e=>Mt.value=e),options:M(Wt),"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"Week",class:"rounded-lg"},null,8,["modelValue","options"]),V(p,{filled:"",modelValue:Jt.value,"onUpdate:modelValue":t[4]||(t[4]=e=>Jt.value=e),options:M(qt),"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"Day",class:"rounded-lg"},null,8,["modelValue","options"]),V(p,{filled:"",modelValue:Pt.value,"onUpdate:modelValue":t[5]||(t[5]=e=>Pt.value=e),options:M(Ht),"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"Period Number",class:"rounded-lg"},null,8,["modelValue","options"]),Ia.value.my_classes_with_students?($(),F(p,{key:0,"onUpdate:modelValue":[t[6]||(t[6]=e=>{const t=(Ia.value.my_classes_with_students||[]).find(t=>t.id===e);t&&Pa(t.id,t.students)}),t[7]||(t[7]=e=>Ut.value=e)],filled:"",modelValue:Ut.value,options:(Ia.value.my_classes_with_students||[]).map(e=>{var t;return{label:`${e.classroom_name} (${(null==(t=e.students)?void 0:t.length)||0})`,value:e.id}}),"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"Classroom",class:"rounded-lg"},null,8,["modelValue","options"])):R("",!0),(null==(r=Ia.value.my_sel_classroom_students)?void 0:r.length)?($(),F(l,{key:1,color:"info",icon:"assessment",label:"Load  Summaries",onClick:Sa,class:"shadow-sm rounded-lg",size:"md",loading:ya.value},{default:O(()=>[V(s,{class:"bg-info text-white",anchor:"top middle",self:"bottom middle"},{default:O(()=>[V(o,{name:"assessment",size:"xs",class:"mr-1"}),t[23]||(t[23]=T(" Load behavior summaries for all students in this classroom "))]),_:1})]),_:1},8,["loading"])):R("",!0)]),j("div",Z,[($(!0),N(J,null,P(Ia.value.my_sel_classroom_students,e=>($(),F(i,{key:e.id,class:D([[Ha.value(e.id),{"selected-card":Ut.value===e.id}],"rounded-xl w-48 shadow-md transition-transform duration-300 hover:scale-105 bg-gradient-to-br from-blue-50 to-white"]),onClick:t=>Ka.value(e.id)?null:Ut.value=e.id,flat:""},{default:O(()=>[j("div",ee,[j("img",{src:e.avatar,ratio:1,class:"w-32 h-32 absolute rounded-full -top-16 -right-5"},null,8,te),Q(j("div",ae,[j("div",le,[V(l,{round:"",dense:"",size:"sm",color:"white","text-color":"dark",icon:"photo_camera",onClick:B(t=>(async e=>{if(Na.value.avatarEditingEnabled){ma.value=e,ga.value=!0;try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});pa.value=e,va.value&&(va.value.srcObject=e,await va.value.play())}catch(t){console.warn("Camera open failed",t),Tt.notify({message:"Camera not available",color:"negative"}),ga.value=!1}}else Tt.notify({message:"Avatar editing is currently disabled",color:"warning",position:"top"})})(e),["stop","prevent"]),class:"shadow-lg avatar-btn-enabled"},{default:O(()=>[V(s,{class:"bg-primary text-white text-sm rounded-lg px-2 py-1"},{default:O(()=>t[24]||(t[24]=[T(" ðŸ“· Take a photo! ")])),_:1})]),_:2},1032,["onClick"])])],512),[[L,qa.value&&!Ka.value(e.id)]]),Q(j("div",se,[j("div",oe,[V(l,{round:"",dense:"",size:"sm",color:"grey-5","text-color":"grey-7",icon:"photo_camera",disabled:""},{default:O(()=>[V(s,{class:"bg-grey-8 text-white text-sm rounded-lg px-2 py-1"},{default:O(()=>[T(" ðŸ˜´ "+U(Ka.value(e.id)?"Oops! They're not here today":"Camera is off"),1)]),_:2},1024)]),_:2},1024)])],512),[[L,!qa.value||Ka.value(e.id)]])]),V(a,{class:"text-center py-3 px-4"},{default:O(()=>[j("div",ne,[V(S,{class:"scale-50",text:za(e.name).firstName,colorA:"blue",colorB:"red"},null,8,["text"]),T(" "+U(za(e.name).firstName),1)]),za(e.name).lastName?($(),N("div",ie,U(za(e.name).lastName),1)):R("",!0),za(e.name).secondName?($(),N("div",re,U(za(e.name).secondName),1)):R("",!0)]),_:2},1024),V(n,{class:"justify-between items-center px-4 py-3 bg-blue-50"},{default:O(()=>{var t,a,o,n,i;return[V(l,{round:"",dense:"",color:Ka.value(e.id)?"grey-5":"primary",icon:"star",onClick:B(t=>{return Ka.value(e.id)?null:(a=e.id,l=e.name,sa.value.id=a,sa.value.name=l,sa.value.f_l_name=Ca(l),la.value=!0,void _a(a));var a,l},["stop","prevent"]),disable:Ka.value(e.id),class:"shadow-sm behavior-btn"},{default:O(()=>[V(s,{class:D(["text-sm rounded-lg px-2 py-1",Ka.value(e.id)?"bg-grey-8 text-white":"bg-primary text-white"])},{default:O(()=>[T(" ðŸŒŸ "+U(Ka.value(e.id)?"Not available today":"Give a star!"),1)]),_:2},1032,["class"])]),_:2},1032,["color","onClick","disable"]),j("div",de,[j("div",ce,"ðŸŽ¯ "+U((null==(t=oa.value[e.id])?void 0:t.total)||0),1),(null==(a=oa.value[e.id])?void 0:a.positive)>0?($(),N("div",ue," ðŸŸ¢ +"+U(null==(o=oa.value[e.id])?void 0:o.positive),1)):R("",!0),(null==(n=oa.value[e.id])?void 0:n.negative)<0?($(),N("div",me," ðŸ”´ "+U(null==(i=oa.value[e.id])?void 0:i.negative),1)):R("",!0)])]}),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),j("div",ge,[j("div",ve,[Ia.value.classes?($(),N("div",pe,[V(p,{filled:"",modelValue:Yt.value.classes,"onUpdate:modelValue":t[8]||(t[8]=e=>Yt.value.classes=e),options:Ia.value.classes,"option-value":"id","option-label":"name",multiple:"","emit-value":"","map-options":"",label:"Select Classes","use-chips":"",hint:"You can select multiple classes",class:"rounded-lg"},null,8,["modelValue","options"])])):R("",!0)])])])])]}),_:1}),V(r),V(a,null,{default:O(()=>[Lt.value.length?($(),N("div",ye,[j("div",be,U(Dt("common.preview")||"Table Preview"),1),V(r,{class:"my-4"}),j("div",he,U(Dt("common.edit")||"Edit Configuration"),1),V(f,{flat:"",rows:Gt.value,columns:Xt.value,"row-key":"key",dense:""},{"body-cell-label":O(e=>[V(c,{modelValue:e.row.label,"onUpdate:modelValue":t=>e.row.label=t,outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),"body-cell-type":O(e=>[V(p,{modelValue:e.row.type,"onUpdate:modelValue":t=>e.row.type=t,options:["text","email","number","button","list"],outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),"body-cell-visible":O(e=>[V(d,{modelValue:e.row.visible,"onUpdate:modelValue":t=>e.row.visible=t,color:"primary"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["rows","columns"])])):($(),N("div",fe,U(Dt("common.noResults")||"No JSON data provided"),1))]),_:1})]),_:1}),V(m,{modelValue:ea.value,"onUpdate:modelValue":t[10]||(t[10]=e=>ea.value=e)},{default:O(()=>[V(i,{style:{"min-width":"500px"}},{default:O(()=>[V(a,null,{default:O(()=>[t[25]||(t[25]=j("div",{class:"text-lg font-semibold mb-2"},"Paste JSON Data",-1)),V(c,{modelValue:Zt.value,"onUpdate:modelValue":t[9]||(t[9]=e=>Zt.value=e),type:"textarea",autogrow:""},null,8,["modelValue"])]),_:1}),V(n,{align:"right"},{default:O(()=>[Q(V(l,{flat:"",label:"Cancel",color:"grey"},null,512),[[u]]),V(l,{flat:"",label:"Load",color:"primary",onClick:ta}),V(l,{flat:"",label:"Load Text",color:"primary",onClick:aa})]),_:1})]),_:1})]),_:1},8,["modelValue"]),V(m,{modelValue:la.value,"onUpdate:modelValue":t[13]||(t[13]=e=>la.value=e)},{default:O(()=>[V(i,{class:"q-pa-md",style:{"min-width":"500px","max-width":"800px"}},{default:O(()=>[V(a,{class:"row items-center justify-between"},{default:O(()=>[j("div",we," ðŸ§‘â€ðŸŽ“ "+U(sa.value.name),1),Q(V(l,{flat:"",round:"",icon:"close",dense:""},null,512),[[u]])]),_:1}),V(a,null,{default:O(()=>[j("div",_e,[V(o,{name:"record_voice_over",color:"primary"}),t[26]||(t[26]=T(" Reading Aloud "))]),j("div",Se,[V(d,{modelValue:Na.value.readingAloudEnabled,"onUpdate:modelValue":t[11]||(t[11]=e=>Na.value.readingAloudEnabled=e),label:"Enable Reading Aloud",color:"primary",size:"lg",class:D(["mb-2 settings-toggle enhanced-settings-toggle",{"toggle-enabled":Na.value.readingAloudEnabled,"toggle-disabled":!Na.value.readingAloudEnabled}])},{default:O(()=>[V(s,{class:D(["bg-grey-8 text-white tooltip-enhanced",{"tooltip-success":Na.value.readingAloudEnabled,"tooltip-warning":!Na.value.readingAloudEnabled}]),anchor:"top middle",self:"bottom middle"},{default:O(()=>[V(o,{name:Na.value.readingAloudEnabled?"volume_up":"volume_off",size:"xs",class:"mr-1"},null,8,["name"]),T(" "+U(Na.value.readingAloudEnabled?"Reading aloud is enabled - the app will play text aloud where supported":"Reading aloud is disabled - no text-to-speech will play"),1)]),_:1},8,["class"])]),_:1},8,["modelValue","class"]),j("div",xe,[V(o,{name:Na.value.readingAloudEnabled?"check_circle":"cancel",color:Na.value.readingAloudEnabled?"positive":"negative",size:"sm",class:D(["status-icon",{"icon-pulse":Na.value.readingAloudEnabled}])},{default:O(()=>[V(s,{class:D(Na.value.readingAloudEnabled?"bg-positive text-white":"bg-negative text-white"),anchor:"top middle",self:"bottom middle"},{default:O(()=>[V(o,{name:Na.value.readingAloudEnabled?"thumb_up":"thumb_down",size:"xs",class:"mr-1"},null,8,["name"]),T(" Reading aloud is "+U(Na.value.readingAloudEnabled?"active":"inactive"),1)]),_:1},8,["class"])]),_:1},8,["name","color","class"]),j("span",{class:D(["text-sm font-medium transition-all duration-300",Na.value.readingAloudEnabled?"text-positive":"text-negative"])},U(Na.value.readingAloudEnabled?"Enabled":"Disabled"),3),j("div",{class:D(["ml-2 w-2 h-2 rounded-full transition-all duration-300",Na.value.readingAloudEnabled?"bg-positive shadow-green-glow animate-pulse":"bg-negative shadow-red-glow"])},null,2)])]),j("div",Ee,[V(o,{name:"info",size:"xs",class:"mr-1"}),t[27]||(t[27]=T(" When enabled, the app will play text aloud where supported (text-to-speech) "))])]),_:1}),V(r),V(a,null,{default:O(()=>[V(W,{"student-id":sa.value.id,"student-name":sa.value.f_l_name,"period-code":Ft.value,behaviors:Aa.value,summary:oa.value[sa.value.id]||{positive:0,negative:0,total:0},onRecorded:xa,onClose:t[12]||(t[12]=e=>la.value=!1)},null,8,["student-id","student-name","period-code","behaviors","summary"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),j("input",{ref_key:"fileInputRef",ref:ua,type:"file",accept:"image/*",style:{display:"none"},onChange:ha},null,544),V(m,{modelValue:ga.value,"onUpdate:modelValue":t[14]||(t[14]=e=>ga.value=e)},{default:O(()=>[V(i,{style:{"min-width":"500px"}},{default:O(()=>[V(_,{onCaptured:jt,onCancel:Vt})]),_:1})]),_:1},8,["modelValue"]),V(m,{modelValue:na.value,"onUpdate:modelValue":t[18]||(t[18]=e=>na.value=e),maximized:""},{default:O(()=>[V(i,{class:"leaderboard-dialog"},{default:O(()=>[V(a,{class:"leaderboard-header"},{default:O(()=>[j("div",ke,[t[28]||(t[28]=j("div",{class:"trophy-animation"},"ðŸ†",-1)),t[29]||(t[29]=j("h1",{class:"leaderboard-title"},"Super Star Leaderboard!",-1)),t[30]||(t[30]=j("p",{class:"leaderboard-subtitle"},"Our Amazing Top 5 Students This Week! â­",-1)),V(l,{flat:"",round:"",icon:"close",color:"white",size:"lg",onClick:t[15]||(t[15]=e=>na.value=!1),class:"close-btn"})])]),_:1}),V(a,{class:"period-selector"},{default:O(()=>[j("div",Ie,[V(y,{modelValue:da.value,"onUpdate:modelValue":[t[16]||(t[16]=e=>da.value=e),Ea],"toggle-color":"primary",options:[{label:"ðŸ“… This Week",value:"week"},{label:"ðŸ“† This Month",value:"month"},{label:"ðŸ—“ï¸ All Time",value:"all"}],class:"period-toggle"},null,8,["modelValue"]),V(l,{color:"primary",icon:"refresh",label:"Refresh",onClick:Ea,class:"refresh-btn"})])]),_:1}),V(a,{class:"leaderboard-content"},{default:O(()=>[ra.value?($(),N("div",Ce,[V(b,{size:"4rem",color:"primary"}),t[31]||(t[31]=j("p",{class:"loading-text"},"Loading our amazing students...",-1))])):0===ia.value.length?($(),N("div",ze,t[32]||(t[32]=[j("div",{class:"empty-icon"},"ðŸ“š",-1),j("h3",null,"No stars earned yet!",-1),j("p",null,"Let's start earning some points and see who becomes our first super star!",-1)]))):($(),N("div",Ae,[ia.value.length>=3?($(),N("div",Ne,[j("div",$e,[ia.value[1]?($(),N("div",Ve,[j("div",je,[j("div",Oe,[V(h,{src:ia.value[1].avatar||ba(ia.value[1].name),class:"avatar-img"},null,8,["src"]),t[33]||(t[33]=j("div",{class:"position-badge silver"},"2",-1))]),j("h3",De,U(za(ia.value[1].name).firstName),1),j("div",Te,U(ia.value[1].total)+" â­",1),t[34]||(t[34]=j("div",{class:"medal"},"ðŸ¥ˆ",-1))]),t[35]||(t[35]=j("div",{class:"podium-base second-base"},"2nd",-1))])):R("",!0),ia.value[0]?($(),N("div",Ue,[j("div",Fe,[j("div",Re,[V(h,{src:ia.value[0].avatar||ba(ia.value[0].name),class:"avatar-img"},null,8,["src"]),t[36]||(t[36]=j("div",{class:"position-badge gold"},"1",-1)),t[37]||(t[37]=j("div",{class:"crown"},"ðŸ‘‘",-1))]),j("h3",Me,U(za(ia.value[0].name).firstName),1),j("div",Je,U(ia.value[0].total)+" â­",1),t[38]||(t[38]=j("div",{class:"medal"},"ðŸ¥‡",-1))]),t[39]||(t[39]=j("div",{class:"podium-base first-base"},"1st",-1))])):R("",!0),ia.value[2]?($(),N("div",Pe,[j("div",Qe,[j("div",Le,[V(h,{src:ia.value[2].avatar||ba(ia.value[2].name),class:"avatar-img"},null,8,["src"]),t[40]||(t[40]=j("div",{class:"position-badge bronze"},"3",-1))]),j("h3",Be,U(za(ia.value[2].name).firstName),1),j("div",We,U(ia.value[2].total)+" â­",1),t[41]||(t[41]=j("div",{class:"medal"},"ðŸ¥‰",-1))]),t[42]||(t[42]=j("div",{class:"podium-base third-base"},"3rd",-1))])):R("",!0)])])):R("",!0),ia.value.length>3?($(),N("div",qe,[($(!0),N(J,null,P(ia.value.slice(3,5),(e,t)=>($(),N("div",{key:e.id,class:"student-row"},[j("div",He,U(t+4),1),j("div",Ke,[V(h,{src:e.avatar||ba(e.name),class:"row-avatar-img"},null,8,["src"])]),j("div",Ye,[j("h4",Ge,U(za(e.name).firstName)+" "+U(za(e.name).lastName),1),j("div",Xe,U(e.total)+" â­ points",1)]),j("div",Ze,U(0===t?"ðŸŒŸ":"â­"),1)]))),128))])):R("",!0),ia.value.length>0?($(),N("div",et,[t[49]||(t[49]=j("h3",{class:"recognition-title"},"ðŸŽ‰ Special Recognition! ðŸŽ‰",-1)),j("div",tt,[ia.value[0]?($(),N("div",at,[t[43]||(t[43]=j("div",{class:"card-icon"},"ðŸ‘‘",-1)),t[44]||(t[44]=j("div",{class:"card-title"},"Super Star Champion!",-1)),j("div",lt,U(za(ia.value[0].name).firstName),1)])):R("",!0),ia.value[1]?($(),N("div",st,[t[45]||(t[45]=j("div",{class:"card-icon"},"ðŸŒŸ",-1)),t[46]||(t[46]=j("div",{class:"card-title"},"Amazing Achiever!",-1)),j("div",ot,U(za(ia.value[1].name).firstName),1)])):R("",!0),ia.value[2]?($(),N("div",nt,[t[47]||(t[47]=j("div",{class:"card-icon"},"â­",-1)),t[48]||(t[48]=j("div",{class:"card-title"},"Fantastic Friend!",-1)),j("div",it,U(za(ia.value[2].name).firstName),1)])):R("",!0)])])):R("",!0)]))]),_:1}),V(a,{class:"leaderboard-footer"},{default:O(()=>[j("div",rt,[t[50]||(t[50]=j("p",{class:"encouragement-message"}," ðŸŒŸ Every student is a star! Keep being awesome and earning those points! ðŸŒŸ ",-1)),V(l,{color:"primary",label:"ðŸŽ¯ Back to Classroom",onClick:t[17]||(t[17]=e=>na.value=!1),class:"back-btn",size:"lg"})])]),_:1})]),_:1})]),_:1},8,["modelValue"]),V(m,{modelValue:ca.value,"onUpdate:modelValue":t[21]||(t[21]=e=>ca.value=e)},{default:O(()=>[V(i,{style:{"min-width":"600px","max-width":"800px"}},{default:O(()=>{var e;return[V(a,null,{default:O(()=>[j("div",dt,[V(o,{name:"settings",color:"primary"}),t[51]||(t[51]=T(" Classroom Settings "))])]),_:1}),V(r),V(a,null,{default:O(()=>[j("div",ct,[V(o,{name:"photo_camera",color:"primary"}),t[52]||(t[52]=T(" Avatar Management "))]),j("div",ut,[V(d,{modelValue:Na.value.avatarEditingEnabled,"onUpdate:modelValue":t[19]||(t[19]=e=>Na.value.avatarEditingEnabled=e),label:"Enable Avatar Editing",color:"primary",size:"lg",class:D(["mb-2 settings-toggle enhanced-settings-toggle",{"toggle-enabled":Na.value.avatarEditingEnabled,"toggle-disabled":!Na.value.avatarEditingEnabled}])},{default:O(()=>[V(s,{class:D(["bg-grey-8 text-white tooltip-enhanced",{"tooltip-success":Na.value.avatarEditingEnabled,"tooltip-warning":!Na.value.avatarEditingEnabled}]),anchor:"top middle",self:"bottom middle"},{default:O(()=>[V(o,{name:Na.value.avatarEditingEnabled?"photo_camera":"photo_camera_off",size:"xs",class:"mr-1"},null,8,["name"]),T(" "+U(Na.value.avatarEditingEnabled?"Avatar editing is currently enabled - students can upload/capture photos":"Avatar editing is currently disabled - students cannot change photos"),1)]),_:1},8,["class"])]),_:1},8,["modelValue","class"]),j("div",mt,[V(o,{name:Na.value.avatarEditingEnabled?"check_circle":"cancel",color:Na.value.avatarEditingEnabled?"positive":"negative",size:"sm",class:D(["status-icon",{"icon-pulse":Na.value.avatarEditingEnabled}])},{default:O(()=>[V(s,{class:D(Na.value.avatarEditingEnabled?"bg-positive text-white":"bg-negative text-white"),anchor:"top middle",self:"bottom middle"},{default:O(()=>[V(o,{name:Na.value.avatarEditingEnabled?"thumb_up":"thumb_down",size:"xs",class:"mr-1"},null,8,["name"]),T(" Avatar editing is "+U(Na.value.avatarEditingEnabled?"active":"inactive"),1)]),_:1},8,["class"])]),_:1},8,["name","color","class"]),j("span",{class:D(["text-sm font-medium transition-all duration-300",Na.value.avatarEditingEnabled?"text-positive":"text-negative"])},U(Na.value.avatarEditingEnabled?"Enabled":"Disabled"),3),j("div",{class:D(["ml-2 w-2 h-2 rounded-full transition-all duration-300",Na.value.avatarEditingEnabled?"bg-positive shadow-green-glow animate-pulse":"bg-negative shadow-red-glow"])},null,2)])]),j("div",gt,[V(o,{name:"info",size:"xs",class:"mr-1"}),t[53]||(t[53]=T(" When enabled, students can upload or capture new profile pictures "))])]),_:1}),V(r),(null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length)?($(),F(a,{key:0},{default:O(()=>{var e,a,n,i,r;return[t[55]||(t[55]=j("div",{class:"text-subtitle1 mb-3 font-semibold"},"Student Attendance",-1)),t[56]||(t[56]=j("div",{class:"text-caption text-grey-6 mb-4"}," Mark students as present or absent. Absent students will appear grayed out. ",-1)),j("div",vt,[($(!0),N(J,null,P(Ia.value.my_sel_classroom_students,e=>($(),N("div",{key:e.id,class:D(["attendance-item flex items-center justify-between p-3 rounded-lg mb-2 transition-all duration-300 hover:shadow-md",[Wa(e.id)?"bg-green-50 hover:bg-green-100 border-l-4 border-green-400 attendance-present":"bg-red-50 hover:bg-red-100 border-l-4 border-red-400 attendance-absent"]])},[j("div",pt,[j("div",ft,[V(g,{size:"40px",class:"attendance-avatar"},{default:O(()=>[V(h,{src:e.avatar||ba(e.name),class:D(["rounded-full transition-all duration-300",{"grayscale opacity-60 blur-sm":!Wa(e.id)}])},null,8,["src","class"])]),_:2},1024),j("div",yt,[V(o,{name:Wa(e.id)?"check_circle":"cancel",color:Wa(e.id)?"positive":"negative",size:"sm",class:D(["bg-white rounded-full shadow-sm attendance-status-icon",{"pulse-animation":!Wa(e.id)}])},{default:O(()=>[V(s,{class:D(Wa(e.id)?"bg-positive text-white":"bg-negative text-white"),anchor:"top middle",self:"bottom middle"},{default:O(()=>[V(o,{name:Wa(e.id)?"person":"person_off",size:"xs",class:"mr-1"},null,8,["name"]),T(" "+U(za(e.name).firstName)+" is "+U(Wa(e.id)?"present":"absent"),1)]),_:2},1032,["class"])]),_:2},1032,["name","color","class"])]),j("div",{class:D(["absolute inset-0 rounded-full border-2 transition-all duration-300",Wa(e.id)?"border-green-400 shadow-green-glow":"border-red-400 shadow-red-glow"])},null,2)]),j("div",bt,[j("div",{class:D(["font-medium transition-all duration-300",Wa(e.id)?"text-grey-8":"text-grey-5 line-through"])},[T(U(za(e.name).firstName)+" "+U(za(e.name).lastName)+" ",1),Wa(e.id)?R("",!0):($(),F(o,{key:0,name:"visibility_off",size:"xs",class:"ml-1 text-grey-4"}))],2),za(e.name).secondName?($(),N("div",{key:0,class:D(["text-sm transition-all duration-300",Wa(e.id)?"text-grey-6":"text-grey-4"])},U(za(e.name).secondName),3)):R("",!0)])]),j("div",ht,[V(v,{color:Wa(e.id)?"positive":"negative","text-color":"white",size:"sm",class:D(["font-medium attendance-chip transition-all duration-300",{"chip-pulse":!Wa(e.id)}]),icon:Wa(e.id)?"person":"person_off"},{default:O(()=>[T(U(Wa(e.id)?"Present":"Absent")+" ",1),V(s,{class:D(Wa(e.id)?"bg-positive text-white":"bg-negative text-white"),anchor:"top middle",self:"bottom middle"},{default:O(()=>[V(o,{name:Wa(e.id)?"check":"close",size:"xs",class:"mr-1"},null,8,["name"]),T(" "+U(za(e.name).firstName)+" is currently marked as "+U(Wa(e.id)?"present":"absent"),1)]),_:2},1032,["class"])]),_:2},1032,["color","class","icon"]),V(d,{"model-value":Wa(e.id),"onUpdate:modelValue":t=>(e=>{var t;try{if(!e||"string"!=typeof e&&"number"!=typeof e)throw new Error("Invalid student ID provided");if(!(null==(t=Ia.value.my_sel_classroom_students)?void 0:t.some(t=>t.id.toString()===e.toString())))throw new Error(`Student ID ${e} not found in current classroom`);const a=Wa(e);Na.value.attendance[e]=!a;const l=Ia.value.my_sel_classroom_students.find(t=>t.id.toString()===e.toString()),s=l?za(l.name).firstName:`Student ${e}`;Tt.notify({message:`${s} marked as ${a?"absent":"present"}`,color:a?"warning":"positive",position:"top",timeout:2e3,icon:a?"person_off":"person"}),console.log(`Toggled attendance for student ${e}: ${a?"absent":"present"}`)}catch(a){console.error("Error toggling student attendance:",a),Tt.notify({message:`Failed to update attendance: ${a.message}`,color:"negative",position:"top",timeout:3e3,icon:"error"})}})(e.id),color:Wa(e.id)?"positive":"negative",size:"md",class:D(["attendance-toggle enhanced-toggle",{"toggle-absent":!Wa(e.id)}])},{default:O(()=>[V(s,{class:"bg-grey-8 text-white tooltip-enhanced",anchor:"top middle",self:"bottom middle"},{default:O(()=>[V(o,{name:Wa(e.id)?"toggle_off":"toggle_on",size:"xs",class:"mr-1"},null,8,["name"]),T(" Click to mark "+U(za(e.name).firstName)+" as "+U(Wa(e.id)?"absent":"present"),1)]),_:2},1024)]),_:2},1032,["model-value","onUpdate:modelValue","color","class"])])],2))),128))]),j("div",wt,[V(l,{color:"positive",icon:"check_circle",label:"Mark All Present",onClick:Ya,size:"sm",class:D(["flex-1 attendance-action-btn enhanced-action-btn",{"btn-success-glow":null==(e=Ia.value.my_sel_classroom_students)?void 0:e.every(e=>Wa(e.id))}])},{default:O(()=>[V(s,{class:"bg-positive text-white tooltip-enhanced"},{default:O(()=>{var e;return[V(o,{name:"group",size:"xs",class:"mr-1"}),T(" Mark all "+U((null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length)||0)+" students in this classroom as present ",1)]}),_:1})]),_:1},8,["class"]),V(l,{color:"negative",icon:"cancel",label:"Mark All Absent",onClick:Ga,size:"sm",class:D(["flex-1 attendance-action-btn enhanced-action-btn",{"btn-warning-glow":null==(a=Ia.value.my_sel_classroom_students)?void 0:a.every(e=>!Wa(e.id))}])},{default:O(()=>[V(s,{class:"bg-negative text-white tooltip-enhanced"},{default:O(()=>{var e;return[V(o,{name:"group_off",size:"xs",class:"mr-1"}),T(" Mark all "+U((null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length)||0)+" students in this classroom as absent ",1)]}),_:1})]),_:1},8,["class"])]),j("div",_t,[j("div",St,[j("div",xt,[V(o,{name:"group",color:"primary",size:"sm"}),t[54]||(t[54]=j("span",{class:"font-medium"},"Attendance Summary:",-1))]),j("div",Et,[j("div",kt,[V(o,{name:"check_circle",color:"positive",size:"xs"}),j("span",It,U((null==(n=Ia.value.my_sel_classroom_students)?void 0:n.filter(e=>Wa(e.id)).length)||0)+" Present ",1)]),j("div",Ct,[V(o,{name:"cancel",color:"negative",size:"xs"}),j("span",zt,U((null==(i=Ia.value.my_sel_classroom_students)?void 0:i.filter(e=>!Wa(e.id)).length)||0)+" Absent ",1)])])]),j("div",At,[V(w,{value:(null==(r=Ia.value.my_sel_classroom_students)?void 0:r.length)?Ia.value.my_sel_classroom_students.filter(e=>Wa(e.id)).length/Ia.value.my_sel_classroom_students.length:0,color:"positive","track-color":"negative",size:"8px",rounded:"",class:"attendance-progress"},{default:O(()=>[V(s,{class:"bg-grey-8 text-white"},{default:O(()=>{var e;return[T(U(Math.round(100*((null==(e=Ia.value.my_sel_classroom_students)?void 0:e.length)?Ia.value.my_sel_classroom_students.filter(e=>Wa(e.id)).length/Ia.value.my_sel_classroom_students.length:0)))+"% attendance rate ",1)]}),_:1})]),_:1},8,["value"])])])]}),_:1})):($(),F(a,{key:1},{default:O(()=>[j("div",Nt,[V(o,{name:"school",size:"4rem",class:"mb-4"}),t[57]||(t[57]=j("div",{class:"text-h6 mb-2"},"No Classroom Selected",-1)),t[58]||(t[58]=j("div",{class:"text-body2"}," Please select a classroom to manage student attendance ",-1))])]),_:1})),V(r),V(n,{align:"right",class:"q-pa-md"},{default:O(()=>{var e;return[(null==(e=Ia.value.my_classes_with_students)?void 0:e.length)>1?($(),F(l,{key:0,flat:"",label:"Test Classroom Switching",color:"info",onClick:Qa,size:"sm",class:"mr-2"},{default:O(()=>[V(s,{class:"bg-info text-white"},{default:O(()=>[V(o,{name:"swap_horiz",size:"xs",class:"mr-1"}),t[59]||(t[59]=T(" Test settings behavior by switching between all available classrooms "))]),_:1})]),_:1})):R("",!0),V(l,{flat:"",label:"Close",color:"grey",onClick:t[20]||(t[20]=e=>ca.value=!1),size:"md"})]}),_:1})]}),_:1})]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-4bc4ab11"]]);export{Vt as default};
