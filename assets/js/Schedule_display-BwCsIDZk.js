import{p as e,u as l,e as a,Q as o,g as s,n as t,d as r,m as n,aD as d,b as i}from"./app-BzjXrVp9.js";import{Q as u}from"./QTd-DUSBgVC_.js";import{Q as c}from"./QSelect-CciNNEfD.js";import{Q as v}from"./QTable-BcXT6C-J.js";import{f as p,a as m,k as b,L as f,O as y,I as g,b as h,J as w,M as _,F as C,y as k,U as j,V,x as q,Z as I}from"./vendor-EI0FRBVb.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./ui-B__oX9pK.js";import"./rtl-Cr6c3OOr.js";import"./QMarkupTable-_1wJRVO3.js";import"./QLinearProgress-L5RdawR6.js";import"./use-fullscreen-BnDnBhbA.js";const P={key:0,class:"mt-4"},S={class:"row full-width q-col-gutter-md"},Q={class:"col-12 col-md-6"},x={class:"col-12 col-md-6 flex justify-end items-center"},U={class:"edit-actions q-mt-sm"},L=["onClick"],T={class:"edit-actions q-mt-sm"},$=["onClick"],D={class:"full-width row flex-center q-gutter-sm"},A={class:"text-negative"},E=e({__name:"Schedule_display",props:{schoolId:{type:Number,required:!0},scheduleCopyId:{type:Number,required:!0}},setup(e){const E=l(),F=e,M=[{name:"id",label:"ID",field:"id",align:"left",sortable:!0},{name:"classroom",label:"Classroom",field:e=>{var l,a;return null==(a=null==(l=e.cst)?void 0:l.classroom)?void 0:a.name},align:"left",sortable:!0},{name:"subject",label:"Subject",field:e=>{var l,a;return null==(a=null==(l=e.cst)?void 0:l.subject)?void 0:a.name},align:"left",sortable:!0},{name:"teacher",label:"Teacher",field:e=>{var l,a;return null==(a=null==(l=e.cst)?void 0:l.teacher)?void 0:a.name},align:"left",sortable:!0},{name:"period_number",label:"Period",field:"period_number",align:"center",sortable:!0},{name:"day",label:"Day",field:"day",align:"center",sortable:!0},{name:"active",label:"Active",field:"active",align:"center",sortable:!0}],B=p({sortBy:"period_number",descending:!1,page:1,rowsPerPage:10}),N=p(F.schoolId),R=p([]),O=p(!1),z=p(!1),J=p(""),K=p(""),W=p(null),Z=p(""),G=p(""),H=p(!1),X=p(null),Y=e=>["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"][e-1]||`Day ${e}`,ee=Array.from({length:10},(e,l)=>({label:`Period ${l+1}`,value:l+1})),le=Array.from({length:5},(e,l)=>({label:Y(l+1),value:l+1})),ae=(e,l,a)=>{W.value=e,Z.value=l,G.value=a},oe=()=>{W.value=null,Z.value=""},se=e=>{X.value=e,H.value=!0},te=async e=>{var l,a;try{O.value=!0,await I.post(`/admin/schedules/update/${e.id}`,{[Z.value]:G.value}),e[Z.value]=G.value,E.notify({type:"positive",message:"Schedule updated successfully"})}catch(o){E.notify({type:"negative",message:(null==(a=null==(l=o.response)?void 0:l.data)?void 0:a.message)||"Failed to update schedule"}),console.error("Error updating schedule:",o)}finally{W.value=null,Z.value="",H.value=!1,O.value=!1}},re=m(()=>{let e=[...R.value];if(K.value){const l=K.value.toLowerCase();e=e.filter(e=>{var a,o,s,t,r,n;return((null==(o=null==(a=e.cst)?void 0:a.classroom)?void 0:o.name)||"").toLowerCase().includes(l)||((null==(t=null==(s=e.cst)?void 0:s.subject)?void 0:t.name)||"").toLowerCase().includes(l)||((null==(n=null==(r=e.cst)?void 0:r.teacher)?void 0:n.name)||"").toLowerCase().includes(l)||String(e.period_number).includes(l)||Y(e.day).toLowerCase().includes(l)})}return e}),ne=async()=>{var e,l;try{O.value=!0;const e=await I.get(`/admin/schedules/${F.schoolId}/${F.scheduleCopyId}`);R.value=e.data}catch(a){J.value=(null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||"Failed to fetch schedule data",z.value=!0,console.error("Error fetching schedule data:",a)}finally{O.value=!1}},de=()=>{B.value.page=1},ie=e=>{B.value.page=e.pagination.page,B.value.rowsPerPage=e.pagination.rowsPerPage,B.value.sortBy=e.pagination.sortBy,B.value.descending=e.pagination.descending};return b(()=>F.scheduleCopyId,ne,{immediate:!0}),(l,p)=>N.value&&e.scheduleCopyId?(g(),f("div",P,[h(v,{title:"Schedule Entries",rows:re.value,columns:M,"row-key":"id",loading:O.value,pagination:B.value,"rows-per-page-options":[10,20,50],flat:"",bordered:"",dense:"",onRequest:ie},{top:w(()=>[_("div",S,[_("div",Q,[h(s,{modelValue:K.value,"onUpdate:modelValue":[p[0]||(p[0]=e=>K.value=e),de],dense:"",outlined:"",placeholder:"Search...",class:"q-mb-md"},{append:w(()=>[h(a,{name:"search"})]),_:1},8,["modelValue"])]),_("div",x,[h(o,{color:"primary",icon:"refresh",onClick:ne,loading:O.value,label:"Refresh",class:"q-ml-md"},null,8,["loading"])])])]),"body-cell-classroom":w(e=>[h(u,{props:e},{default:w(()=>{var l,a;return[V(j((null==(a=null==(l=e.row.cst)?void 0:l.classroom)?void 0:a.name)||"-"),1)]}),_:2},1032,["props"])]),"body-cell-subject":w(e=>[h(u,{props:e},{default:w(()=>{var l,a;return[V(j((null==(a=null==(l=e.row.cst)?void 0:l.subject)?void 0:a.name)||"-"),1)]}),_:2},1032,["props"])]),"body-cell-teacher":w(e=>[h(u,{props:e},{default:w(()=>{var l,a;return[V(j((null==(a=null==(l=e.row.cst)?void 0:l.teacher)?void 0:a.name)||"-"),1)]}),_:2},1032,["props"])]),"body-cell-period_number":w(e=>[h(u,{props:e,class:"editable-cell"},{default:w(()=>[W.value===e.row.id&&"period_number"===Z.value?(g(),f(C,{key:0},[h(c,{modelValue:G.value,"onUpdate:modelValue":[p[1]||(p[1]=e=>G.value=e),l=>se(e.row)],options:k(ee),"option-value":"value","option-label":"label","emit-value":"","map-options":"",dense:"",outlined:"",class:"edit-select",rules:[e=>!!e||"Period is required"]},null,8,["modelValue","options","onUpdate:modelValue","rules"]),_("div",U,[h(o,{flat:"",dense:"",color:"positive",icon:"check",onClick:l=>te(e.row)},null,8,["onClick"]),h(o,{flat:"",dense:"",color:"negative",icon:"close",onClick:oe})])],64)):(g(),f("div",{key:1,class:"editable-content",onClick:l=>ae(e.row.id,"period_number",e.row.period_number)},j(e.row.period_number),9,L))]),_:2},1032,["props"])]),"body-cell-day":w(e=>[h(u,{props:e,class:"editable-cell"},{default:w(()=>[W.value===e.row.id&&"day"===Z.value?(g(),f(C,{key:0},[h(c,{modelValue:G.value,"onUpdate:modelValue":[p[2]||(p[2]=e=>G.value=e),l=>se(e.row)],options:k(le),"option-value":"value","option-label":"label","emit-value":"","map-options":"",dense:"",outlined:"",class:"edit-select",rules:[e=>!!e||"Day is required"]},null,8,["modelValue","options","onUpdate:modelValue","rules"]),_("div",T,[h(o,{flat:"",dense:"",color:"positive",icon:"check",onClick:l=>te(e.row)},null,8,["onClick"]),h(o,{flat:"",dense:"",color:"negative",icon:"close",onClick:oe})])],64)):(g(),f("div",{key:1,class:"editable-content",onClick:l=>ae(e.row.id,"day",e.row.day)},j(Y(e.row.day)),9,$))]),_:2},1032,["props"])]),"body-cell-active":w(e=>[h(u,{props:e},{default:w(()=>[h(a,{name:e.row.active?"check_circle":"cancel",color:e.row.active?"positive":"negative"},null,8,["name","color"])]),_:2},1032,["props"])]),"no-data":w(()=>[_("div",D,[h(a,{size:"2em",name:"sentiment_dissatisfied"}),p[6]||(p[6]=_("span",null,"No matching records found",-1))])]),_:1},8,["rows","loading","pagination"]),h(i,{modelValue:z.value,"onUpdate:modelValue":p[3]||(p[3]=e=>z.value=e)},{default:w(()=>[h(t,null,{default:w(()=>[h(r,null,{default:w(()=>[p[7]||(p[7]=_("div",{class:"text-h6"},"Error",-1)),_("div",A,j(J.value),1)]),_:1}),h(n,{align:"right"},{default:w(()=>[q(h(o,{flat:"",label:"OK",color:"primary"},null,512),[[d]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),h(i,{modelValue:H.value,"onUpdate:modelValue":p[5]||(p[5]=e=>H.value=e)},{default:w(()=>[h(t,null,{default:w(()=>[h(r,null,{default:w(()=>p[8]||(p[8]=[_("div",{class:"text-h6"},"Confirm Changes",-1),_("div",{class:"text-body1"},"Are you sure you want to save the changes?",-1)])),_:1}),h(n,{align:"right"},{default:w(()=>[q(h(o,{flat:"",label:"Cancel",color:"negative"},null,512),[[d]]),h(o,{flat:"",label:"Save",color:"positive",onClick:p[4]||(p[4]=e=>te(X.value))})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):y("",!0)}},[["__scopeId","data-v-1b4c281b"]]);export{E as default};
