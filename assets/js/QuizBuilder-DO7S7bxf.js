import{o as e,d as l,Q as a,p as t,c as s,m as i,u as o,f as u,a as n,bb as r,n as d,aP as c,C as m,b as v}from"./app-CqJgtQaN.js";import{Q as p}from"./QSelect-DIrzf0A1.js";import{Q as g}from"./QSpinnerDots-COoAi2MP.js";import{Q as f}from"./QBadge-Coi-CloS.js";import{Q as y,a as _}from"./QToolbar-Ca3FN16A.js";import{Q as h}from"./QSpace-1qvgFvrB.js";import{f as q,a as b,I as x,J as w,K as z,b as k,M as V,Q,N as j,S as C,V as M,W as S,a0 as T,U,o as D,z as P,a4 as F,$ as H,F as R,R as E,y as N,_ as A}from"./vendor-DuKqz2x4.js";import{d as I}from"./vuedraggable.umd-CABkNphu.js";import{Q as L}from"./QuizNavigation-C6VeC0nQ.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";import"./rtl-Cr6c3OOr.js";import"./index-DJPqu1_-.js";import"./QTabs-HxdE4zj2.js";const $={key:0,class:"question-card__drag-handle"},O={class:"question-card__info"},B={class:"question-card__header"},J={class:"question-card__number"},K=["innerHTML"],W={class:"question-card__meta"},Y={key:0},G={key:1},X=e({__name:"QuestionCard",props:{question:{type:Object,required:!0},draggable:{type:Boolean,default:!1},showPreview:{type:Boolean,default:!0},showRemove:{type:Boolean,default:!1}},emits:["preview","remove"],setup(e){const o=e,u=q(!1),n=b(()=>{var e;return{"multiple-choice":"radio_button_checked","true-false":"check_circle","fill-blank":"edit",matching:"compare_arrows",essay:"description"}[null==(e=o.question.question_type)?void 0:e.slug]||"help_outline"}),r=b(()=>{var e;return{"multiple-choice":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)","true-false":"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)","fill-blank":"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",matching:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",essay:"linear-gradient(135deg, #fa709a 0%, #fee140 100%)"}[null==(e=o.question.question_type)?void 0:e.slug]||"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}),d=b(()=>({Easy:"positive",Medium:"warning",Hard:"negative"}[o.question.difficulty]||"info")),c=(e,l)=>{if(!e)return"";const a=e.replace(/<[^>]*>/g,"");return a.length>l?a.substring(0,l)+"...":a};return(o,m)=>(w(),x(i,{class:U(["question-card",{"question-card--dragging":u.value}])},{default:z(()=>[k(s,{class:"question-card__content"},{default:z(()=>[e.draggable?(w(),V("div",$,[k(l,{name:"drag_indicator",size:"20px",color:"grey-6"})])):Q("",!0),j("div",{class:"question-card__type-icon",style:C({background:r.value})},[k(l,{name:n.value,size:"24px",color:"white"},null,8,["name"])],4),j("div",O,[j("div",B,[j("span",J,"Q"+M(e.question.order_index||e.question.id),1),k(f,{color:d.value,label:e.question.difficulty||"Medium"},null,8,["color","label"])]),j("div",{class:"question-card__text",innerHTML:c(e.question.question_text,100)},null,8,K),j("div",W,[e.question.topic?(w(),V("span",Y,[k(l,{name:"label",size:"14px"}),S(" "+M(e.question.topic.name),1)])):Q("",!0),e.question.bloom_level?(w(),V("span",G,[k(l,{name:"psychology",size:"14px"}),S(" "+M(e.question.bloom_level),1)])):Q("",!0)])]),j("div",{class:"question-card__actions",onClick:m[2]||(m[2]=T(()=>{},["stop"]))},[e.showPreview?(w(),x(a,{key:0,flat:"",round:"",dense:"",icon:"visibility",size:"sm",onClick:m[0]||(m[0]=l=>o.$emit("preview",e.question))},{default:z(()=>[k(t,null,{default:z(()=>m[3]||(m[3]=[S("Preview")])),_:1})]),_:1})):Q("",!0),e.showRemove?(w(),x(a,{key:1,flat:"",round:"",dense:"",icon:"close",size:"sm",color:"negative",onClick:m[1]||(m[1]=l=>o.$emit("remove",e.question))},{default:z(()=>[k(t,null,{default:z(()=>m[4]||(m[4]=[S("Remove")])),_:1})]),_:1})):Q("",!0)])]),_:1})]),_:1},8,["class"]))}},[["__scopeId","data-v-2b9dc0f6"]]),Z={class:"quiz-builder"},ee={class:"quiz-builder__container"},le={class:"quiz-builder__header q-mb-md"},ae={class:"row items-center justify-between"},te={class:"row items-center q-gutter-x-md"},se={class:"text-h4 text-weight-bold text-primary q-my-none"},ie={class:"text-subtitle1 text-grey-7 q-my-none"},oe={class:"row q-gutter-x-sm"},ue={class:"row q-col-gutter-lg"},ne={class:"col-12 col-md-3"},re={class:"row items-center justify-between"},de={class:"row q-col-gutter-sm"},ce={class:"col-6"},me={class:"col-6"},ve={key:0,class:"row justify-center q-pa-lg"},pe={key:1,class:"column items-center justify-center text-grey-5 q-pa-xl"},ge={key:2,class:"q-gutter-y-sm"},fe={class:"col-12 col-md-6"},ye={class:"row items-center justify-between"},_e={class:"text-h6 text-weight-bold"},he={class:"row q-gutter-x-sm"},qe={key:0,class:"column items-center justify-center full-height text-grey-5"},be={class:"row items-start no-wrap q-gutter-x-sm animate-pop"},xe={class:"column items-center q-pt-sm"},we={class:"col-12 col-md-3"},ze={class:"row q-col-gutter-sm"},ke={class:"col-6"},Ve={class:"col-6"},Qe={class:"row q-col-gutter-sm"},je={class:"col-4 text-center"},Ce={class:"text-h6 text-weight-bold text-primary"},Me={class:"col-4 text-center"},Se={class:"text-h6 text-weight-bold text-orange"},Te={class:"col-4 text-center"},Ue={class:"text-h6 text-weight-bold text-secondary"},De={class:"col-12 col-md-8"},Pe={class:"text-h3 text-weight-bold text-primary q-my-none"},Fe={class:"text-h6 text-grey-7 q-mt-md"},He={class:"row justify-center q-gutter-x-lg q-mt-lg"},Re={class:"row items-center q-mb-md"},Ee=["innerHTML"],Ne={class:"q-gutter-y-sm"},Ae={class:"row items-center"},Ie={class:"col"},Le=["innerHTML"],$e={class:"q-gutter-y-sm"},Oe={class:"row items-center"},Be={class:"col"},Je=e({__name:"QuizBuilder",props:{quizId:[Number,String]},setup(e){const C=o(),$=e,O=q({name:"",description:"",time_limit_minutes:null,status:"draft",shuffle_questions:!1,shuffle_options:!1,allow_review:!0}),B=q([]),J=q([]),K=q([]),W=q([]),Y=q(!1),G=q(!1),Je=q(!1),Ke=q(!1),We=q(""),Ye=q(null),Ge=q(null),Xe=q(null),Ze=q(!1),el=q(!1),ll=q(null),al=b(()=>{let e=[...B.value];const l=J.value.map(e=>e.id);if(e=e.filter(e=>!l.includes(e.id)),We.value){const l=We.value.toLowerCase();e=e.filter(e=>e.question_text.toLowerCase().includes(l))}return Ye.value&&(e=e.filter(e=>e.question_type_id===Ye.value.id)),Ge.value&&(e=e.filter(e=>e.difficulty===Ge.value)),Xe.value&&(e=e.filter(e=>e.topic_id===Xe.value.id)),e}),tl=b(()=>`${Math.ceil(1.5*J.value.length)} min`),sl=b(()=>{if(0===J.value.length)return"N/A";const e={Easy:1,Medium:2,Hard:3},l=J.value.reduce((l,a)=>l+(e[a.difficulty]||2),0)/J.value.length;return l<1.5?"Easy":l<2.5?"Medium":"Hard"}),il=async()=>{Y.value=!0;try{const e=await A.get("/api/questions",{params:{grade_level_id:O.value.grade_id,subject_id:O.value.subject_id,status:"active",per_page:100}});e.data.success&&e.data.data?B.value=e.data.data.data||[]:B.value=[]}catch(e){console.error("Failed to fetch questions:",e),B.value=[],C.notify({type:"negative",message:"Failed to load questions",icon:"error"})}finally{Y.value=!1}},ol=e=>{J.value.find(l=>l.id===e.id)||J.value.push({...e})},ul=()=>{C.dialog({title:"Clear All Questions",message:"Are you sure you want to remove all questions from this quiz?",cancel:!0,persistent:!0,class:"rounded-xl"}).onOk(()=>{J.value=[]})},nl=()=>{J.value=J.value.map(e=>({value:e,sort:Math.random()})).sort((e,l)=>e.sort-l.sort).map(({value:e})=>e)},rl=e=>{e.preventDefault(),Ke.value=!1;try{const l=e.dataTransfer.getData("question");if(l){const e=JSON.parse(l);ol(e)}}catch(l){console.error("Failed to handle drop:",l)}},dl=e=>{ll.value=e,el.value=!0},cl=async()=>{if(O.value.name)if(0!==J.value.length){G.value=!0;try{const e={...O.value,question_ids:J.value.map(e=>e.id)};$.quizId?(await A.put(`/api/quizzes/${$.quizId}`,e),C.notify({type:"positive",message:"Quiz updated successfully",icon:"check_circle"})):(await A.post("/api/quizzes",e),C.notify({type:"positive",message:"Quiz created successfully",icon:"check_circle"})),H.visit("/quizzes")}catch(e){console.error("Failed to save quiz:",e),C.notify({type:"negative",message:"Failed to save quiz",icon:"error"})}finally{G.value=!1}}else C.notify({type:"warning",message:"Please add at least one question",icon:"warning"});else C.notify({type:"warning",message:"Please enter a quiz name",icon:"warning"})};return D(()=>{(async()=>{if($.quizId)try{const e=await A.get(`/api/quizzes/${$.quizId}`);O.value=e.data,J.value=e.data.questions||[]}catch(e){console.error("Failed to load quiz:",e),C.notify({type:"negative",message:"Failed to load quiz",icon:"error"})}})(),il(),(async()=>{try{const[e,l]=await Promise.all([A.get("/api/question-types"),A.get("/api/topics")]);K.value=e.data,W.value=l.data}catch(e){console.error("Failed to fetch metadata:",e)}})()}),(e,o)=>(w(),V("div",Z,[k(P(F),{title:O.value.id?"Edit Quiz":"Create Quiz"},null,8,["title"]),j("div",ee,[k(L,{role:"teacher"}),j("div",le,[j("div",ae,[j("div",te,[k(a,{flat:"",round:"",color:"primary",icon:"arrow_back",class:"bg-white shadow-1",onClick:o[0]||(o[0]=e=>P(H).visit("/quizzes"))}),j("div",null,[j("h1",se,M(O.value.id?"Edit Quiz":"Create New Quiz"),1),j("p",ie,M(J.value.length)+" questions selected ",1)])]),j("div",oe,[k(a,{flat:"",rounded:"",color:"primary",label:"Preview",icon:"visibility",class:"bg-white text-weight-bold shadow-1",onClick:o[1]||(o[1]=e=>Ze.value=!0)}),k(a,{push:"",rounded:"",color:"secondary",label:"Save Quiz",icon:"save",class:"text-weight-bold",onClick:cl,loading:G.value},null,8,["loading"])])])]),j("div",ue,[j("div",ne,[k(i,{class:"rounded-xl shadow-2 full-height bg-white"},{default:z(()=>[k(s,{class:"bg-blue-1 text-primary"},{default:z(()=>[j("div",re,[o[20]||(o[20]=j("div",{class:"text-h6 text-weight-bold"},"Question Pool",-1)),k(a,{flat:"",round:"",dense:"",icon:"refresh",onClick:il},{default:z(()=>[k(t,null,{default:z(()=>o[19]||(o[19]=[S("Refresh")])),_:1})]),_:1})])]),_:1}),k(s,{class:"q-pa-md q-gutter-y-md"},{default:z(()=>[k(u,{modelValue:We.value,"onUpdate:modelValue":o[2]||(o[2]=e=>We.value=e),outlined:"",dense:"",rounded:"",placeholder:"Search questions...","bg-color":"grey-1"},{prepend:z(()=>[k(l,{name:"search",color:"primary"})]),_:1},8,["modelValue"]),j("div",de,[j("div",ce,[k(p,{modelValue:Ye.value,"onUpdate:modelValue":o[3]||(o[3]=e=>Ye.value=e),outlined:"",dense:"",rounded:"",options:K.value,label:"Type","option-label":"name","option-value":"id","bg-color":"grey-1",behavior:"menu"},null,8,["modelValue","options"])]),j("div",me,[k(p,{modelValue:Ge.value,"onUpdate:modelValue":o[4]||(o[4]=e=>Ge.value=e),outlined:"",dense:"",rounded:"",options:["Easy","Medium","Hard"],label:"Difficulty","bg-color":"grey-1",behavior:"menu"},null,8,["modelValue"])])])]),_:1}),k(n),k(s,{class:"quiz-builder__pool-list scroll",style:{height:"calc(100vh - 350px)"}},{default:z(()=>[Y.value?(w(),V("div",ve,[k(g,{color:"primary",size:"40px"})])):0===al.value.length?(w(),V("div",pe,[k(l,{name:"sentiment_dissatisfied",size:"48px"}),o[21]||(o[21]=j("p",{class:"q-mt-sm"},"No questions found",-1))])):(w(),V("div",ge,[(w(!0),V(R,null,E(al.value,e=>(w(),x(X,{key:`pool-${e.id}`,question:e,"show-remove":!1,compact:"",class:"cursor-pointer hover-scale",onClick:l=>ol(e),draggable:"true",onDragstart:l=>((e,l)=>{e.dataTransfer.effectAllowed="copy",e.dataTransfer.setData("question",JSON.stringify(l))})(l,e)},null,8,["question","onClick","onDragstart"]))),128))]))]),_:1})]),_:1})]),j("div",fe,[k(i,{class:"rounded-xl shadow-3 full-height bg-grey-1"},{default:z(()=>[k(s,{class:"bg-white text-primary rounded-borders-top"},{default:z(()=>[j("div",ye,[j("div",_e,[k(l,{name:"edit_document",class:"q-mr-sm"}),o[22]||(o[22]=S(" Quiz Questions "))]),j("div",he,[J.value.length>0?(w(),x(a,{key:0,flat:"",round:"",dense:"",color:"negative",icon:"delete_sweep",onClick:ul},{default:z(()=>[k(t,null,{default:z(()=>o[23]||(o[23]=[S("Clear All")])),_:1})]),_:1})):Q("",!0),J.value.length>1?(w(),x(a,{key:1,flat:"",round:"",dense:"",color:"secondary",icon:"shuffle",onClick:nl},{default:z(()=>[k(t,null,{default:z(()=>o[24]||(o[24]=[S("Shuffle")])),_:1})]),_:1})):Q("",!0)])])]),_:1}),k(s,{class:U(["quiz-builder__canvas-area scroll q-pa-md",{"bg-blue-1":Ke.value}]),style:{height:"calc(100vh - 280px)"},onDrop:rl,onDragover:o[8]||(o[8]=T(e=>Ke.value=!0,["prevent"])),onDragleave:o[9]||(o[9]=e=>Ke.value=!1)},{default:z(()=>[0===J.value.length?(w(),V("div",qe,[k(l,{name:"add_circle",size:"64px",class:"q-mb-md opacity-50"}),o[25]||(o[25]=j("h5",{class:"q-my-none text-weight-bold"},"Your quiz is empty!",-1)),o[26]||(o[26]=j("p",null,"Drag questions here or click them from the pool",-1))])):(w(),x(P(I),{key:1,modelValue:J.value,"onUpdate:modelValue":o[5]||(o[5]=e=>J.value=e),"item-key":"id",class:"q-gutter-y-md",handle:".drag-handle",onStart:o[6]||(o[6]=e=>Je.value=!0),onEnd:o[7]||(o[7]=e=>Je.value=!1)},{item:z(({element:e,index:a})=>[j("div",be,[j("div",xe,[k(f,{color:"primary",rounded:"",class:"text-weight-bold shadow-1"},{default:z(()=>[S(M(a+1),1)]),_:2},1024),k(l,{name:"drag_indicator",class:"drag-handle cursor-move text-grey-5 q-mt-xs",size:"20px"})]),k(X,{question:e,class:"col","show-remove":!0,onPreview:dl,onRemove:e=>(e=>{J.value.splice(e,1)})(a)},null,8,["question","onRemove"])])]),_:1},8,["modelValue"]))]),_:1},8,["class"])]),_:1})]),j("div",we,[k(i,{class:"rounded-xl shadow-2 bg-white"},{default:z(()=>[k(s,{class:"bg-purple-1 text-purple-9"},{default:z(()=>o[27]||(o[27]=[j("div",{class:"text-h6 text-weight-bold"},"Quiz Settings",-1)])),_:1}),k(s,{class:"q-gutter-y-md"},{default:z(()=>[k(u,{modelValue:O.value.name,"onUpdate:modelValue":o[10]||(o[10]=e=>O.value.name=e),outlined:"",rounded:"",label:"Quiz Name",rules:[e=>!!e||"Required"],"bg-color":"grey-1"},{prepend:z(()=>[k(l,{name:"title",color:"purple"})]),_:1},8,["modelValue","rules"]),k(u,{modelValue:O.value.description,"onUpdate:modelValue":o[11]||(o[11]=e=>O.value.description=e),outlined:"",rounded:"",type:"textarea",label:"Description",rows:"3","bg-color":"grey-1"},null,8,["modelValue"]),j("div",ze,[j("div",ke,[k(u,{modelValue:O.value.time_limit_minutes,"onUpdate:modelValue":o[12]||(o[12]=e=>O.value.time_limit_minutes=e),modelModifiers:{number:!0},outlined:"",rounded:"",type:"number",label:"Time (min)",dense:"","bg-color":"grey-1"},null,8,["modelValue"])]),j("div",Ve,[k(p,{modelValue:O.value.status,"onUpdate:modelValue":o[13]||(o[13]=e=>O.value.status=e),outlined:"",rounded:"",dense:"",options:["draft","active","archived"],label:"Status","bg-color":"grey-1",behavior:"menu"},null,8,["modelValue"])])]),k(n),k(r,{icon:"settings",label:"Advanced Options","header-class":"text-weight-bold text-grey-8","expand-icon-class":"text-grey-6"},{default:z(()=>[k(i,null,{default:z(()=>[k(s,{class:"q-gutter-y-sm"},{default:z(()=>[k(d,{modelValue:O.value.shuffle_questions,"onUpdate:modelValue":o[14]||(o[14]=e=>O.value.shuffle_questions=e),label:"Shuffle Questions",color:"purple"},null,8,["modelValue"]),k(d,{modelValue:O.value.shuffle_options,"onUpdate:modelValue":o[15]||(o[15]=e=>O.value.shuffle_options=e),label:"Shuffle Answers",color:"purple"},null,8,["modelValue"]),k(d,{modelValue:O.value.allow_review,"onUpdate:modelValue":o[16]||(o[16]=e=>O.value.allow_review=e),label:"Allow Review",color:"purple"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),k(n),j("div",Qe,[j("div",je,[j("div",Ce,M(J.value.length),1),o[28]||(o[28]=j("div",{class:"text-caption text-grey-6"},"Questions",-1))]),j("div",Me,[j("div",Se,M(tl.value),1),o[29]||(o[29]=j("div",{class:"text-caption text-grey-6"},"Est. Time",-1))]),j("div",Te,[j("div",Ue,M(sl.value),1),o[30]||(o[30]=j("div",{class:"text-caption text-grey-6"},"Difficulty",-1))])])]),_:1})]),_:1})])])]),k(v,{modelValue:Ze.value,"onUpdate:modelValue":o[17]||(o[17]=e=>Ze.value=e),maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:z(()=>[k(i,{class:"bg-grey-1"},{default:z(()=>[k(y,{class:"bg-white text-primary shadow-1"},{default:z(()=>[N(k(a,{flat:"",round:"",dense:"",icon:"close"},null,512),[[c]]),k(_,{class:"text-weight-bold"},{default:z(()=>o[31]||(o[31]=[S("Quiz Preview")])),_:1})]),_:1}),k(s,{class:"row justify-center q-pa-lg"},{default:z(()=>[j("div",De,[k(i,{class:"rounded-xl shadow-2 q-mb-lg"},{default:z(()=>[k(s,{class:"text-center q-pa-xl"},{default:z(()=>[j("h2",Pe,M(O.value.name),1),j("p",Fe,M(O.value.description),1),j("div",He,[k(m,{icon:"quiz",color:"blue-1","text-color":"blue-9",size:"lg"},{default:z(()=>[S(M(J.value.length)+" Questions ",1)]),_:1}),O.value.time_limit_minutes?(w(),x(m,{key:0,icon:"schedule",color:"orange-1","text-color":"orange-9",size:"lg"},{default:z(()=>[S(M(O.value.time_limit_minutes)+" Minutes ",1)]),_:1})):Q("",!0)])]),_:1})]),_:1}),(w(!0),V(R,null,E(J.value,(e,a)=>(w(),V("div",{key:a,class:"q-mb-md"},[k(i,{class:"rounded-xl shadow-1"},{default:z(()=>[k(s,null,{default:z(()=>[j("div",Re,[k(f,{color:"primary",rounded:"",class:"q-mr-sm text-subtitle2"},{default:z(()=>[S("Q"+M(a+1),1)]),_:2},1024),j("div",{class:"text-h6",innerHTML:e.question_text},null,8,Ee)]),j("div",Ne,[(w(!0),V(R,null,E(e.options,e=>(w(),V("div",{key:e.id,class:U(["rounded-borders q-pa-md",e.is_correct?"bg-green-1 text-green-9 border-green":"bg-grey-1"]),style:{border:"1px solid transparent"}},[j("div",Ae,[j("div",Ie,M(e.option_text),1),e.is_correct?(w(),x(l,{key:0,name:"check_circle",color:"positive",size:"sm"})):Q("",!0)])],2))),128))])]),_:2},1024)]),_:2},1024)]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"]),k(v,{modelValue:el.value,"onUpdate:modelValue":o[18]||(o[18]=e=>el.value=e)},{default:z(()=>[k(i,{style:{"min-width":"600px"},class:"rounded-xl"},{default:z(()=>[k(s,{class:"row items-center bg-primary text-white"},{default:z(()=>[o[32]||(o[32]=j("div",{class:"text-h6"},"Question Preview",-1)),k(h),N(k(a,{icon:"close",flat:"",round:"",dense:""},null,512),[[c]])]),_:1}),ll.value?(w(),x(s,{key:0,class:"q-pa-lg"},{default:z(()=>[j("div",{class:"text-h6 q-mb-md",innerHTML:ll.value.question_text},null,8,Le),j("div",$e,[(w(!0),V(R,null,E(ll.value.options,e=>(w(),V("div",{key:e.id,class:U(["rounded-borders q-pa-md",e.is_correct?"bg-green-1 text-green-9":"bg-grey-1"])},[j("div",Oe,[j("div",Be,M(e.option_text),1),e.is_correct?(w(),x(l,{key:0,name:"check_circle",color:"positive"})):Q("",!0)])],2))),128))])]),_:1})):Q("",!0)]),_:1})]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-47a9c8f0"]]);export{Je as default};
