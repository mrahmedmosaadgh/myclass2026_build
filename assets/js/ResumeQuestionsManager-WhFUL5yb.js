import{u as e,r as l,f as a,Q as t,b as o,d as s,h as n,t as i,G as r,aS as d,e as u}from"./app-BxJhpxku.js";import{Q as c}from"./QSpace-BD6HDuXW.js";import{Q as p}from"./QSelect-DvJQhHwY.js";import{Q as m}from"./QInnerLoading-C_Ypq-tN.js";import{Q as v}from"./QTd-CdMOzIxb.js";import{Q as f}from"./QBadge-CVqhPkEU.js";import{Q as g}from"./QTable-bfrPmXFn.js";import{r as y}from"./resumeApi-D4JEP9pi.js";import{f as w,r as h,o as b,N as _,J as q,b as k,K as x,R as A,z as Q,V as C,W as F,I as V,O as z,F as j,Q as S,y as T}from"./vendor-BWKGNkNB.js";import U from"./QuestionForm-nAJuAVvM.js";import E from"./AnswerForm-Bc7EVgSh.js";import D from"./QuestionDetailsDialog-Dyi4hAjX.js";import I from"./TextToSpeechButton-Bbq_9t9l.js";import P from"./GeminiPrompt-ai2EPxU4.js";function O(){const l=e(),a=w([]),t=w(!1),o=w(null),s=w([]),n=w([]),i=h({search:"",category:"",type:"",language:""}),r=()=>(t.value=!0,o.value=null,y.getQuestions(i).then(e=>(a.value=e,e)).catch(e=>{throw o.value=e.message||"Failed to load questions",l.notify({type:"negative",message:"Failed to load questions",position:"top"}),e}).finally(()=>{t.value=!1}));return{questions:a,loading:t,error:o,categories:s,questionTypes:n,filters:i,loadQuestions:r,createQuestion:e=>y.createQuestion(e).then(e=>(a.value.unshift(e),l.notify({type:"positive",message:"Question created successfully",position:"top"}),e)).catch(e=>{var a,t;throw l.notify({type:"negative",message:(null==(t=null==(a=e.response)?void 0:a.data)?void 0:t.message)||"Failed to create question",position:"top"}),e}),updateQuestion:(e,t)=>y.updateQuestion(e,t).then(t=>{const o=a.value.findIndex(l=>l.id===e);return-1!==o&&(a.value[o]=t),l.notify({type:"positive",message:"Question updated successfully",position:"top"}),t}).catch(e=>{var a,t;throw l.notify({type:"negative",message:(null==(t=null==(a=e.response)?void 0:a.data)?void 0:t.message)||"Failed to update question",position:"top"}),e}),deleteQuestion:e=>new Promise((t,o)=>{l.dialog({title:"Confirm Delete",message:"Are you sure you want to delete this question? This action cannot be undone.",cancel:!0,persistent:!0,color:"negative"}).onOk(()=>{y.deleteQuestion(e).then(()=>{a.value=a.value.filter(l=>l.id!==e),l.notify({type:"positive",message:"Question deleted successfully",position:"top"}),t()}).catch(e=>{var a,t;l.notify({type:"negative",message:(null==(t=null==(a=e.response)?void 0:a.data)?void 0:t.message)||"Failed to delete question",position:"top"}),o(e)})}).onCancel(()=>{o(new Error("Delete cancelled"))})}),loadCategories:()=>y.getCategories().then(e=>(s.value=e,e)).catch(e=>(console.warn("Failed to load categories, using defaults"),s.value=["General","Technical","Behavioral","Experience","Education"],s.value)),loadQuestionTypes:()=>y.getQuestionTypes().then(e=>(n.value=e,e)).catch(e=>(console.warn("Failed to load question types, using defaults"),n.value=["text","textarea","select","multi-select","media","file"],n.value)),getQuestion:e=>a.value.find(l=>l.id===e)||null,clearFilters:()=>{Object.keys(i).forEach(e=>{i[e]=""})},applyFilters:()=>r()}}function M(){const l=e(),a=h({}),t=h({}),o=w(null);return{answersByQuestion:a,loadingStates:t,error:o,loadAnswers:e=>(t[e]=!0,o.value=null,y.getAnswers(e).then(l=>(a[e]=l,l)).catch(e=>{throw o.value=e.message||"Failed to load answers",l.notify({type:"negative",message:"Failed to load answers",position:"top"}),e}).finally(()=>{t[e]=!1})),createAnswer:(e,t)=>y.createAnswer(e,t).then(t=>(a[e]||(a[e]=[]),a[e].unshift(t),l.notify({type:"positive",message:"Answer created successfully",position:"top"}),t)).catch(e=>{var a,t;throw l.notify({type:"negative",message:(null==(t=null==(a=e.response)?void 0:a.data)?void 0:t.message)||"Failed to create answer",position:"top"}),e}),updateAnswer:(e,t,o)=>y.updateAnswer(e,t).then(t=>{if(a[o]){const l=a[o].findIndex(l=>l.id===e);-1!==l&&(a[o][l]=t)}return l.notify({type:"positive",message:"Answer updated successfully",position:"top"}),t}).catch(e=>{var a,t;throw l.notify({type:"negative",message:(null==(t=null==(a=e.response)?void 0:a.data)?void 0:t.message)||"Failed to update answer",position:"top"}),e}),deleteAnswer:(e,t)=>new Promise((o,s)=>{l.dialog({title:"Confirm Delete",message:"Are you sure you want to delete this answer? This action cannot be undone.",cancel:!0,persistent:!0,color:"negative"}).onOk(()=>{y.deleteAnswer(e).then(()=>{a[t]&&(a[t]=a[t].filter(l=>l.id!==e)),l.notify({type:"positive",message:"Answer deleted successfully",position:"top"}),o()}).catch(e=>{var a,t;l.notify({type:"negative",message:(null==(t=null==(a=e.response)?void 0:a.data)?void 0:t.message)||"Failed to delete answer",position:"top"}),s(e)})}).onCancel(()=>{s(new Error("Delete cancelled"))})}),uploadMedia:e=>y.uploadMedia(e).then(e=>(l.notify({type:"positive",message:"Media uploaded successfully",position:"top"}),e)).catch(e=>{var a,t;throw l.notify({type:"negative",message:(null==(t=null==(a=e.response)?void 0:a.data)?void 0:t.message)||"Failed to upload media",position:"top"}),e}),getAnswers:e=>a[e]||[],isLoading:e=>t[e]||!1,getAnswer:(e,l)=>(a[e]||[]).find(e=>e.id===l)||null,clearAnswers:e=>{delete a[e],delete t[e]},clearAllAnswers:()=>{Object.keys(a).forEach(e=>{delete a[e]}),Object.keys(t).forEach(e=>{delete t[e]})},getAnswerCount:e=>(a[e]||[]).length}}const R={class:"resume-questions-manager q-pa-md"},B={class:"row q-gutter-md items-end"},G={class:"full-width row flex-center q-gutter-sm"},L={class:"row items-center q-gutter-sm"},N={class:"col text-weight-medium"},H={class:"col-auto"},J={class:"q-gutter-xs"},K={class:"q-pa-md bg-grey-1"},W={class:"row items-center q-mb-md"},X={class:"col"},Y={class:"row items-center q-gutter-sm"},Z={class:"text-h6"},$={class:"full-width row flex-center q-gutter-sm"},ee={class:"text-body2",style:{"max-width":"300px"}},le={key:0},ae={key:1,class:"text-grey-5"},te={class:"q-gutter-xs"},oe={class:"full-height overflow-auto"},se=l({__name:"ResumeQuestionsManager",setup(e){const{questions:l,loading:y,categories:h,questionTypes:se,filters:ne,loadQuestions:ie,createQuestion:re,updateQuestion:de,deleteQuestion:ue,loadCategories:ce,loadQuestionTypes:pe,clearFilters:me,applyFilters:ve}=O(),{getAnswers:fe,isLoading:ge,loadAnswers:ye,createAnswer:we,updateAnswer:he,deleteAnswer:be}=M(),_e=w([]),qe=w(!1),ke=w(!1),xe=w(!1),Ae=w(null),Qe=w(null),Ce=w(null),Fe=w(null),Ve=w(null),ze=w(!1),je=w(""),Se=w(""),Te=w(""),Ue=[{name:"title",required:!0,label:"Question Title",align:"left",field:"title",sortable:!0,style:"width: 300px"},{name:"type",label:"Type",align:"center",field:"type",sortable:!0},{name:"category",label:"Category",align:"left",field:"category",sortable:!1},{name:"language",label:"Language",align:"center",field:"language",sortable:!0},{name:"is_required",label:"Required",align:"center",field:"is_required",sortable:!0},{name:"actions",label:"Actions",align:"center",sortable:!1,style:"width: 180px"}],Ee=[{name:"user_id",label:"User ID",align:"center",field:"user_id",sortable:!0},{name:"answer_text",label:"Answer",align:"left",field:"answer_text",sortable:!1},{name:"media_links",label:"Media",align:"center",field:"media_links",sortable:!1},{name:"status",label:"Status",align:"center",field:"status",sortable:!0},{name:"actions",label:"Actions",align:"center",sortable:!1,style:"width: 100px"}],De=(e=null)=>{Ae.value=e,qe.value=!0},Ie=(e,l=null)=>{Ce.value=e,Qe.value=l,ke.value=!0},Pe=e=>{(!!e.id?de(e.id,e):re(e)).then(()=>{var e;null==(e=Fe.value)||e.handleSaveComplete()}).catch(e=>{var l;null==(l=Fe.value)||l.handleSaveError(e)})},Oe=e=>{(!!e.id?he(e.id,e,e.question_id):we(e.question_id,e)).then(()=>{var e;null==(e=Ve.value)||e.handleSaveComplete()}).catch(e=>{var l;null==(l=Ve.value)||l.handleSaveError(e)})},Me=e=>{qe.value=!0,Ae.value=e,xe.value=!1},Re=e=>{Te.value=e},Be=e=>{ze.value=!1;const l=e.split("\n").filter(e=>e.trim());let a="",t="";for(let o of l){if(o.match(/^\d+\.\s*\*?\*?(.+)/)){a=o.replace(/^\d+\.\s*\*?\*?/,"").trim();break}if(o.includes("Question")&&o.includes(":")){a=o.split(":")[1].trim();break}}a||(a=l[0]||"AI Generated Question"),t=e,Ae.value={title:a,description:t,type:"behavioral",category:["AI Generated"],language:"en",is_required:!1},qe.value=!0},Ge=e=>{ze.value=!1,Ce.value?(Qe.value={question_id:Ce.value,answer_text:e,is_preferred:!1},ke.value=!0):console.log("Please select a question first to add an AI-generated answer")};return b(()=>{Promise.all([ie(),ce(),pe()]).catch(e=>{console.error("Failed to load initial data:",e)})}),(e,w)=>(q(),_("div",R,[k(s,{flat:"",bordered:"",class:"q-mb-md"},{default:x(()=>[k(a,{class:"row items-center q-gutter-md"},{default:x(()=>[k(t,{name:"quiz",size:"32px",color:"primary"}),w[11]||(w[11]=A("div",null,[A("div",{class:"text-h5"},"Resume Questions Manager"),A("div",{class:"text-caption"}," Manage resume questions and their answers. Expandable rows show nested answer tables. ")],-1)),k(c),k(o,{color:"secondary",icon:"auto_awesome",label:"AI Assistant",onClick:w[0]||(w[0]=e=>ze.value=!0),disable:Q(y),class:"q-mr-sm"},null,8,["disable"]),k(o,{color:"primary",icon:"add",label:"Add Question",onClick:w[1]||(w[1]=e=>De()),disable:Q(y)},null,8,["disable"])]),_:1})]),_:1}),k(s,{flat:"",bordered:"",class:"q-mb-md"},{default:x(()=>[k(a,null,{default:x(()=>[A("div",B,[k(n,{modelValue:Q(ne).search,"onUpdate:modelValue":w[2]||(w[2]=e=>Q(ne).search=e),label:"Search questions",outlined:"",dense:"",style:{"min-width":"200px"},clearable:""},{prepend:x(()=>[k(t,{name:"search"})]),_:1},8,["modelValue"]),k(p,{modelValue:Q(ne).category,"onUpdate:modelValue":w[3]||(w[3]=e=>Q(ne).category=e),options:Q(h),label:"Category",outlined:"",dense:"",clearable:"",style:{"min-width":"150px"}},null,8,["modelValue","options"]),k(p,{modelValue:Q(ne).type,"onUpdate:modelValue":w[4]||(w[4]=e=>Q(ne).type=e),options:Q(se),label:"Type",outlined:"",dense:"",clearable:"",style:{"min-width":"150px"}},null,8,["modelValue","options"]),k(o,{color:"primary",icon:"filter_list",label:"Apply Filters",onClick:Q(ve),loading:Q(y)},null,8,["onClick","loading"]),k(o,{flat:"",icon:"clear",label:"Clear",onClick:Q(me)},null,8,["onClick"])])]),_:1})]),_:1}),k(s,{flat:"",bordered:""},{default:x(()=>[k(a,{class:"q-pa-none"},{default:x(()=>[k(g,{rows:Q(l),columns:Ue,"row-key":"id",loading:Q(y),pagination:{rowsPerPage:10},flat:"",bordered:""},{loading:x(()=>[k(m,{showing:"",color:"primary"})]),"no-data":x(({message:e})=>[A("div",G,[k(t,{size:"2em",name:"sentiment_dissatisfied"}),A("span",null,C(e),1)])]),"body-cell-title":x(e=>[k(v,{props:e},{default:x(()=>[A("div",L,[A("div",N,C(e.value),1),A("div",H,[k(I,{text:e.value+(e.row.description?". "+e.row.description:""),size:"xs",round:"",flat:""},null,8,["text"])])])]),_:2},1032,["props"])]),"body-cell-category":x(e=>[k(v,{props:e},{default:x(()=>[(q(!0),_(j,null,S(e.value,e=>(q(),V(r,{key:e,size:"sm",color:"blue-grey-2","text-color":"blue-grey-8",class:"q-ma-xs"},{default:x(()=>[F(C(e),1)]),_:2},1024))),128))]),_:2},1032,["props"])]),"body-cell-type":x(e=>[k(v,{props:e},{default:x(()=>{return[k(f,{color:(l=e.value,{text:"blue",textarea:"green",select:"orange","multi-select":"purple",media:"pink",file:"teal"}[l]||"grey"),label:e.value},null,8,["color","label"])];var l}),_:2},1032,["props"])]),"body-cell-is_required":x(e=>[k(v,{props:e},{default:x(()=>[k(t,{name:e.value?"check_circle":"radio_button_unchecked",color:e.value?"positive":"grey-5",size:"sm"},null,8,["name","color"])]),_:2},1032,["props"])]),"body-cell-actions":x(e=>[k(v,{props:e},{default:x(()=>[A("div",J,[k(o,{icon:"visibility",size:"sm",flat:"",round:"",color:"info",onClick:l=>{return a=e.row,Ae.value=a,void(xe.value=!0);var a}},{default:x(()=>[k(i,null,{default:x(()=>w[12]||(w[12]=[F("View Answers & Details")])),_:1})]),_:2},1032,["onClick"]),k(o,{icon:"edit",size:"sm",flat:"",round:"",color:"primary",onClick:l=>De(e.row)},{default:x(()=>[k(i,null,{default:x(()=>w[13]||(w[13]=[F("Edit Question")])),_:1})]),_:2},1032,["onClick"]),k(o,{icon:"add_comment",size:"sm",flat:"",round:"",color:"positive",onClick:l=>Ie(e.row.id)},{default:x(()=>[k(i,null,{default:x(()=>w[14]||(w[14]=[F("Add Answer")])),_:1})]),_:2},1032,["onClick"]),k(o,{icon:"delete",size:"sm",flat:"",round:"",color:"negative",onClick:l=>{return a=e.row.id,void ue(a).catch(e=>{console.error("Failed to delete question:",e)});var a}},{default:x(()=>[k(i,null,{default:x(()=>w[15]||(w[15]=[F("Delete Question")])),_:1})]),_:2},1032,["onClick"]),k(o,{icon:_e.value.includes(e.row.id)?"expand_less":"expand_more",size:"sm",flat:"",round:"",color:"secondary",onClick:l=>(e=>{const l=e.id,a=_e.value.indexOf(l);a>-1?_e.value.splice(a,1):(_e.value.push(l),ye(l).catch(e=>{console.error("Failed to load answers:",e)}))})(e.row)},{default:x(()=>[k(i,null,{default:x(()=>[F(C(_e.value.includes(e.row.id)?"Hide":"Show")+" Answers",1)]),_:2},1024)]),_:2},1032,["icon","onClick"])])]),_:2},1032,["props"])]),expand:x(e=>[k(v,{colspan:"100%"},{default:x(()=>[A("div",K,[A("div",W,[A("div",X,[A("div",Y,[A("div",Z,"Answers for: "+C(e.row.title),1),k(I,{text:"Answers for: "+e.row.title+(e.row.description?". "+e.row.description:""),size:"sm",round:"",flat:""},null,8,["text"])])]),k(c),k(o,{color:"secondary",icon:"add",label:"Add Answer",size:"sm",onClick:l=>Ie(e.row.id)},null,8,["onClick"])]),k(g,{rows:Q(fe)(e.row.id),columns:Ee,"row-key":"id",loading:Q(ge)(e.row.id),flat:"",bordered:"",dense:"",pagination:{rowsPerPage:5}},{loading:x(()=>[k(m,{showing:"",color:"secondary"})]),"no-data":x(()=>[A("div",$,[k(t,{size:"1.5em",name:"chat_bubble_outline"}),w[16]||(w[16]=A("span",null,"No answers yet",-1))])]),"body-cell-answer_text":x(e=>[k(v,{props:e},{default:x(()=>{return[A("div",ee,C((l=e.value,a=100,l?l.length>a?l.substring(0,a)+"...":l:"")),1)];var l,a}),_:2},1032,["props"])]),"body-cell-media_links":x(e=>[k(v,{props:e},{default:x(()=>[e.value&&e.value.length>0?(q(),_("div",le,[(q(!0),_(j,null,S(e.value.slice(0,2),(e,l)=>(q(),V(r,{key:l,size:"sm",color:"blue-2","text-color":"blue-8",icon:"link",clickable:"",onClick:l=>{return a=e,void window.open(a,"_blank");var a}},{default:x(()=>[F(" Link "+C(l+1),1)]),_:2},1032,["onClick"]))),128)),e.value.length>2?(q(),V(r,{key:0,size:"sm",color:"grey-3","text-color":"grey-7"},{default:x(()=>[F(" +"+C(e.value.length-2)+" more ",1)]),_:2},1024)):z("",!0)])):(q(),_("span",ae,"No media"))]),_:2},1032,["props"])]),"body-cell-status":x(e=>[k(v,{props:e},{default:x(()=>{return[k(f,{color:(l=e.value,{draft:"grey",published:"green",review:"orange",archived:"red"}[l]||"grey"),label:e.value},null,8,["color","label"])];var l}),_:2},1032,["props"])]),"body-cell-actions":x(e=>[k(v,{props:e},{default:x(()=>[A("div",te,[k(o,{icon:"edit",size:"sm",flat:"",round:"",color:"primary",onClick:l=>Ie(e.row.question_id,e.row)},{default:x(()=>[k(i,null,{default:x(()=>w[17]||(w[17]=[F("Edit Answer")])),_:1})]),_:2},1032,["onClick"]),k(o,{icon:"delete",size:"sm",flat:"",round:"",color:"negative",onClick:l=>{return a=e.row.id,t=e.row.question_id,void be(a,t).catch(e=>{console.error("Failed to delete answer:",e)});var a,t}},{default:x(()=>[k(i,null,{default:x(()=>w[18]||(w[18]=[F("Delete Answer")])),_:1})]),_:2},1032,["onClick"])])]),_:2},1032,["props"])]),_:2},1032,["rows","loading"])])]),_:2},1024)]),_:1},8,["rows","loading"])]),_:1})]),_:1}),k(U,{modelValue:qe.value,"onUpdate:modelValue":w[5]||(w[5]=e=>qe.value=e),question:Ae.value,categories:Q(h),"question-types":Q(se),onSave:Pe,ref_key:"questionFormRef",ref:Fe},null,8,["modelValue","question","categories","question-types"]),k(E,{modelValue:ke.value,"onUpdate:modelValue":w[6]||(w[6]=e=>ke.value=e),answer:Qe.value,"question-id":Ce.value,onSave:Oe,ref_key:"answerFormRef",ref:Ve},null,8,["modelValue","answer","question-id"]),k(D,{modelValue:xe.value,"onUpdate:modelValue":w[7]||(w[7]=e=>xe.value=e),question:Ae.value,onQuestionUpdated:Me},null,8,["modelValue","question"]),k(u,{modelValue:ze.value,"onUpdate:modelValue":w[10]||(w[10]=e=>ze.value=e),maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:x(()=>[k(s,{class:"full-height"},{default:x(()=>[k(a,{class:"row items-center q-pb-none"},{default:x(()=>[w[19]||(w[19]=A("div",{class:"text-h6"},"AI Assistant",-1)),k(c),T(k(o,{icon:"close",flat:"",round:"",dense:""},null,512),[[d]])]),_:1}),k(a,{class:"q-pt-none full-height"},{default:x(()=>[A("div",oe,[k(P,{modelValue:je.value,"onUpdate:modelValue":w[8]||(w[8]=e=>je.value=e),extra:Se.value,"onUpdate:extra":w[9]||(w[9]=e=>Se.value=e),onResponse:Re,onUseAsQuestion:Be,onUseAsAnswer:Ge},null,8,["modelValue","extra"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-db4376c9"]]),ne=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"}));export{se as R,M as a,ne as b,O as u};
