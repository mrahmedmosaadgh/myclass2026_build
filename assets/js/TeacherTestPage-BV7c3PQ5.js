import{o as e,u as a,c as s,h as t,i as l,j as o,f as i,n,Q as u,m as r,d as c,g as d,A as v,s as p,z as m,t as _,v as f}from"./app-BB4Fw2oM.js";import{Q as g}from"./QSelect-BImwntZk.js";import{Q as y}from"./QBadge-BkpTfeZ_.js";import{f as b,o as h,e as w,M as q,J as S,b as x,N as z,z as k,a4 as V,K as j,ag as C,ah as F,W as Q,V as A,I as T,Q as I,U as N,F as U,R as M,_ as $}from"./vendor-DuKqz2x4.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";import"./rtl-Cr6c3OOr.js";const L={class:"teacher-test-page"},P={key:0,class:"session-setup"},E={class:"question-selector"},G={class:"session-settings"},J={key:1,class:"session-control"},O={class:"access-code"},H={class:"row items-center q-gutter-sm"},R={class:"control-buttons-grid"},B=e({__name:"TeacherTestPage",setup(e){const B=a(),D=b(null),K=b(null),W=b({questions:[]}),X=b([]),Y=b(!1),Z=b(0),ee=b(null),ae=b({timer:60,auto_submit:!0,show_correct_answer:!1});let se=null;const te=async()=>{try{const e=await $.get("/api/questions");W.value=e.data.data||e.data}catch(e){console.error("Failed to load questions:",e),B.notify({type:"negative",message:"Failed to load questions"})}},le=(e,a)=>{a(()=>{""===e?te():e.toLowerCase()})},oe=async()=>{Y.value=!0;try{const e=await $.post("/api/quiz-sessions",{settings:ae.value});D.value=e.data.session;const a=p(_,`quiz_sessions/${D.value.access_code}`);await m(a,{status:"waiting",current_question_id:null,participants:{}}),ie(),B.notify({type:"positive",message:"Session created successfully"})}catch(e){console.error("Failed to create session:",e),B.notify({type:"negative",message:"Failed to create session"})}finally{Y.value=!1}},ie=()=>{console.log("Setting up Firebase listeners for code:",D.value.access_code);const e=p(_,`quiz_sessions/${D.value.access_code}/participants`);se=f(e,e=>{const a=e.val();console.log("Firebase participants update:",a),a?(X.value=Object.values(a),console.log("Participants array:",X.value)):X.value=[]})},ne=async()=>{var e;if(K.value)try{await $.post(`/api/quiz-sessions/${D.value.id}/state`,{action:"start",question_id:K.value.id});const a=p(_,`quiz_sessions/${D.value.access_code}`),s=JSON.parse(JSON.stringify(K.value));await m(a,{status:"active",current_question_id:K.value.id,current_question:s}),D.value.status="active",ae.value.timer&&(e=ae.value.timer,Z.value=e,ee.value&&clearInterval(ee.value),ee.value=setInterval(()=>{Z.value--,Z.value<=0&&clearInterval(ee.value)},1e3)),B.notify({type:"positive",message:"Session started"})}catch(a){console.error("Failed to start session:",a)}},ue=async()=>{try{await $.post(`/api/quiz-sessions/${D.value.id}/state`,{action:"pause"}),ee.value&&clearInterval(ee.value),B.notify({type:"info",message:"Session paused"})}catch(e){console.error("Failed to pause session:",e)}},re=async()=>{try{await $.post(`/api/quiz-sessions/${D.value.id}/state`,{action:"end"}),D.value.status="completed",ee.value&&clearInterval(ee.value),B.notify({type:"positive",message:"Session ended"})}catch(e){console.error("Failed to end session:",e)}};return h(()=>{te()}),w(()=>{se&&se(),ee.value&&clearInterval(ee.value)}),(e,a)=>(S(),q(U,null,[x(k(V),{title:"Live Quiz - Teacher Control"}),z("div",L,[a[10]||(a[10]=z("div",{class:"page-header"},[z("h1",null,"Live Quiz Session"),z("p",null,"Create and control a live quiz session for your students")],-1)),D.value?(S(),q("div",J,[x(r,{class:"access-code-card"},{default:j(()=>[x(s,{class:"text-center"},{default:j(()=>[a[7]||(a[7]=z("h2",null,"Access Code",-1)),z("div",O,A(D.value.access_code),1),a[8]||(a[8]=z("p",null,[Q(" Students can join at: "),z("strong",null,"/quiz/live/join")],-1))]),_:1})]),_:1}),"active"===D.value.status?(S(),T(r,{key:0,class:"timer-card q-mb-md"},{default:j(()=>[x(s,{class:"text-center"},{default:j(()=>[z("div",{class:N(["text-h4 text-weight-bold",{"text-negative":Z.value<=10,"text-primary":Z.value>10}])},[x(c,{name:"timer"}),Q(" "+A(Z.value)+"s ",1)],2)]),_:1})]),_:1})):I("",!0),x(r,{class:"participants-card"},{default:j(()=>[x(s,null,{default:j(()=>[z("h3",null,"Participants ("+A(X.value.length)+")",1),x(d,{separator:""},{default:j(()=>[(S(!0),q(U,null,M(X.value,e=>(S(),T(t,{key:e.id},{default:j(()=>[x(l,{avatar:""},{default:j(()=>[x(v,{color:"primary","text-color":"white"},{default:j(()=>{var a,s;return[Q(A((null==(s=null==(a=e.student)?void 0:a.name)?void 0:s.charAt(0))||"?"),1)]}),_:2},1024)]),_:2},1024),x(l,null,{default:j(()=>[x(o,null,{default:j(()=>{var a;return[Q(A((null==(a=e.student)?void 0:a.name)||"Unknown"),1)]}),_:2},1024),x(o,{caption:""},{default:j(()=>[Q("Score: "+A(e.score),1)]),_:2},1024)]),_:2},1024),x(l,{side:""},{default:j(()=>{var a;return[z("div",H,[e.last_answered_question_id===(null==(a=D.value)?void 0:a.current_question_id)?(S(),T(y,{key:0,color:"positive",label:"Answered"},{default:j(()=>[x(c,{name:"check",color:"white",class:"q-ml-xs"})]),_:1})):(S(),T(y,{key:1,color:"warning","text-color":"black",label:"Thinking..."},{default:j(()=>[x(c,{name:"more_horiz",class:"q-ml-xs"})]),_:1})),x(y,{color:"active"===e.status?"primary":"grey",outline:""},{default:j(()=>[Q(A(e.status),1)]),_:2},1032,["color"])])]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),x(r,{class:"controls-card bounce-in"},{default:j(()=>[x(s,null,{default:j(()=>[a[9]||(a[9]=z("h3",{class:"text-center text-primary text-weight-bold q-mb-lg"},"ðŸŽ® Game Controls",-1)),z("div",R,["waiting"===D.value.status?(S(),T(u,{key:0,push:"",color:"positive",label:"START GAME! ðŸš€",onClick:ne,size:"xl",class:"game-btn start-btn"})):I("",!0),"active"===D.value.status?(S(),T(u,{key:1,push:"",color:"warning","text-color":"black",label:"PAUSE â¸ï¸",onClick:ue,size:"lg",class:"game-btn pause-btn"})):I("",!0),x(u,{push:"",color:"negative",label:"END GAME ðŸ›‘",onClick:re,size:"lg",class:"game-btn end-btn"})])]),_:1})]),_:1})])):(S(),q("div",P,[x(r,{class:"setup-card"},{default:j(()=>[x(s,null,{default:j(()=>{var e;return[a[6]||(a[6]=z("h2",null,"Create New Session",-1)),z("div",E,[x(g,{modelValue:K.value,"onUpdate:modelValue":a[0]||(a[0]=e=>K.value=e),options:(null==(e=W.value)?void 0:e.questions)||[],"option-label":"question_text","option-value":"id",label:"Select a Question",outlined:"","use-input":"",onFilter:le},{"no-option":j(()=>[x(t,null,{default:j(()=>[x(l,{class:"text-grey"},{default:j(()=>a[4]||(a[4]=[Q(" No questions found ")])),_:1})]),_:1})]),option:j(e=>[x(t,C(F(e.itemProps)),{default:j(()=>[x(l,null,{default:j(()=>[x(o,{innerHTML:e.opt.question_text},null,8,["innerHTML"]),x(o,{caption:""},{default:j(()=>{var a;return[Q(A((null==(a=e.opt.options)?void 0:a.length)||0)+" options ",1)]}),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])]),z("div",G,[a[5]||(a[5]=z("h3",null,"Session Settings",-1)),x(i,{modelValue:ae.value.timer,"onUpdate:modelValue":a[1]||(a[1]=e=>ae.value.timer=e),modelModifiers:{number:!0},type:"number",label:"Timer (seconds)",outlined:"",min:"10"},null,8,["modelValue"]),x(n,{modelValue:ae.value.auto_submit,"onUpdate:modelValue":a[2]||(a[2]=e=>ae.value.auto_submit=e),label:"Auto-submit when timer ends"},null,8,["modelValue"]),x(n,{modelValue:ae.value.show_correct_answer,"onUpdate:modelValue":a[3]||(a[3]=e=>ae.value.show_correct_answer=e),label:"Show correct answer after submission"},null,8,["modelValue"])]),x(u,{color:"primary",label:"Create Session",onClick:oe,loading:Y.value,disable:!K.value,size:"lg",class:"full-width"},null,8,["loading","disable"])]}),_:1})]),_:1})]))])],64))}},[["__scopeId","data-v-206f255c"]]);export{B as default};
