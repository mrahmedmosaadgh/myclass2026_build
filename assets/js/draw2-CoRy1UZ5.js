import{d as e,f as t,o as a,e as l,L as o,I as n,M as i,O as r,S as s,V as u,x as c,U as d,R as v,F as p,Q as g,ab as h}from"./vendor-EI0FRBVb.js";import{p as x}from"./app-DXXarK7I.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./ui-B__oX9pK.js";const f={class:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 p-4"},b={class:"max-w-5xl mx-auto"},w={class:"bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl p-6 mb-8 border border-white/30"},m={class:"flex flex-wrap gap-4 justify-center items-center text-sm"},y={class:"flex rounded-xl overflow-hidden shadow-lg"},k={class:"flex items-center gap-6"},R={class:"flex items-center gap-3"},C={class:"font-bold text-lg w-12 text-right"},P={class:"flex gap-3"},j=["disabled"],L={class:"flex gap-3"},I={class:"bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-xl shadow-lg cursor-pointer transition"},B={class:"bg-white/90 backdrop-blur-xl rounded-3xl shadow-2xl overflow-hidden border border-white/40"},O={key:0,class:"mt-8 bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl p-8 border border-white/30"},S=["title"],A={class:"absolute -top-10 left-1/2 -translate-x-1/2 bg-yellow-500 text-white text-xs font-bold px-3 py-1 rounded-full whitespace-nowrap"},U={class:"absolute inset-0 flex items-center justify-center text-white text-xl font-bold"},F={class:"flex justify-center gap-6 mt-8"},M=["disabled"],T={class:"text-center mt-6 text-gray-600 text-lg"},D=x(e({__name:"draw2",setup(e){const x=t(null);let D=null;const E=t("pen"),N=t("#8B5CF6"),z=t(6),J=t(!1),V=t(!1),_=t(!1),q=t(0),W=t(null),G=t([]),H=t([]),X=t([]),$=t(-1);let Q=null,Y=0,K=0;function Z(){if(!x.value||!D)return;const e=x.value.getBoundingClientRect();x.value.width=e.width*devicePixelRatio,x.value.height=e.height*devicePixelRatio,D.scale(devicePixelRatio,devicePixelRatio),ue()}function ee(e){if(!x.value)return{x:0,y:0};const t=x.value.getBoundingClientRect();return{x:(e.clientX-t.left)*devicePixelRatio,y:(e.clientY-t.top)*devicePixelRatio}}function te(e){if(V.value||!D)return;J.value=!0;const t=ee(e);H.value.push({tool:E.value,color:"pen"===E.value?N.value:null,width:z.value,path:[t]}),D.beginPath(),D.moveTo(t.x/devicePixelRatio,t.y/devicePixelRatio),oe()}function ae(e){if(!J.value||!D||!H.value.length)return;const t=ee(e);H.value[H.value.length-1].path.push(t),D.lineTo(t.x/devicePixelRatio,t.y/devicePixelRatio),D.stroke()}function le(){J.value&&(J.value=!1,ne())}function oe(e){if(!D)return;const t=e||{tool:E.value,color:N.value,width:z.value};"eraser"===t.tool?(D.globalCompositeOperation="destination-out",D.lineWidth=t.width):(D.globalCompositeOperation="source-over",D.strokeStyle=t.color,D.lineWidth=t.width)}function ne(){if(!D||!x.value)return;const e=D.getImageData(0,0,x.value.width,x.value.height);X.value=X.value.slice(0,$.value+1),X.value.push(e),$.value=X.value.length-1}function ie(){$.value<=0||($.value--,D&&x.value&&D.putImageData(X.value[$.value],0,0))}function re(){D&&x.value&&(D.clearRect(0,0,x.value.width,x.value.height),H.value=[],G.value=[],W.value=null,X.value=[],$.value=-1,ne())}function se(){W.value=null,ue()}function ue(){if(D&&x.value){if(D.clearRect(0,0,x.value.width,x.value.height),D.globalCompositeOperation="source-over",W.value){const e=new Image;return e.onload=()=>{D.drawImage(e,0,0,x.value.width/devicePixelRatio,x.value.height/devicePixelRatio),ce()},void(e.src=W.value)}ce()}}function ce(){D&&H.value.forEach(e=>{if(!(e.path.length<2)){D.beginPath(),D.moveTo(e.path[0].x/devicePixelRatio,e.path[0].y/devicePixelRatio),oe(e);for(let t=1;t<e.path.length;t++)D.lineTo(e.path[t].x/devicePixelRatio,e.path[t].y/devicePixelRatio);D.stroke()}})}function de(){if(0===H.value.length)return;let e=0;for(const l of H.value)e+=l.path.length;let t=0;for(let l=0;l<H.value.length-1;l++)t+=H.value[l].path.length;t+=H.value[H.value.length-1].path.length;const a=e>0?t/e:0;G.value.push({globalIndex:t,progress:a}),G.value.sort((e,t)=>e.progress-t.progress)}async function ve(){if(0===H.value.length||!D||!x.value)return;if(V.value=!0,_.value=!1,q.value=0,Y=0,K=0,Q=null,D.clearRect(0,0,x.value.width,x.value.height),D.globalCompositeOperation="source-over",W.value){const e=new Image;e.src=W.value,await new Promise(t=>e.onload=t),D.drawImage(e,0,0,x.value.width/devicePixelRatio,x.value.height/devicePixelRatio)}const e=H.value.reduce((e,t)=>e+t.path.length,0);if(0===e)return;const t=()=>{if(!V.value||_.value)return void(Q=requestAnimationFrame(t));if(Y>=e)return void(V.value=!1);let a=0,l=-1,o=-1;for(let e=0;e<H.value.length;e++){const t=H.value[e];if(Y<a+t.path.length){l=e,o=Y-a;break}a+=t.path.length}if(-1!==l&&-1!==o){const e=H.value[l],t=e.path[o];0===o?(D.beginPath(),D.moveTo(t.x/devicePixelRatio,t.y/devicePixelRatio)):D.lineTo(t.x/devicePixelRatio,t.y/devicePixelRatio),oe(e),D.stroke()}for(Y++,q.value=Y/e*100;K<G.value.length;){const e=G.value[K];if(Y>=e.globalIndex){_.value=!0,K++;break}break}Q=requestAnimationFrame(t)};Q=requestAnimationFrame(t)}function pe(){_.value=!1}function ge(){V.value=!1,_.value=!1,Q&&cancelAnimationFrame(Q),Y=0,ue()}function he(){if(K>=G.value.length)return;const e=G.value[K];Y=e.globalIndex,q.value=100*e.progress,ge(),ue(),K++,ve()}function xe(e){const t=e.currentTarget.getBoundingClientRect(),a=Math.max(0,Math.min(1,(e.clientX-t.left)/t.width)),l=H.value.reduce((e,t)=>e+t.path.length,0);Y=Math.round(a*l),q.value=100*a}function fe(e){const t=new Image;t.onload=()=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;e.getContext("2d").drawImage(t,0,0),W.value=e.toDataURL("image/png"),ue()},t.onerror=()=>alert("Failed to load pasted image"),t.src=e}async function be(){try{const e=await navigator.clipboard.read();for(const t of e){const e=t.types.find(e=>e.startsWith("image/"));if(e){const a=await t.getType(e);return void fe(URL.createObjectURL(a))}}alert("No image in clipboard")}catch(e){alert("Clipboard access denied or no image")}}function we(e){var t;if(V.value)return;const a=null==(t=e.clipboardData)?void 0:t.items;if(a)for(const l of a)if(l.type.startsWith("image/")){e.preventDefault();const t=l.getAsFile();return void(t&&fe(URL.createObjectURL(t)))}}function me(){const e={version:6,background:W.value,strokes:H.value,breakpoints:G.value,createdAt:(new Date).toISOString()},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.download=`magic-canvas-${(new Date).toISOString().slice(0,10)}.json`,l.click(),URL.revokeObjectURL(a)}function ye(e){var t;const a=null==(t=e.target.files)?void 0:t[0];if(!a)return;const l=new FileReader;l.onload=()=>{try{const e=JSON.parse(l.result);W.value=e.background||null,H.value=e.strokes||[],G.value=e.breakpoints||[],ue(),ne()}catch(e){alert("Invalid file!")}},l.readAsText(a)}return a(()=>{!function(){if(!x.value)return;if(D=x.value.getContext("2d",{willReadFrequently:!0}),!D)return;D.lineCap="round",D.lineJoin="round",Z(),ne()}(),window.addEventListener("resize",Z),window.addEventListener("paste",we)}),l(()=>{window.removeEventListener("resize",Z),window.removeEventListener("paste",we),Q&&cancelAnimationFrame(Q)}),(e,t)=>(n(),o("div",f,[i("div",b,[t[10]||(t[10]=i("h1",{class:"text-center text-5xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2"}," Magic Canvas ",-1)),t[11]||(t[11]=i("p",{class:"text-center text-gray-600 mb-8"},"Draw • Breakpoints • Cinematic Replay • Paste Background",-1)),i("div",w,[i("div",m,[i("div",y,[i("button",{onClick:t[0]||(t[0]=e=>E.value="pen"),class:s(["pen"===E.value?"bg-gradient-to-r from-purple-500 to-pink-500 text-white":"bg-gray-100 text-gray-700","flex items-center gap-2 px-6 py-4 font-medium transition"])},t[4]||(t[4]=[i("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})],-1),u(" Pen ")]),2),i("button",{onClick:t[1]||(t[1]=e=>E.value="eraser"),class:s(["eraser"===E.value?"bg-gradient-to-r from-red-500 to-orange-500 text-white":"bg-gray-100 text-gray-700","flex items-center gap-2 px-6 py-4 font-medium transition"])},t[5]||(t[5]=[i("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"}),i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 7v4m0 4v.01"})],-1),u(" Eraser ")]),2)]),i("div",k,[c(i("input",{type:"color","onUpdate:modelValue":t[2]||(t[2]=e=>N.value=e),class:"w-14 h-14 rounded-full cursor-pointer shadow-xl hover:scale-110 transition"},null,512),[[h,N.value]]),i("div",R,[c(i("input",{type:"range","onUpdate:modelValue":t[3]||(t[3]=e=>z.value=e),min:"1",max:"50",class:"w-40 accent-purple-600"},null,512),[[h,z.value,void 0,{number:!0}]]),i("span",C,d(z.value),1)])]),!V.value&&H.value.length>0&&!J.value?(n(),o("button",{key:0,onClick:de,class:"bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-3 rounded-xl shadow-lg transition flex items-center gap-2"},t[6]||(t[6]=[i("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},[i("circle",{cx:"12",cy:"12",r:"8"})],-1),u(" Add Breakpoint ")]))):r("",!0),i("div",P,[i("button",{onClick:re,class:"bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-xl shadow-lg transition"},"Clear All"),i("button",{onClick:ie,disabled:$.value<=0,class:"bg-gray-600 hover:bg-gray-700 disabled:opacity-40 text-white px-6 py-3 rounded-xl shadow-lg transition"},"Undo",8,j)]),i("div",L,[i("button",{onClick:be,class:"bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white px-6 py-3 rounded-xl shadow-lg transition flex items-center gap-2"}," Paste BG "),W.value?(n(),o("button",{key:0,onClick:se,class:"bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-xl shadow-lg transition"}," Remove BG ")):r("",!0),i("button",{onClick:me,class:"bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl shadow-lg transition"},"Save JSON"),i("label",I,[t[7]||(t[7]=u(" Load JSON ")),i("input",{type:"file",onChange:ye,accept:".json",class:"hidden"},null,32)])])])]),i("div",B,[i("canvas",{ref_key:"canvas",ref:x,onPointerdown:te,onPointermove:ae,onPointerup:le,onPointerleave:le,onPointercancel:le,class:s(["w-full block touch-none","eraser"===E.value?"cursor-eraser":"cursor-crosshair"]),style:{height:"calc(100vh - 380px)","min-height":"500px"}},null,34)]),H.value.length>0?(n(),o("div",O,[t[9]||(t[9]=i("h3",{class:"text-center text-2xl font-bold mb-6 text-purple-700"},"Cinematic Replay",-1)),i("div",{class:"relative h-14 bg-gray-800 rounded-full overflow-hidden cursor-pointer shadow-inner",onClick:xe},[i("div",{class:"absolute inset-0 bg-gradient-to-r from-cyan-500 to-purple-600 transition-all duration-300 ease-out",style:v({width:q.value+"%"})},null,4),(n(!0),o(p,null,g(G.value,(e,t)=>(n(),o("div",{key:t,class:"absolute top-0 bottom-0 w-2 bg-yellow-400 shadow-lg transform -translate-x-1/2",style:v({left:100*e.progress+"%"}),title:`Breakpoint ${t+1}`},[i("div",A,d(t+1),1)],12,S))),128)),i("div",U,d(Math.round(q.value))+"% ",1)]),i("div",F,[i("button",{onClick:ve,disabled:V.value,class:"bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white px-10 py-5 rounded-2xl shadow-2xl text-2xl font-bold transition flex items-center gap-4 disabled:opacity-50"},[t[8]||(t[8]=i("svg",{class:"w-10 h-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.752 11.168l-6.718-3.873A1 1 0 007 8.135v7.73a1 1 0 001.034.968l6.718-3.873a1 1 0 000-1.792z"})],-1)),u(" "+d(V.value&&!_.value?"Playing...":"Start Replay"),1)],8,M),_.value?(n(),o("button",{key:0,onClick:pe,class:"bg-green-500 hover:bg-green-600 text-white px-10 py-5 rounded-2xl shadow-2xl text-2xl font-bold transition"}," Continue ")):r("",!0),V.value?(n(),o("button",{key:1,onClick:ge,class:"bg-red-500 hover:bg-red-600 text-white px-10 py-5 rounded-2xl shadow-2xl text-2xl font-bold transition"}," Stop ")):r("",!0),_.value&&G.value.length>0?(n(),o("button",{key:2,onClick:he,class:"bg-purple-500 hover:bg-purple-600 text-white px-8 py-5 rounded-2xl shadow-2xl text-lg font-bold transition"}," Skip Next → ")):r("",!0)]),i("p",T,d(G.value.length)+" breakpoint"+d(1!==G.value.length?"s":"")+" • Auto-pauses at markers • Click bar to seek ",1)])):r("",!0),t[12]||(t[12]=i("div",{class:"text-center mt-6 text-sm text-gray-500"}," Copy image → Ctrl+V to paste as background • Add breakpoints after sections for epic pauses! ",-1))])]))}}),[["__scopeId","data-v-7cb0900a"]]);export{D as default};
