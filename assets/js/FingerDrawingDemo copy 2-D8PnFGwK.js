import{o as e}from"./app-B9g134Ig.js";import{f as t,a as n,o,N as l,J as a,O as i,W as s,y as u,ac as c,a0 as r}from"./vendor-nQjeLEvd.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";const d={class:"pad"},p={class:"toolbar"},v=["disabled"],f=["disabled"],h=["disabled"],g=["disabled"],m={class:"canvas-wrapper"},y=800,x=500,b=e({__name:"FingerDrawingDemo copy 2",emits:["export-json"],setup(e,{emit:b}){const w=t(null);let C=null;const T=t([]),k=t([]);let j=null,_=!1;const R=t(!1),z=t("#111111"),I=t(3);let M=null,P=null,U=null,q=null;const F=b;function J(){C.clearRect(0,0,y,x),M?C.drawImage(M,0,0,U,q):P&&(C.font="16px sans-serif",C.fillStyle="#888",C.fillText(P,20,40));for(const e of T.value)S(e);j&&S(j)}function O(e){const t=w.value.getBoundingClientRect();return e.touches&&e.touches[0]?{x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}:{x:e.clientX-t.left,y:e.clientY-t.top}}function S(e){const t=e.points;if(!(t.length<2)){C.strokeStyle=e.color,C.lineWidth=e.size,C.beginPath(),C.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length-1;e++){const n=(t[e].x+t[e+1].x)/2,o=(t[e].y+t[e+1].y)/2;C.quadraticCurveTo(t[e].x,t[e].y,n,o)}C.lineTo(t[t.length-1].x,t[t.length-1].y),C.stroke()}}function W(e){_=!0;const t=O(e);j={points:[{x:t.x,y:t.y,t:0}],color:z.value,size:I.value,_startTime:performance.now()}}function A(e){if(!_||!j)return;const t=O(e),n=performance.now()-j._startTime;j.points.push({x:t.x,y:t.y,t:n}),J()}function B(){_&&(_=!1,j&&(delete j._startTime,T.value.push(j),k.value=[]),j=null,J())}function D(){T.value.length>0&&(k.value.push(T.value.pop()),J())}function L(){k.value.length>0&&(T.value.push(k.value.pop()),J())}function N(){T.value=[],k.value=[],J()}const X=n(()=>T.value.length>0),Y=n(()=>k.value.length>0);function E(){if(R.value||0===T.value.length)return;R.value=!0;let e=0,t=performance.now();requestAnimationFrame(function n(o){J();for(let t=0;t<e;t++)S(T.value[t]);if(e>=T.value.length)return void(R.value=!1);const l=T.value[e],a=o-t,i=l.points,s=i[i.length-1].t,u=i.findIndex(e=>e.t>a),c=-1===u?i.length:u;S({...l,points:i.slice(0,c)}),a>=s&&(e++,t=o),requestAnimationFrame(n)})}async function V(){try{const e=await navigator.clipboard.read();for(const n of e)for(const e of n.types)if(e.startsWith("image/")){const t=await n.getType(e),o=new Image;return o.onload=()=>{M=o,U=o.width,q=o.height,P=null,J()},void(o.src=URL.createObjectURL(t))}const t=await navigator.clipboard.readText();t&&(P=t,M=null,J())}catch(e){console.error("Clipboard paste failed:",e)}}function G(){const e={version:1,width:y,height:x,strokes:T.value.map(e=>({points:e.points,color:e.color,size:e.size}))};F("export-json",e)}return o(()=>{!function(){const e=w.value,t=window.devicePixelRatio||1;e.width=y*t,e.height=x*t,e.style.width=y+"px",e.style.height=x+"px",C=e.getContext("2d"),C.scale(t,t),C.lineCap="round",C.lineJoin="round",J()}()}),(e,t)=>(a(),l("div",d,[i("div",p,[i("label",null,[t[1]||(t[1]=s(" Pen Color: ")),u(i("input",{type:"color","onUpdate:modelValue":t[0]||(t[0]=e=>z.value=e)},null,512),[[c,z.value]])]),i("button",{onClick:D,disabled:!X.value},"Undo",8,v),i("button",{onClick:L,disabled:!Y.value},"Redo",8,f),i("button",{onClick:N},"Clear"),i("button",{onClick:E,disabled:R.value||0===T.value.length},"Replay",8,h),i("button",{onClick:G,disabled:0===T.value.length},"Export JSON",8,g),i("button",{onClick:V},"Paste Background")]),i("div",m,[i("canvas",{ref_key:"canvas",ref:w,class:"canvas",onMousedown:W,onMousemove:A,onMouseup:B,onMouseleave:B,onTouchstart:r(W,["prevent"]),onTouchmove:r(A,["prevent"]),onTouchend:r(B,["prevent"])},null,544)])]))}},[["__scopeId","data-v-b5d8efed"]]);export{b as default};
