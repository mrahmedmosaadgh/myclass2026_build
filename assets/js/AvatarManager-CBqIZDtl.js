import{o as e,u as a,A as t,d as o,m as s,c as l,l as r,Q as n,b as i,aP as d}from"./app-BwCflFkV.js";import{f as u,a as p,L as v,I as c,M as m,b as f,O as g,J as b,$ as h,S as w,x as y,Z as x}from"./vendor-CUZ9QTQV.js";import C from"./CameraCapture-DrqVWxi5.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";const _=["src"],j={key:0,class:"absolute bottom-0 right-0 flex gap-1 z-20 pointer-events-auto"},A=e({__name:"AvatarManager",props:{student:{type:Object,required:!0},size:{type:String,default:"80px"},editEnabled:{type:Boolean,default:!1}},emits:["update:avatar"],setup(e,{emit:A}){const z=e,k=A,S=a(),M=u(!1),U=u(!1),$=u(null),O=p(()=>$.value||z.student.avatar),E=p(()=>""),F=p(()=>{const e=(z.student.name||"Student").split(" ").map(e=>e[0]||"").slice(0,2).join("").toUpperCase();return`data:image/svg+xml,${encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 96 96">\n    <rect width="96" height="96" fill="#e2e8f0" rx="48" ry="48"/>\n    <text x="48" y="48" dy="8" text-anchor="middle" font-family="Comic Sans MS, Arial" font-size="32" font-weight="bold" fill="#475569">${e}</text>\n  </svg>`)}`});function I(){S.dialog({title:"Remove Avatar",message:"Are you sure you want to remove this photo?",cancel:!0,persistent:!0}).onOk(()=>{!async function(){try{await x.delete(`/api/students/${z.student.id}/avatar`),$.value=null,z.student.avatar=null,k("update:avatar",null),S.notify({message:"Avatar removed",color:"positive",position:"top"})}catch(e){console.error("Failed to remove avatar",e),S.notify({message:"Failed to remove avatar",color:"negative",position:"top"})}}()})}async function V({dataUrl:e}){try{const a=await fetch(e),t=await a.blob(),o=new FormData;o.append("avatar",t,"avatar.png"),o.append("student_id",z.student.id);const s=await x.post(`/api/students/${z.student.id}/avatar`,o,{headers:{"Content-Type":"multipart/form-data"}});$.value=s.data.avatar||s.data.url||e,k("update:avatar",$.value),U.value=!1,S.notify({message:"Awesome new photo! ðŸŒŸ",color:"positive",icon:"star",position:"top"})}catch(a){console.error("Avatar upload failed",a),S.notify({message:"Oops! Could not save photo.",color:"negative",position:"top"})}}return(a,u)=>(c(),v("div",{class:"avatar-manager relative inline-block",onMouseenter:u[2]||(u[2]=e=>M.value=!0),onMouseleave:u[3]||(u[3]=e=>M.value=!1)},[m("div",{class:w(["avatar-container relative rounded-full border-4 transition-all duration-300 transform pointer-events-none",[E.value,M.value?"scale-105 shadow-xl border-yellow-400":"shadow-lg border-blue-300",(e.editEnabled,"")]])},[f(t,{size:e.size,class:"bg-gray-200"},{default:b(()=>[m("img",{src:O.value||F.value,class:"object-cover w-full h-full rounded-full",alt:"Student Avatar"},null,8,_)]),_:1},8,["size"]),e.editEnabled&&M.value?(c(),v("div",j,[O.value?(c(),v("div",{key:0,class:"bg-red-500 text-white rounded-full p-1.5 shadow-lg border-2 border-white cursor-pointer hover:bg-red-600 transition-colors",onClick:h(I,["stop"])},[f(o,{name:"delete",size:"xs"})])):g("",!0),m("div",{class:"bg-blue-600 text-white rounded-full p-1.5 shadow-lg border-2 border-white cursor-pointer hover:bg-blue-700 transition-colors",onClick:u[0]||(u[0]=h(e=>U.value=!0,["stop"]))},[f(o,{name:"edit",size:"xs"})])])):g("",!0)],2),f(i,{modelValue:U.value,"onUpdate:modelValue":u[1]||(u[1]=e=>U.value=e)},{default:b(()=>[f(s,{style:{"min-width":"500px"},class:"rounded-2xl overflow-hidden"},{default:b(()=>[f(l,{class:"bg-blue-500 text-white p-4"},{default:b(()=>u[4]||(u[4]=[m("div",{class:"text-h6 font-bold"},"ðŸ“¸ Update Photo",-1)])),_:1}),f(l,{class:"p-0"},{default:b(()=>[f(C,{onCaptured:V})]),_:1}),f(r,{align:"right",class:"bg-gray-100"},{default:b(()=>[y(f(n,{flat:"",label:"Cancel",color:"grey"},null,512),[[d]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],32))}},[["__scopeId","data-v-bc142b26"]]);export{A as default};
