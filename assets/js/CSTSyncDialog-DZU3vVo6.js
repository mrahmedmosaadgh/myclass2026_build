import{u as a,f as s,g as e,Q as l,i as o,j as t,k as r,o as d,b as u,d as c,e as n,R as i,m,l as p,aS as y}from"./app-NYt77MEb.js";import{f as v,a as f,I as _,J as g,K as b,b as h,R as x,V as C,W as j,O as V,N as w,Q as S,F as k,y as q,_ as N}from"./vendor-BWKGNkNB.js";import{u as O}from"./schoolData-CWFtmgnE.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";const R={class:"text-subtitle2"},T={class:"text-body2 text-grey-8"},D={__name:"CSTSyncDialog",props:{modelValue:Boolean,sourceClassroom:Object,allClassrooms:Array},emits:["update:modelValue","synced"],setup(D,{emit:F}){const I=D,Q=F,U=a(),A=O(),B=v(!1),J=v([]),K=f({get:()=>I.modelValue,set:a=>{Q("update:modelValue",a),a||(J.value=[])}}),P=f(()=>I.allClassrooms&&I.sourceClassroom?I.allClassrooms.filter(a=>a.classroom_id!==I.sourceClassroom.classroom_id):[]),W=async()=>{var a,s;if(0!==J.value.length){B.value=!0;try{const a=await N.post("/weekly-system/api/cst-sync-classes-per-week",{school_id:A.schoolId,source_classroom_id:I.sourceClassroom.classroom_id,target_classroom_ids:J.value});a.data.success&&(U.notify({type:"positive",message:a.data.message}),Q("synced"),K.value=!1)}catch(e){console.error("Sync failed:",e),U.notify({type:"negative",message:(null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Sync failed"})}finally{B.value=!1}}};return(a,v)=>(g(),_(n,{modelValue:K.value,"onUpdate:modelValue":v[1]||(v[1]=a=>K.value=a)},{default:b(()=>[h(c,{style:{"min-width":"500px"}},{default:b(()=>[h(s,{class:"bg-primary text-white"},{default:b(()=>{var a;return[v[2]||(v[2]=x("div",{class:"text-h6"},"Sync Class Periods",-1)),x("div",R,"From: "+C(null==(a=D.sourceClassroom)?void 0:a.classroom_name),1)]}),_:1}),h(s,{class:"q-pt-md"},{default:b(()=>{var a;return[x("p",T,[v[3]||(v[3]=j(" This will update the ")),v[4]||(v[4]=x("strong",null,"classes per week",-1)),v[5]||(v[5]=j(" for matching subjects in selected classrooms to match ")),x("strong",null,C(null==(a=D.sourceClassroom)?void 0:a.classroom_name),1),v[6]||(v[6]=j(". "))]),h(e,{dense:"",class:"bg-blue-1 text-primary q-mb-md rounded-borders"},{avatar:b(()=>[h(l,{name:"info",color:"primary"})]),default:b(()=>[v[7]||(v[7]=j(" Only subjects that already exist in the target classroom will be updated. No new subjects will be assigned. "))]),_:1}),v[9]||(v[9]=x("div",{class:"text-subtitle2 q-mb-sm"},"Select Target Classrooms:",-1)),h(o,{bordered:"",separator:"",class:"rounded-borders scroll",style:{"max-height":"300px"}},{default:b(()=>[0===P.value.length?(g(),_(t,{key:0,class:"text-center text-grey"},{default:b(()=>[h(r,null,{default:b(()=>v[8]||(v[8]=[j("No other classrooms available")])),_:1})]),_:1})):V("",!0),(g(!0),w(k,null,S(P.value,a=>q((g(),_(t,{tag:"label",key:a.classroom_id},{default:b(()=>[h(r,{avatar:""},{default:b(()=>[h(m,{modelValue:J.value,"onUpdate:modelValue":v[0]||(v[0]=a=>J.value=a),val:a.classroom_id},null,8,["modelValue","val"])]),_:2},1024),h(r,null,{default:b(()=>[h(p,null,{default:b(()=>[j(C(a.classroom_name),1)]),_:2},1024),h(p,{caption:""},{default:b(()=>[j(C(a.cst_count)+" subjects assigned",1)]),_:2},1024)]),_:2},1024)]),_:2},1024)),[[i]])),128))]),_:1})]}),_:1}),h(d,{align:"right",class:"bg-grey-1"},{default:b(()=>[q(h(u,{flat:"",label:"Cancel",color:"primary"},null,512),[[y]]),h(u,{unelevated:"",label:"Sync Selected",color:"secondary",icon:"sync_alt",onClick:W,loading:B.value,disable:0===J.value.length},null,8,["loading","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{D as default};
