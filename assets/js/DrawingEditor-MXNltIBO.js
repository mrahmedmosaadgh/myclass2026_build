import{o as e}from"./app-Buylb2AA.js";import{f as t,o as n,L as o,I as a,M as l,O as s,$ as i,U as r}from"./vendor-CUZ9QTQV.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";const u={class:"editor"},c={class:"controls"},v=["disabled"],f={key:0,class:"error"},d=e({__name:"DrawingEditor",setup(e){const d=t(null);let p=null;const h=t(null),y=t(!1),m=t("");let x=!1,g=null;const w=t([]);function k(){if(p.clearRect(0,0,800,500),h.value)for(const e of h.value.strokes)T(e);for(const e of w.value)T(e)}function b(e){const t=e.target.files[0];if(!t)return;const n=new FileReader;n.onload=()=>{try{!function(e){if(e&&Array.isArray(e.strokes)&&"number"==typeof e.width&&"number"==typeof e.height)return h.value=e,y.value=!0,m.value="",void k();m.value="File structure not valid",y.value=!1}(JSON.parse(n.result))}catch(e){m.value="Invalid JSON file",y.value=!1}},n.readAsText(t)}function j(e){const t=d.value.getBoundingClientRect();return e.touches&&e.touches[0]?{x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}:{x:e.clientX-t.left,y:e.clientY-t.top}}function T(e){const t=e.points;if(!(t.length<2)){p.strokeStyle=e.color||"#111",p.lineWidth=e.size||3,p.beginPath(),p.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length-1;e++){const n=(t[e].x+t[e+1].x)/2,o=(t[e].y+t[e+1].y)/2;p.quadraticCurveTo(t[e].x,t[e].y,n,o)}p.lineTo(t[t.length-1].x,t[t.length-1].y),p.stroke()}}function C(e){if(!y.value)return;x=!0;const t=j(e);g={points:[{x:t.x,y:t.y,t:0}],color:"red",size:3,_startTime:performance.now()}}function R(e){if(!x||!g)return;const t=j(e),n=performance.now()-g._startTime;g.points.push({x:t.x,y:t.y,t:n}),k(),T(g)}function _(){x&&(x=!1,g&&(delete g._startTime,w.value.push(g)),g=null,k())}function O(){if(!y.value||!h.value)return;const e={...h.value,strokes:[...h.value.strokes,...w.value]},t=new Blob([JSON.stringify(e)],{type:"application/json"}),n=URL.createObjectURL(t),o=document.createElement("a");o.href=n,o.download=`edited-drawing-${Date.now()}.json`,o.click(),URL.revokeObjectURL(n)}return n(()=>{!function(){const e=d.value,t=window.devicePixelRatio||1;e.width=800*t,e.height=500*t,e.style.width="800px",e.style.height="500px",p=e.getContext("2d"),p.scale(t,t),p.lineCap="round",p.lineJoin="round",k()}()}),(e,t)=>(a(),o("div",u,[l("input",{type:"file",accept:"application/json",onChange:b},null,32),l("canvas",{ref_key:"canvas",ref:d,class:"canvas",onMousedown:C,onMousemove:R,onMouseup:_,onMouseleave:_,onTouchstart:i(C,["prevent"]),onTouchmove:i(R,["prevent"]),onTouchend:i(_,["prevent"])},null,544),l("div",c,[l("button",{onClick:k},"Clear Canvas"),l("button",{disabled:!y.value,onClick:O},"Save New JSON",8,v)]),m.value?(a(),o("div",f,r(m.value),1)):s("",!0)]))}},[["__scopeId","data-v-481aa231"]]);export{d as default};
