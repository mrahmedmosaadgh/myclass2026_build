import{u as e}from"./useQuizI18n-RdF52uR0.js";import{d as a,a as l,f as t,k as i,o as n,e as o,L as s,I as r,F as u,M as v,O as d,y as c,U as p,R as m,S as g,Q as b,a1 as f,$ as h}from"./vendor-CUZ9QTQV.js";import{o as w}from"./app-C-NJhdpe.js";import"./i18n-CP46N9fu.js";import"./offline-BzIlwqNM.js";import"./ui-LrZmvB2D.js";const q={class:"quiz-engine",role:"main","aria-label":"Quiz Assessment"},y={class:"quiz-header",role:"banner"},k=["aria-valuenow","aria-label"],x={class:"progress-info"},I={class:"question-counter"},M={class:"progress-percentage"},$={class:"progress-bar"},C=["aria-label"],z={"aria-hidden":"true"},O={class:"sr-only",role:"status","aria-live":"polite","aria-atomic":"true"},R={key:0},D={id:"quiz-content",class:"question-content",role:"region","aria-label":"Question content"},T={class:"question-header"},Q={class:"question-number",id:"current-question-heading"},S=["innerHTML"],L=["aria-label"],N=["aria-label"],j={class:"hints-list",role:"list"},A=["aria-label","aria-activedescendant"],E=["id","aria-selected","aria-disabled","tabindex","onClick","onKeydown"],B={class:"option-content"},_={class:"option-label"},H={class:"option-text"},K={key:0,class:"option-feedback"},P={key:0,class:"feedback-icon correct"},F={key:1,class:"feedback-icon incorrect"},U={key:2,class:"rationale"},G=["aria-label"],J={id:"explanation-heading"},V={"aria-labelledby":"explanation-heading"},W={class:"quiz-footer",role:"contentinfo"},X=["aria-label"],Y=["disabled","aria-label"],Z=["disabled","aria-label"],ee=["aria-label"],ae={class:"navigator-label"},le={class:"navigator-dots"},te=["aria-label","aria-current","onClick"],ie=w(a({__name:"QuizEngine",props:{quiz:{},config:{default:()=>({})},attemptId:{default:void 0}},emits:["answer-selected","question-changed","quiz-completed","quiz-review-enter","time-warning"],setup(a,{emit:w}){const{progress:ie,complete:ne,questionNumber:oe,next:se,previous:re,finish:ue,explanation:ve,hint:de,a11yProgressBar:ce,a11yQuestionOptions:pe,a11yAnnounceProgress:me,a11yNavigationControls:ge,a11yQuestionNavigator:be,isRtl:fe}=e(),he=e=>`${Math.floor(e/60)}:${String(e%60).padStart(2,"0")}`,we=a,qe=w,ye={allowReviewMode:!1,autoAdvance:!1,showRationaleOnCorrect:!0,timeLimit:void 0,shuffleQuestions:!1,shuffleOptions:!1},ke=l(()=>({...ye,...we.config})),xe=t(0),Ie=t([]),Me=t(new Date),$e=t(new Date),Ce=t(ke.value.timeLimit);let ze;const Oe=e=>{const a=[...e];for(let l=a.length-1;l>0;l--){const e=Math.floor(Math.random()*(l+1));[a[l],a[e]]=[a[e],a[l]]}return a},Re=l(()=>{let e=[...we.quiz];return ke.value.shuffleQuestions&&(e=Oe(e)),ke.value.shuffleOptions&&(e=e.map(e=>({...e,answerOptions:Oe(e.answerOptions)}))),e.map((e,a)=>({...e,questionNumber:a+1}))}),De=l(()=>Re.value[xe.value]),Te=l(()=>Ie.value.some(e=>e.questionId===De.value.id)),Qe=l(()=>{const e=Ie.value.find(e=>e.questionId===De.value.id);return e?e.selectedIndex:null}),Se=l(()=>De.value.answerOptions.findIndex(e=>e.isCorrect)),Le=l(()=>{const e=Ie.value.length,a=Re.value.length;return a>0?e/a*100:0}),Ne=l(()=>xe.value===Re.value.length-1),je=l(()=>Re.value.length),Ae=()=>{const e=new Date,a=Math.floor((e.getTime()-$e.value.getTime())/1e3);return Math.max(0,a)},Ee=e=>{if(Te.value&&!ke.value.allowReviewMode)return;const a=De.value,l=a.answerOptions[e],t=a.answerOptions[Se.value],i={questionId:a.id,questionNumber:a.questionNumber,selectedIndex:e,selectedOptionId:l.id,selectedText:l.text,correct:l.isCorrect,question:a.question,correctText:t.text,timeSpentSec:Ae(),answeredAt:new Date},n=Ie.value.findIndex(e=>e.questionId===a.id);-1!==n?Ie.value[n]=i:Ie.value.push(i),qe("answer-selected",i),ke.value.autoAdvance&&i.correct&&setTimeout(()=>{Be()},1e3)},Be=()=>{Ne.value?He():(xe.value++,$e.value=new Date,qe("question-changed",xe.value))},_e=e=>{if(!ke.value.allowReviewMode){if(e>Ie.value.length)return}e<0||e>=Re.value.length||(xe.value=e,$e.value=new Date,qe("question-changed",e))},He=()=>{void 0!==ze&&(clearInterval(ze),ze=void 0);const e=Ie.value.filter(e=>e.correct).length,a=Re.value.length,l=a>0?e/a*100:0,t={attemptId:we.attemptId||`attempt-${Date.now()}`,total:a,correct:e,percentage:Math.round(100*l)/100,answers:[...Ie.value],completedAt:new Date,metadata:{startTime:Me.value,totalTimeSec:Math.floor(((new Date).getTime()-Me.value.getTime())/1e3)}};qe("quiz-completed",t)},Ke=e=>{const a=e.key;if("Home"===a){e.preventDefault();const a=document.getElementById(`option-${De.value.id}-0`);null==a||a.focus()}if("End"===a){e.preventDefault();const a=De.value.answerOptions.length-1,l=document.getElementById(`option-${De.value.id}-${a}`);null==l||l.focus()}};i(()=>Ie.value.length,e=>{e===Re.value.length&&ke.value.allowReviewMode&&qe("quiz-review-enter")}),i(Ce,e=>{if(void 0===e)return;[300,120,60].includes(e)&&qe("time-warning",e),e<=0&&He()});return n(()=>{void 0!==ke.value.timeLimit&&ke.value.timeLimit>0&&(Ce.value=ke.value.timeLimit,ze=window.setInterval(()=>{void 0!==Ce.value&&Ce.value>0&&Ce.value--},1e3))}),o(()=>{void 0!==ze&&(clearInterval(ze),ze=void 0)}),(e,a)=>(r(),s(u,null,[a[1]||(a[1]=v("div",{class:"skip-links"},[v("a",{href:"#quiz-content",class:"skip-link"},"Skip to quiz content"),v("a",{href:"#quiz-navigation",class:"skip-link"},"Skip to navigation")],-1)),v("div",q,[v("div",y,[v("div",{class:"progress-bar-container",role:"progressbar","aria-valuenow":Math.round(Le.value),"aria-valuemin":"0","aria-valuemax":"100","aria-label":c(ce)(Math.round(Le.value))},[v("div",x,[v("span",I,p(c(ie)(xe.value+1,je.value)),1),v("span",M,p(c(ne)(Math.round(Le.value))),1)]),v("div",$,[v("div",{class:"progress-bar-fill",style:m({width:`${Le.value}%`})},null,4)])],8,k),void 0!==Ce.value?(r(),s("div",{key:0,class:g(["time-remaining",{"time-warning":Ce.value<120}]),role:"timer","aria-label":Ce.value(he(Ce.value))},[v("span",z,p(Ce.value(he(Ce.value))),1)],10,C)):d("",!0),v("div",O,[Te.value?(r(),s("span",R,p(c(me)(xe.value+1,je.value)),1)):d("",!0)])]),v("div",D,[v("div",T,[v("h2",Q,p(c(oe)(De.value.questionNumber)),1)]),v("div",{class:"question-text",innerHTML:De.value.question,role:"heading","aria-level":"3","aria-labelledby":"current-question-heading"},null,8,S),De.value.hints&&De.value.hints.length>0&&!Te.value?(r(),s("div",{key:0,class:"hints-section",role:"complementary","aria-label":c(de)()},[v("details",null,[v("summary",{"aria-label":`${c(de)()}`},p(c(de)()),9,N),v("ul",j,[(r(!0),s(u,null,b(De.value.hints,(e,a)=>(r(),s("li",{key:a,role:"listitem"},p(e),1))),128))])])],8,L)):d("",!0),v("ol",{class:"options-list",role:"listbox","aria-label":c(pe)(De.value.questionNumber),"aria-activedescendant":null!==Qe.value?`option-${De.value.id}-${Qe.value}`:void 0,onKeydown:Ke},[(r(!0),s(u,null,b(De.value.answerOptions,(e,a)=>(r(),s("li",{key:e.id,id:`option-${De.value.id}-${a}`,class:g(["option-item",{selected:Qe.value===a,correct:Te.value&&e.isCorrect,incorrect:Te.value&&Qe.value===a&&!e.isCorrect,"unselected-correct":Te.value&&Qe.value!==a&&e.isCorrect}]),role:"option","aria-selected":Qe.value===a,"aria-disabled":Te.value&&!ke.value.allowReviewMode,tabindex:0===a?0:-1,onClick:e=>Ee(a),onKeydown:[f(h(e=>Ee(a),["prevent"]),["enter"]),f(h(e=>Ee(a),["prevent"]),["space"]),f(h(e=>(e=>{if(e>0){const a=document.getElementById(`option-${De.value.id}-${e-1}`);null==a||a.focus()}})(a),["prevent"]),["up"]),f(h(e=>(e=>{if(e<De.value.answerOptions.length-1){const a=document.getElementById(`option-${De.value.id}-${e+1}`);null==a||a.focus()}})(a),["prevent"]),["down"])]},[v("div",B,[v("span",_,p(String.fromCharCode(65+a)),1),v("span",H,p(e.text),1)]),Te.value?(r(),s("div",K,[e.isCorrect?(r(),s("span",P,"✓")):Qe.value===a?(r(),s("span",F,"✗")):d("",!0),e.rationale&&(Qe.value===a||e.isCorrect&&ke.value.showRationaleOnCorrect)?(r(),s("div",U,p(e.rationale),1)):d("",!0)])):d("",!0)],42,E))),128))],40,A),Te.value&&De.value.explanation?(r(),s("div",{key:1,class:"explanation-panel",role:"region","aria-label":c(ve)(),"aria-live":"polite"},[v("strong",J,p(c(ve)()),1),v("p",V,p(De.value.explanation),1)],8,G)):d("",!0)]),v("div",W,[v("div",{id:"quiz-navigation",class:"navigation-controls",role:"navigation","aria-label":c(ge)()},[ke.value.allowReviewMode?(r(),s("button",{key:0,class:"nav-button prev-button",disabled:0===xe.value,"aria-label":c(re)(),onClick:a[0]||(a[0]=e=>_e(xe.value-1))},p(c(fe)?`${c(re)()} ←`:`← ${c(re)()}`),9,Y)):d("",!0),v("button",{class:g(["nav-button next-button",{"finish-button":Ne.value}]),disabled:!Te.value&&!ke.value.allowReviewMode,"aria-label":Ne.value?c(ue)():c(se)(),onClick:Be},p(Ne.value?c(ue)():c(fe)?`${c(se)()} ←`:`${c(se)()} →`),11,Z)],8,X),ke.value.allowReviewMode&&Ie.value.length===je.value?(r(),s("div",{key:0,class:"question-navigator",role:"navigation","aria-label":c(be)()},[v("div",ae,p(c(be)()),1),v("div",le,[(r(!0),s(u,null,b(Re.value,(e,a)=>(r(),s("button",{key:e.id,class:g(["nav-dot",{current:a===xe.value,answered:Ie.value.some(a=>a.questionId===e.id)}]),"aria-label":c(oe)(a+1),"aria-current":a===xe.value?"true":"false",onClick:e=>_e(a)},p(a+1),11,te))),128))])],8,ee)):d("",!0)])])],64))}}),[["__scopeId","data-v-eddf70a6"]]);export{ie as default};
