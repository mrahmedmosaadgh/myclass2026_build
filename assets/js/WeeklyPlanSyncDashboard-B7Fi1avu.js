import{Q as e}from"./QSpinnerDots-DZPL0uRa.js";import{r as l,u as a,f as s,Q as t,d as i,b as o,G as r,o as n,e as d,i as c,j as u,k as m,l as v,be as p,aS as y}from"./app-BxJhpxku.js";import{Q as g}from"./QCircularProgress-CEpiDj0u.js";import{Q as f}from"./QBadge-CVqhPkEU.js";import{Q as b}from"./QTd-CdMOzIxb.js";import{Q as _}from"./QTable-bfrPmXFn.js";import{u as k}from"./i18n-B0T1C7j3.js";import{f as h,a as w,k as x,o as P,N as j,J as Q,b as q,R as C,I as z,O as S,K as I,V as N,z as E,F as D,Q as M,W as T,y as V,_ as W}from"./vendor-BWKGNkNB.js";import{u as $}from"./useWeeklyPlansStore-Cx5d735B.js";import"./offline-BzIlwqNM.js";import"./ui-B7TfxbV_.js";import"./QMarkupTable-FlbqetwF.js";import"./QSelect-DvJQhHwY.js";import"./rtl-Cr6c3OOr.js";import"./QLinearProgress-C8hggxm2.js";import"./use-fullscreen-Dx2-rb4h.js";import"./schoolData-CWFtmgnE.js";const A={class:"sync-dashboard q-pa-md"},U={key:0,class:"flex flex-center q-pa-xl"},B={key:1},F={class:"row q-col-gutter-md q-mb-lg"},R={class:"col-12 col-sm-6 col-md-3"},Y={class:"stat-icon bg-blue-1 text-blue"},G={class:"stat-value text-h4"},J={class:"stat-label text-grey-7"},K={class:"col-12 col-sm-6 col-md-3"},L={class:"stat-icon bg-green-1 text-green"},O={class:"stat-value text-h4 text-positive"},H={class:"stat-label text-grey-7"},X={class:"col-12 col-sm-6 col-md-3"},Z={class:"stat-icon bg-orange-1 text-orange"},ee={class:"stat-value text-h4 text-warning"},le={class:"stat-label text-grey-7"},ae={class:"col-12 col-sm-6 col-md-3"},se={class:"stat-icon bg-purple-1 text-purple"},te={class:"stat-value text-h4 text-primary"},ie={class:"stat-label text-grey-7"},oe={class:"row q-mb-lg"},re={class:"col-12"},ne={class:"row q-col-gutter-md"},de={class:"row items-center q-mb-md"},ce={class:"col"},ue={class:"text-h6"},me={class:"text-caption text-grey-7"},ve={class:"col-auto"},pe={class:"text-caption"},ye={key:0,class:"text-warning"},ge={class:"text-h6"},fe={class:"text-caption text-grey-7"},be={class:"text-h6 text-grey-7 q-mt-md"},_e={class:"text-grey-6"},ke=l({__name:"WeeklyPlanSyncDashboard",setup(l){const{t:ke}=k(),he=$(),we=a(),xe=h(!1),Pe=h(!1),je=h(null),Qe=h(!1),qe=h([]),Ce=h([]),ze=h("all"),Se=w(()=>"ar"===ke("code")?"right":"left"),Ie=w(()=>[{name:"day",label:ke("weeklyPlans.day"),field:"day",align:Se.value,sortable:!0},{name:"period",label:ke("weeklyPlans.period"),field:"period",align:"center",sortable:!0},{name:"subject",label:ke("weeklyPlans.subject"),field:"subject",align:Se.value,sortable:!0},{name:"teacher",label:ke("weeklyPlans.teacher"),field:"teacher",align:Se.value,sortable:!0},{name:"status",label:ke("weeklyPlans.status"),field:"status",align:"center"}]),Ne=async()=>{if(he.selectedCopyId){xe.value=!0;try{const e=await W.get("/weekly-system/api/sync-analysis",{params:{copy_id:he.selectedCopyId,week_number:he.weekNumber,academic_year_id:he.selectedAcademicYearId,semester_number:he.semesterNumber}});je.value=e.data}catch(e){console.error("Error fetching sync analysis:",e),we.notify({type:"negative",message:"Failed to load sync analysis"})}finally{xe.value=!1}}},Ee=()=>{var e;ze.value="all",qe.value=[],(null==(e=je.value)?void 0:e.classrooms)&&je.value.classrooms.forEach(e=>{e.days&&e.days.forEach(l=>{var a;(null==(a=l.missing_periods)?void 0:a.length)>0&&l.missing_periods.forEach(a=>{qe.value.push({id:a.id,day:l.day,period:a.period,subject:a.subject,teacher:a.teacher,status:"missing",classroom_name:e.name})})})}),Ce.value=[...qe.value],Qe.value=!0},De=()=>{var e,l;if("all"===ze.value)return"All Classrooms";const a=null==(l=null==(e=je.value)?void 0:e.classrooms)?void 0:l.find(e=>e.id===ze.value);return a?`Classroom ${a.name}`:""},Me=async()=>{var e,l;Pe.value=!0;try{const e=Ce.value.map(e=>e.id),l=await W.post("/weekly-system/api/weekly-plans/batch-create",{schedule_ids:e,week_number:he.weekNumber,academic_year_id:he.selectedAcademicYearId,semester_number:he.semesterNumber});we.notify({type:"positive",message:l.data.message||`Created ${e.length} weekly plans`}),Qe.value=!1,await Ne()}catch(a){console.error(a),we.notify({type:"negative",message:(null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||"Failed to create plans"})}finally{Pe.value=!1}};return x(()=>[he.selectedCopyId,he.weekNumber,he.semesterNumber],()=>{Ne()},{deep:!0}),P(()=>{Ne()}),(l,a)=>{var k,h,w,x,P;return Q(),j("div",A,[xe.value?(Q(),j("div",U,[q(e,{size:"50px",color:"primary"})])):(Q(),j("div",B,[C("div",F,[C("div",R,[q(i,{flat:"",bordered:"",class:"stat-card"},{default:I(()=>[q(s,null,{default:I(()=>{var e,l;return[C("div",Y,[q(t,{name:"grid_on",size:"32px"})]),C("div",G,N((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.total_slots)||0),1),C("div",J,N(E(ke)("weeklyPlans.totalSlots")),1)]}),_:1})]),_:1})]),C("div",K,[q(i,{flat:"",bordered:"",class:"stat-card"},{default:I(()=>[q(s,null,{default:I(()=>{var e,l;return[C("div",L,[q(t,{name:"check_circle",size:"32px"})]),C("div",O,N((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.complete)||0),1),C("div",H,N(E(ke)("weeklyPlans.completed")),1)]}),_:1})]),_:1})]),C("div",X,[q(i,{flat:"",bordered:"",class:"stat-card"},{default:I(()=>[q(s,null,{default:I(()=>{var e,l;return[C("div",Z,[q(t,{name:"error",size:"32px"})]),C("div",ee,N((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.missing)||0),1),C("div",le,N(E(ke)("weeklyPlans.missing")),1)]}),_:1})]),_:1})]),C("div",ae,[q(i,{flat:"",bordered:"",class:"stat-card"},{default:I(()=>[q(s,null,{default:I(()=>{var e,l;return[C("div",se,[q(t,{name:"trending_up",size:"32px"})]),C("div",te,N((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.percentage)||0)+"%",1),C("div",ie,N(E(ke)("weeklyPlans.progress")),1)]}),_:1})]),_:1})])]),C("div",oe,[C("div",re,[(null==(h=null==(k=je.value)?void 0:k.summary)?void 0:h.missing)>0?(Q(),z(o,{key:0,color:"primary",icon:"sync",label:E(ke)("weeklyPlans.syncAll"),loading:Pe.value,onClick:Ee,unelevated:"",size:"lg"},null,8,["label","loading"])):S("",!0)])]),C("div",ne,[(Q(!0),j(D,null,M(null==(w=je.value)?void 0:w.classrooms,e=>(Q(),j("div",{key:e.id,class:"col-12 col-md-6 col-lg-4"},[q(i,{flat:"",bordered:"",class:"classroom-card"},{default:I(()=>[q(s,null,{default:I(()=>{var l,a;return[C("div",de,[C("div",ce,[C("div",ue,N(e.name),1),C("div",me,N(e.complete)+"/"+N(e.total_slots)+" slots complete ",1)]),C("div",ve,[q(g,{value:e.percentage,size:"80px",thickness:.15,color:(a=e.percentage,a>=80?"positive":a>=50?"warning":"negative"),"track-color":"grey-3","show-value":""},{default:I(()=>[C("div",pe,N(e.percentage)+"%",1)]),_:2},1032,["value","color"])])]),(null==(l=e.days)?void 0:l.length)?(Q(),z(p,{key:0,icon:"calendar_today",label:E(ke)("weeklyPlans.viewByDay"),dense:"","header-class":"text-primary"},{default:I(()=>[q(c,{dense:"",separator:""},{default:I(()=>[(Q(!0),j(D,null,M(e.days,e=>(Q(),z(u,{key:e.day_number},{default:I(()=>[q(m,null,{default:I(()=>[q(v,null,{default:I(()=>[T(N(e.day),1)]),_:2},1024),q(v,{caption:""},{default:I(()=>[T(N(e.complete)+"/"+N(e.total)+" complete ",1),e.missing>0?(Q(),j("span",ye," (Missing: P"+N(e.missing_periods.join(", P"))+") ",1)):S("",!0)]),_:2},1024)]),_:2},1024),q(m,{side:""},{default:I(()=>[q(f,{color:e.missing>0?"warning":"positive",label:e.missing>0?`${e.missing} missing`:"Complete"},null,8,["color","label"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["label"])):S("",!0),e.missing>0?(Q(),z(o,{key:1,color:"primary",icon:"sync",label:`${E(ke)("weeklyPlans.syncWeeklyPlans")} (${e.missing})`,onClick:l=>(e=>{var l,a;ze.value=e,qe.value=[];const s=null==(a=null==(l=je.value)?void 0:l.classrooms)?void 0:a.find(l=>l.id===e);s&&s.days&&s.days.forEach(e=>{var l;(null==(l=e.missing_periods)?void 0:l.length)>0&&e.missing_periods.forEach(l=>{qe.value.push({id:l.id,day:e.day,period:l.period,subject:l.subject,teacher:l.teacher,status:"missing",classroom_name:s.name})})}),Ce.value=[...qe.value],Qe.value=!0})(e.id),outline:"",class:"full-width q-mt-md",size:"sm"},null,8,["label","onClick"])):S("",!0)]}),_:2},1024)]),_:2},1024)]))),128))]),q(d,{modelValue:Qe.value,"onUpdate:modelValue":a[1]||(a[1]=e=>Qe.value=e),"full-width":""},{default:I(()=>[q(i,null,{default:I(()=>[q(s,null,{default:I(()=>[C("div",ge,N(E(ke)("weeklyPlans.syncPreview"))+" - "+N(De()),1),C("div",fe,N(E(ke)("weeklyPlans.selectMissingPlans")),1)]),_:1}),q(s,{class:"q-pa-none"},{default:I(()=>[q(_,{rows:qe.value,columns:Ie.value,"row-key":"id",selection:"multiple",selected:Ce.value,"onUpdate:selected":a[0]||(a[0]=e=>Ce.value=e),flat:"",bordered:"",pagination:{rowsPerPage:0},"virtual-scroll":"",style:{height:"400px"}},{"body-cell-status":I(e=>[q(b,{props:e},{default:I(()=>[q(r,{color:"negative","text-color":"white",size:"sm",icon:"warning"},{default:I(()=>a[2]||(a[2]=[T(" Missing ")])),_:1})]),_:2},1032,["props"])]),_:1},8,["rows","columns","selected"])]),_:1}),q(n,{align:"right",class:"q-pa-md"},{default:I(()=>[V(q(o,{flat:"",label:E(ke)("common.cancel"),color:"primary"},null,8,["label"]),[[y]]),q(o,{unelevated:"",color:"primary",label:E(ke)("weeklyPlans.createPlans",{count:Ce.value.length}),disable:0===Ce.value.length,loading:Pe.value,onClick:Me},null,8,["label","disable","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(null==(P=null==(x=je.value)?void 0:x.classrooms)?void 0:P.length)?S("",!0):(Q(),z(i,{key:0,flat:"",bordered:"",class:"text-center q-pa-xl q-mt-lg"},{default:I(()=>[q(t,{name:"check_circle",size:"64px",color:"positive"}),C("p",be,N(E(ke)("weeklyPlans.allSynced")),1),C("p",_e,N(E(ke)("weeklyPlans.noMissingPlans")),1)]),_:1}))]))])}}},[["__scopeId","data-v-652055c6"]]);export{ke as default};
