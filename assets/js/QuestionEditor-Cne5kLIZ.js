import{r as e,d as l,f as a,Q as t,h as o,t as i,m as s,bd as n,b as u,u as d,aI as r}from"./app-DraepSDZ.js";import{f as m,a as c,k as p,N as v,J as _,R as b,b as f,O as y,K as x,I as g,V as q,W as V,z as h,o as k,Q as w,F as j,_ as U,M as Q,a4 as E,$ as C}from"./vendor-BWKGNkNB.js";import{Q as O}from"./QSelect-B8X205mE.js";import{Q as A}from"./QForm-Dm5DeIFc.js";import{d as F}from"./vuedraggable.umd-DshT_Vng.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";import"./index-SlSKjXnq.js";const z={class:"option-editor"},S={class:"row items-center q-gutter-sm"},D={class:"option-key"},I={key:0,class:"text-negative text-caption q-mt-sm"},L={key:1,class:"text-warning text-caption q-mt-sm"},M=e({__name:"OptionEditor",props:{modelValue:{type:Array,default:()=>[]},allowMultiple:{type:Boolean,default:!1},minOptions:{type:Number,default:2},maxOptions:{type:Number,default:6}},emits:["update:modelValue"],setup(e,{emit:d}){const r=e,k=d,w=m([...r.modelValue]),j=m(""),U=["A","B","C","D","E","F"],Q=c(()=>w.value.some(e=>e.is_correct)),E=()=>{if(w.value.length>=r.maxOptions)return;const e={id:Date.now(),option_key:U[w.value.length],option_text:"",is_correct:!1,order_index:w.value.length};w.value.push(e),M()},C=()=>{w.value.forEach((e,l)=>{e.option_key=U[l],e.order_index=l}),M()},O=()=>{const e=w.value.find(e=>e.is_correct);return e?e.id:null},A=()=>{j.value="",Q.value||(j.value="At least one option must be marked as correct"),M()},M=()=>{k("update:modelValue",[...w.value])};if(p(()=>r.modelValue,e=>{w.value=[...e]},{deep:!0}),0===w.value.length)for(let l=0;l<r.minOptions;l++)E();return(d,m)=>(_(),v("div",z,[m[5]||(m[5]=b("div",{class:"text-subtitle2 q-mb-md"},"Answer Options",-1)),f(h(F),{modelValue:w.value,"onUpdate:modelValue":m[0]||(m[0]=e=>w.value=e),"item-key":"id",handle:".drag-handle",onEnd:C},{item:x(({element:d,index:c})=>[f(l,{flat:"",bordered:"",class:"option-item q-mb-sm"},{default:x(()=>[f(a,{class:"q-pa-sm"},{default:x(()=>[b("div",S,[f(t,{name:"drag_indicator",class:"drag-handle cursor-pointer text-grey-6",size:"20px"}),b("div",D,q(d.option_key),1),f(o,{modelValue:d.option_text,"onUpdate:modelValue":e=>d.option_text=e,outlined:"",dense:"",placeholder:"Enter option text",class:"col",rules:[e=>!!e||"Option text is required"]},null,8,["modelValue","onUpdate:modelValue","rules"]),e.allowMultiple?(_(),g(s,{key:0,modelValue:d.is_correct,"onUpdate:modelValue":[e=>d.is_correct=e,A],color:"positive"},{default:x(()=>[f(i,null,{default:x(()=>m[1]||(m[1]=[V("Mark as correct answer")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])):(_(),g(n,{key:1,"model-value":O(),val:d.id,color:"positive","onUpdate:modelValue":e=>{return l=d.id,w.value.forEach(e=>{e.is_correct=e.id===l}),void M();var l}},{default:x(()=>[f(i,null,{default:x(()=>m[2]||(m[2]=[V("Mark as correct answer")])),_:1})]),_:2},1032,["model-value","val","onUpdate:modelValue"])),f(u,{flat:"",round:"",dense:"",icon:"close",size:"sm",color:"negative",onClick:e=>(e=>{w.value.length<=r.minOptions||(w.value.splice(e,1),w.value.forEach((e,l)=>{e.option_key=U[l],e.order_index=l}),M())})(c),disable:w.value.length<=e.minOptions},{default:x(()=>[f(i,null,{default:x(()=>m[3]||(m[3]=[V("Remove option")])),_:1})]),_:2},1032,["onClick","disable"])])]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue"]),f(u,{flat:"",icon:"add",label:"Add Option",color:"primary",size:"sm",onClick:E,disable:w.value.length>=e.maxOptions,class:"q-mt-sm"},null,8,["disable"]),j.value?(_(),v("div",I,[f(t,{name:"warning",size:"16px",class:"q-mr-xs"}),V(" "+q(j.value),1)])):y("",!0),Q.value?y("",!0):(_(),v("div",L,[f(t,{name:"info",size:"16px",class:"q-mr-xs"}),m[4]||(m[4]=V(" Please mark at least one option as correct "))]))]))}},[["__scopeId","data-v-079fc1d5"]]),B={class:"form-section"},H={class:"form-section"},N={class:"form-section"},R={class:"row q-col-gutter-md"},T={class:"col-12 col-md-4"},$={class:"col-12 col-md-4"},G={class:"col-12 col-md-4"},J={class:"form-section"},K={class:"row q-col-gutter-md"},P={class:"col-12 col-md-4"},W={class:"col-12 col-md-4"},X={class:"col-12 col-md-4"},Y={key:0,class:"form-section"},Z={class:"form-section"},ee={class:"col"},le={class:"form-section"},ae={class:"form-section"},te={class:"row q-gutter-sm justify-end q-mt-lg"},oe=e({__name:"QuestionForm",props:{modelValue:{type:Object,default:()=>({})},mode:{type:String,default:"create"}},emits:["submit","cancel","update:modelValue"],setup(e,{emit:l}){const a=e,i=l,n=m({question_type_id:null,question_text:"",grade_id:null,subject_id:null,topic_id:null,difficulty_level:3,bloom_level:null,estimated_time_sec:60,status:"draft",options:[],hints:[],explanation:{text:"",revealed_after_attempt:!0},...a.modelValue}),d=m([]),r=m([]),q=m([]),V=m([]),h=m(!1),Q=[{label:"Very Easy",value:1},{label:"Easy",value:2},{label:"Medium",value:3},{label:"Hard",value:4},{label:"Very Hard",value:5}],E=[{label:"Level 1 - Remember",value:1},{label:"Level 2 - Understand",value:2},{label:"Level 3 - Apply",value:3},{label:"Level 4 - Analyze",value:4},{label:"Level 5 - Evaluate",value:5},{label:"Level 6 - Create",value:6}],C=[{label:"Draft",value:"draft"},{label:"Active",value:"active"},{label:"Archived",value:"archived"},{label:"Review",value:"review"}],F=c(()=>d.value.find(e=>e.id===n.value.question_type_id)),z=c(()=>{var e;return"multi_select"===(null==(e=F.value)?void 0:e.slug)}),S=c(()=>q.value),D=c(()=>n.value.subject_id?V.value.filter(e=>e.subject_id===n.value.subject_id):V.value),I=()=>{var e,l;if(null==(e=F.value)?void 0:e.has_options){"true_false"===(null==(l=F.value)?void 0:l.slug)?n.value.options=[{id:Date.now(),option_key:"A",option_text:"True",is_correct:!1,order_index:0},{id:Date.now()+1,option_key:"B",option_text:"False",is_correct:!1,order_index:1}]:0===n.value.options.length&&(n.value.options=[{id:Date.now(),option_key:"A",option_text:"",is_correct:!1,order_index:0},{id:Date.now()+1,option_key:"B",option_text:"",is_correct:!1,order_index:1}])}else n.value.options=[]},L=()=>{n.value.subject_id=null,n.value.topic_id=null},oe=()=>{n.value.topic_id=null},ie=()=>{n.value.hints.push("")},se=()=>{i("submit",n.value)},ne=()=>{n.value.status="draft",i("submit",n.value)};return p(()=>a.modelValue,e=>{n.value={...n.value,...e}},{deep:!0}),k(()=>{(async()=>{try{const e=await U.get("/api/question-types");d.value=e.data.data||e.data}catch(e){console.error("Failed to load question types:",e)}})(),(async()=>{try{const e=await U.get("/api/grades");r.value=e.data.data||e.data}catch(e){console.error("Failed to load grades:",e)}})(),(async()=>{try{const e=await U.get("/api/subjects");q.value=e.data.data||e.data,console.log("ddddddd",e.data.data),console.log("subjects",q.value)}catch(e){console.error("Failed to load subjects:",e)}})(),(async()=>{try{const e=await U.get("/api/topics");V.value=e.data.data||e.data}catch(e){console.error("Failed to load topics:",e)}})()}),(e,l)=>(_(),g(A,{onSubmit:se,class:"question-form"},{default:x(()=>{var a;return[b("div",B,[l[13]||(l[13]=b("div",{class:"text-subtitle1 q-mb-md"},"Question Type",-1)),f(O,{modelValue:n.value.question_type_id,"onUpdate:modelValue":[l[0]||(l[0]=e=>n.value.question_type_id=e),I],options:d.value,"option-value":"id","option-label":"name","emit-value":"","map-options":"",outlined:"",dense:"",label:"Select question type *",rules:[e=>!!e||"Question type is required"]},{prepend:x(()=>[f(t,{name:"quiz"})]),_:1},8,["modelValue","options","rules"])]),b("div",H,[l[14]||(l[14]=b("div",{class:"text-subtitle1 q-mb-md"},"Question Text",-1)),f(o,{modelValue:n.value.question_text,"onUpdate:modelValue":l[1]||(l[1]=e=>n.value.question_text=e),type:"textarea",outlined:"",label:"Enter your question *",rows:"4",rules:[e=>!!e||"Question text is required",e=>e.length>=10||"Question must be at least 10 characters"]},null,8,["modelValue","rules"])]),b("div",N,[l[15]||(l[15]=b("div",{class:"text-subtitle1 q-mb-md"},"Curriculum Alignment",-1)),b("div",R,[b("div",T,[f(O,{modelValue:n.value.grade_id,"onUpdate:modelValue":[l[2]||(l[2]=e=>n.value.grade_id=e),L],options:r.value,"option-value":"id","option-label":"name","emit-value":"","map-options":"",outlined:"",dense:"",label:"Grade",clearable:""},{prepend:x(()=>[f(t,{name:"school"})]),_:1},8,["modelValue","options"])]),b("div",$,[f(O,{modelValue:n.value.subject_id,"onUpdate:modelValue":[l[3]||(l[3]=e=>n.value.subject_id=e),oe],options:S.value,"option-value":"id","option-label":"name","emit-value":"","map-options":"",outlined:"",dense:"",label:"Subject",clearable:"",disable:!n.value.grade_id},{prepend:x(()=>[f(t,{name:"subject"})]),_:1},8,["modelValue","options","disable"])]),b("div",G,[f(O,{modelValue:n.value.topic_id,"onUpdate:modelValue":l[4]||(l[4]=e=>n.value.topic_id=e),options:D.value,"option-value":"id","option-label":"name","emit-value":"","map-options":"",outlined:"",dense:"",label:"Topic",clearable:"",disable:!n.value.subject_id},{prepend:x(()=>[f(t,{name:"label"})]),_:1},8,["modelValue","options","disable"])])])]),b("div",J,[l[16]||(l[16]=b("div",{class:"text-subtitle1 q-mb-md"},"Cognitive Settings",-1)),b("div",K,[b("div",P,[f(O,{modelValue:n.value.difficulty_level,"onUpdate:modelValue":l[5]||(l[5]=e=>n.value.difficulty_level=e),options:Q,"emit-value":"","map-options":"",outlined:"",dense:"",label:"Difficulty"},{prepend:x(()=>[f(t,{name:"speed"})]),_:1},8,["modelValue"])]),b("div",W,[f(O,{modelValue:n.value.bloom_level,"onUpdate:modelValue":l[6]||(l[6]=e=>n.value.bloom_level=e),options:E,"emit-value":"","map-options":"",outlined:"",dense:"",label:"Bloom Level"},{prepend:x(()=>[f(t,{name:"psychology"})]),_:1},8,["modelValue"])]),b("div",X,[f(o,{modelValue:n.value.estimated_time_sec,"onUpdate:modelValue":l[7]||(l[7]=e=>n.value.estimated_time_sec=e),modelModifiers:{number:!0},type:"number",outlined:"",dense:"",label:"Est. Time (seconds)",min:"0"},{prepend:x(()=>[f(t,{name:"timer"})]),_:1},8,["modelValue"])])])]),(null==(a=F.value)?void 0:a.has_options)?(_(),v("div",Y,[f(M,{modelValue:n.value.options,"onUpdate:modelValue":l[8]||(l[8]=e=>n.value.options=e),"allow-multiple":z.value,"min-options":2,"max-options":6},null,8,["modelValue","allow-multiple"])])):y("",!0),b("div",Z,[l[17]||(l[17]=b("div",{class:"text-subtitle1 q-mb-md"},"Hints (Optional)",-1)),(_(!0),v(j,null,w(n.value.hints,(e,l)=>(_(),v("div",{key:l,class:"row q-col-gutter-sm q-mb-sm"},[b("div",ee,[f(o,{modelValue:n.value.hints[l],"onUpdate:modelValue":e=>n.value.hints[l]=e,outlined:"",dense:"",label:`Hint ${l+1}`},null,8,["modelValue","onUpdate:modelValue","label"])]),b("div",null,[f(u,{flat:"",round:"",dense:"",icon:"close",size:"sm",color:"negative",onClick:e=>(e=>{n.value.hints.splice(e,1)})(l)},null,8,["onClick"])])]))),128)),f(u,{flat:"",icon:"add",label:"Add Hint",color:"primary",size:"sm",onClick:ie})]),b("div",le,[l[18]||(l[18]=b("div",{class:"text-subtitle1 q-mb-md"},"Explanation (Optional)",-1)),f(o,{modelValue:n.value.explanation.text,"onUpdate:modelValue":l[9]||(l[9]=e=>n.value.explanation.text=e),type:"textarea",outlined:"",label:"Explain the correct answer",rows:"3"},null,8,["modelValue"]),f(s,{modelValue:n.value.explanation.revealed_after_attempt,"onUpdate:modelValue":l[10]||(l[10]=e=>n.value.explanation.revealed_after_attempt=e),label:"Reveal after first attempt",class:"q-mt-sm"},null,8,["modelValue"])]),b("div",ae,[l[19]||(l[19]=b("div",{class:"text-subtitle1 q-mb-md"},"Status",-1)),f(O,{modelValue:n.value.status,"onUpdate:modelValue":l[11]||(l[11]=e=>n.value.status=e),options:C,"emit-value":"","map-options":"",outlined:"",dense:"",label:"Question status"},{prepend:x(()=>[f(t,{name:"flag"})]),_:1},8,["modelValue"])]),b("div",te,[f(u,{flat:"",label:"Cancel",color:"grey-7",onClick:l[12]||(l[12]=l=>e.$emit("cancel"))}),f(u,{flat:"",label:"Save as Draft",color:"grey-8",onClick:ne,loading:h.value},null,8,["loading"]),f(u,{type:"submit",label:"Save",color:"primary",loading:h.value},null,8,["loading"])])]}),_:1}))}},[["__scopeId","data-v-175e56dd"]]),ie={class:"question-editor-page"},se={class:"q-pa-md"},ne={class:"row items-center q-mb-lg"},ue={class:"q-ma-none"},de={class:"text-grey-7 q-mb-none"},re={key:0,class:"text-center q-py-xl"},me=e({__name:"QuestionEditor",props:{question:{type:Object,default:null},questionId:{type:[String,Number],default:null}},setup(e){Q();const t=d(),o=e,i=m(o.question||{}),s=m(!1),n=m(!1),p=c(()=>!!o.questionId&&"new"!==o.questionId),y=async e=>{var l,a,i,s,u;n.value=!0;try{const l={question_type_id:e.question_type_id,question_text:e.question_text,grade_id:e.grade_id||null,subject_id:e.subject_id||null,topic_id:e.topic_id||null,difficulty_level:e.difficulty_level||null,bloom_level:e.bloom_level||null,estimated_time_sec:e.estimated_time_sec||null,status:e.status||"draft",hints:e.hints&&e.hints.length>0?e.hints.filter(e=>e.trim()):null,explanation:e.explanation&&e.explanation.text?e.explanation:null,options:e.options&&e.options.length>0?e.options.map((e,l)=>({id:e.id>1e12?void 0:e.id,option_key:e.option_key,option_text:e.option_text,is_correct:e.is_correct,order_index:l})):void 0};let a;a=p.value?await U.put(`/api/questions/${o.questionId}`,l):await U.post("/api/questions",l),a.data.success&&(t.notify({type:"positive",message:p.value?"Question updated successfully":"Question created successfully"}),C.visit("/questions"))}catch(d){if(console.error("Failed to save question:",d),422===(null==(l=d.response)?void 0:l.status)){const e=(null==(a=d.response.data.error)?void 0:a.details)||d.response.data.errors,l=Object.values(e).flat().join(", ");t.notify({type:"negative",message:"Validation failed",caption:l,timeout:5e3})}else t.notify({type:"negative",message:"Failed to save question",caption:(null==(u=null==(s=null==(i=d.response)?void 0:i.data)?void 0:s.error)?void 0:u.message)||d.message})}finally{n.value=!1}},V=()=>{C.visit("/questions")};return k(()=>{p.value&&(async()=>{var e,l,a;if(p.value&&!o.question){s.value=!0;try{const e=await U.get(`/api/questions/${o.questionId}`);e.data.success&&(i.value=e.data.data,i.value.hints||(i.value.hints=[]),i.value.explanation||(i.value.explanation={text:"",revealed_after_attempt:!0}))}catch(n){console.error("Failed to load question:",n),t.notify({type:"negative",message:"Failed to load question",caption:(null==(a=null==(l=null==(e=n.response)?void 0:e.data)?void 0:l.error)?void 0:a.message)||n.message}),V()}finally{s.value=!1}}})()}),(e,t)=>(_(),v(j,null,[f(h(E),{title:p.value?"Edit Question":"Create Question"},null,8,["title"]),b("div",ie,[b("div",se,[b("div",ne,[f(u,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:V,class:"q-mr-md"}),b("div",null,[b("h4",ue,q(p.value?"Edit Question":"Create New Question"),1),b("p",de,q(p.value?"Update question details":"Add a new question to your bank"),1)])]),s.value?(_(),v("div",re,[f(r,{color:"primary",size:"50px"}),t[1]||(t[1]=b("p",{class:"text-grey-7 q-mt-md"},"Loading question...",-1))])):(_(),g(l,{key:1,flat:"",bordered:""},{default:x(()=>[f(a,{class:"q-pa-lg"},{default:x(()=>[f(oe,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),mode:p.value?"edit":"create",onSubmit:y,onCancel:V},null,8,["modelValue","mode"])]),_:1})]),_:1}))])])],64))}},[["__scopeId","data-v-0aabbec6"]]);export{me as default};
