import{r as e,b as l,R as a,j as t,Q as i,k as s,m as o,h as n,l as d,G as r,t as c,i as u}from"./app-BxJhpxku.js";import{Q as p}from"./QBadge-CVqhPkEU.js";import m from"./TaskTree-JXBck5Rm.js";import k from"./DraggableTaskItem-B5dq0rR4.js";import{f as v,a as f,N as g,J as y,R as h,b as _,K as b,I as x,F as C,Q as V,y as T,U as w,O as I,a0 as $,a2 as z,W as U,V as B}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./QTree-D-pi1QE4.js";const j={class:"main-task-list"},K={class:"q-mb-md"},q={class:"drag-handle-container q-mr-sm"},D={class:"row items-center"},A={class:"p-0 flex relative"},R={class:"p-0 scale-50 w-fit flex absolute -top-4 right-10"},M={class:"row items-center"},P={class:"description-area"},Q={class:"action-buttons"},S={class:"ml-4 drag-handle-container q-mr-sm"},E={class:"row items-center"},L={class:"p-0 relative"},O={class:"p-0 scale-75 w-fit flex absolute -top-4 right-10"},F={class:"row items-center"},G={class:"description-area"},J={class:"action-buttons"},N=e({__name:"MainTaskList",props:{tasks:{type:Array,required:!0},selectionMode:{type:Boolean,default:!1},selectedTasks:{type:Array,default:()=>[]}},emits:["toggle-complete","edit-task","delete-task","reorder-tasks","add-subtask","toggle-selection"],setup(e,{emit:N}){const W=e,X=N,Y=v(new Set),H=v(!1),Z=v(null),ee=v(null),le=v(""),ae=v(null),te=f(()=>W.tasks.filter(e=>!e.parent_id)),ie=e=>{Y.value.has(e)?Y.value.delete(e):Y.value.add(e)},se=()=>{H.value=!H.value},oe=e=>{if(!e)return"";return new Date(e).toLocaleDateString()},ne=e=>{let l=0;for(let t=0;t<e.length;t++)l=e.charCodeAt(t)+((l<<5)-l);const a=["red","pink","purple","deep-purple","indigo","blue","light-blue","cyan","teal","green","light-green","lime","yellow","amber","orange","deep-orange","brown","grey","blue-grey"];return a[Math.abs(l)%a.length]},de=e=>W.selectedTasks.some(l=>l.id===e.id),re=(e,l)=>{ce(),Z.value=e.id,ee.value=l,le.value="title"===l?e.title:e.description||""},ce=()=>{ae.value&&(clearTimeout(ae.value),ae.value=null),Z.value=null,ee.value=null,le.value=""},ue=e=>{if(ae.value&&(clearTimeout(ae.value),ae.value=null),"title"===ee.value&&le.value!==e.title){const l={...e,title:le.value};X("edit-task",l)}else if("description"===ee.value&&le.value!==e.description){const l={...e,description:le.value};X("edit-task",l)}Z.value=null,ee.value=null,le.value=""},pe=e=>{ae.value&&clearTimeout(ae.value),ae.value=setTimeout(()=>{Z.value===e.id&&ue(e)},5e3)},me=({fromIndex:e,toIndex:l,fromParentId:a,toParentId:t})=>{if(null===a&&null===t){const a=[...te.value],[t]=a.splice(e,1);a.splice(l,0,t);const i=a.map((e,l)=>({...e,position:l}));X("reorder-tasks",i)}else if(null!==a&&null===t){const t=te.value.find(e=>e.id===a);if(!t||!t.children)return;const i=t.children[e];if(!i)return;const s=[...te.value],o={...t,children:t.children.filter((l,a)=>a!==e)},n=s.findIndex(e=>e.id===a);-1!==n&&(s[n]=o);const d={...i,parent_id:null};s.splice(l,0,d);const r=s.map((e,l)=>({...e,position:l}));X("reorder-tasks",r)}else ke(t,{fromIndex:e,toIndex:l,fromParentId:a})},ke=(e,{fromIndex:l,toIndex:a,fromParentId:t})=>{const i=te.value.find(l=>l.id===e);if(!i)return;const s=i.children||[];if(t===e){const e=[...s],[t]=e.splice(l,1);e.splice(a,0,t);const o=e.map((e,l)=>({...e,position:l})),n={...i,children:o};X("reorder-tasks",[n])}else{let o,n=[...te.value];if(null===t)o=te.value[l],n.splice(l,1);else{const e=te.value.find(e=>e.id===t);if(!e||!e.children)return;o=e.children[l];const a={...e,children:e.children.filter((e,a)=>a!==l)},i=n.findIndex(e=>e.id===t);-1!==i&&(n[i]=a)}if(!o)return;const d={...o,parent_id:i.id},r=[...s];r.splice(a,0,d);const c=r.map((e,l)=>({...e,position:l})),u={...i,children:c},p=n.findIndex(l=>l.id===e);-1!==p&&(n[p]=u);const m=n.map((e,l)=>({...e,position:l}));X("reorder-tasks",m)}};return(v,f)=>(y(),g("div",j,[h("div",K,[_(l,{color:"primary",label:H.value?"Show Parent Tasks Only":"Show All Tasks",onClick:se,"icon-right":"expand_more",flat:""},null,8,["label"])]),_(u,{bordered:"",separator:""},{default:b(()=>[H.value?(y(),x(m,{key:0,tasks:e.tasks,onToggleComplete:f[0]||(f[0]=e=>v.$emit("toggle-complete",e)),onEditTask:f[1]||(f[1]=e=>v.$emit("edit-task",e)),onDeleteTask:f[2]||(f[2]=e=>v.$emit("delete-task",e)),onReorderTasks:f[3]||(f[3]=e=>v.$emit("reorder-tasks",e)),onAddSubtask:f[4]||(f[4]=e=>v.$emit("add-subtask",e))},null,8,["tasks"])):(y(),g(C,{key:1},[(y(!0),g(C,null,V(te.value,(u,m)=>(y(),x(k,{key:u.id,task:u,index:m,onReorder:me},{default:b(()=>[T((y(),x(t,{clickable:"",class:w({"completed-task":u.completed_at,"task-item":!0})},{default:b(()=>[h("div",q,[_(i,{name:"drag_indicator",size:"sm",class:"drag-handle cursor-grab"})]),_(s,{avatar:""},{default:b(()=>[h("div",D,[e.selectionMode?(y(),x(o,{key:0,"model-value":de(u),"onUpdate:modelValue":e=>v.$emit("toggle-selection",u),class:"q-mr-sm"},null,8,["model-value","onUpdate:modelValue"])):(y(),x(o,{key:1,"model-value":null!==u.completed_at,"onUpdate:modelValue":e=>v.$emit("toggle-complete",u)},null,8,["model-value","onUpdate:modelValue"]))])]),_:2},1024),_(s,{onClick:e=>ie(u.id)},{default:b(()=>[h("div",A,[Z.value===u.id&&"title"===ee.value?(y(),g("div",{key:0,class:"editable-field w-full",onClick:f[6]||(f[6]=$(()=>{},["stop"]))},[_(n,{modelValue:le.value,"onUpdate:modelValue":f[5]||(f[5]=e=>le.value=e),dense:"",autofocus:"",onKeyup:[e=>pe(u),z(e=>ue(u),["enter"]),z(ce,["esc"])],onBlur:e=>ue(u)},null,8,["modelValue","onKeyup","onBlur"])])):(y(),x(d,{key:1,onDblclick:$(e=>re(u,"title"),["stop"])},{default:b(()=>[U(B(u.title),1)]),_:2},1032,["onDblclick"])),u.due_date?(y(),x(d,{key:2,caption:""},{default:b(()=>[_(i,{name:"event",size:"xs"}),U(" "+B(oe(u.due_date)),1)]),_:2},1024)):I("",!0),h("div",R,[u.classification?(y(),x(r,{key:0,size:"sm",color:ne(u.classification),"text-color":"white"},{default:b(()=>[U(B(u.classification),1)]),_:2},1032,["color"])):I("",!0)])])]),_:2},1032,["onClick"]),_(s,{side:""},{default:b(()=>[h("div",M,[h("div",P,[Z.value===u.id&&"description"===ee.value?(y(),g("div",{key:0,class:"editable-field description-editor",onClick:f[8]||(f[8]=$(()=>{},["stop"]))},[_(n,{modelValue:le.value,"onUpdate:modelValue":f[7]||(f[7]=e=>le.value=e),type:"textarea",autofocus:"",dense:"",onKeyup:[e=>pe(u),z(ce,["esc"])],onBlur:e=>ue(u)},null,8,["modelValue","onKeyup","onBlur"])])):(y(),x(l,{key:1,flat:"",round:"",dense:"",icon:u.description?"description":"add_comment",size:"sm",color:u.description?"blue-grey":"grey",onClick:$(e=>re(u,"description"),["stop"]),class:w({"has-description":u.description})},{default:b(()=>[_(c,null,{default:b(()=>[U(B(u.description?"Edit description":"Add description"),1)]),_:2},1024)]),_:2},1032,["icon","color","onClick","class"]))]),h("div",Q,[u.children&&u.children.length?(y(),x(p,{key:0,color:"grey",label:u.children.length,class:"q-mr-sm"},null,8,["label"])):I("",!0),_(l,{flat:"",round:"",dense:"",icon:"add",size:"sm",color:"positive",onClick:$(e=>v.$emit("add-subtask",u),["stop"])},null,8,["onClick"]),_(l,{flat:"",round:"",dense:"",icon:"edit",size:"sm",onClick:$(e=>v.$emit("edit-task",u),["stop"])},null,8,["onClick"]),_(l,{flat:"",round:"",dense:"",icon:"delete",size:"sm",color:"negative",onClick:$(e=>v.$emit("delete-task",u),["stop"])},null,8,["onClick"]),u.children&&u.children.length?(y(),x(l,{key:1,flat:"",round:"",dense:"",icon:Y.value.has(u.id)?"expand_less":"expand_more",onClick:$(e=>ie(u.id),["stop"])},null,8,["icon","onClick"])):I("",!0)])])]),_:2},1024)]),_:2},1032,["class"])),[[a]])]),_:2},1032,["task","index"]))),128)),(y(!0),g(C,null,V(te.value,u=>(y(),g(C,{key:`children-${u.id}`},[Y.value.has(u.id)&&u.children&&u.children.length?(y(!0),g(C,{key:0},V(u.children,(p,m)=>(y(),x(k,{key:p.id,task:p,index:m,"parent-id":u.id,onReorder:e=>ke(u.id,e)},{default:b(()=>[T((y(),x(t,{clickable:"",class:w([{"completed-task":p.completed_at,"task-item":!0},"q-pl-xl"])},{default:b(()=>[h("div",S,[_(i,{name:"drag_indicator",size:"sm",class:"drag-handle cursor-grab"})]),_(s,{avatar:""},{default:b(()=>[h("div",E,[e.selectionMode?(y(),x(o,{key:0,"model-value":de(p),"onUpdate:modelValue":e=>v.$emit("toggle-selection",p),class:"q-mr-sm"},null,8,["model-value","onUpdate:modelValue"])):(y(),x(o,{key:1,"model-value":null!==p.completed_at,"onUpdate:modelValue":e=>v.$emit("toggle-complete",p)},null,8,["model-value","onUpdate:modelValue"]))])]),_:2},1024),_(s,null,{default:b(()=>[h("div",L,[Z.value===p.id&&"title"===ee.value?(y(),g("div",{key:0,class:"editable-field w-full",onClick:f[10]||(f[10]=$(()=>{},["stop"]))},[_(n,{modelValue:le.value,"onUpdate:modelValue":f[9]||(f[9]=e=>le.value=e),dense:"",autofocus:"",onKeyup:[e=>pe(p),z(e=>ue(p),["enter"]),z(ce,["esc"])],onBlur:e=>ue(p)},null,8,["modelValue","onKeyup","onBlur"])])):(y(),x(d,{key:1,onDblclick:$(e=>re(p,"title"),["stop"])},{default:b(()=>[U(B(p.title),1)]),_:2},1032,["onDblclick"])),p.due_date?(y(),x(d,{key:2,caption:""},{default:b(()=>[_(i,{name:"event",size:"xs"}),U(" "+B(oe(p.due_date)),1)]),_:2},1024)):I("",!0),h("div",O,[p.classification?(y(),x(r,{key:0,size:"sm",color:ne(p.classification),"text-color":"white"},{default:b(()=>[U(B(p.classification),1)]),_:2},1032,["color"])):I("",!0)])])]),_:2},1024),_(s,{side:""},{default:b(()=>[h("div",F,[h("div",G,[Z.value===p.id&&"description"===ee.value?(y(),g("div",{key:0,class:"editable-field description-editor",onClick:f[12]||(f[12]=$(()=>{},["stop"]))},[_(n,{modelValue:le.value,"onUpdate:modelValue":f[11]||(f[11]=e=>le.value=e),type:"textarea",autofocus:"",dense:"",onKeyup:[e=>pe(p),z(ce,["esc"])],onBlur:e=>ue(p)},null,8,["modelValue","onKeyup","onBlur"])])):(y(),x(l,{key:1,flat:"",round:"",dense:"",icon:p.description?"description":"add_comment",size:"sm",color:p.description?"blue-grey":"grey",onClick:$(e=>re(p,"description"),["stop"]),class:w({"has-description":p.description})},{default:b(()=>[_(c,null,{default:b(()=>[U(B(p.description?"Edit description":"Add description"),1)]),_:2},1024)]),_:2},1032,["icon","color","onClick","class"]))]),h("div",J,[_(l,{flat:"",round:"",dense:"",icon:"add",size:"sm",color:"positive",onClick:$(e=>v.$emit("add-subtask",p),["stop"])},null,8,["onClick"]),_(l,{flat:"",round:"",dense:"",icon:"edit",size:"sm",onClick:$(e=>v.$emit("edit-task",p),["stop"])},null,8,["onClick"]),_(l,{flat:"",round:"",dense:"",icon:"delete",size:"sm",color:"negative",onClick:$(e=>v.$emit("delete-task",p),["stop"])},null,8,["onClick"])])])]),_:2},1024)]),_:2},1032,["class"])),[[a]])]),_:2},1032,["task","index","parent-id","onReorder"]))),128)):I("",!0)],64))),128))],64))]),_:1})]))}},[["__scopeId","data-v-3793e509"]]);export{N as default};
