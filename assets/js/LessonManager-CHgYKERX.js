import{p as e,u as l,d as a,n as s,Q as o,h as r,i,e as t,j as u,k as n,g as d,A as c,m,aD as v,b as p}from"./app-BzjXrVp9.js";import{Q as g}from"./QForm-qY0qTz8Q.js";import{Z as f,f as y,a6 as _,L as b,I as h,b as k,M as w,y as V,a3 as x,J as C,O as L,U as j,S as q,H as S,V as A,x as N}from"./vendor-EI0FRBVb.js";import{d as O}from"./vuedraggable.umd-BrRipYEW.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./ui-B__oX9pK.js";import"./index-DND4IDLC.js";const U={class:"lesson-manager"},E={class:"q-pa-md"},J={class:"row q-col-gutter-md"},D={class:"col-12"},M={class:"text-h5"},F={class:"text-subtitle2"},I={key:0,class:"q-mt-sm"},P={class:"col-12 col-md-8"},Q={class:"row justify-between items-center"},T={key:0,class:"text-subtitle2"},R={key:0},$={key:1,class:"row q-gutter-sm"},z={class:"drag-handle cursor-move"},H={class:"row q-gutter-sm"},K={key:0,class:"q-pa-md text-center text-grey"},X={class:"col-12 col-md-4"},Z={class:"text-h6"},B={class:"row q-gutter-sm justify-end"},G=e({__name:"LessonManager",props:{curriculum:Object,lessons:Array},setup(e){var G;f.defaults.headers.common["X-CSRF-TOKEN"]=null==(G=document.querySelector('meta[name="csrf-token"]'))?void 0:G.getAttribute("content"),f.defaults.withCredentials=!0;const W=e,Y=l(),ee=y([...W.lessons]),le=y([]),ae=y(!1),se=y(null),oe=y(!1),re=y(!1),ie=y(!1),te=y(null),ue=y(!1),ne=y(!1),de=_({curriculum_id:W.curriculum.id,title:"",page_number:null,description:"",position:null}),ce=()=>{de.reset(),de.curriculum_id=W.curriculum.id,ae.value=!1,se.value=null},me=()=>{ce()},ve=async()=>{oe.value=!0;try{if(ae.value){const e=await f.put(`/api/lessons/${se.value}`,{title:de.title,page_number:de.page_number,description:de.description}),l=ee.value.findIndex(e=>e.id===se.value);-1!==l&&(ee.value[l]=e.data),Y.notify({color:"positive",message:"Lesson updated successfully",icon:"check_circle"})}else{de.position=ee.value.length;const e=await f.post("/api/lessons",de);ee.value.push(e.data),Y.notify({color:"positive",message:"Lesson added successfully",icon:"check_circle"})}ce()}catch(e){console.error("Error submitting form:",e),Y.notify({color:"negative",message:"An error occurred. Please try again.",icon:"error"})}finally{oe.value=!1}},pe=async()=>{if(te.value){re.value=!0;try{await f.delete(`/api/lessons/${te.value.id}`),ee.value=ee.value.filter(e=>e.id!==te.value.id),Y.notify({color:"positive",message:"Lesson deleted successfully",icon:"check_circle"})}catch(e){console.error("Error deleting lesson:",e),Y.notify({color:"negative",message:"An error occurred while deleting the lesson",icon:"error"})}finally{re.value=!1,te.value=null}}},ge=()=>{le.value=JSON.parse(JSON.stringify(ee.value)),ue.value=!0},fe=()=>{ee.value=JSON.parse(JSON.stringify(le.value)),ue.value=!1},ye=async()=>{ne.value=!0;try{const e=ee.value.map(e=>e.id),l=await f.post("/api/lessons/reorder",{curriculum_id:W.curriculum.id,lesson_ids:e});ee.value=l.data,ue.value=!1,Y.notify({color:"positive",message:"Lesson order saved successfully",icon:"check_circle"})}catch(e){console.error("Error saving lesson order:",e),Y.notify({color:"negative",message:"Failed to save lesson order",icon:"error"})}finally{ne.value=!1}};return(l,f)=>(h(),b("div",U,[k(V(x),{title:"Manage Lessons - "+e.curriculum.name},null,8,["title"]),w("div",E,[w("div",J,[w("div",D,[k(s,{class:"curriculum-info"},{default:C(()=>[k(a,null,{default:C(()=>[w("div",M,j(e.curriculum.name),1),w("div",F,j(e.curriculum.subject.name)+" | "+j(e.curriculum.grade.name)+" | "+j(e.curriculum.school.name),1),e.curriculum.description?(h(),b("div",I,j(e.curriculum.description),1)):L("",!0)]),_:1})]),_:1})]),w("div",P,[k(s,null,{default:C(()=>[k(a,null,{default:C(()=>[w("div",Q,[w("div",null,[f[5]||(f[5]=w("div",{class:"text-h6"},"Lessons",-1)),ue.value?(h(),b("div",T,"Drag and drop to reorder")):L("",!0)]),!ue.value&&ee.value.length>1?(h(),b("div",R,[k(o,{color:"primary",icon:"reorder",label:"Reorder Lessons",onClick:ge})])):L("",!0),ue.value?(h(),b("div",$,[k(o,{color:"negative",outline:"",icon:"cancel",label:"Cancel",onClick:fe}),k(o,{color:"positive",icon:"save",label:"Save Order",onClick:ye,loading:ne.value},null,8,["loading"])])):L("",!0)])]),_:1}),k(a,null,{default:C(()=>[k(r,{bordered:"",separator:"",class:"rounded-borders"},{default:C(()=>[k(V(O),{modelValue:ee.value,"onUpdate:modelValue":f[0]||(f[0]=e=>ee.value=e),group:"lessons","item-key":"id",handle:".drag-handle",disabled:!ue.value,animation:200},{item:C(({element:e,index:l})=>[k(i,{class:q(["lesson-item q-py-md",{"reorder-mode":ue.value}])},{default:C(()=>[ue.value?(h(),S(u,{key:0,avatar:""},{default:C(()=>[w("div",z,[k(t,{name:"drag_indicator",size:"md"})])]),_:1})):L("",!0),k(u,null,{default:C(()=>[k(n,{class:"text-weight-bold"},{default:C(()=>[A(j(e.lesson_number)+". "+j(e.title),1)]),_:2},1024),e.page_number?(h(),S(n,{key:0,caption:""},{default:C(()=>[A(" Page: "+j(e.page_number),1)]),_:2},1024)):L("",!0),e.description?(h(),S(n,{key:1,caption:""},{default:C(()=>[A(j(e.description),1)]),_:2},1024)):L("",!0)]),_:2},1024),ue.value?L("",!0):(h(),S(u,{key:1,side:""},{default:C(()=>[w("div",H,[k(o,{flat:"",round:"",color:"primary",icon:"edit",onClick:l=>{return a=e,de.title=a.title,de.page_number=a.page_number,de.description=a.description||"",ae.value=!0,void(se.value=a.id);var a}},null,8,["onClick"]),k(o,{flat:"",round:"",color:"negative",icon:"delete",onClick:l=>{return a=e,te.value=a,void(ie.value=!0);var a}},null,8,["onClick"])])]),_:2},1024))]),_:2},1032,["class"])]),_:1},8,["modelValue","disabled"]),0===ee.value.length?(h(),b("div",K," No lessons yet. Add your first lesson using the form. ")):L("",!0)]),_:1})]),_:1})]),_:1})]),w("div",X,[k(s,null,{default:C(()=>[k(a,null,{default:C(()=>[w("div",Z,j(ae.value?"Edit Lesson":"Add New Lesson"),1)]),_:1}),k(a,null,{default:C(()=>[k(g,{onSubmit:ve,class:"q-gutter-md"},{default:C(()=>[k(d,{modelValue:V(de).title,"onUpdate:modelValue":f[1]||(f[1]=e=>V(de).title=e),label:"Lesson Title",rules:[e=>!!e||"Title is required"],outlined:""},null,8,["modelValue","rules"]),k(d,{modelValue:V(de).page_number,"onUpdate:modelValue":f[2]||(f[2]=e=>V(de).page_number=e),modelModifiers:{number:!0},label:"Page Number",type:"number",outlined:""},null,8,["modelValue"]),k(d,{modelValue:V(de).description,"onUpdate:modelValue":f[3]||(f[3]=e=>V(de).description=e),label:"Description",type:"textarea",outlined:""},null,8,["modelValue"]),w("div",B,[ae.value?(h(),S(o,{key:0,label:"Cancel",color:"grey",onClick:me,outline:""})):L("",!0),k(o,{label:ae.value?"Update Lesson":"Add Lesson",type:"submit",color:"primary",loading:oe.value},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1})])])]),k(p,{modelValue:ie.value,"onUpdate:modelValue":f[4]||(f[4]=e=>ie.value=e),persistent:""},{default:C(()=>[k(s,null,{default:C(()=>[k(a,{class:"row items-center"},{default:C(()=>[k(c,{icon:"warning",color:"negative","text-color":"white"}),f[6]||(f[6]=w("span",{class:"q-ml-sm"},"Are you sure you want to delete this lesson?",-1))]),_:1}),k(m,{align:"right"},{default:C(()=>[N(k(o,{flat:"",label:"Cancel",color:"primary"},null,512),[[v]]),N(k(o,{flat:"",label:"Delete",color:"negative",onClick:pe,loading:re.value},null,8,["loading"]),[[v]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-ecbc7791"]]);export{G as default};
