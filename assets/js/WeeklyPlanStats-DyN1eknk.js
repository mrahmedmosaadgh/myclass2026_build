import{u as e,G as a,d as l,Q as s,f as t,b as r,c as o,e as n,aS as i}from"./app-Dtv5Fi9L.js";import{Q as d}from"./QSpinnerDots-DmqPi45h.js";import{Q as c}from"./QSpace-D-IrDQfo.js";import{Q as u}from"./QTd-DkPAnXdW.js";import{Q as m}from"./QTable-DjEJtvgI.js";import{u as p}from"./i18n-B0T1C7j3.js";import{f as y,a as v,k as w,o as f,N as b,J as h,b as k,I as _,K as g,R as x,V as j,z as P,W as Q,F as S,Q as T,y as q,_ as N}from"./vendor-BWKGNkNB.js";import z from"./CompletionProgressBar-DKz20WlI.js";import I from"./StatusBadge-BMnDOsqN.js";import{u as L}from"./useWeeklyPlansStore-DUUfAOW7.js";import"./offline-BzIlwqNM.js";import"./ui-B7TfxbV_.js";import"./QMarkupTable-BGpv7gz2.js";import"./QSelect-BslHFD89.js";import"./rtl-Cr6c3OOr.js";import"./QLinearProgress-D6iXPeG1.js";import"./use-fullscreen-GpMU35jG.js";import"./schoolData-tlp4EjaN.js";const M={class:"q-pa-md"},V={class:"row items-center justify-between"},D={class:"text-subtitle1 text-grey-8"},H={class:"row q-gutter-sm"},W={key:0,class:"row justify-center q-pa-xl"},A={class:"text-h6 text-grey-7 q-mt-md"},B={class:"text-grey-6"},C={key:2,class:"q-gutter-md"},R={class:"text-h6"},U=["innerHTML"],E=["innerHTML"],F={__name:"WeeklyPlanStats",setup(F,{expose:K}){const{t:Y}=p(),G=L();e();const J=y([]),O=y([]),$=y(!1),X=y({rowsPerPage:50}),Z=y(!1),ee=y(null),ae=v(()=>"ar"===Y("code")?"right":"left"),le=v(()=>[{name:"day",label:Y("weeklyPlans.day"),field:e=>{var a;return null==(a=e.schedule)?void 0:a.day},format:e=>te(e),sortable:!0,align:ae.value},{name:"period",label:Y("weeklyPlans.period"),field:e=>{var a;return null==(a=e.schedule)?void 0:a.period_number},sortable:!0,align:"center"},{name:"subject",label:Y("weeklyPlans.subject"),field:e=>{var a,l;return null==(l=null==(a=e.schedule)?void 0:a.cst)?void 0:l.subject_name},sortable:!0,align:ae.value},{name:"classroom",label:Y("weeklyPlans.classroom"),field:e=>{var a,l;return null==(l=null==(a=e.schedule)?void 0:a.cst)?void 0:l.classroom_name},sortable:!0,align:ae.value},{name:"status",label:Y("weeklyPlans.status"),field:"status",sortable:!0,align:"center"},{name:"cw",label:Y("weeklyPlans.classwork"),field:"cw",sortable:!0,align:ae.value},{name:"hw",label:Y("weeklyPlans.homework"),field:"hw",sortable:!0,align:ae.value}]),se=v(()=>({completed:J.value.reduce((e,a)=>e+(a.completed||0),0),partial:J.value.reduce((e,a)=>e+(a.partial||0),0),empty:J.value.reduce((e,a)=>e+(a.empty||0),0)})),te=e=>Y(`weeklyPlans.shortDays.${e}`)||e,re=async()=>{if(G.selectedCopyId){$.value=!0;try{const e=await N.get("/weekly-system/api/weekly-plans/teacher-stats",{params:{week_number:G.weekNumber,academic_year_id:G.selectedAcademicYearId,semester_number:G.semesterNumber}});J.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching stats:",e),J.value=[]}finally{$.value=!1}}},oe=async e=>{ee.value=e,Z.value=!0;try{const a=await N.get("/weekly-system/api/weekly-plans",{params:{teacher_id:e.teacher_id,week_number:G.weekNumber,academic_year_id:G.selectedAcademicYearId,semester_number:G.semesterNumber}});O.value=(a.data.data||a.data||[]).map(e=>({...e,status:ne(e)}))}catch(a){console.error("Error fetching teacher plans:",a)}},ne=e=>{var a,l;const s=!!(null==(a=e.cw)?void 0:a.trim()),t=!!(null==(l=e.hw)?void 0:l.trim());return s||t?s&&t?"completed":"partial":"empty"};return w(()=>[G.selectedCopyId,G.weekNumber,G.semesterNumber],()=>{re()},{deep:!0}),f(()=>{re()}),K({refresh:re}),(e,p)=>(h(),b("div",M,[k(l,{flat:"",bordered:"",class:"q-pa-md q-mb-lg"},{default:g(()=>[x("div",V,[x("div",D,j(P(Y)("weeklyPlans.progressOverview")),1),x("div",H,[k(a,{dense:"",color:"green-2","text-color":"green-9",icon:"check_circle"},{default:g(()=>[Q(j(se.value.completed)+" "+j(P(Y)("weeklyPlans.completed")),1)]),_:1}),k(a,{dense:"",color:"amber-2","text-color":"amber-9",icon:"timelapse"},{default:g(()=>[Q(j(se.value.partial)+" "+j(P(Y)("weeklyPlans.partial")),1)]),_:1}),k(a,{dense:"",color:"red-1","text-color":"red-8",icon:"hourglass_empty"},{default:g(()=>[Q(j(se.value.empty)+" "+j(P(Y)("weeklyPlans.empty")),1)]),_:1})])])]),_:1}),$.value?(h(),b("div",W,[k(d,{size:"50px",color:"primary"})])):J.value.length?(h(),b("div",C,[(h(!0),b(S,null,T(J.value,e=>(h(),_(z,{key:e.teacher_id,teacher:e,onView:oe},null,8,["teacher"]))),128))])):(h(),_(l,{key:1,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:g(()=>[k(s,{name:"playlist_add",size:"64px",color:"grey-5"}),x("p",A,j(P(Y)("weeklyPlans.noTeacherData")),1),x("p",B,j(P(Y)("weeklyPlans.generateFirst")),1)]),_:1})),k(n,{modelValue:Z.value,"onUpdate:modelValue":p[1]||(p[1]=e=>Z.value=e),maximized:""},{default:g(()=>[k(l,null,{default:g(()=>[k(t,{class:"row items-center"},{default:g(()=>{var e;return[x("div",R,j(P(Y)("weeklyPlans.teacherWeeklyPlans",{name:null==(e=ee.value)?void 0:e.teacher_name})),1),k(c),q(k(r,{icon:"close",flat:"",round:"",dense:""},null,512),[[i]])]}),_:1}),k(o),k(t,{class:"scroll",style:{"max-height":"80vh"}},{default:g(()=>[k(m,{pagination:X.value,"onUpdate:pagination":p[0]||(p[0]=e=>X.value=e),rows:O.value,columns:le.value,"row-key":"id",dense:"",flat:"",bordered:""},{"body-cell-status":g(e=>[k(u,{props:e},{default:g(()=>[k(I,{status:e.row.status},null,8,["status"])]),_:2},1032,["props"])]),"body-cell-cw":g(e=>[k(u,{props:e},{default:g(()=>[x("div",{innerHTML:e.row.cw||"-",class:"text-caption",style:{"max-width":"200px",overflow:"hidden"}},null,8,U)]),_:2},1032,["props"])]),"body-cell-hw":g(e=>[k(u,{props:e},{default:g(()=>[x("div",{innerHTML:e.row.hw||"-",class:"text-caption",style:{"max-width":"200px",overflow:"hidden"}},null,8,E)]),_:2},1032,["props"])]),_:1},8,["pagination","rows","columns"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{F as default};
