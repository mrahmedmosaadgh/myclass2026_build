import{o as e,u as l,d as a,n,Q as t,m as o,b as s,p as r}from"./app-DOc39CFu.js";import{Q as i}from"./QSelect-Dkiz84LX.js";import{Q as u}from"./QLinearProgress-DkNjmMsH.js";import{Q as c}from"./QSpinnerDots-2or4BCK2.js";import{Q as d}from"./QTab-Dldfuhzv.js";import{Q as m}from"./QTabs-CQbEg8iR.js";import{Q as p}from"./QSpace-DuS_4lXE.js";import{Q as v,a as y}from"./QToolbar-COIP0AkA.js";import{u as b}from"./i18n-DE5KxGn8.js";import{f as w,a as h,k as g,o as f,af as k,M as x,J as P,b as _,N as j,I as V,y as Q,W as T,V as q,z as D,K as M,Q as C,F as S,R as z,_ as E,Y as L,U as W,S as F}from"./vendor-DuKqz2x4.js";import U from"./WeekSelector-CgA-FaGE.js";import N from"./WeeklyPlanEditor-CUx8XHjh.js";import H from"./WeeklyPlanClassroomList-DkeZj5h8.js";import $ from"./StatusBadge-oIYIv2hg.js";import A from"./WeeklyPlanMenu-O60ULZy2.js";import"./offline-BzIlwqNM.js";import"./ui-BITzTqrO.js";import"./rtl-Cr6c3OOr.js";import"./QEditor-C6ShNqzM.js";import"./use-fullscreen-BV7570VS.js";import"./QTd-s0Iuqehk.js";import"./QBadge-Dz6oAuer.js";import"./QTable-BjpIccaO.js";import"./QMarkupTable-37_xwH2D.js";import"./WeeklySystemGuide-DCaDnR2n.js";import"./QTabPanel-C5l4w7rK.js";import"./use-panel-Ddka6S_L.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-D4WV1jNy.js";import"./MainSchoolData-DaIdYVxe.js";import"./schoolData-BRFwL7u7.js";import"./SchoolSettingsDialog-DJ4raEye.js";import"./QForm-CqUo2wlA.js";const I={class:"q-pa-md"},B={class:"row items-center q-mb-lg"},K={class:"col"},O={class:"q-ma-none text-weight-bold"},G={class:"text-grey-7 q-mb-none"},J={class:"row q-gutter-md items-center"},R={class:"col-12 col-sm-6 col-md-4"},Y={class:"col-12 col-sm-3 col-md-2"},X={class:"col-auto q-ml-auto"},Z={class:"absolute-full flex flex-center"},ee={class:"text-caption text-weight-bold"},le={class:"row q-gutter-md items-center q-mt-sm"},ae={class:"col-12 col-sm-6 col-md-4"},ne={class:"col-12 col-sm-6 col-md-4"},te={class:"col-auto"},oe={key:0,class:"col-12 col-sm-6 col-md-auto q-gutter-sm"},se={key:0,class:"row justify-center q-pa-xl"},re={class:"text-h6 text-grey-7 q-mt-md"},ie={class:"text-grey-6"},ue={class:"plans-grid"},ce={class:"day-header"},de=["onClick"],me={class:"period-badge"},pe={class:"subject-name"},ve={class:"flex q-gutter-xs"},ye={class:"classroom text-caption text-grey-7"},be={class:"plan-status"},we={key:0,class:"plan-preview text-caption"},he={key:0,class:"preview-item"},ge={key:1,class:"preview-item"},fe={class:"preview-container q-pa-md"},ke={id:"print-area",class:"a4-page"},xe={class:"print-header q-mb-lg"},Pe={class:"q-ma-none"},_e={class:"q-ma-xs text-grey-7"},je={class:"q-ma-xs text-grey-7"},Ve={class:"q-ma-xs text-grey-7"},Qe={class:"print-table"},Te={class:"text-center"},qe=["innerHTML"],De=["innerHTML"],Me=["innerHTML"],Ce={class:"print-footer q-mt-lg"},Se={class:"text-caption text-grey-6"},ze=e({__name:"MyWeeklyPlans",setup(e){const{t:ze,locale:Ee}=b(),Le=l(),We=w([]),Fe=w(null),Ue=w(1),Ne=w(1),He=w(18),$e=w(1),Ae=w([]),Ie=w([]),Be=w(null),Ke=w(null),Oe=w(!1),Ge=w(null),Je=w(!1),Re=w(!1),Ye=w("by-classroom"),Xe=w(!1),Ze=w({}),el=w(!1),ll=h(()=>[{label:`${ze("weeklyPlans.semester")} 1`,value:1},{label:`${ze("weeklyPlans.semester")} 2`,value:2}]),al=h(()=>[{label:ze("weeklyPlans.fullDays.1"),value:1},{label:ze("weeklyPlans.fullDays.2"),value:2},{label:ze("weeklyPlans.fullDays.3"),value:3},{label:ze("weeklyPlans.fullDays.4"),value:4},{label:ze("weeklyPlans.fullDays.5"),value:5}]),nl=h(()=>{const e={};return al.value.forEach(l=>{e[l.value]=l.label}),e}),tl=h(()=>{const e=new Set;return We.value.forEach(l=>{var a,n;(null==(n=null==(a=l.schedule)?void 0:a.cst)?void 0:n.classroom_name)&&e.add(l.schedule.cst.classroom_name)}),Array.from(e).sort()}),ol=h(()=>{var e,l;let a=We.value;return(null==(e=Ae.value)?void 0:e.length)&&(a=a.filter(e=>{var l,a;return Ae.value.includes(null==(a=null==(l=e.schedule)?void 0:l.cst)?void 0:a.classroom_name)})),(null==(l=Ie.value)?void 0:l.length)&&(a=a.filter(e=>{var l;return Ie.value.includes(null==(l=e.schedule)?void 0:l.day)})),a}),sl=h(()=>{const e={};return ol.value.forEach(l=>{var a;const n=null==(a=l.schedule)?void 0:a.day;e[n]||(e[n]={dayNumber:n,dayName:ze(`weeklyPlans.fullDays.${n}`)||`Day ${n}`,plans:[]}),e[n].plans.push(l)}),Object.values(e).forEach(e=>{e.plans.sort((e,l)=>{var a,n;return(null==(a=e.schedule)?void 0:a.period_number)-(null==(n=l.schedule)?void 0:n.period_number)})}),Object.values(e).sort((e,l)=>e.dayNumber-l.dayNumber)}),rl=h(()=>{const e=We.value.length;if(!e)return 0;const l=We.value.filter(e=>"completed"===e.status).length;return Math.round(l/e*100)}),il=h(()=>{const e=rl.value;return 100===e?"positive":e>=50?"warning":"negative"}),ul=e=>{var l,a;const n=!!(null==(l=e.cw)?void 0:l.trim()),t=!!(null==(a=e.hw)?void 0:a.trim());return n||t?n&&t?"completed":"partial":"empty"},cl=e=>{var l,a,n,t;return{backgroundColor:(null==(a=null==(l=e.schedule)?void 0:l.cst)?void 0:a.c_bg)||"#e0e0e0",color:(null==(t=null==(n=e.schedule)?void 0:n.cst)?void 0:t.c_text)||"#333"}},dl=async()=>{el.value=!0;try{const e=await E.get("/weekly-system/api/teacher/my-weekly-plans",{params:{week_number:Ue.value,semester_number:Ne.value}});We.value=(e.data.data||e.data||[]).map(e=>({...e,...e.schedule,status:ul(e)}))}catch(e){console.error("Error fetching plans:",e),Le.notify({type:"negative",message:"Failed to load weekly plans"})}finally{el.value=!1}},ml=e=>{Be.value||(Ge.value=e,Oe.value=!0)},pl=async e=>{Je.value=!0;try{await E.put(`/weekly-system/api/weekly-plans/${e.id}`,{cw:e.cw,hw:e.hw,notes:e.notes}),Le.notify({type:"positive",message:"Weekly plan saved!"}),Oe.value=!1,await dl()}catch(l){console.error("Error saving plan:",l),Le.notify({type:"negative",message:"Failed to save plan"})}finally{Je.value=!1}},vl=async e=>{if(!Ze.value[e.id]){Ze.value[e.id]=!0;try{await E.put(`/weekly-system/api/weekly-plans/${e.id}`,{cw:e.cw,hw:e.hw,notes:e.notes}),e.status=ul(e),Le.notify({type:"positive",message:"Saved!",timeout:1e3,position:"top"})}catch(l){console.error("Error saving inline edit:",l),Le.notify({type:"negative",message:"Failed to save changes"})}finally{delete Ze.value[e.id]}}},yl=()=>{const e=document.getElementById("print-area");if(!e)return void Le.notify({type:"negative",message:"Print area not found"});const l=window.open("","_blank");l.document.write(`\n    <!DOCTYPE html>\n    <html lang="en">\n    <head>\n      <meta charset="UTF-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      <title>Weekly Plans - Print</title>\n      <style>\n        * {\n          margin: 0;\n          padding: 0;\n          box-sizing: border-box;\n        }\n        \n        @page {\n          size: A4;\n          margin: 10mm;\n        }\n        \n        body {\n          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n          background-color: white;\n          color: #333;\n          line-height: 1.4;\n        }\n        \n        .print-header {\n          margin-bottom: 24px;\n          border-bottom: 2px solid #1976d2;\n          padding-bottom: 12px;\n        }\n        \n        .print-header h2 {\n          font-size: 24px;\n          color: #1976d2;\n          margin-bottom: 8px;\n        }\n        \n        .print-header p {\n          font-size: 12px;\n          color: #666;\n          margin: 4px 0;\n        }\n        \n        .print-table {\n          width: 100%;\n          border-collapse: collapse;\n          margin-bottom: 20px;\n          font-size: 11px;\n        }\n        \n        .print-table thead {\n          background-color: #f5f5f5;\n          border-bottom: 2px solid #1976d2;\n        }\n        \n        .print-table th {\n          padding: 10px;\n          text-align: left;\n          font-weight: 600;\n          color: #1976d2;\n          border: 1px solid #ddd;\n        }\n        \n        .print-table td {\n          padding: 10px;\n          border: 1px solid #ddd;\n          word-wrap: break-word;\n          overflow-wrap: break-word;\n        }\n        \n        .print-table tbody tr:nth-child(even) {\n          background-color: #f9f9f9;\n        }\n        \n        .print-table tbody tr:hover {\n          background-color: #f0f0f0;\n        }\n        \n        .text-center {\n          text-align: center;\n        }\n        \n        .content-cell {\n          max-width: 120px;\n          white-space: pre-wrap;\n          line-height: 1.5;\n        }\n        \n        .content-cell a {\n          color: #1976d2;\n          text-decoration: underline;\n        }\n        \n        .content-cell p {\n          margin: 4px 0;\n        }\n        \n        .content-cell ul,\n        .content-cell ol {\n          margin: 4px 0;\n          padding-left: 20px;\n        }\n        \n        .content-cell li {\n          margin: 2px 0;\n        }\n        \n        .content-cell strong {\n          font-weight: 600;\n        }\n        \n        .content-cell em {\n          font-style: italic;\n        }\n        \n        \n        .print-footer {\n          margin-top: 20px;\n          border-top: 1px solid #ddd;\n          padding-top: 10px;\n          text-align: right;\n          font-size: 10px;\n          color: #999;\n        }\n        \n        @media print {\n          body {\n            background-color: white;\n          }\n          \n          .print-table {\n            page-break-inside: avoid;\n          }\n          \n          .print-table tbody tr {\n            page-break-inside: avoid;\n          }\n        }\n      </style>\n    </head>\n    <body>\n      ${e.innerHTML}\n    </body>\n    </html>\n  `),l.document.close(),l.onload=()=>{setTimeout(()=>{l.print(),l.close()},250)}},bl=()=>{Fe.value&&(Fe.value.openMobilePrint(),setTimeout(()=>{Fe.value.downloadPDF()},100))};return g(()=>Ue.value,()=>{dl()}),g(()=>Ne.value,()=>{dl()}),f(()=>{const e=new Date,l=new Date(e.getFullYear(),0,1),a=Math.ceil(((e.getTime()-l.getTime())/864e5+l.getDay()+1)/7);$e.value=Math.min(a,18),Ue.value=$e.value,dl()}),(e,l)=>{const b=k("Head");return P(),x(S,null,[_(b,{title:"My Weekly Plans"}),j("div",I,[_(A),j("div",B,[j("div",K,[j("h4",O,[_(a,{name:"edit_note",class:"q-mr-sm",color:"primary"}),T(" "+q(D(ze)("weeklyPlans.teacher.myWeeklyPlans")),1)]),j("p",G,q(D(ze)("weeklyPlans.teacher.fillInContent")),1)])]),_(o,{flat:"",bordered:"",class:"q-pa-md q-mb-lg"},{default:M(()=>{var e;return[j("div",J,[j("div",R,[_(U,{modelValue:Ue.value,"onUpdate:modelValue":l[0]||(l[0]=e=>Ue.value=e),"max-weeks":He.value,"current-week":$e.value},null,8,["modelValue","max-weeks","current-week"])]),j("div",Y,[_(i,{modelValue:Ne.value,"onUpdate:modelValue":l[1]||(l[1]=e=>Ne.value=e),options:ll.value,label:D(ze)("weeklyPlans.semester"),outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","label"])]),j("div",X,[_(u,{value:rl.value/100,size:"25px",color:il.value,"track-color":"grey-3",rounded:"",style:{width:"150px"}},{default:M(()=>[j("div",Z,[j("span",ee,q(rl.value)+"%",1)])]),_:1},8,["value","color"])])]),j("div",le,[j("div",ae,[_(i,{modelValue:Ae.value,"onUpdate:modelValue":l[2]||(l[2]=e=>Ae.value=e),options:tl.value,label:D(ze)("weeklyPlans.teacher.selectToView"),outlined:"",dense:"",multiple:"","use-chips":"",clearable:""},null,8,["modelValue","options","label"])]),j("div",ne,[_(i,{modelValue:Ie.value,"onUpdate:modelValue":l[3]||(l[3]=e=>Ie.value=e),options:al.value,label:D(ze)("weeklyPlans.filterByDay"),outlined:"",dense:"",multiple:"","use-chips":"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options","label"])]),j("div",te,[_(n,{modelValue:Xe.value,"onUpdate:modelValue":l[4]||(l[4]=e=>Xe.value=e),label:D(ze)("weeklyPlans.teacher.inlineEditMode"),color:"primary",icon:"edit"},null,8,["modelValue","label"])]),(null==(e=Ae.value)?void 0:e.length)>0?(P(),x("div",oe,[_(t,{color:"primary",label:D(ze)("weeklyPlans.teacher.previewAndPrint"),icon:"print",onClick:l[5]||(l[5]=e=>Re.value=!0),outline:""},null,8,["label"]),_(t,{color:"secondary",label:D(ze)("weeklyPlans.teacher.mobilePrint"),icon:"phone_iphone",onClick:l[6]||(l[6]=e=>{var l;return null==(l=Fe.value)?void 0:l.openMobilePrint()}),outline:""},null,8,["label"]),_(t,{color:"red-7",label:D(ze)("weeklyPlans.teacher.downloadPdf"),icon:"picture_as_pdf",onClick:bl,outline:""},null,8,["label"])])):C("",!0)])]}),_:1}),el.value?(P(),x("div",se,[_(c,{size:"50px",color:"primary"})])):We.value.length?(P(),V(o,{key:2,flat:"",bordered:"",class:"q-mb-lg"},{default:M(()=>[_(m,{modelValue:Ye.value,"onUpdate:modelValue":l[7]||(l[7]=e=>Ye.value=e),dense:"",class:"text-grey-7","active-color":"primary","indicator-color":"primary",align:"left"},{default:M(()=>[_(d,{name:"by-classroom",label:D(ze)("weeklyPlans.teacher.byClassroom"),icon:"meeting_room",disable:!Ae.value||0===Ae.value.length},null,8,["label","disable"]),_(d,{name:"by-day",label:D(ze)("weeklyPlans.teacher.byDay"),icon:"calendar_today"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1})):(P(),V(o,{key:1,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:M(()=>[_(a,{name:"event_note",size:"64px",color:"grey-5"}),j("p",re,q(D(ze)("weeklyPlans.teacher.noPlans")),1),j("p",ie,q(D(ze)("weeklyPlans.teacher.waitAdminGen")),1)]),_:1})),Q(j("div",ue,[(P(!0),x(S,null,z(sl.value,e=>(P(),x("div",{key:e.dayNumber,class:"day-column"},[j("div",ce,q(e.dayName),1),(P(!0),x(S,null,z(e.plans,e=>{var n,o,s,i,u;return P(),x("div",{key:e.id,class:W(["plan-card",{"is-completed":"completed"===e.status,"is-partial":"partial"===e.status}]),onClick:l=>ml(e)},[j("div",{class:"plan-header",style:F(cl(e))},[j("span",me,"P"+q(null==(n=e.schedule)?void 0:n.period_number),1),j("span",pe,q(null==(s=null==(o=e.schedule)?void 0:o.cst)?void 0:s.subject_name),1),_(p),j("div",ve,[Ke.value===e.id?(P(),V(t,{key:0,icon:"close",size:"xs",flat:"",round:"",color:"white",onClick:l[8]||(l[8]=e=>(e.stopPropagation(),Be.value=null,void(Ke.value=null)))},{default:M(()=>[_(r,null,{default:M(()=>[T(q(D(ze)("weeklyPlans.teacher.cancelCopy")),1)]),_:1})]),_:1})):Be.value?C("",!0):(P(),V(t,{key:1,icon:"content_copy",size:"xs",flat:"",round:"",color:"white",onClick:l=>((e,l)=>{l.stopPropagation(),Be.value={cw:e.cw,hw:e.hw,notes:e.notes},Ke.value=e.id,Le.notify({message:ze("weeklyPlans.teacher.copy"),color:"info",icon:"content_copy",timeout:2e3})})(e,l)},{default:M(()=>[_(r,null,{default:M(()=>[T(q(D(ze)("weeklyPlans.teacher.copy")),1)]),_:1})]),_:2},1032,["onClick"])),Be.value&&Ke.value!==e.id?(P(),V(t,{key:2,icon:"content_paste",size:"xs",flat:"",round:"",color:"white",onClick:l=>(async(e,l)=>{if(l.stopPropagation(),Be.value)try{await E.put(`/weekly-system/api/weekly-plans/${e.id}`,{...Be.value}),e.cw=Be.value.cw,e.hw=Be.value.hw,e.notes=Be.value.notes,e.status=ul(e),Le.notify({type:"positive",message:ze("weeklyPlans.teacher.paste")})}catch(a){console.error("Error pasting plan:",a),Le.notify({type:"negative",message:"Failed to paste data"})}})(e,l)},{default:M(()=>[_(r,null,{default:M(()=>[T(q(D(ze)("weeklyPlans.teacher.paste")),1)]),_:1})]),_:2},1032,["onClick"])):C("",!0)])],4),j("div",ye,[_(a,{name:"meeting_room",size:"xs"}),T(" "+q(null==(u=null==(i=e.schedule)?void 0:i.cst)?void 0:u.classroom_name),1)]),j("div",be,[_($,{status:e.status},null,8,["status"])]),e.cw||e.hw?(P(),x("div",we,[e.cw?(P(),x("div",he,[_(a,{name:"school",size:"xs",color:"blue"}),T(" "+q(D(ze)("weeklyPlans.teacher.cwFilled")),1)])):C("",!0),e.hw?(P(),x("div",ge,[_(a,{name:"home_work",size:"xs",color:"orange"}),T(" "+q(D(ze)("weeklyPlans.teacher.hwFilled")),1)])):C("",!0)])):C("",!0)],10,de)}),128))]))),128))],512),[[L,"by-day"===Ye.value]]),Q(j("div",null,[_(H,{ref_key:"classroomListRef",ref:Fe,plans:ol.value,days:nl.value,"inline-edit-mode":Xe.value,"copied-data":Be.value,"week-number":Ue.value,"semester-number":Ne.value,onEdit:ml,onSave:vl},null,8,["plans","days","inline-edit-mode","copied-data","week-number","semester-number"])],512),[[L,"by-classroom"===Ye.value]]),_(N,{modelValue:Oe.value,"onUpdate:modelValue":l[9]||(l[9]=e=>Oe.value=e),plan:Ge.value,saving:Je.value,onSubmit:pl},null,8,["modelValue","plan","saving"]),_(s,{modelValue:Re.value,"onUpdate:modelValue":l[11]||(l[11]=e=>Re.value=e),maximized:""},{default:M(()=>[_(o,{class:"full-height print-preview-card"},{default:M(()=>[_(v,{class:"bg-primary text-white"},{default:M(()=>[_(y,null,{default:M(()=>[T(q(D(ze)("weeklyPlans.teacher.previewAndPrint")),1)]),_:1}),_(p),_(t,{icon:"print",label:D(ze)("weeklyPlans.print"),color:"white",flat:"",onClick:yl},null,8,["label"]),_(t,{icon:"close",flat:"",round:"",dense:"",onClick:l[10]||(l[10]=e=>Re.value=!1)})]),_:1}),j("div",fe,[j("div",ke,[j("div",xe,[j("h2",Pe,q(D(ze)("weeklyPlans.teacher.myWeeklyPlans")),1),j("p",_e,q(D(ze)("weeklyPlans.week"))+" "+q(Ue.value)+" - "+q(D(ze)("weeklyPlans.semester"))+" "+q(Ne.value),1),j("p",je,q(D(ze)("weeklyPlans.classroom"))+": "+q(Ae.value.join(", ")),1),j("p",Ve,q((new Date).toLocaleDateString(D(Ee),{year:"numeric",month:"long",day:"numeric"})),1)]),j("table",Qe,[j("thead",null,[j("tr",null,[j("th",null,q(D(ze)("weeklyPlans.day")),1),j("th",null,q(D(ze)("weeklyPlans.period")),1),j("th",null,q(D(ze)("weeklyPlans.subject")),1),j("th",null,q(D(ze)("weeklyPlans.classroom")),1),j("th",null,q(D(ze)("weeklyPlans.classwork")),1),j("th",null,q(D(ze)("weeklyPlans.homework")),1),j("th",null,q(D(ze)("weeklyPlans.notes")),1)])]),j("tbody",null,[(P(!0),x(S,null,z(ol.value,e=>{var l,a,n,t,o,s;return P(),x("tr",{key:e.id},[j("td",null,q(nl.value[null==(l=e.schedule)?void 0:l.day]||"N/A"),1),j("td",Te,"P"+q(null==(a=e.schedule)?void 0:a.period_number),1),j("td",null,q(null==(t=null==(n=e.schedule)?void 0:n.cst)?void 0:t.subject_name),1),j("td",null,q(null==(s=null==(o=e.schedule)?void 0:o.cst)?void 0:s.classroom_name),1),j("td",{class:"content-cell",innerHTML:e.cw||"-"},null,8,qe),j("td",{class:"content-cell",innerHTML:e.hw||"-"},null,8,De),j("td",{class:"content-cell",innerHTML:e.notes||"-"},null,8,Me)])}),128))])]),j("div",Ce,[j("p",Se,q(D(ze)("weeklyPlans.teacher.generated"))+" "+q((new Date).toLocaleString()),1)])])])]),_:1})]),_:1},8,["modelValue"])])],64)}}},[["__scopeId","data-v-795e0751"]]);export{ze as default};
