import{r as e,u as l,Q as a,p as n,b as t,d as o,e as s,t as r}from"./app-DraepSDZ.js";import{Q as i}from"./QSelect-B8X205mE.js";import{Q as u}from"./QLinearProgress-CYD1l_xP.js";import{Q as d}from"./QSpinnerDots-chBci7-n.js";import{Q as c}from"./QTab-BTRoGWkY.js";import{Q as m}from"./QTabs-BgqCfsdX.js";import{Q as p}from"./QSpace-CZ9CnKBh.js";import{Q as v,a as y}from"./QToolbar-CMohnsUl.js";import{u as w}from"./i18n-B0T1C7j3.js";import{f as h,a as b,k as g,o as f,af as k,N as x,J as P,b as _,R as j,I as V,y as T,W as q,V as Q,z as D,K as C,O as z,F as M,Q as S,_ as E,Y as W,U as L,S as U}from"./vendor-BWKGNkNB.js";import F from"./WeekSelector-0IA8AX0T.js";import N from"./WeeklyPlanEditor-Cnfi4U3W.js";import H from"./WeeklyPlanClassroomList-KT92l3Nv.js";import $ from"./StatusBadge-DeQOARbC.js";import A from"./WeeklyPlanMenu-vHk6pFoC.js";import"./offline-BzIlwqNM.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";import"./QEditor-D1rCofQH.js";import"./use-fullscreen-WQ56vCgJ.js";import"./QTd-ZXd3AVz0.js";import"./QBadge-VPRr201m.js";import"./QTable-lfCIUGXW.js";import"./QMarkupTable-B8BpHV8_.js";import"./WeeklySystemGuide-C9GJ3vwj.js";import"./QTabPanel-BcQ_0NuW.js";import"./use-panel-BIFIFpms.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-Dk5dhPlu.js";import"./MainSchoolData-EgU4iV5q.js";import"./schoolData-CWFtmgnE.js";import"./SchoolSettingsDialog-DKMibbwi.js";import"./QForm-Dm5DeIFc.js";const B={class:"q-pa-md"},I={class:"row items-center q-mb-lg"},O={class:"col"},G={class:"q-ma-none text-weight-bold"},R={class:"text-grey-7 q-mb-none"},Y={class:"row q-gutter-md items-center"},J={class:"col-12 col-sm-6 col-md-4"},K={class:"col-12 col-sm-3 col-md-2"},X={class:"col-auto q-ml-auto"},Z={class:"absolute-full flex flex-center"},ee={class:"text-caption text-weight-bold"},le={class:"row q-gutter-md items-center q-mt-sm"},ae={class:"col-12 col-sm-6 col-md-4"},ne={class:"col-12 col-sm-6 col-md-4"},te={class:"col-auto"},oe={key:0,class:"col-12 col-sm-6 col-md-auto q-gutter-sm"},se={key:0,class:"row justify-center q-pa-xl"},re={class:"text-h6 text-grey-7 q-mt-md"},ie={class:"text-grey-6"},ue={class:"plans-grid"},de={class:"day-header"},ce=["onClick"],me={class:"period-badge"},pe={class:"subject-name"},ve={class:"flex q-gutter-xs"},ye={class:"classroom text-caption text-grey-7"},we={class:"plan-status"},he={key:0,class:"plan-preview text-caption"},be={key:0,class:"preview-item"},ge={key:1,class:"preview-item"},fe={class:"preview-container q-pa-md"},ke={id:"print-area",class:"a4-page"},xe={class:"print-header q-mb-lg"},Pe={class:"q-ma-none"},_e={class:"q-ma-xs text-grey-7"},je={class:"q-ma-xs text-grey-7"},Ve={class:"q-ma-xs text-grey-7"},Te={class:"print-table"},qe={class:"text-center"},Qe=["innerHTML"],De=["innerHTML"],Ce=["innerHTML"],ze={class:"print-footer q-mt-lg"},Me={class:"text-caption text-grey-6"},Se=e({__name:"MyWeeklyPlans",setup(e){const{t:Se,locale:Ee}=w(),We=l(),Le=h([]),Ue=h(null),Fe=h(1),Ne=h(1),He=h(18),$e=h(1),Ae=h([]),Be=h([]),Ie=h(null),Oe=h(null),Ge=h(!1),Re=h(null),Ye=h(!1),Je=h(!1),Ke=h("by-classroom"),Xe=h(!1),Ze=h({}),el=h(!1),ll=b(()=>[{label:`${Se("weeklyPlans.semester")} 1`,value:1},{label:`${Se("weeklyPlans.semester")} 2`,value:2}]),al=b(()=>[{label:Se("weeklyPlans.fullDays.1"),value:1},{label:Se("weeklyPlans.fullDays.2"),value:2},{label:Se("weeklyPlans.fullDays.3"),value:3},{label:Se("weeklyPlans.fullDays.4"),value:4},{label:Se("weeklyPlans.fullDays.5"),value:5}]),nl=b(()=>{const e={};return al.value.forEach(l=>{e[l.value]=l.label}),e}),tl=b(()=>{const e=new Set;return Le.value.forEach(l=>{var a,n;(null==(n=null==(a=l.schedule)?void 0:a.cst)?void 0:n.classroom_name)&&e.add(l.schedule.cst.classroom_name)}),Array.from(e).sort()}),ol=b(()=>{var e,l;let a=Le.value;return(null==(e=Ae.value)?void 0:e.length)&&(a=a.filter(e=>{var l,a;return Ae.value.includes(null==(a=null==(l=e.schedule)?void 0:l.cst)?void 0:a.classroom_name)})),(null==(l=Be.value)?void 0:l.length)&&(a=a.filter(e=>{var l;return Be.value.includes(null==(l=e.schedule)?void 0:l.day)})),a}),sl=b(()=>{const e={};return ol.value.forEach(l=>{var a;const n=null==(a=l.schedule)?void 0:a.day;e[n]||(e[n]={dayNumber:n,dayName:Se(`weeklyPlans.fullDays.${n}`)||`Day ${n}`,plans:[]}),e[n].plans.push(l)}),Object.values(e).forEach(e=>{e.plans.sort((e,l)=>{var a,n;return(null==(a=e.schedule)?void 0:a.period_number)-(null==(n=l.schedule)?void 0:n.period_number)})}),Object.values(e).sort((e,l)=>e.dayNumber-l.dayNumber)}),rl=b(()=>{const e=Le.value.length;if(!e)return 0;const l=Le.value.filter(e=>"completed"===e.status).length;return Math.round(l/e*100)}),il=b(()=>{const e=rl.value;return 100===e?"positive":e>=50?"warning":"negative"}),ul=e=>{var l,a;const n=!!(null==(l=e.cw)?void 0:l.trim()),t=!!(null==(a=e.hw)?void 0:a.trim());return n||t?n&&t?"completed":"partial":"empty"},dl=e=>{var l,a,n,t;return{backgroundColor:(null==(a=null==(l=e.schedule)?void 0:l.cst)?void 0:a.c_bg)||"#e0e0e0",color:(null==(t=null==(n=e.schedule)?void 0:n.cst)?void 0:t.c_text)||"#333"}},cl=async()=>{el.value=!0;try{const e=await E.get("/weekly-system/api/teacher/my-weekly-plans",{params:{week_number:Fe.value,semester_number:Ne.value}});Le.value=(e.data.data||e.data||[]).map(e=>({...e,...e.schedule,status:ul(e)}))}catch(e){console.error("Error fetching plans:",e),We.notify({type:"negative",message:"Failed to load weekly plans"})}finally{el.value=!1}},ml=e=>{Ie.value||(Re.value=e,Ge.value=!0)},pl=async e=>{Ye.value=!0;try{await E.put(`/weekly-system/api/weekly-plans/${e.id}`,{cw:e.cw,hw:e.hw,notes:e.notes}),We.notify({type:"positive",message:"Weekly plan saved!"}),Ge.value=!1,await cl()}catch(l){console.error("Error saving plan:",l),We.notify({type:"negative",message:"Failed to save plan"})}finally{Ye.value=!1}},vl=async e=>{if(!Ze.value[e.id]){Ze.value[e.id]=!0;try{await E.put(`/weekly-system/api/weekly-plans/${e.id}`,{cw:e.cw,hw:e.hw,notes:e.notes}),e.status=ul(e),We.notify({type:"positive",message:"Saved!",timeout:1e3,position:"top"})}catch(l){console.error("Error saving inline edit:",l),We.notify({type:"negative",message:"Failed to save changes"})}finally{delete Ze.value[e.id]}}},yl=()=>{const e=document.getElementById("print-area");if(!e)return void We.notify({type:"negative",message:"Print area not found"});const l=window.open("","_blank");l.document.write(`\n    <!DOCTYPE html>\n    <html lang="en">\n    <head>\n      <meta charset="UTF-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      <title>Weekly Plans - Print</title>\n      <style>\n        * {\n          margin: 0;\n          padding: 0;\n          box-sizing: border-box;\n        }\n        \n        @page {\n          size: A4;\n          margin: 10mm;\n        }\n        \n        body {\n          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n          background-color: white;\n          color: #333;\n          line-height: 1.4;\n        }\n        \n        .print-header {\n          margin-bottom: 24px;\n          border-bottom: 2px solid #1976d2;\n          padding-bottom: 12px;\n        }\n        \n        .print-header h2 {\n          font-size: 24px;\n          color: #1976d2;\n          margin-bottom: 8px;\n        }\n        \n        .print-header p {\n          font-size: 12px;\n          color: #666;\n          margin: 4px 0;\n        }\n        \n        .print-table {\n          width: 100%;\n          border-collapse: collapse;\n          margin-bottom: 20px;\n          font-size: 11px;\n        }\n        \n        .print-table thead {\n          background-color: #f5f5f5;\n          border-bottom: 2px solid #1976d2;\n        }\n        \n        .print-table th {\n          padding: 10px;\n          text-align: left;\n          font-weight: 600;\n          color: #1976d2;\n          border: 1px solid #ddd;\n        }\n        \n        .print-table td {\n          padding: 10px;\n          border: 1px solid #ddd;\n          word-wrap: break-word;\n          overflow-wrap: break-word;\n        }\n        \n        .print-table tbody tr:nth-child(even) {\n          background-color: #f9f9f9;\n        }\n        \n        .print-table tbody tr:hover {\n          background-color: #f0f0f0;\n        }\n        \n        .text-center {\n          text-align: center;\n        }\n        \n        .content-cell {\n          max-width: 120px;\n          white-space: pre-wrap;\n          line-height: 1.5;\n        }\n        \n        .content-cell a {\n          color: #1976d2;\n          text-decoration: underline;\n        }\n        \n        .content-cell p {\n          margin: 4px 0;\n        }\n        \n        .content-cell ul,\n        .content-cell ol {\n          margin: 4px 0;\n          padding-left: 20px;\n        }\n        \n        .content-cell li {\n          margin: 2px 0;\n        }\n        \n        .content-cell strong {\n          font-weight: 600;\n        }\n        \n        .content-cell em {\n          font-style: italic;\n        }\n        \n        \n        .print-footer {\n          margin-top: 20px;\n          border-top: 1px solid #ddd;\n          padding-top: 10px;\n          text-align: right;\n          font-size: 10px;\n          color: #999;\n        }\n        \n        @media print {\n          body {\n            background-color: white;\n          }\n          \n          .print-table {\n            page-break-inside: avoid;\n          }\n          \n          .print-table tbody tr {\n            page-break-inside: avoid;\n          }\n        }\n      </style>\n    </head>\n    <body>\n      ${e.innerHTML}\n    </body>\n    </html>\n  `),l.document.close(),l.onload=()=>{setTimeout(()=>{l.print(),l.close()},250)}},wl=()=>{Ue.value&&(Ue.value.openMobilePrint(),setTimeout(()=>{Ue.value.downloadPDF()},100))};return g(()=>Fe.value,()=>{cl()}),g(()=>Ne.value,()=>{cl()}),f(()=>{const e=new Date,l=new Date(e.getFullYear(),0,1),a=Math.ceil(((e.getTime()-l.getTime())/864e5+l.getDay()+1)/7);$e.value=Math.min(a,18),Fe.value=$e.value,cl()}),(e,l)=>{const w=k("Head");return P(),x(M,null,[_(w,{title:"My Weekly Plans"}),j("div",B,[_(A),j("div",I,[j("div",O,[j("h4",G,[_(a,{name:"edit_note",class:"q-mr-sm",color:"primary"}),q(" "+Q(D(Se)("weeklyPlans.teacher.myWeeklyPlans")),1)]),j("p",R,Q(D(Se)("weeklyPlans.teacher.fillInContent")),1)])]),_(o,{flat:"",bordered:"",class:"q-pa-md q-mb-lg"},{default:C(()=>{var e;return[j("div",Y,[j("div",J,[_(F,{modelValue:Fe.value,"onUpdate:modelValue":l[0]||(l[0]=e=>Fe.value=e),"max-weeks":He.value,"current-week":$e.value},null,8,["modelValue","max-weeks","current-week"])]),j("div",K,[_(i,{modelValue:Ne.value,"onUpdate:modelValue":l[1]||(l[1]=e=>Ne.value=e),options:ll.value,label:D(Se)("weeklyPlans.semester"),outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","label"])]),j("div",X,[_(u,{value:rl.value/100,size:"25px",color:il.value,"track-color":"grey-3",rounded:"",style:{width:"150px"}},{default:C(()=>[j("div",Z,[j("span",ee,Q(rl.value)+"%",1)])]),_:1},8,["value","color"])])]),j("div",le,[j("div",ae,[_(i,{modelValue:Ae.value,"onUpdate:modelValue":l[2]||(l[2]=e=>Ae.value=e),options:tl.value,label:D(Se)("weeklyPlans.teacher.selectToView"),outlined:"",dense:"",multiple:"","use-chips":"",clearable:""},null,8,["modelValue","options","label"])]),j("div",ne,[_(i,{modelValue:Be.value,"onUpdate:modelValue":l[3]||(l[3]=e=>Be.value=e),options:al.value,label:D(Se)("weeklyPlans.filterByDay"),outlined:"",dense:"",multiple:"","use-chips":"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options","label"])]),j("div",te,[_(n,{modelValue:Xe.value,"onUpdate:modelValue":l[4]||(l[4]=e=>Xe.value=e),label:D(Se)("weeklyPlans.teacher.inlineEditMode"),color:"primary",icon:"edit"},null,8,["modelValue","label"])]),(null==(e=Ae.value)?void 0:e.length)>0?(P(),x("div",oe,[_(t,{color:"primary",label:D(Se)("weeklyPlans.teacher.previewAndPrint"),icon:"print",onClick:l[5]||(l[5]=e=>Je.value=!0),outline:""},null,8,["label"]),_(t,{color:"secondary",label:D(Se)("weeklyPlans.teacher.mobilePrint"),icon:"phone_iphone",onClick:l[6]||(l[6]=e=>{var l;return null==(l=Ue.value)?void 0:l.openMobilePrint()}),outline:""},null,8,["label"]),_(t,{color:"red-7",label:D(Se)("weeklyPlans.teacher.downloadPdf"),icon:"picture_as_pdf",onClick:wl,outline:""},null,8,["label"])])):z("",!0)])]}),_:1}),el.value?(P(),x("div",se,[_(d,{size:"50px",color:"primary"})])):Le.value.length?(P(),V(o,{key:2,flat:"",bordered:"",class:"q-mb-lg"},{default:C(()=>[_(m,{modelValue:Ke.value,"onUpdate:modelValue":l[7]||(l[7]=e=>Ke.value=e),dense:"",class:"text-grey-7","active-color":"primary","indicator-color":"primary",align:"left"},{default:C(()=>[_(c,{name:"by-classroom",label:D(Se)("weeklyPlans.teacher.byClassroom"),icon:"meeting_room",disable:!Ae.value||0===Ae.value.length},null,8,["label","disable"]),_(c,{name:"by-day",label:D(Se)("weeklyPlans.teacher.byDay"),icon:"calendar_today"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1})):(P(),V(o,{key:1,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:C(()=>[_(a,{name:"event_note",size:"64px",color:"grey-5"}),j("p",re,Q(D(Se)("weeklyPlans.teacher.noPlans")),1),j("p",ie,Q(D(Se)("weeklyPlans.teacher.waitAdminGen")),1)]),_:1})),T(j("div",ue,[(P(!0),x(M,null,S(sl.value,e=>(P(),x("div",{key:e.dayNumber,class:"day-column"},[j("div",de,Q(e.dayName),1),(P(!0),x(M,null,S(e.plans,e=>{var n,o,s,i,u;return P(),x("div",{key:e.id,class:L(["plan-card",{"is-completed":"completed"===e.status,"is-partial":"partial"===e.status}]),onClick:l=>ml(e)},[j("div",{class:"plan-header",style:U(dl(e))},[j("span",me,"P"+Q(null==(n=e.schedule)?void 0:n.period_number),1),j("span",pe,Q(null==(s=null==(o=e.schedule)?void 0:o.cst)?void 0:s.subject_name),1),_(p),j("div",ve,[Oe.value===e.id?(P(),V(t,{key:0,icon:"close",size:"xs",flat:"",round:"",color:"white",onClick:l[8]||(l[8]=e=>(e.stopPropagation(),Ie.value=null,void(Oe.value=null)))},{default:C(()=>[_(r,null,{default:C(()=>[q(Q(D(Se)("weeklyPlans.teacher.cancelCopy")),1)]),_:1})]),_:1})):Ie.value?z("",!0):(P(),V(t,{key:1,icon:"content_copy",size:"xs",flat:"",round:"",color:"white",onClick:l=>((e,l)=>{l.stopPropagation(),Ie.value={cw:e.cw,hw:e.hw,notes:e.notes},Oe.value=e.id,We.notify({message:Se("weeklyPlans.teacher.copy"),color:"info",icon:"content_copy",timeout:2e3})})(e,l)},{default:C(()=>[_(r,null,{default:C(()=>[q(Q(D(Se)("weeklyPlans.teacher.copy")),1)]),_:1})]),_:2},1032,["onClick"])),Ie.value&&Oe.value!==e.id?(P(),V(t,{key:2,icon:"content_paste",size:"xs",flat:"",round:"",color:"white",onClick:l=>(async(e,l)=>{if(l.stopPropagation(),Ie.value)try{await E.put(`/weekly-system/api/weekly-plans/${e.id}`,{...Ie.value}),e.cw=Ie.value.cw,e.hw=Ie.value.hw,e.notes=Ie.value.notes,e.status=ul(e),We.notify({type:"positive",message:Se("weeklyPlans.teacher.paste")})}catch(a){console.error("Error pasting plan:",a),We.notify({type:"negative",message:"Failed to paste data"})}})(e,l)},{default:C(()=>[_(r,null,{default:C(()=>[q(Q(D(Se)("weeklyPlans.teacher.paste")),1)]),_:1})]),_:2},1032,["onClick"])):z("",!0)])],4),j("div",ye,[_(a,{name:"meeting_room",size:"xs"}),q(" "+Q(null==(u=null==(i=e.schedule)?void 0:i.cst)?void 0:u.classroom_name),1)]),j("div",we,[_($,{status:e.status},null,8,["status"])]),e.cw||e.hw?(P(),x("div",he,[e.cw?(P(),x("div",be,[_(a,{name:"school",size:"xs",color:"blue"}),q(" "+Q(D(Se)("weeklyPlans.teacher.cwFilled")),1)])):z("",!0),e.hw?(P(),x("div",ge,[_(a,{name:"home_work",size:"xs",color:"orange"}),q(" "+Q(D(Se)("weeklyPlans.teacher.hwFilled")),1)])):z("",!0)])):z("",!0)],10,ce)}),128))]))),128))],512),[[W,"by-day"===Ke.value]]),T(j("div",null,[_(H,{ref_key:"classroomListRef",ref:Ue,plans:ol.value,days:nl.value,"inline-edit-mode":Xe.value,"copied-data":Ie.value,"week-number":Fe.value,"semester-number":Ne.value,onEdit:ml,onSave:vl},null,8,["plans","days","inline-edit-mode","copied-data","week-number","semester-number"])],512),[[W,"by-classroom"===Ke.value]]),_(N,{modelValue:Ge.value,"onUpdate:modelValue":l[9]||(l[9]=e=>Ge.value=e),plan:Re.value,saving:Ye.value,onSubmit:pl},null,8,["modelValue","plan","saving"]),_(s,{modelValue:Je.value,"onUpdate:modelValue":l[11]||(l[11]=e=>Je.value=e),maximized:""},{default:C(()=>[_(o,{class:"full-height print-preview-card"},{default:C(()=>[_(v,{class:"bg-primary text-white"},{default:C(()=>[_(y,null,{default:C(()=>[q(Q(D(Se)("weeklyPlans.teacher.previewAndPrint")),1)]),_:1}),_(p),_(t,{icon:"print",label:D(Se)("weeklyPlans.print"),color:"white",flat:"",onClick:yl},null,8,["label"]),_(t,{icon:"close",flat:"",round:"",dense:"",onClick:l[10]||(l[10]=e=>Je.value=!1)})]),_:1}),j("div",fe,[j("div",ke,[j("div",xe,[j("h2",Pe,Q(D(Se)("weeklyPlans.teacher.myWeeklyPlans")),1),j("p",_e,Q(D(Se)("weeklyPlans.week"))+" "+Q(Fe.value)+" - "+Q(D(Se)("weeklyPlans.semester"))+" "+Q(Ne.value),1),j("p",je,Q(D(Se)("weeklyPlans.classroom"))+": "+Q(Ae.value.join(", ")),1),j("p",Ve,Q((new Date).toLocaleDateString(D(Ee),{year:"numeric",month:"long",day:"numeric"})),1)]),j("table",Te,[j("thead",null,[j("tr",null,[j("th",null,Q(D(Se)("weeklyPlans.day")),1),j("th",null,Q(D(Se)("weeklyPlans.period")),1),j("th",null,Q(D(Se)("weeklyPlans.subject")),1),j("th",null,Q(D(Se)("weeklyPlans.classroom")),1),j("th",null,Q(D(Se)("weeklyPlans.classwork")),1),j("th",null,Q(D(Se)("weeklyPlans.homework")),1),j("th",null,Q(D(Se)("weeklyPlans.notes")),1)])]),j("tbody",null,[(P(!0),x(M,null,S(ol.value,e=>{var l,a,n,t,o,s;return P(),x("tr",{key:e.id},[j("td",null,Q(nl.value[null==(l=e.schedule)?void 0:l.day]||"N/A"),1),j("td",qe,"P"+Q(null==(a=e.schedule)?void 0:a.period_number),1),j("td",null,Q(null==(t=null==(n=e.schedule)?void 0:n.cst)?void 0:t.subject_name),1),j("td",null,Q(null==(s=null==(o=e.schedule)?void 0:o.cst)?void 0:s.classroom_name),1),j("td",{class:"content-cell",innerHTML:e.cw||"-"},null,8,Qe),j("td",{class:"content-cell",innerHTML:e.hw||"-"},null,8,De),j("td",{class:"content-cell",innerHTML:e.notes||"-"},null,8,Ce)])}),128))])]),j("div",ze,[j("p",Me,Q(D(Se)("weeklyPlans.teacher.generated"))+" "+Q((new Date).toLocaleString()),1)])])])]),_:1})]),_:1},8,["modelValue"])])],64)}}},[["__scopeId","data-v-795e0751"]]);export{Se as default};
