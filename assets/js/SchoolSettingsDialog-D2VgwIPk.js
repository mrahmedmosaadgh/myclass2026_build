import{u as e,d as a,e as l,a as s,m as t,Q as o,n as i,b as d}from"./app-BXm70mdJ.js";import{Q as u}from"./QSelect-CnZtzPIC.js";import{Q as n}from"./QForm-DyZk5PSh.js";import{Q as c}from"./QBadge-ZzhN1X9C.js";import{a2 as m,f as r,k as p,a as v,Z as g,H as h,I as y,J as f,b as x,M as q,y as _,O as b,U as w}from"./vendor-DNM7Y6Xn.js";import{u as S}from"./schoolData-lzO9rVwn.js";import"./offline-BzIlwqNM.js";import"./i18n-CBOKL2HS.js";import"./ui-BP0GJNn5.js";import"./rtl-Cr6c3OOr.js";const V={class:"row q-col-gutter-md"},j={class:"col-12"},k={class:"row q-col-gutter-md q-mt-none"},z={class:"col-12 col-md-4"},C={class:"col-12 col-md-4"},I={class:"col-12 col-md-4"},Q={class:"row justify-center q-gutter-md"},U={class:"text-weight-medium"},F={class:"text-weight-medium"},Y={class:"text-weight-medium"},A={class:"text-weight-medium"},B={__name:"SchoolSettingsDialog",props:{modelValue:{type:Boolean,default:!1},schoolId:{type:Number,required:!1,default:null}},emits:["update:modelValue","saved","cancel"],setup(B,{emit:D}){const H=e(),J=S(),{schools:M}=m(J),N=B,O=D,P=r(!1),T=r(null),Z=r(null),$=r(null),E=r(null),G=r([]),K=r([]),L=r([]);p(()=>N.modelValue,e=>{P.value=e,e&&(N.schoolId&&(T.value=N.schoolId),ee())}),p(P,e=>{O("update:modelValue",e)}),p(T,async e=>{e&&P.value&&await ee()});const R=v(()=>T.value&&Z.value&&$.value&&E.value),W=e=>{const a=M.value.find(a=>a.id===e);return a?a.name:"Unknown School"},X=async e=>{e&&await J.setSchool(e)},ee=async()=>{var e,a;try{if(G.value=J.academicYears,K.value=J.semesters,L.value=J.scheduleCopies,0===G.value.length){const e=await g.get("/api/academic-years");G.value=e.data.data||e.data}if(0===K.value.length){const e=await g.get("/api/semesters");K.value=e.data.data||e.data}if(T.value){if(0===L.value.length){const e=await g.get("/api/schedule-copies",{params:{school_id:T.value}});L.value=e.data}}else L.value=[];T.value&&await ae()}catch(l){H.notify({type:"negative",message:"Failed to load options",caption:(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||l.message})}},ae=async()=>{var e,a;try{J.academicYearId&&(Z.value=G.value.find(e=>e.id===J.academicYearId)||null),J.semesterId&&($.value=K.value.find(e=>e.id===J.semesterId)||null),J.scheduleCopyId&&(E.value=L.value.find(e=>e.id===J.scheduleCopyId)||null)}catch(l){H.notify({type:"negative",message:"Failed to load current settings",caption:(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||l.message})}},le=async()=>{var e,a,l,s,t;if(R.value)try{await J.updateSchoolSettings({academic_year_id:(null==(e=Z.value)?void 0:e.id)||null,semester_id:(null==(a=$.value)?void 0:a.id)||null,schedule_copy_id:(null==(l=E.value)?void 0:l.id)||null}),H.notify({type:"positive",message:"School settings saved successfully"}),O("saved"),P.value=!1}catch(o){H.notify({type:"negative",message:"Failed to save settings",caption:(null==(t=null==(s=o.response)?void 0:s.data)?void 0:t.message)||o.message})}else H.notify({type:"warning",message:"Please fill in all required fields",caption:"All fields marked with * are required"})};return(e,m)=>(y(),h(d,{modelValue:P.value,"onUpdate:modelValue":m[5]||(m[5]=e=>P.value=e),persistent:"",maximized:""},{default:f(()=>[x(i,{style:{"max-width":"800px",margin:"auto"},class:"q-pa-lg"},{default:f(()=>[x(a,{class:"text-center"},{default:f(()=>m[6]||(m[6]=[q("div",{class:"text-h5 text-primary q-mb-sm"},"School Configuration",-1),q("div",{class:"text-subtitle1 text-grey"},"Set up school context for the weekly planning system",-1)])),_:1}),x(a,null,{default:f(()=>[x(n,{class:"q-gutter-y-md"},{default:f(()=>[q("div",V,[q("div",j,[x(u,{modelValue:T.value,"onUpdate:modelValue":[m[0]||(m[0]=e=>T.value=e),X],options:_(J).schools,"option-value":"id","option-label":"name",label:"Select School *",outlined:"",dense:"","emit-value":"","map-options":"",loading:_(J).loading,rules:[e=>!!e||"School selection is required"],class:"full-width"},{prepend:f(()=>[x(l,{name:"school",color:"primary"})]),_:1},8,["modelValue","options","loading","rules"])])]),q("div",k,[q("div",z,[x(u,{modelValue:Z.value,"onUpdate:modelValue":m[1]||(m[1]=e=>Z.value=e),options:G.value,"option-value":"id","option-label":"name",label:"Academic Year *",outlined:"",dense:"","map-options":"",rules:[e=>!!e||"Academic year is required"]},{prepend:f(()=>[x(l,{name:"calendar_month",color:"blue"})]),_:1},8,["modelValue","options","rules"])]),q("div",C,[x(u,{modelValue:$.value,"onUpdate:modelValue":m[2]||(m[2]=e=>$.value=e),options:K.value,"option-value":"id","option-label":"name",label:"Semester *",outlined:"",dense:"","map-options":"",rules:[e=>!!e||"Semester is required"]},{prepend:f(()=>[x(l,{name:"event",color:"indigo"})]),_:1},8,["modelValue","options","rules"])]),q("div",I,[x(u,{modelValue:E.value,"onUpdate:modelValue":m[3]||(m[3]=e=>E.value=e),options:L.value,"option-value":"id","option-label":"name",label:"Schedule Copy *",outlined:"",dense:"","map-options":"",rules:[e=>!!e||"Schedule copy is required"]},{prepend:f(()=>[x(l,{name:"schedule",color:"teal"})]),_:1},8,["modelValue","options","rules"])])])]),_:1})]),_:1}),x(s,{class:"q-my-md"}),x(a,{class:"text-center"},{default:f(()=>[m[7]||(m[7]=q("div",{class:"text-h6 text-weight-medium text-primary q-mb-md"},"Current Selection",-1)),q("div",Q,[T.value?(y(),h(c,{key:0,color:"primary",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:f(()=>[x(l,{name:"school",size:"18px",class:"q-mr-xs"}),q("span",U,w(W(T.value)),1)]),_:1})):b("",!0),Z.value?(y(),h(c,{key:1,color:"blue-6",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:f(()=>[x(l,{name:"calendar_month",size:"18px",class:"q-mr-xs"}),q("span",F,w(Z.value.name),1)]),_:1})):b("",!0),$.value?(y(),h(c,{key:2,color:"indigo-6",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:f(()=>[x(l,{name:"event",size:"18px",class:"q-mr-xs"}),q("span",Y,w($.value.name),1)]),_:1})):b("",!0),E.value?(y(),h(c,{key:3,color:"teal-6",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:f(()=>[x(l,{name:"schedule",size:"18px",class:"q-mr-xs"}),q("span",A,w(E.value.name),1)]),_:1})):b("",!0)])]),_:1}),x(t,{align:"right",class:"q-pt-lg"},{default:f(()=>[x(o,{label:"Cancel",color:"grey",flat:"",onClick:m[4]||(m[4]=a=>e.$emit("cancel")),class:"q-px-md"}),x(o,{label:"Save Settings",icon:"save",color:"primary",onClick:le,disable:!R.value,class:"q-px-xl"},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{B as default};
