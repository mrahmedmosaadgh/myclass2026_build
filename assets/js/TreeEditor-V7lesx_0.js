import{o as e,n as l,d as n,f as i,Q as o,L as a}from"./app-BwCflFkV.js";import{Q as d}from"./QTree-BBsOhMB0.js";import t from"./DraggableItem-CMvE58ZT.js";import{f as r,k as u,L as s,I as c,b as f,V as m,U as p,J as v,M as h,O as g,H as V,a1 as y,$ as b}from"./vendor-CUZ9QTQV.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";const k={class:"row items-center justify-between full-width"},w={class:"row items-center text-xs"},j={key:0},N={key:0,class:"row items-center text-xs full-width-row"},x=e({__name:"TreeEditor",props:{modelValue:{type:Array,required:!0},filter:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:x}){const C=e,J=x,O=r(JSON.parse(JSON.stringify(C.modelValue))),S=r(null),_=r([]),D=r(null),I=r(!1),T=r(!1);function U(){J("update:modelValue",JSON.parse(JSON.stringify(O.value)))}function z(e){e.editing=!1,U()}function Q(e,l){for(let n=0;n<e.length;n++){if(e[n].id==l){const l=e[n];return e.splice(n,1),l}if(e[n].children){const i=Q(e[n].children,l);if(i)return i}}}function q(e,l,n){for(const i of e){if(i.id==l)return i.children||(i.children=[]),i.children.push(n),!0;if(i.children){if(q(i.children,l,n))return!0}}}function B(e,l){if(!e.children)return!1;for(const n of e.children)if(n.id===l||B(n,l))return!0;return!1}function K({draggedId:e,targetId:l}){if(e===l)return;const n=Q(O.value,e),i=L(O.value,l);if(n&&i){if(B(n,l))return console.warn("Cannot move parent into its child"),void U();q(O.value,l,n),_.value.push(l),U()}}function L(e,l){for(const n of e){if(n.id==l)return n;if(n.children){const e=L(n.children,l);if(e)return e}}}function A(e){clearTimeout(D.value),D.value=setTimeout(()=>{_.value.includes(e)||_.value.push(e)},500)}function E(){clearTimeout(D.value)}return u(()=>C.modelValue,e=>{O.value=JSON.parse(JSON.stringify(e))},{deep:!0}),(r,u)=>(c(),s("div",null,[f(l,{modelValue:I.value,"onUpdate:modelValue":u[0]||(u[0]=e=>I.value=e),label:"edit_mood"},null,8,["modelValue"]),m(" "+p(I.value)+" ",1),f(l,{modelValue:T.value,"onUpdate:modelValue":u[1]||(u[1]=e=>T.value=e),label:"isDraggable"},null,8,["modelValue"]),m(" "+p(T.value)+" ",1),f(d,{nodes:O.value,"node-key":"id",selected:S.value,expanded:_.value,filter:e.filter},{"default-header":v(e=>[f(t,{draggable:T.value,id:e.node.id,onDrop:K,onDragover:A,onDragleave:E},{default:v(()=>[h("div",k,[h("div",w,[f(n,{name:e.node.icon||"folder",class:"q-mr-sm"},null,8,["name"]),e.node.editing?(c(),V(i,{key:1,modelValue:e.node.label,"onUpdate:modelValue":l=>e.node.label=l,dense:"",autofocus:"",onBlur:l=>z(e.node),onKeyup:y(l=>z(e.node),["enter"])},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeyup"])):(c(),s("div",j,p(e.node.label),1))]),I.value?(c(),s("div",N,[f(o,{flat:"",dense:"",icon:"edit",size:"sm",onClick:b(l=>{e.node.editing=!0},["stop"])},null,8,["onClick"]),f(o,{flat:"",dense:"",icon:"add",size:"sm",onClick:b(l=>function(e){const l={id:a(),label:"New Node",children:[]};e.children||(e.children=[]),e.children.push(l),_.value.push(e.id),U()}(e.node),["stop"])},null,8,["onClick"]),f(o,{flat:"",dense:"",icon:"delete",size:"sm",color:"negative",onClick:b(l=>{return n=e.node,O.value=function e(l,n){return l.filter(l=>l.id!==n&&(l.children&&(l.children=e(l.children,n)),!0))}(O.value,n.id),void U();var n},["stop"])},null,8,["onClick"])])):g("",!0)])]),_:2},1032,["draggable","id"])]),_:1},8,["nodes","selected","expanded","filter"])]))}},[["__scopeId","data-v-34f90fc2"]]);export{x as default};
