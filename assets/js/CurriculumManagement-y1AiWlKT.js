import{p as e,u as l,Q as a,d as i,D as t,q as o,C as u,n as s,m as n,b as d,g as r,l as c,a as m}from"./app-BXm70mdJ.js";import{Q as v}from"./QTd-BIxMTYzb.js";import{Q as p}from"./QTable-rnEofRem.js";import{Q as g}from"./QSelect-CnZtzPIC.js";import{Q as b}from"./QSpace-Bu8V-QDa.js";import f from"./CurriculumLessonsManager-V3o2ktHB.js";import{E as y}from"./ExcelManager-DuX2YoQZ.js";import{f as _,r as h,a as j,o as w,L as V,I as C,M as k,b as x,J as U,V as S,U as q,H as Q,O as $,Z as A}from"./vendor-DNM7Y6Xn.js";import"./offline-BzIlwqNM.js";import"./i18n-CBOKL2HS.js";import"./ui-BP0GJNn5.js";import"./QMarkupTable-Dmg3C5Wm.js";import"./QLinearProgress-Cix0cchl.js";import"./use-fullscreen-FlxrEg_V.js";import"./rtl-Cr6c3OOr.js";import"./vuedraggable.umd-BqRLJd4h.js";import"./index-CUaaxLlN.js";import"./QTab-DhKL91H_.js";import"./QTabs-CDJ215OP.js";import"./QTabPanel-sB32VrK8.js";import"./use-panel-D2HepUiw.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-LFwTBPSC.js";import"./QFile-BmfyT66f.js";import"./use-file-s-H4_Vj8.js";import"./QTr-CHmCMIZo.js";import"./xlsx-cMC2LkxH.js";const P={class:"q-pa-md"},F={class:"row items-center q-mb-lg"},N={class:"col-auto q-gutter-sm"},T={class:"q-gutter-md"},E={class:"text-h6"},D={class:"q-gutter-md"},M=e({__name:"CurriculumManagement",setup(e){const M=l(),I=_([]),L=_([]),z=_([]),B=_([]),G=_([]),O=_([]),R=_(!1),J=_(!1),H=_(!1),K=_(!1),Y=_(!1),Z=_(!1),W=_(!1),X=_(!1),ee=_(!1),le=_(!1),ae=_(!1),ie=_(null),te=_(null),oe=h({school_id:null,subject_id:null,grade_id:null,active:null}),ue=h({school_id:null,subject_id:null,grade_id:null,name:"",description:"",active:!1}),se=[{name:"name",required:!0,label:"Curriculum Name",align:"left",field:"name",sortable:!0},{name:"school",label:"School",align:"left",field:e=>{var l;return(null==(l=e.school)?void 0:l.name)||"N/A"},sortable:!1},{name:"subject",label:"Subject",align:"left",field:e=>{var l;return(null==(l=e.subject)?void 0:l.name)||"N/A"},sortable:!1},{name:"grade",label:"Grade",align:"left",field:e=>{var l;return(null==(l=e.grade)?void 0:l.name)||"N/A"},sortable:!1},{name:"active",label:"Status",align:"center",field:"active",sortable:!0},{name:"created_at",label:"Created",align:"left",field:"created_at",format:e=>new Date(e).toLocaleDateString(),sortable:!0},{name:"actions",label:"Actions",align:"center",field:"actions",sortable:!1}],ne=_({sortBy:"created_at",descending:!0,page:1,rowsPerPage:15,rowsNumber:0}),de=[{label:"Active",value:1},{label:"Inactive",value:0}],re=j(()=>I.value.map(e=>{var l,a,i;return{name:e.name,school:(null==(l=e.school)?void 0:l.name)||"",subject:(null==(a=e.subject)?void 0:a.name)||"",grade:(null==(i=e.grade)?void 0:i.name)||"",description:e.description||"",active:1===e.active?"Yes":"No"}})),ce=async e=>{if(e){K.value=!0;try{const l=await A.get(`/api/curriculum/school/${e}/subjects`);G.value=l.data}catch(l){M.notify({type:"negative",message:"Failed to load subjects"})}finally{K.value=!1}}else G.value=[]},me=async e=>{if(e){Y.value=!0;try{const l=await A.get(`/api/curriculum/school/${e}/grades`);O.value=l.data}catch(l){M.notify({type:"negative",message:"Failed to load grades"})}finally{Y.value=!1}}else O.value=[]},ve=async()=>{var e,l,a;Z.value=!0;try{const i=new URLSearchParams,t=(null==(e=oe.school_id)?void 0:e.id)||oe.school_id,o=(null==(l=oe.subject_id)?void 0:l.id)||oe.subject_id,u=(null==(a=oe.grade_id)?void 0:a.id)||oe.grade_id;t&&i.append("school_id",t),o&&i.append("subject_id",o),u&&i.append("grade_id",u),null!==oe.active&&i.append("active",oe.active);const s=await A.get(`/api/curriculum/curricula?${i}`);I.value=s.data.data,ne.value.rowsNumber=s.data.total}catch(i){M.notify({type:"negative",message:"Failed to load curricula"})}finally{Z.value=!1}},pe=e=>{const l=(null==e?void 0:e.id)||e;oe.school_id=l,oe.subject_id=null,oe.grade_id=null,l?((async e=>{if(e){J.value=!0;try{const l=await A.get(`/api/curriculum/school/${e}/subjects`);z.value=l.data}catch(l){M.notify({type:"negative",message:"Failed to load subjects"})}finally{J.value=!1}}else z.value=[]})(l),(async e=>{if(e){H.value=!0;try{const l=await A.get(`/api/curriculum/school/${e}/grades`);B.value=l.data}catch(l){M.notify({type:"negative",message:"Failed to load grades"})}finally{H.value=!1}}else B.value=[]})(l)):(z.value=[],B.value=[])},ge=e=>{const l=(null==e?void 0:e.id)||e;ue.school_id=l,ue.subject_id=null,ue.grade_id=null,l?(ce(l),me(l)):(G.value=[],O.value=[])},be=e=>{const{page:l,rowsPerPage:a,sortBy:i,descending:t}=e.pagination;ne.value.page=l,ne.value.rowsPerPage=a,ne.value.sortBy=i,ne.value.descending=t,ve()},fe=()=>{ee.value=!1,ve()},ye=()=>{oe.school_id=null,oe.subject_id=null,oe.grade_id=null,oe.active=null,z.value=[],B.value=[]},_e=async e=>{var l,a;try{const l=e.filter(e=>e.name&&e.school&&e.subject&&e.grade);if(0===l.length)return void M.notify({type:"negative",message:"No valid curricula found in imported data"});const a=await A.post("/api/curriculum/bulk-import",{curricula:l});M.notify({type:"positive",message:`Successfully imported ${a.data.imported} curricula`}),ae.value=!1,ve()}catch(i){M.notify({type:"negative",message:(null==(a=null==(l=i.response)?void 0:l.data)?void 0:a.message)||"Failed to import curricula"})}},he=e=>{M.notify({type:"positive",message:`Exported ${e.recordCount} curricula to ${e.fileName}`})},je=()=>{we(),X.value=!0},we=()=>{ue.school_id=null,ue.subject_id=null,ue.grade_id=null,ue.name="",ue.description="",ue.active=!1,G.value=[],O.value=[],ie.value=null},Ve=()=>{X.value=!1,we()},Ce=async()=>{var e,l,a,i,t;if(ue.school_id)if(ue.subject_id)if(ue.grade_id)if(ue.name&&""!==ue.name.trim()){W.value=!0;try{const i={name:ue.name.trim(),description:ue.description.trim(),school_id:(null==(e=ue.school_id)?void 0:e.id)||ue.school_id,subject_id:(null==(l=ue.subject_id)?void 0:l.id)||ue.subject_id,grade_id:(null==(a=ue.grade_id)?void 0:a.id)||ue.grade_id,active:ue.active?1:0};ie.value?(await A.put(`/api/curriculum/curricula/${ie.value.id}`,i),M.notify({type:"positive",message:"Curriculum updated successfully"})):(await A.post("/api/curriculum/curricula",i),M.notify({type:"positive",message:"Curriculum created successfully"})),Ve(),ve()}catch(o){M.notify({type:"negative",message:(null==(t=null==(i=o.response)?void 0:i.data)?void 0:t.message)||"Failed to save curriculum"})}finally{W.value=!1}}else M.notify({type:"negative",message:"Please enter a curriculum name"});else M.notify({type:"negative",message:"Please select a grade"});else M.notify({type:"negative",message:"Please select a subject"});else M.notify({type:"negative",message:"Please select a school"})};return w(()=>{(async()=>{R.value=!0;try{const e=await A.get("/api/curriculum/user-schools");L.value=e.data}catch(e){M.notify({type:"negative",message:"Failed to load schools"})}finally{R.value=!1}})(),ve()}),(e,l)=>(C(),V("div",P,[k("div",F,[l[19]||(l[19]=k("div",{class:"col"},[k("h4",{class:"text-h4 q-my-none"},"Curriculum Management"),k("p",{class:"text-grey-6 q-mb-none"},"Manage curricula for your schools and subjects")],-1)),k("div",N,[x(a,{color:"primary",icon:"add",label:"Add Curriculum",onClick:je,unelevated:""}),x(a,{color:"primary",icon:"filter_list",label:"Filter",onClick:l[0]||(l[0]=e=>ee.value=!0),unelevated:""}),x(a,{color:"primary",icon:"import_export",label:"Import/Export",onClick:l[1]||(l[1]=e=>ae.value=!0),unelevated:""})])]),x(s,null,{default:U(()=>[x(i,null,{default:U(()=>[x(p,{rows:I.value,columns:se,"row-key":"id",loading:Z.value,pagination:ne.value,onRequest:be,"binary-state-sort":""},{"body-cell-active":U(e=>[x(v,{props:e},{default:U(()=>[x(u,{color:1===e.value?"green":"grey","text-color":1===e.value?"white":"black",size:"sm"},{default:U(()=>[S(q(1===e.value?"Active":"Inactive"),1)]),_:2},1032,["color","text-color"])]),_:2},1032,["props"])]),"body-cell-actions":U(e=>[x(v,{props:e},{default:U(()=>[x(t,{flat:""},{default:U(()=>[x(a,{flat:"",dense:"",color:"info",icon:"visibility",onClick:l=>{return a=e.row,te.value=a,void(le.value=!0);var a},size:"sm"},{default:U(()=>[x(o,null,{default:U(()=>l[20]||(l[20]=[S("View Lessons")])),_:1})]),_:2},1032,["onClick"]),x(a,{flat:"",dense:"",color:"primary",icon:"edit",onClick:l=>{return a=e.row,ie.value=a,ue.school_id=a.school||{id:a.school_id,name:"Unknown"},ue.subject_id=a.subject||{id:a.subject_id,name:"Unknown"},ue.grade_id=a.grade||{id:a.grade_id,name:"Unknown"},ue.name=a.name,ue.description=a.description||"",ue.active=1===a.active,G.value=[a.subject||{id:a.subject_id,name:"Unknown"}],O.value=[a.grade||{id:a.grade_id,name:"Unknown"}],ce(a.school_id),me(a.school_id),void(X.value=!0);var a},size:"sm"},{default:U(()=>[x(o,null,{default:U(()=>l[21]||(l[21]=[S("Edit")])),_:1})]),_:2},1032,["onClick"]),x(a,{flat:"",dense:"",color:1===e.row.active?"orange":"green",icon:1===e.row.active?"pause":"play_arrow",onClick:l=>(async e=>{const l=1===e.active?"deactivate":"activate",a=1===e.active?"deactivate":"activate";M.dialog({title:"Confirm Action",message:`Are you sure you want to ${a} this curriculum?${"activate"===l?" This will deactivate other curricula for the same subject and grade.":""}`,cancel:!0,persistent:!0}).onOk(async()=>{var i,t;try{await A.post(`/api/curriculum/curricula/${e.id}/${l}`),M.notify({type:"positive",message:`Curriculum ${a}d successfully`}),ve()}catch(o){M.notify({type:"negative",message:(null==(t=null==(i=o.response)?void 0:i.data)?void 0:t.message)||`Failed to ${a} curriculum`})}})})(e.row),size:"sm"},{default:U(()=>[x(o,null,{default:U(()=>[S(q(1===e.row.active?"Deactivate":"Activate"),1)]),_:2},1024)]),_:2},1032,["color","icon","onClick"]),x(a,{flat:"",dense:"",color:"negative",icon:"delete",onClick:l=>(async e=>{M.dialog({title:"Confirm Deletion",message:`Are you sure you want to delete "${e.name}"? This action cannot be undone.`,cancel:!0,persistent:!0,color:"negative"}).onOk(async()=>{var l,a;try{await A.delete(`/api/curriculum/curricula/${e.id}`),M.notify({type:"positive",message:"Curriculum deleted successfully"}),ve()}catch(i){M.notify({type:"negative",message:(null==(a=null==(l=i.response)?void 0:l.data)?void 0:a.message)||"Failed to delete curriculum"})}})})(e.row),size:"sm"},{default:U(()=>[x(o,null,{default:U(()=>l[22]||(l[22]=[S("Delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])]),_:1})]),_:1}),x(d,{modelValue:ee.value,"onUpdate:modelValue":l[7]||(l[7]=e=>ee.value=e)},{default:U(()=>[x(s,{style:{"min-width":"500px"}},{default:U(()=>[x(i,null,{default:U(()=>l[23]||(l[23]=[k("div",{class:"text-h6"},"Filter Curricula",-1)])),_:1}),x(i,{class:"q-pt-none"},{default:U(()=>[k("div",T,[x(g,{modelValue:oe.school_id,"onUpdate:modelValue":[l[2]||(l[2]=e=>oe.school_id=e),pe],options:L.value,"option-value":"id","option-label":"name",label:"Select School",outlined:"",clearable:"",loading:R.value},null,8,["modelValue","options","loading"]),x(g,{modelValue:oe.subject_id,"onUpdate:modelValue":l[3]||(l[3]=e=>oe.subject_id=e),options:z.value,"option-value":"id","option-label":"name",label:"Select Subject",outlined:"",clearable:"",disable:!oe.school_id,loading:J.value},null,8,["modelValue","options","disable","loading"]),x(g,{modelValue:oe.grade_id,"onUpdate:modelValue":l[4]||(l[4]=e=>oe.grade_id=e),options:B.value,"option-value":"id","option-label":"name",label:"Select Grade",outlined:"",clearable:"",disable:!oe.school_id,loading:H.value},null,8,["modelValue","options","disable","loading"]),x(g,{modelValue:oe.active,"onUpdate:modelValue":l[5]||(l[5]=e=>oe.active=e),options:de,label:"Status",outlined:"",clearable:""},null,8,["modelValue"])])]),_:1}),x(n,{align:"right"},{default:U(()=>[x(a,{flat:"",label:"Clear",onClick:ye}),x(a,{flat:"",label:"Cancel",onClick:l[6]||(l[6]=e=>ee.value=!1)}),x(a,{color:"primary",label:"Apply",onClick:fe,loading:Z.value,unelevated:""},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),x(d,{modelValue:X.value,"onUpdate:modelValue":l[14]||(l[14]=e=>X.value=e),persistent:""},{default:U(()=>[x(s,{style:{"min-width":"500px"}},{default:U(()=>[x(i,null,{default:U(()=>[k("div",E,q(ie.value?"Edit Curriculum":"Add New Curriculum"),1)]),_:1}),x(i,{class:"q-pt-none"},{default:U(()=>[k("div",D,[x(g,{modelValue:ue.school_id,"onUpdate:modelValue":[l[8]||(l[8]=e=>ue.school_id=e),ge],options:L.value,"option-value":"id","option-label":"name",label:"School *",outlined:"",rules:[e=>!!e||"School is required"],loading:R.value,disable:ie.value},null,8,["modelValue","options","rules","loading","disable"]),x(g,{modelValue:ue.subject_id,"onUpdate:modelValue":l[9]||(l[9]=e=>ue.subject_id=e),options:G.value,"option-value":"id","option-label":"name",label:"Subject *",outlined:"",rules:[e=>!!e||"Subject is required"],disable:!ue.school_id||ie.value,loading:K.value},null,8,["modelValue","options","rules","disable","loading"]),x(g,{modelValue:ue.grade_id,"onUpdate:modelValue":l[10]||(l[10]=e=>ue.grade_id=e),options:O.value,"option-value":"id","option-label":"name",label:"Grade *",outlined:"",rules:[e=>!!e||"Grade is required"],disable:!ue.school_id||ie.value,loading:Y.value},null,8,["modelValue","options","rules","disable","loading"]),x(r,{modelValue:ue.name,"onUpdate:modelValue":l[11]||(l[11]=e=>ue.name=e),label:"Curriculum Name *",outlined:"",rules:[e=>!!e||"Name is required"]},null,8,["modelValue","rules"]),x(r,{modelValue:ue.description,"onUpdate:modelValue":l[12]||(l[12]=e=>ue.description=e),label:"Description",type:"textarea",rows:"3",outlined:""},null,8,["modelValue"]),x(c,{modelValue:ue.active,"onUpdate:modelValue":l[13]||(l[13]=e=>ue.active=e),label:"Set as Active (will deactivate other curricula for this subject and grade)",color:"primary"},null,8,["modelValue"])])]),_:1}),x(n,{align:"right"},{default:U(()=>[x(a,{flat:"",label:"Cancel",onClick:Ve}),x(a,{color:"primary",label:"Save",onClick:Ce,loading:W.value,unelevated:""},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),x(d,{modelValue:le.value,"onUpdate:modelValue":l[16]||(l[16]=e=>le.value=e),"full-width":"","full-height":""},{default:U(()=>[te.value?(C(),Q(f,{key:0,curriculum:te.value,onClose:l[15]||(l[15]=e=>le.value=!1),onUpdated:ve},null,8,["curriculum"])):$("",!0)]),_:1},8,["modelValue"]),x(d,{modelValue:ae.value,"onUpdate:modelValue":l[18]||(l[18]=e=>ae.value=e),"full-width":""},{default:U(()=>[x(s,null,{default:U(()=>[x(i,{class:"row items-center q-pb-none"},{default:U(()=>[l[24]||(l[24]=k("div",{class:"text-h6"},"Import/Export Curricula",-1)),x(b),x(a,{icon:"close",flat:"",round:"",dense:"",onClick:l[17]||(l[17]=e=>ae.value=!1)})]),_:1}),x(m),x(i,null,{default:U(()=>[x(y,{"export-data":re.value,"export-file-name":"curricula_template.xlsx",onImportedJson:_e,onExported:he},null,8,["export-data"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-6c71d093"]]);export{M as default};
