import{f as e,a as r,L as a,I as t,b as o,M as s,y as l,a3 as i,O as n,U as d,J as c,V as u,F as p,_ as m}from"./vendor-CUZ9QTQV.js";import{_ as b}from"./PrimaryButton-DNYxrPcC.js";import{_ as v}from"./SecondaryButton-BH3tlEGv.js";import{_ as j}from"./Pagination-CZ87PeIC.js";import{_ as g}from"./DataTable-CQiV1Hx1.js";import{_ as f}from"./FormModal-DS6LZPtQ.js";import{_ as x}from"./ImportExcel-3BOLBL-P.js";import{u as _,w as y}from"./xlsx-cMC2LkxH.js";import"./LucideIcon-BIJr1cpK.js";import"./createLucideIcon-D8qi68V_.js";import"./align-right-BZZ7ajs4.js";import"./underline-o77cex9c.js";import"./image-odJN2dKV.js";import"./printer-D7revZzT.js";import"./Modal-Bxqmvcy5.js";import"./app-BwCflFkV.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";const h={class:"py-12"},w={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},S={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-6"},k={key:0,class:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4"},G={class:"flex justify-between items-center mb-6"},M={class:"flex space-x-2"},I={key:1,class:"mt-4"},$="/admin/grade-subject",E={__name:"Index",props:{records:Object,options:Object},setup(E){const q=E,D=[{key:"grade",label:"Grade Name",required:!0,description:"Must match an existing grade name"},{key:"subject",label:"Subject Name",required:!0,description:"Must match an existing subject name"}],A=e(!1),F=e(null),O=e(!1),P=r(()=>q.records.data),T=r(()=>q.records.links),C=[{key:"grade.name",label:"Grade"},{key:"subject.name",label:"Subject"}],L=[{name:"grade_id",label:"Grade",type:"select",required:!0,placeholder:"Select a grade",options:r(()=>{var e,r;return(null==(r=null==(e=q.options)?void 0:e.grades)?void 0:r.map(e=>({value:e.id,label:e.name})))||[]})},{name:"subject_id",label:"Subject",type:"select",required:!0,placeholder:"Select a subject",options:r(()=>{var e,r;return(null==(r=null==(e=q.options)?void 0:e.subjects)?void 0:r.map(e=>({value:e.id,label:e.name})))||[]})}],N=(e=null)=>{F.value=e,A.value=!0},U=()=>{A.value=!1,F.value=null},B=()=>{m.reload({only:["records"]})},z=async({form:e,onSuccess:r,onError:a})=>{var t,o,s;if(console.log({form:e,onSuccess:r,onError:a}),O.value)return;O.value=!0;const l=null==(t=F.value)?void 0:t.id,i=l?`${$}/${l}`:$;try{const a={grade_id:e.grade_id,subject_id:e.subject_id};await axios.post(i,{...l&&{_method:"PUT"},...a}),r(),U(),B()}catch(n){(null==(s=null==(o=n.response)?void 0:o.data)?void 0:s.errors)?a(n.response.data.errors):a({error:["An unexpected error occurred"]})}finally{O.value=!1}},J=async e=>{if(confirm("Are you sure you want to delete this mapping?"))try{await axios.delete(`${$}/${e.id}`),B()}catch(r){console.error("Deletion error:",r),alert("An error occurred while deleting the record.")}},V=()=>{try{const e=[["Grade","Subject"],...P.value.map(e=>{var r,a;return[(null==(r=e.grade)?void 0:r.name)||"",(null==(a=e.subject)?void 0:a.name)||""]})],r=_.aoa_to_sheet(e),a=_.book_new();_.book_append_sheet(a,r,"Grade Subjects");const t=`grade_subjects_${(new Date).toISOString().split("T")[0]}.xlsx`;y(a,t)}catch(e){console.error("Export failed:",e),alert("Failed to export data")}};return(e,r)=>{var m;return t(),a(p,null,[o(l(i),{title:"Grade Subject Mappings"}),s("div",h,[s("div",w,[s("div",S,[(null==(m=e.$page.props.flash)?void 0:m.success)?(t(),a("div",k,d(e.$page.props.flash.success),1)):n("",!0),s("div",G,[s("div",M,[o(b,{onClick:r[0]||(r[0]=e=>N())},{default:c(()=>r[1]||(r[1]=[u(" Add New Mapping ")])),_:1}),o(x,{onImported:B,"validate-url":$+"/validate-import","import-url":$+"/import",columns:D,"button-text":"Import Mappings","preview-title":"Preview Grade Subject Data"},null,8,["validate-url","import-url"]),o(v,{onClick:V},{default:c(()=>r[2]||(r[2]=[u(" Export ")])),_:1})])]),o(g,{items:P.value,columns:C,onEdit:N,onDelete:J},null,8,["items"]),T.value?(t(),a("div",I,[o(j,{links:T.value},null,8,["links"])])):n("",!0)])])]),o(f,{show:A.value,title:"Grade Subject Mapping",fields:L,editing:F.value,onClose:U,onSubmitted:z},null,8,["show","editing"])],64)}}};export{E as default};
