import{u as e,f as a,Q as o,aS as l,b as t,h as i,be as s,d as n,c as r,i as c,j as u,k as d,g as p,G as m,e as v}from"./app-CmR0nRZC.js";import{Q as b}from"./QSpace-DLpWPxtA.js";import{Q as g}from"./QSelect-CiD02PIi.js";import{Q as y}from"./QStepperNavigation-DxpGK3kM.js";import{Q as f,a as h}from"./QStepper-BgYcKVtw.js";import{Q as _}from"./QTd-BfUBupf2.js";import{Q as w}from"./QBadge-BkyG8a2n.js";import{Q as k}from"./QTable-twXUsOYs.js";import{a as I,f as C,I as x,J as V,K as S,b as q,R as j,y as A,W as B,N,O as P,V as Q,_ as O}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";import"./use-panel-CkLmuBWI.js";import"./use-render-cache-CmTcazfP.js";import"./QMarkupTable-D7EQqc1V.js";import"./QLinearProgress-CQupa4Ep.js";import"./use-fullscreen-DVo7i5vz.js";const T={class:"q-gutter-md"},U={class:"q-gutter-sm"},z={key:0},$={class:"row items-center"},E={class:"col"},F={class:"col-auto q-gutter-sm"},J={key:0,class:"text-caption text-negative"},G={__name:"BehaviorAIGeneratorDialog",props:{modelValue:Boolean,schoolId:[Number,String]},emits:["update:modelValue","success"],setup(G,{emit:R}){const M=e(),L=G,D=R,H=I({get:()=>L.modelValue,set:e=>D("update:modelValue",e)}),K=C(1),W=C(!1),Y=C(!1),X=C({count:10,type:"mixed",category:"",customInstructions:"",language:"Bilingual (Both)"}),Z=C(""),ee=C(""),ae=C([]),oe=[{value:"positive",label:"âœ… Positive Only"},{value:"negative",label:"âŒ Negative Only"},{value:"mixed",label:"ðŸ”€ Mixed (Both)"}],le=[{name:"number",label:"#",field:"index",align:"center",style:"width: 50px"},{name:"name",label:"Name (EN)",field:"name",align:"left"},{name:"name_ar",label:"Name (AR)",field:"name_ar",align:"left"},{name:"type",label:"Type",field:"type",align:"center"},{name:"points",label:"Points",field:"points",align:"center"},{name:"description",label:"Description",field:"description",align:"left"},{name:"status",label:"Status",align:"center"}],te=I(()=>ae.value.filter(e=>!e.valid).length),ie=C([]),se=I(()=>ie.value.length),ne=()=>{const e=[`Generate ${X.value.count} student behavior definitions for a school reward system.`,"","Type: "+("mixed"===X.value.type?"Both positive and negative behaviors":X.value.type+" behaviors only"),X.value.category?`Category/Theme: ${X.value.category}`:"",`Language: ${X.value.language}`,"",X.value.customInstructions?`Additional Instructions:\n${X.value.customInstructions}`:"","","Return ONLY a valid JSON object in this exact format:","```json",JSON.stringify({behaviors:[{name:"Behavior name in English",name_ar:"Behavior name in Arabic (if language is Arabic or Bilingual)",type:"positive",points:1,description:"Optional category or description"},{name:"Another behavior",name_ar:"Ø³Ù„ÙˆÙƒ Ø¢Ø®Ø±",type:"negative",points:-1,description:"Optional"}]},null,2),"```","","Important rules:","- name is required (English)","- name_ar is optional but recommended for bilingual support",'- type must be "positive" or "negative"',"- points should be reasonable (1-10 for positive, -1 to -10 for negative)","- description is optional","- Make behaviors specific, observable, and age-appropriate","- Focus on behaviors that can be consistently measured"];Z.value=e.filter(Boolean).join("\n"),K.value=2},re=async()=>{try{await navigator.clipboard.writeText(Z.value),M.notify({type:"positive",message:"Prompt copied to clipboard!",icon:"content_copy",position:"top"})}catch(e){M.notify({type:"negative",message:"Failed to copy to clipboard",position:"top"})}},ce=async()=>{try{const e=await navigator.clipboard.readText();ee.value=e,M.notify({type:"positive",message:"Pasted from clipboard!",icon:"content_paste",position:"top"})}catch(e){M.notify({type:"negative",message:"Failed to read from clipboard",caption:"Please paste manually using Ctrl+V or Cmd+V",position:"top"})}},ue=()=>{W.value=!0;try{let e;const a=ee.value.trim(),o=a.match(/```(?:json)?\s*([\s\S]*?)```/);if(e=o?JSON.parse(o[1]):JSON.parse(a),!e.behaviors||!Array.isArray(e.behaviors))throw new Error('Invalid format: "behaviors" array not found');ae.value=e.behaviors.map((e,a)=>{const o=[];return e.name||o.push("Missing name"),["positive","negative"].includes(e.type)||o.push("Invalid type"),e.points&&"number"==typeof e.points||o.push("Invalid points"),{...e,index:a,valid:0===o.length,errors:o.join(", "),school_id:L.schoolId||1}}),K.value=4,ie.value=ae.value.filter(e=>e.valid),M.notify({type:"positive",message:`Validated ${ae.value.length} behaviors`,position:"top"})}catch(e){M.notify({type:"negative",message:"Invalid JSON format",caption:e.message,position:"top"})}finally{W.value=!1}},de=()=>{ie.value=ae.value.filter(e=>e.valid)},pe=()=>{ie.value=[]},me=()=>{const e=new Set(ie.value.map(e=>e.index));ie.value=ae.value.filter(a=>a.valid&&!e.has(a.index))},ve=async()=>{var e,a;Y.value=!0;const o=ie.value.filter(e=>e.valid);if(0===o.length)return M.notify({type:"warning",message:"No behaviors selected",position:"top"}),void(Y.value=!1);try{const e=await O.post("/api/behaviors/bulk",{behaviors:o,school_id:L.schoolId||1}),a=e.data.summary||{},l=e.data.errors||[];if(!(a.created>0)){const e=l.length>0?l[0].error:"No behaviors were created.";throw new Error(e)}{const e=a.errors>0?`Created ${a.created} behaviors. ${a.errors} failed.`:`Successfully created ${a.created} behaviors!`;M.notify({type:a.errors>0?"warning":"positive",message:e,icon:"check_circle",position:"top",timeout:5e3}),H.value=!1,D("success")}}catch(l){console.error("Bulk insert error:",l),M.notify({type:"negative",message:"Failed to create behaviors",caption:(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||l.message,position:"top",timeout:5e3})}finally{Y.value=!1}},be=e=>{const a={academic:{count:15,type:"positive",category:"Academic Excellence",customInstructions:"Focus on learning achievements, homework completion, participation, and academic progress."},conduct:{count:20,type:"mixed",category:"Classroom Conduct",customInstructions:"Include both positive behaviors (following rules, respect) and negative behaviors (disruption, tardiness)."},social:{count:12,type:"positive",category:"Social Skills",customInstructions:"Focus on interpersonal skills, teamwork, kindness, and peer relationships."},comprehensive:{count:30,type:"mixed",category:"",customInstructions:"Create a comprehensive set covering academic, social, and behavioral aspects with balanced positive and negative behaviors."}}[e];a&&(Object.assign(X.value,a),M.notify({type:"info",message:`Applied "${e}" preset`,position:"top"}))},ge=e=>{X.value.customInstructions?X.value.customInstructions+="\n- "+e:X.value.customInstructions="- "+e,M.notify({type:"positive",message:"Instruction added",position:"top"})};return(e,I)=>(V(),x(v,{modelValue:H.value,"onUpdate:modelValue":I[21]||(I[21]=e=>H.value=e),maximized:""},{default:S(()=>[q(n,null,{default:S(()=>[q(a,{class:"row items-center q-pb-none"},{default:S(()=>[q(o,{name:"auto_awesome",size:"md",color:"secondary",class:"q-mr-sm"}),I[22]||(I[22]=j("div",{class:"text-h6"},"AI Behavior Generator",-1)),q(b),A(q(t,{icon:"close",flat:"",round:"",dense:""},null,512),[[l]])]),_:1}),q(a,null,{default:S(()=>[q(f,{modelValue:K.value,"onUpdate:modelValue":I[20]||(I[20]=e=>K.value=e),vertical:"",color:"secondary",animated:""},{default:S(()=>[q(h,{name:1,title:"Configure AI Prompt",icon:"settings",done:K.value>1},{default:S(()=>[j("div",T,[q(i,{modelValue:X.value.count,"onUpdate:modelValue":I[0]||(I[0]=e=>X.value.count=e),modelModifiers:{number:!0},type:"number",label:"Number of Behaviors *",min:"1",max:"30",hint:"How many behaviors to generate (1-30)",rules:[e=>e>0&&e<=30||"Must be between 1 and 30"]},null,8,["modelValue","rules"]),q(g,{modelValue:X.value.type,"onUpdate:modelValue":I[1]||(I[1]=e=>X.value.type=e),options:oe,label:"Behavior Type *","emit-value":"","map-options":"",hint:"Select the type of behaviors to generate",rules:[e=>!!e||"Type is required"]},null,8,["modelValue","rules"]),q(i,{modelValue:X.value.category,"onUpdate:modelValue":I[2]||(I[2]=e=>X.value.category=e),label:"Category/Theme (Optional)",outlined:"",hint:"e.g., 'Academic Excellence', 'Classroom Conduct', 'Social Skills'",placeholder:"Enter a category or theme..."},null,8,["modelValue"]),q(i,{modelValue:X.value.customInstructions,"onUpdate:modelValue":I[3]||(I[3]=e=>X.value.customInstructions=e),type:"textarea",label:"Additional Instructions / Context",outlined:"",rows:"3",hint:"Add any special requirements or style preferences",placeholder:"e.g., 'Focus on elementary school behaviors', 'Include specific examples'"},null,8,["modelValue"]),q(s,{icon:"lightbulb",label:"Smart Presets",caption:"Click for quick configuration templates",class:"q-mb-md"},{default:S(()=>[q(n,{flat:"",bordered:"",class:"q-pa-md"},{default:S(()=>[I[27]||(I[27]=j("div",{class:"text-subtitle2 q-mb-sm"},"Quick Presets:",-1)),j("div",U,[q(t,{size:"sm",outline:"",color:"secondary",label:"ðŸ“š Academic",onClick:I[4]||(I[4]=e=>be("academic"))}),q(t,{size:"sm",outline:"",color:"secondary",label:"ðŸŽ¯ Conduct",onClick:I[5]||(I[5]=e=>be("conduct"))}),q(t,{size:"sm",outline:"",color:"secondary",label:"ðŸ¤ Social",onClick:I[6]||(I[6]=e=>be("social"))}),q(t,{size:"sm",outline:"",color:"secondary",label:"ðŸŒŸ Comprehensive",onClick:I[7]||(I[7]=e=>be("comprehensive"))})]),q(r,{class:"q-my-md"}),I[28]||(I[28]=j("div",{class:"text-subtitle2 q-mb-sm"},"Suggested Instructions:",-1)),q(c,{dense:""},{default:S(()=>[q(u,{clickable:"",onClick:I[8]||(I[8]=e=>ge("Include specific, observable behaviors"))},{default:S(()=>[q(d,{avatar:""},{default:S(()=>[q(o,{name:"add_circle",color:"secondary"})]),_:1}),q(d,null,{default:S(()=>I[23]||(I[23]=[B("Include specific, observable behaviors")])),_:1})]),_:1}),q(u,{clickable:"",onClick:I[9]||(I[9]=e=>ge("Use age-appropriate language"))},{default:S(()=>[q(d,{avatar:""},{default:S(()=>[q(o,{name:"add_circle",color:"secondary"})]),_:1}),q(d,null,{default:S(()=>I[24]||(I[24]=[B("Use age-appropriate language")])),_:1})]),_:1}),q(u,{clickable:"",onClick:I[10]||(I[10]=e=>ge("Focus on growth mindset"))},{default:S(()=>[q(d,{avatar:""},{default:S(()=>[q(o,{name:"add_circle",color:"secondary"})]),_:1}),q(d,null,{default:S(()=>I[25]||(I[25]=[B("Focus on growth mindset")])),_:1})]),_:1}),q(u,{clickable:"",onClick:I[11]||(I[11]=e=>ge("Include both individual and group behaviors"))},{default:S(()=>[q(d,{avatar:""},{default:S(()=>[q(o,{name:"add_circle",color:"secondary"})]),_:1}),q(d,null,{default:S(()=>I[26]||(I[26]=[B("Include both individual and group behaviors")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),q(g,{modelValue:X.value.language,"onUpdate:modelValue":I[12]||(I[12]=e=>X.value.language=e),options:["English","Arabic","Bilingual (Both)"],label:"Language",hint:"Behavior names language"},null,8,["modelValue"])]),q(y,null,{default:S(()=>[q(t,{onClick:ne,color:"secondary",label:"Generate Prompt",icon:"content_copy"})]),_:1})]),_:1},8,["done"]),q(h,{name:2,title:"Copy Prompt to AI",icon:"content_copy",done:K.value>2},{default:S(()=>[q(n,{flat:"",bordered:""},{default:S(()=>[q(a,null,{default:S(()=>[I[30]||(I[30]=j("div",{class:"text-subtitle2 q-mb-sm"},"Generated Prompt:",-1)),q(i,{modelValue:Z.value,"onUpdate:modelValue":I[13]||(I[13]=e=>Z.value=e),type:"textarea",readonly:"",outlined:"",rows:"15",class:"q-mb-md"},null,8,["modelValue"]),q(t,{onClick:re,color:"secondary",label:"Copy to Clipboard",icon:"content_copy",class:"q-mr-sm"}),q(p,{class:"bg-info text-white q-mt-md"},{avatar:S(()=>[q(o,{name:"info"})]),default:S(()=>[I[29]||(I[29]=B(" Copy this prompt and paste it into ChatGPT, Claude, or Gemini. Then copy the AI's JSON response. "))]),_:1})]),_:1})]),_:1}),q(y,null,{default:S(()=>[q(t,{onClick:I[14]||(I[14]=e=>K.value=3),color:"secondary",label:"Next: Paste AI Response"}),q(t,{flat:"",onClick:I[15]||(I[15]=e=>K.value=1),label:"Back",class:"q-ml-sm"})]),_:1})]),_:1},8,["done"]),q(h,{name:3,title:"Paste AI Response",icon:"paste",done:K.value>3},{default:S(()=>[q(i,{modelValue:ee.value,"onUpdate:modelValue":I[16]||(I[16]=e=>ee.value=e),type:"textarea",label:"Paste AI Response (JSON)",outlined:"",rows:"10",hint:"Paste the JSON response from the AI",class:"q-mb-md"},null,8,["modelValue"]),q(t,{onClick:ce,color:"primary",label:"Paste from Clipboard",icon:"content_paste",outline:"",class:"q-mb-md"}),q(y,null,{default:S(()=>[q(t,{onClick:ue,color:"secondary",label:"Validate & Preview",loading:W.value},null,8,["loading"]),q(t,{flat:"",onClick:I[17]||(I[17]=e=>K.value=2),label:"Back",class:"q-ml-sm"})]),_:1})]),_:1},8,["done"]),q(h,{name:4,title:"Preview & Insert",icon:"preview"},{default:S(()=>[ae.value.length>0?(V(),N("div",z,[q(p,{class:"bg-secondary text-white q-mb-md"},{avatar:S(()=>[q(o,{name:"check_circle"})]),default:S(()=>[j("div",$,[j("div",E,[j("strong",null,Q(se.value),1),I[31]||(I[31]=B(" of ")),j("strong",null,Q(ae.value.length),1),I[32]||(I[32]=B(" behaviors selected "))]),j("div",F,[q(t,{size:"sm",outline:"",color:"white",label:"Select All",onClick:de,icon:"check_box"}),q(t,{size:"sm",outline:"",color:"white",label:"Select None",onClick:pe,icon:"check_box_outline_blank"}),q(t,{size:"sm",outline:"",color:"white",label:"Inverse",onClick:me,icon:"swap_vert"})])])]),_:1}),q(k,{rows:ae.value,columns:le,"row-key":"index",flat:"",bordered:"",selection:"multiple",selected:ie.value,"onUpdate:selected":I[18]||(I[18]=e=>ie.value=e),class:"q-mb-md"},{"body-cell-number":S(e=>[q(_,{props:e},{default:S(()=>[j("strong",null,"#"+Q(e.row.index+1),1)]),_:2},1032,["props"])]),"body-cell-type":S(e=>[q(_,{props:e},{default:S(()=>[q(w,{color:"positive"===e.row.type?"green":"red"},{default:S(()=>[B(Q("positive"===e.row.type?"âœ… Positive":"âŒ Negative"),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-points":S(e=>[q(_,{props:e},{default:S(()=>[q(m,{color:e.row.points>0?"green":"red","text-color":"white",size:"sm"},{default:S(()=>[B(Q(e.row.points>0?"+":"")+Q(e.row.points),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-status":S(e=>[q(_,{props:e},{default:S(()=>[q(w,{color:e.row.valid?"positive":"negative"},{default:S(()=>[B(Q(e.row.valid?"Valid":"Invalid"),1)]),_:2},1032,["color"]),e.row.valid?P("",!0):(V(),N("div",J,Q(e.row.errors),1))]),_:2},1032,["props"])]),_:1},8,["rows","selected"]),te.value>0?(V(),x(p,{key:0,class:"bg-warning text-white q-mb-md"},{avatar:S(()=>[q(o,{name:"warning"})]),default:S(()=>[B(" "+Q(te.value)+" invalid behavior(s) detected (cannot be selected) ",1)]),_:1})):P("",!0)])):P("",!0),q(y,null,{default:S(()=>[q(t,{onClick:ve,color:"secondary",label:`Insert ${se.value} Selected Behavior${1!==se.value?"s":""}`,icon:"upload",loading:Y.value,disable:0===se.value},null,8,["label","loading","disable"]),q(t,{flat:"",onClick:I[19]||(I[19]=e=>K.value=3),label:"Back",class:"q-ml-sm"})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{G as default};
