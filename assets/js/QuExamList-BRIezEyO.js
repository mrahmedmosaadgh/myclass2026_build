import{Q as e}from"./QSpace-BaiVAeLS.js";import{f as l,b as a,t,G as o,d as s,o as r,aS as u,e as i,Q as n}from"./app-4gpSDtVV.js";import{Q as d}from"./QSelect-Dgk9Cshp.js";import{Q as m}from"./QTd-D1GV5G3N.js";import{Q as c}from"./QBadge-6oS4ziQU.js";import{Q as p}from"./QTable-Yrq9AmcZ.js";import{Q as v}from"./QPagination-BWXtNKn7.js";import{Q as b}from"./QBar-BEE9v3eh.js";import{f,r as g,a as _,af as y,N as x,J as w,b as j,R as k,K as h,I as V,O as C,z as Q,W as q,F as S,Q as U,V as A,y as T,$ as E}from"./vendor-BWKGNkNB.js";import{s as G}from"./i18n-B0T1C7j3.js";import z from"./QuExamForm-4ALedpgp.js";import D from"./QuGradingDialog-BwLfmo2l.js";import"./offline-BzIlwqNM.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";import"./QMarkupTable-B_ExttGO.js";import"./QLinearProgress-CBrm9QWG.js";import"./use-fullscreen-BdF06Cx5.js";import"./QBtnToggle-Bt3oZt1M.js";import"./QForm-B3HUaoek.js";import"./QuExamQuestionSelector-BcN_s4gQ.js";import"./QuQuestionDisplay-7DrnEt_O.js";import"./katex-DjUCNC-N.js";import"./katex-BXKQVcz-.js";import"./date-B0iTpe7S.js";const P={class:"q-pa-md"},M={class:"row items-center"},F={class:"row q-gutter-md"},B={class:"text-subtitle2"},R={key:0,class:"text-caption text-grey-7"},O={key:0,class:"row q-gutter-xs"},I={class:"row justify-center"},L={class:"text-h6"},N=["src"],$={class:"row q-col-gutter-md q-mb-md"},H={class:"col-12 col-md-3"},J={class:"col-12 col-md-3"},K={__name:"QuExamList",props:{exams:Object,subjects:Array,grades:Array,classrooms:Array,customGroups:Array,examTypes:Array,markCalculationMethods:Array,publishResultsTimings:Array,filters:Object},setup(K){var W,X,Y,Z,ee;const le=f(!1),ae=f(null),te=K,oe=g({subject_id:(null==(W=te.filters)?void 0:W.subject_id)||(te.subjects.length>0?te.subjects[0].id:null),exam_type:(null==(X=te.filters)?void 0:X.exam_type)||null,custom_group:(null==(Y=te.filters)?void 0:Y.custom_group)||null,status:(null==(Z=te.filters)?void 0:Z.status)||null}),se=f(te.exams.current_page),re=f(!1),ue=f(!1),ie=f(null),ne=f(null),de=e=>e?e.charAt(0).toUpperCase()+e.slice(1):"",me=te.examTypes.map(e=>({value:e,label:de(e)})),ce=[{value:"draft",label:"Draft"},{value:"upcoming",label:"Upcoming"},{value:"active",label:"Active"},{value:"ended",label:"Ended"}],pe=[{name:"id",label:"ID",field:"id",align:"left",sortable:!0},{name:"title",label:"Title",field:"title",align:"left"},{name:"subject",label:"Subject",field:"subject",align:"left"},{name:"exam_type",label:"Type",field:"exam_type",align:"center"},{name:"custom_group",label:"Group",field:"custom_group",align:"center"},{name:"questions_count",label:"Questions",field:"questions_count",align:"center"},{name:"total_marks",label:"Marks",field:"total_marks",align:"center"},{name:"duration_minutes",label:"Duration (min)",field:"duration_minutes",align:"center"},{name:"status",label:"Status",field:"status",align:"center"},{name:"actions",label:"Actions",align:"center"}],ve=_(()=>({page:te.exams.current_page,rowsPerPage:te.exams.per_page,rowsNumber:te.exams.total})),be=()=>{E.get(G("qu-exams.index"),oe,{preserveState:!0,preserveScroll:!0})},fe=e=>{E.get(G("qu-exams.index",{...oe,page:e}),{},{preserveState:!0,preserveScroll:!0})};!(null==(ee=te.filters)?void 0:ee.subject_id)&&oe.subject_id&&be();const ge=e=>{fe(e.pagination.page)},_e=()=>{E.visit(G("qu-analytics.index"))},ye=()=>{E.delete(G("qu-exams.destroy",ie.value.id),{onSuccess:()=>{re.value=!1,ie.value=null}})},xe=f(!1),we=f([]),je=f(!1),ke=f(null),he=g({grading_status:null,classroom_id:null}),Ve=async()=>{if(ke.value){je.value=!0;try{const e=await window.axios.get(G("qu-exams.grading-attempts",ke.value.id),{params:he});we.value=e.data.attempts}catch(e){console.error("Failed to load grading attempts",e)}finally{je.value=!1}}},Ce=e=>{var l;if(!(null==(l=ke.value)?void 0:l.passing_score))return"primary";return e.score/ke.value.total_marks*100>=ke.value.passing_score?"positive":"negative"},Qe=[{name:"student",label:"Student",field:e=>e.user.name,align:"left"},{name:"classroom",label:"Classroom",field:e=>e.user.classroom,align:"left"},{name:"score",label:"Score",field:"score",align:"center"},{name:"status",label:"Status",field:"status",align:"center"},{name:"submitted",label:"Submitted",field:"submitted_at",align:"center"},{name:"actions",label:"Actions",align:"center"}],qe=e=>{(async e=>{ke.value=e,xe.value=!0,he.grading_status=null,he.classroom_id=null,await Ve()})(e)},Se=()=>{ue.value=!1,ne.value=null,E.reload({only:["exams"]})},Ue=f(!1),Ae=f(null),Te=()=>{Ve()};return(f,g)=>{const _=y("Head");return w(),x(S,null,[j(_,{title:"Exam Management"}),k("div",P,[j(s,null,{default:h(()=>[j(l,null,{default:h(()=>[k("div",M,[g[14]||(g[14]=k("div",{class:"text-h5"},"Exam Management",-1)),j(e),j(a,{color:"secondary",label:"Analytics",icon:"analytics",class:"q-mr-sm",onClick:_e}),j(a,{color:"primary",label:"Create Exam",icon:"add",onClick:g[0]||(g[0]=e=>ue.value=!0)})])]),_:1}),j(l,null,{default:h(()=>[k("div",F,[j(d,{modelValue:oe.subject_id,"onUpdate:modelValue":[g[1]||(g[1]=e=>oe.subject_id=e),be],options:K.subjects,"option-value":"id","option-label":"name",label:"Subject",clearable:"","emit-value":"","map-options":"",style:{"min-width":"200px"}},null,8,["modelValue","options"]),j(d,{modelValue:oe.exam_type,"onUpdate:modelValue":[g[2]||(g[2]=e=>oe.exam_type=e),be],options:Q(me),label:"Exam Type",clearable:"",style:{"min-width":"150px"}},null,8,["modelValue","options"]),j(d,{modelValue:oe.custom_group,"onUpdate:modelValue":[g[3]||(g[3]=e=>oe.custom_group=e),be],options:K.customGroups,label:"Custom Group",clearable:"",style:{"min-width":"150px"}},null,8,["modelValue","options"]),j(d,{modelValue:oe.status,"onUpdate:modelValue":[g[4]||(g[4]=e=>oe.status=e),be],options:ce,label:"Status",clearable:"",style:{"min-width":"150px"}},null,8,["modelValue"])])]),_:1}),j(l,null,{default:h(()=>[j(p,{rows:K.exams.data,columns:pe,"row-key":"id",flat:"",bordered:"",pagination:ve.value,onRequest:ge},{"body-cell-title":h(e=>[j(m,{props:e},{default:h(()=>{return[k("div",B,A(e.row.title),1),e.row.description?(w(),x("div",R,A((l=e.row.description,a=50,l&&l.length>a?l.substring(0,a)+"...":l)),1)):C("",!0)];var l,a}),_:2},1032,["props"])]),"body-cell-subject":h(e=>[j(m,{props:e},{default:h(()=>[j(o,{dense:"",color:"primary","text-color":"white"},{default:h(()=>{var l;return[q(A(null==(l=e.row.subject)?void 0:l.name),1)]}),_:2},1024)]),_:2},1032,["props"])]),"body-cell-exam_type":h(e=>[j(m,{props:e},{default:h(()=>{return[j(o,{dense:"",color:(l=e.row.exam_type,{practice:"cyan",quiz:"purple",midterm:"orange",final:"red",survey:"teal"}[l]||"grey"),"text-color":"white"},{default:h(()=>[q(A(de(e.row.exam_type)),1)]),_:2},1032,["color"])];var l}),_:2},1032,["props"])]),"body-cell-custom_group":h(e=>[j(m,{props:e},{default:h(()=>[e.row.custom_group?(w(),V(o,{key:0,dense:"",outline:"",color:"purple"},{default:h(()=>[q(A(e.row.custom_group),1)]),_:2},1024)):C("",!0)]),_:2},1032,["props"])]),"body-cell-status":h(e=>[j(m,{props:e},{default:h(()=>{return[j(c,{color:(l=e.row.status,{draft:"grey",upcoming:"blue",active:"green",ended:"orange"}[l]||"grey"),label:de(e.row.status)},null,8,["color","label"])];var l}),_:2},1032,["props"])]),"body-cell-bloom_distribution":h(e=>[j(m,{props:e},{default:h(()=>[e.row.bloom_distribution?(w(),x("div",O,[(w(!0),x(S,null,U(e.row.bloom_distribution,(e,l)=>(w(),x(S,{key:l},[e>0?(w(),V(o,{key:0,dense:"",size:"sm",color:"purple-2"},{default:h(()=>[q(A(l)+": "+A(e),1)]),_:2},1024)):C("",!0)],64))),128))])):C("",!0)]),_:2},1032,["props"])]),"body-cell-actions":h(e=>[j(m,{props:e},{default:h(()=>[j(a,{flat:"",dense:"",round:"",color:"primary",icon:"visibility",onClick:l=>{return a=e.row,void E.visit(G("qu-exams.show",a.id));var a}},{default:h(()=>[j(t,null,{default:h(()=>g[15]||(g[15]=[q("View")])),_:1})]),_:2},1032,["onClick"]),j(a,{flat:"",dense:"",round:"",color:"primary",icon:"edit",onClick:l=>(async e=>{try{const l=await window.axios.get(G("qu-exams.edit",e.id));ne.value=l.data,ue.value=!0}catch(l){console.error("Failed to load exam data",l)}})(e.row)},{default:h(()=>[j(t,null,{default:h(()=>g[16]||(g[16]=[q("Edit")])),_:1})]),_:2},1032,["onClick"]),j(a,{flat:"",dense:"",round:"",color:"secondary",icon:"content_copy",onClick:l=>(e=>{const l={...e,title:`${e.title} (Copy)`,is_published:!1};ne.value=l,ue.value=!0})(e.row)},{default:h(()=>[j(t,null,{default:h(()=>g[17]||(g[17]=[q("Duplicate")])),_:1})]),_:2},1032,["onClick"]),j(a,{flat:"",dense:"",round:"",color:"indigo",icon:"print",onClick:l=>{return a=e.row,ae.value=a,void(le.value=!0);var a}},{default:h(()=>[j(t,null,{default:h(()=>g[18]||(g[18]=[q("Print Preview")])),_:1})]),_:2},1032,["onClick"]),j(a,{flat:"",dense:"",round:"",color:"orange",icon:"grading",onClick:l=>qe(e.row)},{default:h(()=>[j(t,null,{default:h(()=>g[19]||(g[19]=[q("View Grading")])),_:1})]),_:2},1032,["onClick"]),j(a,{flat:"",dense:"",round:"",color:"negative",icon:"delete",onClick:l=>{return a=e.row,ie.value=a,void(re.value=!0);var a}},{default:h(()=>[j(t,null,{default:h(()=>g[20]||(g[20]=[q("Delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","pagination"])]),_:1}),K.exams.last_page>1?(w(),V(l,{key:0,class:"q-pt-none"},{default:h(()=>[k("div",I,[j(v,{modelValue:se.value,"onUpdate:modelValue":[g[5]||(g[5]=e=>se.value=e),fe],max:K.exams.last_page,"max-pages":7,"direction-links":"","boundary-links":""},null,8,["modelValue","max"])])]),_:1})):C("",!0)]),_:1}),j(i,{modelValue:re.value,"onUpdate:modelValue":g[6]||(g[6]=e=>re.value=e)},{default:h(()=>[j(s,null,{default:h(()=>[j(l,null,{default:h(()=>g[21]||(g[21]=[k("div",{class:"text-h6"},"Confirm Delete",-1)])),_:1}),j(l,null,{default:h(()=>g[22]||(g[22]=[q(" Are you sure you want to delete this exam? This action cannot be undone. ")])),_:1}),j(r,{align:"right"},{default:h(()=>[T(j(a,{flat:"",label:"Cancel",color:"primary"},null,512),[[u]]),j(a,{flat:"",label:"Delete",color:"negative",onClick:ye})]),_:1})]),_:1})]),_:1},8,["modelValue"]),j(i,{modelValue:ue.value,"onUpdate:modelValue":g[8]||(g[8]=e=>ue.value=e),maximized:""},{default:h(()=>[j(s,null,{default:h(()=>[j(l,{class:"row items-center q-pb-none"},{default:h(()=>[k("div",L,A(ne.value?"Edit Exam":"Create Exam"),1),j(e),T(j(a,{icon:"close",flat:"",round:"",dense:""},null,512),[[u]])]),_:1}),j(l,null,{default:h(()=>[j(z,{subjects:K.subjects,grades:K.grades,classrooms:K.classrooms,"exam-types":K.examTypes,"mark-calculation-methods":K.markCalculationMethods,"publish-results-timings":K.publishResultsTimings,"custom-groups":K.customGroups,"selected-subject-id":oe.subject_id,exam:ne.value,onSuccess:Se,onCancel:g[7]||(g[7]=e=>ue.value=!1)},null,8,["subjects","grades","classrooms","exam-types","mark-calculation-methods","publish-results-timings","custom-groups","selected-subject-id","exam"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),j(i,{modelValue:le.value,"onUpdate:modelValue":g[9]||(g[9]=e=>le.value=e),maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:h(()=>[j(s,{class:"bg-white text-black"},{default:h(()=>[j(b,{class:"bg-primary text-white"},{default:h(()=>{var l;return[j(n,{name:"print"}),k("div",null,"Print Preview: "+A(null==(l=ae.value)?void 0:l.title),1),j(e),T((w(),V(a,{dense:"",flat:"",icon:"close"},{default:h(()=>[j(t,null,{default:h(()=>g[23]||(g[23]=[q("Close")])),_:1})]),_:1})),[[u]])]}),_:1}),j(l,{class:"q-pa-none",style:{height:"calc(100vh - 50px)"}},{default:h(()=>{var e;return[ae.value?(w(),x("iframe",{key:0,id:"printFrame",src:Q(G)("qu-student.exams.print",null==(e=ae.value)?void 0:e.id),style:{width:"100%",height:"100%",border:"none"}},null,8,N)):C("",!0)]}),_:1})]),_:1})]),_:1},8,["modelValue"]),j(i,{modelValue:xe.value,"onUpdate:modelValue":g[12]||(g[12]=e=>xe.value=e),maximized:""},{default:h(()=>[j(s,null,{default:h(()=>[j(b,{class:"bg-primary text-white"},{default:h(()=>{var l;return[j(n,{name:"grading"}),k("div",null,"Grading: "+A(null==(l=ke.value)?void 0:l.title),1),j(e),T((w(),V(a,{dense:"",flat:"",icon:"close"},{default:h(()=>[j(t,null,{default:h(()=>g[24]||(g[24]=[q("Close")])),_:1})]),_:1})),[[u]])]}),_:1}),j(l,null,{default:h(()=>[k("div",$,[k("div",H,[j(d,{modelValue:he.grading_status,"onUpdate:modelValue":[g[10]||(g[10]=e=>he.grading_status=e),Ve],options:ce,"option-value":"value","option-label":"label",label:"Grading Status",clearable:"","emit-value":"","map-options":"",dense:"",outlined:""},null,8,["modelValue"])]),k("div",J,[j(d,{modelValue:he.classroom_id,"onUpdate:modelValue":[g[11]||(g[11]=e=>he.classroom_id=e),Ve],options:K.classrooms,"option-value":"id","option-label":"name",label:"Classroom",clearable:"","emit-value":"","map-options":"",dense:"",outlined:""},null,8,["modelValue","options"])])]),j(p,{rows:we.value,columns:Qe,"row-key":"id",flat:"",bordered:"",loading:je.value},{"body-cell-score":h(e=>[j(m,{props:e},{default:h(()=>[j(o,{color:Ce(e.row),"text-color":"white",size:"sm"},{default:h(()=>{var l;return[q(A(Math.round(e.row.score||0))+" / "+A(null==(l=ke.value)?void 0:l.total_marks),1)]}),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-status":h(e=>[j(m,{props:e},{default:h(()=>{return[j(c,{color:(l=e.row.status,{pending:"grey",partial:"orange",completed:"positive"}[l]||"grey"),label:de(e.row.status)},null,8,["color","label"])];var l}),_:2},1032,["props"])]),"body-cell-actions":h(e=>[j(m,{props:e},{default:h(()=>[j(a,{color:"primary",icon:"edit",label:"Grade",size:"sm",onClick:l=>{return a=e.row,Ae.value=a.id,void(Ue.value=!0);var a}},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),j(D,{modelValue:Ue.value,"onUpdate:modelValue":g[13]||(g[13]=e=>Ue.value=e),"attempt-id":Ae.value,onGraded:Te},null,8,["modelValue","attempt-id"])])],64)}}};export{K as default};
