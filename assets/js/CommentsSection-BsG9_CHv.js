import{o as e,u as t,c as l,d as s,f as o,Q as a,m as i,a as n,A as d,aF as m}from"./app-C-NJhdpe.js";import{Q as r}from"./QBadge-D_SrvMy0.js";import c from"./TextToSpeechButton-CuwdvPws.js";import{r as u}from"./resumeApi-BfslqyDT.js";import{f as p,L as v,I as y,b as g,O as f,J as x,M as h,V as k,a1 as _,$ as b,U as q,F as C,Q as w,H as z}from"./vendor-CUZ9QTQV.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";const V={class:"comments-section"},j={class:"text-subtitle2 q-mb-md text-primary"},U={class:"row q-gutter-md items-end"},S={class:"col"},A={class:"col-auto"},D={key:0,class:"text-center text-grey-6 q-py-xl"},F={key:1,class:"comments-list"},I={class:"text-subtitle2 q-mb-md text-grey-7"},K={class:"row q-gutter-md"},$={class:"col-auto"},E={class:"col"},L={class:"comment-header q-mb-xs"},M={class:"text-weight-medium"},O={class:"text-caption text-grey-6 q-ml-sm"},Q={key:0,class:"comment-text q-mb-xs"},B={class:"row items-start q-gutter-sm"},P={class:"col text-body2"},R={class:"col-auto"},T={key:1,class:"edit-comment-form q-mb-xs"},N={class:"row q-gutter-xs q-mt-xs"},H={class:"comment-actions"},J={key:2,class:"replies q-mt-md q-ml-md"},W={class:"row q-gutter-sm"},G={class:"col-auto"},X={class:"col"},Y={class:"reply-header q-mb-xs"},Z={class:"text-weight-medium text-body2"},ee={class:"text-caption text-grey-6 q-ml-sm"},te={class:"reply-text text-body2"},le={key:3,class:"reply-form q-mt-sm q-ml-md"},se={class:"row q-gutter-sm"},oe={class:"col"},ae={class:"col-auto"},ie={key:2,class:"text-center q-mt-md"},ne=e({__name:"CommentsSection",props:{answerId:{type:Number,required:!0},comments:{type:Array,default:()=>[]}},emits:["comment-added","comment-updated","comment-deleted"],setup(e,{emit:ne}){const de=e,me=ne,re=t(),ce=p(""),ue=p(!1),pe=p(null),ve=p(""),ye=p(null),ge=p(""),fe=p(!1),xe=p(!1),he=p({id:1,name:"Current User"}),ke=()=>{ce.value.trim()&&(ue.value=!0,u.createComment(de.answerId,{text:ce.value}).then(e=>{de.comments.unshift(e),ce.value="",me("comment-added",e),re.notify({type:"positive",message:"Comment added successfully!",position:"top"})}).catch(e=>{console.error("Error adding comment:",e),re.notify({type:"negative",message:"Failed to add comment. Please try again.",position:"top"})}).finally(()=>{ue.value=!1}))},_e=e=>{ve.value.trim()&&u.updateComment(e,{text:ve.value}).then(t=>{const l=de.comments.find(t=>t.id===e);l&&(l.text=ve.value,l.is_edited=!0),be(),me("comment-updated",e),re.notify({type:"positive",message:"Comment updated successfully",position:"top"})}).catch(e=>{console.error("Error updating comment:",e),re.notify({type:"negative",message:"Failed to update comment",position:"top"})})},be=()=>{pe.value=null,ve.value=""},qe=e=>{if(!ge.value.trim())return;const t={id:Date.now(),text:ge.value,user_id:he.value.id,user:he.value,created_at:(new Date).toISOString(),parent_comment_id:e},l=de.comments.find(t=>t.id===e);l&&(l.replies||(l.replies=[]),l.replies.push(t)),Ce(),re.notify({type:"positive",message:"Reply added successfully",position:"top"})},Ce=()=>{ye.value=null,ge.value=""},we=()=>{fe.value=!0,setTimeout(()=>{fe.value=!1,xe.value=!1},1e3)},ze=e=>e.user_id===he.value.id,Ve=e=>e.user_id===he.value.id,je=e=>{if(!e)return"";const t=new Date(e),l=new Date-t,s=Math.floor(l/6e4),o=Math.floor(l/36e5),a=Math.floor(l/864e5);return s<1?"just now":s<60?`${s}m ago`:o<24?`${o}h ago`:a<7?`${a}d ago`:t.toLocaleDateString()};return(t,p)=>(y(),v("div",V,[g(i,{flat:"",bordered:"",class:"q-mb-lg"},{default:x(()=>[g(l,{class:"q-pa-md"},{default:x(()=>[h("div",j,[g(s,{name:"add_comment",class:"q-mr-xs"}),p[3]||(p[3]=k(" Add a Comment "))]),h("div",U,[h("div",S,[g(o,{modelValue:ce.value,"onUpdate:modelValue":p[0]||(p[0]=e=>ce.value=e),placeholder:"Share your thoughts...",outlined:"",type:"textarea",rows:"3",onKeyup:_(b(ke,["ctrl"]),["enter"])},{hint:x(()=>p[4]||(p[4]=[k(" Press Ctrl+Enter to post ")])),_:1},8,["modelValue","onKeyup"])]),h("div",A,[g(a,{color:"primary",icon:"send",label:"Post",onClick:ke,disable:!ce.value.trim(),loading:ue.value},null,8,["disable","loading"])])])]),_:1})]),_:1}),0===e.comments.length?(y(),v("div",D,[g(s,{name:"chat_bubble_outline",size:"4em",color:"grey-4"}),p[5]||(p[5]=h("div",{class:"text-h6 q-mt-md text-grey-5"},"No comments yet",-1)),p[6]||(p[6]=h("div",{class:"text-body2 q-mt-xs"},"Be the first to share your thoughts!",-1))])):(y(),v("div",F,[h("div",I,q(e.comments.length)+" comment"+q(1!==e.comments.length?"s":""),1),g(n,{class:"q-mb-lg"}),(y(!0),v(C,null,w(e.comments,e=>(y(),v("div",{key:e.id,class:"comment-item q-mb-lg"},[g(i,{flat:"",bordered:"",class:"comment-card"},{default:x(()=>[g(l,{class:"q-pa-md"},{default:x(()=>{var t;return[h("div",K,[h("div",$,[g(d,{size:"40px",color:"primary","text-color":"white"},{default:x(()=>{var t,l,s;return[k(q((null==(s=null==(l=null==(t=e.user)?void 0:t.name)?void 0:l.charAt(0))?void 0:s.toUpperCase())||"U"),1)]}),_:2},1024)]),h("div",E,[h("div",L,[h("span",M,q((null==(t=e.user)?void 0:t.name)||`User ${e.user_id}`),1),h("span",O,q(je(e.created_at)),1),e.is_edited?(y(),z(r,{key:0,label:"edited",color:"grey-5",class:"q-ml-xs"})):f("",!0)]),pe.value!==e.id?(y(),v("div",Q,[h("div",B,[h("div",P,q(e.text),1),h("div",R,[g(c,{text:e.text,size:"xs",round:"",flat:""},null,8,["text"])])])])):(y(),v("div",T,[g(o,{modelValue:ve.value,"onUpdate:modelValue":p[1]||(p[1]=e=>ve.value=e),outlined:"",dense:"",autofocus:"",onKeyup:[_(t=>_e(e.id),["enter"]),_(be,["esc"])]},null,8,["modelValue","onKeyup"]),h("div",N,[g(a,{size:"sm",color:"primary",label:"Save",onClick:t=>_e(e.id)},null,8,["onClick"]),g(a,{size:"sm",flat:"",label:"Cancel",onClick:be})])])),h("div",H,[g(m,{flat:""},{default:x(()=>[g(a,{size:"sm",flat:"",color:e.user_liked?"positive":"grey-7",icon:e.user_liked?"thumb_up":"thumb_up_off_alt",onClick:t=>{return l=e.id,void u.toggleCommentLike(l).then(e=>{const t=de.comments.find(e=>e.id===l);t&&(t.user_liked=e.liked,t.likes_count=e.likes_count)}).catch(e=>{console.error("Error toggling comment like:",e),re.notify({type:"negative",message:"Failed to update like",position:"top"})});var l}},{default:x(()=>[k(q(e.likes_count||0),1)]),_:2},1032,["color","icon","onClick"]),g(a,{size:"sm",flat:"",color:"grey-7",icon:"reply",onClick:t=>{return l=e.id,ye.value=l,void(ge.value="");var l}},{default:x(()=>p[7]||(p[7]=[k(" Reply ")])),_:2},1032,["onClick"]),ze(e)?(y(),z(a,{key:0,size:"sm",flat:"",color:"grey-7",icon:"edit",onClick:t=>(e=>{pe.value=e.id,ve.value=e.text})(e)},null,8,["onClick"])):f("",!0),Ve(e)?(y(),z(a,{key:1,size:"sm",flat:"",color:"negative",icon:"delete",onClick:t=>{return l=e.id,void re.dialog({title:"Confirm Delete",message:"Are you sure you want to delete this comment?",cancel:!0,persistent:!0}).onOk(()=>{u.deleteComment(l).then(()=>{const e=de.comments.findIndex(e=>e.id===l);e>-1&&de.comments.splice(e,1),me("comment-deleted",l),re.notify({type:"positive",message:"Comment deleted successfully",position:"top"})}).catch(e=>{console.error("Error deleting comment:",e),re.notify({type:"negative",message:"Failed to delete comment",position:"top"})})});var l}},null,8,["onClick"])):f("",!0)]),_:2},1024)]),e.replies&&e.replies.length>0?(y(),v("div",J,[(y(!0),v(C,null,w(e.replies,e=>{var t;return y(),v("div",{key:e.id,class:"reply-item q-mb-sm q-pa-sm bg-grey-1 rounded-borders"},[h("div",W,[h("div",G,[g(d,{size:"24px",color:"blue-grey-4","text-color":"white"},{default:x(()=>[g(s,{name:"person"})]),_:1})]),h("div",X,[h("div",Y,[h("span",Z,q((null==(t=e.user)?void 0:t.name)||`User ${e.user_id}`),1),h("span",ee,q(je(e.created_at)),1)]),h("div",te,q(e.text),1)])])])}),128))])):f("",!0),ye.value===e.id?(y(),v("div",le,[h("div",se,[h("div",oe,[g(o,{modelValue:ge.value,"onUpdate:modelValue":p[2]||(p[2]=e=>ge.value=e),placeholder:"Write a reply...",outlined:"",dense:"",autofocus:"",onKeyup:[_(t=>qe(e.id),["enter"]),_(Ce,["esc"])]},null,8,["modelValue","onKeyup"])]),h("div",ae,[g(a,{size:"sm",color:"primary",icon:"send",onClick:t=>qe(e.id),disable:!ge.value.trim()},null,8,["onClick","disable"]),g(a,{size:"sm",flat:"",icon:"close",onClick:Ce,class:"q-ml-xs"})])])])):f("",!0)])])]}),_:2},1024)]),_:2},1024)]))),128))])),xe.value?(y(),v("div",ie,[g(a,{flat:"",color:"primary",label:"Load more comments",onClick:we,loading:fe.value},null,8,["loading"])])):f("",!0)]))}},[["__scopeId","data-v-2dd3226f"]]);export{ne as default};
