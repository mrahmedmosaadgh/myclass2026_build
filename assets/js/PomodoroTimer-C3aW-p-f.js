import{bk as e,c as l,f as a,Q as o,l as t,m as s}from"./app-DOc39CFu.js";import{Q as u}from"./QCircularProgress-BObQlef-.js";import{Q as n}from"./QSelect-Dkiz84LX.js";import{f as r,a as d,A as v,I as i,J as c,K as m,b as p,Q as k,N as f,V as y,M as b,F as h}from"./vendor-DuKqz2x4.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";import"./rtl-Cr6c3OOr.js";const S={class:"text-h6"},g={class:"text-subtitle2"},x={class:"text-h3"},w={class:"row q-mt-md"},C={class:"row q-mt-md justify-center"},_={class:"text-center q-mb-md"},D={key:0},V={class:"text-h6"},j={key:1},T={class:"text-subtitle1"},$={__name:"PomodoroTimer",props:{tasks:{type:Array,default:()=>[]}},emits:["close","session-completed","enter-focus-mode"],setup($,{emit:q}){const I=$,M=q,Q=e(),N=r(!1),B=r(!1),F=r(!1),P=r(!1),U=r(0),A=r(25),E=r(5),R=r(null),W=r(""),z=r(null),J=r(null),K=r(null),G=r(null),H=r(0),L=d(()=>I.tasks.map(e=>({id:e.id,title:e.title}))),O=d(()=>R.value?I.tasks.find(e=>e.id===R.value):null),X=d(()=>{if(P.value){const e=60*E.value;return(e-U.value)/e*100}{const e=60*A.value;return(e-U.value)/e*100}}),Y=()=>{N.value=!0,B.value=!1,F.value=!1,P.value=!1,U.value=60*A.value,K.value=Date.now(),H.value=0,Q.fetchData({endpoint:"/developer/pomodoro/start",method:"post",data:{task_id:R.value,type:"work",duration:A.value},onSuccess:e=>{z.value=e.session,ee()}})},Z=()=>{N.value=!0,B.value=!1,F.value=!1,P.value=!0,U.value=60*E.value,K.value=Date.now(),H.value=0,Q.fetchData({endpoint:"/developer/pomodoro/start",method:"post",data:{task_id:null,type:"break",duration:E.value},onSuccess:e=>{z.value=e.session,ee()}})},ee=()=>{clearInterval(J.value),J.value=setInterval(()=>{B.value||(U.value--,U.value<=0&&te())},1e3)},le=()=>{B.value=!0,G.value=Date.now()},ae=()=>{B.value=!1,H.value+=Date.now()-G.value,G.value=null},oe=()=>{clearInterval(J.value),z.value&&Q.fetchData({endpoint:`/developer/pomodoro/${z.value.id}/end`,method:"post",data:{notes:"Session interrupted by user",status:"interrupted"},onSuccess:()=>{M("session-completed")}}),se()},te=()=>{clearInterval(J.value),N.value=!1,re(),P.value?(P.value=!1,F.value=!1,z.value&&Q.fetchData({endpoint:`/developer/pomodoro/${z.value.id}/end`,method:"post",data:{notes:"Break completed",status:"completed"},onSuccess:()=>{M("session-completed"),z.value=null}})):F.value=!0},se=()=>{clearInterval(J.value),N.value=!1,B.value=!1,F.value=!1,P.value=!1,U.value=0,W.value="",z.value=null},ue=()=>{se(),M("close")},ne=e=>{const l=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`},re=()=>{new Audio("/sounds/notification.mp3").play().catch(e=>console.error("Error playing sound:",e))},de=()=>{z.value&&Q.fetchData({endpoint:`/developer/pomodoro/${z.value.id}/end`,method:"post",data:{notes:W.value||"Need more time to complete",status:"extended"},onSuccess:()=>{M("session-completed"),Y()}})},ve=()=>{z.value&&Q.fetchData({endpoint:`/developer/pomodoro/${z.value.id}/end`,method:"post",data:{notes:W.value||"Task completed",status:"completed"},onSuccess:()=>{M("session-completed"),R.value?Q.fetchData({endpoint:`/developer/tasks/${R.value}/toggle-complete`,method:"post",onSuccess:()=>{Z()}}):Z()}})},ie=()=>{z.value&&Q.fetchData({endpoint:`/developer/pomodoro/${z.value.id}/end`,method:"post",data:{notes:W.value||"Taking a longer break",status:"completed"},onSuccess:()=>{M("session-completed"),E.value=2*E.value,Z()}})},ce=()=>{console.log("Entering Focus Mode with task:",O.value),console.log("Current session:",z.value),M("enter-focus-mode",O.value,z.value),M("close")};return v(()=>{clearInterval(J.value)}),(e,r)=>(c(),i(s,{style:{width:"400px","max-width":"90vw"}},{default:m(()=>[p(l,{class:"text-center"},{default:m(()=>[f("div",S,y(P.value?"Break Time":"Pomodoro Timer"),1),f("div",g,y(P.value?"Relax and recharge":"Stay focused and productive"),1)]),_:1}),p(l,{class:"text-center"},{default:m(()=>[p(u,{value:X.value,size:"200px",thickness:.2,color:"primary","track-color":"grey-3",class:"q-ma-md"},{default:m(()=>[f("div",x,y(ne(U.value)),1)]),_:1},8,["value"])]),_:1}),P.value||N.value||F.value?k("",!0):(c(),i(l,{key:0},{default:m(()=>[p(n,{modelValue:R.value,"onUpdate:modelValue":r[0]||(r[0]=e=>R.value=e),options:L.value,label:"Select Task","option-value":"id","option-label":"title","emit-value":"","map-options":"",clearable:""},null,8,["modelValue","options"]),f("div",w,[p(a,{modelValue:A.value,"onUpdate:modelValue":r[1]||(r[1]=e=>A.value=e),modelModifiers:{number:!0},type:"number",label:"Duration (minutes)",min:"1",max:"60",class:"col-6 q-pr-sm"},null,8,["modelValue"]),p(a,{modelValue:E.value,"onUpdate:modelValue":r[2]||(r[2]=e=>E.value=e),modelModifiers:{number:!0},type:"number",label:"Break (minutes)",min:"1",max:"30",class:"col-6 q-pl-sm"},null,8,["modelValue"])])]),_:1})),F.value?(c(),i(l,{key:1},{default:m(()=>[r[4]||(r[4]=f("div",{class:"text-h6 text-center q-mb-md"},"Session Completed!",-1)),p(a,{modelValue:W.value,"onUpdate:modelValue":r[3]||(r[3]=e=>W.value=e),type:"textarea",label:"What did you accomplish?",rows:"3"},null,8,["modelValue"]),f("div",C,[p(o,{flat:"",color:"grey",label:"Need more time",onClick:de}),p(o,{flat:"",color:"positive",label:"Task completed",onClick:ve}),p(o,{flat:"",color:"primary",label:"Take a longer break",onClick:ie})])]),_:1})):k("",!0),N.value?(c(),i(l,{key:2},{default:m(()=>[f("div",_,[O.value?(c(),b("div",D,[r[5]||(r[5]=f("div",{class:"text-subtitle1"},"Working on:",-1)),f("div",V,y(O.value.title),1)])):(c(),b("div",j,[f("div",T,y(P.value?"Taking a break":"Focus session"),1)]))])]),_:1})):k("",!0),p(t,{align:"center"},{default:m(()=>[N.value||F.value?k("",!0):(c(),i(o,{key:0,color:"primary",label:"Start",icon:"play_arrow",onClick:Y})),N.value?(c(),b(h,{key:1},[p(o,{color:"negative",label:"Stop",icon:"stop",onClick:oe}),B.value?(c(),i(o,{key:1,color:"primary",label:"Resume",icon:"play_arrow",onClick:ae})):(c(),i(o,{key:0,color:"grey",label:"Pause",icon:"pause",onClick:le})),p(o,{color:"primary",flat:"",label:"Focus Mode",icon:"fullscreen",onClick:ce})],64)):k("",!0),F.value?(c(),i(o,{key:2,color:"primary",label:"Start New Session",icon:"refresh",onClick:se})):k("",!0),N.value?k("",!0):(c(),i(o,{key:3,flat:"",label:"Close",color:"grey",onClick:ue}))]),_:1})]),_:1}))}};export{$ as default};
