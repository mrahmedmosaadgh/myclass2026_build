import{r as e,u as t,d as l,f as a,b as s,c as o,g as r,Q as n,i as u,j as i,k as d,l as c,aI as m}from"./app-DlLesFGi.js";import{Q as v,a as p}from"./QStepper-DsaP_4Mi.js";import{Q as f}from"./QMarkupTable-CzIo4GGA.js";import{Q as b}from"./QTable-BIAJAIui.js";import{Q as g}from"./QBadge-IdEcTs8C.js";import{Q as x}from"./QLinearProgress-CX6G9yBK.js";import{f as y,a as _,N as h,J as w,b as C,z as k,a4 as q,K as I,R as S,I as j,O as L,W as P,V as Q,F as T,Q as D,U as E}from"./vendor-BWKGNkNB.js";import{_ as F}from"./AppLayout-B3PyevP7.js";import O from"./ImportExcel-19hPFQH8.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./use-panel-BqxRbB7W.js";import"./use-render-cache-CmTcazfP.js";import"./QSelect-BTh0khse.js";import"./rtl-Cr6c3OOr.js";import"./use-fullscreen-BQHoXYBI.js";import"./Modal-W7e3DFIO.js";import"./xlsx-BHXqx-YI.js";const R={class:"q-pa-md"},V={class:"row items-center justify-between"},A={class:"q-gutter-sm"},U={class:"q-mt-md"},M={class:"q-mt-md"},N={class:"row q-col-gutter-md q-mb-md"},$={class:"col-12 col-sm-6 col-md-3"},B={class:"text-h5 text-bold text-blue-8"},K={class:"col-12 col-sm-6 col-md-3"},z={class:"text-h5 text-bold text-green-8"},G={class:"col-12 col-sm-6 col-md-3"},J={class:"text-h5 text-bold text-red-8"},W={class:"col-12 col-sm-6 col-md-3"},X={class:"text-h5 text-bold text-orange-8"},Y={key:0},H={key:1,class:"q-mt-md"},Z={class:"row justify-end q-gutter-sm"},ee={class:"q-mb-md"},te={class:"text-subtitle2 q-mb-sm"},le={class:"absolute-full flex flex-center"},ae={class:"row q-col-gutter-md"},se={class:"col-12 col-sm-6 col-md-3"},oe={class:"text-h5 text-bold text-blue-8"},re={class:"col-12 col-sm-6 col-md-3"},ne={class:"text-h5 text-bold text-green-8"},ue={class:"col-12 col-sm-6 col-md-3"},ie={class:"text-h5 text-bold text-orange-8"},de={class:"col-12 col-sm-6 col-md-3"},ce={class:"text-h5 text-bold text-purple-8"},me={class:"q-mt-md"},ve=e({__name:"Index",setup(e){const ve=t(),pe=y(1),fe=y(!1),be=y(!1),ge=y(null),xe=y(null),ye=y([]),_e=y([]),he=y(0),we=y(0),Ce=route("course-management.import.validate"),ke=route("course-management.import.process"),qe=[{key:"Course",label:"Course",required:!0},{key:"Level",label:"Level",required:!0},{key:"Section",label:"Section (Optional)",required:!1},{key:"Lesson",label:"Lesson",required:!0}],Ie=[{name:"index",label:"Row",field:"index",align:"center"},{name:"Course",label:"Course",field:"Course",align:"left"},{name:"Level",label:"Level",field:"Level",align:"left"},{name:"Section",label:"Section",field:"Section",align:"left"},{name:"Lesson",label:"Lesson",field:"Lesson",align:"left"}],Se=_(()=>0===we.value?0:he.value/we.value),je=()=>{window.open(route("course-management.import.template"),"_blank"),pe.value=2},Le=e=>{var t;ge.value=e,e.fileData&&(ye.value=e.fileData.map((e,t)=>({index:t+2,...e}))),pe.value=3,ve.notify({type:"positive",message:"File validation successful!",caption:`${(null==(t=e.stats)?void 0:t.valid_rows)||0} valid rows found`,icon:"check_circle"})},Pe=e=>{ge.value=null,ve.notify({type:"negative",message:"File validation failed",caption:e.message||"Please check your file format",icon:"error"})},Qe=e=>{var t;xe.value=e.stats,fe.value=!0,ve.notify({type:"positive",message:"Import completed successfully!",caption:`${(null==(t=e.stats)?void 0:t.lessons_created)||0} lessons imported`,icon:"check_circle"})},Te=e=>{ve.notify({type:"negative",message:"Import failed",caption:e.message||"Please try again",icon:"error"})},De=()=>{ge.value=null,ye.value=[],pe.value=3,ve.notify({type:"info",message:"Import cancelled",icon:"info"})},Ee=()=>{be.value=!0,we.value=ye.value.length,he.value=0,_e.value=ye.value.map(e=>({course:e.Course,level:e.Level,section:e.Section,lesson:e.Lesson,status:"pending"})),Fe()},Fe=async()=>{for(let t=0;t<ye.value.length;t++){_e.value[t].status="processing";try{(await fetch(ke,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({data:[ye.value[t]]})})).ok?_e.value[t].status="success":_e.value[t].status="error"}catch(e){_e.value[t].status="error"}he.value=t+1,await new Promise(e=>setTimeout(e,100))}try{const e=await fetch(ke,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({data:ye.value})}),t=await e.json();e.ok?Qe(t):Te(t)}catch(e){Te({message:e.message})}},Oe=e=>{switch(e){case"pending":return"schedule";case"processing":return"sync";case"success":return"check_circle";case"error":return"error";default:return"help"}},Re=e=>{switch(e){case"pending":default:return"grey";case"processing":return"primary";case"success":return"positive";case"error":return"negative"}},Ve=e=>{switch(e){case"success":return"bg-green-1";case"error":return"bg-red-1";case"processing":return"bg-blue-1";default:return""}},Ae=e=>{switch(e){case"pending":return"Waiting to process";case"processing":return"Processing...";case"success":return"Successfully imported";case"error":return"Failed to import";default:return"Unknown status"}};return(e,t)=>(w(),h(T,null,[C(k(q),{title:"Import Courses"}),C(F,{title:"Import Courses"},{default:I(()=>[S("div",R,[C(l,{flat:"",bordered:""},{default:I(()=>[C(a,null,{default:I(()=>[S("div",V,[t[4]||(t[4]=S("div",null,[S("div",{class:"text-h6"},"Import Course Management Data"),S("div",{class:"text-subtitle2"},"Upload Excel file to import courses, levels, sections, and lessons")],-1)),S("div",A,[C(s,{flat:"",color:"grey-7",icon:"arrow_back",label:"Back to Courses",onClick:t[0]||(t[0]=t=>e.$inertia.visit(e.route("course-management.courses.index")))}),C(s,{color:"primary",icon:"download",label:"Download Template",onClick:je})])])]),_:1}),C(o),C(a,null,{default:I(()=>[t[11]||(t[11]=S("div",{class:"text-h6 q-mb-md"},"Import Instructions",-1)),C(v,{modelValue:pe.value,"onUpdate:modelValue":t[2]||(t[2]=e=>pe.value=e),color:"primary",animated:"",flat:"",bordered:"","header-nav":""},{default:I(()=>[C(p,{name:1,title:"Download Template",icon:"download",done:pe.value>1},{default:I(()=>[t[5]||(t[5]=S("div",{class:"text-body1"}," Download the Excel template to see the required format and sample data. ",-1)),S("div",U,[C(s,{color:"primary",icon:"download",label:"Download Template",onClick:je})])]),_:1},8,["done"]),C(p,{name:2,title:"Prepare Your Data",icon:"edit",done:pe.value>2},{default:I(()=>[t[9]||(t[9]=S("div",{class:"text-body1 q-mb-md"}," Fill in your course data using this exact column structure: ",-1)),C(f,{flat:"",bordered:""},{default:I(()=>t[6]||(t[6]=[S("thead",null,[S("tr",null,[S("th",{class:"text-left"},"Column A"),S("th",{class:"text-left"},"Column B"),S("th",{class:"text-left"},"Column C"),S("th",{class:"text-left"},"Column D")])],-1),S("tbody",null,[S("tr",null,[S("td",null,[S("strong",null,"Course")]),S("td",null,[S("strong",null,"Level")]),S("td",null,[S("strong",null,"Section"),P(" (Optional)")]),S("td",null,[S("strong",null,"Lesson")])]),S("tr",{class:"text-grey-7"},[S("td",null,"Grade 5 Math"),S("td",null,"Fractions"),S("td",null,"Add unlike fractions"),S("td",null,"Lesson A")]),S("tr",{class:"text-grey-7"},[S("td",null,"Grade 5 Math"),S("td",null,"Fractions"),S("td",null,"Add unlike fractions"),S("td",null,"Lesson B")]),S("tr",{class:"text-grey-7"},[S("td",null,"English Literature"),S("td",null,"Poetry"),S("td"),S("td",null,"Introduction to Poetry")])],-1)])),_:1}),C(r,{class:"bg-blue-1 text-blue-8 q-mt-md",rounded:""},{avatar:I(()=>[C(n,{name:"info"})]),default:I(()=>[t[7]||(t[7]=S("div",{class:"text-subtitle2"},"Important Notes:",-1)),t[8]||(t[8]=S("ul",{class:"q-ma-none q-pl-md"},[S("li",null,"Course, Level, and Lesson columns are required"),S("li",null,'Section column is optional (will use "General" if empty)'),S("li",null,"Duplicate lessons will be skipped"),S("li",null,"Courses, levels, and sections will be created if they don't exist"),S("li",null,"Order will be assigned automatically")],-1))]),_:1}),S("div",M,[C(s,{color:"primary",icon:"upload",label:"Ready to Upload",onClick:t[1]||(t[1]=e=>pe.value=3)})])]),_:1},8,["done"]),C(p,{name:3,title:"Upload & Import",icon:"upload",done:fe.value},{default:I(()=>[t[10]||(t[10]=S("div",{class:"text-body1 q-mb-md"}," Upload your Excel file to import the course data. ",-1)),C(O,{"validate-url":k(Ce),"import-url":k(ke),columns:qe,"button-text":"Choose Excel File","preview-title":"Course Import Preview","confirm-button-text":"Confirm & Start Import",onValidationSuccess:Le,onValidationError:Pe,onImportSuccess:Qe,onImportError:Te},null,8,["validate-url","import-url"])]),_:1},8,["done"])]),_:1},8,["modelValue"])]),_:1}),ge.value&&!be.value?(w(),j(a,{key:0},{default:I(()=>{var e;return[t[18]||(t[18]=S("div",{class:"text-h6 q-mb-md"},"File Preview & Confirmation",-1)),S("div",N,[S("div",$,[C(l,{class:"bg-blue-1 text-center"},{default:I(()=>[C(a,null,{default:I(()=>{var e;return[S("div",B,Q((null==(e=ge.value.stats)?void 0:e.total_rows)||0),1),t[12]||(t[12]=S("div",{class:"text-subtitle2 text-grey-8"},"Total Rows",-1))]}),_:1})]),_:1})]),S("div",K,[C(l,{class:"bg-green-1 text-center"},{default:I(()=>[C(a,null,{default:I(()=>{var e;return[S("div",z,Q((null==(e=ge.value.stats)?void 0:e.valid_rows)||0),1),t[13]||(t[13]=S("div",{class:"text-subtitle2 text-grey-8"},"Valid Rows",-1))]}),_:1})]),_:1})]),S("div",G,[C(l,{class:"bg-red-1 text-center"},{default:I(()=>[C(a,null,{default:I(()=>{var e;return[S("div",J,Q((null==(e=ge.value.stats)?void 0:e.invalid_rows)||0),1),t[14]||(t[14]=S("div",{class:"text-subtitle2 text-grey-8"},"Invalid Rows",-1))]}),_:1})]),_:1})]),S("div",W,[C(l,{class:"bg-orange-1 text-center"},{default:I(()=>[C(a,null,{default:I(()=>{var e;return[S("div",X,Q((null==(e=ge.value.errors)?void 0:e.length)||0),1),t[15]||(t[15]=S("div",{class:"text-subtitle2 text-grey-8"},"Errors",-1))]}),_:1})]),_:1})])]),ye.value&&ye.value.length>0?(w(),h("div",Y,[t[16]||(t[16]=S("div",{class:"text-subtitle1 q-mb-md"},"Complete Data Preview",-1)),C(b,{rows:ye.value,columns:Ie,"row-key":"index",flat:"",bordered:"",dense:"",pagination:{rowsPerPage:20},class:"q-mb-md"},null,8,["rows"])])):L("",!0),ge.value.errors&&ge.value.errors.length>0?(w(),h("div",H,[t[17]||(t[17]=S("div",{class:"text-subtitle1 q-mb-md text-negative"},"Validation Errors",-1)),C(u,{bordered:"",class:"q-mb-md"},{default:I(()=>[(w(!0),h(T,null,D(ge.value.errors,(e,t)=>(w(),j(i,{key:t},{default:I(()=>[C(d,{avatar:""},{default:I(()=>[C(n,{name:"error",color:"negative"})]),_:1}),C(d,null,{default:I(()=>[C(c,null,{default:I(()=>[P(Q(e),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):L("",!0),S("div",Z,[C(s,{flat:"",label:"Cancel",color:"grey-7",onClick:De}),C(s,{color:"primary",icon:"upload",label:"Confirm & Start Import",disable:0===(null==(e=ge.value.stats)?void 0:e.valid_rows),onClick:Ee},null,8,["disable"])])]}),_:1})):L("",!0),be.value&&!fe.value?(w(),j(a,{key:1},{default:I(()=>[t[19]||(t[19]=S("div",{class:"text-h6 q-mb-md"},"Import Progress",-1)),S("div",ee,[S("div",te," Overall Progress: "+Q(he.value)+" / "+Q(we.value)+" rows ",1),C(x,{value:Se.value,size:"20px",color:"primary",class:"q-mb-md"},{default:I(()=>[S("div",le,[C(g,{color:"white","text-color":"primary",label:`${Math.round(100*Se.value)}%`},null,8,["label"])])]),_:1},8,["value"])]),t[20]||(t[20]=S("div",{class:"text-subtitle1 q-mb-md"},"Row Status",-1)),C(u,{bordered:""},{default:I(()=>[(w(!0),h(T,null,D(_e.value,(e,t)=>(w(),j(i,{key:t,class:E(Ve(e.status))},{default:I(()=>[C(d,{avatar:""},{default:I(()=>[C(n,{name:Oe(e.status),color:Re(e.status)},null,8,["name","color"])]),_:2},1024),C(d,null,{default:I(()=>[C(c,null,{default:I(()=>[P("Row "+Q(t+2)+": "+Q(e.course)+" → "+Q(e.level)+" → "+Q(e.section)+" → "+Q(e.lesson),1)]),_:2},1024),C(c,{caption:""},{default:I(()=>[P(Q(Ae(e.status)),1)]),_:2},1024)]),_:2},1024),"processing"===e.status?(w(),j(d,{key:0,side:""},{default:I(()=>[C(m,{color:"primary",size:"20px"})]),_:1})):L("",!0)]),_:2},1032,["class"]))),128))]),_:1})]),_:1})):L("",!0),xe.value?(w(),j(a,{key:2},{default:I(()=>[t[26]||(t[26]=S("div",{class:"text-h6 q-mb-md"},"Import Results",-1)),S("div",ae,[S("div",se,[C(l,{class:"bg-blue-1 text-center"},{default:I(()=>[C(a,null,{default:I(()=>[S("div",oe,Q(xe.value.courses_created||0),1),t[21]||(t[21]=S("div",{class:"text-subtitle2 text-grey-8"},"Courses Created",-1))]),_:1})]),_:1})]),S("div",re,[C(l,{class:"bg-green-1 text-center"},{default:I(()=>[C(a,null,{default:I(()=>[S("div",ne,Q(xe.value.levels_created||0),1),t[22]||(t[22]=S("div",{class:"text-subtitle2 text-grey-8"},"Levels Created",-1))]),_:1})]),_:1})]),S("div",ue,[C(l,{class:"bg-orange-1 text-center"},{default:I(()=>[C(a,null,{default:I(()=>[S("div",ie,Q(xe.value.sections_created||0),1),t[23]||(t[23]=S("div",{class:"text-subtitle2 text-grey-8"},"Sections Created",-1))]),_:1})]),_:1})]),S("div",de,[C(l,{class:"bg-purple-1 text-center"},{default:I(()=>[C(a,null,{default:I(()=>[S("div",ce,Q(xe.value.lessons_created||0),1),t[24]||(t[24]=S("div",{class:"text-subtitle2 text-grey-8"},"Lessons Created",-1))]),_:1})]),_:1})])]),C(r,{class:"bg-green-1 text-green-8 q-mt-md",rounded:""},{avatar:I(()=>[C(n,{name:"check_circle"})]),default:I(()=>[t[25]||(t[25]=S("div",{class:"text-subtitle1"},"Import Completed Successfully!",-1)),S("div",null,Q(xe.value.total_processed||0)+" rows processed. "+Q(xe.value.lessons_skipped||0)+" duplicate lessons were skipped.",1)]),_:1}),S("div",me,[C(s,{color:"primary",icon:"visibility",label:"View Courses",onClick:t[3]||(t[3]=t=>e.$inertia.visit(e.route("course-management.courses.index")))})])]),_:1})):L("",!0)]),_:1})])]),_:1})],64))}},[["__scopeId","data-v-b29aa90a"]]);export{ve as default};
