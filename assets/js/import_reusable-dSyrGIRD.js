import{r as e,f as t,b as l,c as a,d as s,i as r,j as o,k as u,Q as i,l as n,aI as d,g as c}from"./app-DraepSDZ.js";import{Q as m,a as v}from"./QStepper-BlYNjdED.js";import{Q as p}from"./QMarkupTable-B8BpHV8_.js";import{Q as f}from"./QTable-lfCIUGXW.js";import{Q as b}from"./QBadge-VPRr201m.js";import{Q as g}from"./QLinearProgress-CYD1l_xP.js";import{f as y,a as x,N as w,J as _,I as h,O as k,R as C,z as S,a4 as q,b as j,K as R,V as T,L as P,F as I,Q as U,W as Q,U as L}from"./vendor-BWKGNkNB.js";import D from"./ImportExcel-BMd9xltn.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./use-panel-BIFIFpms.js";import"./use-render-cache-CmTcazfP.js";import"./QSelect-B8X205mE.js";import"./rtl-Cr6c3OOr.js";import"./use-fullscreen-WQ56vCgJ.js";import"./Modal-C_QFFTwO.js";import"./xlsx-BHXqx-YI.js";const E={class:"q-pa-md"},A={class:"row items-center justify-between"},O={class:"text-h6"},V={class:"text-subtitle2"},$={class:"q-gutter-sm"},F={class:"q-mt-md"},z={class:"q-ma-none q-pl-md"},B={class:"q-mt-md"},N={class:"row q-col-gutter-md q-mb-md"},M={class:"col-12 col-sm-6 col-md-3"},G={class:"text-h5 text-bold text-blue-8"},J={class:"col-12 col-sm-6 col-md-3"},H={class:"text-h5 text-bold text-green-8"},K={class:"col-12 col-sm-6 col-md-3"},W={class:"text-h5 text-bold text-red-8"},X={class:"col-12 col-sm-6 col-md-3"},Y={class:"text-h5 text-bold text-orange-8"},Z={key:0},ee={key:1,class:"q-mt-md"},te={class:"row justify-end q-gutter-sm"},le={class:"q-mb-md"},ae={class:"text-subtitle2 q-mb-sm"},se={class:"q-mb-md"},re={class:"absolute-full flex flex-center"},oe={class:"row q-col-gutter-md"},ue={class:"col-12 col-sm-6 col-md-3"},ie={class:"text-h5 text-bold text-blue-8"},ne={class:"col-12 col-sm-6 col-md-3"},de={class:"text-h5 text-bold text-green-8"},ce={class:"col-12 col-sm-6 col-md-3"},me={class:"text-h5 text-bold text-orange-8"},ve={class:"col-12 col-sm-6 col-md-3"},pe={class:"text-h5 text-bold text-purple-8"},fe={class:"q-mt-md"},be=e({__name:"import_reusable",props:{title:{type:String,default:""},headerTitle:{type:String,default:"Import Course Management Data"},headerSubtitle:{type:String,default:"Upload Excel file to import courses, levels, sections, and lessons"},backRoute:{type:String,default:""},templateRoute:{type:String,default:""},viewRoute:{type:String,default:""},validateUrl:{type:String,required:!0},importUrl:{type:String,required:!0},undoUrl:{type:String,default:""},importColumns:{type:Array,required:!0},fullPreviewColumns:{type:Array,required:!0},buttonText:{type:String,default:"Choose Excel File"},previewTitle:{type:String,default:"Course Import Preview"},confirmButtonText:{type:String,default:"Confirm & Start Import"},notes:{type:Array,default:()=>["Course, Level, and Lesson columns are required",'Section column is optional (will use "General" if empty)',"Duplicate lessons will be skipped","Courses, levels, and sections will be created if they don't exist","Order will be assigned automatically"]},sampleRows:{type:Array,default:()=>[["Grade 5 Math","Fractions","Add unlike fractions","Lesson A"],["Grade 5 Math","Fractions","Add unlike fractions","Lesson B"],["English Literature","Poetry","","Introduction to Poetry"]]},backLabel:{type:String,default:"Back"}},emits:["validation-success","validation-error","import-success","import-error","imported"],setup(e,{emit:be}){const ge=e,ye=be,xe=y(1),we=y(!1),_e=y(!1),he=y(!1),ke=y(!1),Ce=y(null),Se=y(null),qe=y([]),je=y({success:[],errors:[]}),Re=y([]),Te=y(0),Pe=y(0),Ie=x(()=>0===Pe.value?0:Te.value/Pe.value),Ue=()=>{ge.templateRoute&&window.open(ge.templateRoute,"_blank"),xe.value=2},Qe=e=>{Ce.value=e,e.fileData&&(qe.value=e.fileData.map((e,t)=>({index:t+2,...e}))),xe.value=3,ye("validation-success",e)},Le=e=>{Ce.value=null,ye("validation-error",e)},De=e=>{Ee(e)},Ee=e=>{Se.value=e.stats||e,we.value=!0,ye("import-success",e)},Ae=e=>{ye("import-error",e)},Oe=()=>{Ce.value=null,qe.value=[],xe.value=3,ye("import-cancelled")},Ve=()=>{_e.value=!0,Pe.value=qe.value.length,Te.value=0,Re.value=qe.value.map(e=>({course:e.Course,level:e.Level,section:e.Section,lesson:e.Lesson,status:"pending"})),Be()},$e=()=>{he.value=!0},Fe=()=>{he.value=!1},ze=()=>{ke.value=!0,he.value=!1,_e.value=!1},Be=async()=>{for(let t=0;t<qe.value.length&&!ke.value;t++){for(;he.value&&!ke.value;)await new Promise(e=>setTimeout(e,300));Re.value[t].status="processing";try{const e={...qe.value[t]};e.index&&delete e.index;const l=await fetch(ge.importUrl,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({data:[e],columns:ge.importColumns||ge.fullPreviewColumns})}),a=await l.json().catch(()=>({}));if(l.ok)Re.value[t].status="success";else if(Re.value[t].status="error",a&&(a.errors||a.message)){const e=a.message||JSON.stringify(a.errors);je.value.errors.push(`Row ${t+2}: ${e}`)}}catch(e){Re.value[t].status="error",je.value.errors.push(`Row ${t+2}: ${e.message||String(e)}`)}Te.value=t+1,await new Promise(e=>setTimeout(e,100))}try{const e=await fetch(ge.importUrl,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({data:qe.value})}),t=await e.json();e.ok?Ee(t):Ae(t)}catch(e){Ae({message:e.message})}},Ne=e=>{switch(e){case"pending":return"schedule";case"processing":return"sync";case"success":return"check_circle";case"error":return"error";default:return"help"}},Me=e=>{switch(e){case"pending":default:return"grey";case"processing":return"primary";case"success":return"positive";case"error":return"negative"}},Ge=e=>{switch(e){case"success":return"bg-green-1";case"error":return"bg-red-1";case"processing":return"bg-blue-1";default:return""}},Je=e=>{switch(e){case"pending":return"Waiting to process";case"processing":return"Processing...";case"success":return"Successfully imported";case"error":return"Failed to import";default:return"Unknown status"}};return(y,x)=>(_(),w("div",null,[e.title?(_(),h(S(q),{key:0,title:e.title},null,8,["title"])):k("",!0),C("div",E,[j(s,{flat:"",bordered:""},{default:R(()=>[j(t,null,{default:R(()=>[C("div",A,[C("div",null,[C("div",O,T(e.headerTitle),1),C("div",V,T(e.headerSubtitle),1)]),C("div",$,[e.backRoute?(_(),h(l,{key:0,flat:"",color:"grey-7",icon:"arrow_back",label:"Back",onClick:x[0]||(x[0]=t=>y.$inertia.visit(e.backRoute))})):k("",!0),e.templateRoute?(_(),h(l,{key:1,color:"primary",icon:"download",label:"Download Template",onClick:Ue})):k("",!0)])])]),_:1}),j(a),j(t,null,{default:R(()=>[x[8]||(x[8]=C("div",{class:"text-h6 q-mb-md"},"Import Instructions",-1)),P(y.$slots,"instructions",{},()=>[j(m,{modelValue:xe.value,"onUpdate:modelValue":x[2]||(x[2]=e=>xe.value=e),color:"primary",animated:"",flat:"",bordered:"","header-nav":""},{default:R(()=>[j(v,{name:1,title:"Download Template",icon:"download",done:xe.value>1},{default:R(()=>[x[4]||(x[4]=C("div",{class:"text-body1"}," Download the Excel template to see the required format and sample data. ",-1)),C("div",F,[j(l,{color:"primary",icon:"download",label:"Download Template",onClick:Ue})])]),_:1},8,["done"]),j(v,{name:2,title:"Prepare Your Data",icon:"edit",done:xe.value>2},{default:R(()=>[x[6]||(x[6]=C("div",{class:"text-body1 q-mb-md"}," Fill in your course data using this exact column structure: ",-1)),P(y.$slots,"prepare-table",{},()=>[j(p,{flat:"",bordered:""},{default:R(()=>[C("thead",null,[C("tr",null,[(_(!0),w(I,null,U(y.previewHeaderCols,(e,t)=>(_(),w("th",{class:"text-left",key:t},"Column "+T(String.fromCharCode(65+t)),1))),128))])]),C("tbody",null,[C("tr",null,[(_(!0),w(I,null,U(y.previewHeaderCols,(e,t)=>(_(),w("td",{key:t},[C("strong",null,T(e),1)]))),128))]),(_(!0),w(I,null,U(e.sampleRows,e=>(_(),w("tr",{class:"text-grey-7",key:e[0]},[(_(!0),w(I,null,U(e,(e,t)=>(_(),w("td",{key:t},T(e),1))),128))]))),128))])]),_:1})],!0),j(c,{class:"bg-blue-1 text-blue-8 q-mt-md",rounded:""},{avatar:R(()=>[j(i,{name:"info"})]),default:R(()=>[x[5]||(x[5]=C("div",{class:"text-subtitle2"},"Important Notes:",-1)),C("ul",z,[(_(!0),w(I,null,U(e.notes,(e,t)=>(_(),w("li",{key:t},T(e),1))),128))])]),_:1}),C("div",B,[j(l,{color:"primary",icon:"upload",label:"Ready to Upload",onClick:x[1]||(x[1]=e=>xe.value=3)})])]),_:3},8,["done"]),j(v,{name:3,title:"Upload & Import",icon:"upload",done:we.value},{default:R(()=>[x[7]||(x[7]=C("div",{class:"text-body1 q-mb-md"}," Upload your Excel file to import the course data. ",-1)),P(y.$slots,"uploader",{},()=>[j(D,{"validate-url":e.validateUrl,"import-url":e.importUrl,"undo-url":e.undoUrl,columns:e.importColumns,"button-text":e.buttonText,"preview-title":e.previewTitle,"confirm-button-text":e.confirmButtonText,onValidationSuccess:Qe,onValidationError:Le,onImported:De},null,8,["validate-url","import-url","undo-url","columns","button-text","preview-title","confirm-button-text"])],!0)]),_:3},8,["done"])]),_:3},8,["modelValue"])],!0)]),_:3}),Ce.value&&!_e.value?(_(),h(t,{key:0},{default:R(()=>{var a;return[x[15]||(x[15]=C("div",{class:"text-h6 q-mb-md"},"File Preview & Confirmation",-1)),C("div",N,[C("div",M,[j(s,{class:"bg-blue-1 text-center"},{default:R(()=>[j(t,null,{default:R(()=>{var e;return[C("div",G,T((null==(e=Ce.value.stats)?void 0:e.total_rows)||0),1),x[9]||(x[9]=C("div",{class:"text-subtitle2 text-grey-8"},"Total Rows",-1))]}),_:1})]),_:1})]),C("div",J,[j(s,{class:"bg-green-1 text-center"},{default:R(()=>[j(t,null,{default:R(()=>{var e;return[C("div",H,T((null==(e=Ce.value.stats)?void 0:e.valid_rows)||0),1),x[10]||(x[10]=C("div",{class:"text-subtitle2 text-grey-8"},"Valid Rows",-1))]}),_:1})]),_:1})]),C("div",K,[j(s,{class:"bg-red-1 text-center"},{default:R(()=>[j(t,null,{default:R(()=>{var e;return[C("div",W,T((null==(e=Ce.value.stats)?void 0:e.invalid_rows)||0),1),x[11]||(x[11]=C("div",{class:"text-subtitle2 text-grey-8"},"Invalid Rows",-1))]}),_:1})]),_:1})]),C("div",X,[j(s,{class:"bg-orange-1 text-center"},{default:R(()=>[j(t,null,{default:R(()=>{var e;return[C("div",Y,T((null==(e=Ce.value.errors)?void 0:e.length)||0),1),x[12]||(x[12]=C("div",{class:"text-subtitle2 text-grey-8"},"Errors",-1))]}),_:1})]),_:1})])]),qe.value&&qe.value.length>0?(_(),w("div",Z,[x[13]||(x[13]=C("div",{class:"text-subtitle1 q-mb-md"},"Complete Data Preview",-1)),j(f,{rows:qe.value,columns:e.fullPreviewColumns,"row-key":"index",flat:"",bordered:"",dense:"",pagination:{rowsPerPage:20},class:"q-mb-md"},null,8,["rows","columns"])])):k("",!0),Ce.value.errors&&Ce.value.errors.length>0?(_(),w("div",ee,[x[14]||(x[14]=C("div",{class:"text-subtitle1 q-mb-md text-negative"},"Validation Errors",-1)),j(r,{bordered:"",class:"q-mb-md"},{default:R(()=>[(_(!0),w(I,null,U(Ce.value.errors,(e,t)=>(_(),h(o,{key:t},{default:R(()=>[j(u,{avatar:""},{default:R(()=>[j(i,{name:"error",color:"negative"})]),_:1}),j(u,null,{default:R(()=>[j(n,null,{default:R(()=>[Q(T(e),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):k("",!0),C("div",te,[j(l,{flat:"",label:"Cancel",color:"grey-7",onClick:Oe}),j(l,{color:"primary",icon:"upload",label:"Confirm & Start Import",disable:0===(null==(a=Ce.value.stats)?void 0:a.valid_rows),onClick:Ve},null,8,["disable"])])]}),_:1})):k("",!0),_e.value&&!we.value?(_(),h(t,{key:1},{default:R(()=>[x[19]||(x[19]=C("div",{class:"text-h6 q-mb-md"},"Import Progress",-1)),C("div",le,[C("div",ae," Overall Progress: "+T(Te.value)+" / "+T(Pe.value)+" rows ",1),C("div",se,[!he.value&&_e.value?(_(),h(l,{key:0,size:"sm",color:"primary",flat:"",icon:"pause",onClick:$e},{default:R(()=>x[16]||(x[16]=[Q("Pause")])),_:1})):k("",!0),he.value?(_(),h(l,{key:1,size:"sm",color:"primary",flat:"",icon:"play_arrow",onClick:Fe},{default:R(()=>x[17]||(x[17]=[Q("Resume")])),_:1})):k("",!0),_e.value&&!ke.value?(_(),h(l,{key:2,size:"sm",color:"negative",flat:"",icon:"stop",onClick:ze},{default:R(()=>x[18]||(x[18]=[Q("Stop")])),_:1})):k("",!0)]),j(g,{value:Ie.value,size:"20px",color:"primary",class:"q-mb-md"},{default:R(()=>[C("div",re,[j(b,{color:"white","text-color":"primary",label:`${Math.round(100*Ie.value)}%`},null,8,["label"])])]),_:1},8,["value"])]),x[20]||(x[20]=C("div",{class:"text-subtitle1 q-mb-md"},"Row Status",-1)),j(r,{bordered:""},{default:R(()=>[(_(!0),w(I,null,U(Re.value,(e,t)=>(_(),h(o,{key:t,class:L(Ge(e.status))},{default:R(()=>[j(u,{avatar:""},{default:R(()=>[j(i,{name:Ne(e.status),color:Me(e.status)},null,8,["name","color"])]),_:2},1024),j(u,null,{default:R(()=>[j(n,null,{default:R(()=>[Q("Row "+T(t+2)+": "+T(e.course)+" → "+T(e.level)+" → "+T(e.section)+" → "+T(e.lesson),1)]),_:2},1024),j(n,{caption:""},{default:R(()=>[Q(T(Je(e.status)),1)]),_:2},1024)]),_:2},1024),"processing"===e.status?(_(),h(u,{key:0,side:""},{default:R(()=>[j(d,{color:"primary",size:"20px"})]),_:1})):k("",!0)]),_:2},1032,["class"]))),128))]),_:1})]),_:1})):k("",!0),Se.value?(_(),h(t,{key:2},{default:R(()=>[x[26]||(x[26]=C("div",{class:"text-h6 q-mb-md"},"Import Results",-1)),C("div",oe,[C("div",ue,[j(s,{class:"bg-blue-1 text-center"},{default:R(()=>[j(t,null,{default:R(()=>[C("div",ie,T(Se.value.courses_created||0),1),x[21]||(x[21]=C("div",{class:"text-subtitle2 text-grey-8"},"Courses Created",-1))]),_:1})]),_:1})]),C("div",ne,[j(s,{class:"bg-green-1 text-center"},{default:R(()=>[j(t,null,{default:R(()=>[C("div",de,T(Se.value.levels_created||0),1),x[22]||(x[22]=C("div",{class:"text-subtitle2 text-grey-8"},"Levels Created",-1))]),_:1})]),_:1})]),C("div",ce,[j(s,{class:"bg-orange-1 text-center"},{default:R(()=>[j(t,null,{default:R(()=>[C("div",me,T(Se.value.sections_created||0),1),x[23]||(x[23]=C("div",{class:"text-subtitle2 text-grey-8"},"Sections Created",-1))]),_:1})]),_:1})]),C("div",ve,[j(s,{class:"bg-purple-1 text-center"},{default:R(()=>[j(t,null,{default:R(()=>[C("div",pe,T(Se.value.lessons_created||0),1),x[24]||(x[24]=C("div",{class:"text-subtitle2 text-grey-8"},"Lessons Created",-1))]),_:1})]),_:1})])]),j(c,{class:"bg-green-1 text-green-8 q-mt-md",rounded:""},{avatar:R(()=>[j(i,{name:"check_circle"})]),default:R(()=>[x[25]||(x[25]=C("div",{class:"text-subtitle1"},"Import Completed Successfully!",-1)),C("div",null,T(Se.value.total_processed||0)+" rows processed. "+T(Se.value.lessons_skipped||0)+" duplicate lessons were skipped.",1)]),_:1}),C("div",fe,[j(l,{color:"primary",icon:"visibility",label:"View Courses",onClick:x[3]||(x[3]=t=>y.$inertia.visit(e.viewRoute||y.route("course-management.courses.index")))})])]),_:1})):k("",!0)]),_:3})])]))}},[["__scopeId","data-v-378e5642"]]);export{be as default};
