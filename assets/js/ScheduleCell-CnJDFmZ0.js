import{Q as e}from"./QBadge-B7PIhVlN.js";import{r as l,u as o,i as a,j as s,k as t,aS as i,b as r,c as d,Q as n,ao as c,t as u,d as v,f as m,l as p,aR as f,o as g,e as _,a$ as h}from"./app-Dtv5Fi9L.js";import{Q as b}from"./QTable-DjEJtvgI.js";import{q as y,f as x,a as k,N as w,J as j,b as C,R as P,K as S,y as q,W as I,V as $,I as T,O as Q,F as U,Q as B,S as O,U as A,_ as L}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./QMarkupTable-BGpv7gz2.js";import"./QSelect-BslHFD89.js";import"./rtl-Cr6c3OOr.js";import"./QLinearProgress-D6iXPeG1.js";import"./use-fullscreen-GpMU35jG.js";const V={class:"text-sm text-gray-700"},z={class:"q-pa-sm"},D={class:"flex p-1 flex-row justify-center gap-2"},E={class:"row items-center no-wrap"},F={class:"text-center"},M={class:"flex flex-col justify-start gap-2"},N={class:"text-sm text-gray-700"},R={class:"q-pa-sm"},W={class:"row items-center no-wrap"},J={class:"text-center"},K={class:"flex flex-col justify-start gap-2"},G={class:"flex flex-row justify-center gap-2"},H={class:"row items-center no-wrap"},X={class:"text-center"},Y={class:"flex flex-col justify-start gap-2"},Z={class:"text-sm text-gray-700"},ee={class:"q-pa-sm"},le={class:"absolute inset-0 pointer-events-none cursor-pointer z-10 scale-150"},oe={class:"relative z-20 flex flex-row items-center w-full h-full text-xs text-center gap-1 px-2"},ae={class:"rounded bg-black text-yellow-100"},se={class:"p-0 flex flex-row items-center gap-1"},te={class:"text-xs scale-75 rounded bg-black text-yellow-100 px-1"},ie={key:1,class:"p-0"},re={class:"relative px-1"},de=l({__name:"ScheduleCell",props:{teacher_data:{type:Object,required:!0},dayIndex:{type:Number,required:!0},period_code:{type:String,required:!0},periodIndex:{type:Number,required:!0},selectedPeriod:{type:Object,required:!0},hoverPeriod:{type:Object,required:!0},isLocked:{type:Boolean,default:!1},isDisabled:{type:Boolean,default:!1},is_confirm:{type:Boolean,default:!1},conflicts:{type:Array,required:!1}},emits:["toggle-lock","toggle-disable","link-period","update_grid"],setup(l,{emit:de}){const ne=l,ce=de,ue=o(),ve=y("days",["Sun","Mon","Tue","Wed","Thu"]),me=y("periodsCount",8),pe=x(!1),fe=k(()=>ne.teacher_data),ge=k(()=>ne.selectedPeriod.day===ne.dayIndex&&ne.selectedPeriod.period===ne.periodIndex),_e=k(()=>ne.hoverPeriod.day===ne.dayIndex&&ne.hoverPeriod.period===ne.periodIndex),he=e=>ve[e]||`Day ${e+1}`,be=e=>`P${e+1}`;k(()=>{const e=[];if(!ne.teacher_data)return e;for(let l=0;l<ve.length;l++)for(let o=0;o<me;o++){const a=`d${l+1}p${o+1}`;ne.teacher_data[a]||a===ne.period_code||e.push({code:a,label:`${he(l)} ${be(o)}`,dayIndex:l,periodIndex:o})}return e}),k(()=>{var e,l;const o=null==(l=null==(e=fe.value)?void 0:e[ne.period_code])?void 0:l.classroom;return o&&ne.conflicts&&0!==ne.conflicts.length?ne.conflicts.filter(e=>e.classroom===o).length:0});const ye=e=>e&&ne.conflicts&&0!==ne.conflicts.length?ne.conflicts.filter(l=>l.classroom===e):0,xe=e=>{ne.is_confirm?ue.dialog({title:"Confirm Period Link",message:`Assign "${null==e?void 0:e.subject} / ${null==e?void 0:e.classroom}" to period ${ne.period_code}?`,cancel:!0,persistent:!0}).onOk(()=>{ke(e)}).onCancel(()=>{je("Period link cancelled")}):ke(e)},ke=e=>{if(!(null==e?void 0:e.schedule_id))return void ue.notify({type:"negative",message:"Error: Missing ID for the selected period."});const l=e.schedule_id,o=ne.period_code;h.start();const a=route("admin.schedules.update_period_code",{schedule:l});L.patch(a,{period_code:o}).then(e=>{h.done(),pe.value=!1,ue.notify({type:"positive",message:e.data.message||"Schedule updated successfully!"}),ce("update_grid")}).catch(e=>{var l,o;h.done(),pe.value=!1,console.error("Error updating period code:",e),e.response&&422===e.response.status?ue.notify({type:"warning",message:e.response.data.message||"Teacher conflict detected.",icon:"warning"}):ue.notify({type:"negative",message:(null==(o=null==(l=e.response)?void 0:l.data)?void 0:o.message)||"Failed to update schedule."})})},we=()=>{var e,l;const o=null==(l=null==(e=ne.teacher_data)?void 0:e[ne.period_code])?void 0:l.schedule_id;h.start();const a=route("admin.schedules.update_period_code",{schedule:o});L.patch(a,{period_code:null}).then(e=>{h.done(),ue.loading.hide(),pe.value=!1,ue.notify({type:"positive",message:e.data.message||"Schedule updated successfully!"}),ce("update_grid")}).catch(e=>{var l,o;h.done(),pe.value=!1,ue.loading.hide(),console.error("Error updating period code:",e),e.response&&422===e.response.status?ue.notify({type:"warning",message:e.response.data.message||"Conflict detected during unlink.",icon:"warning"}):ue.notify({type:"negative",message:(null==(o=null==(l=e.response)?void 0:l.data)?void 0:o.message)||"Failed to update schedule."})})},je=(e,l="log")=>{console.log(l,e)};return(o,h)=>{var y,x,k,L,de,ce,ue,ve,me;return j(),w("div",{class:"relative w-full h-full flex flex-col items-center justify-center cursor-pointer",onClick:h[1]||(h[1]=e=>pe.value=!0)},[C(c,{"touch-position":"","context-menu":""},{default:S(()=>[C(a,{dense:"",style:{"min-width":"100px"}},{default:S(()=>[C(s,null,{default:S(()=>[C(t,null,{default:S(()=>{var o,a,s,t;return[P("div",{color:"primary",onClick:we},[h[2]||(h[2]=P("div",{class:"p-2"},null,-1)),C(e,{color:"red"},{default:S(()=>{var e;return[I($(null==(e=fe.value[ne.period_code])?void 0:e.classroom),1)]}),_:1}),I(" : "+$(null==(a=null==(o=fe.value)?void 0:o[l.period_code])?void 0:a.subject)+" : "+$(null==(t=null==(s=fe.value)?void 0:s.teacher)?void 0:t.name),1)])]}),_:1})]),_:1}),q((j(),T(s,{clickable:""},{default:S(()=>[C(t,null,{default:S(()=>{var e;return[(null==(e=fe.value[ne.period_code])?void 0:e.classroom)?(j(),T(r,{key:0,color:"primary",onClick:we},{default:S(()=>h[3]||(h[3]=[I("Unlink Period ")])),_:1})):Q("",!0)]}),_:1})]),_:1})),[[i]]),C(d),C(s,{clickable:""},{default:S(()=>[C(t,null,{default:S(()=>h[4]||(h[4]=[I("Link with")])),_:1}),C(t,{side:""},{default:S(()=>[C(n,{name:"keyboard_arrow_right"})]),_:1}),C(c,{anchor:"top end",self:"top start"},{default:S(()=>{var l;return[(j(!0),w(U,null,B(null==(l=fe.value)?void 0:l.period_code_empty,l=>(j(),T(s,{key:l.id,onClick:e=>xe(l),clickable:""},{default:S(()=>[C(t,null,{default:S(()=>{var o;return[C(e,{class:"text-sm relative",color:"primary"},{default:S(()=>{var o,a;return[I($(null==l?void 0:l.classroom)+" ",1),(null==(o=ye(null==l?void 0:l.classroom))?void 0:o.length)>0?(j(),T(e,{key:0,color:"negative",rounded:"",class:"text-xs absolute -top-4 right-4",label:null==(a=ye(null==l?void 0:l.classroom))?void 0:a.length},null,8,["label"])):Q("",!0)]}),_:2},1024),P("span",V,$(null==l?void 0:l.subject),1),(null==(o=ye(null==l?void 0:l.classroom))?void 0:o.length)>0?(j(),T(u,{key:0,anchor:"top middle",self:"bottom middle",delay:100},{default:S(()=>[P("div",z,[h[5]||(h[5]=P("div",{class:"text-sm font-medium mb-1"}," Conflicts for this classroom: ",-1)),C(b,{rows:ye(null==l?void 0:l.classroom),columns:[{name:"teacher",label:"Teacher",field:"teacher",align:"left"},{name:"classroom",label:"Classroom",field:"classroom",align:"left"},{name:"subject",label:"Subject",field:"subject",align:"left"}],"row-key":"teacher"},null,8,["rows"])])]),_:2},1024)):Q("",!0)]}),_:2},1024),C(t,{side:""},{default:S(()=>[C(n,{name:"keyboard_arrow_right"})]),_:1})]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1}),C(d),q((j(),T(s,{clickable:""},{default:S(()=>[C(t,null,{default:S(()=>h[6]||(h[6]=[I("Quit")])),_:1})]),_:1})),[[i]])]),_:1})]),_:1}),C(_,{modelValue:pe.value,"onUpdate:modelValue":h[0]||(h[0]=e=>pe.value=e),position:"bottom"},{default:S(()=>[C(v,{class:"relative"},{default:S(()=>[C(m,{class:"text-lg font-semibold text-center text-primary"},{default:S(()=>h[7]||(h[7]=[I(" Available Periods ")])),_:1}),C(d),C(m,{class:"q-pa-none"},{default:S(()=>{var l;return[P("div",D,[(j(!0),w(U,null,B(null==(l=fe.value)?void 0:l.period_code_empty,l=>{var d,n,c;return j(),w("div",{class:"p-0",key:l.id},[(null==(d=ye(null==l?void 0:l.classroom))?void 0:d.length)>0?(j(),T(f,{key:0,class:"min-w-fit","disable-dropdown":0==(null==(n=ye(null==l?void 0:l.classroom))?void 0:n.length),split:"",color:(null==(c=ye(null==l?void 0:l.classroom))?void 0:c.length)>0?"red":"blue",push:"","no-caps":"",onClick:e=>xe(l)},{label:S(()=>{var o;return[P("div",E,[P("div",F,[P("div",M,[C(e,{class:"text-sm relative",color:"primary"},{default:S(()=>{var o,a;return[I($(null==l?void 0:l.classroom)+" ",1),(null==(o=ye(null==l?void 0:l.classroom))?void 0:o.length)>0?(j(),T(e,{key:0,color:"negative",rounded:"",class:"text-xs absolute -top-4 right-4",label:null==(a=ye(null==l?void 0:l.classroom))?void 0:a.length},null,8,["label"])):Q("",!0)]}),_:2},1024),P("span",N,$(null==l?void 0:l.subject),1),(null==(o=ye(null==l?void 0:l.classroom))?void 0:o.length)>0?(j(),T(u,{key:0,anchor:"top middle",self:"bottom middle",delay:100},{default:S(()=>[P("div",R,[h[8]||(h[8]=P("div",{class:"text-sm font-medium mb-1"}," Conflicts for this classroom: ",-1)),C(b,{rows:ye(null==l?void 0:l.classroom),columns:[{name:"teacher",label:"Teacher",field:"teacher",align:"left"},{name:"classroom",label:"Classroom",field:"classroom",align:"left"},{name:"subject",label:"Subject",field:"subject",align:"left"}],"row-key":"teacher","hide-pagination":"",dense:""},null,8,["rows"])])]),_:2},1024)):Q("",!0)])])])]}),default:S(()=>[C(a,null,{default:S(()=>[q((j(),T(s,{clickable:"",onClick:o.onItemClick},{default:S(()=>[C(t,null,{default:S(()=>[C(p,{caption:""},{default:S(()=>h[9]||(h[9]=[I("Conflicts for this classroom:")])),_:1}),C(p,null,{default:S(()=>[C(b,{rows:ye(null==l?void 0:l.classroom),columns:[{name:"teacher",label:"Teacher",field:"teacher",align:"left"},{name:"classroom",label:"Classroom",field:"classroom",align:"left"},{name:"subject",label:"Subject",field:"subject",align:"left"}],"row-key":"teacher","hide-pagination":"",dense:""},null,8,["rows"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[i]])]),_:2},1024)]),_:2},1032,["disable-dropdown","color","onClick"])):(j(),T(r,{key:1,class:"min-w-fit text-yellow-200",color:"light-blue",push:"","no-caps":"",onClick:e=>xe(l)},{default:S(()=>[P("div",W,[P("div",J,[P("div",K,[P("div",{class:"text-sm px-1",style:O(`background-color:  ${null==l?void 0:l.c_bg};color: ${null==l?void 0:l.c_text};`)},[C(e,{class:"text-sm relative",color:"primary"},{default:S(()=>[I($(null==l?void 0:l.classroom),1)]),_:2},1024),I(" "+$(null==l?void 0:l.subject),1)],4)])])])]),_:2},1032,["onClick"]))])}),128))])]}),_:1}),C(d),C(g,{align:"right"},{default:S(()=>{var e;return[(null==(e=fe.value[ne.period_code])?void 0:e.classroom)?(j(),T(r,{key:0,label:"Unlink Period",color:"primary",onClick:we})):Q("",!0)]}),_:1})]),_:1})]),_:1},8,["modelValue"]),C(_,{"transition-show":"scale","transition-hide":"scale"},{default:S(()=>[C(v,{class:"min-w-[650px]"},{default:S(()=>[C(m,{class:"text-lg font-semibold text-center text-primary"},{default:S(()=>h[10]||(h[10]=[I(" Available Periods ")])),_:1}),C(d),C(m,{class:"q-pa-none"},{default:S(()=>{var l;return[P("div",G,[(j(!0),w(U,null,B(null==(l=fe.value)?void 0:l.period_code_empty,l=>{var r,d;return j(),T(f,{"disable-dropdown":0==(null==(r=ye(null==l?void 0:l.classroom))?void 0:r.length),split:"",color:(null==(d=ye(null==l?void 0:l.classroom))?void 0:d.length)>0?"red":"blue",push:"","no-caps":"",key:l.id,onClick:e=>xe(l)},{label:S(()=>{var o;return[P("div",H,[P("div",X,[P("div",Y,[C(e,{class:"text-sm relative",color:"primary"},{default:S(()=>{var o,a;return[I($(null==l?void 0:l.classroom)+" ",1),(null==(o=ye(null==l?void 0:l.classroom))?void 0:o.length)>0?(j(),T(e,{key:0,color:"negative",rounded:"",class:"text-xs absolute -top-4 right-4",label:null==(a=ye(null==l?void 0:l.classroom))?void 0:a.length},null,8,["label"])):Q("",!0)]}),_:2},1024),P("span",Z,$(null==l?void 0:l.subject),1),(null==(o=ye(null==l?void 0:l.classroom))?void 0:o.length)>0?(j(),T(u,{key:0,anchor:"top middle",self:"bottom middle",delay:100},{default:S(()=>[P("div",ee,[h[11]||(h[11]=P("div",{class:"text-sm font-medium mb-1"}," Conflicts for this classroom: ",-1)),C(b,{rows:ye(null==l?void 0:l.classroom),columns:[{name:"teacher",label:"Teacher",field:"teacher",align:"left"},{name:"classroom",label:"Classroom",field:"classroom",align:"left"},{name:"subject",label:"Subject",field:"subject",align:"left"}],"row-key":"teacher","hide-pagination":"",dense:""},null,8,["rows"])])]),_:2},1024)):Q("",!0)])])])]}),default:S(()=>[C(a,null,{default:S(()=>[q((j(),T(s,{clickable:"",onClick:o.onItemClick},{default:S(()=>[C(t,null,{default:S(()=>[C(p,{caption:""},{default:S(()=>h[12]||(h[12]=[I("Conflicts for this classroom:")])),_:1}),C(p,null,{default:S(()=>[C(b,{rows:ye(null==l?void 0:l.classroom),columns:[{name:"teacher",label:"Teacher",field:"teacher",align:"left"},{name:"classroom",label:"Classroom",field:"classroom",align:"left"},{name:"subject",label:"Subject",field:"subject",align:"left"}],"row-key":"teacher","hide-pagination":"",dense:""},null,8,["rows"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[i]])]),_:2},1024)]),_:2},1032,["disable-dropdown","color","onClick"])}),128))])]}),_:1}),C(d),C(g,{align:"right"},{default:S(()=>[C(r,{label:"Unlink Period",color:"primary",onClick:we})]),_:1})]),_:1})]),_:1}),P("div",le,[P("div",{class:A([ge.value?"  shadow-none rounded-none h-16    opacity-100":"opacity-0","absolute inset-0 rounded transition-opacity duration-200"])},h[13]||(h[13]=[P("div",{class:"w-full h-full bg-gray-200 opacity-40"},null,-1)]),2),P("div",{class:A([_e.value?"bg-gray-400 opacity-20":"opacity-0","absolute inset-0 rounded duration-200 pointer-events-none"])},null,2)]),P("div",oe,[(null==(y=fe.value[ne.period_code])?void 0:y.classroom)?(j(),w("div",{key:0,class:A(["flex flex-row items-center",(null==(x=fe.value[ne.period_code])?void 0:x.classroom)?"blue":" "])},[P("div",ae,[P("div",se,[P("div",te,[P("div",null,[(null==(k=fe.value[ne.period_code])?void 0:k.conflict_count)>0?(j(),T(e,{key:0,color:"red","text-color":"white"},{default:S(()=>{var l;return[I($(null==(l=fe.value[ne.period_code])?void 0:l.classroom)+" ",1),C(e,{class:"mt-4",color:"red",floating:""},{default:S(()=>{var e;return[I($(null==(e=fe.value[ne.period_code])?void 0:e.conflict_count),1)]}),_:1})]}),_:1})):Q("",!0),0==(null==(L=fe.value[ne.period_code])?void 0:L.conflict_count)?(j(),w("div",ie,$(null==(de=fe.value[ne.period_code])?void 0:de.classroom),1)):Q("",!0)])]),P("span",re,[I($(null==(ue=null==(ce=fe.value)?void 0:ce[l.period_code])?void 0:ue.subject_cute)+" ",1),(null==(me=null==(ve=fe.value)?void 0:ve[l.period_code])?void 0:me.subject)?(j(),T(u,{key:0,anchor:"top middle",self:"bottom middle",delay:300},{default:S(()=>{var e,o;return[I($(null==(o=null==(e=fe.value)?void 0:e[l.period_code])?void 0:o.subject),1)]}),_:1})):Q("",!0)])])])],2)):Q("",!0)])])}}},[["__scopeId","data-v-46b1c2d3"]]);export{de as default};
