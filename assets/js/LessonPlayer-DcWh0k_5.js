import{u as e,aq as t,e as s}from"./app-BXm70mdJ.js";import{f as a,a as i,k as l,o,L as r,I as n,b as c,M as u,J as d,O as p,U as v,S as m,R as g,V as y,H as x,Z as f}from"./vendor-DNM7Y6Xn.js";import{Q as b,U as w}from"./QuestionSlide-D0sVKVDi.js";import h from"./LessonSidebar-BAr4v8Nk.js";import"./offline-BzIlwqNM.js";import"./i18n-CBOKL2HS.js";import"./ui-BP0GJNn5.js";import"./EnhancedQuestionEditor-Cs8uFUOt.js";import"./QuestionEditor-zbB_kPoz.js";import"./RichTextEditor-CxB-jvy6.js";import"./QSlider-BotkHKKU.js";import"./QTabs-CDJ215OP.js";import"./rtl-Cr6c3OOr.js";import"./QTab-DhKL91H_.js";import"./QTabPanels-LFwTBPSC.js";import"./use-panel-D2HepUiw.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanel-sB32VrK8.js";import"./purify.es-C2Ba6vpb.js";import"./MathEditor-BSejsytI.js";import"./katex-BXKQVcz-.js";import"./MathPastePreview-CJnG0Z0g.js";import"./QBadge-ZzhN1X9C.js";import"./QSelect-CnZtzPIC.js";import"./StepByStepEditor-B4BGjvgG.js";import"./QuestionTypeSelector-CB_cjRod.js";import"./QuizEngine-IQNXJWyB.js";import"./useQuizI18n-BM0hw-zK.js";import"./QPagination-CaPaC77P.js";const _={class:"h-screen flex bg-gray-50"},k={key:0},z={key:1},j={key:2},q={key:3},P={class:"flex-1 flex flex-col overflow-hidden"},S={class:"bg-white border-b border-gray-200 px-6 py-4"},Q={class:"flex items-start justify-between mb-4"},C={class:"flex-1 mr-4"},L={class:"text-xl font-bold text-gray-800"},M={class:"flex items-center gap-2 mt-1"},E={class:"text-sm text-gray-500"},T={class:"p-8 flex justify-center overflow-y-auto custom-scrollbar"},B={class:"w-full max-w-4xl"},$={key:0,class:"flex items-center justify-center h-64"},A={key:1,class:"bg-white rounded-xl shadow-sm p-12 text-center"},I={key:2},O={class:"bg-white rounded-xl shadow-sm overflow-hidden min-h-[600px] flex flex-col"},U={key:0,class:"flex-1 flex flex-col"},N={class:"flex-1 p-8 flex flex-col"},F={class:"mb-4 flex justify-between items-center"},R={class:"text-sm text-gray-500"},V={class:"text-xs font-bold text-gray-400 uppercase tracking-wider"},D={class:"flex-1"},H=["innerHTML"],W={key:1,class:"h-full flex items-center justify-center"},Y=["src"],J=["src"],K={key:2,class:"text-center"},Z=["href"],G={key:2,class:"space-y-8"},X={class:"bg-gray-50 px-8 py-4 border-t border-gray-200 flex justify-between items-center"},ee=["disabled"],te={key:0},se={key:1},ae={key:1,class:"flex justify-center p-8"},ie={key:2,class:"p-12 text-center max-w-2xl mx-auto"},le={class:"mb-6"},oe={key:0,class:"bg-gray-50 p-6 rounded-lg border border-gray-200 mb-6"},re={class:"text-2xl font-bold text-gray-800 mb-2"},ne={key:0,class:"text-sm text-gray-600 mb-3"},ce={class:"flex items-center justify-center gap-4 text-sm text-gray-600"},ue={class:"flex items-center gap-1"},de={key:0,class:"flex items-center gap-1"},pe={key:1,class:"bg-yellow-50 p-6 rounded-lg border border-yellow-200 mb-6"},ve={key:2,class:"bg-gray-50 p-6 rounded-lg border border-gray-200 mb-6"},me={key:3,class:"mt-8"},ge={key:3,class:"flex-1 flex items-center justify-center text-gray-500 p-12"},ye={__name:"LessonPlayer",props:{presentation:{type:Object,default:()=>({})},sections:{type:Array,default:()=>[]},slides:{type:Array,default:()=>[]},progress:{type:Object,default:null},loading:{type:Boolean,default:!1},isPreview:{type:Boolean,default:!1}},emits:["complete-learn","submit-practice"],setup(ye,{emit:xe}){const fe=e(),be=ye,we=xe,he=a("learn"),_e=a(null),ke=a(0),ze=a(!0),je=a(!1);a({}),a({});const qe=a({});a({});const Pe=a(null);a(!1);const Se=i(()=>be.slides.filter(e=>e.section===he.value)),Qe=i(()=>Se.value[ke.value]||{}),Ce=i(()=>{var e,t;if(be.isPreview)return!0;if("question"!==(null==(e=Qe.value)?void 0:e.slide_type))return!0;return((null==(t=Qe.value.slide_content)?void 0:t.questions)||[]).every(e=>qe.value[e.id])}),Le=i(()=>!!be.isPreview||!!be.progress&&(be.progress.learn_completed_at||"opened"!==be.progress.status)),Me=i(()=>!!be.isPreview||!!be.progress&&("quiz_unlocked"===be.progress.status||"completed"===be.progress.status||"failed"===be.progress.status)),Ee=e=>!!be.isPreview||("learn"===e||("objectives"===e||("warmup"===e||("homework"===e||("practice"===e?Le.value:"quiz"!==e||Me.value))))),Te=e=>{if(Ee(e))he.value=e;else{let t="You cannot access this section yet.";"practice"===e?t="Please complete the Learn section first.":"quiz"===e&&(t="Please complete the Practice section first."),fe.notify({type:"warning",message:t,position:"top"})}},Be=e=>{if(he.value!==e.section){if(!Ee(e.section))return void Te(e.section);he.value=e.section}ke.value=Se.value.indexOf(e)},$e=()=>{Ce.value?ke.value<Se.value.length-1?ke.value++:Ie():fe.notify({type:"warning",message:"Please complete all questions before proceeding."})},Ae=()=>{ke.value>0&&ke.value--},Ie=()=>{"learn"===he.value?be.isPreview?(fe.notify({type:"positive",message:"[Preview] Learn section completed"}),he.value="practice"):we("complete-learn"):"practice"===he.value||"quiz"===he.value?je.value=!0:fe.notify({type:"positive",message:"Section completed!"})},Oe=()=>{be.isPreview?fe.notify({type:"positive",message:"[Preview] Practice submitted"}):we("submit-practice")},Ue=async e=>{if(be.isPreview)console.log("Preview mode - Answer selected:",e);else try{await f.post("/api/quiz-attempts/answers",{presentation_id:be.presentation.id,slide_id:Qe.value.id,question_id:e.questionId,selected_option_id:e.selectedOptionId,selected_text:e.selectedText,is_correct:e.correct,time_spent_sec:e.timeSpentSec,answered_at:e.answeredAt})}catch(t){console.error("Failed to save answer:",t)}},Ne=async e=>{var t;if(be.isPreview)fe.notify({type:"positive",message:`[Preview] Quiz completed! Score: ${e.correct}/${e.total} (${e.percentage}%)`,timeout:3e3});else try{await f.post("/api/quiz-attempts",{presentation_id:be.presentation.id,slide_id:Qe.value.id,attempt_id:e.attemptId,total_questions:e.total,correct_answers:e.correct,percentage:e.percentage,completed_at:e.completedAt,answers:e.answers,metadata:e.metadata}),fe.notify({type:"positive",message:`Quiz completed! Score: ${e.correct}/${e.total} (${e.percentage}%)`,icon:"check_circle",position:"top",timeout:3e3});((null==(t=Qe.value.slide_content)?void 0:t.questions)||[]).forEach(e=>{qe.value[e.id]=!0})}catch(s){console.error("Failed to save quiz attempt:",s),fe.notify({type:"warning",message:"Quiz completed but failed to save results. Please contact your teacher.",icon:"warning",position:"top",timeout:5e3})}};l(he,()=>{ke.value=0,je.value=!1});const Fe=async()=>{if(be.presentation.quiz_id)try{const e=await f.get(`/api/quizzes/${be.presentation.quiz_id}`);Pe.value=e.data}catch(e){console.error("Failed to fetch quiz info:",e),fe.notify({type:"warning",message:"Failed to load quiz information",icon:"warning",position:"top"})}else Pe.value=null},Re=()=>{be.presentation.quiz_id&&Pe.value?fe.notify({type:"info",message:"Quiz engine integration coming soon!",icon:"info",position:"top"}):fe.notify({type:"warning",message:"Quiz information not available",icon:"warning",position:"top"})};return o(()=>{be.progress&&("locked"===be.progress.status||(Me.value?he.value="quiz":Le.value&&!be.progress.practice_submitted_at&&(he.value="practice"))),be.presentation.quiz_id&&Fe()}),l(()=>be.presentation.quiz_id,e=>{e?Fe():Pe.value=null}),(e,a)=>{var i,l,o,f,xe,fe,we,qe,Le;return n(),r("div",_,[c(h,{sections:ye.sections,currentSection:he.value,"onUpdate:currentSection":[a[0]||(a[0]=e=>he.value=e),Te],currentSection_data:_e.value,"onUpdate:currentSection_data":a[1]||(a[1]=e=>_e.value=e),slides:ye.slides,showDrawer:ze.value,"onUpdate:showDrawer":a[2]||(a[2]=e=>ze.value=e),"can-edit":!1,onSelectSlide:Be},{"section-status":d(({section:e})=>{var t,s,i;return["learn"===e.id&&(null==(t=ye.progress)?void 0:t.learn_completed_at)?(n(),r("div",k,a[3]||(a[3]=[u("svg",{class:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))):"practice"===e.id&&(null==(s=ye.progress)?void 0:s.practice_submitted_at)?(n(),r("div",z,a[4]||(a[4]=[u("svg",{class:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))):"quiz"===e.id&&(null==(i=ye.progress)?void 0:i.quiz_passed)?(n(),r("div",j,a[5]||(a[5]=[u("svg",{class:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))):Ee(e.id)?p("",!0):(n(),r("div",q,a[6]||(a[6]=[u("svg",{class:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})],-1)])))]}),_:1},8,["sections","currentSection","currentSection_data","slides","showDrawer"]),u("div",P,[u("header",S,[u("div",Q,[u("div",C,[u("div",L,v(ye.presentation.name||"Loading..."),1),u("div",M,[a[7]||(a[7]=u("span",{class:"text-sm text-gray-500"},"Status:",-1)),u("span",{class:m(["px-2 py-1 rounded-full text-xs font-medium",(Le=null==(i=ye.progress)?void 0:i.color_status,{gray:"bg-gray-100 text-gray-800",light_blue:"bg-blue-100 text-blue-800",blue:"bg-blue-500 text-white",purple:"bg-purple-500 text-white",green:"bg-green-500 text-white",yellow:"bg-yellow-500 text-white",red:"bg-red-500 text-white"}[Le]||"bg-gray-500 text-white")])},v((qe=null==(l=ye.progress)?void 0:l.status,be.isPreview?"PREVIEW":qe?qe.replace(/_/g," ").toUpperCase():"UNKNOWN")),3)])])]),u("div",E,v(ye.presentation.description),1)]),u("div",T,[u("div",B,[ye.loading?(n(),r("div",$,[c(t,{color:"primary",size:"3em"})])):ye.isPreview||"locked"!==(null==(o=ye.progress)?void 0:o.status)?(n(),r("div",I,[u("div",O,[Se.value.length>0&&!je.value?(n(),r("div",U,[u("div",N,[u("div",F,[u("span",R,"Slide "+v(ke.value+1)+" of "+v(Se.value.length),1),u("span",V,v(Qe.value.slide_type),1)]),_e.value?(n(),r("div",{key:0,class:"mb-6 p-4 rounded-xl border flex items-center gap-4 transition-colors duration-300",style:g({backgroundColor:_e.value.bg,borderColor:_e.value.borderColor})},[u("div",{class:"w-12 h-12 rounded-full flex items-center justify-center bg-white shadow-sm",style:g({color:_e.value.textColor})},[c(s,{name:_e.value.qIcon||_e.value.icon,size:"24px"},null,8,["name"])],4),u("div",null,[u("div",{class:"text-xs font-bold uppercase tracking-wider opacity-70",style:g({color:_e.value.textColor})}," Current Section ",4),u("div",{class:"text-xl font-bold leading-none mt-1",style:g({color:_e.value.textColor})},v(_e.value.title),5)])],4)):p("",!0),u("div",D,["text"===Qe.value.slide_type?(n(),r("div",{key:0,class:"prose max-w-none",innerHTML:null==(f=Qe.value.slide_content)?void 0:f.text},null,8,H)):["image","video","audio","pdf"].includes(Qe.value.slide_type)?(n(),r("div",W,["image"===Qe.value.slide_type?(n(),r("img",{key:0,src:null==(xe=Qe.value.slide_content)?void 0:xe.url,class:"max-h-[500px] object-contain"},null,8,Y)):"video"===Qe.value.slide_type?(n(),r("video",{key:1,src:null==(fe=Qe.value.slide_content)?void 0:fe.url,controls:"",class:"max-h-[500px] w-full"},null,8,J)):(n(),r("div",K,[u("a",{href:null==(we=Qe.value.slide_content)?void 0:we.url,target:"_blank",class:"text-blue-600 underline text-lg"},"Open "+v(Qe.value.slide_type),9,Z)]))])):"question"===Qe.value.slide_type?(n(),r("div",G,[c(b,{modelValue:Qe.value.slide_content,mode:"play",quizConfig:{allowReviewMode:!1,autoAdvance:!1,showRationaleOnCorrect:!0},attemptId:`attempt_${be.presentation.id}_${Qe.value.id||ke.value}_${Date.now()}`,legacyMode:he.value,onAnswerSelected:Ue,onQuizCompleted:Ne},null,8,["modelValue","attemptId","legacyMode"])])):p("",!0)])]),u("div",X,[u("button",{onClick:Ae,disabled:0===ke.value,class:m(["px-6 py-2 rounded-md font-medium transition-colors flex items-center gap-2",0===ke.value?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-200"])},a[9]||(a[9]=[u("i",{class:"fas fa-arrow-left"},null,-1),y(" Previous ")]),10,ee),u("button",{onClick:$e,class:m(["px-6 py-2 rounded-md font-medium transition-colors flex items-center gap-2",Ce.value?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"])},[ke.value<Se.value.length-1?(n(),r("span",te,"Next")):(n(),r("span",se,v("learn"===he.value?"Complete Learn":"practice"===he.value||"quiz"===he.value?"Start "+he.value:"Finish"),1)),u("i",{class:m(["fas",Ce.value?"fa-arrow-right":"fa-lock"])},null,2)],2)])])):"practice"!==he.value||!je.value&&0!==Se.value.length?"quiz"!==he.value||!je.value&&0!==Se.value.length?(n(),r("div",ge,a[19]||(a[19]=[u("div",{class:"text-center"},[u("i",{class:"fas fa-folder-open text-4xl text-gray-300 mb-4"}),u("p",null,"No content available for this section.")],-1)]))):(n(),r("div",ie,[u("div",le,[a[16]||(a[16]=u("div",{class:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"},[u("i",{class:"fas fa-clipboard-check text-4xl text-green-600"})],-1)),a[17]||(a[17]=u("h2",{class:"text-2xl font-bold text-gray-800 mb-2"},"Quiz Section",-1)),a[18]||(a[18]=u("p",{class:"text-gray-600 mb-6"}," You have completed the preparation. The quiz is ready for you. ",-1)),ye.presentation.quiz_id&&Pe.value?(n(),r("div",oe,[a[12]||(a[12]=u("div",{class:"text-sm text-gray-500 mb-2"},"Quiz",-1)),u("div",re,v(Pe.value.name),1),Pe.value.description?(n(),r("div",ne,v(Pe.value.description),1)):p("",!0),u("div",ce,[u("div",ue,[a[10]||(a[10]=u("i",{class:"fas fa-question-circle"},null,-1)),u("span",null,v(Pe.value.questions_count)+" Questions",1)]),Pe.value.time_limit_minutes?(n(),r("div",de,[a[11]||(a[11]=u("i",{class:"fas fa-clock"},null,-1)),u("span",null,v(Pe.value.time_limit_minutes)+" minutes",1)])):p("",!0)])])):ye.presentation.quiz_id?(n(),r("div",ve,[c(t,{color:"primary",size:"2em"}),a[14]||(a[14]=u("div",{class:"text-sm text-gray-500 mt-2"},"Loading quiz information...",-1))])):(n(),r("div",pe,a[13]||(a[13]=[u("div",{class:"text-yellow-800 font-medium mb-1"},"No Quiz Assigned",-1),u("div",{class:"text-sm text-yellow-700"},"Please contact your teacher to assign a quiz for this lesson.",-1)]))),ye.presentation.quiz_id&&Pe.value?(n(),r("div",me,[u("button",{onClick:Re,class:"px-8 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors shadow-lg shadow-green-200 flex items-center gap-2 mx-auto"},a[15]||(a[15]=[u("i",{class:"fas fa-play"},null,-1),u("span",null,"Start Quiz",-1)]))])):p("",!0)])])):(n(),r("div",ae,[ye.progress||ye.isPreview?(n(),x(w,{key:0,question:{type:"upload_draw",text:"Practice Submission",points:0},mode:"practice",onSubmitted:Oe})):p("",!0)]))])])):(n(),r("div",A,a[8]||(a[8]=[u("i",{class:"fas fa-lock text-6xl text-gray-300 mb-4"},null,-1),u("h2",{class:"text-2xl font-bold text-gray-800 mb-2"},"Lesson Locked",-1),u("p",{class:"text-gray-600"},"This lesson has not been opened by your teacher yet.",-1)])))])])])])}}};export{ye as default};
