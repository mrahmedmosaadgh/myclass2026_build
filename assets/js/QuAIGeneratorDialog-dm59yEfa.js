import{u as e,f as l,Q as a,aS as t,b as o,h as s,bd as i,be as n,d as u,c as r,i as c,j as d,k as m,m as p,t as v,g as f,e as b}from"./app-DlLesFGi.js";import{Q as y}from"./QSpace-BK_PGLKv.js";import{Q as g}from"./QSelect-BTh0khse.js";import{Q as h}from"./QStepperNavigation-DjG6vbQc.js";import{Q as _,a as q}from"./QStepper-DsaP_4Mi.js";import{Q as w}from"./QTd-BU_S4ffH.js";import{Q as V}from"./QBadge-IdEcTs8C.js";import{Q as k}from"./QTable-BIAJAIui.js";import{a as I,f as x,I as j,J as C,K as S,b as A,R as Q,y as O,O as T,W as L,N as U,V as $,$ as z}from"./vendor-BWKGNkNB.js";import{s as N}from"./i18n-B0T1C7j3.js";import"./offline-BzIlwqNM.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";import"./use-panel-BqxRbB7W.js";import"./use-render-cache-CmTcazfP.js";import"./QMarkupTable-CzIo4GGA.js";import"./QLinearProgress-CX6G9yBK.js";import"./use-fullscreen-BQHoXYBI.js";const P={class:"q-gutter-md"},F={class:"q-mb-md"},B={class:"q-gutter-sm"},E={key:0},M={class:"row items-center"},J={class:"col"},D={class:"col-auto q-gutter-sm"},G={class:"text-pre-wrap"},R={key:0,class:"text-caption text-negative"},W={__name:"QuAIGeneratorDialog",props:{modelValue:Boolean,subjectId:[Number,String],subjects:Array},emits:["update:modelValue","success"],setup(W,{emit:H}){const X=e(),Y=W,K=H,Z=I({get:()=>Y.modelValue,set:e=>K("update:modelValue",e)}),ee=x(1),le=x([]),ae=x(!1),te=x(!1),oe=x("curriculum"),se=x({count:10,types:["mcq"],difficulties:[],bloomLevels:[],topicId:null,customTopic:"",learningObjectives:"",customInstructions:"",latex:!1,language:"English"}),ie=x(""),ne=x(""),ue=x([]),re=[{value:"mcq",label:"Multiple Choice (MCQ)"},{value:"true_false",label:"True/False"},{value:"short",label:"Short Answer"},{value:"long",label:"Long Answer"}],ce=["easy","medium","hard"],de=[{value:"remember",label:"Remember"},{value:"understand",label:"Understand"},{value:"apply",label:"Apply"},{value:"analyze",label:"Analyze"},{value:"evaluate",label:"Evaluate"},{value:"create",label:"Create"}],me=[{name:"number",label:"#",field:"index",align:"center",style:"width: 50px"},{name:"question_text",label:"Question",field:"question_text",align:"left"},{name:"question_type",label:"Type",field:"question_type",align:"center"},{name:"difficulty",label:"Difficulty",field:"difficulty",align:"center"},{name:"marks",label:"Marks",field:"marks",align:"center"},{name:"status",label:"Status",align:"center"}],pe=I(()=>ue.value.filter(e=>!e.valid).length),ve=x([]),fe=I(()=>ve.value.length);if(Y.subjectId){const e=Y.subjects.find(e=>e.id==Y.subjectId);(null==e?void 0:e.curricula)&&(le.value=e.curricula.flatMap(e=>e.curriculum_topics||[]))}const be=()=>{const e=Y.subjects.find(e=>e.id==Y.subjectId),l=le.value.find(e=>e.id===se.value.topicId),a="custom"===oe.value&&se.value.customTopic?se.value.customTopic:l?l.name:null,t=[`Generate ${se.value.count} educational questions for the subject "${(null==e?void 0:e.name)||"General"}".`,a?`Focus on the topic: "${a}".`:"",se.value.learningObjectives?`Learning Objectives: ${se.value.learningObjectives}`:"","",`Question types: ${se.value.types.join(", ")}.`,se.value.difficulties.length>0?`Difficulty levels: ${se.value.difficulties.join(", ")}.`:"Mixed difficulty levels.",se.value.bloomLevels.length>0?`Bloom's taxonomy levels: ${se.value.bloomLevels.join(", ")}.`:"",se.value.latex?"Use LaTeX notation for mathematical formulas (wrap in $ or $$).":"",`Language: ${se.value.language}.`,"",se.value.customInstructions?`Additional Instructions:\n${se.value.customInstructions}`:"","","Return ONLY a valid JSON object in this exact format:","```json",JSON.stringify({questions:[{question_text:"Example question text here",question_type:"mcq",options:{A:"Option A",B:"Option B",C:"Option C",D:"Option D"},correct_answer:["B"],difficulty:"medium",bloom_level:"understand",marks:1}]},null,2),"```","","Important rules:","- For MCQ: provide options as object with keys A, B, C, D",'- For True/False: options should be {"true": "True", "false": "False"}','- For Short/Long Answer: set options to {} and correct_answer to ["N/A"]',"- correct_answer must be an array of keys","- question_type must be one of: mcq, true_false, short, long","- difficulty must be one of: easy, medium, hard","- bloom_level is optional, one of: remember, understand, apply, analyze, evaluate, create","- marks should be a positive integer"];ie.value=t.filter(Boolean).join("\n"),ee.value=2},ye=async()=>{try{await navigator.clipboard.writeText(ie.value),X.notify({type:"positive",message:"Prompt copied to clipboard!",icon:"content_copy",position:"top"})}catch(e){X.notify({type:"negative",message:"Failed to copy to clipboard",position:"top"})}},ge=()=>{ae.value=!0;try{let e;const l=ne.value.trim(),a=l.match(/```(?:json)?\s*([\s\S]*?)```/);if(e=a?JSON.parse(a[1]):JSON.parse(l),!e.questions||!Array.isArray(e.questions))throw new Error('Invalid format: "questions" array not found');ue.value=e.questions.map((e,l)=>{const a=[];return e.question_text||a.push("Missing question_text"),["mcq","true_false","short","long"].includes(e.question_type)||a.push("Invalid question_type"),e.difficulty&&["easy","medium","hard"].includes(e.difficulty)||a.push("Invalid difficulty"),e.correct_answer&&Array.isArray(e.correct_answer)||a.push("Invalid correct_answer"),(!e.marks||e.marks<1)&&a.push("Invalid marks"),{...e,index:l,valid:0===a.length,errors:a.join(", "),subject_id:Y.subjectId,topic_id:se.value.topicId}}),ee.value=4,ve.value=ue.value.filter(e=>e.valid),X.notify({type:"positive",message:`Validated ${ue.value.length} questions`,position:"top"})}catch(e){X.notify({type:"negative",message:"Invalid JSON format",caption:e.message,position:"top"})}finally{ae.value=!1}},he=()=>{ve.value=ue.value.filter(e=>e.valid)},_e=()=>{ve.value=[]},qe=()=>{const e=new Set(ve.value.map(e=>e.index));ve.value=ue.value.filter(l=>l.valid&&!e.has(l.index))},we=()=>{te.value=!0;const e=ve.value.filter(e=>e.valid);if(0===e.length)return X.notify({type:"warning",message:"No questions selected",position:"top"}),void(te.value=!1);z.post(N("qu-questions.bulk-import"),{questions:e},{onSuccess:()=>{X.notify({type:"positive",message:`Successfully imported ${e.length} question${1!==e.length?"s":""}!`,icon:"check_circle",position:"top"}),Z.value=!1,K("success")},onError:e=>{X.notify({type:"negative",message:"Failed to import questions",caption:Object.values(e)[0],position:"top"})},onFinish:()=>{te.value=!1}})},Ve=e=>{const l={exam:{count:20,types:["mcq","short"],difficulties:["medium","hard"],bloomLevels:["apply","analyze","evaluate"],customInstructions:"Create exam-level questions that test deep understanding and application of concepts."},homework:{count:15,types:["mcq","short","long"],difficulties:["easy","medium"],bloomLevels:["remember","understand","apply"],customInstructions:"Create practice questions suitable for homework assignments with varying difficulty."},quiz:{count:10,types:["mcq","true_false"],difficulties:["easy","medium"],bloomLevels:["remember","understand"],customInstructions:"Create quick assessment questions for a short quiz."},practice:{count:25,types:["mcq","true_false","short"],difficulties:[],bloomLevels:[],customInstructions:"Create diverse practice questions covering all difficulty levels for student practice."}}[e];l&&(Object.assign(se.value,l),X.notify({type:"info",message:`Applied "${e}" preset`,position:"top"}))},ke=e=>{se.value.customInstructions?se.value.customInstructions+="\n- "+e:se.value.customInstructions="- "+e,X.notify({type:"positive",message:"Instruction added",position:"top"})};return(e,I)=>(C(),j(b,{modelValue:Z.value,"onUpdate:modelValue":I[28]||(I[28]=e=>Z.value=e),maximized:""},{default:S(()=>[A(u,null,{default:S(()=>[A(l,{class:"row items-center q-pb-none"},{default:S(()=>[A(a,{name:"auto_awesome",size:"md",color:"primary",class:"q-mr-sm"}),I[29]||(I[29]=Q("div",{class:"text-h6"},"AI Question Generator",-1)),A(y),O(A(o,{icon:"close",flat:"",round:"",dense:""},null,512),[[t]])]),_:1}),A(l,null,{default:S(()=>[A(_,{modelValue:ee.value,"onUpdate:modelValue":I[27]||(I[27]=e=>ee.value=e),vertical:"",color:"primary",animated:""},{default:S(()=>[A(q,{name:1,title:"Configure AI Prompt",icon:"settings",done:ee.value>1},{default:S(()=>[Q("div",P,[A(s,{modelValue:se.value.count,"onUpdate:modelValue":I[0]||(I[0]=e=>se.value.count=e),modelModifiers:{number:!0},type:"number",label:"Number of Questions *",min:"1",max:"50",hint:"How many questions to generate (1-50)",rules:[e=>e>0&&e<=50||"Must be between 1 and 50"]},null,8,["modelValue","rules"]),A(g,{modelValue:se.value.types,"onUpdate:modelValue":I[1]||(I[1]=e=>se.value.types=e),options:re,label:"Question Types *",multiple:"","emit-value":"","map-options":"",hint:"Select one or more question types",rules:[e=>e.length>0||"Select at least one type"]},null,8,["modelValue","rules"]),A(g,{modelValue:se.value.difficulties,"onUpdate:modelValue":I[2]||(I[2]=e=>se.value.difficulties=e),options:ce,label:"Difficulty Levels",multiple:"",hint:"Leave empty for mixed difficulty"},null,8,["modelValue"]),A(g,{modelValue:se.value.bloomLevels,"onUpdate:modelValue":I[3]||(I[3]=e=>se.value.bloomLevels=e),options:de,"option-value":"value","option-label":"label",label:"Bloom's Taxonomy Levels",multiple:"","emit-value":"","map-options":"",hint:"Optional: Specify cognitive levels"},null,8,["modelValue"]),Q("div",F,[A(i,{modelValue:oe.value,"onUpdate:modelValue":I[4]||(I[4]=e=>oe.value=e),val:"curriculum",label:"Select from Curriculum Topics",class:"q-mb-sm"},null,8,["modelValue"]),A(i,{modelValue:oe.value,"onUpdate:modelValue":I[5]||(I[5]=e=>oe.value=e),val:"custom",label:"Enter Custom Topic"},null,8,["modelValue"])]),"curriculum"===oe.value?(C(),j(g,{key:0,modelValue:se.value.topicId,"onUpdate:modelValue":I[6]||(I[6]=e=>se.value.topicId=e),options:le.value,"option-value":"id","option-label":"name",label:"Curriculum Topic",clearable:"","emit-value":"","map-options":"",hint:"Select from existing curriculum topics",class:"q-mb-md"},null,8,["modelValue","options"])):T("",!0),"custom"===oe.value?(C(),j(s,{key:1,modelValue:se.value.customTopic,"onUpdate:modelValue":I[7]||(I[7]=e=>se.value.customTopic=e),label:"Custom Topic",outlined:"",hint:"Enter any topic you want questions about",placeholder:"e.g., Photosynthesis, Quadratic Equations, World War II",class:"q-mb-md"},null,8,["modelValue"])):T("",!0),A(s,{modelValue:se.value.learningObjectives,"onUpdate:modelValue":I[8]||(I[8]=e=>se.value.learningObjectives=e),type:"textarea",label:"Learning Objectives (Optional)",outlined:"",rows:"2",hint:"What should students learn? (e.g., 'Students will be able to solve quadratic equations')",placeholder:"Enter specific learning goals...",class:"q-mb-md"},null,8,["modelValue"]),A(s,{modelValue:se.value.customInstructions,"onUpdate:modelValue":I[9]||(I[9]=e=>se.value.customInstructions=e),type:"textarea",label:"Additional Instructions / Context",outlined:"",rows:"3",hint:"Add any special requirements, context, or style preferences",placeholder:"e.g., 'Focus on real-world applications', 'Include diagrams descriptions', 'Avoid complex terminology'",class:"q-mb-md"},null,8,["modelValue"]),A(n,{icon:"lightbulb",label:"Smart Suggestions",caption:"Click for intelligent recommendations",class:"q-mb-md"},{default:S(()=>[A(u,{flat:"",bordered:"",class:"q-pa-md"},{default:S(()=>[I[34]||(I[34]=Q("div",{class:"text-subtitle2 q-mb-sm"},"Quick Presets:",-1)),Q("div",B,[A(o,{size:"sm",outline:"",color:"primary",label:"Exam Prep",onClick:I[10]||(I[10]=e=>Ve("exam"))}),A(o,{size:"sm",outline:"",color:"primary",label:"Homework",onClick:I[11]||(I[11]=e=>Ve("homework"))}),A(o,{size:"sm",outline:"",color:"primary",label:"Quick Quiz",onClick:I[12]||(I[12]=e=>Ve("quiz"))}),A(o,{size:"sm",outline:"",color:"primary",label:"Practice",onClick:I[13]||(I[13]=e=>Ve("practice"))})]),A(r,{class:"q-my-md"}),I[35]||(I[35]=Q("div",{class:"text-subtitle2 q-mb-sm"},"Suggested Instructions:",-1)),A(c,{dense:""},{default:S(()=>[A(d,{clickable:"",onClick:I[14]||(I[14]=e=>ke("Include step-by-step solutions"))},{default:S(()=>[A(m,{avatar:""},{default:S(()=>[A(a,{name:"add_circle",color:"primary"})]),_:1}),A(m,null,{default:S(()=>I[30]||(I[30]=[L("Include step-by-step solutions")])),_:1})]),_:1}),A(d,{clickable:"",onClick:I[15]||(I[15]=e=>ke("Focus on real-world applications"))},{default:S(()=>[A(m,{avatar:""},{default:S(()=>[A(a,{name:"add_circle",color:"primary"})]),_:1}),A(m,null,{default:S(()=>I[31]||(I[31]=[L("Focus on real-world applications")])),_:1})]),_:1}),A(d,{clickable:"",onClick:I[16]||(I[16]=e=>ke("Include visual/diagram descriptions"))},{default:S(()=>[A(m,{avatar:""},{default:S(()=>[A(a,{name:"add_circle",color:"primary"})]),_:1}),A(m,null,{default:S(()=>I[32]||(I[32]=[L("Include visual/diagram descriptions")])),_:1})]),_:1}),A(d,{clickable:"",onClick:I[17]||(I[17]=e=>ke("Vary difficulty progressively"))},{default:S(()=>[A(m,{avatar:""},{default:S(()=>[A(a,{name:"add_circle",color:"primary"})]),_:1}),A(m,null,{default:S(()=>I[33]||(I[33]=[L("Vary difficulty progressively")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),A(p,{modelValue:se.value.latex,"onUpdate:modelValue":I[18]||(I[18]=e=>se.value.latex=e),label:"Enable LaTeX Support"},{default:S(()=>[A(v,null,{default:S(()=>I[36]||(I[36]=[L("For math/science questions with formulas")])),_:1})]),_:1},8,["modelValue"]),A(g,{modelValue:se.value.language,"onUpdate:modelValue":I[19]||(I[19]=e=>se.value.language=e),options:["English","Arabic"],label:"Language",hint:"Question language"},null,8,["modelValue"])]),A(h,null,{default:S(()=>[A(o,{onClick:be,color:"primary",label:"Generate Prompt",icon:"content_copy"})]),_:1})]),_:1},8,["done"]),A(q,{name:2,title:"Copy Prompt to AI",icon:"content_copy",done:ee.value>2},{default:S(()=>[A(u,{flat:"",bordered:""},{default:S(()=>[A(l,null,{default:S(()=>[I[38]||(I[38]=Q("div",{class:"text-subtitle2 q-mb-sm"},"Generated Prompt:",-1)),A(s,{modelValue:ie.value,"onUpdate:modelValue":I[20]||(I[20]=e=>ie.value=e),type:"textarea",readonly:"",outlined:"",rows:"15",class:"q-mb-md"},null,8,["modelValue"]),A(o,{onClick:ye,color:"primary",label:"Copy to Clipboard",icon:"content_copy",class:"q-mr-sm"}),A(f,{class:"bg-info text-white q-mt-md"},{avatar:S(()=>[A(a,{name:"info"})]),default:S(()=>[I[37]||(I[37]=L(" Copy this prompt and paste it into ChatGPT, Claude, or Gemini. Then copy the AI's JSON response. "))]),_:1})]),_:1})]),_:1}),A(h,null,{default:S(()=>[A(o,{onClick:I[21]||(I[21]=e=>ee.value=3),color:"primary",label:"Next: Paste AI Response"}),A(o,{flat:"",onClick:I[22]||(I[22]=e=>ee.value=1),label:"Back",class:"q-ml-sm"})]),_:1})]),_:1},8,["done"]),A(q,{name:3,title:"Paste AI Response",icon:"paste",done:ee.value>3},{default:S(()=>[A(s,{modelValue:ne.value,"onUpdate:modelValue":I[23]||(I[23]=e=>ne.value=e),type:"textarea",label:"Paste AI Response (JSON)",outlined:"",rows:"10",hint:"Paste the JSON response from the AI",class:"q-mb-md"},null,8,["modelValue"]),A(h,null,{default:S(()=>[A(o,{onClick:ge,color:"primary",label:"Validate & Preview",loading:ae.value},null,8,["loading"]),A(o,{flat:"",onClick:I[24]||(I[24]=e=>ee.value=2),label:"Back",class:"q-ml-sm"})]),_:1})]),_:1},8,["done"]),A(q,{name:4,title:"Preview & Insert",icon:"preview"},{default:S(()=>[ue.value.length>0?(C(),U("div",E,[A(f,{class:"bg-primary text-white q-mb-md"},{avatar:S(()=>[A(a,{name:"check_circle"})]),default:S(()=>[Q("div",M,[Q("div",J,[Q("strong",null,$(fe.value),1),I[39]||(I[39]=L(" of ")),Q("strong",null,$(ue.value.length),1),I[40]||(I[40]=L(" questions selected "))]),Q("div",D,[A(o,{size:"sm",outline:"",color:"white",label:"Select All",onClick:he,icon:"check_box"}),A(o,{size:"sm",outline:"",color:"white",label:"Select None",onClick:_e,icon:"check_box_outline_blank"}),A(o,{size:"sm",outline:"",color:"white",label:"Inverse",onClick:qe,icon:"swap_vert"})])])]),_:1}),A(k,{rows:ue.value,columns:me,"row-key":"index",flat:"",bordered:"",selection:"multiple",selected:ve.value,"onUpdate:selected":I[25]||(I[25]=e=>ve.value=e),class:"q-mb-md"},{"body-cell-number":S(e=>[A(w,{props:e},{default:S(()=>[Q("strong",null,"#"+$(e.row.index+1),1)]),_:2},1032,["props"])]),"body-cell-question_text":S(e=>[A(w,{props:e},{default:S(()=>{return[Q("div",G,$((l=e.row.question_text,a=100,l&&l.length>a?l.substring(0,a)+"...":l)),1)];var l,a}),_:2},1032,["props"])]),"body-cell-status":S(e=>[A(w,{props:e},{default:S(()=>[A(V,{color:e.row.valid?"positive":"negative"},{default:S(()=>[L($(e.row.valid?"Valid":"Invalid"),1)]),_:2},1032,["color"]),e.row.valid?T("",!0):(C(),U("div",R,$(e.row.errors),1))]),_:2},1032,["props"])]),_:1},8,["rows","selected"]),pe.value>0?(C(),j(f,{key:0,class:"bg-warning text-white q-mb-md"},{avatar:S(()=>[A(a,{name:"warning"})]),default:S(()=>[L(" "+$(pe.value)+" invalid question(s) detected (cannot be selected) ",1)]),_:1})):T("",!0)])):T("",!0),A(h,null,{default:S(()=>[A(o,{onClick:we,color:"primary",label:`Insert ${fe.value} Selected Question${1!==fe.value?"s":""}`,icon:"upload",loading:te.value,disable:0===fe.value},null,8,["label","loading","disable"]),A(o,{flat:"",onClick:I[26]||(I[26]=e=>ee.value=3),label:"Back",class:"q-ml-sm"})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{W as default};
