import{u as e,Q as a,a as s,aE as o,d as t,m as r,c as l,A as i,aP as n,l as d,b as c}from"./app-B77gjd5a.js";import{Q as u}from"./QSpace-Bk4F2b8L.js";import{f as v,o as m,_ as p,M as g,J as f,N as y,I as b,b as h,V as j,K as w,y as x,W as S}from"./vendor-DuKqz2x4.js";import q from"./StudentRecordsGrid-DVC23E6y.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";import"./QTab-CnAf4tCv.js";import"./QTabs-D_ZwIIJm.js";import"./rtl-Cr6c3OOr.js";import"./QBadge-ZkvAqPBD.js";import"./QSelect-DB_tK-Lk.js";import"./QTabPanel-B_PJ80R0.js";import"./use-panel-N2fkKyR_.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-B5JhG1n5.js";const A={class:"student-records-page q-pa-md"},Q={class:"page-header q-mb-lg"},$={class:"row items-center justify-between q-mb-md"},_={class:"col-12 col-md-6"},k={class:"text-subtitle1 q-mt-sm"},I={class:"col-12 col-md-6 row justify-end q-gutter-sm"},N={key:0,class:"flex flex-center q-pa-xl"},R={key:1,class:"text-center q-pa-xl"},E={__name:"StudentRecords",props:{periodActivityId:{type:[Number,String],required:!0}},setup(E){const F=E,P=e(),T=v(!1),V=v(!1),C=v(!1),K=v(null),L=v([]),z=v(new Set);async function J(){var e,a;T.value=!0;try{const e=await p.get(`/api/period-activities/${F.periodActivityId}/student-records`);e.data&&Array.isArray(e.data)?(L.value=e.data,z.value=new Set):(L.value=[],P.notify({color:"warning",message:"No student records found",icon:"warning"}))}catch(s){console.error("Error loading student records:",s),P.notify({color:"negative",message:`Failed to load student records: ${(null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)||s.message}`,icon:"error"})}finally{T.value=!1}}function M(e){const a=L.value.findIndex(a=>a.id===e.id);-1!==a&&(L.value[a]={...e},z.value.add(e.id))}async function O(e){var a,s;try{await p.put(`/api/period-activities/${F.periodActivityId}/student-records/${e.id}`,e),z.value.delete(e.id),P.notify({color:"positive",message:`Record for ${e.name} saved successfully`,icon:"check"})}catch(o){console.error("Error saving student record:",o),P.notify({color:"negative",message:`Failed to save record: ${(null==(s=null==(a=o.response)?void 0:a.data)?void 0:s.message)||o.message}`,icon:"error"})}}async function U(){var e,a;if(0!==L.value.length){V.value=!0;try{const e=L.value.filter(e=>z.value.has(e.id));if(0===e.length)return P.notify({color:"info",message:"No changes to save",icon:"info"}),void(V.value=!1);await p.put(`/api/period-activities/${F.periodActivityId}/student-records/batch`,{records:e}),z.value=new Set,C.value=!0}catch(s){console.error("Error saving student records:",s),P.notify({color:"negative",message:`Failed to save records: ${(null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)||s.message}`,icon:"error"})}finally{V.value=!1}}else P.notify({color:"warning",message:"No student records to save",icon:"warning"})}return m(()=>{!async function(){var e,a;try{const e=await p.get(`/api/period-activities/${F.periodActivityId}`);K.value=e.data}catch(s){console.error("Error loading period activity:",s),P.notify({color:"negative",message:`Failed to load period activity: ${(null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)||s.message}`,icon:"error"})}}(),J()}),(e,v)=>{var m,p;return f(),g("div",A,[y("div",Q,[y("div",$,[y("div",_,[v[1]||(v[1]=y("h1",{class:"text-h4 q-my-none"},"Student Records",-1)),y("p",k,j((null==(p=null==(m=K.value)?void 0:m.classroom)?void 0:p.name)||"Loading..."),1)]),y("div",I,[h(a,{color:"primary",icon:"refresh",label:"Refresh",onClick:J,loading:T.value},null,8,["loading"]),h(a,{color:"secondary",icon:"save",label:"Save All",onClick:U,loading:V.value},null,8,["loading"])])]),h(s)]),T.value?(f(),g("div",N,[h(o,{color:"primary",size:"3em"}),v[2]||(v[2]=y("span",{class:"q-ml-sm text-subtitle1"},"Loading student records...",-1))])):L.value.length?(f(),b(q,{key:2,students:L.value,loading:T.value,"onUpdate:student":M,onSaveStudent:O},null,8,["students","loading"])):(f(),g("div",R,[h(t,{name:"people",size:"4em",color:"grey-7"}),v[3]||(v[3]=y("p",{class:"text-h6 q-mt-md"},"No student records found",-1)),h(a,{color:"primary",label:"Load Records",onClick:J})])),h(c,{modelValue:C.value,"onUpdate:modelValue":v[0]||(v[0]=e=>C.value=e)},{default:w(()=>[h(r,null,{default:w(()=>[h(l,{class:"row items-center bg-positive text-white"},{default:w(()=>[h(i,{icon:"check_circle","text-color":"white"}),v[4]||(v[4]=y("span",{class:"q-ml-sm text-h6"},"Success",-1)),h(u),x(h(a,{icon:"close",flat:"",round:"",dense:""},null,512),[[n]])]),_:1}),h(l,null,{default:w(()=>v[5]||(v[5]=[S(" All student records have been saved successfully. ")])),_:1}),h(d,{align:"right"},{default:w(()=>[x(h(a,{flat:"",label:"OK",color:"positive"},null,512),[[n]])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};export{E as default};
