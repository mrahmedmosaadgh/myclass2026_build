import{p as e,u as l,e as a,o as n,Q as t,n as o,b as s,q as r}from"./app-BXm70mdJ.js";import{Q as i}from"./QSelect-CnZtzPIC.js";import{Q as u}from"./QLinearProgress-Cix0cchl.js";import{Q as d}from"./QSpinnerDots-BY_P7fmL.js";import{Q as c}from"./QTab-DhKL91H_.js";import{Q as m}from"./QTabs-CDJ215OP.js";import{Q as p}from"./QSpace-Bu8V-QDa.js";import{Q as v,a as y}from"./QToolbar-B4c8gRiI.js";import{f as b,a as w,k as h,o as g,ac as f,L as k,I as x,b as P,M as _,H as j,x as V,V as q,U as Q,y as T,J as D,O as M,F as C,Q as z,Z as S,X as L,S as E,R as F}from"./vendor-DNM7Y6Xn.js";import U from"./WeekSelector-CR0I50Iw.js";import W from"./WeeklyPlanEditor-D8TKVBAk.js";import H from"./WeeklyPlanClassroomList-De7P52Dz.js";import N from"./StatusBadge-B2Mh2wJ8.js";import $ from"./WeeklyPlanMenu-CPPNbbnB.js";import{u as A}from"./i18n-CBOKL2HS.js";import"./offline-BzIlwqNM.js";import"./ui-BP0GJNn5.js";import"./rtl-Cr6c3OOr.js";import"./QEditor-BvvPPkPS.js";import"./use-fullscreen-FlxrEg_V.js";import"./QTd-BIxMTYzb.js";import"./QBadge-ZzhN1X9C.js";import"./QTable-rnEofRem.js";import"./QMarkupTable-Dmg3C5Wm.js";import"./WeeklySystemGuide-e9afDUCT.js";import"./QTabPanel-sB32VrK8.js";import"./use-panel-D2HepUiw.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-LFwTBPSC.js";import"./MainSchoolData-poTNtOLu.js";import"./schoolData-lzO9rVwn.js";import"./SchoolSettingsDialog-D2VgwIPk.js";import"./QForm-DyZk5PSh.js";const B={class:"q-pa-md"},I={class:"row items-center q-mb-lg"},O={class:"col"},G={class:"q-ma-none text-weight-bold"},J={class:"text-grey-7 q-mb-none"},R={class:"row q-gutter-md items-center"},Y={class:"col-12 col-sm-6 col-md-4"},K={class:"col-12 col-sm-3 col-md-2"},X={class:"col-auto q-ml-auto"},Z={class:"absolute-full flex flex-center"},ee={class:"text-caption text-weight-bold"},le={class:"row q-gutter-md items-center q-mt-sm"},ae={class:"col-12 col-sm-6 col-md-4"},ne={class:"col-12 col-sm-6 col-md-4"},te={class:"col-auto"},oe={key:0,class:"col-12 col-sm-6 col-md-auto q-gutter-sm"},se={key:0,class:"row justify-center q-pa-xl"},re={class:"text-h6 text-grey-7 q-mt-md"},ie={class:"text-grey-6"},ue={class:"plans-grid"},de={class:"day-header"},ce=["onClick"],me={class:"period-badge"},pe={class:"subject-name"},ve={class:"flex q-gutter-xs"},ye={class:"classroom text-caption text-grey-7"},be={class:"plan-status"},we={key:0,class:"plan-preview text-caption"},he={key:0,class:"preview-item"},ge={key:1,class:"preview-item"},fe={class:"preview-container q-pa-md"},ke={id:"print-area",class:"a4-page"},xe={class:"print-header q-mb-lg"},Pe={class:"q-ma-none"},_e={class:"q-ma-xs text-grey-7"},je={class:"q-ma-xs text-grey-7"},Ve={class:"q-ma-xs text-grey-7"},qe={class:"print-table"},Qe={class:"text-center"},Te=["innerHTML"],De=["innerHTML"],Me=["innerHTML"],Ce={class:"print-footer q-mt-lg"},ze={class:"text-caption text-grey-6"},Se=e({__name:"MyWeeklyPlans",setup(e){const{t:Se,locale:Le}=A(),Ee=l(),Fe=b([]),Ue=b(null),We=b(1),He=b(1),Ne=b(18),$e=b(1),Ae=b([]),Be=b([]),Ie=b(null),Oe=b(null),Ge=b(!1),Je=b(null),Re=b(!1),Ye=b(!1),Ke=b("by-classroom"),Xe=b(!1),Ze=b({}),el=b(!1),ll=w(()=>[{label:`${Se("weeklyPlans.semester")} 1`,value:1},{label:`${Se("weeklyPlans.semester")} 2`,value:2}]),al=w(()=>[{label:Se("weeklyPlans.fullDays.1"),value:1},{label:Se("weeklyPlans.fullDays.2"),value:2},{label:Se("weeklyPlans.fullDays.3"),value:3},{label:Se("weeklyPlans.fullDays.4"),value:4},{label:Se("weeklyPlans.fullDays.5"),value:5}]),nl=w(()=>{const e={};return al.value.forEach(l=>{e[l.value]=l.label}),e}),tl=w(()=>{const e=new Set;return Fe.value.forEach(l=>{var a,n;(null==(n=null==(a=l.schedule)?void 0:a.cst)?void 0:n.classroom_name)&&e.add(l.schedule.cst.classroom_name)}),Array.from(e).sort()}),ol=w(()=>{var e,l;let a=Fe.value;return(null==(e=Ae.value)?void 0:e.length)&&(a=a.filter(e=>{var l,a;return Ae.value.includes(null==(a=null==(l=e.schedule)?void 0:l.cst)?void 0:a.classroom_name)})),(null==(l=Be.value)?void 0:l.length)&&(a=a.filter(e=>{var l;return Be.value.includes(null==(l=e.schedule)?void 0:l.day)})),a}),sl=w(()=>{const e={};return ol.value.forEach(l=>{var a;const n=null==(a=l.schedule)?void 0:a.day;e[n]||(e[n]={dayNumber:n,dayName:Se(`weeklyPlans.fullDays.${n}`)||`Day ${n}`,plans:[]}),e[n].plans.push(l)}),Object.values(e).forEach(e=>{e.plans.sort((e,l)=>{var a,n;return(null==(a=e.schedule)?void 0:a.period_number)-(null==(n=l.schedule)?void 0:n.period_number)})}),Object.values(e).sort((e,l)=>e.dayNumber-l.dayNumber)}),rl=w(()=>{const e=Fe.value.length;if(!e)return 0;const l=Fe.value.filter(e=>"completed"===e.status).length;return Math.round(l/e*100)}),il=w(()=>{const e=rl.value;return 100===e?"positive":e>=50?"warning":"negative"}),ul=e=>{var l,a;const n=!!(null==(l=e.cw)?void 0:l.trim()),t=!!(null==(a=e.hw)?void 0:a.trim());return n||t?n&&t?"completed":"partial":"empty"},dl=e=>{var l,a,n,t;return{backgroundColor:(null==(a=null==(l=e.schedule)?void 0:l.cst)?void 0:a.c_bg)||"#e0e0e0",color:(null==(t=null==(n=e.schedule)?void 0:n.cst)?void 0:t.c_text)||"#333"}},cl=async()=>{el.value=!0;try{const e=await S.get("/weekly-system/api/teacher/my-weekly-plans",{params:{week_number:We.value,semester_number:He.value}});Fe.value=(e.data.data||e.data||[]).map(e=>({...e,...e.schedule,status:ul(e)}))}catch(e){console.error("Error fetching plans:",e),Ee.notify({type:"negative",message:"Failed to load weekly plans"})}finally{el.value=!1}},ml=e=>{Ie.value||(Je.value=e,Ge.value=!0)},pl=async e=>{Re.value=!0;try{await S.put(`/weekly-system/api/weekly-plans/${e.id}`,{cw:e.cw,hw:e.hw,notes:e.notes}),Ee.notify({type:"positive",message:"Weekly plan saved!"}),Ge.value=!1,await cl()}catch(l){console.error("Error saving plan:",l),Ee.notify({type:"negative",message:"Failed to save plan"})}finally{Re.value=!1}},vl=async e=>{if(!Ze.value[e.id]){Ze.value[e.id]=!0;try{await S.put(`/weekly-system/api/weekly-plans/${e.id}`,{cw:e.cw,hw:e.hw,notes:e.notes}),e.status=ul(e),Ee.notify({type:"positive",message:"Saved!",timeout:1e3,position:"top"})}catch(l){console.error("Error saving inline edit:",l),Ee.notify({type:"negative",message:"Failed to save changes"})}finally{delete Ze.value[e.id]}}},yl=()=>{const e=document.getElementById("print-area");if(!e)return void Ee.notify({type:"negative",message:"Print area not found"});const l=window.open("","_blank");l.document.write(`\n    <!DOCTYPE html>\n    <html lang="en">\n    <head>\n      <meta charset="UTF-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      <title>Weekly Plans - Print</title>\n      <style>\n        * {\n          margin: 0;\n          padding: 0;\n          box-sizing: border-box;\n        }\n        \n        @page {\n          size: A4;\n          margin: 10mm;\n        }\n        \n        body {\n          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n          background-color: white;\n          color: #333;\n          line-height: 1.4;\n        }\n        \n        .print-header {\n          margin-bottom: 24px;\n          border-bottom: 2px solid #1976d2;\n          padding-bottom: 12px;\n        }\n        \n        .print-header h2 {\n          font-size: 24px;\n          color: #1976d2;\n          margin-bottom: 8px;\n        }\n        \n        .print-header p {\n          font-size: 12px;\n          color: #666;\n          margin: 4px 0;\n        }\n        \n        .print-table {\n          width: 100%;\n          border-collapse: collapse;\n          margin-bottom: 20px;\n          font-size: 11px;\n        }\n        \n        .print-table thead {\n          background-color: #f5f5f5;\n          border-bottom: 2px solid #1976d2;\n        }\n        \n        .print-table th {\n          padding: 10px;\n          text-align: left;\n          font-weight: 600;\n          color: #1976d2;\n          border: 1px solid #ddd;\n        }\n        \n        .print-table td {\n          padding: 10px;\n          border: 1px solid #ddd;\n          word-wrap: break-word;\n          overflow-wrap: break-word;\n        }\n        \n        .print-table tbody tr:nth-child(even) {\n          background-color: #f9f9f9;\n        }\n        \n        .print-table tbody tr:hover {\n          background-color: #f0f0f0;\n        }\n        \n        .text-center {\n          text-align: center;\n        }\n        \n        .content-cell {\n          max-width: 120px;\n          white-space: pre-wrap;\n          line-height: 1.5;\n        }\n        \n        .content-cell a {\n          color: #1976d2;\n          text-decoration: underline;\n        }\n        \n        .content-cell p {\n          margin: 4px 0;\n        }\n        \n        .content-cell ul,\n        .content-cell ol {\n          margin: 4px 0;\n          padding-left: 20px;\n        }\n        \n        .content-cell li {\n          margin: 2px 0;\n        }\n        \n        .content-cell strong {\n          font-weight: 600;\n        }\n        \n        .content-cell em {\n          font-style: italic;\n        }\n        \n        \n        .print-footer {\n          margin-top: 20px;\n          border-top: 1px solid #ddd;\n          padding-top: 10px;\n          text-align: right;\n          font-size: 10px;\n          color: #999;\n        }\n        \n        @media print {\n          body {\n            background-color: white;\n          }\n          \n          .print-table {\n            page-break-inside: avoid;\n          }\n          \n          .print-table tbody tr {\n            page-break-inside: avoid;\n          }\n        }\n      </style>\n    </head>\n    <body>\n      ${e.innerHTML}\n    </body>\n    </html>\n  `),l.document.close(),l.onload=()=>{setTimeout(()=>{l.print(),l.close()},250)}},bl=()=>{Ue.value&&(Ue.value.openMobilePrint(),setTimeout(()=>{Ue.value.downloadPDF()},100))};return h(()=>We.value,()=>{cl()}),h(()=>He.value,()=>{cl()}),g(()=>{const e=new Date,l=new Date(e.getFullYear(),0,1),a=Math.ceil(((e.getTime()-l.getTime())/864e5+l.getDay()+1)/7);$e.value=Math.min(a,18),We.value=$e.value,cl()}),(e,l)=>{const b=f("Head");return x(),k(C,null,[P(b,{title:"My Weekly Plans"}),_("div",B,[P($),_("div",I,[_("div",O,[_("h4",G,[P(a,{name:"edit_note",class:"q-mr-sm",color:"primary"}),q(" "+Q(T(Se)("weeklyPlans.teacher.myWeeklyPlans")),1)]),_("p",J,Q(T(Se)("weeklyPlans.teacher.fillInContent")),1)])]),P(o,{flat:"",bordered:"",class:"q-pa-md q-mb-lg"},{default:D(()=>{var e;return[_("div",R,[_("div",Y,[P(U,{modelValue:We.value,"onUpdate:modelValue":l[0]||(l[0]=e=>We.value=e),"max-weeks":Ne.value,"current-week":$e.value},null,8,["modelValue","max-weeks","current-week"])]),_("div",K,[P(i,{modelValue:He.value,"onUpdate:modelValue":l[1]||(l[1]=e=>He.value=e),options:ll.value,label:T(Se)("weeklyPlans.semester"),outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","label"])]),_("div",X,[P(u,{value:rl.value/100,size:"25px",color:il.value,"track-color":"grey-3",rounded:"",style:{width:"150px"}},{default:D(()=>[_("div",Z,[_("span",ee,Q(rl.value)+"%",1)])]),_:1},8,["value","color"])])]),_("div",le,[_("div",ae,[P(i,{modelValue:Ae.value,"onUpdate:modelValue":l[2]||(l[2]=e=>Ae.value=e),options:tl.value,label:T(Se)("weeklyPlans.teacher.selectToView"),outlined:"",dense:"",multiple:"","use-chips":"",clearable:""},null,8,["modelValue","options","label"])]),_("div",ne,[P(i,{modelValue:Be.value,"onUpdate:modelValue":l[3]||(l[3]=e=>Be.value=e),options:al.value,label:T(Se)("weeklyPlans.filterByDay"),outlined:"",dense:"",multiple:"","use-chips":"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options","label"])]),_("div",te,[P(n,{modelValue:Xe.value,"onUpdate:modelValue":l[4]||(l[4]=e=>Xe.value=e),label:T(Se)("weeklyPlans.teacher.inlineEditMode"),color:"primary",icon:"edit"},null,8,["modelValue","label"])]),(null==(e=Ae.value)?void 0:e.length)>0?(x(),k("div",oe,[P(t,{color:"primary",label:T(Se)("weeklyPlans.teacher.previewAndPrint"),icon:"print",onClick:l[5]||(l[5]=e=>Ye.value=!0),outline:""},null,8,["label"]),P(t,{color:"secondary",label:T(Se)("weeklyPlans.teacher.mobilePrint"),icon:"phone_iphone",onClick:l[6]||(l[6]=e=>{var l;return null==(l=Ue.value)?void 0:l.openMobilePrint()}),outline:""},null,8,["label"]),P(t,{color:"red-7",label:T(Se)("weeklyPlans.teacher.downloadPdf"),icon:"picture_as_pdf",onClick:bl,outline:""},null,8,["label"])])):M("",!0)])]}),_:1}),el.value?(x(),k("div",se,[P(d,{size:"50px",color:"primary"})])):Fe.value.length?(x(),j(o,{key:2,flat:"",bordered:"",class:"q-mb-lg"},{default:D(()=>[P(m,{modelValue:Ke.value,"onUpdate:modelValue":l[7]||(l[7]=e=>Ke.value=e),dense:"",class:"text-grey-7","active-color":"primary","indicator-color":"primary",align:"left"},{default:D(()=>[P(c,{name:"by-classroom",label:T(Se)("weeklyPlans.teacher.byClassroom"),icon:"meeting_room",disable:!Ae.value||0===Ae.value.length},null,8,["label","disable"]),P(c,{name:"by-day",label:T(Se)("weeklyPlans.teacher.byDay"),icon:"calendar_today"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1})):(x(),j(o,{key:1,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:D(()=>[P(a,{name:"event_note",size:"64px",color:"grey-5"}),_("p",re,Q(T(Se)("weeklyPlans.teacher.noPlans")),1),_("p",ie,Q(T(Se)("weeklyPlans.teacher.waitAdminGen")),1)]),_:1})),V(_("div",ue,[(x(!0),k(C,null,z(sl.value,e=>(x(),k("div",{key:e.dayNumber,class:"day-column"},[_("div",de,Q(e.dayName),1),(x(!0),k(C,null,z(e.plans,e=>{var n,o,s,i,u;return x(),k("div",{key:e.id,class:E(["plan-card",{"is-completed":"completed"===e.status,"is-partial":"partial"===e.status}]),onClick:l=>ml(e)},[_("div",{class:"plan-header",style:F(dl(e))},[_("span",me,"P"+Q(null==(n=e.schedule)?void 0:n.period_number),1),_("span",pe,Q(null==(s=null==(o=e.schedule)?void 0:o.cst)?void 0:s.subject_name),1),P(p),_("div",ve,[Oe.value===e.id?(x(),j(t,{key:0,icon:"close",size:"xs",flat:"",round:"",color:"white",onClick:l[8]||(l[8]=e=>(e.stopPropagation(),Ie.value=null,void(Oe.value=null)))},{default:D(()=>[P(r,null,{default:D(()=>[q(Q(T(Se)("weeklyPlans.teacher.cancelCopy")),1)]),_:1})]),_:1})):Ie.value?M("",!0):(x(),j(t,{key:1,icon:"content_copy",size:"xs",flat:"",round:"",color:"white",onClick:l=>((e,l)=>{l.stopPropagation(),Ie.value={cw:e.cw,hw:e.hw,notes:e.notes},Oe.value=e.id,Ee.notify({message:Se("weeklyPlans.teacher.copy"),color:"info",icon:"content_copy",timeout:2e3})})(e,l)},{default:D(()=>[P(r,null,{default:D(()=>[q(Q(T(Se)("weeklyPlans.teacher.copy")),1)]),_:1})]),_:2},1032,["onClick"])),Ie.value&&Oe.value!==e.id?(x(),j(t,{key:2,icon:"content_paste",size:"xs",flat:"",round:"",color:"white",onClick:l=>(async(e,l)=>{if(l.stopPropagation(),Ie.value)try{await S.put(`/weekly-system/api/weekly-plans/${e.id}`,{...Ie.value}),e.cw=Ie.value.cw,e.hw=Ie.value.hw,e.notes=Ie.value.notes,e.status=ul(e),Ee.notify({type:"positive",message:Se("weeklyPlans.teacher.paste")})}catch(a){console.error("Error pasting plan:",a),Ee.notify({type:"negative",message:"Failed to paste data"})}})(e,l)},{default:D(()=>[P(r,null,{default:D(()=>[q(Q(T(Se)("weeklyPlans.teacher.paste")),1)]),_:1})]),_:2},1032,["onClick"])):M("",!0)])],4),_("div",ye,[P(a,{name:"meeting_room",size:"xs"}),q(" "+Q(null==(u=null==(i=e.schedule)?void 0:i.cst)?void 0:u.classroom_name),1)]),_("div",be,[P(N,{status:e.status},null,8,["status"])]),e.cw||e.hw?(x(),k("div",we,[e.cw?(x(),k("div",he,[P(a,{name:"school",size:"xs",color:"blue"}),q(" "+Q(T(Se)("weeklyPlans.teacher.cwFilled")),1)])):M("",!0),e.hw?(x(),k("div",ge,[P(a,{name:"home_work",size:"xs",color:"orange"}),q(" "+Q(T(Se)("weeklyPlans.teacher.hwFilled")),1)])):M("",!0)])):M("",!0)],10,ce)}),128))]))),128))],512),[[L,"by-day"===Ke.value]]),V(_("div",null,[P(H,{ref_key:"classroomListRef",ref:Ue,plans:ol.value,days:nl.value,"inline-edit-mode":Xe.value,"copied-data":Ie.value,"week-number":We.value,"semester-number":He.value,onEdit:ml,onSave:vl},null,8,["plans","days","inline-edit-mode","copied-data","week-number","semester-number"])],512),[[L,"by-classroom"===Ke.value]]),P(W,{modelValue:Ge.value,"onUpdate:modelValue":l[9]||(l[9]=e=>Ge.value=e),plan:Je.value,saving:Re.value,onSubmit:pl},null,8,["modelValue","plan","saving"]),P(s,{modelValue:Ye.value,"onUpdate:modelValue":l[11]||(l[11]=e=>Ye.value=e),maximized:""},{default:D(()=>[P(o,{class:"full-height print-preview-card"},{default:D(()=>[P(v,{class:"bg-primary text-white"},{default:D(()=>[P(y,null,{default:D(()=>[q(Q(T(Se)("weeklyPlans.teacher.previewAndPrint")),1)]),_:1}),P(p),P(t,{icon:"print",label:T(Se)("weeklyPlans.print"),color:"white",flat:"",onClick:yl},null,8,["label"]),P(t,{icon:"close",flat:"",round:"",dense:"",onClick:l[10]||(l[10]=e=>Ye.value=!1)})]),_:1}),_("div",fe,[_("div",ke,[_("div",xe,[_("h2",Pe,Q(T(Se)("weeklyPlans.teacher.myWeeklyPlans")),1),_("p",_e,Q(T(Se)("weeklyPlans.week"))+" "+Q(We.value)+" - "+Q(T(Se)("weeklyPlans.semester"))+" "+Q(He.value),1),_("p",je,Q(T(Se)("weeklyPlans.classroom"))+": "+Q(Ae.value.join(", ")),1),_("p",Ve,Q((new Date).toLocaleDateString(T(Le),{year:"numeric",month:"long",day:"numeric"})),1)]),_("table",qe,[_("thead",null,[_("tr",null,[_("th",null,Q(T(Se)("weeklyPlans.day")),1),_("th",null,Q(T(Se)("weeklyPlans.period")),1),_("th",null,Q(T(Se)("weeklyPlans.subject")),1),_("th",null,Q(T(Se)("weeklyPlans.classroom")),1),_("th",null,Q(T(Se)("weeklyPlans.classwork")),1),_("th",null,Q(T(Se)("weeklyPlans.homework")),1),_("th",null,Q(T(Se)("weeklyPlans.notes")),1)])]),_("tbody",null,[(x(!0),k(C,null,z(ol.value,e=>{var l,a,n,t,o,s;return x(),k("tr",{key:e.id},[_("td",null,Q(nl.value[null==(l=e.schedule)?void 0:l.day]||"N/A"),1),_("td",Qe,"P"+Q(null==(a=e.schedule)?void 0:a.period_number),1),_("td",null,Q(null==(t=null==(n=e.schedule)?void 0:n.cst)?void 0:t.subject_name),1),_("td",null,Q(null==(s=null==(o=e.schedule)?void 0:o.cst)?void 0:s.classroom_name),1),_("td",{class:"content-cell",innerHTML:e.cw||"-"},null,8,Te),_("td",{class:"content-cell",innerHTML:e.hw||"-"},null,8,De),_("td",{class:"content-cell",innerHTML:e.notes||"-"},null,8,Me)])}),128))])]),_("div",Ce,[_("p",ze,Q(T(Se)("weeklyPlans.teacher.generated"))+" "+Q((new Date).toLocaleString()),1)])])])]),_:1})]),_:1},8,["modelValue"])])],64)}}},[["__scopeId","data-v-795e0751"]]);export{Se as default};
