import{o as e,u as a,d as l,Q as o,p as t,aF as s,c as n,m as i,h as d,i as r,f as u,A as c,e as m,C as v,l as p,aP as g,b as _}from"./app-C-NJhdpe.js";import{Q as f}from"./QSelect-B3f0Rrq3.js";import{Q as h}from"./QTd-D3bw3I77.js";import{Q as y}from"./QBadge-D_SrvMy0.js";import{Q as b}from"./QTable-D-FHlyjj.js";import{a as w,Q as x}from"./QToolbar-BB2RUVFQ.js";import{Q as k}from"./QFile-Df8jQ91k.js";import{f as V,a as C,o as S,L as N,I as $,M as A,b as j,O as q,V as I,J as P,H as U,U as E,F as Q,x as F,Z as D}from"./vendor-CUZ9QTQV.js";import{u as T,w as O,r as G}from"./xlsx-cMC2LkxH.js";import R from"./StudentPromotionDialog-_WyunhhK.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";import"./rtl-Cr6c3OOr.js";import"./QMarkupTable-CDVIpyWz.js";import"./QLinearProgress-DLQRR2k-.js";import"./use-fullscreen-iiJPvjW2.js";import"./use-file-DLm3sfQB.js";import"./QStepperNavigation-Bl4ZAmuh.js";import"./QStepper-C4YK_SmS.js";import"./use-panel-CGzbevm7.js";import"./use-render-cache-CmTcazfP.js";const M={class:"q-pa-md"},B={class:"row items-center q-mb-md"},W={class:"col"},z={class:"text-h4 text-weight-bold"},H={class:"col-auto"},L={class:"row q-col-gutter-md q-mb-md"},Y={class:"col-12 col-md-3"},J={class:"text-h6"},Z={class:"col-12 col-md-3"},K={class:"text-h6"},X={class:"col-12 col-md-3"},ee={class:"text-h6"},ae={class:"col-12 col-md-3"},le={class:"text-h6"},oe={class:"row items-center q-mb-sm"},te={class:"col"},se={class:"text-h6"},ne={class:"col-auto"},ie={class:"row q-col-gutter-md"},de={class:"col-12 col-md-3"},re={class:"col-12 col-md-3"},ue={class:"col-12 col-md-3"},ce={class:"col-12 col-md-3"},me={class:"col-12 col-md-6"},ve={class:"col-12"},pe={key:0,class:"text-caption text-grey-7"},ge={class:"text-weight-bold"},_e={class:"text-caption text-grey-7"},fe={class:"full-width row flex-center q-gutter-sm q-pa-lg"},he={key:0,style:{position:"fixed",bottom:"18px",left:"0",right:"0","z-index":"2000",padding:"0 16px"}},ye={class:"text-h6"},be={key:0,class:"text-caption"},we={class:"row q-col-gutter-md"},xe={class:"col-12 col-md-6"},ke={class:"col-12 col-md-6"},Ve={class:"col-12 col-md-6"},Ce={class:"col-12"},Se={class:"col-12 col-md-6"},Ne={class:"col-12 col-md-6"},$e={class:"col-12 col-md-6"},Ae={class:"col-12"},je={class:"col-12"},qe={class:"text-caption"},Ie={class:"text-subtitle2 q-mb-sm"},Pe={class:"text-caption"},Ue={class:"text-subtitle2 q-mb-sm"},Ee=e({__name:"Index",props:{records:Object,schools:Array,grades:Array,academicYears:Array,userRoles:Array,permissions:Object},setup(e){const Ee=e,Qe=a(),Fe=V(!1),De=V([]),Te=V([]),Oe=V(!1),Ge=V(!1),Re=V(!1),Me=V(null),Be=V(!1),We=V(null),ze=V([]),He=V(!1),Le=V(!1),Ye=V(null),Je=V(!1),Ze=V(null),Ke=V([]),Xe=[{name:"name",label:"Name",field:"name",align:"left"},{name:"name_ar",label:"Arabic Name",field:"name_ar",align:"left"},{name:"name_cute",label:"Nickname",field:"name_cute",align:"left"},{name:"notes",label:"Notes",field:"notes",align:"left"}],ea=[{name:"name",label:"Name",field:"name",align:"left"},{name:"name_ar",label:"Arabic Name",field:"name_ar",align:"left"},{name:"name_cute",label:"Nickname",field:"name_cute",align:"left"},{name:"classroom",label:"Classroom",field:"classroom",align:"left"},{name:"notes",label:"Notes",field:"notes",align:"left"}],aa=V({school_id:null,stage_id:null,grade_id:null,classroom_id:null,search:""}),la=V([]),oa=V([]),ta=V([]),sa=V(Ee.grades||[]),na=V(Ee.academicYears||[]),ia=V([]),da=V([]),ra=V([]),ua=V({name:"",name_ar:"",name_cute:"",school_id:null,stage_id:null,grade_id:null,classroom_id:null,notes:""}),ca=V({sortBy:"name",descending:!1,page:1,rowsPerPage:25,rowsNumber:0}),ma=[{name:"index",label:"#",field:"index",align:"left",sortable:!1,style:"width: 50px"},{name:"avatar",label:"",field:"name",align:"center",style:"width: 60px",sortable:!1},{name:"s_id",label:"ID",field:"s_id",align:"left",sortable:!0},{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"school",label:"School",field:e=>{var a;return(null==(a=e.school)?void 0:a.name)||""},align:"left",sortable:!0},{name:"grade",label:"Grade",field:e=>{var a;return(null==(a=e.grade)?void 0:a.name)||""},align:"left",sortable:!0},{name:"classroom",label:"Classroom",field:e=>{var a;return(null==(a=e.classroom)?void 0:a.name)||""},align:"left",sortable:!0},{name:"actions",label:"Actions",field:"id",align:"center",sortable:!1}],va=C(()=>ca.value.rowsNumber||0),pa=C(()=>aa.value.school_id?De.value.filter(e=>e.school_id===aa.value.school_id).length:0),ga=C(()=>De.value.length),_a=C(()=>Te.value.length),fa=C(()=>aa.value.school_id&&aa.value.grade_id&&aa.value.classroom_id),ha=()=>{const e=Ee.schools.find(e=>e.id===aa.value.school_id);return(null==e?void 0:e.name)||"N/A"},ya=()=>{const e=oa.value.find(e=>e.id===aa.value.grade_id);return(null==e?void 0:e.name)||"N/A"},ba=()=>{const e=ta.value.find(e=>e.id===aa.value.classroom_id);return(null==e?void 0:e.name)||"N/A"},wa=()=>`${ha()} → ${ya()} → ${ba()}`,xa=e=>{if(!e)return"?";const a=e.split(" ");return a.length>=2?(a[0][0]+a[1][0]).toUpperCase():e.substring(0,2).toUpperCase()},ka=async()=>{aa.value.stage_id=null,aa.value.grade_id=null,aa.value.classroom_id=null,la.value=[],oa.value=[],ta.value=[],aa.value.school_id&&(Na(aa.value.school_id),await Aa(aa.value.school_id,"school")),ja()},Va=async()=>{aa.value.grade_id=null,aa.value.classroom_id=null,oa.value=[],aa.value.stage_id?(await $a(aa.value.stage_id),await Aa(aa.value.stage_id,"stage")):aa.value.school_id?await Aa(aa.value.school_id,"school"):ta.value=[],ja()},Ca=async()=>{aa.value.classroom_id=null,aa.value.grade_id?await Aa(aa.value.grade_id,"grade"):aa.value.stage_id?await Aa(aa.value.stage_id,"stage"):aa.value.school_id?await Aa(aa.value.school_id,"school"):ta.value=[],ja()},Sa=async()=>{0===ta.value.length&&aa.value.school_id&&(aa.value.grade_id?await Aa(aa.value.grade_id,"grade"):aa.value.stage_id?await Aa(aa.value.stage_id,"stage"):await Aa(aa.value.school_id,"school"))},Na=async e=>{try{const a=await D.get(`/admin/stages/by-school/${e}`);la.value=a.data}catch(a){console.error("Error loading stages:",a)}},$a=async e=>{try{const a=await D.get(`/admin/grades/by-stage/${e}`);oa.value=a.data}catch(a){console.error("Error loading grades:",a)}},Aa=async(e,a)=>{try{let l="";l="school"===a?`/admin/classrooms/by-school/${e}`:"stage"===a?`/admin/classrooms/by-stage/${e}`:`/admin/classrooms/by-grade/${e}`;const o=await D.get(l);ta.value=o.data}catch(l){console.error("Error loading classrooms:",l),ta.value=[]}},ja=async()=>{Fe.value=!0;try{const e={school_id:aa.value.school_id,stage_id:aa.value.stage_id,grade_id:aa.value.grade_id,classroom_id:aa.value.classroom_id,search:aa.value.search},a=await D.get("/admin/students/filtered",{params:e});De.value=a.data.records.data||[],ca.value.rowsNumber=a.data.records.total||0}catch(e){Qe.notify({type:"negative",message:"Failed to load students"})}finally{Fe.value=!1}},qa=()=>{aa.value={school_id:null,stage_id:null,grade_id:null,classroom_id:null,search:""},la.value=[],oa.value=[],ta.value=[],ja()};let Ia;const Pa=()=>{clearTimeout(Ia),Ia=setTimeout(()=>{ja()},500)},Ua=e=>{ja()},Ea=(e=null)=>{Le.value=!1,Ye.value=null,e?(Me.value=e,Ye.value=e.classroom_id,ua.value={name:e.name,name_ar:e.name_ar,name_cute:e.name_cute,school_id:e.school_id,stage_id:e.stage_id,grade_id:e.grade_id,classroom_id:e.classroom_id,notes:e.notes},e.school_id&&Fa(),e.stage_id&&Da(),e.grade_id&&Ta()):(Me.value=null,ua.value={name:"",name_ar:"",name_cute:"",school_id:aa.value.school_id,stage_id:aa.value.stage_id,grade_id:aa.value.grade_id,classroom_id:aa.value.classroom_id,notes:""}),Oe.value=!0},Qa=()=>{Me.value&&null!==Ye.value&&(Le.value=ua.value.classroom_id!==Ye.value)},Fa=async()=>{if(ua.value.stage_id=null,ua.value.grade_id=null,ua.value.classroom_id=null,ua.value.school_id){const e=await D.get(`/admin/stages/by-school/${ua.value.school_id}`);ia.value=e.data}},Da=async()=>{if(ua.value.grade_id=null,ua.value.classroom_id=null,ua.value.stage_id){const e=await D.get(`/admin/grades/by-stage/${ua.value.stage_id}`);da.value=e.data}},Ta=async()=>{if(ua.value.classroom_id=null,ua.value.grade_id){const e=await D.get(`/admin/classrooms/by-grade/${ua.value.grade_id}`);ra.value=e.data}},Oa=async()=>{var e,a;Be.value=!0;try{const e=Me.value?`/admin/students/${Me.value.id}`:"/admin/students",a={...ua.value,...Me.value&&{_method:"PUT"}};await D.post(e,a),Qe.notify({type:"positive",message:Me.value?"Student updated successfully":"Student created successfully"}),Oe.value=!1,ja()}catch(l){Qe.notify({type:"negative",message:(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||"Failed to save student"})}finally{Be.value=!1}},Ga=()=>{if(0!==De.value.length)try{const e=De.value.map(e=>{var a,l,o,t;return{ID:e.s_id||"",Name:e.name||"","Arabic Name":e.name_ar||"",Nickname:e.name_cute||"",School:(null==(a=e.school)?void 0:a.name)||"",Stage:(null==(l=e.stage)?void 0:l.name)||"",Grade:(null==(o=e.grade)?void 0:o.name)||"",Classroom:(null==(t=e.classroom)?void 0:t.name)||"",Notes:e.notes||""}}),a=T.json_to_sheet(e),l=T.book_new();T.book_append_sheet(l,a,"Students");const o=(new Date).toISOString().split("T")[0];O(l,`students_export_${o}.xlsx`),Qe.notify({type:"positive",message:`Successfully exported ${De.value.length} students`})}catch(e){console.error("Export error:",e),Qe.notify({type:"negative",message:"Failed to export students"})}else Qe.notify({type:"warning",message:"No students to export"})},Ra=()=>{Qe.notify({type:"info",message:"Bulk classroom change coming in Phase 4!"})},Ma=()=>{if(0!==Te.value.length)try{const e=Te.value.map(e=>{var a,l,o,t;return{ID:e.s_id||"",Name:e.name||"","Arabic Name":e.name_ar||"",Nickname:e.name_cute||"",School:(null==(a=e.school)?void 0:a.name)||"",Stage:(null==(l=e.stage)?void 0:l.name)||"",Grade:(null==(o=e.grade)?void 0:o.name)||"",Classroom:(null==(t=e.classroom)?void 0:t.name)||"",Notes:e.notes||""}}),a=T.json_to_sheet(e),l=T.book_new();T.book_append_sheet(l,a,"Students");const o=(new Date).toISOString().split("T")[0];O(l,`students_export_${o}.xlsx`),Qe.notify({type:"positive",message:`Successfully exported ${Te.value.length} students`})}catch(e){console.error("Export error:",e),Qe.notify({type:"negative",message:"Failed to export students"})}else Qe.notify({type:"warning",message:"No students selected"})},Ba=()=>{Qe.dialog({title:"Confirm Bulk Delete",message:`Are you sure you want to delete ${Te.value.length} students?`,cancel:!0,persistent:!0}).onOk(()=>{Qe.notify({type:"info",message:"Bulk delete coming soon!"})})},Wa=e=>{Qe.notify({type:"positive",message:`Successfully promoted ${e.promoted_count} students!`}),ja()},za=()=>{fa.value?Re.value=!0:Qe.notify({type:"negative",message:"Please select School, Grade, and Classroom before importing"})},Ha=async e=>{if(e)try{const a=await La(e);ze.value=a.map((e,a)=>({index:a,name:e.name||e.Name||"",name_ar:e.name_ar||e["Arabic Name"]||"",name_cute:e.name_cute||e.Nickname||"",notes:e.notes||e.Notes||""}))}catch(a){Qe.notify({type:"negative",message:"Error reading Excel file: "+a.message})}},La=e=>new Promise((a,l)=>{const o=new FileReader;o.onload=e=>{try{const l=new Uint8Array(e.target.result),o=G(l,{type:"array"}),t=o.Sheets[o.SheetNames[0]],s=T.sheet_to_json(t);a(s)}catch(o){l(o)}},o.onerror=l,o.readAsArrayBuffer(e)}),Ya=async()=>{He.value=!0;let e=0,a=0;try{for(const o of ze.value)try{const a={name:o.name,name_ar:o.name_ar||"",name_cute:o.name_cute||"",school_id:aa.value.school_id,stage_id:aa.value.stage_id,grade_id:aa.value.grade_id,classroom_id:aa.value.classroom_id,notes:o.notes||""};await D.post("/admin/students",a),e++}catch(l){a++,console.error("Import error:",l)}Qe.notify({type:e>0?"positive":"negative",message:`Import complete: ${e} students added${a>0?`, ${a} errors`:""}`,timeout:3e3}),al(),await ja()}catch(l){Qe.notify({type:"negative",message:"Import failed: "+(l.message||"Unknown error")})}finally{He.value=!1}},Ja=()=>{window.location.href="/admin/students/download-template"},Za=()=>{window.location.href="/admin/students/download-template-with-classroom"},Ka=async e=>{if(e)try{const a=await La(e);if(a.length>0&&!("classroom"in a[0])&&!("Classroom"in a[0]))return Qe.notify({type:"negative",message:'Invalid file: Missing "classroom" column. Please download the correct template.'}),void(Ze.value=null);const l=[],o=[];if(a.forEach((e,a)=>{const t=e.name||e.Name||"",s=e.classroom||e.Classroom||"";t.trim()&&s.trim()?l.push({index:a,name:t.trim(),name_ar:(e.name_ar||e["Arabic Name"]||"").trim(),name_cute:(e.name_cute||e.Nickname||"").trim(),classroom:s.trim(),notes:(e.notes||e.Notes||"").trim()}):o.push({row:a+2,reason:t.trim()?"Missing classroom":"Missing name"})}),o.length>0){const e=o.map(e=>`Row ${e.row}: ${e.reason}`).join("\n");Qe.dialog({title:"Invalid Records Found",message:`Found ${o.length} invalid record(s):\n\n${e}\n\nThese rows will be skipped.`,html:!0})}Ke.value=l}catch(a){Qe.notify({type:"negative",message:"Error reading Excel file: "+a.message})}},Xa=async()=>{var e,a;if(!aa.value.school_id)return void Qe.notify({type:"negative",message:"Please select a school"});const l=Ke.value.length;let o=0,t=0,s=0,n=0;const i=[],d=Qe.dialog({title:"Importing Students",message:`Processing 0 of ${l} students...`,progress:{spinner:!1,value:0,color:"primary"},persistent:!0,ok:!1});He.value=!0;try{for(const[c,m]of Ke.value.entries())try{const e=await D.post("/admin/students/import-with-classroom",{school_id:aa.value.school_id,name:m.name,name_ar:m.name_ar,name_cute:m.name_cute,classroom:m.classroom,notes:m.notes});o++,"created"===e.data.status?t++:"duplicate"===e.data.status&&s++,d.update({message:`Processing ${o} of ${l} students...\nCreated: ${t} | Duplicates: ${s} | Failed: ${n}`,progress:{value:o/l}})}catch(r){o++,n++,i.push({row:c+2,name:m.name,error:(null==(a=null==(e=r.response)?void 0:e.data)?void 0:a.message)||r.message}),d.update({message:`Processing ${o} of ${l} students...\nCreated: ${t} | Duplicates: ${s} | Failed: ${n}`,progress:{value:o/l}})}d.hide();const u=`Import Complete!\n\n✅ Created: ${t}\n⏭️ Duplicates: ${s}\n❌ Failed: ${n}`;n>0?(Qe.dialog({title:"Import Completed with Errors",message:u+"\n\nCheck console for error details.",html:!0}),console.log("Import Errors:",i)):Qe.notify({type:"positive",message:u,html:!0,timeout:5e3}),ll(),await ja()}catch(r){d.hide(),Qe.notify({type:"negative",message:"Import failed: "+(r.message||"Unknown error")})}finally{He.value=!1}},el=()=>{aa.value.school_id?Je.value=!0:Qe.notify({type:"negative",message:"Please select a School first"})},al=()=>{Re.value=!1,We.value=null,ze.value=[]},ll=()=>{Je.value=!1,Ze.value=null,Ke.value=[]};return S(async()=>{var e;(null==(e=Ee.records)?void 0:e.data)&&(De.value=Ee.records.data,ca.value.rowsNumber=Ee.records.total||0),Ee.schools&&Ee.schools.length>0&&(aa.value.school_id=Ee.schools[0].id,await ka())}),(a,V)=>($(),N("div",M,[A("div",B,[A("div",W,[A("div",z,[j(l,{name:"school",class:"q-mr-sm"}),V[23]||(V[23]=I(" Student Management "))]),V[24]||(V[24]=A("div",{class:"text-subtitle2 text-grey-7"}," Manage students, classrooms, and promotions ",-1))]),A("div",H,[j(s,{push:""},{default:P(()=>[j(o,{color:"primary",icon:"add",label:"Add Student",onClick:V[0]||(V[0]=e=>Ea()),disable:!fa.value,unelevated:""},{default:P(()=>[fa.value?q("",!0):($(),U(t,{key:0},{default:P(()=>V[25]||(V[25]=[I(" Please select School, Grade, and Classroom first ")])),_:1}))]),_:1},8,["disable"]),j(o,{color:"secondary",icon:"upgrade",label:"Promote Students",onClick:V[1]||(V[1]=e=>Ge.value=!0),unelevated:""}),j(o,{color:"info",icon:"upload_file",label:"Import",onClick:za,disable:!fa.value,unelevated:""},{default:P(()=>[fa.value?q("",!0):($(),U(t,{key:0},{default:P(()=>V[26]||(V[26]=[I(" Please select School, Grade, and Classroom first ")])),_:1}))]),_:1},8,["disable"]),j(o,{color:"purple",icon:"cloud_upload",label:"School-Wide Import",onClick:el,disable:!aa.value.school_id,unelevated:""},{default:P(()=>[aa.value.school_id?q("",!0):($(),U(t,{key:0},{default:P(()=>V[27]||(V[27]=[I(" Please select a School first ")])),_:1}))]),_:1},8,["disable"]),j(o,{color:"positive",icon:"download",label:"Export",onClick:Ga,unelevated:""})]),_:1})])]),A("div",L,[A("div",Y,[j(i,{flat:"",bordered:""},{default:P(()=>[j(n,{class:"bg-primary text-white"},{default:P(()=>[A("div",J,E(va.value),1),V[28]||(V[28]=A("div",{class:"text-caption"},"Total Students",-1))]),_:1})]),_:1})]),A("div",Z,[j(i,{flat:"",bordered:""},{default:P(()=>[j(n,{class:"bg-secondary text-white"},{default:P(()=>[A("div",K,E(pa.value),1),V[29]||(V[29]=A("div",{class:"text-caption"},"In Selected School",-1))]),_:1})]),_:1})]),A("div",X,[j(i,{flat:"",bordered:""},{default:P(()=>[j(n,{class:"bg-positive text-white"},{default:P(()=>[A("div",ee,E(ga.value),1),V[30]||(V[30]=A("div",{class:"text-caption"},"Filtered Results",-1))]),_:1})]),_:1})]),A("div",ae,[j(i,{flat:"",bordered:""},{default:P(()=>[j(n,{class:"bg-info text-white"},{default:P(()=>[A("div",le,E(_a.value),1),V[31]||(V[31]=A("div",{class:"text-caption"},"Selected",-1))]),_:1})]),_:1})])]),j(i,{flat:"",bordered:"",class:"q-mb-md"},{default:P(()=>[j(n,null,{default:P(()=>[A("div",oe,[A("div",te,[A("div",se,[j(l,{name:"filter_list",class:"q-mr-sm"}),V[32]||(V[32]=I(" Filters "))])]),A("div",ne,[j(o,{flat:"",dense:"",icon:"clear",label:"Clear All",onClick:qa,color:"negative"})])]),A("div",ie,[A("div",de,[j(f,{modelValue:aa.value.school_id,"onUpdate:modelValue":[V[2]||(V[2]=e=>aa.value.school_id=e),ka],options:e.schools,"option-value":"id","option-label":"name",label:"School",outlined:"",dense:"",clearable:"","emit-value":"","map-options":""},{prepend:P(()=>[j(l,{name:"business"})]),_:1},8,["modelValue","options"])]),A("div",re,[j(f,{modelValue:aa.value.stage_id,"onUpdate:modelValue":[V[3]||(V[3]=e=>aa.value.stage_id=e),Va],options:la.value,"option-value":"id","option-label":"name",label:"Stage",outlined:"",dense:"",clearable:"","emit-value":"","map-options":"",disable:!aa.value.school_id},{prepend:P(()=>[j(l,{name:"layers"})]),_:1},8,["modelValue","options","disable"])]),A("div",ue,[j(f,{modelValue:aa.value.grade_id,"onUpdate:modelValue":[V[4]||(V[4]=e=>aa.value.grade_id=e),Ca],options:oa.value,"option-value":"id","option-label":"name",label:"Grade",outlined:"",dense:"",clearable:"","emit-value":"","map-options":"",disable:!aa.value.school_id},{prepend:P(()=>[j(l,{name:"school"})]),_:1},8,["modelValue","options","disable"])]),A("div",ce,[j(f,{modelValue:aa.value.classroom_id,"onUpdate:modelValue":[V[5]||(V[5]=e=>aa.value.classroom_id=e),ja],options:ta.value,"option-value":"id","option-label":"name",label:"Classroom",outlined:"",dense:"",clearable:"","emit-value":"","map-options":"",disable:!aa.value.school_id,onPopupShow:Sa},{prepend:P(()=>[j(l,{name:"meeting_room"})]),"no-option":P(()=>[j(d,null,{default:P(()=>[j(r,{class:"text-grey"},{default:P(()=>[I(E(0===ta.value.length?"Click to load classrooms...":"No classrooms available"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","options","disable"])]),A("div",me,[j(u,{modelValue:aa.value.search,"onUpdate:modelValue":[V[6]||(V[6]=e=>aa.value.search=e),Pa],label:"Search by name or ID",outlined:"",dense:"",clearable:""},{prepend:P(()=>[j(l,{name:"search"})]),_:1},8,["modelValue"])])])]),_:1})]),_:1}),j(i,{flat:"",bordered:""},{default:P(()=>[j(b,{rows:De.value,columns:ma,"row-key":"id",loading:Fe.value,pagination:ca.value,onRequest:Ua,selection:"multiple",selected:Te.value,"onUpdate:selected":V[7]||(V[7]=e=>Te.value=e),flat:"","rows-per-page-options":[10,25,50,100]},{top:P(()=>[A("div",ve,[V[33]||(V[33]=A("div",{class:"text-h6"},"Students List",-1)),Te.value.length>0?($(),N("div",pe,E(Te.value.length)+" student(s) selected ",1)):q("",!0)])]),"body-cell-index":P(e=>[j(h,{props:e},{default:P(()=>[I(E(e.rowIndex+1),1)]),_:2},1032,["props"])]),"body-cell-avatar":P(e=>[j(h,{props:e},{default:P(()=>[j(c,{color:"primary","text-color":"white",size:"md"},{default:P(()=>[I(E(xa(e.row.name)),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-name":P(e=>[j(h,{props:e},{default:P(()=>[A("div",ge,E(e.row.name),1),A("div",_e,E(e.row.name_ar),1)]),_:2},1032,["props"])]),"body-cell-s_id":P(e=>[j(h,{props:e},{default:P(()=>[j(y,{color:"grey-7",outline:""},{default:P(()=>[I(E(e.row.s_id),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-school":P(e=>[j(h,{props:e},{default:P(()=>{var a;return[A("div",null,E(null==(a=e.row.school)?void 0:a.name),1)]}),_:2},1032,["props"])]),"body-cell-classroom":P(e=>[j(h,{props:e},{default:P(()=>[j(y,{color:"secondary"},{default:P(()=>{var a;return[I(E(null==(a=e.row.classroom)?void 0:a.name),1)]}),_:2},1024)]),_:2},1032,["props"])]),"body-cell-grade":P(e=>[j(h,{props:e},{default:P(()=>{var a;return[A("div",null,E(null==(a=e.row.grade)?void 0:a.name),1)]}),_:2},1032,["props"])]),"body-cell-actions":P(e=>[j(h,{props:e},{default:P(()=>[j(s,{flat:""},{default:P(()=>[j(o,{flat:"",dense:"",round:"",icon:"edit",color:"primary",onClick:a=>Ea(e.row)},{default:P(()=>[j(t,null,{default:P(()=>V[34]||(V[34]=[I("Edit")])),_:1})]),_:2},1032,["onClick"]),j(o,{flat:"",dense:"",round:"",icon:"history",color:"info",onClick:a=>(async e=>{try{const a=await D.get(`/admin/students/${e.id}/classroom-history`);Qe.dialog({title:`Classroom History - ${e.name}`,message:JSON.stringify(a.data.history,null,2)})}catch(a){Qe.notify({type:"negative",message:"Failed to load history"})}})(e.row)},{default:P(()=>[j(t,null,{default:P(()=>V[35]||(V[35]=[I("View History")])),_:1})]),_:2},1032,["onClick"]),j(o,{flat:"",dense:"",round:"",icon:"delete",color:"negative",onClick:a=>(async e=>{Qe.dialog({title:"Confirm Delete",message:`Are you sure you want to delete ${e.name}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{await D.delete(`/admin/students/${e.id}`),Qe.notify({type:"positive",message:"Student deleted successfully"}),ja()}catch(a){Qe.notify({type:"negative",message:"Failed to delete student"})}})})(e.row)},{default:P(()=>[j(t,null,{default:P(()=>V[36]||(V[36]=[I("Delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),"no-data":P(()=>[A("div",fe,[j(l,{size:"2em",name:"sentiment_dissatisfied"}),V[37]||(V[37]=A("span",null,"No students found. Try adjusting your filters.",-1))])]),_:1},8,["rows","loading","pagination","selected"])]),_:1}),Te.value.length>0?($(),N("div",he,[j(x,{class:"bg-primary text-white shadow-up-2",style:{"border-radius":"4px"}},{default:P(()=>[j(w,null,{default:P(()=>[I(E(Te.value.length)+" student(s) selected ",1)]),_:1}),j(o,{flat:"",label:"Change Classroom",icon:"meeting_room",onClick:Ra}),j(o,{flat:"",label:"Export Selected",icon:"download",onClick:Ma}),j(o,{flat:"",label:"Delete Selected",icon:"delete",onClick:Ba}),j(o,{flat:"",round:"",dense:"",icon:"close",onClick:V[8]||(V[8]=e=>Te.value=[])})]),_:1})])):q("",!0),j(_,{modelValue:Oe.value,"onUpdate:modelValue":V[17]||(V[17]=e=>Oe.value=e),persistent:""},{default:P(()=>[j(i,{style:{"min-width":"600px"}},{default:P(()=>[j(n,{class:"bg-primary text-white"},{default:P(()=>[A("div",ye,E(Me.value?"Edit Student":"Add New Student"),1),Me.value?q("",!0):($(),N("div",be," Adding to: "+E(wa()),1))]),_:1}),j(n,null,{default:P(()=>[Me.value?q("",!0):($(),U(m,{key:0,class:"bg-info text-white q-mb-md",rounded:""},{avatar:P(()=>[j(l,{name:"info"})]),default:P(()=>[V[38]||(V[38]=A("div",{class:"text-weight-bold"},"Selected Context:",-1)),A("div",null,E(ha())+" → "+E(ya())+" → "+E(ba()),1)]),_:1})),A("div",we,[A("div",xe,[j(u,{modelValue:ua.value.name,"onUpdate:modelValue":V[9]||(V[9]=e=>ua.value.name=e),label:"Name *",outlined:"",rules:[e=>!!e||"Name is required"]},null,8,["modelValue","rules"])]),A("div",ke,[j(u,{modelValue:ua.value.name_ar,"onUpdate:modelValue":V[10]||(V[10]=e=>ua.value.name_ar=e),label:"Arabic Name",outlined:""},null,8,["modelValue"])]),A("div",Ve,[j(u,{modelValue:ua.value.name_cute,"onUpdate:modelValue":V[11]||(V[11]=e=>ua.value.name_cute=e),label:"Nickname",outlined:""},null,8,["modelValue"])]),Me.value?($(),N(Q,{key:0},[A("div",Ce,[j(m,{class:"bg-grey-2 q-mb-md",rounded:""},{avatar:P(()=>[j(l,{name:"info",color:"primary"})]),default:P(()=>[V[39]||(V[39]=A("div",{class:"text-weight-bold"},"Current Assignment:",-1)),A("div",null,[j(v,{dense:"",color:"secondary","text-color":"white",icon:"business"},{default:P(()=>{var e;return[I(E((null==(e=Me.value.school)?void 0:e.name)||"N/A"),1)]}),_:1}),j(v,{dense:"",color:"info","text-color":"white",icon:"layers"},{default:P(()=>{var e;return[I(E((null==(e=Me.value.stage)?void 0:e.name)||"N/A"),1)]}),_:1}),j(v,{dense:"",color:"primary","text-color":"white",icon:"school"},{default:P(()=>{var e;return[I(E((null==(e=Me.value.grade)?void 0:e.name)||"N/A"),1)]}),_:1}),j(v,{dense:"",color:"accent","text-color":"white",icon:"meeting_room"},{default:P(()=>{var e;return[I(E((null==(e=Me.value.classroom)?void 0:e.name)||"N/A"),1)]}),_:1})])]),_:1})]),A("div",Se,[j(f,{modelValue:ua.value.school_id,"onUpdate:modelValue":[V[12]||(V[12]=e=>ua.value.school_id=e),Fa],options:e.schools,"option-value":"id","option-label":"name",label:"School *",outlined:"","emit-value":"","map-options":"",rules:[e=>!!e||"School is required"]},null,8,["modelValue","options","rules"])]),A("div",Ne,[j(f,{modelValue:ua.value.stage_id,"onUpdate:modelValue":[V[13]||(V[13]=e=>ua.value.stage_id=e),Da],options:ia.value,"option-value":"id","option-label":"name",label:"Stage *",outlined:"","emit-value":"","map-options":"",disable:!ua.value.school_id,rules:[e=>!!e||"Stage is required"]},null,8,["modelValue","options","disable","rules"])]),A("div",$e,[j(f,{modelValue:ua.value.grade_id,"onUpdate:modelValue":[V[14]||(V[14]=e=>ua.value.grade_id=e),Ta],options:da.value,"option-value":"id","option-label":"name",label:"Grade *",outlined:"","emit-value":"","map-options":"",disable:!ua.value.stage_id,rules:[e=>!!e||"Grade is required"]},null,8,["modelValue","options","disable","rules"])]),A("div",Ae,[j(f,{modelValue:ua.value.classroom_id,"onUpdate:modelValue":[V[15]||(V[15]=e=>ua.value.classroom_id=e),Qa],options:ra.value,"option-value":"id","option-label":"name",label:"Classroom *",outlined:"","emit-value":"","map-options":"",disable:!ua.value.grade_id,rules:[e=>!!e||"Classroom is required"]},{prepend:P(()=>[j(l,{name:"meeting_room"})]),_:1},8,["modelValue","options","disable","rules"]),Le.value?($(),U(m,{key:0,class:"bg-warning text-white q-mt-sm",dense:"",rounded:""},{avatar:P(()=>[j(l,{name:"warning"})]),default:P(()=>[V[40]||(V[40]=A("strong",null,"Warning:",-1)),V[41]||(V[41]=I(" Changing the classroom will update the student's assignment and may affect their schedule and records. "))]),_:1})):q("",!0)])],64)):q("",!0),A("div",je,[j(u,{modelValue:ua.value.notes,"onUpdate:modelValue":V[16]||(V[16]=e=>ua.value.notes=e),label:"Notes",outlined:"",type:"textarea",rows:"3"},null,8,["modelValue"])])])]),_:1}),j(p,{align:"right"},{default:P(()=>[F(j(o,{flat:"",label:"Cancel",color:"negative"},null,512),[[g]]),j(o,{unelevated:"",label:"Save",color:"primary",onClick:Oa,loading:Be.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),j(R,{modelValue:Ge.value,"onUpdate:modelValue":V[18]||(V[18]=e=>Ge.value=e),grades:sa.value,"academic-years":na.value,onPromoted:Wa},null,8,["modelValue","grades","academic-years"]),j(_,{modelValue:Re.value,"onUpdate:modelValue":V[20]||(V[20]=e=>Re.value=e),persistent:""},{default:P(()=>[j(i,{style:{"min-width":"700px","max-width":"90vw"}},{default:P(()=>[j(n,{class:"bg-info text-white"},{default:P(()=>[V[42]||(V[42]=A("div",{class:"text-h6"},"Import Students",-1)),A("div",qe," Importing to: "+E(wa()),1)]),_:1}),ze.value.length?($(),U(n,{key:1,class:"q-pt-none",style:{"max-height":"400px","overflow-y":"auto"}},{default:P(()=>[A("div",Ie,"Preview ("+E(ze.value.length)+" students)",1),j(b,{rows:ze.value,columns:Xe,"row-key":"index",flat:"",dense:"",pagination:{rowsPerPage:10}},null,8,["rows"])]),_:1})):($(),U(n,{key:0},{default:P(()=>[j(k,{modelValue:We.value,"onUpdate:modelValue":[V[19]||(V[19]=e=>We.value=e),Ha],label:"Select Excel file",accept:".xlsx,.xls",outlined:""},{prepend:P(()=>[j(l,{name:"attach_file"})]),_:1},8,["modelValue"]),j(m,{class:"bg-grey-2 q-mt-md",rounded:""},{avatar:P(()=>[j(l,{name:"info",color:"info"})]),action:P(()=>[j(o,{flat:"",dense:"",label:"Download Template",icon:"download",color:"primary",onClick:Ja})]),default:P(()=>[V[43]||(V[43]=A("div",{class:"text-caption"},[A("strong",null,"Required columns:"),I(" name"),A("br"),A("strong",null,"Optional columns:"),I(" name_ar, name_cute, notes ")],-1))]),_:1})]),_:1})),j(p,{align:"right"},{default:P(()=>[j(o,{flat:"",label:"Cancel",color:"negative",onClick:al}),ze.value.length?($(),U(o,{key:0,unelevated:"",label:"Import All",color:"primary",onClick:Ya,loading:He.value},null,8,["loading"])):q("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),j(_,{modelValue:Je.value,"onUpdate:modelValue":V[22]||(V[22]=e=>Je.value=e),persistent:""},{default:P(()=>[j(i,{style:{"min-width":"700px","max-width":"90vw"}},{default:P(()=>[j(n,{class:"bg-purple text-white"},{default:P(()=>[V[44]||(V[44]=A("div",{class:"text-h6"},"School-Wide Import",-1)),A("div",Pe," Importing to: "+E(ha()),1)]),_:1}),Ke.value.length?($(),U(n,{key:1,class:"q-pt-none",style:{"max-height":"400px","overflow-y":"auto"}},{default:P(()=>[A("div",Ue,"Preview ("+E(Ke.value.length)+" students)",1),j(b,{rows:Ke.value,columns:ea,"row-key":"index",flat:"",dense:"",pagination:{rowsPerPage:10}},null,8,["rows"])]),_:1})):($(),U(n,{key:0},{default:P(()=>[j(k,{modelValue:Ze.value,"onUpdate:modelValue":[V[21]||(V[21]=e=>Ze.value=e),Ka],label:"Select Excel file with classroom column",accept:".xlsx,.xls",outlined:""},{prepend:P(()=>[j(l,{name:"attach_file"})]),_:1},8,["modelValue"]),j(m,{class:"bg-grey-2 q-mt-md",rounded:""},{avatar:P(()=>[j(l,{name:"info",color:"info"})]),action:P(()=>[j(o,{flat:"",dense:"",label:"Download Template",icon:"download",color:"primary",onClick:Za})]),default:P(()=>[V[45]||(V[45]=A("div",{class:"text-caption"},[A("strong",null,"Required columns:"),I(" name, classroom"),A("br"),A("strong",null,"Optional columns:"),I(" name_ar, name_cute, notes"),A("br"),A("strong",null,"Classroom formats:"),I(' "4A", "Grade 4 - A", "4-A" ')],-1))]),_:1})]),_:1})),j(p,{align:"right"},{default:P(()=>[j(o,{flat:"",label:"Cancel",color:"negative",onClick:ll}),Ke.value.length?($(),U(o,{key:0,unelevated:"",label:"Import All",color:"purple",onClick:Xa,loading:He.value},null,8,["loading"])):q("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-25035af4"]]);export{Ee as default};
