import e from"./TaskTree-CwjaeHMx.js";import a from"./TaskForm-CERx74YJ.js";import t from"./TaskFilters-BP7DcRZK.js";import s from"./TaskPagination-B3MJlwjn.js";import{f as r,r as o,_ as l,o as n,af as i,M as d,J as c,b as u,N as g,Q as p,W as v,I as y,z as w,l as m,U as k,a0 as f,V as b}from"./vendor-DuKqz2x4.js";import{o as h}from"./app-CqJgtQaN.js";import"./TaskTreeRow-CLgLntat.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";const x={class:"myproject-tasks-container"},E={class:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 px-6 py-4"},T={class:"flex justify-between items-center"},j={class:"flex-1 p-6"},_={class:"h-4"},F={key:0,class:"mb-3 h-1 w-full bg-blue-100 overflow-hidden rounded"},D={class:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6"},S={class:"text-gray-600 mb-6"},$={class:"flex justify-end gap-3"},P=["disabled"],M=h({__name:"TaskManager",setup(h){const{tasks:M,loading:C,pagination:O,filters:U,viewMode:I,fetchTasks:A,createTask:z,updateTask:N,deleteTask:B,createSubtask:H,moveTask:L,showNotification:V}=function(){const e=r([]),a=r(!1),t=o({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0}),s=o({status:"",priority:"",search:"",sort_by:"created_at",sort_direction:"desc",page:1,per_page:10}),n=r("tree"),i=[],d=(e,a="success")=>{i.forEach(t=>t(e,a))};d.subscribe=e=>(i.push(e),()=>{const a=i.indexOf(e);a>-1&&i.splice(a,1)});const c="/api/myproject_tasks";return{tasks:e,loading:a,pagination:t,filters:s,viewMode:n,fetchTasks:async()=>{var r,o;a.value=!0;try{const a=new URLSearchParams;a.append("view",n.value),Object.entries(s).forEach(([e,t])=>{""!==t&&null!=t&&a.append(e,t)});const r=await l.get(`${c}?${a.toString()}`);if(!r.data.success)throw new Error(r.data.message||"Failed to fetch tasks");e.value=r.data.data,r.data.pagination?Object.assign(t,r.data.pagination):Object.assign(t,{current_page:1,last_page:1,per_page:r.data.total_tasks||0,total:r.data.total_tasks||0,from:1,to:r.data.total_tasks||0})}catch(i){console.error("Error fetching tasks:",i),d((null==(o=null==(r=i.response)?void 0:r.data)?void 0:o.message)||i.message||"Failed to fetch tasks","error"),e.value=[]}finally{a.value=!1}},createTask:async e=>{var a,t,s;try{const a=await l.post(c,e);if(a.data.success)return a.data.data;throw new Error(a.data.message||"Failed to create task")}catch(r){if(console.error("Error creating task:",r),422===(null==(a=r.response)?void 0:a.status)){const e=r.response.data.errors,a=Object.values(e).flat().join(", ");throw new Error(a)}throw new Error((null==(s=null==(t=r.response)?void 0:t.data)?void 0:s.message)||r.message||"Failed to create task")}},updateTask:async(e,a)=>{var t,s,r,o;try{console.log("Updating task:",{id:e,taskData:a});const t=await l.put(`${c}/${e}`,a);if(console.log("Update response:",t.data),t.data.success)return t.data.data;throw new Error(t.data.message||"Failed to update task")}catch(n){if(console.error("Error updating task:",n),console.error("Error response:",null==(t=n.response)?void 0:t.data),422===(null==(s=n.response)?void 0:s.status)){const e=n.response.data.errors,a=Object.values(e).flat().join(", ");throw new Error(a)}throw new Error((null==(o=null==(r=n.response)?void 0:r.data)?void 0:o.message)||n.message||"Failed to update task")}},deleteTask:async e=>{var a,t;try{const a=await l.delete(`${c}/${e}`);if(a.data.success)return!0;throw new Error(a.data.message||"Failed to delete task")}catch(s){throw console.error("Error deleting task:",s),new Error((null==(t=null==(a=s.response)?void 0:a.data)?void 0:t.message)||s.message||"Failed to delete task")}},getTask:async e=>{var a,t;try{const a=await l.get(`${c}/${e}`);if(a.data.success)return a.data.data;throw new Error(a.data.message||"Failed to fetch task")}catch(s){throw console.error("Error fetching task:",s),new Error((null==(t=null==(a=s.response)?void 0:a.data)?void 0:t.message)||s.message||"Failed to fetch task")}},createSubtask:async(e,a)=>{var t,s,r;try{const t=await l.post(`${c}/${e}/subtasks`,a);if(t.data.success)return t.data.data;throw new Error(t.data.message||"Failed to create subtask")}catch(o){if(console.error("Error creating subtask:",o),422===(null==(t=o.response)?void 0:t.status)){const e=o.response.data.errors,a=Object.values(e).flat().join(", ");throw new Error(a)}throw new Error((null==(r=null==(s=o.response)?void 0:s.data)?void 0:r.message)||o.message||"Failed to create subtask")}},moveTask:async(e,a)=>{var t,s,r;try{const t=await l.patch(`${c}/${e}/move`,{parent_id:a});if(t.data.success)return t.data.data;throw new Error(t.data.message||"Failed to move task")}catch(o){if(console.error("Error moving task:",o),422===(null==(t=o.response)?void 0:t.status)){const e=o.response.data.errors,a=Object.values(e).flat().join(", ");throw new Error(a)}throw new Error((null==(r=null==(s=o.response)?void 0:s.data)?void 0:r.message)||o.message||"Failed to move task")}},reorderTasks:async(e,a)=>{var t,s;try{const t=await l.post(`${c}/reorder`,{parent_id:e,task_ids:a});if(t.data.success)return!0;throw new Error(t.data.message||"Failed to reorder tasks")}catch(r){throw console.error("Error reordering tasks:",r),new Error((null==(s=null==(t=r.response)?void 0:t.data)?void 0:s.message)||r.message||"Failed to reorder tasks")}},getSubtasks:async e=>{var a,t;try{const a=await l.get(`${c}/${e}/subtasks`);if(a.data.success)return a.data.data;throw new Error(a.data.message||"Failed to fetch subtasks")}catch(s){throw console.error("Error fetching subtasks:",s),new Error((null==(t=null==(a=s.response)?void 0:a.data)?void 0:t.message)||s.message||"Failed to fetch subtasks")}},resetFilters:()=>{s.status="",s.priority="",s.search="",s.sort_by="created_at",s.sort_direction="desc",s.page=1,s.per_page=10},getStatusOptions:()=>[{value:"",label:"All Statuses"},{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"}],getPriorityOptions:()=>[{value:"",label:"All Priorities"},{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"}],getStatusBadgeClass:e=>({pending:"bg-yellow-100 text-yellow-800 border-yellow-200",in_progress:"bg-blue-100 text-blue-800 border-blue-200",completed:"bg-green-100 text-green-800 border-green-200"}[e]||"bg-gray-100 text-gray-800 border-gray-200"),getPriorityBadgeClass:e=>({low:"bg-gray-100 text-gray-800 border-gray-200",medium:"bg-orange-100 text-orange-800 border-orange-200",high:"bg-red-100 text-red-800 border-red-200"}[e]||"bg-gray-100 text-gray-800 border-gray-200"),formatDate:e=>{if(!e)return"No due date";const a=new Date(e),t=new Date,s=new Date(t);if(s.setDate(s.getDate()+1),a.toDateString()===t.toDateString())return"Today";if(a.toDateString()===s.toDateString())return"Tomorrow";if(a<t){const e=Math.abs(t-a),s=Math.ceil(e/864e5);return`${s} day${s>1?"s":""} overdue`}return a.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},showNotification:d}}(),R=r(!1),J=r(!1),Q=r(!1),W=r(null),X=r(null),Y=r(!1),Z=o({show:!1,message:"",type:"success"}),q=e=>{Object.assign(U,e),A()},G=()=>{I.value="tree"===I.value?"flat":"tree",A()},K=e=>{U.page=e,A()},ee=e=>{U.per_page=e,U.page=1,A()},ae=e=>{W.value={...e},J.value=!0},te=e=>{X.value=e,Q.value=!0},se=async e=>{try{J.value?(await N(W.value.id,e),V("Task updated successfully","success")):re.value?(await H(re.value.id,e),V("Subtask created successfully","success")):(await z(e),V("Task created successfully","success")),ue(),A()}catch(a){V(a.message||"Operation failed","error")}},re=r(null),oe=e=>{re.value=e,R.value=!0},le=async e=>{try{await L(e.task.id,e.newParentId),V("Task moved successfully","success"),A()}catch(a){V(a.message||"Failed to move task","error")}},ne=async e=>{try{await N(e.task.id,{status:e.status}),V("Status updated successfully","success"),A()}catch(a){V(a.message||"Failed to update status","error")}},ie=async e=>{try{await N(e.task.id,{priority:e.priority}),V("Priority updated successfully","success"),A()}catch(a){V(a.message||"Failed to update priority","error")}},de=async e=>{try{const{task:a,field:t,value:s}=e,r={[t]:s};console.log("Inline update:",{task:a.id,field:t,value:s,updatePayload:r}),await N(a.id,r);V(`${{title:"Title",description:"Description",due_date:"Due date"}[t]||"Field"} updated successfully`,"success"),A()}catch(a){console.error("Inline update error:",a),V(a.message||"Failed to update task","error")}},ce=async()=>{if(X.value){Y.value=!0;try{await B(X.value.id),V("Task deleted successfully","success"),Q.value=!1,A()}catch(e){V(e.message||"Delete failed","error")}finally{Y.value=!1,X.value=null}}},ue=()=>{R.value=!1,J.value=!1,W.value=null,re.value=null};return V.subscribe((e,a)=>{Z.message=e,Z.type=a,Z.show=!0,setTimeout(()=>{Z.show=!1},3e3)}),n(()=>{A()}),(r,o)=>{var l;const n=i("Head");return c(),d("div",x,[u(n,{title:"MyProject Tasks"}),g("div",E,[g("div",T,[o[5]||(o[5]=g("div",null,[g("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"MyProject Tasks"),g("p",{class:"text-gray-600 dark:text-gray-300 mt-1"},"Manage your project tasks efficiently")],-1)),g("button",{onClick:o[0]||(o[0]=e=>R.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors"},o[4]||(o[4]=[g("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[g("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),v(" Add Task ")]))])]),g("div",j,[u(t,{filters:w(U),"onUpdate:filters":[o[1]||(o[1]=e=>m(U)?U.value=e:null),q],class:"mb-6"},null,8,["filters"]),g("div",_,[w(C)?(c(),d("div",F,o[6]||(o[6]=[g("div",{class:"h-full w-1/3 bg-blue-600 animate-pulse"},null,-1)]))):p("",!0)]),u(e,{tasks:w(M),loading:w(C),"view-mode":w(I),onEdit:ae,onDelete:te,onAddSubtask:oe,onMoveTask:le,onUpdateStatus:ne,onUpdatePriority:ie,onInlineUpdate:de,onToggleViewMode:G,class:k(["mb-6",{"opacity-60 pointer-events-none":w(C)}])},null,8,["tasks","loading","view-mode","class"]),w(O).total>0?(c(),y(s,{key:0,pagination:w(O),"onUpdate:page":K,"onUpdate:perPage":ee},null,8,["pagination"])):p("",!0)]),R.value||J.value?(c(),d("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:f(ue,["self"])},[u(a,{task:W.value,"is-editing":J.value,onSave:se,onCancel:ue,class:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},null,8,["task","is-editing"])])):p("",!0),Q.value?(c(),d("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:o[3]||(o[3]=f(e=>Q.value=!1,["self"]))},[g("div",D,[o[7]||(o[7]=g("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Confirm Delete",-1)),g("p",S,' Are you sure you want to delete the task "'+b(null==(l=X.value)?void 0:l.title)+'"? This action cannot be undone. ',1),g("div",$,[g("button",{onClick:o[2]||(o[2]=e=>Q.value=!1),class:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors"}," Cancel "),g("button",{onClick:ce,disabled:Y.value,class:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors disabled:opacity-50"},b(Y.value?"Deleting...":"Delete"),9,P)])])])):p("",!0),Z.show?(c(),d("div",{key:2,class:k(["fixed top-4 right-4 px-6 py-4 rounded-lg shadow-lg z-50 transition-all duration-300","success"===Z.type?"bg-green-500 text-white":"bg-red-500 text-white"])},b(Z.message),3)):p("",!0)])}}},[["__scopeId","data-v-7fd81731"]]);export{M as default};
