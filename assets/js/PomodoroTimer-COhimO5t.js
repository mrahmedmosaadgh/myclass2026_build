import{x as e,f as a,h as l,b as o,o as t,d as s}from"./app-CCwy2VVq.js";import{Q as u}from"./QCircularProgress-BESIVsJq.js";import{Q as n}from"./QSelect-DZElG_R-.js";import{f as r,a as d,A as v,I as i,J as c,K as m,b as p,O as k,R as f,V as y,N as b,F as h}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";const g={class:"text-h6"},x={class:"text-subtitle2"},S={class:"text-h3"},w={class:"row q-mt-md"},C={class:"row q-mt-md justify-center"},D={class:"text-center q-mb-md"},_={key:0},V={class:"text-h6"},j={key:1},T={class:"text-subtitle1"},$={__name:"PomodoroTimer",props:{tasks:{type:Array,default:()=>[]}},emits:["close","session-completed","enter-focus-mode"],setup($,{emit:q}){const I=$,M=q,F=e(),N=r(!1),P=r(!1),Q=r(!1),U=r(!1),A=r(0),B=r(25),R=r(5),E=r(null),W=r(""),z=r(null),J=r(null),K=r(null),O=r(null),G=r(0),H=d(()=>I.tasks.map(e=>({id:e.id,title:e.title}))),L=d(()=>E.value?I.tasks.find(e=>e.id===E.value):null),X=d(()=>{if(U.value){const e=60*R.value;return(e-A.value)/e*100}{const e=60*B.value;return(e-A.value)/e*100}}),Y=()=>{N.value=!0,P.value=!1,Q.value=!1,U.value=!1,A.value=60*B.value,K.value=Date.now(),G.value=0,F.fetchData({endpoint:"/developer/pomodoro/start",method:"post",data:{task_id:E.value,type:"work",duration:B.value},onSuccess:e=>{z.value=e.session,ee()}})},Z=()=>{N.value=!0,P.value=!1,Q.value=!1,U.value=!0,A.value=60*R.value,K.value=Date.now(),G.value=0,F.fetchData({endpoint:"/developer/pomodoro/start",method:"post",data:{task_id:null,type:"break",duration:R.value},onSuccess:e=>{z.value=e.session,ee()}})},ee=()=>{clearInterval(J.value),J.value=setInterval(()=>{P.value||(A.value--,A.value<=0&&te())},1e3)},ae=()=>{P.value=!0,O.value=Date.now()},le=()=>{P.value=!1,G.value+=Date.now()-O.value,O.value=null},oe=()=>{clearInterval(J.value),z.value&&F.fetchData({endpoint:`/developer/pomodoro/${z.value.id}/end`,method:"post",data:{notes:"Session interrupted by user",status:"interrupted"},onSuccess:()=>{M("session-completed")}}),se()},te=()=>{clearInterval(J.value),N.value=!1,re(),U.value?(U.value=!1,Q.value=!1,z.value&&F.fetchData({endpoint:`/developer/pomodoro/${z.value.id}/end`,method:"post",data:{notes:"Break completed",status:"completed"},onSuccess:()=>{M("session-completed"),z.value=null}})):Q.value=!0},se=()=>{clearInterval(J.value),N.value=!1,P.value=!1,Q.value=!1,U.value=!1,A.value=0,W.value="",z.value=null},ue=()=>{se(),M("close")},ne=e=>{const a=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},re=()=>{new Audio("/sounds/notification.mp3").play().catch(e=>console.error("Error playing sound:",e))},de=()=>{z.value&&F.fetchData({endpoint:`/developer/pomodoro/${z.value.id}/end`,method:"post",data:{notes:W.value||"Need more time to complete",status:"extended"},onSuccess:()=>{M("session-completed"),Y()}})},ve=()=>{z.value&&F.fetchData({endpoint:`/developer/pomodoro/${z.value.id}/end`,method:"post",data:{notes:W.value||"Task completed",status:"completed"},onSuccess:()=>{M("session-completed"),E.value?F.fetchData({endpoint:`/developer/tasks/${E.value}/toggle-complete`,method:"post",onSuccess:()=>{Z()}}):Z()}})},ie=()=>{z.value&&F.fetchData({endpoint:`/developer/pomodoro/${z.value.id}/end`,method:"post",data:{notes:W.value||"Taking a longer break",status:"completed"},onSuccess:()=>{M("session-completed"),R.value=2*R.value,Z()}})},ce=()=>{console.log("Entering Focus Mode with task:",L.value),console.log("Current session:",z.value),M("enter-focus-mode",L.value,z.value),M("close")};return v(()=>{clearInterval(J.value)}),(e,r)=>(c(),i(s,{style:{width:"400px","max-width":"90vw"}},{default:m(()=>[p(a,{class:"text-center"},{default:m(()=>[f("div",g,y(U.value?"Break Time":"Pomodoro Timer"),1),f("div",x,y(U.value?"Relax and recharge":"Stay focused and productive"),1)]),_:1}),p(a,{class:"text-center"},{default:m(()=>[p(u,{value:X.value,size:"200px",thickness:.2,color:"primary","track-color":"grey-3",class:"q-ma-md"},{default:m(()=>[f("div",S,y(ne(A.value)),1)]),_:1},8,["value"])]),_:1}),U.value||N.value||Q.value?k("",!0):(c(),i(a,{key:0},{default:m(()=>[p(n,{modelValue:E.value,"onUpdate:modelValue":r[0]||(r[0]=e=>E.value=e),options:H.value,label:"Select Task","option-value":"id","option-label":"title","emit-value":"","map-options":"",clearable:""},null,8,["modelValue","options"]),f("div",w,[p(l,{modelValue:B.value,"onUpdate:modelValue":r[1]||(r[1]=e=>B.value=e),modelModifiers:{number:!0},type:"number",label:"Duration (minutes)",min:"1",max:"60",class:"col-6 q-pr-sm"},null,8,["modelValue"]),p(l,{modelValue:R.value,"onUpdate:modelValue":r[2]||(r[2]=e=>R.value=e),modelModifiers:{number:!0},type:"number",label:"Break (minutes)",min:"1",max:"30",class:"col-6 q-pl-sm"},null,8,["modelValue"])])]),_:1})),Q.value?(c(),i(a,{key:1},{default:m(()=>[r[4]||(r[4]=f("div",{class:"text-h6 text-center q-mb-md"},"Session Completed!",-1)),p(l,{modelValue:W.value,"onUpdate:modelValue":r[3]||(r[3]=e=>W.value=e),type:"textarea",label:"What did you accomplish?",rows:"3"},null,8,["modelValue"]),f("div",C,[p(o,{flat:"",color:"grey",label:"Need more time",onClick:de}),p(o,{flat:"",color:"positive",label:"Task completed",onClick:ve}),p(o,{flat:"",color:"primary",label:"Take a longer break",onClick:ie})])]),_:1})):k("",!0),N.value?(c(),i(a,{key:2},{default:m(()=>[f("div",D,[L.value?(c(),b("div",_,[r[5]||(r[5]=f("div",{class:"text-subtitle1"},"Working on:",-1)),f("div",V,y(L.value.title),1)])):(c(),b("div",j,[f("div",T,y(U.value?"Taking a break":"Focus session"),1)]))])]),_:1})):k("",!0),p(t,{align:"center"},{default:m(()=>[N.value||Q.value?k("",!0):(c(),i(o,{key:0,color:"primary",label:"Start",icon:"play_arrow",onClick:Y})),N.value?(c(),b(h,{key:1},[p(o,{color:"negative",label:"Stop",icon:"stop",onClick:oe}),P.value?(c(),i(o,{key:1,color:"primary",label:"Resume",icon:"play_arrow",onClick:le})):(c(),i(o,{key:0,color:"grey",label:"Pause",icon:"pause",onClick:ae})),p(o,{color:"primary",flat:"",label:"Focus Mode",icon:"fullscreen",onClick:ce})],64)):k("",!0),Q.value?(c(),i(o,{key:2,color:"primary",label:"Start New Session",icon:"refresh",onClick:se})):k("",!0),N.value?k("",!0):(c(),i(o,{key:3,flat:"",label:"Close",color:"grey",onClick:ue}))]),_:1})]),_:1}))}};export{$ as default};
