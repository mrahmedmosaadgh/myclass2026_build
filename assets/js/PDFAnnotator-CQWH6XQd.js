import{Y as e}from"./index-QkJSbngE.js";import a from"./html2canvas.esm-Cq3pa7K9.js";import{E as l}from"./jspdf.es.min-BZKw8HNe.js";import{o as t}from"./app-CqJgtQaN.js";import{f as o,k as n,n as u,o as s,e as i,M as v,J as r,N as c,U as d,F as p,R as m,S as h,Q as g,V as b,I as f,z as k}from"./vendor-DuKqz2x4.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";const y={class:"pdf-annotator-app"},C={key:0,class:"upload-area"},w={class:"upload-box"},P={key:1,class:"viewer-area"},x={class:"toolbar"},L={class:"toolbar-group"},R={class:"toolbar-group colors-group"},W=["onClick","title"],E={key:0,class:"check"},j={class:"toolbar-group zoom-controls"},O=["disabled"],U={class:"zoom-display"},F=["disabled"],S={class:"toolbar-group quality-controls"},D={class:"nav-bar"},B=["disabled"],H=["disabled"],M=t({__name:"PDFAnnotator",setup(t){const M=o(""),_=o(1),T=o(1),$=o("pen"),q=o("black"),Q=o([{name:"Black",value:"black"},{name:"Red",value:"#e74c3c"},{name:"Blue",value:"#3498db"},{name:"Green",value:"#27ae60"},{name:"Yellow",value:"#f1c40f"},{name:"Orange",value:"#e67e22"},{name:"Purple",value:"#9b59b6"},{name:"Pink",value:"#e91e63"},{name:"Brown",value:"#795548"},{name:"Gray",value:"#95a5a6"}]),z=o({}),A=o(1),I=o("custom"),G=o(2),J=o(null),N=o(null),Y=o(null);let Z=null,V=!1,X=[];const K=e=>{const a=e.target.files[0];return a&&a.type.includes("pdf")?a.size>52428800?alert("File too big (max 50 MB)"):(M.value=URL.createObjectURL(a),_.value=1,T.value=1,void(z.value={})):alert("Please select a PDF file")},ee=e=>{T.value=e.numPages,console.log("PDF loaded with",T.value,"pages")},ae=async()=>{await u(),console.log("Page",_.value,"rendered"),le(),ie()},le=()=>{var e;const a=null==(e=N.value)?void 0:e.querySelector(".pdf-embed canvas");if(!a||!Y.value)return;const l=a.getBoundingClientRect();Y.value.width=l.width,Y.value.height=l.height,Y.value.style.width=`${l.width}px`,Y.value.style.height=`${l.height}px`,Z=Y.value.getContext("2d",{willReadFrequently:!0}),Z.lineWidth=3,Z.lineCap="round",Z.lineJoin="round";const t=Y.value;t.onmousedown=t.ontouchstart=null,t.addEventListener("mousedown",ne),t.addEventListener("mousemove",ue),t.addEventListener("mouseup",se),t.addEventListener("mouseout",se),t.addEventListener("touchstart",e=>{e.preventDefault(),ne(e.touches[0])},{passive:!1}),t.addEventListener("touchmove",e=>{e.preventDefault(),ue(e.touches[0])},{passive:!1}),t.addEventListener("touchend",se),ie()},te=e=>{$.value=e,Y.value&&(Y.value.style.cursor="crosshair")},oe=e=>{const a=Y.value.getBoundingClientRect();return{x:(e.clientX-a.left)/A.value,y:(e.clientY-a.top)/A.value}},ne=e=>{V=!0;const{x:a,y:l}=oe(e);X=[{x:a,y:l}],z.value[_.value]||(z.value[_.value]=[]),"eraser"===$.value?z.value[_.value].push({tool:"eraser",color:"white",points:X,lineWidth:20}):z.value[_.value].push({tool:"pen",color:q.value,points:X,lineWidth:3})},ue=e=>{if(!V||!Z||0===X.length)return;const{x:a,y:l}=oe(e);X.push({x:a,y:l}),"eraser"===$.value?(Z.globalCompositeOperation="destination-out",Z.strokeStyle="rgba(0,0,0,1)",Z.lineWidth=20):(Z.globalCompositeOperation="source-over",Z.strokeStyle=q.value,Z.lineWidth=3),Z.beginPath(),Z.moveTo(X[X.length-2].x,X[X.length-2].y),Z.lineTo(a,l),Z.stroke()},se=()=>{V=!1},ie=()=>{if(!Z||!Y.value)return;Z.clearRect(0,0,Y.value.width,Y.value.height);(z.value[_.value]||[]).forEach(e=>{"eraser"===e.tool?(Z.globalCompositeOperation="destination-out",Z.strokeStyle="rgba(0,0,0,1)",Z.lineWidth=e.lineWidth||20):(Z.globalCompositeOperation="source-over",Z.strokeStyle=e.color,Z.lineWidth=e.lineWidth||3),Z.beginPath(),e.points.forEach((e,a)=>0===a?Z.moveTo(e.x,e.y):Z.lineTo(e.x,e.y)),Z.stroke()}),Z.globalCompositeOperation="source-over"},ve=()=>{var e;(null==(e=z.value[_.value])?void 0:e.length)&&(z.value[_.value].pop(),ie())},re=()=>{z.value[_.value]=[],ie()},ce=()=>{_.value>1&&_.value--},de=()=>{_.value<T.value&&_.value++},pe=()=>{A.value<3&&(A.value=Math.min(3,A.value+.25),I.value="custom")},me=()=>{A.value>.5&&(A.value=Math.max(.5,A.value-.25),I.value="custom")},he=()=>{A.value=1,I.value="custom"},ge=async()=>{await u();const e=J.value,a=N.value;if(!e||!a)return;const l=e.clientWidth-40,t=a.scrollWidth/A.value;A.value=l/t,I.value="fitWidth"},be=async()=>{await u();const e=J.value,a=N.value;if(!e||!a)return;const l=e.clientHeight-40,t=a.scrollHeight/A.value;A.value=l/t,I.value="fitHeight"},fe=async()=>{const e=await a(N.value,{scale:2,useCORS:!0}),l=document.createElement("a");l.download=`page-${_.value}.png`,l.href=e.toDataURL(),l.click()},ke=async()=>{const e=new l,t=_.value;for(let l=1;l<=T.value;l++){_.value=l,await u(),await new Promise(e=>setTimeout(e,400));const t=(await a(N.value,{scale:2,useCORS:!0,backgroundColor:"#ffffff",onclone:e=>{e.querySelectorAll("*").forEach(e=>{var a,l;const t=e.style;(null==(a=t.background)?void 0:a.includes("oklch"))&&(t.background="#ffffff"),(null==(l=t.color)?void 0:l.includes("oklch"))&&(t.color="#000000")})}})).toDataURL("image/jpeg",.95);l>1&&e.addPage(),e.addImage(t,"JPEG",0,0,210,297)}e.save("annotated-document.pdf"),_.value=t},ye=()=>{M.value&&URL.revokeObjectURL(M.value),M.value="",_.value=1,z.value={}};return n(_,async()=>{await u(),le()}),s(()=>{console.log("PDFAnnotator mounted")}),i(()=>{M.value&&URL.revokeObjectURL(M.value)}),(a,l)=>(r(),v("div",y,[M.value?(r(),v("div",P,[c("div",x,[c("div",L,[l[8]||(l[8]=c("span",{class:"tool-label"},"Tools:",-1)),c("button",{onClick:l[0]||(l[0]=e=>te("pen")),class:d({active:"pen"===$.value}),title:"Pen"},"âœï¸ Pen",2),c("button",{onClick:l[1]||(l[1]=e=>te("eraser")),class:d({active:"eraser"===$.value}),title:"Eraser"},"ðŸ§¹ Eraser",2),c("button",{onClick:ve,title:"Undo"},"â†¶ Undo"),c("button",{onClick:re,title:"Clear Page"},"ðŸ—‘ï¸ Clear")]),c("div",R,[l[9]||(l[9]=c("span",{class:"tool-label"},"Colors:",-1)),(r(!0),v(p,null,m(Q.value,e=>(r(),v("button",{key:e.value,onClick:a=>q.value=e.value,class:d([{active:q.value===e.value&&"pen"===$.value},"color-btn"]),style:h({background:e.value,border:"2px solid "+(q.value===e.value&&"pen"===$.value?"#fff":"#666")}),title:e.name},[q.value===e.value&&"pen"===$.value?(r(),v("span",E,"âœ“")):g("",!0)],14,W))),128))]),c("div",j,[c("button",{onClick:me,disabled:A.value<=.5,title:"Zoom Out"},"ðŸ”-",8,O),c("span",U,b(Math.round(100*A.value))+"%",1),c("button",{onClick:pe,disabled:A.value>=3,title:"Zoom In"},"ðŸ”+",8,F),c("button",{onClick:ge,title:"Fit Width"},"â†”ï¸ Width"),c("button",{onClick:be,title:"Fit Height"},"â†•ï¸ Height"),c("button",{onClick:he,title:"Reset Zoom"},"âŠ¡ 100%")]),c("div",S,[l[10]||(l[10]=c("span",{class:"quality-label"},"Quality:",-1)),c("button",{onClick:l[2]||(l[2]=e=>G.value=1),class:d({active:1===G.value}),title:"Low Quality"},"Low",2),c("button",{onClick:l[3]||(l[3]=e=>G.value=2),class:d({active:2===G.value}),title:"High Quality"},"High",2),c("button",{onClick:l[4]||(l[4]=e=>G.value=3),class:d({active:3===G.value}),title:"Ultra Quality"},"Ultra",2)]),c("div",{class:"toolbar-group"},[c("button",{onClick:fe},"Save Page"),c("button",{onClick:ke,class:"save-all"},"Save All Pages"),c("button",{onClick:ye,class:"reset"},"New PDF")])]),c("div",D,[c("button",{onClick:ce,disabled:_.value<=1},"Previous",8,B),c("span",null,"Page "+b(_.value)+" of "+b(T.value),1),c("button",{onClick:de,disabled:_.value>=T.value},"Next",8,H)]),c("div",{class:"page-wrapper",ref_key:"pageWrapper",ref:J},[c("div",{class:"page-container",ref_key:"pageContainer",ref:N,style:h({transform:`scale(${A.value})`,transformOrigin:"top center"})},[(r(),f(k(e),{key:`page-${_.value}`,source:M.value,page:_.value,width:1200,scale:G.value,onLoaded:ee,onRendered:ae,class:"pdf-embed"},null,8,["source","page","scale"])),(r(),v("canvas",{ref_key:"drawCanvas",ref:Y,class:"draw-canvas",key:`canvas-${_.value}`}))],4)],512)])):(r(),v("div",C,[c("label",w,[c("input",{type:"file",accept:".pdf",onChange:K,hidden:""},null,32),l[5]||(l[5]=c("div",{class:"icon"},"ðŸ“„",-1)),l[6]||(l[6]=c("p",null,"Click or drop a PDF file here",-1)),l[7]||(l[7]=c("small",null,"Maximum 50 MB",-1))])]))]))}},[["__scopeId","data-v-bb184d2e"]]);export{M as default};
