import{o as e,u as t,c as a,Q as l,p as s,d as n,a as o,n as i,f as r,m as d,l as c,b as u,aP as m,A as v,C as g}from"./app-DOc39CFu.js";import{Q as p}from"./QSelect-Dkiz84LX.js";import{Q as f}from"./QBadge-Dz6oAuer.js";import{Q as y}from"./QTable-BjpIccaO.js";import{Q as h}from"./QBtnToggle-CdtgOgxF.js";import{Q as b}from"./QSpinnerHourglass-CCDwREQA.js";import{Q as w}from"./QImg-BP8yf14T.js";import{Q as _}from"./QLinearProgress-DkNjmMsH.js";import S from"./CameraCapture-CQE19Gei.js";import x from"./PeriodSelectionRefactored-ByY4MwrP.js";import k from"./StudentCard-Bht8mnxp.js";import{f as E,e as I,k as C,a as A,o as z,_ as $,n as j,M as V,J as O,b as N,N as D,K as T,Q as U,U as R,W as F,V as M,I as P,z as J,F as Q,R as B,y as L}from"./vendor-DuKqz2x4.js";import W from"./BehaviorManager-CZwV1QM6.js";import{r as q}from"./reward_sys_point_action-CqMZi24d.js";import{u as H}from"./i18n-DE5KxGn8.js";import"./offline-BzIlwqNM.js";import"./ui-BITzTqrO.js";import"./rtl-Cr6c3OOr.js";import"./QMarkupTable-37_xwH2D.js";import"./use-fullscreen-BV7570VS.js";import"./AvatarManager-B3prL2tS.js";import"./QTab-Dldfuhzv.js";import"./QTabs-CQbEg8iR.js";import"./QTabPanel-C5l4w7rK.js";import"./use-panel-Ddka6S_L.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-D4WV1jNy.js";const K={class:"p-6 space-y-6"},G={class:"control-panel"},Y={class:"flex flex-col gap-4"},X={class:"flex flex-row justify-center gap-4"},Z={key:0,class:"p-2 flex items-center justify-center"},ee={class:"p-4 mb-4 flex gap-4 items-center justify-center"},te={class:"p-2 flex flex-col gap-4 items-stretch m-auto"},ae={class:"flex items-center justify-between bg-white rounded-lg p-3 border border-blue-100 shadow-sm"},le={class:"flex items-center gap-3"},se={class:"flex items-center gap-2"},ne={class:"flex flex-wrap justify-center gap-2w-full"},oe={key:0,class:"text-gray-500 text-center"},ie={key:1},re={class:"mb-4 font-semibold"},de={class:"font-semibold mb-2"},ce={class:"text-h6"},ue={class:"header-content"},me={class:"selector-content"},ve={key:0,class:"loading-state"},ge={key:1,class:"empty-state"},pe={key:2,class:"leaderboard-list"},fe={key:0,class:"podium-section"},ye={class:"podium"},he={key:0,class:"podium-position second-place"},be={class:"podium-student"},we={class:"student-avatar-large"},_e={class:"student-name"},Se={class:"student-points silver-points"},xe={key:1,class:"podium-position first-place"},ke={class:"podium-student"},Ee={class:"student-avatar-large"},Ie={class:"student-name champion"},Ce={class:"student-points gold-points"},Ae={key:2,class:"podium-position third-place"},ze={class:"podium-student"},$e={class:"student-avatar-large"},je={class:"student-name"},Ve={class:"student-points bronze-points"},Oe={key:1,class:"remaining-students"},Ne={class:"row-position"},De={class:"row-avatar"},Te={class:"row-info"},Ue={class:"row-name"},Re={class:"row-points"},Fe={class:"row-badge"},Me={key:2,class:"recognition-section"},Pe={class:"recognition-cards"},Je={key:0,class:"recognition-card"},Qe={class:"card-name"},Be={key:1,class:"recognition-card"},Le={class:"card-name"},We={key:2,class:"recognition-card"},qe={class:"card-name"},He={class:"footer-content"},Ke={class:"text-h6 flex items-center gap-2"},Ge={class:"text-subtitle1 mb-3 font-semibold flex items-center gap-2"},Ye={class:"settings-toggle-container enhanced-toggle-container"},Xe={class:"toggle-status-indicator enhanced-status-indicator"},Ze={class:"text-caption text-grey-6 ml-8 mt-2"},et={class:"text-subtitle1 mb-3 font-semibold flex items-center gap-2"},tt={class:"settings-toggle-container enhanced-toggle-container"},at={class:"toggle-status-indicator enhanced-status-indicator"},lt={class:"text-caption text-grey-6 ml-8 mt-2"},st={class:"attendance-list max-h-80 overflow-y-auto"},nt={class:"flex items-center gap-3"},ot={class:"relative attendance-avatar-container"},it={class:"absolute -top-1 -right-1 attendance-status-badge"},rt={class:"student-info"},dt={class:"flex items-center gap-3"},ct={class:"flex gap-2 mt-4 pt-4 border-t border-grey-3"},ut={class:"mt-3 p-3 bg-grey-1 rounded-lg attendance-summary"},mt={class:"flex items-center justify-between text-sm"},vt={class:"flex items-center gap-2"},gt={class:"flex items-center gap-4"},pt={class:"flex items-center gap-1"},ft={class:"text-positive font-medium"},yt={class:"flex items-center gap-1"},ht={class:"text-negative font-medium"},bt={class:"mt-2"},wt={class:"text-center text-grey-6 py-8"},_t="reward-system-last-selection",St=e({__name:"reward_sys copy",setup(e){const St=()=>{aa.value=!1},xt=async({dataUrl:e})=>{if(!ta.value||!e)return;const t=function(e){const t=e.split(","),a=t[0].match(/:(.*?);/)[1],l=atob(t[1]),s=l.length,n=new Uint8Array(s);for(let o=0;o<s;o++)n[o]=l.charCodeAt(o);return new Blob([n],{type:a})}(e);await ua(ta.value.id,t,"capture.png"),aa.value=!1},{notsafe_t:kt}=H(),Et=e=>{if(!e||"string"!=typeof e)return e||"";try{return kt(e)}catch(t){return e}},It=t(),Ct=E(""),At=E("");E("neon-text");const zt=E(!1),$t=()=>(new Date).toISOString().split("T")[0],jt=E($t()),Vt=E("Math"),Ot=E(null),Nt=E(null),Dt=E(null),Tt=E(null),Ut=E(""),Rt=E([]);function Ft(){try{const e={date:jt.value,subject:Vt.value,semester:Ot.value,week:Nt.value,day:Dt.value,periodNumber:Tt.value,classroomId:Ct.value||ja.value.currentClassroomId||null,classroomName:Ut.value||null,period_code:At.value||null};return localStorage.setItem(_t,JSON.stringify(e)),!0}catch(e){return console.warn("saveLastSelection failed",e),!1}}Array.from({length:4},(e,t)=>({label:`Semester ${t+1}`,value:t+1})),Array.from({length:16},(e,t)=>({label:`Week ${t+1}`,value:t+1})),Array.from({length:7},(e,t)=>({label:`Day ${t+1}`,value:t+1})),Array.from({length:8},(e,t)=>({label:`Period ${t+1}`,value:t+1})),E(["P-01","P-02","P-03","P-04"]),I(()=>{Ft()}),E({classes:[],subjects:[],my_classes:[],my_subjects:[],teacher:null,teacher_classes:[]});const Mt=E([]),Pt=E([{name:"key",label:"Field",field:"key",align:"left",sortable:!0},{name:"label",label:"Label",field:"label",align:"left",sortable:!0},{name:"type",label:"Type",field:"type",align:"left",sortable:!0},{name:"visible",label:"Visible",field:"visible",align:"center"}]),Jt=E(""),Qt=E(!1),Bt=()=>{try{const e=JSON.parse(Jt.value);if(Rt.value=Array.isArray(e)?e:[e],Rt.value.length>0){const e=Rt.value[0];Mt.value=Object.keys(e).map(e=>({key:e,label:e,type:"text",visible:!0}))}Qt.value=!1,It.notify({type:"positive",message:"JSON Loaded"})}catch(e){console.error("JSON parsing error:",e),It.notify({type:"negative",message:"Invalid JSON format"})}},Lt=()=>{try{const e=Jt.value.split("\n").filter(e=>""!==e.trim());e.length>0&&(Rt.value=e.map(e=>({value:e})),Mt.value=[{key:"value",label:"Value",type:"text",visible:!0}]),Qt.value=!1,It.notify({type:"positive",message:"Text Loaded"})}catch(e){console.error("Text loading error:",e),It.notify({type:"negative",message:"Failed to load text data"})}};E([{label:"LMS System",children:[{label:"Authentication"},{label:"Class Management"},{label:"Quiz System"},{label:"Behavior Points"},{label:"Weekly Plan"},{label:"Lesson Planner"}]}]);const Wt=E(!1),qt=E({name:null,id:null,f_l_name:""}),Ht=E({}),Kt=E(!1),Gt=E([]),Yt=E(!1),Xt=E("week"),Zt=E(!1),ea=E(null),ta=E(null),aa=E(!1),la=E(null);E(null);const sa=E(null),na=E(!1),oa=E(!1),ia=e=>{try{if(e){const t=e.split(" ").map(e=>e[0]||"").slice(0,2).join("").toUpperCase(),a=`<svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 96 96">\n        <rect width="96" height="96" fill="${"#e2e8f0"}" rx="48" ry="48"/>\n        <text x="48" y="48" dy="8" text-anchor="middle" font-family="Arial" font-size="32" font-weight="bold" fill="${"#475569"}">${t}</text>\n      </svg>`;return`data:image/svg+xml,${encodeURIComponent(a)}`}}catch(t){console.warn("Failed to generate avatar SVG:",t)}return"/images/avatars/default-avatar.svg"},ra=(e,t)=>{qt.value.id=e,qt.value.name=t,qt.value.f_l_name=za(t),Wt.value=!0,ma(e)},da=async e=>{var t;const a=e.target.files||(null==(t=e.dataTransfer)?void 0:t.files);if(!a||!a.length)return;const l=a[0];ta.value&&(await ua(ta.value.id,l),e.target.value="")},ca=async e=>{if(ja.value.avatarEditingEnabled){ta.value=e,aa.value=!0;try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});sa.value=e,la.value&&(la.value.srcObject=e,await la.value.play())}catch(t){console.warn("Camera open failed",t),It.notify({message:"Camera not available",color:"negative"}),aa.value=!1}}else It.notify({message:"Avatar editing is currently disabled",color:"warning",position:"top"})},ua=async(e,t,a=null)=>{var l,s;try{na.value=!0;const l=new FormData,s=t instanceof Blob?new File([t],a||"avatar.png",{type:t.type||"image/png"}):t;l.append("avatar",s),l.append("student_id",e);const n=await $.post(`/api/students/${e}/avatar`,l,{headers:{"Content-Type":"multipart/form-data"}});It.notify({message:"Avatar uploaded",color:"positive"});const o=(ya.value.my_sel_classroom_students||[]).find(t=>t.id===e);o&&(o.avatar=n.data.avatar||n.data.url||o.avatar||null)}catch(n){console.error("avatar upload failed",n),It.notify({message:(null==(s=null==(l=n.response)?void 0:l.data)?void 0:s.message)||"Avatar upload failed",color:"negative"})}finally{na.value=!1}},ma=async e=>{if(e)try{const t=await $.get(`/api/student-behaviors/${e}`);Ht.value[e]=t.data}catch(t){console.warn("Failed to load student summary",t),Ht.value[e]={positive:0,negative:0,total:0}}},va=async()=>{var e;if(null==(e=ya.value.my_sel_classroom_students)?void 0:e.length){oa.value=!0;try{const e=ya.value.my_sel_classroom_students,t=e.map(e=>ma(e.id));await Promise.all(t),It.notify({message:`Successfully loaded summaries for ${e.length} students!`,color:"positive",position:"top",icon:"assessment"})}catch(t){console.error("Failed to load all student summaries:",t),It.notify({message:"Failed to load some student summaries",color:"negative",position:"top"})}finally{oa.value=!1}}else It.notify({message:"No students found in selected classroom!",color:"warning",position:"top"})},ga=async()=>{var e;(null==(e=qt.value)?void 0:e.id)&&(await ma(qt.value.id),Kt.value&&await pa())},pa=async()=>{var e;if(null==(e=ya.value.my_sel_classroom_students)?void 0:e.length){Yt.value=!0;try{const e=Ct.value,t=new Date;let a=new Date;switch(Xt.value){case"week":const e=t.getDay(),l=0===e?6:e-1;a.setDate(t.getDate()-l),a.setHours(0,0,0,0);break;case"month":a=new Date(t.getFullYear(),t.getMonth(),1);break;case"all":const s=t.getFullYear(),n=t.getMonth()>=8?s:s-1;a=new Date(n,8,1)}const l=(await $.get("/api/leaderboard",{params:{classroom_id:e,start_date:a.toISOString().split("T")[0],end_date:t.toISOString().split("T")[0],limit:5}})).data.map(e=>{const t=ya.value.my_sel_classroom_students.find(t=>t.id===e.student_id);return{...e,name:(null==t?void 0:t.name)||"Unknown Student",avatar:(null==t?void 0:t.avatar)||null,first_name:(null==t?void 0:t.first_name)||"",last_name:(null==t?void 0:t.last_name)||""}}).filter(e=>e.total>0);Gt.value=l,l.length>0&&fa()}catch(t){console.error("Failed to load leaderboard:",t);const e=Object.entries(Ht.value).map(([e,t])=>{var a;const l=null==(a=ya.value.my_sel_classroom_students)?void 0:a.find(t=>t.id==e);return{student_id:parseInt(e),name:(null==l?void 0:l.name)||"Unknown Student",avatar:(null==l?void 0:l.avatar)||null,first_name:(null==l?void 0:l.first_name)||"",last_name:(null==l?void 0:l.last_name)||"",total:t.total||0,positive:t.positive||0,negative:t.negative||0}}).filter(e=>e.total>0).sort((e,t)=>t.total-e.total).slice(0,5);Gt.value=e,0===e.length&&It.notify({message:"No student data available yet. Start recording some behaviors!",color:"info",position:"top"})}finally{Yt.value=!1}}else It.notify({message:"Please select a classroom first!",color:"warning",position:"top"})},fa=()=>{try{const e=new(window.AudioContext||window.webkitAudioContext),t=(t,a,l)=>{const s=e.createOscillator(),n=e.createGain();s.connect(n),n.connect(e.destination),s.frequency.setValueAtTime(t,a),s.type="triangle",n.gain.setValueAtTime(0,a),n.gain.linearRampToValueAtTime(.3,a+.01),n.gain.exponentialRampToValueAtTime(.01,a+l),s.start(a),s.stop(a+l)},a=e.currentTime;t(523.25,a,.3),t(659.25,a+.15,.3),t(783.99,a+.3,.3),t(1046.5,a+.45,.5)}catch(e){console.log("Audio not available")}},ya=E({my_sel_classroom_students:[],my_classes_with_students:[],classes:[],subjects:[]}),ha=E(localStorage.getItem("studentViewPreference")||"card");C(ha,e=>{try{localStorage.setItem("studentViewPreference",e)}catch(t){}}),E({sortBy:"name",descending:!1,page:1,rowsPerPage:10}),E([{name:"name",label:"Name",field:"name",sortable:!0},{name:"id",label:"ID",field:"id",sortable:!0},{name:"classroom",label:"Class",field:"class",sortable:!0},{name:"points",label:"Points",field:"points",sortable:!0},{name:"status",label:"Status",field:"status",sortable:!0},{name:"attend",label:"Attendance",field:"attend",sortable:!0,align:"center"}]),E(""),E(!1);const ba=E(null);let wa=E([]),_a=E(!1),Sa=null;function xa(){return Sa||(Sa=function({settingsRef:e,selDateRef:t,periodCodeRef:a,loadStudentSummary:l=null,notify:s=null,applyBehaviorApi:n=null,selectedIdsRef:o=null,applyingBehaviorRef:i=null}={}){const r=o||E([]),d=i||E(!1);return{selectedIds:r,applyingBehavior:d,toggleSelected:function(e){if(null==e)return;const t=r.value.findIndex(t=>t===e);-1===t?r.value.push(e):r.value.splice(t,1)},clearSelection:function(){r.value=[]},markSelectedPresent:function(){var t;if(r.value.length)try{r.value.forEach(t=>{e&&e.value&&"object"==typeof e.value.attendance&&(e.value.attendance[t]=!0)}),"function"==typeof(null==(t=null==e?void 0:e.value)?void 0:t.save)&&e.value.save(),s&&s({message:`Marked ${r.value.length} students present`,color:"positive",position:"top"})}catch(a){s&&s({message:"Failed to mark present",color:"negative",position:"top"})}},markSelectedAbsent:function(){var t;if(r.value.length)try{r.value.forEach(t=>{e&&e.value&&"object"==typeof e.value.attendance&&(e.value.attendance[t]=!1)}),"function"==typeof(null==(t=null==e?void 0:e.value)?void 0:t.save)&&e.value.save(),s&&s({message:`Marked ${r.value.length} students absent`,color:"warning",position:"top"})}catch(a){s&&s({message:"Failed to mark absent",color:"negative",position:"top"})}},applyBehaviorToSelected:async function(e,o={}){if(!r.value.length||!e)return{success:!1,message:"Nothing to apply"};if(!n)return s&&s({message:"Apply API not configured",color:"negative",position:"top"}),{success:!1,message:"API not configured"};d.value=!0;const i={date:(null==t?void 0:t.value)||o.date||(new Date).toISOString().split("T")[0],periodCode:(null==a?void 0:a.value)||o.periodCode||null,notes:o.notes||null};try{const t=await n(r.value,e,i);if(l){const e=r.value.map(e=>l(e));await Promise.all(e)}return s&&s({message:(null==t?void 0:t.message)||"Behavior applied",color:(null==t?void 0:t.success)?"positive":"warning",position:"top"}),t}catch(c){return s&&s({message:"Failed to apply behavior",color:"negative",position:"top"}),{success:!1,error:c}}finally{d.value=!1}}}}({settingsRef:ja,selDateRef:jt,periodCodeRef:At,loadStudentSummary:ma,notify:e=>It.notify(e),applyBehaviorApi:async(e,t,a)=>q.applyBehaviorToStudents(e,t,{date:a.date,periodCode:a.periodCode,notes:a.notes,classroomId:Ct.value||null,subjectId:Vt.value||null}),selectedIdsRef:wa,applyingBehaviorRef:_a}),Sa)}function ka(e){return xa(),Sa.toggleSelected(e)}function Ea(){return xa(),Sa.clearSelection()}function Ia(){return xa(),Sa.markSelectedPresent()}function Ca(){return xa(),Sa.markSelectedAbsent()}async function Aa(){if(wa.value.length&&ba.value)return xa(),Sa.applyBehaviorToSelected(ba.value)}const za=e=>{if(!e||"string"!=typeof e)return{firstName:null,lastName:null};const t=e.trim().split(/\s+/);if(0===t.length)return{firstName:null,lastName:null};const a=t[0];let l=null;return t.length>1&&(l=t[t.length-1]),a+" "+l};!async function(e,t,a=null){try{const l=await $.get(e,{params:a});return ya.value||(ya.value={}),ya.value[t]=l.data,l.data}catch(l){return console.error("fetchDataGet failed",l),null}}("my_classes_with_students","my_classes_with_students");const $a=E([]),ja=E({avatarEditingEnabled:!1,readingAloudEnabled:!0,attendance:{},currentClassroomId:null}),Va=()=>{try{if(console.log("Starting settings save operation..."),"undefined"==typeof Storage||!window.localStorage)return console.warn("localStorage is not available"),It.notify({message:"Settings cannot be saved - browser storage unavailable",color:"warning",position:"top",timeout:3e3,icon:"warning"}),Oa();let i;try{if(i=Fa(ja.value),!i)throw new Error("Settings validation returned null/undefined")}catch(e){throw console.error("Settings validation failed:",e),new Error("Settings validation failed: "+e.message)}const r={...i,lastUpdated:(new Date).toISOString(),version:"1.1",userAgent:navigator.userAgent.substring(0,100),classroomId:i.currentClassroomId,attendanceCount:Object.keys(i.attendance||{}).length};try{const e="reward-system-settings-test-"+Date.now();localStorage.setItem(e,"test"),localStorage.removeItem(e)}catch(t){throw"QuotaExceededError"===t.name?new Error("localStorage quota exceeded during test write"):new Error("localStorage write test failed: "+t.message)}let d;try{d=JSON.stringify(r)}catch(a){throw console.error("Settings serialization failed:",a),new Error("Failed to serialize settings: "+a.message)}const c=5e6;if(d.length>c){console.warn(`Settings data too large: ${d.length} bytes (limit: ${c})`);try{return Da()}catch(l){throw new Error(`Settings data too large for localStorage: ${d.length} bytes`)}}let u=null;try{u=localStorage.getItem("reward-system-settings")}catch(s){console.warn("Could not create backup of existing settings:",s)}try{localStorage.setItem("reward-system-settings",d)}catch(n){if(u)try{localStorage.setItem("reward-system-settings",u)}catch(o){console.error("Failed to restore backup settings:",o)}throw n}return console.log("Settings saved successfully:",{size:d.length,attendanceEntries:Object.keys(i.attendance||{}).length,avatarEditingEnabled:i.avatarEditingEnabled,currentClassroomId:i.currentClassroomId}),!0}catch(i){console.error("Failed to save settings to localStorage:",i);let e="Failed to save settings",t=[];return"QuotaExceededError"===i.name||i.message.includes("quota exceeded")?(e="Storage quota exceeded - cannot save settings",t=[{label:"Clear Old Data",color:"white",handler:()=>Ja()},{label:"Compress Data",color:"white",handler:()=>Da()}]):i.message.includes("localStorage write test failed")||i.message.includes("disabled")?(e="Browser storage is disabled or unavailable",t=[{label:"Use Session Storage",color:"white",handler:()=>Oa()},{label:"Use Memory Storage",color:"white",handler:()=>Na()}]):i.message.includes("too large")?(e="Settings data is too large to save",t=[{label:"Compress Data",color:"white",handler:()=>Da()},{label:"Sanitize Data",color:"white",handler:()=>Ta()}]):(i.message.includes("validation failed")||i.message.includes("serialize"))&&(e="Settings data is corrupted",t=[{label:"Sanitize & Retry",color:"white",handler:()=>Ta()},{label:"Reset to Defaults",color:"white",handler:()=>{Ma(),Va()}}]),t.unshift({label:"Retry",color:"white",handler:()=>{setTimeout(()=>Va(),1e3)}}),It.notify({message:e,caption:i.message,color:"negative",position:"top",timeout:6e3,icon:"error",actions:t}),Za(i,"save"),!1}},Oa=()=>{try{if("undefined"!=typeof sessionStorage&&sessionStorage){const e={...Fa(ja.value),lastUpdated:(new Date).toISOString(),version:"1.0",fallbackMode:"sessionStorage"};return sessionStorage.setItem("reward-system-settings-fallback",JSON.stringify(e)),It.notify({message:"Settings saved to session storage (temporary)",color:"warning",position:"top",timeout:3e3,icon:"warning"}),console.log("Settings saved to sessionStorage as fallback"),!0}throw new Error("sessionStorage not available")}catch(e){return console.error("sessionStorage fallback failed:",e),Na(),!1}},Na=()=>{try{return window.rewardSystemSettingsMemory={...Fa(ja.value),lastUpdated:(new Date).toISOString(),version:"1.0",fallbackMode:"memory"},It.notify({message:"Settings saved in memory only (will be lost on refresh)",color:"warning",position:"top",timeout:4e3,icon:"warning"}),console.log("Settings saved to memory as fallback"),!0}catch(e){return console.error("Memory fallback failed:",e),It.notify({message:"Unable to save settings - all storage methods failed",color:"negative",position:"top",timeout:5e3,icon:"error"}),!1}},Da=()=>{try{const t={avatarEditingEnabled:ja.value.avatarEditingEnabled,attendance:ja.value.attendance,currentClassroomId:ja.value.currentClassroomId},a={};Object.entries(t.attendance||{}).forEach(([e,t])=>{!1===t&&(a[e]=!1)}),t.attendance=a;const l=JSON.stringify(t);if(l.length>5e6)throw new Error("Even compressed data is too large");try{localStorage.setItem("reward-system-settings-test","test"),localStorage.removeItem("reward-system-settings-test")}catch(e){throw new Error("localStorage write test failed after compression: "+e.message)}return localStorage.setItem("reward-system-settings",l),It.notify({message:"Settings saved in compressed format",color:"info",position:"top",timeout:3e3,icon:"compress"}),console.log("Settings saved in compressed format:",{originalSize:JSON.stringify(ja.value).length,compressedSize:l.length,compressionRatio:Math.round(100*(1-l.length/JSON.stringify(ja.value).length))}),!0}catch(t){return console.error("Compression fallback failed:",t),It.notify({message:"Compression failed, trying alternative storage",color:"warning",position:"top",timeout:3e3,icon:"warning"}),Oa()}},Ta=()=>{var e;try{console.log("Starting settings sanitization process...");const a=JSON.parse(JSON.stringify(ja.value)),l={avatarEditingEnabled:Boolean(ja.value.avatarEditingEnabled),attendance:{},currentClassroomId:ja.value.currentClassroomId?String(ja.value.currentClassroomId):null};let s=0,n=0;if(ja.value.attendance&&"object"==typeof ja.value.attendance&&Object.entries(ja.value.attendance).forEach(([e,t])=>{const a=parseInt(e);!isNaN(a)&&a>0?"boolean"==typeof t?(l.attendance[String(e)]=t,s++):"true"===t||"false"===t?(l.attendance[String(e)]="true"===t,s++):1===t||0===t?(l.attendance[String(e)]=Boolean(t),s++):(console.warn(`Removed invalid attendance value for student ${e}:`,t),n++):(console.warn("Removed invalid student ID from attendance:",e),n++)}),null==(e=ya.value.my_sel_classroom_students)?void 0:e.length){const e=new Set(ya.value.my_sel_classroom_students.filter(e=>e&&e.id).map(e=>e.id.toString()));Object.keys(l.attendance).forEach(t=>{e.has(t)||(delete l.attendance[t],n++,console.warn(`Removed attendance for student not in current classroom: ${t}`))})}const o=JSON.stringify(l);if(o.length>5e6)throw new Error("Sanitized data still too large for localStorage");try{localStorage.setItem("reward-system-settings-test","test"),localStorage.removeItem("reward-system-settings-test")}catch(t){throw new Error("localStorage write test failed after sanitization: "+t.message)}localStorage.setItem("reward-system-settings",o),Object.assign(ja.value,l);const i=`Settings sanitized: ${s} entries kept, ${n} invalid entries removed`;return It.notify({message:i,color:"positive",position:"top",timeout:4e3,icon:"cleaning_services"}),console.log("Settings sanitization completed:",{sanitizedCount:s,removedCount:n,sanitizedSettings:l,originalSize:JSON.stringify(a).length,sanitizedSize:o.length}),!0}catch(a){return console.error("Sanitization failed:",a),It.notify({message:`Sanitization failed: ${a.message}`,color:"negative",position:"top",timeout:4e3,icon:"error"}),Oa()}},Ua=()=>{try{if("undefined"==typeof Storage||!window.localStorage)return console.warn("localStorage is not available, using default settings"),Ma(),!1;const t=localStorage.getItem("reward-system-settings");if(!t)return console.log("No saved settings found, using defaults"),Ma(),!0;let a;try{a=JSON.parse(t)}catch(e){throw new Error("Invalid JSON in saved settings: "+e.message)}if(!a||"object"!=typeof a)throw new Error("Invalid settings data structure");const{lastUpdated:l,version:s,...n}=a,o=Fa(n);return Object.assign(ja.value,o),console.log("Settings loaded successfully:",o),s&&console.log("Loaded settings version:",s),!0}catch(t){console.error("Failed to load settings from localStorage:",t);let e="Settings reset to defaults due to loading error";t.message.includes("Invalid JSON")?e="Settings file corrupted - reset to defaults":t.message.includes("Invalid settings data")&&(e="Invalid settings format - reset to defaults");const a=Ra();return a||(Ma(),It.notify({message:e,color:"info",position:"top",timeout:3e3,icon:"refresh",actions:[{label:"OK",color:"white",handler:()=>{}}]})),a}},Ra=()=>{try{if("undefined"!=typeof sessionStorage&&sessionStorage){const t=sessionStorage.getItem("reward-system-settings-fallback");if(t)try{const e=JSON.parse(t),{lastUpdated:a,version:l,fallbackMode:s,...n}=e,o=Fa(n);return Object.assign(ja.value,o),It.notify({message:"Settings loaded from session storage backup",color:"warning",position:"top",timeout:3e3,icon:"backup"}),console.log("Settings loaded from sessionStorage fallback"),!0}catch(e){console.warn("sessionStorage fallback data corrupted:",e)}}if(window.rewardSystemSettingsMemory)try{const{lastUpdated:e,version:t,fallbackMode:a,...l}=window.rewardSystemSettingsMemory,s=Fa(l);return Object.assign(ja.value,s),It.notify({message:"Settings loaded from memory backup",color:"warning",position:"top",timeout:3e3,icon:"memory"}),console.log("Settings loaded from memory fallback"),!0}catch(t){console.warn("Memory fallback data corrupted:",t)}return!1}catch(a){return console.error("All fallback loading methods failed:",a),!1}},Fa=e=>{const t={avatarEditingEnabled:!1,attendance:{},currentClassroomId:null};if(!e||"object"!=typeof e)return console.warn("Invalid settings data, using defaults"),t;const a={...t};if("boolean"==typeof e.avatarEditingEnabled?a.avatarEditingEnabled=e.avatarEditingEnabled:console.warn("Invalid avatarEditingEnabled value, using default:",e.avatarEditingEnabled),e.attendance&&"object"==typeof e.attendance&&!Array.isArray(e.attendance)){const t={};Object.entries(e.attendance).forEach(([e,a])=>{const l=parseInt(e);!isNaN(l)&&l>0?"boolean"==typeof a?t[e]=a:(console.warn(`Invalid attendance value for student ${e}:`,a),t[e]=!0):console.warn("Invalid student ID in attendance:",e)}),a.attendance=t}else console.warn("Invalid attendance data, using empty object:",e.attendance);return null===e.currentClassroomId||"string"==typeof e.currentClassroomId&&e.currentClassroomId.length>0||"number"==typeof e.currentClassroomId&&e.currentClassroomId>0?a.currentClassroomId=e.currentClassroomId:console.warn("Invalid currentClassroomId, using null:",e.currentClassroomId),a},Ma=()=>{ja.value={avatarEditingEnabled:!1,attendance:{},currentClassroomId:null},console.log("Initialized default settings")},Pa=()=>{var e;try{if(!(null==(e=ya.value.my_sel_classroom_students)?void 0:e.length))return console.log("No students in current classroom to validate against"),!0;const a=ya.value.my_sel_classroom_students.filter(e=>!e.id||"string"!=typeof e.id&&"number"!=typeof e.id);a.length>0&&(console.error("Found students with invalid IDs:",a),It.notify({message:`Warning: ${a.length} students have invalid IDs`,color:"warning",position:"top",timeout:4e3,icon:"warning"}));const l=new Set;if(ya.value.my_sel_classroom_students.forEach(e=>{e.id&&l.add(e.id.toString())}),0===l.size)return console.warn("No valid student IDs found in current classroom"),!0;if(!ja.value.attendance||"object"!=typeof ja.value.attendance)return console.warn("Invalid attendance data structure, resetting"),ja.value.attendance={},!0;const s=Object.keys(ja.value.attendance).filter(e=>{if(!l.has(e))return!0;const t=ja.value.attendance[e];return"boolean"!=typeof t&&(console.warn(`Invalid attendance value for student ${e}:`,t),!0)});if(s.length>0){console.warn("Found invalid student IDs or values in attendance:",s);const e={...ja.value.attendance};try{const e={...ja.value.attendance};let t=0,a=0;s.forEach(s=>{const n=ja.value.attendance[s];l.has(s)?"boolean"!=typeof n&&(e[s]=!0,a++):(delete e[s],t++)}),ja.value.attendance=e;let n="";return t>0&&a>0?n=`Removed ${t} invalid student records and fixed ${a} invalid values`:t>0?n=`Removed ${t} invalid student records from attendance`:a>0&&(n=`Fixed ${a} invalid attendance values`),It.notify({message:n,color:"info",position:"top",timeout:3e3,icon:"cleaning_services"}),console.log("Attendance validation completed:",{removed:t,fixed:a,cleanedAttendance:e}),!1}catch(t){return console.error("Error during attendance cleanup:",t),ja.value.attendance=e,It.notify({message:"Failed to clean invalid attendance data",color:"negative",position:"top",timeout:3e3,icon:"error"}),!1}}return console.log("All student IDs in attendance are valid"),!0}catch(a){return console.error("Error during student ID validation:",a),It.notify({message:"Error validating student data - some features may not work correctly",color:"negative",position:"top",timeout:4e3,icon:"error"}),!1}},Ja=()=>{try{const e=[];for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);a&&a.startsWith("reward-system-")&&e.push(a)}return e.forEach(e=>{(e.includes("backup")||e.includes("old"))&&(localStorage.removeItem(e),console.log("Removed old settings:",e))}),Va()}catch(e){return console.error("Failed to handle storage quota exceeded:",e),It.notify({message:"Storage full - settings cannot be saved. Please clear browser data.",color:"negative",position:"top",timeout:5e3,icon:"storage"}),!1}},Qa=(e,t)=>{console.log(`Handling classroom selection: ${e}`),Ct.value=e,ya.value.my_sel_classroom_students=function(e){return(e||[]).map(e=>{const t=(e.name||"").trim().split(/\s+/).filter(e=>e.length>0),a=t[0]||"",l=t.length>1?t[t.length-1]:"",s=t.length>2?t.slice(1,-1).join(" "):"";return{...e,firstName:a,secondName:s,lastName:l}})}(t||[])},Ba=()=>{var e;if(console.log("Testing classroom switching behavior..."),!(null==(e=ya.value.my_classes_with_students)?void 0:e.length))return void console.warn("No classrooms available for testing");const t=ya.value.my_classes_with_students;let a=0;const l=()=>{if(a<t.length){const e=t[a];console.log(`Switching to classroom ${a+1}: ${e.classroom_name}`),console.log("Current settings before switch:",JSON.parse(JSON.stringify(ja.value))),Qa(e.id,e.students),setTimeout(()=>{console.log("Settings after switch:",JSON.parse(JSON.stringify(ja.value))),console.log("LocalStorage content:",localStorage.getItem("reward-system-settings")),a++,a<t.length?setTimeout(l,2e3):console.log("Classroom switching test completed")},100)}};l()},La=()=>{console.log("Starting comprehensive error handling tests...");const e=[];[{name:"localStorage Unavailable Test",test:()=>{const e=window.localStorage;Object.defineProperty(window,"localStorage",{value:null,writable:!0});const t=Va();return Object.defineProperty(window,"localStorage",{value:e,writable:!0}),!t}},{name:"Invalid Settings Data Test",test:()=>{const e={...ja.value};ja.value={avatarEditingEnabled:"invalid",attendance:"not an object",currentClassroomId:[]};const t=Fa(ja.value);return ja.value=e,t&&"boolean"==typeof t.avatarEditingEnabled&&"object"==typeof t.attendance&&!Array.isArray(t.attendance)}},{name:"Student ID Validation Test",test:()=>{const e={...ja.value.attendance};ja.value.attendance={valid_id_1:!0,invalid_id_abc:!1,"":!0,null:null,999999:"not_boolean"};const t=Pa();return ja.value.attendance=e,"boolean"==typeof t}},{name:"Settings Dialog Error Boundary Test",test:()=>{try{const e=ya.value;return ya.value=null,el(),ya.value=e,!0}catch(e){return!1}}},{name:"Compression Fallback Test",test:()=>{const e={...ja.value.attendance},t={};for(let l=0;l<1e4;l++)t[`student_${l}`]=Math.random()>.5;ja.value.attendance=t;const a=Da();return ja.value.attendance=e,"boolean"==typeof a}},{name:"Sanitization Test",test:()=>{const e={...ja.value};ja.value.attendance={123:!0,invalid:"not_boolean",456:!1,"":!0,null:null};const t=Ta();return ja.value=e,"boolean"==typeof t}}].forEach(({name:t,test:a})=>{try{const l=Date.now(),s=a(),n=Date.now()-l;e.push({name:t,passed:s,duration:n,error:null}),console.log(`‚úÖ ${t}: ${s?"PASSED":"FAILED"} (${n}ms)`)}catch(l){e.push({name:t,passed:!1,duration:0,error:l.message}),console.error(`‚ùå ${t}: ERROR - ${l.message}`)}});const t=e.filter(e=>e.passed).length,a=e.length;return console.log(`\nüìä Error Handling Test Results: ${t}/${a} tests passed`),t===a?It.notify({message:`All ${a} error handling tests passed!`,color:"positive",position:"top",timeout:3e3,icon:"check_circle"}):It.notify({message:`${t}/${a} error handling tests passed`,color:"warning",position:"top",timeout:4e3,icon:"warning"}),e};"undefined"!=typeof window&&(window.testClassroomSwitching=Ba,window.testErrorHandling=La,window.testSettingsValidation=()=>Pa(),window.testSettingsCompression=()=>Da(),window.testSettingsSanitization=()=>Ta()),C(ja,()=>{try{Wa&&clearTimeout(Wa),Wa=setTimeout(()=>{Va()},500)}catch(e){console.error("Error in settings watcher:",e),It.notify({message:"Error monitoring settings changes",color:"warning",position:"top",timeout:2e3,icon:"warning"})}},{deep:!0}),C(()=>ya.value.my_sel_classroom_students,(e,t)=>{try{if(!e||!Array.isArray(e))return void console.log("No valid students array provided");if(e.length>0){const a={...ja.value.attendance};let l=!1,s=0,n=0;if(e.forEach(e=>{e&&e.id?e.id in a||(a[e.id]=!0,l=!0,s++):console.warn("Invalid student data:",e)}),t&&Array.isArray(t)&&t.length>0){const t=new Set(e.filter(e=>e&&e.id).map(e=>e.id.toString()));Object.keys(a).forEach(e=>{t.has(e.toString())||(delete a[e],l=!0,n++)})}l&&(ja.value.attendance=a,console.log(`Updated attendance: +${s} students, -${n} students`),(s>0||n>0)&&It.notify({message:`Attendance updated: ${s} added, ${n} removed`,color:"info",position:"top",timeout:2e3,icon:"update"}))}else Object.keys(ja.value.attendance).length>0&&(ja.value.attendance={},console.log("Cleared attendance - no students in classroom"))}catch(a){console.error("Error updating attendance for student changes:",a),It.notify({message:`Error updating attendance: ${a.message}`,color:"warning",position:"top",timeout:3e3,icon:"warning"});try{Pa()}catch(l){console.error("Failed to validate student IDs during recovery:",l)}}},{deep:!0});let Wa=null;const qa=e=>!1!==ja.value.attendance[e];A(()=>{const e={};return ya.value.my_sel_classroom_students&&ya.value.my_sel_classroom_students.forEach(t=>{e[t.id]=!1!==ja.value.attendance[t.id]}),e});const Ha=A(()=>ja.value.avatarEditingEnabled),Ka=A(()=>e=>{const t="student-card cursor-pointer transition-all duration-300";return qa(e)?`${t} hover:shadow-xl hover:-translate-y-1`:`${t} student-absent opacity-50 grayscale cursor-not-allowed`}),Ga=A(()=>e=>!qa(e)),Ya=()=>{var e;try{if(!(null==(e=ya.value.my_sel_classroom_students)?void 0:e.length))throw new Error("No students found in current classroom");let t=0;const a=[];ya.value.my_sel_classroom_students.forEach(e=>{try{if(!e.id)throw new Error("Invalid student data: missing ID");ja.value.attendance[e.id]=!0,t++}catch(l){a.push(`Student ${e.name||"Unknown"}: ${l.message}`)}}),a.length>0?(console.warn("Errors marking students present:",a),It.notify({message:`Marked ${t} students present, ${a.length} errors occurred`,color:"warning",position:"top",timeout:4e3,icon:"warning"})):It.notify({message:`All ${t} students marked present`,color:"positive",position:"top",timeout:2e3,icon:"people"}),console.log(`Marked all students present: ${t} successful, ${a.length} errors`)}catch(t){console.error("Error marking all students present:",t),It.notify({message:`Failed to mark all present: ${t.message}`,color:"negative",position:"top",timeout:3e3,icon:"error"})}},Xa=()=>{var e;try{if(!(null==(e=ya.value.my_sel_classroom_students)?void 0:e.length))throw new Error("No students found in current classroom");let t=0;const a=[];ya.value.my_sel_classroom_students.forEach(e=>{try{if(!e.id)throw new Error("Invalid student data: missing ID");ja.value.attendance[e.id]=!1,t++}catch(l){a.push(`Student ${e.name||"Unknown"}: ${l.message}`)}}),a.length>0?(console.warn("Errors marking students absent:",a),It.notify({message:`Marked ${t} students absent, ${a.length} errors occurred`,color:"warning",position:"top",timeout:4e3,icon:"warning"})):It.notify({message:`All ${t} students marked absent`,color:"warning",position:"top",timeout:2e3,icon:"person_off"}),console.log(`Marked all students absent: ${t} successful, ${a.length} errors`)}catch(t){console.error("Error marking all students absent:",t),It.notify({message:`Failed to mark all absent: ${t.message}`,color:"negative",position:"top",timeout:3e3,icon:"error"})}},Za=(e,t)=>{var a;console.error(`Settings dialog error during ${t}:`,e);const l={operation:t,error:e.message,stack:e.stack,timestamp:(new Date).toISOString(),settingsState:ja.value?JSON.stringify(ja.value):"null",classroomId:Ct.value,studentCount:(null==(a=ya.value.my_sel_classroom_students)?void 0:a.length)||0};console.error("Settings error report:",l);const s=[];"open"===t?(s.push({label:"Retry",color:"white",handler:()=>el()}),s.push({label:"Reset & Open",color:"white",handler:()=>{Ma(),el()}})):"save"===t?(s.push({label:"Retry",color:"white",handler:()=>Va()}),s.push({label:"Compress & Save",color:"white",handler:()=>Da()}),s.push({label:"Sanitize & Save",color:"white",handler:()=>Ta()})):"load"===t?(s.push({label:"Retry",color:"white",handler:()=>Ua()}),s.push({label:"Use Defaults",color:"white",handler:()=>Ma()})):"validate"===t?(s.push({label:"Fix Data",color:"white",handler:()=>Ta()}),s.push({label:"Reset",color:"white",handler:()=>Ma()})):s.push({label:"Retry",color:"white",handler:()=>{"reset"===t&&tl()}}),It.notify({message:{open:"Failed to open settings dialog",close:"Failed to close settings dialog",save:"Failed to save settings",load:"Failed to load settings",reset:"Failed to reset settings",validate:"Settings validation failed",initialize:"Settings initialization failed"}[t]||"Settings dialog error occurred",caption:e.message,color:"negative",position:"top",timeout:5e3,icon:"error",actions:s})},el=()=>{var e;try{if(console.log("Attempting to open settings dialog..."),!ya.value)throw new Error("Application data not initialized");"undefined"==typeof Storage&&console.warn("Browser storage not available, settings will not persist"),ya.value.my_sel_classroom_students||(console.warn("No classroom selected, initializing empty student list"),ya.value.my_sel_classroom_students=[]),ja.value&&"object"==typeof ja.value?("boolean"!=typeof ja.value.avatarEditingEnabled&&(console.warn("avatarEditingEnabled corrupted, resetting to default"),ja.value.avatarEditingEnabled=!0),ja.value.attendance&&"object"==typeof ja.value.attendance&&!Array.isArray(ja.value.attendance)||(console.warn("Attendance data corrupted, reinitializing"),ja.value.attendance={}),null!==ja.value.currentClassroomId&&"string"!=typeof ja.value.currentClassroomId&&"number"!=typeof ja.value.currentClassroomId&&(console.warn("currentClassroomId corrupted, resetting to null"),ja.value.currentClassroomId=null)):(console.warn("Settings object corrupted, reinitializing"),Ma());try{Pa()||console.warn("Student ID validation returned false, but continuing with dialog open")}catch(t){console.warn("Student ID validation failed, attempting recovery:",t);try{Ta()}catch(a){console.error("Recovery failed, using default settings:",a),Ma()}}if(Zt.value)return void console.log("Settings dialog already open");if(!It)throw new Error("Quasar instance not available");Zt.value=!0,console.log("Settings dialog opened successfully"),console.log("Settings dialog state:",{settingsValid:!!ja.value,studentsCount:(null==(e=ya.value.my_sel_classroom_students)?void 0:e.length)||0,attendanceEntries:Object.keys(ja.value.attendance||{}).length,currentClassroom:ja.value.currentClassroomId})}catch(l){console.error("Critical error opening settings dialog:",l),Za(l,"open")}},tl=()=>{try{It.dialog({title:"Reset Settings",message:"Are you sure you want to reset all settings to defaults? This will clear all attendance data.",cancel:!0,persistent:!1,color:"negative"}).onOk(()=>{try{Ma(),Va(),It.notify({message:"Settings reset to defaults",color:"info",position:"top",timeout:2e3,icon:"refresh"}),console.log("Settings reset to defaults successfully")}catch(e){Za(e,"reset")}})}catch(e){Za(e,"reset")}};z(async()=>{try{console.log("Initializing reward system component...");try{Ua()||(console.warn("Settings loading failed, using defaults"),Ma())}catch(e){console.error("Critical error loading settings:",e),Za(e,"load"),Ma()}try{const e=await $.get("/api/behaviors");e.data&&Array.isArray(e.data)?($a.value=e.data,console.log(`Loaded ${e.data.length} behaviors`)):(console.warn("Invalid behaviors data received:",e.data),$a.value=[])}catch(t){console.error("Failed to load behaviors:",t),$a.value=[],It.notify({message:"Failed to load behavior options",color:"warning",position:"top",timeout:3e3,icon:"warning"})}j(()=>{var e;try{if(Ct.value&&(null==(e=ya.value.my_sel_classroom_students)?void 0:e.length)){if(console.log("Initializing settings for existing classroom selection..."),"string"!=typeof Ct.value&&"number"!=typeof Ct.value)return void console.warn("Invalid classroom ID detected:",Ct.value);ja.value.currentClassroomId!==Ct.value&&(ja.value.currentClassroomId=Ct.value,console.log("Updated current classroom ID:",Ct.value));const e=ya.value.my_sel_classroom_students.filter(e=>e&&e.id&&"string"==typeof e.name);e.length!==ya.value.my_sel_classroom_students.length&&console.warn(`Found ${ya.value.my_sel_classroom_students.length-e.length} invalid student records`);const l={...ja.value.attendance};let s=!1,n=0;if(e.forEach(e=>{e.id in l||(l[e.id]=!0,s=!0,n++)}),s){ja.value.attendance=l,console.log(`Initialized attendance for ${n} students in existing classroom`);try{Va()}catch(t){console.warn("Failed to save initial attendance settings:",t)}}try{Pa()}catch(a){console.warn("Post-initialization validation failed:",a)}}else console.log("No classroom selected during initialization")}catch(l){console.error("Error during settings initialization:",l),Za(l,"initialize")}});try{!function(){var e,t,a,l,s,n,o,i;try{const r=localStorage.getItem(_t);if(!r)return jt.value=$t(),Vt.value="Math",Ot.value=null,Nt.value=null,Dt.value=null,Tt.value=null,Ct.value="",Ut.value="",At.value="",!1;const d=JSON.parse(r);return jt.value=null!=(e=d.date)?e:$t(),Vt.value=null!=(t=d.subject)?t:"Math",Ot.value=null!=(a=d.semester)?a:null,Nt.value=null!=(l=d.week)?l:null,Dt.value=null!=(s=d.day)?s:null,Tt.value=null!=(n=d.periodNumber)?n:null,Ut.value=null!=(o=d.classroomName)?o:"",At.value=null!=(i=d.period_code)?i:"",!0}catch(r){return jt.value=$t(),Vt.value="Math",Ot.value=null,Nt.value=null,Dt.value=null,Tt.value=null,Ct.value="",Ut.value="",At.value="",console.warn("loadLastSelection failed",r),!1}}()}catch(a){console.warn("Failed to load last selection on init",a)}console.log("Reward system component initialization completed")}catch(l){console.error("Critical error during component mounting:",l),It.notify({message:"Application initialization failed",caption:l.message,color:"negative",position:"top",timeout:5e3,icon:"error",actions:[{label:"Reload Page",color:"white",handler:()=>window.location.reload()}]})}});let al=null;return C([Ot,Nt,Dt,Tt,Ct,At],()=>{try{try{const e=Ot.value,t=Nt.value,a=Dt.value,l=Tt.value;null!=e&&null!=t&&null!=a&&null!=l&&(At.value=`${e}.${t}.${a}.${l}`)}catch(e){console.warn("Failed to generate period_code",e)}al&&clearTimeout(al),al=setTimeout(()=>{Ft()},300)}catch(t){console.warn("Failed to auto-save last selection",t)}}),C(Ct,e=>{try{const t=(ya.value.my_classes_with_students||[]).find(t=>t.id==e);Ut.value=(null==t?void 0:t.classroom_name)||""}catch(t){console.warn("Failed to sync classroom name for id",e,t)}},{immediate:!0}),(e,t)=>(O(),V("div",K,[N(d,{class:"main-container-card shadow-lg rounded-2xl overflow-hidden"},{default:T(()=>[N(a,{class:"bg-white"},{default:T(()=>{var e,a,o;return[D("div",G,[D("div",Y,[D("div",X,[N(l,{color:"amber",icon:"emoji_events",label:"üèÜ Show Leaderboard üèÜ",onClick:t[0]||(t[0]=e=>{Kt.value=!0,pa()}),class:"shadow-sm rounded-lg leaderboard-btn",size:"md",disable:!(null==(e=ya.value.my_sel_classroom_students)?void 0:e.length)},{default:T(()=>{var e;return[N(s,{class:R((null==(e=ya.value.my_sel_classroom_students)?void 0:e.length)?"bg-amber text-white":"bg-grey-8 text-white"),anchor:"top middle",self:"bottom middle"},{default:T(()=>{var e,t;return[N(n,{name:(null==(e=ya.value.my_sel_classroom_students)?void 0:e.length)?"emoji_events":"warning",size:"xs",class:"mr-1"},null,8,["name"]),F(" "+M((null==(t=ya.value.my_sel_classroom_students)?void 0:t.length)?"View top 5 students with highest star points!":"Select a classroom first to view leaderboard"),1)]}),_:1},8,["class"])]}),_:1},8,["disable"])]),(null==(a=ya.value.my_classes_with_students)?void 0:a.length)?(O(),V("div",Z,[N(p,{dense:"",outlined:"",modelValue:Ct.value,"onUpdate:modelValue":[t[1]||(t[1]=e=>Ct.value=e),t[2]||(t[2]=e=>{const t=(ya.value.my_classes_with_students||[]).find(t=>t.id==e);Qa(e,(null==t?void 0:t.students)||[])})],options:ya.value.my_classes_with_students,"option-value":"id","option-label":"classroom_name",label:"Classroom","emit-value":"","map-options":"",class:"w-64"},null,8,["modelValue","options"])])):U("",!0),D("div",ee,[N(x,{date:jt.value,"onUpdate:date":t[3]||(t[3]=e=>jt.value=e),subject:Vt.value,"onUpdate:subject":t[4]||(t[4]=e=>Vt.value=e),semester:Ot.value,"onUpdate:semester":t[5]||(t[5]=e=>Ot.value=e),week:Nt.value,"onUpdate:week":t[6]||(t[6]=e=>Nt.value=e),day:Dt.value,"onUpdate:day":t[7]||(t[7]=e=>Dt.value=e),periodNumber:Tt.value,"onUpdate:periodNumber":t[8]||(t[8]=e=>Tt.value=e),persist:!0,persistKey:_t,onChange:Ft},null,8,["date","subject","semester","week","day","periodNumber"]),ya.value.my_classes_with_students?(O(),P(p,{key:0,"onUpdate:modelValue":[t[9]||(t[9]=e=>{const t=(ya.value.my_classes_with_students||[]).find(t=>t.id===e);t&&Qa(t.id,t.students)}),t[10]||(t[10]=e=>Ct.value=e)],filled:"",modelValue:Ct.value,options:(ya.value.my_classes_with_students||[]).map(e=>{var t;return{label:`${e.classroom_name} (${(null==(t=e.students)?void 0:t.length)||0})`,value:e.id}}),"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"Classroom",class:"rounded-lg min-w-40"},null,8,["modelValue","options"])):U("",!0),(null==(o=ya.value.my_sel_classroom_students)?void 0:o.length)?(O(),P(l,{key:1,color:"info",icon:"assessment",label:"Load  Summaries",onClick:va,class:"shadow-sm rounded-lg",size:"md",loading:oa.value},{default:T(()=>[N(s,{class:"bg-info text-white",anchor:"top middle",self:"bottom middle"},{default:T(()=>[N(n,{name:"assessment",size:"xs",class:"mr-1"}),t[25]||(t[25]=F(" Load behavior summaries for all students in this classroom "))]),_:1})]),_:1},8,["loading"])):U("",!0)]),D("div",te,[D("div",ae,[D("div",le,[N(f,{color:"primary",outline:""},{default:T(()=>[F("Selected: "+M(J(wa).length),1)]),_:1}),N(p,{modelValue:ba.value,"onUpdate:modelValue":t[11]||(t[11]=e=>ba.value=e),options:($a.value||[]).map(e=>({label:e.name,value:e.id})),"option-value":"value","option-label":"label","emit-value":"","map-options":"",dense:"",outlined:"",placeholder:"Select behavior",class:"min-w-48"},null,8,["modelValue","options"])]),D("div",se,[N(l,{color:"positive",label:"Present",onClick:Ia,disable:!J(wa).length},null,8,["disable"]),N(l,{color:"warning",label:"Absent",onClick:Ca,disable:!J(wa).length},null,8,["disable"]),N(l,{color:"primary",label:"Apply Behavior",onClick:Aa,loading:J(_a),disable:!J(wa).length||!ba.value},null,8,["loading","disable"]),N(l,{flat:"",color:"grey",label:"Clear",onClick:Ea,disable:!J(wa).length},null,8,["disable"])])]),D("div",ne,[(O(!0),V(Q,null,B(ya.value.my_sel_classroom_students,e=>(O(),P(k,{key:e.id,student:e,"card-class":Ka.value(e.id),"student-summary":Ht.value[e.id],selected:J(wa).includes(e.id),"avatar-edit-enabled":zt.value,"show-avatar-buttons":Ha.value,"disable-behavior":Ga.value(e.id),onSelect:ka,onOpenCamera:ca,onOpenBehavior:ra},null,8,["student","card-class","student-summary","selected","avatar-edit-enabled","show-avatar-buttons","disable-behavior"]))),128))])])])])]}),_:1}),N(o),N(a,null,{default:T(()=>[Rt.value.length?(O(),V("div",ie,[D("div",re,M(Et("common.preview")||"Table Preview"),1),N(o,{class:"my-4"}),D("div",de,M(Et("common.edit")||"Edit Configuration"),1),N(y,{flat:"",rows:Mt.value,columns:Pt.value,"row-key":"key",dense:""},{"body-cell-label":T(e=>[N(r,{modelValue:e.row.label,"onUpdate:modelValue":t=>e.row.label=t,outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),"body-cell-type":T(e=>[N(p,{modelValue:e.row.type,"onUpdate:modelValue":t=>e.row.type=t,options:["text","email","number","button","list"],outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),"body-cell-visible":T(e=>[N(i,{modelValue:e.row.visible,"onUpdate:modelValue":t=>e.row.visible=t,color:"primary"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["rows","columns"])])):(O(),V("div",oe,M(Et("common.noResults")||"No JSON data provided"),1))]),_:1})]),_:1}),N(u,{modelValue:Qt.value,"onUpdate:modelValue":t[13]||(t[13]=e=>Qt.value=e)},{default:T(()=>[N(d,{style:{"min-width":"500px"}},{default:T(()=>[N(a,null,{default:T(()=>[t[26]||(t[26]=D("div",{class:"text-lg font-semibold mb-2"},"Paste JSON Data",-1)),N(r,{modelValue:Jt.value,"onUpdate:modelValue":t[12]||(t[12]=e=>Jt.value=e),type:"textarea",autogrow:""},null,8,["modelValue"])]),_:1}),N(c,{align:"right"},{default:T(()=>[L(N(l,{flat:"",label:"Cancel",color:"grey"},null,512),[[m]]),N(l,{flat:"",label:"Load",color:"primary",onClick:Bt}),N(l,{flat:"",label:"Load Text",color:"primary",onClick:Lt})]),_:1})]),_:1})]),_:1},8,["modelValue"]),N(u,{modelValue:Wt.value,"onUpdate:modelValue":t[15]||(t[15]=e=>Wt.value=e)},{default:T(()=>[N(d,{class:"q-pa-md",style:{"min-width":"500px","max-width":"800px"}},{default:T(()=>[N(a,{class:"row items-center justify-between"},{default:T(()=>[D("div",ce," üßë‚Äçüéì "+M(qt.value.name),1),L(N(l,{flat:"",round:"",icon:"close",dense:""},null,512),[[m]])]),_:1}),N(o),N(a,null,{default:T(()=>[N(W,{"student-id":qt.value.id,"student-name":qt.value.f_l_name,"period-code":At.value,behaviors:$a.value,read:ja.value.readingAloudEnabled,summary:Ht.value[qt.value.id]||{positive:0,negative:0,total:0},onRecorded:ga,onClose:t[14]||(t[14]=e=>Wt.value=!1)},null,8,["student-id","student-name","period-code","behaviors","read","summary"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),D("input",{ref_key:"fileInputRef",ref:ea,type:"file",accept:"image/*",style:{display:"none"},onChange:da},null,544),N(u,{modelValue:aa.value,"onUpdate:modelValue":t[16]||(t[16]=e=>aa.value=e)},{default:T(()=>[N(d,{style:{"min-width":"500px"}},{default:T(()=>[N(S,{onCaptured:xt,onCancel:St})]),_:1})]),_:1},8,["modelValue"]),N(u,{modelValue:Kt.value,"onUpdate:modelValue":t[20]||(t[20]=e=>Kt.value=e),maximized:""},{default:T(()=>[N(d,{class:"leaderboard-dialog"},{default:T(()=>[N(a,{class:"leaderboard-header"},{default:T(()=>[D("div",ue,[t[27]||(t[27]=D("div",{class:"trophy-animation"},"üèÜ",-1)),t[28]||(t[28]=D("h1",{class:"leaderboard-title"},"Super Star Leaderboard!",-1)),t[29]||(t[29]=D("p",{class:"leaderboard-subtitle"},"Our Amazing Top 5 Students This Week! ‚≠ê",-1)),N(l,{flat:"",round:"",icon:"close",color:"white",size:"lg",onClick:t[17]||(t[17]=e=>Kt.value=!1),class:"close-btn"})])]),_:1}),N(a,{class:"period-selector"},{default:T(()=>[D("div",me,[N(h,{modelValue:Xt.value,"onUpdate:modelValue":[t[18]||(t[18]=e=>Xt.value=e),pa],"toggle-color":"primary",options:[{label:"üìÖ This Week",value:"week"},{label:"üìÜ This Month",value:"month"},{label:"üóìÔ∏è All Time",value:"all"}],class:"period-toggle"},null,8,["modelValue"]),N(l,{color:"primary",icon:"refresh",label:"Refresh",onClick:pa,class:"refresh-btn"})])]),_:1}),N(a,{class:"leaderboard-content"},{default:T(()=>[Yt.value?(O(),V("div",ve,[N(b,{size:"4rem",color:"primary"}),t[30]||(t[30]=D("p",{class:"loading-text"},"Loading our amazing students...",-1))])):0===Gt.value.length?(O(),V("div",ge,t[31]||(t[31]=[D("div",{class:"empty-icon"},"üìö",-1),D("h3",null,"No stars earned yet!",-1),D("p",null,"Let's start earning some points and see who becomes our first super star!",-1)]))):(O(),V("div",pe,[Gt.value.length>=3?(O(),V("div",fe,[D("div",ye,[Gt.value[1]?(O(),V("div",he,[D("div",be,[D("div",we,[N(w,{src:Gt.value[1].avatar||ia(Gt.value[1].name),class:"avatar-img"},null,8,["src"]),t[32]||(t[32]=D("div",{class:"position-badge silver"},"2",-1))]),D("h3",_e,M(Gt.value[1].first_name),1),D("div",Se,M(Gt.value[1].total)+" ‚≠ê",1),t[33]||(t[33]=D("div",{class:"medal"},"ü•à",-1))]),t[34]||(t[34]=D("div",{class:"podium-base second-base"},"2nd",-1))])):U("",!0),Gt.value[0]?(O(),V("div",xe,[D("div",ke,[D("div",Ee,[N(w,{src:Gt.value[0].avatar||ia(Gt.value[0].name),class:"avatar-img"},null,8,["src"]),t[35]||(t[35]=D("div",{class:"position-badge gold"},"1",-1)),t[36]||(t[36]=D("div",{class:"crown"},"üëë",-1))]),D("h3",Ie,M(Gt.value[0].first_name),1),D("div",Ce,M(Gt.value[0].total)+" ‚≠ê",1),t[37]||(t[37]=D("div",{class:"medal"},"ü•á",-1))]),t[38]||(t[38]=D("div",{class:"podium-base first-base"},"1st",-1))])):U("",!0),Gt.value[2]?(O(),V("div",Ae,[D("div",ze,[D("div",$e,[N(w,{src:Gt.value[2].avatar||ia(Gt.value[2].name),class:"avatar-img"},null,8,["src"]),t[39]||(t[39]=D("div",{class:"position-badge bronze"},"3",-1))]),D("h3",je,M(Gt.value[2].first_name),1),D("div",Ve,M(Gt.value[2].total)+" ‚≠ê",1),t[40]||(t[40]=D("div",{class:"medal"},"ü•â",-1))]),t[41]||(t[41]=D("div",{class:"podium-base third-base"},"3rd",-1))])):U("",!0)])])):U("",!0),Gt.value.length>3?(O(),V("div",Oe,[(O(!0),V(Q,null,B(Gt.value.slice(3,5),(e,t)=>(O(),V("div",{key:e.id,class:"student-row"},[D("div",Ne,M(t+4),1),D("div",De,[N(w,{src:e.avatar||ia(e.name),class:"row-avatar-img"},null,8,["src"])]),D("div",Te,[D("h4",Ue,M(e.first_name)+" "+M(e.last_name),1),D("div",Re,M(e.total)+" ‚≠ê points",1)]),D("div",Fe,M(0===t?"üåü":"‚≠ê"),1)]))),128))])):U("",!0),Gt.value.length>0?(O(),V("div",Me,[t[48]||(t[48]=D("h3",{class:"recognition-title"},"üéâ Special Recognition! üéâ",-1)),D("div",Pe,[Gt.value[0]?(O(),V("div",Je,[t[42]||(t[42]=D("div",{class:"card-icon"},"üëë",-1)),t[43]||(t[43]=D("div",{class:"card-title"},"Super Star Champion!",-1)),D("div",Qe,M(Gt.value[0].first_name),1)])):U("",!0),Gt.value[1]?(O(),V("div",Be,[t[44]||(t[44]=D("div",{class:"card-icon"},"üåü",-1)),t[45]||(t[45]=D("div",{class:"card-title"},"Amazing Achiever!",-1)),D("div",Le,M(Gt.value[1].first_name),1)])):U("",!0),Gt.value[2]?(O(),V("div",We,[t[46]||(t[46]=D("div",{class:"card-icon"},"‚≠ê",-1)),t[47]||(t[47]=D("div",{class:"card-title"},"Fantastic Friend!",-1)),D("div",qe,M(Gt.value[2].first_name),1)])):U("",!0)])])):U("",!0)]))]),_:1}),N(a,{class:"leaderboard-footer"},{default:T(()=>[D("div",He,[t[49]||(t[49]=D("p",{class:"encouragement-message"}," üåü Every student is a star! Keep being awesome and earning those points! üåü ",-1)),N(l,{color:"primary",label:"üéØ Back to Classroom",onClick:t[19]||(t[19]=e=>Kt.value=!1),class:"back-btn",size:"lg"})])]),_:1})]),_:1})]),_:1},8,["modelValue"]),N(u,{modelValue:Zt.value,"onUpdate:modelValue":t[24]||(t[24]=e=>Zt.value=e)},{default:T(()=>[N(d,{style:{"min-width":"600px","max-width":"800px"}},{default:T(()=>{var e;return[N(a,null,{default:T(()=>[D("div",Ke,[N(n,{name:"settings",color:"primary"}),t[50]||(t[50]=F(" Classroom Settings "))])]),_:1}),N(o),N(a,null,{default:T(()=>[D("div",Ge,[N(n,{name:"record_voice_over",color:"primary"}),t[51]||(t[51]=F(" Reading Aloud "))]),D("div",Ye,[N(i,{modelValue:ja.value.readingAloudEnabled,"onUpdate:modelValue":t[21]||(t[21]=e=>ja.value.readingAloudEnabled=e),label:"Enable Reading Aloud",color:"primary",size:"lg",class:R(["mb-2 settings-toggle enhanced-settings-toggle",{"toggle-enabled":ja.value.readingAloudEnabled,"toggle-disabled":!ja.value.readingAloudEnabled}])},{default:T(()=>[N(s,{class:R(["bg-grey-8 text-white tooltip-enhanced",{"tooltip-success":ja.value.readingAloudEnabled,"tooltip-warning":!ja.value.readingAloudEnabled}]),anchor:"top middle",self:"bottom middle"},{default:T(()=>[N(n,{name:ja.value.readingAloudEnabled?"volume_up":"volume_off",size:"xs",class:"mr-1"},null,8,["name"]),F(" "+M(ja.value.readingAloudEnabled?"Reading aloud is enabled - the app will play text aloud where supported":"Reading aloud is disabled - no text-to-speech will play"),1)]),_:1},8,["class"])]),_:1},8,["modelValue","class"]),D("div",Xe,[N(n,{name:ja.value.readingAloudEnabled?"check_circle":"cancel",color:ja.value.readingAloudEnabled?"positive":"negative",size:"sm",class:R(["status-icon",{"icon-pulse":ja.value.readingAloudEnabled}])},{default:T(()=>[N(s,{class:R(ja.value.readingAloudEnabled?"bg-positive text-white":"bg-negative text-white"),anchor:"top middle",self:"bottom middle"},{default:T(()=>[N(n,{name:ja.value.readingAloudEnabled?"thumb_up":"thumb_down",size:"xs",class:"mr-1"},null,8,["name"]),F(" Reading aloud is "+M(ja.value.readingAloudEnabled?"active":"inactive"),1)]),_:1},8,["class"])]),_:1},8,["name","color","class"]),D("span",{class:R(["text-sm font-medium transition-all duration-300",ja.value.readingAloudEnabled?"text-positive":"text-negative"])},M(ja.value.readingAloudEnabled?"Enabled":"Disabled"),3),D("div",{class:R(["ml-2 w-2 h-2 rounded-full transition-all duration-300",ja.value.readingAloudEnabled?"bg-positive shadow-green-glow animate-pulse":"bg-negative shadow-red-glow"])},null,2)])]),D("div",Ze,[N(n,{name:"info",size:"xs",class:"mr-1"}),t[52]||(t[52]=F(" When enabled, the app will play text aloud where supported (text-to-speech) "))])]),_:1}),N(a,null,{default:T(()=>[D("div",et,[N(n,{name:"photo_camera",color:"primary"}),t[53]||(t[53]=F(" Avatar Management "))]),D("div",tt,[N(i,{modelValue:zt.value,"onUpdate:modelValue":t[22]||(t[22]=e=>zt.value=e),label:"Enable Avatar Editing",color:"primary",size:"lg",class:R(["mb-2 settings-toggle enhanced-settings-toggle",{"toggle-enabled":zt.value,"toggle-disabled":!zt.value}])},{default:T(()=>[N(s,{class:R(["bg-grey-8 text-white tooltip-enhanced",{"tooltip-success":zt.value,"tooltip-warning":!zt.value}]),anchor:"top middle",self:"bottom middle"},{default:T(()=>[N(n,{name:zt.value?"photo_camera":"photo_camera_off",size:"xs",class:"mr-1"},null,8,["name"]),F(" "+M(zt.value?"Avatar editing is currently enabled - students can upload/capture photos":"Avatar editing is currently disabled - students cannot change photos"),1)]),_:1},8,["class"])]),_:1},8,["modelValue","class"]),D("div",at,[N(n,{name:zt.value?"check_circle":"cancel",color:zt.value?"positive":"negative",size:"sm",class:R(["status-icon",{"icon-pulse":zt.value}])},{default:T(()=>[N(s,{class:R(zt.value?"bg-positive text-white":"bg-negative text-white"),anchor:"top middle",self:"bottom middle"},{default:T(()=>[N(n,{name:zt.value?"thumb_up":"thumb_down",size:"xs",class:"mr-1"},null,8,["name"]),F(" Avatar editing is "+M(zt.value?"active":"inactive"),1)]),_:1},8,["class"])]),_:1},8,["name","color","class"]),D("span",{class:R(["text-sm font-medium transition-all duration-300",zt.value?"text-positive":"text-negative"])},M(zt.value?"Enabled":"Disabled"),3),D("div",{class:R(["ml-2 w-2 h-2 rounded-full transition-all duration-300",zt.value?"bg-positive shadow-green-glow animate-pulse":"bg-negative shadow-red-glow"])},null,2)])]),D("div",lt,[N(n,{name:"info",size:"xs",class:"mr-1"}),t[54]||(t[54]=F(" When enabled, students can upload or capture new profile pictures "))])]),_:1}),N(o),(null==(e=ya.value.my_sel_classroom_students)?void 0:e.length)?(O(),P(a,{key:0},{default:T(()=>{var e,a,o,r,d;return[t[56]||(t[56]=D("div",{class:"text-subtitle1 mb-3 font-semibold"},"Student Attendance",-1)),t[57]||(t[57]=D("div",{class:"text-caption text-grey-6 mb-4"}," Mark students as present or absent. Absent students will appear grayed out. ",-1)),D("div",st,[(O(!0),V(Q,null,B(ya.value.my_sel_classroom_students,e=>(O(),V("div",{key:e.id,class:R(["attendance-item flex items-center justify-between p-3 rounded-lg mb-2 transition-all duration-300 hover:shadow-md",[qa(e.id)?"bg-green-50 hover:bg-green-100 border-l-4 border-green-400 attendance-present":"bg-red-50 hover:bg-red-100 border-l-4 border-red-400 attendance-absent"]])},[D("div",nt,[D("div",ot,[N(v,{size:"40px",class:"attendance-avatar"},{default:T(()=>[N(w,{src:e.avatar||ia(e.name),class:R(["rounded-full transition-all duration-300",{"grayscale opacity-60 blur-sm":!qa(e.id)}])},null,8,["src","class"])]),_:2},1024),D("div",it,[N(n,{name:qa(e.id)?"check_circle":"cancel",color:qa(e.id)?"positive":"negative",size:"sm",class:R(["bg-white rounded-full shadow-sm attendance-status-icon",{"pulse-animation":!qa(e.id)}])},{default:T(()=>[N(s,{class:R(qa(e.id)?"bg-positive text-white":"bg-negative text-white"),anchor:"top middle",self:"bottom middle"},{default:T(()=>[N(n,{name:qa(e.id)?"person":"person_off",size:"xs",class:"mr-1"},null,8,["name"]),F(" "+M(e.first_name)+" is "+M(qa(e.id)?"present":"absent"),1)]),_:2},1032,["class"])]),_:2},1032,["name","color","class"])]),D("div",{class:R(["absolute inset-0 rounded-full border-2 transition-all duration-300",qa(e.id)?"border-green-400 shadow-green-glow":"border-red-400 shadow-red-glow"])},null,2)]),D("div",rt,[D("div",{class:R(["font-medium transition-all duration-300",qa(e.id)?"text-grey-8":"text-grey-5 line-through"])},[F(M(e.first_name)+" "+M(e.last_name)+" ",1),qa(e.id)?U("",!0):(O(),P(n,{key:0,name:"visibility_off",size:"xs",class:"ml-1 text-grey-4"}))],2),e.second_name?(O(),V("div",{key:0,class:R(["text-sm transition-all duration-300",qa(e.id)?"text-grey-6":"text-grey-4"])},M(e.second_name),3)):U("",!0)])]),D("div",dt,[N(g,{color:qa(e.id)?"positive":"negative","text-color":"white",size:"sm",class:R(["font-medium attendance-chip transition-all duration-300",{"chip-pulse":!qa(e.id)}]),icon:qa(e.id)?"person":"person_off"},{default:T(()=>[F(M(qa(e.id)?"Present":"Absent")+" ",1),N(s,{class:R(qa(e.id)?"bg-positive text-white":"bg-negative text-white"),anchor:"top middle",self:"bottom middle"},{default:T(()=>[N(n,{name:qa(e.id)?"check":"close",size:"xs",class:"mr-1"},null,8,["name"]),F(" "+M(e.first_name)+" is currently marked as "+M(qa(e.id)?"present":"absent"),1)]),_:2},1032,["class"])]),_:2},1032,["color","class","icon"]),N(i,{"model-value":qa(e.id),"onUpdate:modelValue":t=>(e=>{var t;try{if(!e||"string"!=typeof e&&"number"!=typeof e)throw new Error("Invalid student ID provided");if(!(null==(t=ya.value.my_sel_classroom_students)?void 0:t.some(t=>t.id.toString()===e.toString())))throw new Error(`Student ID ${e} not found in current classroom`);const a=qa(e);ja.value.attendance[e]=!a;const l=ya.value.my_sel_classroom_students.find(t=>t.id.toString()===e.toString()),s=(null==l?void 0:l.first_name)?l.first_name:`Student ${e}`;It.notify({message:`${s} marked as ${a?"absent":"present"}`,color:a?"warning":"positive",position:"top",timeout:2e3,icon:a?"person_off":"person"}),console.log(`Toggled attendance for student ${e}: ${a?"absent":"present"}`)}catch(a){console.error("Error toggling student attendance:",a),It.notify({message:`Failed to update attendance: ${a.message}`,color:"negative",position:"top",timeout:3e3,icon:"error"})}})(e.id),color:qa(e.id)?"positive":"negative",size:"md",class:R(["attendance-toggle enhanced-toggle",{"toggle-absent":!qa(e.id)}])},{default:T(()=>[N(s,{class:"bg-grey-8 text-white tooltip-enhanced",anchor:"top middle",self:"bottom middle"},{default:T(()=>[N(n,{name:qa(e.id)?"toggle_off":"toggle_on",size:"xs",class:"mr-1"},null,8,["name"]),F(" Click to mark "+M(e.first_name)+" as "+M(qa(e.id)?"absent":"present"),1)]),_:2},1024)]),_:2},1032,["model-value","onUpdate:modelValue","color","class"])])],2))),128))]),D("div",ct,[N(l,{color:"positive",icon:"check_circle",label:"Mark All Present",onClick:Ya,size:"sm",class:R(["flex-1 attendance-action-btn enhanced-action-btn",{"btn-success-glow":null==(e=ya.value.my_sel_classroom_students)?void 0:e.every(e=>qa(e.id))}])},{default:T(()=>[N(s,{class:"bg-positive text-white tooltip-enhanced"},{default:T(()=>{var e;return[N(n,{name:"group",size:"xs",class:"mr-1"}),F(" Mark all "+M((null==(e=ya.value.my_sel_classroom_students)?void 0:e.length)||0)+" students in this classroom as present ",1)]}),_:1})]),_:1},8,["class"]),N(l,{color:"negative",icon:"cancel",label:"Mark All Absent",onClick:Xa,size:"sm",class:R(["flex-1 attendance-action-btn enhanced-action-btn",{"btn-warning-glow":null==(a=ya.value.my_sel_classroom_students)?void 0:a.every(e=>!qa(e.id))}])},{default:T(()=>[N(s,{class:"bg-negative text-white tooltip-enhanced"},{default:T(()=>{var e;return[N(n,{name:"group_off",size:"xs",class:"mr-1"}),F(" Mark all "+M((null==(e=ya.value.my_sel_classroom_students)?void 0:e.length)||0)+" students in this classroom as absent ",1)]}),_:1})]),_:1},8,["class"])]),D("div",ut,[D("div",mt,[D("div",vt,[N(n,{name:"group",color:"primary",size:"sm"}),t[55]||(t[55]=D("span",{class:"font-medium"},"Attendance Summary:",-1))]),D("div",gt,[D("div",pt,[N(n,{name:"check_circle",color:"positive",size:"xs"}),D("span",ft,M((null==(o=ya.value.my_sel_classroom_students)?void 0:o.filter(e=>qa(e.id)).length)||0)+" Present ",1)]),D("div",yt,[N(n,{name:"cancel",color:"negative",size:"xs"}),D("span",ht,M((null==(r=ya.value.my_sel_classroom_students)?void 0:r.filter(e=>!qa(e.id)).length)||0)+" Absent ",1)])])]),D("div",bt,[N(_,{value:(null==(d=ya.value.my_sel_classroom_students)?void 0:d.length)?ya.value.my_sel_classroom_students.filter(e=>qa(e.id)).length/ya.value.my_sel_classroom_students.length:0,color:"positive","track-color":"negative",size:"8px",rounded:"",class:"attendance-progress"},{default:T(()=>[N(s,{class:"bg-grey-8 text-white"},{default:T(()=>{var e;return[F(M(Math.round(100*((null==(e=ya.value.my_sel_classroom_students)?void 0:e.length)?ya.value.my_sel_classroom_students.filter(e=>qa(e.id)).length/ya.value.my_sel_classroom_students.length:0)))+"% attendance rate ",1)]}),_:1})]),_:1},8,["value"])])])]}),_:1})):(O(),P(a,{key:1},{default:T(()=>[D("div",wt,[N(n,{name:"school",size:"4rem",class:"mb-4"}),t[58]||(t[58]=D("div",{class:"text-h6 mb-2"},"No Classroom Selected",-1)),t[59]||(t[59]=D("div",{class:"text-body2"}," Please select a classroom to manage student attendance ",-1))])]),_:1})),N(o),N(c,{align:"right",class:"q-pa-md"},{default:T(()=>{var e;return[(null==(e=ya.value.my_classes_with_students)?void 0:e.length)>1?(O(),P(l,{key:0,flat:"",label:"Test Classroom Switching",color:"info",onClick:Ba,size:"sm",class:"mr-2"},{default:T(()=>[N(s,{class:"bg-info text-white"},{default:T(()=>[N(n,{name:"swap_horiz",size:"xs",class:"mr-1"}),t[60]||(t[60]=F(" Test settings behavior by switching between all available classrooms "))]),_:1})]),_:1})):U("",!0),N(l,{flat:"",label:"Close",color:"grey",onClick:t[23]||(t[23]=e=>Zt.value=!1),size:"md"})]}),_:1})]}),_:1})]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-94df7262"]]);export{St as default};
