import{Q as e}from"./QSpinnerDots-CmOu2EXd.js";import{Q as t}from"./QInnerLoading-D8S1i2qG.js";import{Q as l}from"./QBadge-jxRwPSDj.js";import{Q as a}from"./QTab-BrYgSklz.js";import{Q as o}from"./QTabs-BWwunJzN.js";import{o as r,bk as s,Q as i}from"./app-Cs5CKgHw.js";import{f as n,k as d,a as u,o as c,e as m,N as p,J as v,O as f,b,I as y,Q as h,K as g,F as x,R as w,V as k,S as j,C as T,M as _}from"./vendor-nQjeLEvd.js";import D from"./CurrentEventCard-oGEAu9Aw.js";import N from"./UpcomingEventsCard-Daqzrndb.js";import Q from"./PeriodActivityDrawer-Bum72Spv.js";import"./rtl-Cr6c3OOr.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";import"./QSelect-D-pA-eh-.js";import"./StudentRecordsGrid-B8sngd2T.js";import"./QTabPanel-BXfuden_.js";import"./use-panel-FmIc7Z0R.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-DzMXaeN6.js";import"./purify.es-C2Ba6vpb.js";import"./katex-BXKQVcz-.js";const S={class:"current-event-wrapper"},C={class:"upcoming-events-wrapper"},I={class:"timeline-wrapper"},M={class:"timeline-outer-container"},z={class:"column items-center text-gray-400"},V={class:"sm:hidden md:block text-gray-400"},$={class:"md:hidden text-gray-400"},H={class:"relative",style:{height:"1320px"}},R={class:"absolute left-0 w-20 h-full select-none border-r border-gray-200 bg-white"},A={class:"absolute top-0 w-full flex items-center justify-end pr-2 h-6 bg-gray-50/40"},E={class:"text-sm font-semibold text-gray-600"},F={class:"text-xs text-gray-400"},P={class:"absolute left-20 right-0 h-full"},L=["onClick"],O={class:"px-2"},U={key:0,class:"p-1 flex flex-row gap-4"},B={class:"text-caption"},J={class:"text-subtitle"},K={class:"text-caption"},W={class:"relative"},q={class:"absolute left-0 border-2 border-red-500 rounded-full px-2 overflow-visible flex-row whitespace-nowrap -top-2.5 flex items-center justify-end"},G={class:"p-0 relative -mx-1 bg-red-100 flex flex-row items-center justify-end"},Z={class:"text-sm font-semibold text-red-500"},X=r({__name:"timeline",props:{events:{type:Array,default:()=>[]}},setup(r){const X=r,Y=s(),ee=n(null),te=n(me()),le=n(pe()),ae=n(!1),oe=n(X.events||[]);let re=null;d(()=>X.events,e=>{e&&e.length&&(oe.value=e.map(ge).map(he))},{immediate:!0,deep:!0});const se=n(!1),ie=n(null),ne=n([{label:"Sunday",code:"d1",isToday:!1,date:null},{label:"Monday",code:"d2",isToday:!1,date:null},{label:"Tuesday",code:"d3",isToday:!1,date:null},{label:"Wednesday",code:"d4",isToday:!1,date:null},{label:"Thursday",code:"d5",isToday:!1,date:null},{label:"Friday",code:"d6",isToday:!1,date:null},{label:"Saturday",code:"d7",isToday:!1,date:null}]),de=n((new Date).getDay()),ue=e=>{if(!(null==e?void 0:e.from)||!(null==e?void 0:e.to))return{};const[t,l]=e.from.split(":").map(Number),[a,o]=e.to.split(":").map(Number);return{position:"absolute",top:2*(60*(t-6)+l)+"px",height:2*(60*(a-t)+(o-l))+"px",left:"2.5%",width:"95%",zIndex:"break"===e.type?10:20}},ce=e=>({backgroundColor:e.bgColor||"#fff",color:e.textColor||"#000",opacity:"break"===e.type?.8:1,border:"1px solid rgba(0,0,0,0.1)",borderRadius:"0.375rem"});function me(){const e=new Date,t=e.getHours(),l=e.getMinutes();return t>=6&&t<16?120*(t-6)+2*l:null}function pe(){return(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}function ve(){te.value=me(),le.value=pe()}const fe=u(()=>{var e;if(!(null==(e=oe.value)?void 0:e.length))return null;const t=new Date,l=60*t.getHours()+t.getMinutes();return oe.value.find(e=>{if(!(null==e?void 0:e.from)||!(null==e?void 0:e.to)||"break"===e.type)return!1;const[t,a]=e.from.split(":").map(Number),[o,r]=e.to.split(":").map(Number);return l>=60*t+a&&l<60*o+r})}),be=u(()=>{var e;if(!(null==(e=oe.value)?void 0:e.length))return[];const t=new Date,l=60*t.getHours()+t.getMinutes();return oe.value.filter(e=>{if(!(null==e?void 0:e.from))return!1;const[t,a]=e.from.split(":").map(Number);return 60*t+a>l}).sort((e,t)=>{const[l,a]=e.from.split(":").map(Number),[o,r]=t.from.split(":").map(Number);return 60*l+a-(60*o+r)}).slice(0,2)}),ye=e=>{if(!e)return 0;const t=new Date,[l,a]=e.from.split(":").map(Number),[o,r]=e.to.split(":").map(Number),s=60*l+a,i=60*o+r,n=60*t.getHours()+t.getMinutes();return Math.min(100,Math.max(0,(n-s)/(i-s)*100))},he=e=>{var t,l;return"break"===e.type?{...e,periodCode:`break${(null==(t=e.label.match(/\d+/))?void 0:t[0])||""}`,label:`Break ${(null==(l=e.label.match(/\d+/))?void 0:l[0])||""}`}:e},ge=e=>{if(!(null==e?void 0:e.from)||!(null==e?void 0:e.to))return e;e.from.startsWith("22:")&&(e.from="13:05");const[t,l]=e.from.split(":").map(Number),[a,o]=e.to.split(":").map(Number);return(t>23||t<0||l>59||l<0)&&(console.warn(`Invalid time format found: ${e.from}`),e.from="13:05"),(a>23||a<0||o>59||o<0)&&(console.warn(`Invalid time format found: ${e.to}`),e.to="13:50"),e},xe=e=>{var t,l;console.log("fetchSchedule");const a=null==(l=null==(t=_().props.auth.user)?void 0:t.teacher)?void 0:l.school_id;a?(ae.value=!0,Y.fetchData({endpoint:"/teacher/timeline/schedule",method:"post",data:{school_id:a,day_code:e}}).then(e=>{var t;if(!e.success)throw new Error(e.message||"Failed to fetch schedule");if(!(null==(t=e.data)?void 0:t.schedule)||!Array.isArray(e.data.schedule))throw new Error("Invalid schedule data received");oe.value=e.data.schedule.map(ge).map(he).sort((e,t)=>{const l=e.from.split(":").map(Number),a=t.from.split(":").map(Number);return 60*l[0]+l[1]-(60*a[0]+a[1])})}).catch(e=>{console.error("Failed to fetch schedule:",e),oe.value=[]}).finally(()=>{ae.value=!1})):console.warn("No school ID found in localStorage")},we=()=>{const e=te.value;e&&ee.value&&ee.value.scrollTo({top:e-ee.value.clientHeight/2,behavior:"smooth"})};return c(()=>{const e=new Date,t=e.getDay();ne.value[t].isToday=!0,de.value=t;for(let l=0;l<7;l++){const a=new Date(e);a.setDate(e.getDate()-t+l),ne.value[l].date=a.toISOString().split("T")[0]}xe(ne.value[t].code),ve(),re=setInterval(ve,1e3),setTimeout(we,500)}),m(()=>{re&&clearInterval(re)}),(r,s)=>(v(),p(x,null,[f("div",S,[fe.value?(v(),y(D,{key:0,class:"fixed top-10 left-0 z-40",event:fe.value,"current-time-string":le.value,progress:ye(fe.value)},null,8,["event","current-time-string","progress"])):h("",!0)]),f("div",C,[be.value.length?(v(),y(N,{key:0,class:"fixed right-0 md:top-10 top-40 z-40",events:be.value},null,8,["events"])):h("",!0)]),f("div",I,[s[5]||(s[5]=f("div",{class:"event-cards-container scale-75 z-20"},null,-1)),f("div",M,[b(t,{showing:ae.value},{default:g(()=>[b(e,{color:"primary",size:"40px"})]),_:1},8,["showing"]),b(o,{modelValue:de.value,"onUpdate:modelValue":s[0]||(s[0]=e=>de.value=e),class:"bg-white text-primary shadow-1 sticky top-0","indicator-color":"primary",breakpoint:300,"mobile-arrows":""},{default:g(()=>[(v(!0),p(x,null,w(ne.value,(e,t)=>(v(),y(a,{key:e.code,name:t,onClick:e=>{return l=t,de.value=l,void xe(ne.value[l].code);var l}},{default:g(()=>[f("div",z,[f("span",V,k(e.label),1),f("span",$,k(e.label.slice(0,3)),1),e.isToday?(v(),y(l,{key:0,color:"primary","text-color":"white",label:"Today",class:"q-mt-xs"})):h("",!0)])]),_:2},1032,["name","onClick"]))),128))]),_:1},8,["modelValue"]),f("div",{class:"timeline-container",ref_key:"timelineRef",ref:ee},[f("div",H,[f("div",R,[(v(),p(x,null,w(11,e=>f("div",{key:e,class:"relative h-[120px]"},[f("div",A,[f("span",E,k((e+5).toString().padStart(2,"0"))+":00 ",1)]),(v(),p(x,null,w(11,t=>(v(),p(x,{key:`${e}-${t}`},[t>0?(v(),p("div",{key:0,class:"absolute w-full flex items-center justify-end pr-2",style:j({top:10*t+"px"})},[f("span",F,k((5*t%60).toString().padStart(2,"0")),1)],4)):h("",!0)],64))),64))])),64))]),f("div",P,[b(T,{name:"event",tag:"div",class:"relative"},{default:g(()=>[(v(!0),p(x,null,w(oe.value,e=>(v(),p("div",{key:e.id,class:"absolute transition-all duration-300 group hover:z-30",style:j(ue(e)),onClick:t=>(e=>{"break"!==e.type&&(ie.value={id:e.id,schedule_id:e.id,title:e.title,classroom:e.classroom,subject:e.title,from:e.from,to:e.to,day:ne.value[de.value].label,day_code:ne.value[de.value].code,teacher_id:e.teacher_id,classroom_id:e.classroom_id},se.value=!0)})(e)},[f("div",{class:"full-height my-0 py-1 relative",style:j(ce(e))},[f("div",O,[null!==e.classroom?(v(),p("div",U,[f("div",B,k(e.label),1),f("div",J,k(e.title)+" - "+k(e.classroom),1),f("div",K,k(e.from)+" - "+k(e.to),1)])):h("",!0)])],4)],12,L))),128))]),_:1}),te.value?(v(),p("div",{key:0,class:"absolute left-0 right-0 z-30 transition-all duration-1000",style:j({top:`${te.value}px`})},[f("div",W,[f("div",q,[f("div",G,[f("div",Z,k(le.value),1),s[3]||(s[3]=f("div",{class:"w-2 h-2 absolute -left-6 rounded-full bg-red-500 ml-2"},null,-1))])]),s[4]||(s[4]=f("div",{class:"border-t-2 border-red-500 w-full"},null,-1))])],4)):h("",!0)])]),b(i,{onClick:we,round:"",color:"primary",icon:"mdi-clock-outline",class:"scroll-to-now-btn"})],512)])]),b(Q,{modelValue:se.value,"onUpdate:modelValue":[s[1]||(s[1]=e=>se.value=e),s[2]||(s[2]=e=>{e||(se.value=!1,ie.value=null)})],"period-data":ie.value,"calendar-date":ne.value[de.value].date},null,8,["modelValue","period-data","calendar-date"])],64))}},[["__scopeId","data-v-4e67346e"]]);export{X as default};
