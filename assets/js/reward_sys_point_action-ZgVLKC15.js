import{Z as e}from"./vendor-DNM7Y6Xn.js";const t="/api",a={behaviors:`${t}/behaviors`,studentBehaviors:`${t}/student-behaviors`,pointActions:`${t}/student-behaviors-point-actions`,leaderboard:`${t}/leaderboard`,studentSummary:e=>`${t}/student-behaviors/${e}/summary`,pointActionStatistics:e=>`${t}/student-behaviors/${e}/statistics`,attendance:`${t}/student-attendance`,attendanceBatch:`${t}/student-attendance/batch`};async function s({classroomId:t,startDate:s,endDate:o,limit:r=10}){var n,c;try{const n=await e.get(a.leaderboard,{params:{classroom_id:t,start_date:s,end_date:o,limit:Math.min(r,50)}});return{success:!0,data:Array.isArray(n.data)?n.data:[]}}catch(d){return console.error("Error fetching leaderboard:",d),{success:!1,error:(null==(c=null==(n=d.response)?void 0:n.data)?void 0:c.message)||"Failed to fetch leaderboard",data:[],details:d}}}const o={addPoint:async function(t,s,o=null,r=""){var n,c;try{const n={student_behaviors_id:t,value:parseInt(s),reason_id:o?parseInt(o):null,note:r||null};return{success:!0,data:(await e.post(a.pointActions,n)).data,message:`Point ${s>0?"added":"deducted"} successfully`}}catch(d){return console.error("Error adding point:",d),{success:!1,error:(null==(c=null==(n=d.response)?void 0:n.data)?void 0:c.message)||"Failed to add point",details:d}}},cancelPoint:async function(t,s){var o,r;try{return{success:!0,data:(await e.post(`${a.pointActions}/${t}/cancel`,{cancel_reason:s})).data,message:"Point action canceled successfully"}}catch(n){return console.error("Error canceling point:",n),{success:!1,error:(null==(r=null==(o=n.response)?void 0:o.data)?void 0:r.message)||"Failed to cancel point",details:n}}},restorePoint:async function(t){var s,o;try{return{success:!0,data:(await e.post(`${a.pointActions}/${t}/restore`)).data,message:"Point action restored successfully"}}catch(r){return console.error("Error restoring point:",r),{success:!1,error:(null==(o=null==(s=r.response)?void 0:s.data)?void 0:o.message)||"Failed to restore point",details:r}}},deletePoint:async function(t){var s,o;try{return{success:!0,data:(await e.delete(`${a.pointActions}/${t}`)).data,message:"Point action deleted successfully"}}catch(r){return console.error("Error deleting point:",r),{success:!1,error:(null==(o=null==(s=r.response)?void 0:s.data)?void 0:o.message)||"Failed to delete point",details:r}}},createStudentBehavior:async function(t){var s,o;try{const s={school_id:t.schoolId,student_behaviors_mains_id:t.studentBehaviorsMainsId,student_id:t.studentId,attend:t.attend||null,points_plus:t.pointsPlus||0,points_minus:t.pointsMinus||0,points_details:t.pointsDetails||"",notes:t.notes||null};return{success:!0,data:(await e.post(a.studentBehaviors,s)).data,message:"Student behavior record created successfully"}}catch(r){return console.error("Error creating student behavior:",r),{success:!1,error:(null==(o=null==(s=r.response)?void 0:s.data)?void 0:o.message)||"Failed to create behavior record",details:r}}},getStudentSummary:async function(t){var s,o;try{return{success:!0,data:(await e.get(a.studentSummary(t))).data}}catch(r){return console.error("Error fetching student summary:",r),{success:!1,error:(null==(o=null==(s=r.response)?void 0:s.data)?void 0:o.message)||"Failed to fetch student summary",details:r}}},getPointActions:async function(t){var s,o;try{return{success:!0,data:(await e.get(a.pointActions,{params:{student_behaviors_id:t}})).data}}catch(r){return console.error("Error fetching point actions:",r),{success:!1,error:(null==(o=null==(s=r.response)?void 0:s.data)?void 0:o.message)||"Failed to fetch point actions",details:r}}},getPointStatistics:async function(t){var s,o;try{return{success:!0,data:(await e.get(`${a.pointActions}/statistics/${t}`)).data}}catch(r){return console.error("Error fetching point statistics:",r),{success:!1,error:(null==(o=null==(s=r.response)?void 0:s.data)?void 0:o.message)||"Failed to fetch statistics",details:r}}},fetchBehaviors:async function(){var t,s;try{const t=await e.get(a.behaviors);return{success:!0,data:Array.isArray(t.data)?t.data:[]}}catch(o){return console.error("Error fetching behaviors:",o),{success:!1,error:(null==(s=null==(t=o.response)?void 0:t.data)?void 0:s.message)||"Failed to fetch behaviors",data:[],details:o}}},applyBehaviorToStudents:async function(a,s,o={}){var r,n,c,d,i,l,u,p,v,h,g,y,m,f;try{const m=[],f=[],w="object"==typeof s?s.id:s;if(console.log("üéØ applyBehaviorToStudents called with:",{studentCount:a.length,behaviorIdInput:s,actualBehaviorId:w,behaviorIdType:typeof s}),!w||isNaN(w))return console.error("‚ùå Invalid behavior ID:",s),{success:!1,error:"Invalid behavior ID provided"};for(const s of a){const a={student_id:s,behavior_id:w,date:o.date||(new Date).toISOString().split("T")[0],period_code:o.periodCode||null,notes:o.notes||null};console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"),console.log("üì§ Sending behavior application request"),console.log("   Student ID:",s),console.log("   Behavior ID:",w),console.log("   Date:",a.date),console.log("   Period Code:",a.period_code),console.log("   Payload:",JSON.stringify(a,null,2)),console.log("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");try{const o=await e.post(`${t}/student-behaviors/quick-create`,a);console.log("‚úÖ SUCCESS - Behavior applied for student:",s),console.log("   Response Status:",o.status),console.log("   Response Data:",o.data),m.push({studentId:s,success:!0,data:o.data})}catch(b){console.error("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"),console.error("‚ùå FAILED - Error applying behavior to student:",s),console.error("   HTTP Status:",null==(r=b.response)?void 0:r.status,null==(n=b.response)?void 0:n.statusText),console.error("   Error Message:",null==(d=null==(c=b.response)?void 0:c.data)?void 0:d.message),console.error("   Error Details:",null==(l=null==(i=b.response)?void 0:i.data)?void 0:l.error),console.error("   Validation Errors:",null==(p=null==(u=b.response)?void 0:u.data)?void 0:p.errors),console.error("   Full Response:",null==(v=b.response)?void 0:v.data),console.error("   Sent Payload:",a),console.error("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"),f.push({studentId:s,success:!1,error:(null==(g=null==(h=b.response)?void 0:h.data)?void 0:g.message)||"Failed to apply behavior",fullError:null==(y=b.response)?void 0:y.data})}}return console.log("üéØ BATCH RESULT:",{totalRequests:a.length,successful:m.length,failed:f.length,successRate:`${Math.round(m.length/a.length*100)}%`}),{success:0===f.length,results:m,errors:f,message:`Applied to ${m.length}/${a.length} students`}}catch(w){return console.error("‚ùå OUTER ERROR - Exception in applyBehaviorToStudents:",w),{success:!1,error:(null==(f=null==(m=w.response)?void 0:m.data)?void 0:f.message)||"Failed to apply behavior",details:w}}},fetchLeaderboard:s,getTopStudentsByPeriod:async function({classroomId:e,period:t="week",limit:a=5}){try{const o=new Date;let r;switch(t){case"week":default:r=new Date(o.getTime()-6048e5);break;case"month":r=new Date(o.getFullYear(),o.getMonth(),1);break;case"all":r=new Date("2020-01-01")}const n=e=>e.toISOString().split("T")[0];return s({classroomId:e,startDate:n(r),endDate:n(o),limit:a})}catch(o){return console.error("Error getting top students:",o),{success:!1,error:"Failed to get top students",data:[],details:o}}},updateAttendance:async function(t,s,o={}){var r,n,c;try{const i={student_id:parseInt(t),attend:Boolean(s),date:o.date||(new Date).toISOString().split("T")[0],period_code:o.periodCode||null,classroom_id:o.classroomId||null};try{const t=await e.post(a.attendance,i);return{success:!0,data:t.data,message:(null==(r=t.data)?void 0:r.message)||"Student marked as "+(s?"present":"absent")}}catch(d){return console.warn("Attendance API call failed, falling back to client-only update:",null==(n=null==d?void 0:d.response)?void 0:n.status),{success:!0,data:{studentId:parseInt(t),isPresent:Boolean(s),updatedAt:(new Date).toISOString()},message:`Student marked as ${s?"present":"absent"} (local)`,warning:(null==(c=d.response)?void 0:c.data)||d.message}}}catch(i){return console.error("Error updating attendance:",i),{success:!1,error:"Failed to update attendance",details:i}}},batchUpdateAttendance:async function(t,s={}){var o,r,n;try{if(!t||"object"!=typeof t)return{success:!1,error:"Invalid attendance data"};const d=Object.entries(t).map(([e,t])=>({student_id:parseInt(e),attend:Boolean(t),date:s.date||(new Date).toISOString().split("T")[0],period_code:s.periodCode||null,classroom_id:s.classroomId||null,updated_at:(new Date).toISOString()}));try{const t=await e.post(a.attendanceBatch,{attendance:d});return{success:!0,data:t.data,message:(null==(o=t.data)?void 0:o.message)||`Updated attendance for ${d.length} students`}}catch(c){return console.warn("Batch attendance API call failed, falling back to local update:",null==(r=null==c?void 0:c.response)?void 0:r.status),{success:!0,data:d,message:`Updated attendance for ${d.length} students (local)`,warning:(null==(n=c.response)?void 0:n.data)||c.message}}}catch(d){return console.error("Error batch updating attendance:",d),{success:!1,error:"Failed to batch update attendance",details:d}}},getRecentActions:async function({classroomId:a,date:s,limit:o=10}){var r,n;try{const r=await e.get(`${t}/student-behaviors/recent-actions`,{params:{classroom_id:a,date:s,limit:o}});return{success:!0,data:Array.isArray(r.data.data)?r.data.data:[]}}catch(c){return console.error("Error fetching recent actions:",c),{success:!1,error:(null==(n=null==(r=c.response)?void 0:r.data)?void 0:n.message)||"Failed to fetch recent actions",data:[]}}},undoAction:async function(a,s="Undone by teacher"){var o,r;try{const o=await e.post(`${t}/student-behaviors/actions/${a}/cancel`,{cancel_reason:s});return{success:!0,data:o.data.data,message:o.data.message||"Action undone successfully"}}catch(n){return console.error("Error undoing action:",n),{success:!1,error:(null==(r=null==(o=n.response)?void 0:o.data)?void 0:r.message)||"Failed to undo action"}}},formatPointValue:function(e){return e>0?`+${e} ‚≠ê`:e<0?`${e} ‚ö†Ô∏è`:"0"},getActionTypeLabel:function(e){return{plus:"Added",minus:"Deducted",cancel:"Canceled",revoke:"Revoked"}[e]||e},calculateTotalPoints:function(e,t=!1){return Array.isArray(e)?e.filter(e=>t||!e.canceled).reduce((e,t)=>e+(t.value||0),0):0},separatePoints:function(e){if(!Array.isArray(e))return{positive:0,negative:0};const t=e.filter(e=>!e.canceled);return{positive:t.filter(e=>e.value>0).reduce((e,t)=>e+t.value,0),negative:Math.abs(t.filter(e=>e.value<0).reduce((e,t)=>e+t.value,0))}},isActionEditable:function(e,t=24){try{const a=new Date(e);return(new Date-a)/36e5<t}catch(a){return!1}},getUserFriendlyErrorMessage:function(e){var t,a,s,o,r,n,c;return 401===(null==(t=e.response)?void 0:t.status)?"You are not authenticated. Please log in.":403===(null==(a=e.response)?void 0:a.status)?"You do not have permission to perform this action.":404===(null==(s=e.response)?void 0:s.status)?"The requested resource was not found.":422===(null==(o=e.response)?void 0:o.status)?"Invalid data provided. Please check your input.":500===(null==(r=e.response)?void 0:r.status)?"Server error. Please try again later.":"Network Error"===e.message?"Network error. Please check your connection.":(null==(c=null==(n=e.response)?void 0:n.data)?void 0:c.message)||"An unexpected error occurred."},retryWithBackoff:async function(e,t=3,a=1e3){let s;for(let r=0;r<t;r++)try{return await e()}catch(o){if(s=o,r<t-1){const e=a*Math.pow(2,r);await new Promise(t=>setTimeout(t,e))}}throw s}};export{o as r};
