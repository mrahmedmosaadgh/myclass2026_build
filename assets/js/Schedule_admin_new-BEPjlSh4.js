import{p as e,bi as l,u as a,Q as o,q as r,o as n,n as t,aD as s,b as d}from"./app-DXXarK7I.js";import{Q as i}from"./QSlider-CR6iWVp_.js";import{Q as u}from"./QTab-DzZGFS5V.js";import{Q as c}from"./QTabs-BC5MrYhV.js";import{Q as v}from"./QBadge-ZjTd_Ty8.js";import{Q as p}from"./QSpace-B3qNlK-o.js";import{Q as m}from"./QBar-DbALyydt.js";import f from"./ScheduleCell-BDaOgmVc.js";import h from"./TeacherSchedule-BRcrlBQa.js";import{a2 as g,N as x,f as y,a as b,k as _,e as w,L as k,I,V as $,M as j,b as S,U as V,J as C,F as T,Q as M,H as Q,$ as U,R as F,S as z,x as A,X as D,O as E}from"./vendor-EI0FRBVb.js";import H from"./filtered_teachers-DH7nbS8o.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./ui-B__oX9pK.js";import"./rtl-Cr6c3OOr.js";import"./QTable-CIXbyzJI.js";import"./QMarkupTable-BVGvqYSu.js";import"./QSelect-OI6RFhnT.js";import"./QLinearProgress-BEkk-xFg.js";import"./use-fullscreen-DIOkwRkq.js";const P={class:"controls flex items-center gap-2 mb-2"},R={class:"text-sm ml-2 w-12 text-right"},L={class:"relative"},N={class:"schedule-grid-scroll-container w-full px-2 overflow-auto",style:{height:"calc(100vh - 200px)"}},B={class:"flex flex-nowrap"},O={class:"flex flex-nowrap bg-gray-100"},q={class:"p-0 absolute top-0 z-30 bg-gray-300 text-sm text-center w-full border-b border-gray-400"},J={class:""},W={class:"schedule-grid w-max"},X={class:"flex flex-nowrap"},G={class:"flex flex-nowrap bg-gray-100"},K={class:"p-0 absolute top-0 z-30 bg-gray-300 text-sm text-center w-full border-b border-gray-400"},Y={class:"p-0 absolute top-0 right-10 scale-50 h-full w-8"},Z={class:"flex flex-nowrap"},ee=["onClick","onMouseenter"],le={class:"p-0 cursor-default w-full h-full relative"},ae=e({__name:"Schedule_admin_new",props:{days:{type:Array,default:()=>["Sunday","Monday","Tuesday","Wednesday","Thursday"]},periods:{type:Number,default:8},school_id:{type:Number},scheduleData:{type:Array,default:()=>[]}},emits:["cell-click"],setup(e,{emit:ae}){const oe=l();g(oe);const{fetchData:re}=oe,ne=a(),te=e,se=x(),de=y([]);b(()=>se.props.schedule_new_data);const ie=y(se.props.schedule_new_data),ue=y(!0),ce=y(null),ve=y(!1),pe=y([]),me=y(null),fe=y(!0),he=y(!1),ge=y("All"),xe=({filteredTeachers:e,selectedDays:l})=>{de.value=(null==e?void 0:e.length)?e:ie.value||[],(null==l?void 0:l.length)>0?be.value=l.map(e=>({name:e,originalIndex:te.days.indexOf(e)})):be.value=te.days.map((e,l)=>({name:e,originalIndex:l}))};_(ge,e=>{if("All"===e)be.value=te.days.map((e,l)=>({name:e,originalIndex:l}));else{const l=te.days.findIndex(l=>l===e);-1!==l&&(be.value=[{name:e,originalIndex:l}])}}),_(()=>ie.value,e=>{de.value.length||(de.value=e||[])},{immediate:!0});const ye=b(()=>["All",...te.days]),be=y(te.days.map((e,l)=>({name:e,originalIndex:l}))),_e=y(100),we=y(!1);b(()=>_e.value/100);const ke=()=>{_e.value=Math.min(_e.value+10,150)},Ie=()=>{_e.value=Math.max(_e.value-10,50)},$e=()=>{ie.value.forEach(e=>{if(e.teacher){const l=Math.floor(256*Math.random()),a=Math.floor(256*Math.random()),o=Math.floor(256*Math.random()),r=`#${l.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")}${o.toString(16).padStart(2,"0")}`,n=(.299*l+.587*a+.114*o)/255>.5?"#000000":"#FFFFFF";e.teacher.c_bg=r,e.teacher.c_text=n}})},je=ae,Se=y({day:null,period:null,teacher:null}),Ve=y({day:null,period:null,teacher:null}),Ce=y({}),Te=y({}),Me=(e,l,a)=>{const o=`${e}-${l}-${a}`;return Ce.value[o]||!1};y(null);const Qe=y(null),Ue=y(null),Fe=y(null),ze=(e,l,a)=>{const o=`d${l+1}p${a+1}`,r=[];ie.value||(pe.value=r),ie.value.forEach((l,a)=>{var n;if(a===e)return;const t=l[o];t&&t.classroom&&r.push({teacher:(null==(n=l.teacher)?void 0:n.teacher_cute)||"Unknown Teacher",classroom:t.classroom,subject:t.subject_cute||"Unknown Subject"})}),pe.value=r},Ae=e=>{Ue.value&&(Ue.value=null,Ve.value={day:null,period:null,teacher:null},je("cell-click",{teacherIndex:null,dayIndex:null,periodIndex:null}))};w(()=>{Fe.value&&clearTimeout(Fe.value)});const De=()=>{te.school_id?(we.value=!0,re({endpoint:route("schedules.assign_colors"),method:"post",data:{school_id:te.school_id},successMessage:"Colors saved successfully!",errorMessage:"Failed to save colors",onSuccess:e=>{},onError:e=>{console.error("Error saving colors:",e)},onBefore:()=>{we.value=!0}}).finally(()=>{we.value=!1})):ne.notify({type:"negative",message:"Please select a school first."})},Ee=()=>{te.school_id?re({endpoint:route("admin.schedules.get_data",{school_id:te.school_id}),successMessage:"Schedule data refreshed successfully!",errorMessage:"Failed to refresh schedule data",onSuccess:e=>{ie.value=null==e?void 0:e.teachers_data,me.value=null==e?void 0:e.overall_conflict_counter}}):ne.notify({type:"negative",message:"Please select a school first."})};Ee();const He=e=>{var l,a;if(!e)return 0;let o=0;for(let s=0;s<te.days.length;s++)for(let l=0;l<te.periods;l++){e[`d${s+1}p${l+1}`]&&o++}var r=null==(l=null==e?void 0:e.period_code_empty)?void 0:l.length,n=o,t=(null==(a=null==e?void 0:e.period_code_empty)?void 0:a.length)+o;return{empty:r,filled:n,total:t,val:0==r?t:r+" / "+t}};return(l,a)=>{var g;return I(),k(T,null,[$(" overall_conflict_counter:"+V(me.value)+" ",1),j("div",P,[S(o,{onClick:Ie,icon:"remove",dense:"",flat:""}),S(i,{modelValue:_e.value,"onUpdate:modelValue":a[0]||(a[0]=e=>_e.value=e),min:50,max:150,step:10,style:{width:"200px"}},null,8,["modelValue"]),S(o,{onClick:ke,icon:"add",dense:"",flat:""}),j("span",R,V(_e.value)+"%",1),S(n,{modelValue:ue.value,"onUpdate:modelValue":a[1]||(a[1]=e=>ue.value=e),icon:ue.value?"push_pin":"push_pin_outlined",dense:"",flat:"",class:"ml-4"},{default:C(()=>[S(r,null,{default:C(()=>[$(V(ue.value?"Unfix Header":"Fix Header"),1)]),_:1})]),_:1},8,["modelValue","icon"]),S(n,{modelValue:he.value,"onUpdate:modelValue":a[2]||(a[2]=e=>he.value=e),icon:he.value?"done_all":"unpublished",dense:"",flat:"",class:"ml-4"},null,8,["modelValue","icon"]),S(n,{modelValue:fe.value,"onUpdate:modelValue":a[3]||(a[3]=e=>fe.value=e),icon:fe.value?"lock":"lock_open",dense:"",flat:"",class:"ml-2"},{default:C(()=>[S(r,null,{default:C(()=>[$(V(fe.value?"Unfix Teacher Column":"Fix Teacher Column"),1)]),_:1})]),_:1},8,["modelValue","icon"]),S(c,{modelValue:ge.value,"onUpdate:modelValue":a[4]||(a[4]=e=>ge.value=e),dense:"",class:"ml-4","active-color":"primary","indicator-color":"primary",align:"left","narrow-indicator":""},{default:C(()=>[(I(!0),k(T,null,M(ye.value,e=>(I(),Q(u,{key:e,name:e,label:e},null,8,["name","label"]))),128))]),_:1},8,["modelValue"]),S(o,{onClick:$e,label:"Assign Colors",color:"secondary",dense:"",class:"ml-4",icon:"palette"}),S(H,{"schedule-data":ie.value,days:te.days,onFilterChanged:xe},null,8,["schedule-data","days"])]),S(o,{label:"update_grid_fun",color:"primary",onClick:a[5]||(a[5]=e=>Ee())}),j("div",L,[j("div",N,[j("div",{class:"relative my-2 pb-10 pr-10",style:F({transform:`scale(${_e.value/100})`,transformOrigin:"top left"}),onContextmenu:U(Ae,["prevent"])},[j("div",{class:z(["py-1 bg-gray-300 border-b border-gray-200 w-max",{"sticky top-0 z-40":ue.value,hidden:!ue.value}])},[j("div",B,[a[7]||(a[7]=j("div",{class:"teacher-cell flex items-center justify-center font-medium text-gray-700 border-r border-gray-200 bg-gray-300"}," Teacher ",-1)),j("div",O,[(I(!0),k(T,null,M(be.value,e=>(I(),k("div",{key:e.originalIndex,class:"day-column flex-shrink-0"},[j("div",q,V(e.name),1),(I(!0),k(T,null,M(te.periods,(l,a)=>(I(),k("div",{key:`${e.originalIndex}-${a}`,class:z([Ue.value==e.originalIndex+"-"+a?"period-cell-selected":"","period-cell-head mt-4 text-sm text-center w-[70px] h-12"])},V(l),3))),128))]))),128))])])],2),j("div",J,[j("div",W,[j("div",{id:"HeaderRow",class:z(["py-1 bg-gray-300 border-b border-gray-200 w-max",{"hidden top-0 z-40":ue.value}])},[j("div",X,[j("div",{class:z(["teacher-cell flex items-center justify-center font-medium text-gray-700 border-r border-gray-200 bg-gray-300",{"sticky left-0 z-50":fe.value}])}," Teacher ",2),j("div",G,[(I(!0),k(T,null,M(be.value,e=>(I(),k("div",{key:e.originalIndex,class:"day-column flex-shrink-0"},[j("div",K,V(e.name),1),(I(!0),k(T,null,M(te.periods,(l,a)=>(I(),k("div",{key:`${e.originalIndex}-${a}`,class:z([Ue.value==e.originalIndex+"-"+a?"period-cell-selected":"","period-cell-head mt-4 text-sm text-center w-[70px] h-12"])},V(l),3))),128))]))),128))])])],2),j("div",null,[(I(!0),k(T,null,M(((null==(g=de.value)?void 0:g.length)?de.value:ie.value)||[],(l,a)=>{var t,s,d,i,u;return A((I(),k("div",{key:a,class:z(["teacher-row flex flex-nowrap min-w-max relative",Ve.value.teacher==a?"bg-red-50 text-lg z-20":"hover:bg-gray-50"])},[j("div",{id:"teacher-col",class:z(["teacher-cell flex items-center",{"sticky left-0 z-30 bg-white":fe.value,"bg-red-50":Ve.value.teacher===a&&!fe.value,"bg-gray-50":Ve.value.teacher!==a&&!fe.value}])},[j("div",{class:"truncate px-2 text-lg flex items-center flex-nowrap overflow-visible rounded",style:F({backgroundColor:null==(t=l.teacher)?void 0:t.c_bg,color:null==(s=l.teacher)?void 0:s.c_text})},[j("div",Y,[S(n,{modelValue:l.teacher.show,"onUpdate:modelValue":e=>l.teacher.show=e},null,8,["modelValue","onUpdate:modelValue"]),S(o,{onClick:e=>{ce.value=l.teacher.id,ve.value=!0},icon:"person",flat:"",dense:""},null,8,["onClick"])]),(null==(d=He(l))?void 0:d.empty)>0?(I(),Q(v,{key:0,class:"mx-1",rounded:"",color:"red",label:null==(i=He(l))?void 0:i.empty},null,8,["label"])):E("",!0),$(" "+V(null==(u=l.teacher)?void 0:u.teacher_cute)+" ",1),S(r,{"transition-show":"rotate","transition-hide":"rotate",anchor:"top end",self:"top left",delay:500,class:"text-body2 whitespace-nowrap"},{default:C(()=>{var e,a;return[S(v,{class:"w-12 mx-1",rounded:"",color:0==(null==(e=He(l))?void 0:e.empty)?"green":""},{default:C(()=>{var e;return[$(V(null==(e=He(l))?void 0:e.val),1)]}),_:2},1032,["color"]),$(" "+V(null==(a=l.teacher)?void 0:a.name),1)]}),_:2},1024)],4)],2),j("div",Z,[(I(!0),k(T,null,M(be.value,o=>(I(),k("div",{key:o.originalIndex,class:"day-column flex-shrink-0"},[(I(!0),k(T,null,M(e.periods,(e,r)=>{var n,t;return I(),k("div",{key:`${o.originalIndex}-${r}`,class:z(["period-cell hover:scale-125",Ue.value==o.originalIndex+"-"+r+"-"+a?"period-cell-selected":""]),style:F({backgroundColor:(null==(n=l[`d${o.originalIndex+1}p${r+1}`])?void 0:n.c_bg)||"#ffffff",color:(null==(t=l[`d${o.originalIndex+1}p${r+1}`])?void 0:t.c_text)||"#333333"," border-l-2 border-gray-800   bg-black h-12 ":0==r}),onClick:e=>((e,l,a)=>{Ue.value=l+"-"+a+"-"+e,Ve.value.day=l,Ve.value.period=a,Ve.value.teacher=e,ze(e,l,a),je("cell-click",{teacherIndex:e,dayIndex:l,periodIndex:a})})(a,o.originalIndex,r),onMouseenter:e=>{return l=o.originalIndex,a=r,Fe.value&&clearTimeout(Fe.value),void(Fe.value=setTimeout(()=>{Se.value.day=l,Se.value.period=a,Qe.value=l+"-"+a},500));var l,a}},[j("div",le,[j("div",{class:z(["p-0 absolute -top-4 -left-1 w-2 h-12",0==r?" border-l-2 border-gray-800  ":""])},null,2),S(f,{is_confirm:he.value,teacher_data:l,"day-index":o.originalIndex,"period-index":r,period_code:`d${o.originalIndex+1}p${r+1}`,"selected-period":Ve.value,"hover-period":Se.value,conflicts:pe.value,locked:Me(a,o.originalIndex,r),onToggleLock:()=>((e,l,a)=>{const o=`${e}-${l}-${a}`;Ce.value[o]=!Ce.value[o]})(a,o.originalIndex,r),onToggleDisable:()=>((e,l,a)=>{const o=`${e}-${l}-${a}`;Te.value[o]=!Te.value[o]})(a,o.originalIndex,r),onUpdate_grid:Ee},null,8,["is_confirm","teacher_data","day-index","period-index","period_code","selected-period","hover-period","conflicts","locked","onToggleLock","onToggleDisable"])])],46,ee)}),128))]))),128))])],2)),[[D,l.teacher.show]])}),128))])])])],36)])]),S(m,{class:"fixed bottom-0 left-0 right-0 bg-primary text-white z-50"},{default:C(()=>[S(o,{onClick:$e,label:"Assign Colors",color:"secondary",dense:"",class:"ml-4",icon:"palette"}),S(o,{onClick:De,label:"Save Colors",color:"positive",dense:"",class:"ml-2",loading:we.value,icon:"save"},null,8,["loading"]),S(o,{flat:"",round:"",dense:"",icon:"account_balance"},{default:C(()=>[S(r,null,{default:C(()=>a[8]||(a[8]=[$("Institution Settings")])),_:1})]),_:1}),S(o,{flat:"",round:"",dense:"",icon:"person"},{default:C(()=>[S(r,null,{default:C(()=>a[9]||(a[9]=[$("Teacher Mode")])),_:1})]),_:1}),S(o,{flat:"",round:"",dense:"",icon:"school"},{default:C(()=>[S(r,null,{default:C(()=>a[10]||(a[10]=[$("Class Settings")])),_:1})]),_:1}),S(o,{flat:"",round:"",dense:"",icon:"book"},{default:C(()=>[S(r,null,{default:C(()=>a[11]||(a[11]=[$("Subject/Resource Manager")])),_:1})]),_:1}),S(o,{flat:"",round:"",dense:"",icon:"meeting_room"},{default:C(()=>[S(r,null,{default:C(()=>a[12]||(a[12]=[$("Room/Place Editor")])),_:1})]),_:1}),S(o,{flat:"",round:"",dense:"",icon:"settings"},{default:C(()=>[S(r,null,{default:C(()=>a[13]||(a[13]=[$("View/Export Settings")])),_:1})]),_:1}),S(p)]),_:1}),$(" school_id:"+V(e.school_id)+" ",1),a[15]||(a[15]=j("br",null,null,-1)),$(" teacherIdSelected:"+V(ce.value)+" ",1),a[16]||(a[16]=j("br",null,null,-1)),a[17]||(a[17]=j("br",null,null,-1)),a[18]||(a[18]=j("br",null,null,-1)),a[19]||(a[19]=j("br",null,null,-1)),a[20]||(a[20]=j("br",null,null,-1)),a[21]||(a[21]=j("br",null,null,-1)),a[22]||(a[22]=j("br",null,null,-1)),a[23]||(a[23]=j("br",null,null,-1)),S(d,{modelValue:ve.value,"onUpdate:modelValue":a[6]||(a[6]=e=>ve.value=e),persistent:"",maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:C(()=>[S(t,{class:"bg-primary text-white"},{default:C(()=>[S(m,null,{default:C(()=>[S(p),A((I(),Q(o,{dense:"",flat:"",icon:"close"},{default:C(()=>[S(r,{class:"bg-white text-primary"},{default:C(()=>a[14]||(a[14]=[$("Close")])),_:1})]),_:1})),[[s]])]),_:1}),e.school_id&&ce.value?(I(),Q(h,{key:0,"teacher-id":ce.value,"school-id":e.school_id},null,8,["teacher-id","school-id"])):E("",!0)]),_:1})]),_:1},8,["modelValue"])],64)}}},[["__scopeId","data-v-5a8477fa"]]);export{ae as default};
