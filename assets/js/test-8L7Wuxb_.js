import{l as e}from"./ui-B7TfxbV_.js";import t from"./Modal_99-D42cu0St.js";import n from"./TestWorksheetSettings-D03bMQEM.js";import s from"./TestWorksheetDisplay-Coa8VPgC.js";import{_ as o}from"./LucideIcon-CYYJCXCs.js";import{_ as i}from"./PrimaryButton-DVJXOzHH.js";import{r as a}from"./questionParser-DdZqDloY.js";import{f as r,k as l,N as d,J as u,b as m,K as p,W as c,R as g,y as v,ab as h,ae as y,I as f,O as b,V as x}from"./vendor-BWKGNkNB.js";import"./app-Dtv5Fi9L.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./createLucideIcon-bevK9Pnz.js";import"./printer-yyUpIzJF.js";import"./image-T1FtDBZI.js";import"./katex-BXKQVcz-.js";import"./purify.es-C2Ba6vpb.js";const w={class:"flex items-center justify-between"},k={class:"flex items-center space-x-2"},q={class:"p-0"},j={class:"min-h-[60vh] p-6"},C={class:"hidden"},P={key:1,class:"text-center text-gray-500 py-8"},$={class:"flex items-center justify-between w-full px-6 py-4 bg-gray-50"},T={class:"flex items-center space-x-2"},D={class:"inline-flex items-center"},S={__name:"test",props:{questions:{type:Array,required:!0,validator:e=>Array.isArray(e)}},emits:["generate","close","update:questions"],setup(S,{emit:_}){const E=S,F=r(!1),A=r(!1),L=r({showOptions:!0,showCorrectAnswers:!1,showExplanations:!1,showScore:!0,layout:"compact",showStepNumbers:!0,showNotes:!0,optionsPerRow:"2"}),R=r(null),I=r("A4"),O=r(!1),W=r([...E.questions]),Q=()=>{W.value=[...E.questions].map(e=>({value:e,sort:Math.random()})).sort((e,t)=>e.sort-t.sort).map(({value:e})=>e),R.value&&R.value.$forceUpdate(),e.success("Questions randomized successfully")},z=_,N=e=>{console.log("Received settings:",e),L.value=e},U=()=>{A.value=!1},Y=()=>{const e=window.open("","_blank"),t=`\n        <!DOCTYPE html>\n        <html>\n        <head>\n            <title>Test Worksheet</title>\n            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css">\n            <style>\n                @page {\n                    size: ${I.value};\n                    margin: 1cm;\n                }\n                body {\n                    font-family: system-ui, -apple-system, sans-serif;\n                    line-height: 1.5;\n                    margin: 0;\n                    padding: 1cm;\n                }\n                .question-item {\n                    page-break-inside: avoid;\n                    margin-bottom: 2em;\n                }\n                .options-container {\n                    display: grid;\n                    grid-template-columns: repeat(${L.value.optionsPerRow}, minmax(0, 1fr));\n                    gap: 12px;\n                    width: 100%;\n                    margin-bottom: 1em;\n                }\n                .option-item {\n                    break-inside: avoid;\n                    min-width: 0;\n                    padding: 12px;\n                }\n            </style>\n        </head>\n        <body>\n            ${n=W.value,n.map((e,t)=>`\n        <div class="question-item">\n            <div class=" inline-block question-content">\n                <span class="question-number  pr-2 ">  ${t+1}.</span>\n                ${a(e.body)}</div>\n            ${e.options&&L.value.showOptions?`<div class="options-container">\n                    ${e.options.map((e,t)=>`\n                        <div class="option-item">\n                            <div style="display: flex; align-items: start; gap: 8px;">\n                                <span class="option-label">${String.fromCharCode(65+t)}.</span>\n                                <span class="option-text">${a(e.option)}</span>\n                                ${L.value.showCorrectAnswers&&e.isCorrect?'<span class="correct-marker" style="color: #15803d; margin-left: 8px;">(Correct)</span>':""}\n                            </div>\n                        </div>\n                    `).join("")}\n                </div>`:""}\n            ${L.value.showExplanations&&e.explanation?`<div class="explanation" style="margin-top: 1em; padding: 1em; background-color: #eff6ff; border: 1px solid #bfdbfe; border-radius: 6px;">\n                    <div style="font-weight: 500; color: #1e40af;">Explanation:</div>\n                    <div style="color: #1e3a8a;">${a(e.explanation)}</div>\n                </div>`:""}\n        </div>\n    `).join("")}\n        </body>\n        </html>\n    `;var n;e.document.write(t),e.document.close(),setTimeout(()=>{e.print(),e.onafterprint=()=>{e.close()}},500)},G=async()=>{if(R.value){const n="pdf-generation";try{e.info("Generating PDF...",{autoClose:!1,toastId:n});const t=window.open("","_blank"),s=document.getElementById("worksheet-content");t.document.write(`\n                <!DOCTYPE html>\n                <html>\n                <head>\n                    <title>Test Worksheet</title>\n                    <style>\n                        @page {\n                            size: ${I.value};\n                            margin: 1cm;\n                        }\n                        body {\n                            font-family: system-ui, -apple-system, sans-serif;\n                            line-height: 1.5;\n                            margin: 0;\n                            padding: 1cm;\n                        }\n                        .question-item {\n                            page-break-inside: avoid;\n                            margin-bottom: 2em;\n                        }\n                        img {\n                            max-width: 100%;\n                            height: auto;\n                        }\n                        @media print {\n                            .question-item {\n                                break-inside: avoid;\n                            }\n                        }\n                        ${O.value?"":".correct-answer { display: none; }"}\n                    </style>\n                </head>\n                <body>\n                    ${s.innerHTML}\n                </body>\n                </html>\n            `),t.document.close(),t.onload=()=>{t.document.title=`test_worksheet_${(new Date).toISOString().slice(0,10)}`,t.print(),t.onafterprint=()=>{t.close(),e.update(n,{type:e.TYPE.SUCCESS,content:"PDF generated successfully",autoClose:3e3})}}}catch(t){console.error("PDF generation error:",t),e.update(n,{type:e.TYPE.ERROR,content:"Failed to generate PDF",autoClose:3e3})}}},M=async()=>{try{await axios.post("/api/worksheets",{settings:L.value,format:I.value,includeAnswers:O.value,questions:E.questions}),e.success("Test saved successfully"),U()}catch(t){e.error("Failed to save test")}},V=({question:t,index:n})=>{try{W.value=W.value.filter((e,t)=>t!==n);const s=E.questions.filter(e=>e.id!==t.id);z("update:questions",s),e.success("Question removed from worksheet")}catch(s){console.error("Error removing question:",s),e.error("Failed to remove question")}};return l(()=>E.questions,e=>{console.log("Questions updated:",e)},{immediate:!0}),l(()=>F.value,e=>{console.log("showTestPreview updated:",e)},{immediate:!0}),l(()=>L.value,e=>{console.log("testSettings updated:",e)},{immediate:!0}),(e,a)=>(u(),d("div",null,[m(i,{onClick:a[0]||(a[0]=e=>A.value=!0),class:"flex items-center"},{default:p(()=>[m(o,{name:"file-text",class:"w-4 h-4 mr-2"}),a[3]||(a[3]=c(" Generate Test/Worksheet "))]),_:1}),m(t,{show:A.value,onClose:U,maxWidth:"7xl",closeable:!0},{title:p(()=>[g("div",w,[a[7]||(a[7]=g("h2",{class:"text-lg font-medium"},"Test Preview",-1)),g("div",k,[g("button",{type:"button",class:"inline-flex items-center px-3 py-1 bg-purple-600 text-white text-sm rounded-md hover:bg-purple-700 mr-2",onClick:Q},[m(o,{name:"shuffle",class:"w-4 h-4 mr-1"}),a[4]||(a[4]=c(" Randomize "))]),g("button",{type:"button",class:"inline-flex items-center px-3 py-1 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700",onClick:Y},[m(o,{name:"printer",class:"w-4 h-4 mr-1"}),a[5]||(a[5]=c(" Print "))]),g("button",{type:"button",class:"inline-flex items-center px-3 py-1 bg-green-600 text-white text-sm rounded-md hover:bg-green-700",onClick:G},[m(o,{name:"file-down",class:"w-4 h-4 mr-1"}),a[6]||(a[6]=c(" Download PDF "))])])])]),content:p(()=>{var t;return[m(n,{questions:E.questions,onGenerate:N},null,8,["questions"]),g("div",q,[g("div",j,[g("div",C," showTestPreview: "+x(F.value)+" hasQuestions: "+x(E.questions&&E.questions.length>0)+" questionsLength: "+x(null==(t=E.questions)?void 0:t.length)+" settings: "+x(L.value),1),E.questions&&E.questions.length>0?(u(),f(s,{key:0,questions:W.value,settings:L.value,ref_key:"worksheetDisplay",ref:R,onQuestionDeleted:V},null,8,["questions","settings"])):!e.showSettings||E.questions&&E.questions.length?b("",!0):(u(),d("div",P," No questions available to display "))])])]}),footer:p(()=>[g("div",$,[g("div",T,[v(g("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>I.value=e),class:"rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},a[8]||(a[8]=[g("option",{value:"A4"},"A4 Format",-1),g("option",{value:"Letter"},"Letter Format",-1),g("option",{value:"Legal"},"Legal Format",-1)]),512),[[h,I.value]]),g("label",D,[v(g("input",{type:"checkbox","onUpdate:modelValue":a[2]||(a[2]=e=>O.value=e),class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[y,O.value]]),a[9]||(a[9]=g("span",{class:"ml-2 text-sm text-gray-600"},"Include Answer Key",-1))])]),g("div",{class:"flex space-x-3"},[g("button",{type:"button",class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",onClick:M}," Save Test "),g("button",{type:"button",class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300",onClick:U}," Close ")])])]),_:1},8,["show"])]))}};export{S as default};
