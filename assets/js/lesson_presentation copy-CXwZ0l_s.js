import{p as e,u as t,q as o,Q as a,bq as i,br as l,e as s,h as n,R as r,j as d,A as c,k as u,i as p,ao as f,b,n as m,d as v,aD as g}from"./app-DXXarK7I.js";import{Q as y}from"./QBadge-ZjTd_Ty8.js";import{Q as x}from"./QSpace-B3qNlK-o.js";import{f as h,a as w,k as _,o as j,L as S,I as C,M as k,b as Q,J as q,V as $,y as z,H as P,O as V,x as L,ab as I,aa as T,F as U,Q as A,U as E,am as D,al as M,S as N,$ as O,Z as F}from"./vendor-EI0FRBVb.js";import R from"./TextSlide-C-9xZ5Im.js";import H from"./MediaSlide-DzKwWtVh.js";import{Q as B}from"./QuestionSlide-D0lZvvs3.js";import{u as G}from"./teacherStore-BELNLpdq.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./ui-B__oX9pK.js";import"./RichTextEditor-gncSim_r.js";import"./QColor-k9ZQo2Mz.js";import"./QSlider-CR6iWVp_.js";import"./QTabs-BC5MrYhV.js";import"./rtl-Cr6c3OOr.js";import"./QTab-DzZGFS5V.js";import"./QTabPanels-BXLgHK63.js";import"./use-panel-v2pzMR_n.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanel-Cip5Q1JD.js";import"./purify.es-C2Ba6vpb.js";import"./MathEditor-L5RfSJvW.js";import"./katex-BXKQVcz-.js";import"./MathPastePreview-Bzd3Bz3u.js";import"./QSelect-OI6RFhnT.js";import"./EnhancedQuestionEditor-D_uYM4LH.js";import"./QuestionEditor-D4jjwDhq.js";import"./StepByStepEditor-BqApx5yj.js";import"./QuestionTypeSelector-BwIgN9KD.js";import"./QuizEngine-usQ7KPEQ.js";import"./useQuizI18n-Bzgnl5cn.js";const J={class:"flex h-screen bg-gray-50"},K={class:"flex-1 flex flex-col overflow-hidden"},W={class:"bg-white border-b border-gray-200 px-6 py-3"},Z={class:"flex items-center justify-between"},X={class:"flex gap-2"},Y={class:"bg-white border-b border-gray-200 px-6 py-4"},ee={class:"flex items-start justify-between mb-4"},te={class:"flex-1 mr-4"},oe={class:"flex gap-4 mt-2"},ae=["value"],ie={class:"flex gap-3"},le={class:"flex-1 overflow-y-auto p-8 bg-gray-50 flex justify-center"},se={class:"w-full max-w-4xl bg-white rounded-xl shadow-sm border border-gray-200 min-h-[600px] p-8"},ne={key:0,class:"h-full flex flex-col"},re={class:"mb-6 flex justify-between items-center border-b pb-4"},de={class:"flex-1"},ce={key:1,class:"h-full flex flex-col items-center justify-center text-gray-400"},ue={class:"bg-white w-64 h-full flex flex-col"},pe={class:"p-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50"},fe={class:"flex items-center justify-between"},be={class:"flex items-center gap-2"},me={class:"text-xs text-gray-600 mt-1 flex items-center gap-1"},ve={class:"flex-1 overflow-y-auto p-3 custom-scrollbar"},ge={key:0,class:"bg-white border-t border-gray-100 p-3"},ye={class:"space-y-2"},xe=["onClick"],he={class:"flex justify-between items-center mb-1"},we={class:"font-bold text-xs text-gray-700"},_e={class:"text-[10px] text-gray-500 truncate pl-1 border-l-2 border-gray-300"},je={key:0,class:"text-center py-4 text-gray-400 text-xs italic"},Se={class:"text-h6 flex items-center gap-2"},Ce=["src"],ke={key:1,class:"flex items-center justify-center h-full text-gray-500"},Qe={class:"text-center"},qe=e({__name:"lesson_presentation copy",props:{presentationId:{type:[Number,String],default:null},defaultContext:{type:Object,default:()=>({school_id:1,teacher_id:1,subject_id:1})}},setup(e){const qe=e,$e=G(),ze=t(),Pe=new URLSearchParams(window.location.search).get("id"),Ve=qe.presentationId||Pe,Le=h({name:"New Lesson",description:"Lesson description",grade_id:null,quiz_id:null,slides:[]}),Ie=h([{id:"objectives",title:"Objectives",icon:"ðŸŽ¯",qIcon:"flag",bg:"#fffbeb",bgActive:"#fef3c7",borderColor:"#f59e0b",textColor:"#92400e"},{id:"warmup",title:"Warm-Up",icon:"ðŸ”¥",qIcon:"whatshot",bg:"#fff7ed",bgActive:"#fed7aa",borderColor:"#ea580c",textColor:"#9a3412"},{id:"learn",title:"Learn",icon:"ðŸ“š",qIcon:"menu_book",bg:"#eff6ff",bgActive:"#dbeafe",borderColor:"#3b82f6",textColor:"#1e40af"},{id:"practice",title:"Practice",icon:"âœï¸",qIcon:"edit_note",bg:"#faf5ff",bgActive:"#e9d5ff",borderColor:"#a855f7",textColor:"#6b21a8"},{id:"homework",title:"Homework",icon:"ðŸ“–",qIcon:"assignment",bg:"#eef2ff",bgActive:"#c7d2fe",borderColor:"#6366f1",textColor:"#3730a3"},{id:"quiz",title:"Quiz",icon:"ðŸ“",qIcon:"quiz",bg:"#f0fdf4",bgActive:"#bbf7d0",borderColor:"#22c55e",textColor:"#15803d"}]),Te=h("learn"),Ue=h([]),Ae=h(0),Ee=h(!1),De=h(!1),Me=h(!0);h(!0);const Ne=w({get:()=>!ze.screen.lt.sm&&Me.value,set(e){Me.value=e}});w(()=>{const e=Ie.value.find(e=>e.id===Te.value);return e?`Section: ${e.title}`:"Select a section"});const Oe=w(()=>Ue.value.filter(e=>e.section===Te.value)),Fe=w(()=>0===Oe.value.length?null:Oe.value[Ae.value]),Re=e=>{switch(e){case"text":default:return R;case"question":return B;case"image":case"video":case"audio":case"pdf":return H}},He=e=>{var t,o,a;if("text"===e.slide_type){const o=document.createElement("div");return o.innerHTML=(null==(t=e.slide_content)?void 0:t.text)||"",o.textContent||"Text content..."}if("question"===e.slide_type){const t=(null==(a=null==(o=e.slide_content)?void 0:o.questions)?void 0:a.length)||0;return`${t} Question${1!==t?"s":""}`}return`${e.slide_type} content`},Be=()=>{const e={slide_type:"text",slide_content:{},section:Te.value};Ue.value.push(e),Ae.value=Oe.value.length-1},Ge=e=>{const t=document.createElement("DIV");return t.innerHTML=e||"",t.textContent||t.innerText||""},Je=async()=>{if((()=>{var e,t;if(!Le.value.name.trim())return ze.notify({type:"warning",message:"Please enter a lesson name",icon:"warning",position:"top"}),!1;if(!Le.value.grade_id)return ze.notify({type:"warning",message:"Please select a grade",icon:"warning",position:"top"}),!1;for(let o=0;o<Ue.value.length;o++){const a=Ue.value[o];if("question"===a.slide_type){const t=(null==(e=a.slide_content)?void 0:e.questions)||[];if(0===t.length)return ze.notify({type:"warning",message:`Slide ${o+1}: Please add at least one question`,icon:"warning",position:"top"}),Ae.value=o,!1;for(let e=0;e<t.length;e++){const a=t[e];if(!Ge(a.text).trim())return ze.notify({type:"warning",message:`Slide ${o+1}, Question ${e+1}: Question text cannot be empty`,icon:"warning",position:"top"}),Ae.value=o,!1;if(["short_answer","number"].includes(a.type)&&!a.correct_answer)return ze.notify({type:"warning",message:`Slide ${o+1}, Question ${e+1}: Please provide a correct answer`,icon:"warning",position:"top"}),Ae.value=o,!1;if("single_choice"===a.type&&!a.correct_answer)return ze.notify({type:"warning",message:`Slide ${o+1}, Question ${e+1}: Please select a correct option`,icon:"warning",position:"top"}),Ae.value=o,!1;if(["single_choice","multiple_choice"].includes(a.type)){if(!a.options||a.options.length<2)return ze.notify({type:"warning",message:`Slide ${o+1}, Question ${e+1}: Must have at least 2 options`,icon:"warning",position:"top"}),Ae.value=o,!1;for(let t=0;t<a.options.length;t++)if(!Ge(a.options[t].text).trim())return ze.notify({type:"warning",message:`Slide ${o+1}, Question ${e+1}, Option ${t+1}: Option text cannot be empty`,icon:"warning",position:"top"}),Ae.value=o,!1}}}else if("text"===a.slide_type&&!Ge(null==(t=a.slide_content)?void 0:t.text).trim())return ze.notify({type:"warning",message:`Slide ${o+1}: Text content cannot be empty`,icon:"warning",position:"top"}),Ae.value=o,!1}return!0})()){Ee.value=!0;try{const e={...Le.value,school_id:qe.defaultContext.school_id,teacher_id:qe.defaultContext.teacher_id,subject_id:qe.defaultContext.subject_id,grade_id:Le.value.grade_id||qe.defaultContext.grade_id};let t;t=Ve?await F.put(route("lesson-presentation.update",{id:Ve}),e):await F.post(route("lesson-presentation.store"),e);const o=t.data;for(const a of Ue.value)a.id?await F.put(route("lesson-presentation.slides.update",{id:o.id,slideId:a.id}),a):await F.post(route("lesson-presentation.slides.add",{id:o.id}),a);if(ze.notify({type:"positive",message:"Lesson saved successfully!",icon:"check_circle",position:"top",timeout:2e3}),!Ve&&o.id){const e=new URL(window.location);e.searchParams.set("id",o.id),window.history.pushState({},"",e)}}catch(e){console.error("Save failed:",e),ze.notify({type:"negative",message:"Failed to save lesson. Please try again.",icon:"error",position:"top",timeout:3e3})}finally{Ee.value=!1}}},Ke=()=>{window.location.href="/lesson-presentation/edit"},We=async()=>{if(Ve)try{ze.notify({type:"info",message:"Duplicating lesson...",icon:"content_copy",position:"top",timeout:1e3});const e={...Le.value,name:`${Le.value.name} (Copy)`,school_id:qe.defaultContext.school_id,teacher_id:qe.defaultContext.teacher_id,subject_id:qe.defaultContext.subject_id},t=(await F.post(route("lesson-presentation.store"),e)).data;for(const o of Ue.value){const e={slide_type:o.slide_type,slide_content:o.slide_content,section:o.section};await F.post(route("lesson-presentation.slides.add",{id:t.id}),e)}ze.notify({type:"positive",message:"Lesson duplicated successfully!",icon:"check_circle",position:"top",timeout:2e3}),setTimeout(()=>{window.location.href=`/lesson-presentation/edit?id=${t.id}`},500)}catch(e){console.error("Duplicate failed:",e),ze.notify({type:"negative",message:"Failed to duplicate lesson",icon:"error",position:"top",timeout:3e3})}};return _(Te,()=>{Ae.value=0}),j(async()=>{await $e.fetchTeacherData(),Ve?(async e=>{try{const t=await F.get(route("lesson-presentation.show",{id:e}));Le.value={name:t.data.name,description:t.data.description,grade_id:t.data.grade_id,quiz_id:t.data.quiz_id},Ue.value=t.data.slides||[],0===Ue.value.length&&Be()}catch(t){console.error("Fetch failed:",t)}})(Ve):(0===Ue.value.length&&Be(),$e.grades.length>0&&(Le.value.grade_id=$e.grades[0].id))}),(e,t)=>(C(),S(U,null,[k("div",J,[Q(a,{round:"",color:"primary",icon:"menu",class:"fixed bottom-6 left-6 z-50 lg:hidden shadow-lg",onClick:t[0]||(t[0]=e=>Ne.value=!0)},{default:q(()=>[Q(o,null,{default:q(()=>t[10]||(t[10]=[$("Show Sections")])),_:1})]),_:1}),k("div",K,[k("div",W,[k("div",Z,[Q(l,{class:"text-sm"},{default:q(()=>[Q(i,{icon:"home",label:"Dashboard",to:"/dashboard"}),Q(i,{icon:"school",label:"Lessons",to:"/lesson-presentation"}),Q(i,{icon:"edit",label:z(Ve)?"Edit Lesson":"New Lesson"},null,8,["label"])]),_:1}),k("div",X,[Q(a,{flat:"",dense:"",icon:"list",label:"All Lessons",color:"primary",size:"sm",to:"/lesson-presentation"},{default:q(()=>[Q(o,null,{default:q(()=>t[11]||(t[11]=[$("View all lessons")])),_:1})]),_:1}),Q(a,{flat:"",dense:"",icon:"add_circle",label:"New Lesson",color:"positive",size:"sm",onClick:Ke},{default:q(()=>[Q(o,null,{default:q(()=>t[12]||(t[12]=[$("Create a new lesson")])),_:1})]),_:1}),z(Ve)?(C(),P(a,{key:0,flat:"",dense:"",icon:"content_copy",label:"Duplicate",color:"secondary",size:"sm",onClick:We},{default:q(()=>[Q(o,null,{default:q(()=>t[13]||(t[13]=[$("Duplicate this lesson")])),_:1})]),_:1})):V("",!0)])])]),k("div",Y,[k("div",ee,[k("div",te,[L(k("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>Le.value.name=e),class:"text-xl font-bold text-gray-800 border-none focus:ring-0 p-0 w-full bg-transparent placeholder-gray-400",placeholder:"Untitled Lesson"},null,512),[[I,Le.value.name]]),k("div",oe,[L(k("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>Le.value.description=e),class:"text-sm text-gray-500 border-none focus:ring-0 p-0 flex-1 bg-transparent placeholder-gray-400",placeholder:"Add a description..."},null,512),[[I,Le.value.description]]),L(k("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>Le.value.grade_id=e),class:"text-sm border-gray-200 rounded-md text-gray-600 py-1 pl-2 pr-8 bg-transparent focus:ring-0 focus:border-blue-500"},[t[14]||(t[14]=k("option",{value:null,disabled:""},"Select Grade",-1)),(C(!0),S(U,null,A(z($e).grades,e=>(C(),S("option",{key:e.id,value:e.id},E(e.name),9,ae))),128))],512),[[T,Le.value.grade_id]])])]),k("div",ie,[Q(a,{outline:"",color:"primary",icon:"visibility",label:"Preview",onClick:t[4]||(t[4]=e=>De.value=!0),disable:!z(Ve)},{default:q(()=>[z(Ve)?V("",!0):(C(),P(o,{key:0},{default:q(()=>t[15]||(t[15]=[$("Save the lesson first to preview")])),_:1}))]),_:1},8,["disable"]),Q(a,{color:"positive",icon:"save",label:"Save",onClick:Je,loading:Ee.value},null,8,["loading"])])])]),k("div",le,[k("div",se,[Fe.value?(C(),S("div",ne,[k("div",re,[t[17]||(t[17]=k("h3",{class:"text-lg font-medium text-gray-700"},"Edit Slide Content",-1)),L(k("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>Fe.value.slide_type=e),class:"border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},t[16]||(t[16]=[D('<option value="text" data-v-7b4cd7fb>Text Slide</option><option value="image" data-v-7b4cd7fb>Image Slide</option><option value="video" data-v-7b4cd7fb>Video Slide</option><option value="audio" data-v-7b4cd7fb>Audio Slide</option><option value="pdf" data-v-7b4cd7fb>PDF Slide</option><option value="question" data-v-7b4cd7fb>Question Slide</option>',6)]),512),[[T,Fe.value.slide_type]])]),k("div",de,[(C(),P(M(Re(Fe.value.slide_type)),{modelValue:Fe.value.slide_content,"onUpdate:modelValue":t[6]||(t[6]=e=>Fe.value.slide_content=e)},null,8,["modelValue"]))])])):(C(),S("div",ce,t[18]||(t[18]=[k("i",{class:"fas fa-layer-group text-4xl mb-4"},null,-1),k("p",null,"Select a slide to edit or create a new one",-1)])))])])]),Q(b,{modelValue:Ne.value,"onUpdate:modelValue":t[8]||(t[8]=e=>Ne.value=e),persistent:"",position:"left"},{default:q(()=>[k("div",ue,[k("div",pe,[k("div",fe,[k("div",be,[Q(s,{name:"view_sidebar",size:"24px",color:"primary"}),t[19]||(t[19]=k("h2",{class:"text-lg font-bold text-gray-800"},"Lesson Plan",-1))]),Q(a,{flat:"",dense:"",round:"",icon:"close",onClick:t[7]||(t[7]=e=>Ne.value=!1)})]),k("p",me,[Q(s,{name:"touch_app",size:"14px"}),t[20]||(t[20]=$(" Select a section to manage slides "))])]),k("div",ve,[Q(n,{separator:""},{default:q(()=>[(C(!0),S(U,null,A(Ie.value,e=>(C(),S("div",{key:e.id,class:N(["mb-3 rounded-xl overflow-hidden transition-all duration-300 border",Te.value===e.id?"bg-blue-50 border-blue-200 shadow-md":"bg-white border-transparent hover:bg-gray-50"])},[L((C(),P(p,{clickable:"",onClick:t=>Te.value=e.id,class:"py-3"},{default:q(()=>[Q(d,{avatar:""},{default:q(()=>[Q(c,{color:Te.value===e.id?e.borderColor:"grey-2","text-color":"white",size:"40px",class:"shadow-sm"},{default:q(()=>[Q(s,{name:e.qIcon,size:"22px"},null,8,["name"])]),_:2},1032,["color"])]),_:2},1024),Q(d,null,{default:q(()=>[Q(u,{class:"font-bold text-gray-800 text-sm"},{default:q(()=>[$(E(e.title),1)]),_:2},1024),Q(u,{caption:"",class:"text-xs text-gray-500"},{default:q(()=>{return[$(E((t=e.id,Ue.value.filter(e=>e.section===t).length))+" slide(s) ",1)];var t}),_:2},1024)]),_:2},1024),Q(d,{side:""},{default:q(()=>[Q(s,{name:Te.value===e.id?"expand_less":"expand_more",color:Te.value===e.id?"primary":"grey"},null,8,["name","color"])]),_:2},1024)]),_:2},1032,["onClick"])),[[r]]),Q(f,null,{default:q(()=>[Te.value===e.id?(C(),S("div",ge,[k("button",{type:"button",onClick:O(Be,["stop"]),class:"w-full py-2 px-3 mb-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-xs font-bold uppercase tracking-wide shadow-sm transition-all flex items-center justify-center gap-2"},[Q(s,{name:"add",size:"16px"}),t[21]||(t[21]=$(" Add New Slide "))]),k("div",ye,[(C(!0),S(U,null,A(Oe.value,(e,t)=>(C(),S("div",{key:e.id||t,onClick:O(e=>Ae.value=t,["stop"]),class:N(["p-2 rounded-lg cursor-pointer border transition-all group relative",Ae.value===t?"bg-blue-50 border-blue-400 ring-1 ring-blue-400":"bg-gray-50 border-gray-200 hover:border-blue-300"])},[k("div",he,[k("span",we,"Slide "+E(t+1),1),Q(y,{color:Ae.value===t?"blue":"grey",size:"sm",label:e.slide_type},null,8,["color","label"])]),k("div",_e,E(He(e)),1)],10,xe))),128)),0===Oe.value.length?(C(),S("div",je," No slides yet. Click above to add one. ")):V("",!0)])])):V("",!0)]),_:2},1024)],2))),128))]),_:1})])])]),_:1},8,["modelValue"])]),Q(b,{modelValue:De.value,"onUpdate:modelValue":t[9]||(t[9]=e=>De.value=e),maximized:""},{default:q(()=>[Q(m,{class:"bg-white"},{default:q(()=>[Q(v,{class:"row items-center q-pb-none bg-primary text-white"},{default:q(()=>[k("div",Se,[Q(s,{name:"visibility",size:"28px"}),t[22]||(t[22]=$(" Student View Preview "))]),Q(x),L(Q(a,{icon:"close",flat:"",round:"",dense:""},null,512),[[g]])]),_:1}),Q(v,{class:"q-pa-none",style:{height:"calc(100vh - 60px)"}},{default:q(()=>[z(Ve)?(C(),S("iframe",{key:0,src:`/lesson-presentation/student/${z(Ve)}`,class:"w-full h-full border-0",title:"Student View Preview"},null,8,Ce)):(C(),S("div",ke,[k("div",Qe,[Q(s,{name:"info",size:"64px",color:"grey-5"}),t[23]||(t[23]=k("p",{class:"mt-4"},"Please save the lesson first to preview",-1))])]))]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},[["__scopeId","data-v-7b4cd7fb"]]);export{qe as default};
