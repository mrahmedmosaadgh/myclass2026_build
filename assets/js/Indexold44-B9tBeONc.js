import{f as e,k as l,a as o,H as s,I as r,J as a,M as d,O as t,V as n,b as u,L as i,Q as c,F as v,y as m,U as p,_ as b,Z as y}from"./vendor-EI0FRBVb.js";import{l as f}from"./ui-B__oX9pK.js";import{_ as h}from"./AppLayout-CE2yjlSr.js";import _ from"./DialogModal_8-DpzNYgTO.js";import{_ as g}from"./FilterSelectV2-DKm5k7lk.js";import x from"./card2-DNn6K8Gb.js";import{p as j}from"./app-BzjXrVp9.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./NameAbbreviator2-S__a05zc.js";const w={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},k={class:"bg-white rounded-lg shadow p-6 space-y-4"},S={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},$={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},C={class:"bg-white rounded-lg shadow overflow-hidden"},A={class:"overflow-x-auto"},D={class:"min-w-full divide-y divide-gray-200"},F={class:"bg-gray-50"},M={class:"flex flex-col"},V={class:"text-xs text-gray-400"},z={class:"bg-white divide-y divide-gray-200"},O={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 bg-gray-50"},T=j({__name:"Indexold44",props:{records:{type:Object,default:()=>({data:[]})},records2:{type:Object,default:()=>({data:[]})},options:{type:Object,default:()=>({})},periodDetails:{type:Array,default:()=>[]}},setup(j){var T;e("Cozy"),e(null),e([{value:"Cozy2",label:"Cozy"}]);const E=j;e(null==E?void 0:E.records);const H=e(null==E?void 0:E.records);e((null==(T=null==E?void 0:E.records)?void 0:T.filter(e=>null!=(null==e?void 0:e.day)&&null!=(null==e?void 0:e.period_number)))||[]),console.log("Props received:",{records:E.records,options:E.options,periodDetails:E.periodDetails});const I=[{name:"Sunday",number:1},{name:"Monday",number:2},{name:"Tuesday",number:3},{name:"Wednesday",number:4},{name:"Thursday",number:5}],N=Array.from({length:8},(e,l)=>l+1),P=e(!1),U={1:"07:30 - 08:15",2:"08:15 - 09:00",3:"09:00 - 09:45",4:"10:00 - 10:45",5:"10:45 - 11:30",6:"11:30 - 12:15",7:"12:45 - 13:30",8:"13:30 - 14:15"},W=e(E.records||[]),B=e(!1),L=e({day:null,period_number:null}),q=e(null),J=e(!1),Q=e({school:null,school_object:{},classroom:null,classroom_object:{},schedule:null,schedule_object:{}});e(!1);const R=e(null),Z=e(E.records||[]),G=e(E.options||{});l(()=>E.records,e=>{Z.value=e},{deep:!0}),l(()=>E.options,e=>{G.value=e},{deep:!0});const K=o(()=>{var e;console.log("CSTs from options:",null==(e=G.value)?void 0:e.csts);const l=Z.value||[],o=[...new Set(l.map(e=>{var l,o;return null==(o=null==(l=e.cst)?void 0:l.classroom)?void 0:o.id}))].map(e=>{var o,s,r,a,d,t;const n=l.find(l=>{var o,s;return(null==(s=null==(o=l.cst)?void 0:o.classroom)?void 0:s.id)===e});return{id:null==(s=null==(o=n.cst)?void 0:o.classroom)?void 0:s.id,name:null==(a=null==(r=n.cst)?void 0:r.classroom)?void 0:a.name,grade:null==(t=null==(d=n.cst)?void 0:d.classroom)?void 0:t.grade}});return console.log("Processed classrooms:",o),o});e({});const X=o(()=>{var e;return(null==(e=E.records)?void 0:e.length)?E.records.reduce((e,l)=>{var o,s,r,a,d,t,n,u;return e[`${l.day}-${l.period_number}`]={subject:null==(s=null==(o=l.cst)?void 0:o.subject)?void 0:s.name,teacher:null==(a=null==(r=l.cst)?void 0:r.teacher)?void 0:a.name,color_bg:null==(t=null==(d=l.cst)?void 0:d.subject)?void 0:t.color_bg,color_text:null==(u=null==(n=l.cst)?void 0:n.subject)?void 0:u.color_text,cst:l.cst,schedule:l,id:null==l?void 0:l.id},e},{}):{}}),Y=(e,l,o)=>X.value[`${l.number}-${o}`]||null,ee=()=>{B.value=!1,q.value=null,J.value=!1},le=e(!0),oe=()=>{le.value=!1,b.reload({only:["records","options"],preserveScroll:!0,onFinish:()=>{le.value=!0,f.success("Schedule data refreshed successfully")},onError:()=>{le.value=!0,f.error("Failed to refresh data")}})},se=(e,l,o,s)=>{var r;if(J.value)return;J.value=!0;const a={...e,id:e.id,day:o.number,period_number:s,school_id:e.school_id,copy_id:e.copy_id,active:null==(r=e.active)||r};y.post("/admin/schedule/update2",a).then(e=>(W.value=W.value.map(l=>l.id===a.id?e.data.record:l),f.success(e.data.message),oe())).catch(e=>{var l,o,s,r;if(null==(o=null==(l=e.response)?void 0:l.data)?void 0:o.conflict)f.error(e.response.data.message,{duration:5e3,position:"bottom-right",closeButton:!0}),console.error("Conflict details:",e.response.data.conflict);else{const l=(null==(r=null==(s=e.response)?void 0:s.data)?void 0:r.message)||"An unexpected error occurred";f.error(l)}}).finally(()=>{J.value=!1})},re=async({form:e,onSuccess:l,onError:o})=>{var s,r,a,d,t;if(J.value)return;J.value=!0,R.value=null;const n={...e,day:L.value.day,period_number:L.value.period_number,school_id:q.value.school_id,copy_id:q.value.copy_id,active:null==(s=q.value.active)||s};try{return void console.log("formData___________",n)}catch(u){const e=(null==(a=null==(r=u.response)?void 0:r.data)?void 0:a.message)||"An unexpected error occurred";o((null==(t=null==(d=u.response)?void 0:d.data)?void 0:t.errors)||{error:[e]}),f.error(e)}finally{J.value=!1}},ae=o(()=>{var e;return[{name:"cst_id",label:"Class-Subject-Teacher",type:"select",required:!0,options:(null==(e=H.value)?void 0:e.map(e=>({value:e.id,label:`${e.classroom}`})))||[]}]});return e(null),e(null),e({row:null,col:null}),e(null),o(()=>{var e;return{school_id:null==(e=selected_school_object.value)?void 0:e.id,period_number:null,day:null,cst_id:null,place:"",active:!0,notes:""}}),o(()=>{var e;return(null==(e=E.records2)?void 0:e.filter(e=>{var l,o,s,r,a;return!Y(null==(o=null==(l=e.cst)?void 0:l.classroom)||o.id,e.day,e.period_number)&&(null==(r=null==(s=e.cst)?void 0:s.classroom)?void 0:r.id)===(null==(a=selected_classroom.value)?void 0:a.id)}))||[]}),(e,l)=>(r(),s(h,{title:"Schedule Management"},{default:a(()=>[d("div",{class:"bg-white shadow-sm border-b border-gray-200 px-4 py-4 sm:px-6 lg:px-8"},[d("div",{class:"flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0"},[l[3]||(l[3]=d("h2",{class:"text-2xl font-semibold text-gray-800"},"Schedule Management",-1)),d("div",{class:"flex items-center space-x-4"},[d("button",{onClick:oe,class:"inline-flex items-center px-4 py-2 bg-indigo-600 hover:bg-indigo-700 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition ease-in-out duration-150"},l[2]||(l[2]=[d("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),n(" Refresh ")]))])])]),d("div",w,[d("div",k,[l[4]||(l[4]=d("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Filters",-1)),d("div",S,[u(g,{modelValue:Q.value.schedule,"onUpdate:modelValue":l[0]||(l[0]=e=>Q.value.schedule=e),object:Q.value.schedule_object,"onUpdate:object":l[1]||(l[1]=e=>Q.value.schedule_object=e),options:e.$page.props.auth.user.schedule,"value-key":"id","label-key":["cst.classroom_name","cst.subject_name","cst.teacher_name"],placeholder:"Select Schedule",class:"w-full"},null,8,["modelValue","object","options"])])])]),d("div",$,[d("div",C,[d("div",A,[d("table",D,[d("thead",F,[d("tr",null,[l[6]||(l[6]=d("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Classroom ",-1)),(r(),i(v,null,c(I,e=>(r(),i(v,{key:`periods-${e}`},[(r(!0),i(v,null,c(m(N),o=>(r(),i("th",{key:`${e}-${o}`,class:"px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider border-l first:border-l-0"},[d("div",M,[l[5]||(l[5]=d("span",{class:"text-gray-400"},"Period",-1)),d("span",null,p(o),1),d("span",V,p(U[o]),1)])]))),128))],64))),64))])]),d("tbody",z,[(r(!0),i(v,null,c(K.value,e=>(r(),i("tr",{key:e.id},[d("td",O,p(e.name),1),(r(),i(v,null,c(I,l=>(r(),i(v,{key:`${e.id}-${l}`},[(r(!0),i(v,null,c(m(N),o=>{var a,d,n,u,c,v,m,p;return r(),i("td",{key:`${e.id}-${l}-${o}`,class:"px-2 py-2 border-l first:border-l-0 hover:bg-gray-50 transition-colors duration-150"},[(null==(d=null==(a=Y(e.id,l,o))?void 0:a.schedule)?void 0:d.period_number)==o&&(null==(u=null==(n=Y(e.id,l,o))?void 0:n.schedule)?void 0:u.day)==l.number&&(null==(p=null==(m=null==(v=null==(c=Y(e.id,l,o))?void 0:c.schedule)?void 0:v.cst)?void 0:m.classroom)?void 0:p.id)==e.id?(r(),s(x,{key:0,option:Y(e.id,l,o),name:"radioName",my_class:"custom-class",onClick:s=>((e,l,o)=>{var s;return console.log(l,o),L.value.day=l.number,L.value.period_number=o,H.value=null==(s=E.records)?void 0:s.filter(l=>{var o,s;return(null==(s=null==(o=l.cst)?void 0:o.classroom)?void 0:s.id)===e}),console.log("Filtered records:",H.value),H.value})(e.id,l,o),onSet_data:s=>((e,l,o,s)=>{console.log("setSelectedSession________",e),P.value=e,se(P.value,l,o,s)})(s,e.id,l,o)},null,8,["option","onClick","onSet_data"])):t("",!0)])}),128))],64))),64))]))),128))])])])])]),B.value?(r(),s(_,{key:0,show:B.value,title:q.value?"Edit Schedule":"Add New Schedule",fields:ae.value,formData:q.value,onClose:ee,onSubmitted:re,class:"z-50"},null,8,["show","title","fields","formData"])):t("",!0)]),_:1}))}},[["__scopeId","data-v-5b8b8aec"]]);export{T as default};
