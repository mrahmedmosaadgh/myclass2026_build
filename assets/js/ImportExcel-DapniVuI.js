const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/app-DraepSDZ.js","assets/js/vendor-BWKGNkNB.js","assets/js/offline-BzIlwqNM.js","assets/js/i18n-B0T1C7j3.js","assets/js/ui-B7TfxbV_.js","assets/css/app-QAOnovzD.css"])))=>i.map(i=>d[i]);
import{r as e,_ as t}from"./app-DraepSDZ.js";import{M as l}from"./Modal-C_QFFTwO.js";import{f as s,k as a,N as r,J as o,R as n,b as u,V as i,a0 as d,U as c,K as p,O as v,F as m,Q as f,W as x,_ as g}from"./vendor-BWKGNkNB.js";import{read as y,utils as w}from"./xlsx-BHXqx-YI.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";const h={class:"flex flex-col items-center justify-center space-y-3 cursor-pointer"},b={class:"text-lg font-medium text-gray-700"},k={class:"p-6"},_={class:"flex justify-between items-center mb-4"},T={class:"text-lg font-medium text-gray-900"},C={class:"text-sm text-gray-500"},j={key:0,class:"overflow-x-auto mb-6 rounded-lg border border-gray-200 shadow"},S={class:"min-w-full divide-y divide-gray-200"},B={class:"bg-blue-50"},E={key:0,class:"text-red-500 ml-1"},I={class:"bg-white divide-y divide-gray-200"},A={key:0},U={key:1,class:"text-gray-400 italic"},z={class:"px-6 py-4 whitespace-nowrap text-sm"},D={class:"flex justify-end space-x-3"},M=["disabled"],V={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},R={class:"p-6"},q={class:"flex items-center justify-between mb-6"},L={class:"text-xl font-semibold text-gray-900"},P={key:0,class:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4"},O={class:"flex items-center mb-3"},F={class:"text-green-800 font-medium"},W={class:"pl-7"},$={class:"text-sm text-green-700 space-y-1 max-h-40 overflow-y-auto"},H={key:1,class:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4"},N={class:"flex items-center mb-3"},J={class:"text-red-800 font-medium"},K={class:"pl-7"},Q={class:"text-sm text-red-700 space-y-1 max-h-40 overflow-y-auto"},Z={class:"mt-6 flex justify-end space-x-3"},G=["disabled"],X={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-red-700",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Y={key:1,class:"-ml-1 mr-2 h-4 w-4 text-red-700",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ee=e({__name:"ImportExcel",props:{validateUrl:{type:String,required:!0},importUrl:{type:String,required:!0},undoUrl:{type:String,required:!1,default:""},columns:{type:Array,required:!0},buttonText:{type:String,default:"Choose Excel File"},previewTitle:{type:String,default:"Preview Import Data"},confirmButtonText:{type:String,default:"Confirm Import"},cancelButtonText:{type:String,default:"Cancel"},processingText:{type:String,default:"Processing..."},resultsTitle:{type:String,default:"Import Results"},undoButtonText:{type:String,default:"Undo Import"},undoingText:{type:String,default:"Undoing..."},closeButtonText:{type:String,default:"Close"}},emits:["imported"],setup(e,{emit:ee}){const te=e,le=ee,se=s(null),ae=s(!1),re=s(!1),oe=s(!1),ne=s(!1),ue=s([]),ie=s({success:[],errors:[]}),de=s(!1),ce=s(null),pe=s(!1);a(()=>te.columns,()=>{ue.value.length>0&&(ue.value=ue.value.map(e=>{const t={};return te.columns.forEach(l=>{t[l.key]=e.data[l.key]}),{...e,data:t}}))},{deep:!0});const ve=e=>{if(!e)return;const t=new FileReader;t.onload=e=>{const t=new Uint8Array(e.target.result),l=y(t,{type:"array"}),s=l.Sheets[l.SheetNames[0]],a=w.sheet_to_json(s,{header:1});a.shift(),ue.value=a.filter(e=>e.length).map(e=>{const t={};return te.columns.forEach((l,s)=>{t[l.key]=e[s]}),{data:t,status:"new"}}),xe(),oe.value=!0},t.readAsArrayBuffer(e)},me=e=>{const t=e.target.files[0];ve(t)},fe=e=>{pe.value=!1;const t=e.dataTransfer.files[0];ve(t)},xe=async()=>{try{const e=te.columns.filter(e=>e.required).map(e=>e.key),t=await g.post(te.validateUrl,{data:ue.value.map(e=>e.data),required_fields:e,columns:te.columns});ue.value=ue.value.map((e,l)=>({...e,status:t.data.stats.invalid_rows>0?"warning":"valid"})),le("validation-success",t.data)}catch(e){console.error("Validation error:",e)}},ge=async()=>{var e,l;ae.value=!0;try{(await t(async()=>{const{default:e}=await import("./app-DraepSDZ.js").then(e=>e.n);return{default:e}},__vite__mapDeps([0,1,2,3,4,5]))).default.start();const e=await g.post(te.importUrl,{data:ue.value.map(e=>e.data),columns:te.columns});le("imported"),ie.value=e.data.results,ce.value=e.data.importId,de.value=!!te.undoUrl,oe.value=!1,ne.value=!0}catch(s){console.error("Import error:",s),ie.value={success:[],errors:[(null==(l=null==(e=s.response)?void 0:e.data)?void 0:l.message)||"An error occurred during import"]},ne.value=!0}finally{ae.value=!1;(await t(async()=>{const{default:e}=await import("./app-DraepSDZ.js").then(e=>e.n);return{default:e}},__vite__mapDeps([0,1,2,3,4,5]))).default.done(),se.value.value=""}},ye=async()=>{if(!ce.value||!te.undoUrl)return;re.value=!0;(await t(async()=>{const{default:e}=await import("./app-DraepSDZ.js").then(e=>e.n);return{default:e}},__vite__mapDeps([0,1,2,3,4,5]))).default.start();try{await g.post(`${te.undoUrl}/${ce.value}`),de.value=!1,le("imported"),he()}catch(e){alert("Failed to undo the import")}finally{re.value=!1;(await t(async()=>{const{default:e}=await import("./app-DraepSDZ.js").then(e=>e.n);return{default:e}},__vite__mapDeps([0,1,2,3,4,5]))).default.done()}},we=()=>{oe.value=!1,ue.value=[],se.value.value=""},he=()=>{ne.value=!1,ie.value={success:[],errors:[]},ce.value=null,de.value=!1};return(t,s)=>(o(),r("div",null,[n("input",{type:"file",ref_key:"fileInput",ref:se,class:"hidden",accept:".xlsx,.xls",onChange:me},null,544),n("div",{class:c(["border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition-colors duration-200",{"border-blue-500 bg-blue-50":pe.value}]),onDragover:s[0]||(s[0]=d(e=>pe.value=!0,["prevent"])),onDragleave:s[1]||(s[1]=d(e=>pe.value=!1,["prevent"])),onDrop:d(fe,["prevent"]),onClick:s[2]||(s[2]=e=>t.$refs.fileInput.click())},[n("div",h,[s[3]||(s[3]=n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),n("div",b,i(e.buttonText),1),s[4]||(s[4]=n("p",{class:"text-sm text-gray-500"},"Drag and drop your Excel file here, or click to browse",-1)),s[5]||(s[5]=n("div",{class:"text-xs text-gray-400"},"Supported formats: .xlsx, .xls",-1))])],34),u(l,{show:oe.value,onClose:we,maxWidth:"4xl"},{default:p(()=>[n("div",k,[n("div",_,[n("h3",T,i(e.previewTitle),1),n("div",C," Total Records: "+i(ue.value.length),1)]),oe.value?(o(),r("div",j,[n("table",S,[n("thead",B,[n("tr",null,[(o(!0),r(m,null,f(e.columns.filter(e=>!e.hidden),e=>(o(),r("th",{key:e.key,class:"px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider"},[x(i(e.label)+" ",1),e.required?(o(),r("span",E,"*")):v("",!0)]))),128)),s[6]||(s[6]=n("th",{class:"px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider"}," Status ",-1))])]),n("tbody",I,[(o(!0),r(m,null,f(ue.value,(t,l)=>(o(),r("tr",{key:l,class:"hover:bg-gray-50 transition-colors duration-150"},[(o(!0),r(m,null,f(e.columns.filter(e=>!e.hidden),e=>(o(),r("td",{key:e.key,class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},[t.data[e.key]?(o(),r("span",A,i(t.data[e.key]),1)):(o(),r("span",U,"Empty"))]))),128)),n("td",z,[n("span",{class:c({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800":"valid"===t.status,"bg-yellow-100 text-yellow-800":"warning"===t.status||"new"===t.status,"bg-red-100 text-red-800":"error"===t.status})},i(t.status),3)])]))),128))])])])):v("",!0),n("div",D,[n("button",{onClick:we,class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"},i(e.cancelButtonText),1),n("button",{onClick:ge,disabled:ae.value||!ue.value.length,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"},[ae.value?(o(),r("svg",V,s[7]||(s[7]=[n("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),n("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):v("",!0),x(" "+i(ae.value?e.processingText:e.confirmButtonText),1)],8,M)])])]),_:1},8,["show"]),u(l,{show:ne.value,onClose:he,maxWidth:"2xl"},{default:p(()=>[n("div",R,[n("div",q,[n("h3",L,i(e.resultsTitle),1),s[8]||(s[8]=n("div",{class:"bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full"}," Import Complete ",-1))]),ie.value.success.length?(o(),r("div",P,[n("div",O,[s[9]||(s[9]=n("svg",{class:"w-5 h-5 text-green-500 mr-2",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)),n("h4",F,"Success ("+i(ie.value.success.length)+")",1)]),n("div",W,[n("ul",$,[(o(!0),r(m,null,f(ie.value.success,(e,t)=>(o(),r("li",{key:t,class:"flex items-start"},[s[10]||(s[10]=n("span",{class:"mr-1"},"•",-1)),n("span",null,i(e),1)]))),128))])])])):v("",!0),ie.value.errors.length?(o(),r("div",H,[n("div",N,[s[11]||(s[11]=n("svg",{class:"w-5 h-5 text-red-500 mr-2",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),n("h4",J,"Errors ("+i(ie.value.errors.length)+")",1)]),n("div",K,[n("ul",Q,[(o(!0),r(m,null,f(ie.value.errors,(e,t)=>(o(),r("li",{key:t,class:"flex items-start"},[s[12]||(s[12]=n("span",{class:"mr-1"},"•",-1)),n("span",null,i(e),1)]))),128))])])])):v("",!0),n("div",Z,[de.value?(o(),r("button",{key:0,onClick:ye,disabled:re.value,class:"px-4 py-2 border border-red-300 text-red-700 rounded-lg hover:bg-red-50 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"},[re.value?(o(),r("svg",X,s[13]||(s[13]=[n("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),n("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(o(),r("svg",Y,s[14]||(s[14]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"},null,-1)]))),x(" "+i(re.value?e.undoingText:e.undoButtonText),1)],8,G)):v("",!0),n("button",{onClick:he,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},i(e.closeButtonText),1)])])]),_:1},8,["show"])]))}},[["__scopeId","data-v-575c496b"]]);export{ee as default};
