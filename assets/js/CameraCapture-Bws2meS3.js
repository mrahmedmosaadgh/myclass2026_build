import{r as e,f as l,Q as a,d as t,b as u,g as o}from"./app-BxJhpxku.js";import{Q as i}from"./QFile-CLL4r4Tq.js";import{Q as n}from"./QImg-6mrswKOg.js";import{f as s,a as c,N as r,J as v,O as d,y as h,b as f,R as m,K as g,W as p,a0 as w,I as y,Y as x,n as b}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./use-file-CTRmpBK5.js";const k={class:"camera-capture q-pa-md"},C={key:0,class:"column items-center q-gutter-y-md full-width"},_={class:"text-subtitle1 text-primary text-center q-mb-sm font-bold"},R={class:"text-subtitle1 text-primary text-center font-bold"},q={key:0,class:"row q-gutter-sm full-width justify-center"},I={class:"column items-center full-width q-gutter-y-sm"},T={class:"row q-gutter-sm full-width justify-center"},j={class:"full-width column items-center q-gutter-y-md"},S={key:0,class:"text-h6 text-primary"},M={class:"canvas-container relative-position flex flex-center full-width"},U=["width","height"],E={key:3,class:"column q-gutter-y-sm full-width"},Q={key:4,class:"column items-center q-gutter-y-md full-width"},D={class:"text-h6 text-positive"},P={class:"column q-gutter-y-sm full-width"},W=e({__name:"CameraCapture",emits:["captured"],setup(e,{emit:W}){const F=W,L=s(null),O=s(null),A=s(!1),V=s(!1),Y=s(!1),B=s({x:0,y:0}),X=s({x:0,y:0}),z=s(null),H=c(()=>z.value&&z.value.w>2&&z.value.h>2),J=s(null),K=s(null),N=s(300),G=s(300);let Z=null;const $=s(null);function ee(e){if(!e)return;const l=new FileReader;l.onload=e=>{return l=e.target.result,J.value=new Image,J.value.src=l,void(J.value.onload=()=>{V.value=!0,N.value=J.value.width,G.value=J.value.height,b(oe)});var l},l.readAsDataURL(e)}const le=s("user");function ae(){Z&&Z.getTracks().forEach(e=>e.stop()),navigator.mediaDevices.getUserMedia({video:{facingMode:le.value}}).then(e=>{Z=e,A.value=!0,b(()=>L.value.srcObject=Z)})}function te(){le.value="user"===le.value?"environment":"user",ae()}function ue(){const e=L.value,l=O.value;if(!l||!e)return;l.width=e.videoWidth,l.height=e.videoHeight;l.getContext("2d").drawImage(e,0,0,l.width,l.height),J.value=new Image,J.value.src=l.toDataURL("image/png"),J.value.onload=()=>{V.value=!0,A.value=!1,Z&&Z.getTracks().forEach(e=>e.stop()),b(oe)}}function oe(){const e=O.value;if(!e||!J.value)return;const l=e.getContext("2d");if(l.clearRect(0,0,e.width,e.height),l.drawImage(J.value,0,0,e.width,e.height),z.value){l.fillStyle="rgba(0, 0, 0, 0.6)",l.fillRect(0,0,e.width,e.height),l.clearRect(z.value.x,z.value.y,z.value.w,z.value.h),l.drawImage(J.value,z.value.x,z.value.y,z.value.w,z.value.h,z.value.x,z.value.y,z.value.w,z.value.h),l.fillStyle="rgba(76, 175, 80, 0.4)",l.fillRect(z.value.x,z.value.y,z.value.w,z.value.h),l.strokeStyle="#4CAF50",l.lineWidth=3,l.strokeRect(z.value.x,z.value.y,z.value.w,z.value.h);const a=20,t=[{x:z.value.x,y:z.value.y},{x:z.value.x+z.value.w,y:z.value.y},{x:z.value.x,y:z.value.y+z.value.h},{x:z.value.x+z.value.w,y:z.value.y+z.value.h}];l.fillStyle="#4CAF50",l.strokeStyle="#ffffff",l.lineWidth=2,t.forEach(e=>{l.beginPath(),l.arc(e.x,e.y,a/2,0,2*Math.PI),l.fill(),l.stroke()});const u=z.value.x+z.value.w/2,o=z.value.y+z.value.h/2,i=15;l.strokeStyle="#ffffff",l.lineWidth=2,l.beginPath(),l.moveTo(u-i,o),l.lineTo(u+i,o),l.moveTo(u,o-i),l.lineTo(u,o+i),l.stroke()}}function ie(e){const l=O.value.getBoundingClientRect(),a=O.value.width/l.width,t=O.value.height/l.height;return{x:(e.clientX-l.left)*a,y:(e.clientY-l.top)*t}}function ne(e){const l=O.value.getBoundingClientRect(),a=O.value.width/l.width,t=O.value.height/l.height,u=e.touches[0]||e.changedTouches[0];return{x:(u.clientX-l.left)*a,y:(u.clientY-l.top)*t}}function se(e){V.value&&(Y.value=!0,B.value=ie(e),z.value=null)}function ce(e){Y.value&&(X.value=ie(e),fe())}function re(){Y.value=!1}function ve(e){V.value&&(Y.value=!0,B.value=ne(e),z.value=null)}function de(e){Y.value&&(X.value=ne(e),fe())}function he(){Y.value=!1}function fe(){z.value={x:Math.min(B.value.x,X.value.x),y:Math.min(B.value.y,X.value.y),w:Math.abs(X.value.x-B.value.x),h:Math.abs(X.value.y-B.value.y)},oe()}const me=s(0);function ge(){V.value&&J.value&&(K.value=J.value.src,z.value=null,Y.value=!1,me.value=1,b(oe))}function pe(){if(!H.value)return;const e=document.createElement("canvas");e.width=z.value.w,e.height=z.value.h;e.getContext("2d").drawImage(J.value,z.value.x,z.value.y,z.value.w,z.value.h,0,0,e.width,e.height),K.value=e.toDataURL("image/png"),z.value=null,Y.value=!1,me.value=1,b(oe)}function we(){F("captured",{dataUrl:K.value}),Z&&(Z.getTracks().forEach(e=>e.stop()),Z=null),A.value=!1}function ye(){z.value=null,K.value=null,me.value=0,Y.value=!1,V.value=!1,J.value=null,Z&&(Z.getTracks().forEach(e=>e.stop()),Z=null),A.value=!1;const e=O.value;if(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}N.value=300,G.value=300}return(e,s)=>(v(),r("div",k,[V.value?d("",!0):(v(),r("div",C,[f(t,{flat:"",bordered:"",class:"full-width"},{default:g(()=>[f(l,null,{default:g(()=>[m("div",_,[f(a,{name:"folder_open",class:"q-mr-sm"}),s[3]||(s[3]=p("Upload Image "))]),f(i,{filled:"","bottom-slots":"",modelValue:$.value,"onUpdate:modelValue":[s[2]||(s[2]=e=>$.value=e),ee],label:"Choose image",accept:"image/*",class:"full-width"},{prepend:g(()=>[f(a,{name:"cloud_upload",onClick:s[0]||(s[0]=w(()=>{},["stop","prevent"]))})]),append:g(()=>[f(a,{name:"close",onClick:s[1]||(s[1]=w(e=>$.value=null,["stop","prevent"])),class:"cursor-pointer"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s[5]||(s[5]=m("div",{class:"text-caption text-grey-7"},"OR",-1)),f(t,{flat:"",bordered:"",class:"full-width"},{default:g(()=>[f(l,{class:"column items-center q-gutter-y-sm"},{default:g(()=>[m("div",R,[f(a,{name:"camera_alt",class:"q-mr-sm"}),s[4]||(s[4]=p("Camera "))]),A.value?d("",!0):(v(),r("div",q,[f(u,{color:"primary",icon:"videocam",label:"Start Camera",class:"col-12 col-sm-auto",onClick:ae})])),h(m("div",I,[m("div",T,[f(u,{color:"warning","text-color":"dark",icon:"cameraswitch",label:"Switch",class:"col-grow",onClick:te}),f(u,{color:"positive",icon:"camera",label:"Capture",class:"col-grow",onClick:ue})]),m("video",{ref_key:"video",ref:L,autoplay:"",playsinline:"",class:"video rounded-borders shadow-2"},null,512)],512),[[x,A.value]])]),_:1})]),_:1})])),h(m("div",j,[K.value?d("",!0):(v(),r("div",S,[f(a,{name:"crop",class:"q-mr-sm"}),s[6]||(s[6]=p("Crop Image "))])),K.value||z.value?d("",!0):(v(),y(o,{key:1,rounded:"",class:"bg-blue-1 text-blue-9 full-width text-center"},{avatar:g(()=>[f(a,{name:"touch_app",color:"primary"})]),default:g(()=>[s[7]||(s[7]=p(" Drag on image to crop "))]),_:1})),!K.value&&z.value?(v(),y(o,{key:2,rounded:"",class:"bg-green-1 text-green-9 full-width text-center"},{avatar:g(()=>[f(a,{name:"check_circle",color:"positive"})]),default:g(()=>[s[8]||(s[8]=p(" Ready to crop! "))]),_:1})):d("",!0),h(m("div",M,[m("canvas",{ref_key:"canvas",ref:O,width:N.value,height:G.value,onMousedown:se,onMousemove:ce,onMouseup:re,onTouchstart:w(ve,["prevent"]),onTouchmove:w(de,["prevent"]),onTouchend:w(he,["prevent"]),class:"crop-canvas shadow-3 rounded-borders"},null,40,U)],512),[[x,!K.value]]),K.value?d("",!0):(v(),r("div",E,[f(u,{color:"positive",icon:"crop",label:"Crop Selection",class:"full-width",onClick:pe,disable:!H.value},null,8,["disable"]),f(u,{color:"primary",outline:"",icon:"skip_next",label:"Skip Crop (Use Original)",class:"full-width",onClick:ge}),f(u,{color:"negative",flat:"",icon:"close",label:"Cancel",class:"full-width",onClick:ye})])),K.value?(v(),r("div",Q,[m("div",D,[f(a,{name:"preview",class:"q-mr-sm"}),s[9]||(s[9]=p("Preview "))]),f(n,{src:K.value,class:"rounded-borders shadow-3",style:{"max-width":"200px","max-height":"200px"},fit:"contain"},null,8,["src"]),m("div",P,[f(u,{color:"primary",icon:"save",label:"Save Photo",class:"full-width",size:"lg",onClick:we}),f(u,{color:"warning","text-color":"dark",flat:"",icon:"replay",label:"Retake",class:"full-width",onClick:ye})])])):d("",!0)],512),[[x,V.value]])]))}},[["__scopeId","data-v-ffb134f0"]]);export{W as default};
