import{r as e,u as a,s as t,Q as o,d as s,f as l,o as r,b as i,e as n,aS as d}from"./app-BxJhpxku.js";import{f as u,a as p,N as v,J as c,R as m,b as f,O as h,K as g,a0 as b,U as w,y,z as x,_ as j}from"./vendor-BWKGNkNB.js";import _ from"./CameraCapture-Bws2meS3.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./QFile-CLL4r4Tq.js";import"./use-file-CTRmpBK5.js";import"./QImg-6mrswKOg.js";const z=["src"],C={key:0,class:"absolute bottom-0 right-0 flex gap-1 z-20 pointer-events-auto"},A=e({__name:"AvatarManager",props:{student:{type:Object,required:!0},size:{type:String,default:"80px"},editEnabled:{type:Boolean,default:!1}},emits:["update:avatar"],setup(e,{emit:A}){const k=e,S=A,U=a(),$=u(!1),F=u(!1),I=u(null),M=p(()=>{const e=I.value||k.student.avatar;return e?e.startsWith("http")||e.startsWith("data:")||e.startsWith("/")?e:`/${e}`:null}),O=p(()=>""),Q=p(()=>{const e=(k.student.name||"Student").split(" ").map(e=>e[0]||"").slice(0,2).join("").toUpperCase();return`data:image/svg+xml,${encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 96 96">\n    <rect width="96" height="96" fill="#e2e8f0" rx="48" ry="48"/>\n    <text x="48" y="48" dy="8" text-anchor="middle" font-family="Comic Sans MS, Arial" font-size="32" font-weight="bold" fill="#475569">${e}</text>\n  </svg>`)}`});function W(){U.dialog({title:"Remove Avatar",message:"Are you sure you want to remove this photo?",cancel:!0,persistent:!0}).onOk(()=>{!async function(){try{await j.delete(`/api/students/${k.student.id}/avatar`),I.value=null,k.student.avatar=null,S("update:avatar",null),U.notify({message:"Avatar removed",color:"positive",position:"top"})}catch(e){console.error("Failed to remove avatar",e),U.notify({message:"Failed to remove avatar",color:"negative",position:"top"})}}()})}async function E({dataUrl:e}){try{const a=await fetch(e),t=await a.blob(),o=new FormData;o.append("avatar",t,"avatar.png"),o.append("student_id",k.student.id);const s=await j.post(`/api/students/${k.student.id}/avatar`,o,{headers:{"Content-Type":"multipart/form-data"}});I.value=s.data.avatar||s.data.url||e,S("update:avatar",I.value),F.value=!1,U.notify({message:"Awesome new photo! ðŸŒŸ",color:"positive",icon:"star",position:"top"})}catch(a){console.error("Avatar upload failed",a),U.notify({message:"Oops! Could not save photo.",color:"negative",position:"top"})}}return(a,u)=>(c(),v("div",{class:"avatar-manager relative inline-block",onMouseenter:u[2]||(u[2]=e=>$.value=!0),onMouseleave:u[3]||(u[3]=e=>$.value=!1)},[m("div",{class:w(["avatar-container relative rounded-full border-4 transition-all duration-300 transform pointer-events-none",[O.value,$.value?"scale-105 shadow-xl border-yellow-400":"shadow-lg  ",(e.editEnabled,"")]])},[f(t,{size:e.size,class:"bg-gray-200"},{default:g(()=>[m("img",{src:M.value||Q.value,class:"object-cover w-full h-full rounded-full",alt:"Student Avatar"},null,8,z)]),_:1},8,["size"]),e.editEnabled&&$.value?(c(),v("div",C,[M.value?(c(),v("div",{key:0,class:"bg-red-500 text-white rounded-full p-1.5 shadow-lg border-2 border-white cursor-pointer hover:bg-red-600 transition-colors",onClick:b(W,["stop"])},[f(o,{name:"delete",size:"xs"})])):h("",!0),m("div",{class:"bg-blue-600 text-white rounded-full p-1.5 shadow-lg border-2 border-white cursor-pointer hover:bg-blue-700 transition-colors",onClick:u[0]||(u[0]=b(e=>F.value=!0,["stop"]))},[f(o,{name:"edit",size:"xs"})])])):h("",!0)],2),f(n,{modelValue:F.value,"onUpdate:modelValue":u[1]||(u[1]=e=>F.value=e),maximized:x(U).screen.lt.sm},{default:g(()=>[f(s,{style:{width:"100%","max-width":"500px","max-height":"90vh",display:"flex","flex-direction":"column"},class:"rounded-2xl overflow-hidden"},{default:g(()=>[f(l,{class:"bg-blue-500 text-white p-4 q-pa-sm"},{default:g(()=>u[4]||(u[4]=[m("div",{class:"text-h6 font-bold"},"ðŸ“¸ Update Photo",-1)])),_:1}),f(l,{class:"p-0 scroll",style:{flex:"1"}},{default:g(()=>[f(_,{onCaptured:E})]),_:1}),f(r,{align:"right",class:"bg-gray-100"},{default:g(()=>[y(f(i,{flat:"",label:"Cancel",color:"grey"},null,512),[[d]])]),_:1})]),_:1})]),_:1},8,["modelValue","maximized"])],32))}},[["__scopeId","data-v-879c80f2"]]);export{A as default};
