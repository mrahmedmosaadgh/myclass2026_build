import{f as e,a as l,k as o,N as a,J as t,b as i,K as r,R as s,I as u,O as n,y as d,ab as c,F as m,Q as p,V as v,W as y,am as b,ac as f,_ as g,$ as h}from"./vendor-BWKGNkNB.js";import{_ as k}from"./AppLayout-B3PyevP7.js";import{_ as x}from"./PrimaryButton-DVJXOzHH.js";import j from"./DataTableV7-CyLaEWVH.js";import w from"./FormModal8-M5ZuXACj.js";import{_}from"./InputLabel-Ch3YeqCE.js";import{_ as q}from"./InputError-DEGVtjzl.js";import{_ as C}from"./TextInput-QkZjzCho.js";import S from"./QuestionOptions-BfaIGRM-.js";import{_ as Q}from"./LucideIcon-CYYJCXCs.js";import E from"./ExplanationSteps-BhEapXn8.js";import V from"./test-CYSGOgZH.js";import A from"./QuestionParser-LNN6PiWu.js";import{p as I}from"./questionParser-DdZqDloY.js";import $ from"./BulkQuestionImport2-D1_NMY7U.js";import{M as P}from"./Modal-DgRFYELY.js";import{l as T}from"./ui-B7TfxbV_.js";import"./app-4gpSDtVV.js";import U from"./img_marker_main-WleO-9mZ.js";import D from"./lesson_explain_main-B4xmwEba.js";import"./Pagination7-C1qEzP_C.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./SecondaryButton-WaufSYeJ.js";import"./ImportExcel-DcRIWk0g.js";import"./xlsx-BHXqx-YI.js";import"./Dropdown8-COOs5r23.js";import"./createLucideIcon-bevK9Pnz.js";import"./printer-yyUpIzJF.js";import"./image-T1FtDBZI.js";import"./Modal_99-Diu6BTP0.js";import"./TestWorksheetSettings-R-XNh3t6.js";import"./TestWorksheetDisplay-CI_UXCrK.js";import"./katex-BXKQVcz-.js";import"./purify.es-C2Ba6vpb.js";import"./AdvancedImageMarker-uzhwneb3.js";import"./lesson_explain-DTbT8WqQ.js";const B={class:"py-12"},N={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},F={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-6"},O={class:"mb-6 space-y-4"},M=["value"],L=["disabled"],W=["value"],J=["disabled"],R=["value"],X={class:"mb-6 flex justify-end gap-2"},H={class:"text-lg font-medium text-gray-900"},K={class:"space-y-6"},Z={class:"space-y-4"},z={class:"flex items-center gap-2"},G=["id","onUpdate:modelValue","required"],Y={value:""},ee=["value"],le=["id","onUpdate:modelValue","required"],oe={class:"p-6"},ae="Question",te="/admin/question-banks",ie={__name:"Index",props:{records:Object,options:Object},setup(ie){const re=ie,se=e(!1),ue=e(null),ne=e("all"),de=e(!1),ce=e({}),me=e(""),pe=e(""),ve=e(""),ye=e(""),be=e(!1),fe=l(()=>{var e;return(null==(e=re.options)?void 0:e.schools)||[]}),ge=e([]),he=e([]),ke=l(()=>pe.value&&ve.value&&ye.value),xe=e=>{console.log(e)},je=l(()=>{if(!Ee.value)return[];let e=[...Ee.value];return pe.value&&(e=e.filter(e=>e.school_id===pe.value.id)),ve.value&&(e=e.filter(e=>e.subject_id===ve.value.id)),ye.value&&(e=e.filter(e=>e.curriculum_id===ye.value.id)),e}),we=async()=>{if(ve.value="",ye.value="",he.value=[],pe.value){be.value=!0;try{const e=await g.get(`/api/schools/${pe.value.id}/subjects`);ge.value=e.data}catch(e){console.error("Error loading subjects:",e),ge.value=[]}finally{be.value=!1}}else ge.value=[]},_e=async()=>{if(ye.value="",ve.value){be.value=!0;try{const e=await g.get(`/api/subjects/${ve.value.id}/curricula`);he.value=e.data}catch(e){console.error("Error loading curricula:",e),he.value=[]}finally{be.value=!1}}else he.value=[]},qe=()=>{},Ce=async()=>{const e=T.loading("Reading clipboard...");try{if(!navigator.clipboard)throw new Error("Clipboard access is not available. Please check your browser permissions or use a modern browser.");const l=await navigator.clipboard.readText();if(!l.trim())throw new Error("Clipboard is empty. Please copy some text first.");const o=I(l);if(!o.success)throw new Error(o.error||"Invalid question format. Please check the text structure.");Ve.value.body=o.data.body,Ve.value.options=o.data.options,T.update(e,{render:"Question parsed successfully",type:"success",isLoading:!1,autoClose:3e3})}catch(l){console.error("Clipboard operation failed:",l);let o="Failed to paste from clipboard: ";"NotAllowedError"===l.name?o+="Clipboard permission denied. Please allow clipboard access.":"SecurityError"===l.name?o+="Clipboard access blocked due to security settings.":"ClipboardQuotaExceededError"===l.name?o+="Clipboard content is too large to process.":o+=l.message||"Unknown error occurred",T.update(e,{render:o,type:"error",isLoading:!1,autoClose:5e3})}},Se=[{name:"title",label:"Title",type:"text",required:!0},{name:"body",label:"Question Body",type:"textarea",required:!0},{name:"type",label:"Question Type",type:"select",options:[{id:"mcq",name:"Multiple Choice"},{id:"true_false",name:"True/False"},{id:"fill_blank",name:"Fill in the Blank"}],required:!0},{name:"score",label:"Score",type:"number",required:!0,default:"1"},{name:"difficulty",label:"Difficulty",type:"select",options:[{id:"easy",name:"Easy"},{id:"medium",name:"Medium"},{id:"hard",name:"Hard"}],required:!0,default:"medium"},{name:"options",label:"Options",type:"custom",component:S,required:!0},{name:"explanation",label:"Explanation Steps",type:"custom",component:E},{name:"notes",label:"Notes",type:"textarea"}],Qe=[{key:"title",label:"Title"},{key:"type",label:"Type"},{key:"score",label:"Score"},{key:"school.name",label:"School"},{key:"subject.name",label:"Subject"},{key:"actions",label:"Actions"}],Ee=e([]);l(()=>re.records.links);const Ve=e({school_id:"",subject_id:"",curriculum_id:"",title:"",body:"",type:"mcq",score:"1",difficulty:"medium",options:[{option:"",isCorrect:!1,feedback:""}],explanation:[{id:Date.now(),step:"",note:""}],notes:""}),Ae=[{type:"edit",label:"Edit",icon:"edit"},{type:"copy",label:"Copy as New",icon:"copy"},{type:"delete",label:"Delete",icon:"trash-2"}],Ie=async({type:e,item:l})=>{try{if(!l||!l.id)return void T.error("Invalid item selected");if("edit"===e)$e(l);else if("copy"===e){const e={...l,title:`Copy of ${l.title}`,id:null};$e(e,!0)}else if("delete"===e){if(!confirm("Are you sure you want to delete this question?"))return;await h.delete(`${te}/${l.id}`,{preserveScroll:!0,onSuccess:()=>{T.success("Question deleted successfully")},onError:e=>{T.error(e.message||"Failed to delete question")}})}}catch(o){T.error("An error occurred while processing your request"),console.error("Action error:",o)}},$e=(e=null,l=!1)=>{var o,a,t;(null==(o=pe.value)?void 0:o.id)&&(null==(a=ve.value)?void 0:a.id)&&(null==(t=ye.value)?void 0:t.id)?(e?(ue.value=l?null:e,Ve.value={school_id:pe.value.id,subject_id:ve.value.id,curriculum_id:ye.value.id,title:l?`Copy of ${e.title}`:e.title,body:e.body,type:e.type||"mcq",score:e.score||"1",difficulty:e.difficulty||"medium",options:Array.isArray(e.options)?JSON.parse(JSON.stringify(e.options)):[{option:"",isCorrect:!1,feedback:""}],explanation:Array.isArray(e.explanation)?e.explanation.map(e=>({id:Date.now()+Math.random(),step:e.step,note:e.note})):[{id:Date.now(),step:"",note:""}],notes:e.notes||""}):(ue.value=null,Ve.value={school_id:pe.value.id,subject_id:ve.value.id,curriculum_id:ye.value.id,title:"",body:"",type:"mcq",score:"1",difficulty:"medium",options:[{option:"",isCorrect:!1,feedback:""}],explanation:[{id:Date.now(),step:"",note:""}],notes:""}),Ve.value.school_id&&Ve.value.subject_id&&Ve.value.curriculum_id?se.value=!0:T.error("Required IDs are missing. Please check your selections.")):T.error("Please select school, subject and curriculum first")};l(()=>{if(!ue.value)return`Create New ${ae}`;switch(ne.value){case"text":return"Edit Question Text";case"options":return"Edit Question Options";case"explanation":return"Edit Question Explanation";default:return`Edit ${ae}`}});const Pe=async()=>{var e,l;de.value=!0,ce.value={};try{const e=ue.value?`${te}/${ue.value.id}`:te;await(ue.value?h.put(e,Ve.value):h.post(e,Ve.value)),se.value=!1,T.success(`Question ${ue.value?"updated":"created"} successfully`)}catch(o){(null==(l=null==(e=o.response)?void 0:e.data)?void 0:l.errors)&&(ce.value=o.response.data.errors),T.error("Failed to save question")}finally{de.value=!1}};e(!1),e(""),e(!1);const Te=[{key:"title",label:"Title",required:!0},{key:"body",label:"Question Body",required:!0},{key:"type",label:"Question Type",required:!0},{key:"score",label:"Score",required:!0},{key:"difficulty",label:"Difficulty",required:!0},{key:"options",label:"Options",required:!0},{key:"explanation",label:"Explanation"},{key:"notes",label:"Notes"}],Ue=()=>{var e,l,o;(null==(e=pe.value)?void 0:e.id)&&(null==(l=ve.value)?void 0:l.id)&&(null==(o=ye.value)?void 0:o.id)?(ue.value=null,Ve.value={school_id:pe.value.id,subject_id:ve.value.id,curriculum_id:ye.value.id,title:"",body:"",type:"mcq",score:"1",difficulty:"medium",options:[{option:"",isCorrect:!1,feedback:""}],explanation:[{id:Date.now(),step:"",note:""}],notes:""},se.value=!0):T.error("Please select school, subject and curriculum first")},De=e(!1);o(()=>{var e;return null==(e=re.records)?void 0:e.data},e=>{e&&(Ee.value=[...e])},{immediate:!0}),o([pe,ve,ye],([e,l,o])=>{se.value&&(Ve.value.school_id=(null==e?void 0:e.id)||"",Ve.value.subject_id=(null==l?void 0:l.id)||"",Ve.value.curriculum_id=(null==o?void 0:o.id)||"")});const Be=e(!1),Ne=async e=>{var l,o,a,t,i;try{if(!(null==(l=pe.value)?void 0:l.id)||!(null==(o=ve.value)?void 0:o.id)||!(null==(a=ye.value)?void 0:a.id))return void T.error("Please select school, subject and curriculum first");if(!Array.isArray(e)||0===e.length)return void T.error("No valid questions to import");T.info(`Processing ${e.length} questions...`);let s=0,u=0;for(const l of e)try{const e={...l,school_id:pe.value.id,subject_id:ve.value.id,curriculum_id:ye.value.id,title:(null==(t=l.title)?void 0:t.trim())||`Question ${s+1}`,body:(null==(i=l.body)?void 0:i.trim())||"",type:l.type||"mcq",score:parseInt(l.score)||1,difficulty:l.difficulty||"medium",options:Array.isArray(l.options)?l.options:[],explanation:Array.isArray(l.explanation)?l.explanation:[]};await h.post(te,e),s++}catch(r){console.error("Failed to import question:",r),u++}Be.value=!1,await h.reload({only:["records"]}),0===u?T.success(`Successfully imported ${s} questions`):T.warning(`Imported ${s} questions, ${u} failed`)}catch(s){console.error("Bulk import error:",s),T.error("Failed to process bulk import")}};return(e,l)=>(t(),a(m,null,[i(k,{title:"Question Bank"},{default:r(()=>[i(D),i(U),s("div",B,[s("div",N,[s("div",F,[l[12]||(l[12]=s("h2",{class:"text-2xl font-bold mb-6"},"Question Bank",-1)),i(A),s("div",O,[s("div",null,[i(_,{value:"School"}),d(s("select",{"onUpdate:modelValue":l[0]||(l[0]=e=>pe.value=e),onChange:we,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[l[7]||(l[7]=s("option",{value:""},"Select School",-1)),(t(!0),a(m,null,p(fe.value,e=>(t(),a("option",{key:e.id,value:e},v(e.name),9,M))),128))],544),[[c,pe.value]])]),s("div",null,[i(_,{value:"Subject"}),d(s("select",{"onUpdate:modelValue":l[1]||(l[1]=e=>ve.value=e),onChange:_e,disabled:!pe.value,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[l[8]||(l[8]=s("option",{value:""},"Select Subject",-1)),(t(!0),a(m,null,p(ge.value,e=>(t(),a("option",{key:e.id,value:e},v(e.name),9,W))),128))],40,L),[[c,ve.value]])]),s("div",null,[i(_,{value:"Curriculum"}),d(s("select",{"onUpdate:modelValue":l[2]||(l[2]=e=>ye.value=e),onChange:qe,disabled:!ve.value,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[l[9]||(l[9]=s("option",{value:""},"Select Curriculum",-1)),(t(!0),a(m,null,p(he.value,e=>(t(),a("option",{key:e.id,value:e},v(e.name),9,R))),128))],40,J),[[c,ye.value]])])]),s("div",X,[i(x,{onClick:Ue,disabled:!ke.value,class:"flex items-center gap-2"},{default:r(()=>[i(Q,{name:"plus",class:"w-4 h-4"}),l[10]||(l[10]=y(" Add New Question "))]),_:1},8,["disabled"]),i(x,{onClick:l[3]||(l[3]=e=>Be.value=!0),class:"flex items-center gap-2 ml-2"},{default:r(()=>[i(Q,{name:"file-plus",class:"w-4 h-4"}),l[11]||(l[11]=y(" Bulk Import "))]),_:1})]),i(V,{questions:je.value,showSettings:De.value},null,8,["questions","showSettings"]),i(j,{"base-url":te,columns:Qe,items:je.value,loading:be.value,actions:Ae,"import-columns":Te,onAction:Ie},null,8,["items","loading"])])])]),i(A,{get_text:me.value,onSet_question:xe},null,8,["get_text"]),se.value?(t(),u(w,{key:0,modelValue:se.value,"onUpdate:modelValue":l[4]||(l[4]=e=>se.value=e),submitting:de.value,errors:ce.value,form:Ve.value,onSubmit:Pe},{header:r(()=>[s("h2",H,v(ue.value?"Edit Question":"Create Question"),1)]),default:r(()=>[s("div",K,[s("div",Z,[s("div",z,[s("button",{type:"button",onClick:Ce,class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors flex items-center gap-2"},[i(Q,{name:"clipboard",class:"w-4 h-4"}),l[13]||(l[13]=y(" Paste from Clipboard "))])])]),(t(),a(m,null,p(Se,e=>s("div",{key:e.name},[i(_,{for:e.name,value:e.label},null,8,["for","value"]),"custom"===e.type?(t(),u(b(e.component),{key:0,modelValue:Ve.value[e.name],"onUpdate:modelValue":l=>Ve.value[e.name]=l,class:"mt-1 block w-full"},null,8,["modelValue","onUpdate:modelValue"])):"select"===e.type?d((t(),a("select",{key:1,id:e.name,"onUpdate:modelValue":l=>Ve.value[e.name]=l,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",required:null==e?void 0:e.required},[s("option",Y,"Select "+v(e.label),1),(t(!0),a(m,null,p(e.options,e=>(t(),a("option",{key:e.id,value:e.id},v(e.name),9,ee))),128))],8,G)),[[c,Ve.value[e.name]]]):"textarea"===e.type?d((t(),a("textarea",{key:2,id:e.name,"onUpdate:modelValue":l=>Ve.value[e.name]=l,rows:"4",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",required:null==e?void 0:e.required},null,8,le)),[[f,Ve.value[e.name]]]):(t(),u(C,{key:3,id:e.name,modelValue:Ve.value[e.name],"onUpdate:modelValue":l=>Ve.value[e.name]=l,type:e.type,class:"mt-1 block w-full",required:null==e?void 0:e.required},null,8,["id","modelValue","onUpdate:modelValue","type","required"])),i(q,{message:ce.value[e.name],class:"mt-2"},null,8,["message"])])),64))])]),_:1},8,["modelValue","submitting","errors","form"])):n("",!0)]),_:1}),i(P,{show:Be.value,onClose:l[6]||(l[6]=e=>Be.value=!1),maxWidth:"4xl"},{content:r(()=>[s("div",oe,[l[14]||(l[14]=s("h2",{class:"text-lg font-medium text-gray-900 mb-4"}," Bulk Import Questions ",-1)),i($,{onQuestionsImported:Ne,onClose:l[5]||(l[5]=e=>Be.value=!1)})])]),_:1},8,["show"])],64))}};export{ie as default};
