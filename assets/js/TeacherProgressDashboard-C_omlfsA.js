import{r as e,u as s,b as a,H as o,aR as t,i as l,aS as r,k as i,Q as n,j as p,c,d,f as u,h as m,o as g,e as v}from"./app-YpH5vqWh.js";import{Q as y}from"./QBadge-DepkVBS8.js";import{Q as f}from"./QTd-CiPqKlV-.js";import{Q as _}from"./QTable-CgaOzZjZ.js";import{f as b,o as k,af as w,N as h,J as x,b as C,R as F,V as q,K as z,y as S,O as j,I as P,W as I,S as Q,F as V,_ as L}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./QMarkupTable-DGv5_oX8.js";import"./QSelect-jBpShTzY.js";import"./rtl-Cr6c3OOr.js";import"./QLinearProgress-DZgk7T4R.js";import"./use-fullscreen-DDGrUiCT.js";const E={class:"teacher-dashboard q-pa-md"},O={class:"row items-center q-mb-lg"},R={class:"col"},T={class:"text-grey-7 q-mb-none"},A={class:"col-auto"},B={class:"row items-center q-gutter-xs"},$={class:"text-caption"},U={key:0},G={key:1},N={key:2,class:"text-grey-5"},D={key:0},H={class:"text-caption q-ml-xs"},M={key:1},J={class:"text-caption"},K={class:"text-caption text-grey-7"},W={key:2,class:"text-grey-5"},X={class:"text-caption text-grey-7"},Y={key:0,class:"q-mb-md"},Z={key:0,class:"submission-preview"},ee=["src"],se={key:1,class:"submission-preview"},ae=["src"],oe=e({__name:"TeacherProgressDashboard",props:{lessonId:{type:Number,required:!0},teacherId:{type:Number,required:!0}},setup(e){const oe=s(),te=e,le=b(null),re=b([]),ie=b(!1),ne=b(!1),pe=b(null),ce=b(null),de=b(null),ue=b(""),me=b(!1),ge=[{name:"name",label:"Student Name",field:"name",align:"left",sortable:!0},{name:"status",label:"Status",field:"status",align:"center"},{name:"color",label:"Color",field:"color",align:"center"},{name:"learn",label:"Learn",field:"learn",align:"center"},{name:"practice",label:"Practice",field:"practice",align:"center"},{name:"quiz",label:"Quiz",field:"quiz",align:"center"},{name:"actions",label:"Actions",field:"actions",align:"center"}],ve={gray:"#9E9E9E",light_blue:"#03A9F4",blue:"#2196F3",purple:"#9C27B0",green:"#4CAF50",yellow:"#FFEB3B",dark_yellow:"#FFC107",orange:"#FF9800",red:"#F44336"},ye=async()=>{ie.value=!0;try{const e=await L.get(route("lesson-presentation.show",{id:te.lessonId}));le.value=e.data;const s=await L.get(route("lesson-presentation.progress.lesson",{lessonId:te.lessonId}));s.data.forEach(e=>{}),re.value=s.data.map(e=>{var s;return{id:e.student_id,name:(null==(s=e.student)?void 0:s.name)||`Student ${e.student_id}`,progress:e}})}catch(e){console.error("Failed to fetch progress:",e),oe.notify({type:"negative",message:"Failed to load progress data",position:"top"})}finally{ie.value=!1}},fe=e=>e&&"locked"!==e.status?e.status.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"Locked",_e=async()=>{oe.dialog({title:"Confirm",message:"Open this lesson for all students?",cancel:!0}).onOk(async()=>{try{const e=re.value.map(e=>e.id);await L.post(route("lesson-presentation.progress.open"),{lesson_id:te.lessonId,student_ids:e,teacher_id:te.teacherId}),oe.notify({type:"positive",message:"Lesson opened for all students",position:"top"}),ye()}catch(e){oe.notify({type:"negative",message:"Failed to open lesson for all",position:"top"})}})},be=async e=>{pe.value=e,de.value=null,ue.value="";try{const s=await L.get(route("lesson-presentation.progress.submission",{progressId:e.progress.id}));ce.value=s.data.submission,ne.value=!0}catch(s){oe.notify({type:"negative",message:"Failed to load practice submission",position:"top"})}},ke=async()=>{me.value=!0;try{await L.put(route("lesson-presentation.progress.grade-practice",{id:pe.value.progress.id}),{score:de.value,feedback:ue.value}),oe.notify({type:"positive",message:"Practice graded successfully",position:"top"}),ne.value=!1,ye()}catch(e){oe.notify({type:"negative",message:"Failed to submit grade",position:"top"})}finally{me.value=!1}};return k(()=>{ye()}),(e,s)=>{var b,k;const we=w("Head");return x(),h(V,null,[C(we,{title:(null==(b=le.value)?void 0:b.name)?`Progress: ${le.value.name}`:"Student Progress"},null,8,["title"]),F("div",E,[F("div",O,[F("div",R,[s[3]||(s[3]=F("h4",{class:"text-h4 q-my-none"},"Student Progress Dashboard",-1)),F("p",T,q(null==(k=le.value)?void 0:k.name),1)]),F("div",A,[C(o,{outline:""},{default:z(()=>[C(a,{label:"Open for All",icon:"lock_open",color:"positive",onClick:_e}),C(a,{label:"Refresh",icon:"refresh",onClick:ye})]),_:1})])]),C(_,{rows:re.value,columns:ge,"row-key":"id",loading:ie.value,flat:"",bordered:"",class:"shadow-2"},{"body-cell-status":z(e=>[C(f,{props:e},{default:z(()=>{return[C(y,{color:(s=e.row.progress,s?"completed"===s.status?"positive":"failed"===s.status?"negative":"practice_submitted"===s.status?"purple":"info":"grey"),label:fe(e.row.progress)},null,8,["color","label"])];var s}),_:2},1032,["props"])]),"body-cell-color":z(e=>[C(f,{props:e},{default:z(()=>{var s,a,o;return[F("div",B,[F("div",{class:"color-indicator",style:Q({backgroundColor:(o=null==(s=e.row.progress)?void 0:s.color_status,ve[o]||ve.gray)})},null,4),F("span",$,q((null==(a=e.row.progress)?void 0:a.color_status)||"gray"),1)])]}),_:2},1032,["props"])]),"body-cell-learn":z(e=>[C(f,{props:e},{default:z(()=>{var s,a;return[C(n,{name:(null==(s=e.row.progress)?void 0:s.learn_completed_at)?"check_circle":"radio_button_unchecked",color:(null==(a=e.row.progress)?void 0:a.learn_completed_at)?"positive":"grey",size:"sm"},null,8,["name","color"])]}),_:2},1032,["props"])]),"body-cell-practice":z(e=>[C(f,{props:e},{default:z(()=>{var s,o;return[null!==(null==(s=e.row.progress)?void 0:s.practice_score)?(x(),h("div",U,[C(y,{color:e.row.progress.practice_score>=6?"positive":"negative"},{default:z(()=>[I(q(e.row.progress.practice_score)+"/10 ",1)]),_:2},1032,["color"])])):"practice_submitted"===(null==(o=e.row.progress)?void 0:o.status)?(x(),h("div",G,[C(a,{size:"sm",color:"primary",label:"Grade",onClick:s=>be(e.row)},null,8,["onClick"])])):(x(),h("span",N,"-"))]}),_:2},1032,["props"])]),"body-cell-quiz":z(e=>[C(f,{props:e},{default:z(()=>{var a,o;return[(null==(a=e.row.progress)?void 0:a.quiz_passed)?(x(),h("div",D,[C(n,{name:"check_circle",color:"positive",size:"sm"}),F("span",H,q(e.row.progress.quiz_best_score)+"%",1)])):(null==(o=e.row.progress)?void 0:o.quiz_attempts)>0?(x(),h("div",M,[F("span",J,q(e.row.progress.quiz_attempts)+" attempts",1),s[4]||(s[4]=F("br",null,null,-1)),F("span",K,"Best: "+q(e.row.progress.quiz_best_score)+"%",1)])):(x(),h("span",W,"-"))]}),_:2},1032,["props"])]),"body-cell-actions":z(e=>[C(f,{props:e},{default:z(()=>[C(t,{size:"sm",color:"primary",label:"Actions",dense:""},{default:z(()=>[C(l,null,{default:z(()=>{var a,o,t,l;return[e.row.progress&&"locked"!==e.row.progress.status?S((x(),P(p,{key:1,clickable:"",onClick:s=>(async e=>{try{await L.post(route("lesson-presentation.progress.lock"),{progress_id:e.progress.id}),oe.notify({type:"positive",message:`Lesson locked for ${e.name}`,position:"top"}),ye()}catch(s){oe.notify({type:"negative",message:"Failed to lock lesson",position:"top"})}})(e.row)},{default:z(()=>[C(i,{avatar:""},{default:z(()=>[C(n,{name:"lock",color:"negative"})]),_:1}),C(i,null,{default:z(()=>s[6]||(s[6]=[I("Lock Lesson")])),_:1})]),_:2},1032,["onClick"])),[[r]]):S((x(),P(p,{key:0,clickable:"",onClick:s=>(async e=>{try{await L.post(route("lesson-presentation.progress.open"),{lesson_id:te.lessonId,student_ids:[e.id],teacher_id:te.teacherId}),oe.notify({type:"positive",message:`Lesson opened for ${e.name}`,position:"top"}),ye()}catch(s){oe.notify({type:"negative",message:"Failed to open lesson",position:"top"})}})(e.row)},{default:z(()=>[C(i,{avatar:""},{default:z(()=>[C(n,{name:"lock_open",color:"positive"})]),_:1}),C(i,null,{default:z(()=>s[5]||(s[5]=[I("Open Lesson")])),_:1})]),_:2},1032,["onClick"])),[[r]]),C(c),(null==(a=e.row.progress)?void 0:a.practice_submitted_at)?S((x(),P(p,{key:2,clickable:"",onClick:s=>(async e=>{be(e)})(e.row)},{default:z(()=>[C(i,{avatar:""},{default:z(()=>[C(n,{name:"visibility",color:"info"})]),_:1}),C(i,null,{default:z(()=>s[7]||(s[7]=[I("View Practice")])),_:1})]),_:2},1032,["onClick"])),[[r]]):j("",!0),(null==(o=e.row.progress)?void 0:o.quiz_attempts)>=3&&!(null==(t=e.row.progress)?void 0:t.quiz_passed)?S((x(),P(p,{key:3,clickable:"",onClick:s=>(async e=>{try{await L.post(route("lesson-presentation.progress.grant-attempt"),{progress_id:e.progress.id}),oe.notify({type:"positive",message:"Extra attempt granted",position:"top"}),ye()}catch(s){oe.notify({type:"negative",message:"Failed to grant attempt",position:"top"})}})(e.row)},{default:z(()=>[C(i,{avatar:""},{default:z(()=>[C(n,{name:"add_circle",color:"warning"})]),_:1}),C(i,null,{default:z(()=>s[8]||(s[8]=[I("Grant Extra Attempt")])),_:1})]),_:2},1032,["onClick"])),[[r]]):j("",!0),"failed"===(null==(l=e.row.progress)?void 0:l.status)?S((x(),P(p,{key:4,clickable:"",onClick:s=>(async e=>{oe.dialog({title:"Confirm Force Pass",message:`Force pass ${e.name}? This will mark the lesson as completed.`,cancel:!0}).onOk(async()=>{try{await L.post(route("lesson-presentation.progress.force-pass"),{progress_id:e.progress.id}),oe.notify({type:"positive",message:"Student force passed",position:"top"}),ye()}catch(s){oe.notify({type:"negative",message:"Failed to force pass",position:"top"})}})})(e.row)},{default:z(()=>[C(i,{avatar:""},{default:z(()=>[C(n,{name:"done_all",color:"positive"})]),_:1}),C(i,null,{default:z(()=>s[9]||(s[9]=[I("Force Pass")])),_:1})]),_:2},1032,["onClick"])),[[r]]):j("",!0),C(c),e.row.progress?S((x(),P(p,{key:5,clickable:"",onClick:s=>(async e=>{oe.dialog({title:"Confirm Reset",message:`Reset all progress for ${e.name}? This cannot be undone.`,cancel:!0}).onOk(async()=>{try{await L.post(route("lesson-presentation.progress.reset"),{progress_id:e.progress.id}),oe.notify({type:"positive",message:"Progress reset successfully",position:"top"}),ye()}catch(s){oe.notify({type:"negative",message:"Failed to reset progress",position:"top"})}})})(e.row)},{default:z(()=>[C(i,{avatar:""},{default:z(()=>[C(n,{name:"restart_alt",color:"negative"})]),_:1}),C(i,null,{default:z(()=>s[10]||(s[10]=[I("Reset Progress")])),_:1})]),_:2},1032,["onClick"])),[[r]]):j("",!0)]}),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading"]),C(v,{modelValue:ne.value,"onUpdate:modelValue":s[2]||(s[2]=e=>ne.value=e),persistent:""},{default:z(()=>[C(d,{style:{"min-width":"600px"}},{default:z(()=>[C(u,null,{default:z(()=>{var e;return[s[11]||(s[11]=F("div",{class:"text-h6"},"Grade Practice Submission",-1)),F("div",X,"Student: "+q(null==(e=pe.value)?void 0:e.name),1)]}),_:1}),C(u,null,{default:z(()=>[ce.value?(x(),h("div",Y,[s[12]||(s[12]=F("div",{class:"text-subtitle2 q-mb-sm"},"Submission:",-1)),"upload"===ce.value.submission_type?(x(),h("div",Z,[F("img",{src:ce.value.file_url,alt:"Practice submission",style:{"max-width":"100%","max-height":"400px"}},null,8,ee)])):(x(),h("div",se,[F("img",{src:ce.value.drawing_data,alt:"Drawing submission",style:{"max-width":"100%","max-height":"400px"}},null,8,ae)]))])):j("",!0),C(m,{modelValue:de.value,"onUpdate:modelValue":s[0]||(s[0]=e=>de.value=e),modelModifiers:{number:!0},type:"number",label:"Score (0-10)",min:0,max:10,outlined:"",class:"q-mb-md"},{append:z(()=>s[13]||(s[13]=[F("span",{class:"text-caption"},"/10",-1)])),_:1},8,["modelValue"]),C(m,{modelValue:ue.value,"onUpdate:modelValue":s[1]||(s[1]=e=>ue.value=e),type:"textarea",label:"Feedback (optional)",rows:"3",outlined:"",maxlength:"500",counter:""},null,8,["modelValue"])]),_:1}),C(g,{align:"right"},{default:z(()=>[S(C(a,{flat:"",label:"Cancel",color:"grey"},null,512),[[r]]),C(a,{unelevated:"",label:"Submit Grade",color:"primary",onClick:ke,disable:null===de.value||de.value<0||de.value>10,loading:me.value},null,8,["disable","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])],64)}}},[["__scopeId","data-v-aeeaec20"]]);export{oe as default};
