import{r as e}from"./app-4gpSDtVV.js";import{f as t,a as r,o as a,e as s,N as o,J as l,R as n,O as i,S as d,U as u,V as c,y as p,ac as g,a2 as k,a0 as b,ab as v,F as x,Q as y,n as h}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";const f={class:"px-6 py-4"},m={key:1,class:"w-6 mr-2"},w={class:"mr-3"},C={class:"flex-1 min-w-0"},_={class:"flex items-center gap-2"},D={key:1,class:"flex items-center gap-2 flex-1"},M={key:2,class:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full"},j={class:"flex items-center gap-1 ml-1"},E=["title"],L=["title"],S={key:0,class:"mt-1"},T={key:1,class:"flex items-start gap-2"},B={class:"flex flex-col gap-1"},P={key:1,class:"mt-1"},I={class:"px-4 py-4"},U={key:0,class:"text-sm text-gray-900 dark:text-gray-100"},$={key:1,class:"flex items-center gap-2"},z={class:"px-4 py-4 text-right"},A={class:"flex justify-end items-center gap-1 relative group"},V={class:"absolute right-0 top-2 w-56 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-3 opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto transition-opacity z-10"},N={class:"space-y-2"},K={class:"flex items-center justify-between gap-2"},R=["value"],O={class:"flex items-center justify-between gap-2"},Q=["value"],q={class:"flex items-center justify-end gap-1"},F={key:0,class:"bg-blue-50 dark:bg-blue-900/30"},H={colspan:"3",class:"px-6 py-2 text-xs text-blue-700 dark:text-blue-200 border-l-4 border-blue-400"},J={class:"flex items-center gap-4"},G={class:"font-medium"},W={key:0},X={key:1},Y={key:2},Z={key:1},ee={colspan:"3",class:"px-6 py-4 bg-blue-50 dark:bg-blue-900/30 border-l-4 border-blue-400"},te={class:"flex items-center justify-between"},re={class:"flex items-center gap-4"},ae={class:"text-sm font-medium text-blue-900"},se=["value","disabled"],oe={class:"flex gap-2"},le=e({__name:"TaskTreeRow",props:{task:{type:Object,required:!0},expanded:{type:Boolean,default:!1},viewMode:{type:String,default:"tree"},allTasks:{type:Array,default:()=>[]}},emits:["toggle-expand","edit","delete","add-subtask","move-task","update-status","update-priority","inline-update"],setup(e,{emit:le}){const ne=e,ie=le,de=t(!1),ue=t(null),ce=t(null),pe=t({title:"",description:"",due_date:""}),ge=t(null),ke=t(null),be=t(null),ve=r(()=>ne.allTasks.some(e=>e.parent_id===ne.task.id)),xe=r(()=>ne.allTasks.filter(e=>e.id!==ne.task.id&&!Ce(e.id,ne.task.id))),ye=()=>{ie("move-task",{task:ne.task,newParentId:ue.value}),de.value=!1,ue.value=null},he=async e=>{if(ce.value)return;ce.value=e,pe.value={title:ne.task.title||"",description:ne.task.description||"",due_date:ne.task.due_date||""},await h();const t="title"===e?ge.value:"description"===e?ke.value:"due_date"===e?be.value:null;t&&(t.focus(),"title"!==e&&"description"!==e||t.select())},fe=async e=>{if(!ce.value)return;const t=pe.value[e];if(t!==(ne.task[e]||"")){if("title"===e&&!t.trim()){const e=ge.value;return void(e&&(e.focus(),e.select()))}if("due_date"===e&&t){const e=new Date(t);if(isNaN(e.getTime())){const e=be.value;return void(e&&e.focus())}}ie("inline-update",{task:ne.task,field:e,value:("description"!==e||t.trim())&&("due_date"!==e||t.trim())?t.trim():null}),ce.value=null}else me()},me=()=>{ce.value=null,pe.value={title:"",description:"",due_date:""}},we=e=>{ce.value&&"Escape"===e.key&&(e.preventDefault(),me())};a(()=>{document.addEventListener("keydown",we)}),s(()=>{document.removeEventListener("keydown",we)});const Ce=(e,t)=>{const r=ne.allTasks.find(t=>t.id===e);if(!r)return!1;let a=r;for(;a.parent_id;){if(a.parent_id===t)return!0;if(a=ne.allTasks.find(e=>e.id===a.parent_id),!a)break}return!1},_e=e=>({pending:"bg-yellow-400",in_progress:"bg-blue-400",completed:"bg-green-400"}[e]||"bg-gray-400"),De=e=>{if(!e)return"No due date";const t=new Date(e),r=new Date,a=new Date(r);if(a.setDate(a.getDate()+1),t.toDateString()===r.toDateString())return"Today";if(t.toDateString()===a.toDateString())return"Tomorrow";if(t<r){const e=Math.abs(r-t),a=Math.ceil(e/864e5);return`${a} day${a>1?"s":""} overdue`}return t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})};return(t,r)=>{return l(),o(x,null,[n("tr",{class:u(["transition-colors",e.task.depth>0?"bg-gray-25 dark:bg-gray-900":"dark:bg-gray-800",ce.value?"bg-blue-50 dark:bg-blue-900/30 border-l-4 border-blue-400":"hover:bg-gray-50 dark:hover:bg-gray-700"])},[n("td",f,[n("div",{class:"flex items-center",style:d({paddingLeft:24*e.task.depth+"px"})},[ve.value?(l(),o("button",{key:0,onClick:r[0]||(r[0]=r=>t.$emit("toggle-expand",e.task.id)),class:"mr-2 p-1 hover:bg-gray-200 rounded transition-colors"},[(l(),o("svg",{class:u(["w-4 h-4 transition-transform",e.expanded?"rotate-90":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},r[28]||(r[28]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)]),2))])):(l(),o("div",m)),n("div",w,[n("div",{class:u(["w-3 h-3 rounded-full",_e(e.task.status)])},null,2)]),n("div",C,[n("div",_,["title"!==ce.value?(l(),o("div",{key:0,onDblclick:r[1]||(r[1]=e=>he("title")),class:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-1 py-0.5 rounded",title:"Double-click to edit"},c(e.task.title),33)):(l(),o("div",D,[p(n("input",{ref_key:"titleInput",ref:ge,"onUpdate:modelValue":r[2]||(r[2]=e=>pe.value.title=e),onBlur:r[3]||(r[3]=e=>fe("title")),onKeydown:[r[4]||(r[4]=k(e=>fe("title"),["enter"])),k(me,["escape"]),r[5]||(r[5]=k(e=>fe("title"),["tab"]))],class:"text-sm font-medium text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-800 border border-blue-300 dark:border-gray-600 rounded px-2 py-1 flex-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",maxlength:"255",placeholder:"Enter task title..."},null,544),[[g,pe.value.title]]),n("button",{onClick:r[6]||(r[6]=e=>fe("title")),class:"p-1 text-green-600 hover:text-green-800 rounded",title:"Save"},r[29]||(r[29]=[n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])),n("button",{onClick:me,class:"p-1 text-red-600 hover:text-red-800 rounded",title:"Cancel"},r[30]||(r[30]=[n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])),e.task.depth>0?(l(),o("span",M," L"+c(e.task.depth),1)):i("",!0),n("div",j,[n("span",{title:"Status: "+e.task.status,class:u(["w-2.5 h-2.5 rounded-full",_e(e.task.status)])},null,10,E),n("span",{title:"Priority: "+e.task.priority,class:u(["w-2.5 h-2.5 rounded-full","high"===e.task.priority?"bg-red-500":"medium"===e.task.priority?"bg-orange-500":"bg-gray-400"])},null,10,L)])]),e.task.description||"description"===ce.value?(l(),o("div",S,["description"!==ce.value?(l(),o("div",{key:0,onDblclick:r[7]||(r[7]=e=>he("description")),class:"text-sm text-gray-500 dark:text-gray-300 truncate cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-1 py-0.5 rounded",title:"Double-click to edit"},c(e.task.description||"Add description..."),33)):(l(),o("div",T,[p(n("textarea",{ref_key:"descriptionInput",ref:ke,"onUpdate:modelValue":r[8]||(r[8]=e=>pe.value.description=e),onBlur:r[9]||(r[9]=e=>fe("description")),onKeydown:[r[10]||(r[10]=k(b(e=>fe("description"),["ctrl"]),["enter"])),k(me,["escape"]),r[11]||(r[11]=k(e=>fe("description"),["tab"]))],class:"text-sm text-gray-500 dark:text-gray-300 bg-white dark:bg-gray-800 border border-blue-300 dark:border-gray-600 rounded px-2 py-1 flex-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",rows:"2",placeholder:"Enter description... (Ctrl+Enter to save, Esc to cancel)"},null,544),[[g,pe.value.description]]),n("div",B,[n("button",{onClick:r[12]||(r[12]=e=>fe("description")),class:"p-1 text-green-600 hover:text-green-800 rounded",title:"Save (Ctrl+Enter)"},r[31]||(r[31]=[n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])),n("button",{onClick:me,class:"p-1 text-red-600 hover:text-red-800 rounded",title:"Cancel (Esc)"},r[32]||(r[32]=[n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])]))])):i("",!0),e.task.description||"description"===ce.value?i("",!0):(l(),o("div",P,[n("button",{onClick:r[13]||(r[13]=e=>he("description")),class:"text-xs text-gray-400 hover:text-gray-600 hover:bg-gray-100 px-1 py-0.5 rounded transition-colors"}," + Add description ")]))])],4)]),n("td",I,["due_date"!==ce.value?(l(),o("div",U,[n("span",{onDblclick:r[14]||(r[14]=e=>he("due_date")),class:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-1 py-0.5 rounded",title:"Double-click to edit"},c(De(e.task.due_date)),33)])):(l(),o("div",$,[p(n("input",{ref_key:"dueDateInput",ref:be,"onUpdate:modelValue":r[15]||(r[15]=e=>pe.value.due_date=e),onBlur:r[16]||(r[16]=e=>fe("due_date")),onKeydown:[r[17]||(r[17]=k(e=>fe("due_date"),["enter"])),k(me,["escape"]),r[18]||(r[18]=k(e=>fe("due_date"),["tab"]))],type:"date",class:"text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border border-blue-300 dark:border-gray-600 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,544),[[g,pe.value.due_date]]),n("button",{onClick:r[19]||(r[19]=e=>fe("due_date")),class:"p-1 text-green-600 hover:text-green-800 rounded",title:"Save"},r[33]||(r[33]=[n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])),n("button",{onClick:me,class:"p-1 text-red-600 hover:text-red-800 rounded",title:"Cancel"},r[34]||(r[34]=[n("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]))]),n("td",z,[n("div",A,[r[41]||(r[41]=n("button",{class:"p-1 text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-50 dark:hover:bg-gray-700 rounded transition-colors",title:"More"},[n("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.25 1.25 0 110-2.5 1.25 1.25 0 010 2.5zm0 6a1.25 1.25 0 110-2.5 1.25 1.25 0 010 2.5zm0 6a1.25 1.25 0 110-2.5 1.25 1.25 0 010 2.5z"})])],-1)),n("div",V,[r[39]||(r[39]=n("div",{class:"text-xs font-semibold text-gray-500 dark:text-gray-300 mb-2"},"Quick Edit",-1)),n("div",N,[n("div",K,[r[36]||(r[36]=n("span",{class:"text-xs text-gray-600 dark:text-gray-300"},"Status",-1)),n("select",{value:e.task.status,onChange:r[20]||(r[20]=e=>{return t=e.target.value,void ie("update-status",{task:ne.task,status:t});var t}),class:u(["text-xs border border-gray-300 dark:border-gray-600 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100",(s=e.task.status,{pending:"bg-yellow-100 text-yellow-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800"}[s]||"bg-gray-100 text-gray-800")])},r[35]||(r[35]=[n("option",{value:"pending"},"Pending",-1),n("option",{value:"in_progress"},"In Progress",-1),n("option",{value:"completed"},"Completed",-1)]),42,R)]),n("div",O,[r[38]||(r[38]=n("span",{class:"text-xs text-gray-600 dark:text-gray-300"},"Priority",-1)),n("select",{value:e.task.priority,onChange:r[21]||(r[21]=e=>{return t=e.target.value,void ie("update-priority",{task:ne.task,priority:t});var t}),class:u(["text-xs border border-gray-300 dark:border-gray-600 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100",(a=e.task.priority,{low:"bg-gray-100 text-gray-800",medium:"bg-orange-100 text-orange-800",high:"bg-red-100 text-red-800"}[a]||"bg-gray-100 text-gray-800")])},r[37]||(r[37]=[n("option",{value:"low"},"Low",-1),n("option",{value:"medium"},"Medium",-1),n("option",{value:"high"},"High",-1)]),42,Q)])]),r[40]||(r[40]=n("div",{class:"my-2 border-t border-gray-100 dark:border-gray-700"},null,-1)),n("div",q,[n("button",{onClick:r[22]||(r[22]=r=>t.$emit("add-subtask",e.task)),class:"px-2 py-1 text-xs text-green-600 hover:text-green-800 hover:bg-green-50 dark:hover:bg-green-900/30 rounded",title:"Add subtask"},"Add subtask"),n("button",{onClick:r[23]||(r[23]=r=>t.$emit("edit",e.task)),class:"px-2 py-1 text-xs text-blue-600 hover:text-blue-800 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded",title:"Edit"},"Edit"),n("button",{onClick:r[24]||(r[24]=e=>de.value=!0),class:"px-2 py-1 text-xs text-purple-600 hover:text-purple-800 hover:bg-purple-50 dark:hover:bg-purple-900/30 rounded",title:"Move"},"Move"),n("button",{onClick:r[25]||(r[25]=r=>t.$emit("delete",e.task)),class:"px-2 py-1 text-xs text-red-600 hover:text-red-800 hover:bg-red-50 dark:hover:bg-red-900/30 rounded",title:"Delete"},"Delete")])])])])],2),ce.value?(l(),o("tr",F,[n("td",H,[n("div",J,[n("span",G,"Editing "+c(ce.value.replace("_"," "))+":",1),"title"===ce.value?(l(),o("span",W,"Press Enter or Tab to save, Esc to cancel")):"description"===ce.value?(l(),o("span",X,"Press Ctrl+Enter or Tab to save, Esc to cancel")):"due_date"===ce.value?(l(),o("span",Y,"Press Enter or Tab to save, Esc to cancel")):i("",!0)])])])):i("",!0),de.value?(l(),o("tr",Z,[n("td",ee,[n("div",te,[n("div",re,[n("span",ae,'Move "'+c(e.task.title)+'" to:',1),p(n("select",{"onUpdate:modelValue":r[26]||(r[26]=e=>ue.value=e),class:"text-sm border border-blue-300 rounded px-3 py-1 bg-white focus:ring-2 focus:ring-blue-500"},[r[42]||(r[42]=n("option",{value:null},"Root Level",-1)),(l(!0),o(x,null,y(xe.value,t=>(l(),o("option",{key:t.id,value:t.id,disabled:t.id===e.task.id},c("  ".repeat(t.depth))+c(t.title),9,se))),128))],512),[[v,ue.value]])]),n("div",oe,[n("button",{onClick:ye,class:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors"}," Move "),n("button",{onClick:r[27]||(r[27]=e=>de.value=!1),class:"px-3 py-1 text-gray-600 text-sm hover:text-gray-800 transition-colors"}," Cancel ")])])])])):i("",!0)],64);var a,s}}},[["__scopeId","data-v-bb557260"]]);export{le as default};
