import{Q as e}from"./QSpace-BD6HDuXW.js";import{u as a,d as l,f as t,b as o,h as s,Q as r,H as n,t as i,G as d,e as u,s as c,o as m,aS as f}from"./app-BxJhpxku.js";import{Q as p}from"./QTd-CdMOzIxb.js";import{Q as v}from"./QTable-bfrPmXFn.js";import{d as g}from"./date-DbdfPnt6.js";import{a as y,f as _,o as w,N as b,J as h,b as C,K as x,R as V,y as k,W as D,V as j,I as L,O as Q,F as S,_ as T}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./QMarkupTable-FlbqetwF.js";import"./QSelect-DvJQhHwY.js";import"./rtl-Cr6c3OOr.js";import"./QLinearProgress-C8hggxm2.js";import"./use-fullscreen-Dx2-rb4h.js";const U={class:"row q-gutter-md q-mb-md"},A={class:"col-12 col-md-4"},M={class:"col-auto"},P={class:"text-weight-bold"},q={class:"text-caption text-grey"},F={class:"text-caption text-grey"},Y={class:"q-ml-sm text-h6"},B={class:"text-grey-7"},H={class:"q-ml-sm text-h6"},O={__name:"DraftManagementPanel",props:{modelValue:Boolean},emits:["update:modelValue","compare","load"],setup(O,{emit:R}){const I=O,K=R,N=a(),W=y({get:()=>I.modelValue,set:e=>K("update:modelValue",e)}),z=_([]),G=_(!1),J=_(""),$=_(!1),E=_(!1),X=_(null),Z=[{name:"name",label:"Draft Name",align:"left",field:"name",sortable:!0},{name:"created",label:"Created",align:"left",field:"timestamp",sortable:!0},{name:"stats",label:"Assignments",align:"center",field:e=>e.total_assignments,sortable:!0},{name:"actions",label:"Actions",align:"right"}],ee=y(()=>{if(!J.value)return z.value;const e=J.value.toLowerCase();return z.value.filter(a=>a.name.toLowerCase().includes(e)||a.description&&a.description.toLowerCase().includes(e)||a.created_by_name&&a.created_by_name.toLowerCase().includes(e))});async function ae(){G.value=!0;try{const e=await T.get(route("weekly-system.api.drafts.index"));e.data.success&&(z.value=e.data.drafts.sort((e,a)=>new Date(a.timestamp)-new Date(e.timestamp)))}catch(e){console.error("Failed to load drafts",e),N.notify({type:"negative",message:"Failed to load drafts list"})}finally{G.value=!1}}function le(){X.value&&(K("load",X.value),$.value=!1)}async function te(){if(X.value)try{(await T.post(route("weekly-system.api.drafts.delete"),{name:X.value.name})).data.success&&(N.notify({type:"positive",message:"Draft deleted"}),ae())}catch(e){console.error("Failed to delete draft",e),N.notify({type:"negative",message:"Failed to delete draft"})}finally{E.value=!1,X.value=null}}return w(()=>{ae()}),(a,y)=>(h(),b(S,null,[C(u,{modelValue:W.value,"onUpdate:modelValue":y[1]||(y[1]=e=>W.value=e),"full-width":""},{default:x(()=>[C(l,{class:"column",style:{"min-height":"500px","max-height":"80vh"}},{default:x(()=>[C(t,{class:"bg-primary text-white row items-center"},{default:x(()=>[y[4]||(y[4]=V("div",{class:"text-h6"},"Draft Management",-1)),C(e),k(C(o,{icon:"close",flat:"",round:"",dense:""},null,512),[[f]])]),_:1}),C(t,{class:"q-pa-md col scroll"},{default:x(()=>[V("div",U,[V("div",A,[C(s,{dense:"",outlined:"",modelValue:J.value,"onUpdate:modelValue":y[0]||(y[0]=e=>J.value=e),label:"Search drafts",class:"bg-white"},{append:x(()=>[C(r,{name:"search"})]),_:1},8,["modelValue"])]),C(e),V("div",M,[C(o,{color:"primary",label:"Refresh List",icon:"refresh",flat:"",onClick:ae,loading:G.value},null,8,["loading"])])]),C(v,{rows:ee.value,columns:Z,"row-key":"name",loading:G.value,flat:"",bordered:"",pagination:{rowsPerPage:10}},{"body-cell-name":x(e=>[C(p,{props:e},{default:x(()=>[V("div",P,j(e.value),1),V("div",q,j(e.row.description),1),e.row.is_backup?(h(),L(d,{key:0,size:"xs",color:"grey-3","text-color":"grey-8",icon:"restore"},{default:x(()=>y[5]||(y[5]=[D("Auto-Backup")])),_:1})):Q("",!0)]),_:2},1032,["props"])]),"body-cell-created":x(e=>[C(p,{props:e},{default:x(()=>{return[V("div",null,j((a=e.row.timestamp,a?g.formatDate(a,"MMM D, YYYY HH:mm"):"-")),1),V("div",F,"by "+j(e.row.created_by_name||"System"),1)];var a}),_:2},1032,["props"])]),"body-cell-actions":x(e=>[C(p,{props:e,class:"text-right"},{default:x(()=>[C(n,{flat:""},{default:x(()=>[C(o,{flat:"",dense:"",color:"primary",icon:"compare_arrows",onClick:l=>a.$emit("compare",e.row)},{default:x(()=>[C(i,null,{default:x(()=>y[6]||(y[6]=[D("Compare with Live")])),_:1})]),_:2},1032,["onClick"]),C(o,{flat:"",dense:"",color:"secondary",icon:"restore",onClick:a=>{return l=e.row,X.value=l,void($.value=!0);var l}},{default:x(()=>[C(i,null,{default:x(()=>y[7]||(y[7]=[D("Load/Restore")])),_:1})]),_:2},1032,["onClick"]),C(o,{flat:"",dense:"",color:"negative",icon:"delete",onClick:a=>{return l=e.row,X.value=l,void(E.value=!0);var l}},{default:x(()=>[C(i,null,{default:x(()=>y[8]||(y[8]=[D("Delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),C(u,{modelValue:$.value,"onUpdate:modelValue":y[2]||(y[2]=e=>$.value=e)},{default:x(()=>[C(l,null,{default:x(()=>[C(t,{class:"row items-center"},{default:x(()=>{var e;return[C(c,{icon:"warning",color:"warning","text-color":"white"}),V("span",Y,"Load Draft: "+j(null==(e=X.value)?void 0:e.name),1)]}),_:1}),C(t,null,{default:x(()=>[y[10]||(y[10]=V("p",null,"This action will replace the current live schedule with this draft.",-1)),V("p",B,[y[9]||(y[9]=D("Current schedule will be automatically backed up as ")),V("strong",null,"AUTO_BACKUP_"+j((new Date).toISOString().slice(0,10))+"...",1)])]),_:1}),C(m,{align:"right"},{default:x(()=>[k(C(o,{flat:"",label:"Cancel",color:"primary"},null,512),[[f]]),C(o,{flat:"",label:"Proceed & Load",color:"negative",onClick:le})]),_:1})]),_:1})]),_:1},8,["modelValue"]),C(u,{modelValue:E.value,"onUpdate:modelValue":y[3]||(y[3]=e=>E.value=e)},{default:x(()=>[C(l,null,{default:x(()=>[C(t,{class:"row items-center"},{default:x(()=>{var e;return[C(c,{icon:"delete",color:"negative","text-color":"white"}),V("span",H,"Delete Draft: "+j(null==(e=X.value)?void 0:e.name),1)]}),_:1}),C(t,null,{default:x(()=>y[11]||(y[11]=[D(" Are you sure you want to delete this draft? This action cannot be undone. ")])),_:1}),C(m,{align:"right"},{default:x(()=>[k(C(o,{flat:"",label:"Cancel",color:"primary"},null,512),[[f]]),C(o,{flat:"",label:"Delete",color:"negative",onClick:te})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{O as default};
