import{Q as e}from"./QSpace-D-IrDQfo.js";import{r as a,u as l,f as t,aS as s,b as n,h as u,Q as i,i as o,j as r,k as d,l as m,p,o as v,d as c,e as f}from"./app-Dtv5Fi9L.js";import{Q as _}from"./QFile-BHtDPtDY.js";import{Q as w}from"./QSelect-BslHFD89.js";import{Q as h}from"./QForm-Cyf9p9ZM.js";import{f as b,a as g,k as x,I as V,J as y,K as j,b as k,R as A,y as q,V as Q,a0 as U,N as B,O as F,F as S,Q as M,W as C}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./use-file-ByEwQH_I.js";import"./rtl-Cr6c3OOr.js";const E={class:"text-h6"},I={class:"q-gutter-md"},N={class:"q-gutter-sm"},R={key:0,class:"q-mt-sm"},z=a({__name:"AnswerForm",props:{modelValue:{type:Boolean,default:!1},answer:{type:Object,default:null},questionId:{type:Number,required:!0}},emits:["update:modelValue","save"],setup(a,{expose:z,emit:O}){const P=a,$=O,G=l(),J=b(P.modelValue),K=b(!1),L=b({}),T=b(null),D=b({answer_text:"",media_links:[],attachments:[],status:"draft",notes:"",is_public:!1}),W=g({get:()=>D.value.media_links.join(", "),set:e=>{D.value.media_links=e?e.split(",").map(e=>e.trim()).filter(Boolean):[]}}),H=g(()=>[{label:"Draft",value:"draft"},{label:"Published",value:"published"},{label:"Under Review",value:"review"},{label:"Archived",value:"archived"}]),X=g(()=>!!P.answer),Y=g(()=>D.value.answer_text),Z=e=>{e?D.value={answer_text:e.answer_text||"",media_links:Array.isArray(e.media_links)?e.media_links:[],attachments:Array.isArray(e.attachments)?e.attachments:[],status:e.status||"draft",notes:e.notes||"",is_public:e.is_public||!1}:(D.value={answer_text:"",media_links:[],attachments:[],status:"draft",notes:"",is_public:!1},L.value={},T.value=null)},ee=()=>{if(!Y.value)return void G.notify({type:"negative",message:"Please provide an answer text",position:"top"});K.value=!0,L.value={};const e={...D.value,question_id:P.questionId};X.value&&(e.id=P.answer.id),T.value&&T.value.length>0&&(e.new_files=T.value),$("save",e)},ae=e=>{e.forEach(e=>{G.notify({type:"negative",message:`File "${e.file.name}" was rejected: ${e.failedPropValidation}`,position:"top"})})},le=e=>{if(0===e)return"0 Bytes";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["Bytes","KB","MB","GB"][a]};return x(()=>P.modelValue,e=>{J.value=e,e&&Z(P.answer)}),x(()=>P.answer,e=>{J.value&&Z(e)}),z({handleSaveComplete:()=>{K.value=!1,J.value=!1,T.value=null},handleSaveError:e=>{var a,l;K.value=!1,(null==(l=null==(a=e.response)?void 0:a.data)?void 0:l.errors)&&(L.value=e.response.data.errors)}}),(a,l)=>(y(),V(f,{modelValue:J.value,"onUpdate:modelValue":[l[6]||(l[6]=e=>J.value=e),l[7]||(l[7]=e=>a.$emit("update:modelValue",e))],persistent:""},{default:j(()=>[k(c,{style:{"min-width":"500px","max-width":"700px",width:"100%"}},{default:j(()=>[k(t,{class:"row items-center q-pb-none"},{default:j(()=>[A("div",E,Q(X.value?"Edit Answer":"Add New Answer"),1),k(e),q(k(n,{icon:"close",flat:"",round:"",dense:""},null,512),[[s]])]),_:1}),k(h,{onSubmit:U(ee,["prevent"]),class:"q-gutter-md"},{default:j(()=>[k(t,{class:"q-pt-none"},{default:j(()=>[A("div",I,[k(u,{modelValue:D.value.answer_text,"onUpdate:modelValue":l[0]||(l[0]=e=>D.value.answer_text=e),label:"Answer Text *",outlined:"",dense:"",type:"textarea",rows:"5",rules:[e=>!!e||"Answer text is required"],error:!!L.value.answer_text,"error-message":L.value.answer_text,hint:"The main answer content"},null,8,["modelValue","rules","error","error-message"]),k(u,{modelValue:W.value,"onUpdate:modelValue":l[1]||(l[1]=e=>W.value=e),label:"Media Links",outlined:"",dense:"",type:"textarea",rows:"3",hint:"Enter media URLs separated by commas (optional)",error:!!L.value.media_links,"error-message":L.value.media_links},null,8,["modelValue","error","error-message"]),A("div",N,[l[9]||(l[9]=A("div",{class:"text-subtitle2"},"Attachments",-1)),k(_,{modelValue:T.value,"onUpdate:modelValue":l[2]||(l[2]=e=>T.value=e),label:"Upload Files",outlined:"",dense:"",multiple:"",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.mp4,.mp3","max-files":"5","max-file-size":"10485760",onRejected:ae},{prepend:j(()=>[k(i,{name:"attach_file"})]),_:1},8,["modelValue"]),D.value.attachments&&D.value.attachments.length>0?(y(),B("div",R,[l[8]||(l[8]=A("div",{class:"text-caption text-grey-7"},"Current attachments:",-1)),k(o,{dense:""},{default:j(()=>[(y(!0),B(S,null,M(D.value.attachments,(e,a)=>(y(),V(r,{key:a,dense:""},{default:j(()=>[k(d,{avatar:""},{default:j(()=>{return[k(i,{name:(a=e.type,(null==a?void 0:a.includes("image"))?"image":(null==a?void 0:a.includes("video"))?"videocam":(null==a?void 0:a.includes("audio"))?"audiotrack":(null==a?void 0:a.includes("pdf"))?"picture_as_pdf":(null==a?void 0:a.includes("word"))||(null==a?void 0:a.includes("document"))?"description":"insert_drive_file")},null,8,["name"])];var a}),_:2},1024),k(d,null,{default:j(()=>[k(m,null,{default:j(()=>[C(Q(e.name),1)]),_:2},1024),k(m,{caption:""},{default:j(()=>[C(Q(le(e.size)),1)]),_:2},1024)]),_:2},1024),k(d,{side:""},{default:j(()=>[k(n,{icon:"delete",flat:"",round:"",dense:"",size:"sm",color:"negative",onClick:e=>(e=>{D.value.attachments.splice(e,1)})(a)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):F("",!0)]),k(w,{modelValue:D.value.status,"onUpdate:modelValue":l[3]||(l[3]=e=>D.value.status=e),options:H.value,label:"Status",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options"]),k(u,{modelValue:D.value.notes,"onUpdate:modelValue":l[4]||(l[4]=e=>D.value.notes=e),label:"Notes",outlined:"",dense:"",type:"textarea",rows:"2",hint:"Optional notes or comments about this answer"},null,8,["modelValue"]),k(p,{modelValue:D.value.is_public,"onUpdate:modelValue":l[5]||(l[5]=e=>D.value.is_public=e),label:"Make this answer public",color:"primary"},null,8,["modelValue"])])]),_:1}),k(v,{align:"right",class:"q-pa-md"},{default:j(()=>[q(k(n,{flat:"",label:"Cancel",color:"grey-7",disable:K.value},null,8,["disable"]),[[s]]),k(n,{type:"submit",label:"Save",color:"primary",loading:K.value,disable:!Y.value},null,8,["loading","disable"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},[["__scopeId","data-v-aa31e36a"]]);export{z as default};
