import{o as e}from"./app-BB4Fw2oM.js";import{f as t,a as n,o,A as l,M as a,J as s,N as i,W as u,y as r,ac as c,a0 as v}from"./vendor-DuKqz2x4.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";const p={class:"pad"},d={class:"toolbar"},f=["disabled"],h=["disabled"],m=["disabled"],g=["disabled"],x={class:"canvas-wrapper"},y=800,b=500,w=e({__name:"FingerDrawingDemo copy",emits:["export-json"],setup(e,{emit:w}){const C=t(null);let T=null;const k=t([]),j=t([]);let _=null,R=!1;const A=t(!1),M=t("#111111"),z=t(3);let F=null,I=null;const L=w;function S(){T.clearRect(0,0,y,b),F?T.drawImage(F,0,0,y,b):I&&(T.font="16px sans-serif",T.fillStyle="#888",T.fillText(I,20,40));for(const e of k.value)q(e);_&&q(_)}function U(e){const t=C.value.getBoundingClientRect();return e.touches&&e.touches[0]?{x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}:{x:e.clientX-t.left,y:e.clientY-t.top}}function q(e){const t=e.points;if(!(t.length<2)){T.strokeStyle=e.color,T.lineWidth=e.size,T.beginPath(),T.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length-1;e++){const n=(t[e].x+t[e+1].x)/2,o=(t[e].y+t[e+1].y)/2;T.quadraticCurveTo(t[e].x,t[e].y,n,o)}T.lineTo(t[t.length-1].x,t[t.length-1].y),T.stroke()}}function D(e){R=!0;const t=U(e);_={points:[{x:t.x,y:t.y,t:0}],color:M.value,size:z.value,_startTime:performance.now()}}function E(e){if(!R||!_)return;const t=U(e),n=performance.now()-_._startTime;_.points.push({x:t.x,y:t.y,t:n}),S()}function J(){R&&(R=!1,_&&(delete _._startTime,k.value.push(_),j.value=[]),_=null,S())}function P(){k.value.length>0&&(j.value.push(k.value.pop()),S())}function W(){j.value.length>0&&(k.value.push(j.value.pop()),S())}function N(){k.value=[],j.value=[],S()}const O=n(()=>k.value.length>0),X=n(()=>j.value.length>0);function Y(){if(A.value||0===k.value.length)return;A.value=!0;let e=0,t=performance.now();requestAnimationFrame(function n(o){S();for(let t=0;t<e;t++)q(k.value[t]);if(e>=k.value.length)return void(A.value=!1);const l=k.value[e],a=o-t,s=l.points,i=s[s.length-1].t,u=s.findIndex(e=>e.t>a),r=-1===u?s.length:u;q({...l,points:s.slice(0,r)}),a>=i&&(e++,t=o),requestAnimationFrame(n)})}function B(e){const t=e.clipboardData.items;for(const n of t){if(n.type.startsWith("image/")){const e=n.getAsFile(),t=new Image;return t.onload=()=>{F=t,I=null,S()},void(t.src=URL.createObjectURL(e))}if("text/plain"===n.type)return void n.getAsString(e=>{I=e,F=null,S()})}}function V(){const e={version:1,width:y,height:b,strokes:k.value.map(e=>({points:e.points,color:e.color,size:e.size}))};L("export-json",e)}return o(()=>{!function(){const e=C.value,t=window.devicePixelRatio||1;e.width=y*t,e.height=b*t,e.style.width=y+"px",e.style.height=b+"px",T=e.getContext("2d"),T.scale(t,t),T.lineCap="round",T.lineJoin="round",S()}(),window.addEventListener("paste",B)}),l(()=>{window.removeEventListener("paste",B)}),(e,t)=>(s(),a("div",p,[i("div",d,[i("label",null,[t[1]||(t[1]=u(" Pen Color: ")),r(i("input",{type:"color","onUpdate:modelValue":t[0]||(t[0]=e=>M.value=e)},null,512),[[c,M.value]])]),i("button",{onClick:P,disabled:!O.value},"Undo",8,f),i("button",{onClick:W,disabled:!X.value},"Redo",8,h),i("button",{onClick:N},"Clear"),i("button",{onClick:Y,disabled:A.value||0===k.value.length},"Replay",8,m),i("button",{onClick:V,disabled:0===k.value.length},"Export JSON",8,g)]),i("div",x,[i("canvas",{ref_key:"canvas",ref:C,class:"canvas",onMousedown:D,onMousemove:E,onMouseup:J,onMouseleave:J,onTouchstart:v(D,["prevent"]),onTouchmove:v(E,["prevent"]),onTouchend:v(J,["prevent"])},null,544)])]))}},[["__scopeId","data-v-352d3a0b"]]);export{w as default};
