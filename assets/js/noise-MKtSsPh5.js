import{o as e}from"./app-B9g134Ig.js";import{f as a,a as l,e as t,N as s,J as n,O as o,b as r,U as i,W as u,V as c,K as v,Q as d,B as m,S as f,y as h,ac as g}from"./vendor-nQjeLEvd.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";const p={class:"meter-container"},b={class:"circular-meter"},y={viewBox:"0 0 200 200"},k=["stroke","stroke-dashoffset"],w={key:0,class:"warning-banner"},x={class:"bar-meter"},M={class:"info"},A={key:0},B={key:1,class:"listening-text"},C={class:"db-value"},S={class:"threshold-control"},j={class:"threshold-value"},_=e({__name:"noise",setup(e){const _=a(!1),q=a(-100),U=a(80);let D=null,F=null,L=null,T=null;const I=2*Math.PI*90,V=l(()=>Math.max(20,Math.round(q.value+70))),W=l(()=>_.value&&V.value>U.value),z=l(()=>W.value?"#ff3b30":q.value>-25?"#ff9500":q.value>-40?"#ffcc00":"#34c759"),J=l(()=>W.value?"#ff3b30":z.value),K=l(()=>{const e=Math.min(1,V.value/110);return I*(1-e)}),N=l(()=>Math.min(100,V.value/110*100)),O=l(()=>U.value/110*100),P=()=>{_.value=!1,T&&cancelAnimationFrame(T),L&&L.disconnect(),D&&D.close()},Q=()=>{_.value?P():(async()=>{try{D=new(window.AudioContext||window.webkitAudioContext),F=D.createAnalyser(),F.fftSize=512,F.smoothingTimeConstant=.9;const e=await navigator.mediaDevices.getUserMedia({audio:!0});L=D.createMediaStreamSource(e),L.connect(F),_.value=!0,E()}catch(e){alert("Microphone access required!"),console.error(e)}})()},E=()=>{if(!F)return;const e=F.frequencyBinCount,a=new Uint8Array(e);F.getByteTimeDomainData(a);let l=0;for(let s=0;s<e;s++){const e=(a[s]-128)/128;l+=e*e}const t=Math.sqrt(l/e);q.value=t>0?20*Math.log10(t):-100,_.value&&(T=requestAnimationFrame(E))};return t(()=>P()),(e,a)=>(n(),s("div",{class:i(["noise-meter",{listening:_.value,warning:W.value}])},[o("div",p,[o("div",b,[(n(),s("svg",y,[a[1]||(a[1]=o("circle",{class:"meter-bg",cx:"100",cy:"100",r:"90","stroke-width":"20",fill:"none"},null,-1)),o("circle",{class:"meter-fill",cx:"100",cy:"100",r:"90","stroke-width":"20",fill:"none",stroke:z.value,"stroke-dasharray":I,"stroke-dashoffset":K.value,transform:"rotate(-90 100 100)"},null,8,k)])),o("div",{class:i(["level-text",{warning:W.value}])},[u(c(Math.round(V.value))+" ",1),a[2]||(a[2]=o("small",null,"dBA",-1))],2)]),r(m,{name:"fade"},{default:v(()=>[W.value?(n(),s("div",w,a[3]||(a[3]=[o("p",null,"Too Loud!",-1)]))):d("",!0)]),_:1}),o("div",x,[o("div",{class:"bar",style:f({height:N.value+"%",backgroundColor:J.value})},null,4),o("div",{class:"threshold-line",style:f({bottom:O.value+"%"})},null,4)]),o("div",M,[_.value?(n(),s("p",B,"Listening...")):(n(),s("p",A,'Click "Start" to begin listening')),o("p",C,c(V.value.toFixed(0))+" dBA",1)]),o("div",S,[a[4]||(a[4]=o("label",{for:"threshold"},"Warning threshold:",-1)),h(o("input",{type:"range",id:"threshold",min:"50",max:"100","onUpdate:modelValue":a[0]||(a[0]=e=>U.value=e),class:"slider"},null,512),[[g,U.value,void 0,{number:!0}]]),o("span",j,c(U.value)+" dBA",1)])]),o("button",{onClick:Q,class:"control-btn"},c(_.value?"Stop":"Start")+" Listening ",1)],2))}},[["__scopeId","data-v-7d29112c"]]);export{_ as default};
