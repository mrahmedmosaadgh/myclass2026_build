import{r as e,u as a,Q as l,G as t,j as o,k as s,l as i,aR as n,i as u,c as r,b as d,t as c,m,e as v,d as p,f,h as y,o as _,be as g,aI as h,aS as b}from"./app-DlLesFGi.js";import{Q as w}from"./QSelect-BTh0khse.js";import{Q as k}from"./QBadge-IdEcTs8C.js";import{Q as x}from"./QMarkupTable-CzIo4GGA.js";import{Q as j}from"./QSpinnerDots-B_GSDqC3.js";import{Q as V}from"./QSpace-BK_PGLKv.js";import{u as S}from"./i18n-B0T1C7j3.js";import{f as C,a as U,k as q,o as T,af as P,N as E,J as A,b as D,R as F,z as Q,I as L,W as z,V as O,K as I,ag as G,ah as M,y as $,O as R,F as W,Q as N,_ as B}from"./vendor-BWKGNkNB.js";import J from"./TimetableGrid-BZzP2f7A.js";import H from"./CSTAssignDialog-CTS-1LTE.js";import K from"./WeeklyPlanMenu-BcGTVUpe.js";import X from"./AIImportDialog-BfHUN_Nd.js";import Y from"./RandomFillDialog-C3vbTVLe.js";import Z from"./CSTOverviewDialog-PWCTT1ZA.js";import ee from"./DraftManagementPanel-QWGzr1Sy.js";import ae from"./DraftComparisonDialog-CxT2wLa7.js";import"./offline-BzIlwqNM.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";import"./TimetableCell-eXwVKfLu.js";import"./QForm-CDvMxBSt.js";import"./QTab-CYxYFXBq.js";import"./QTabs-BClcf-CB.js";import"./WeeklySystemGuide-Bj_R2PyQ.js";import"./QTabPanel-DXa1fEFB.js";import"./use-panel-BqxRbB7W.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-CTgZWG49.js";import"./MainSchoolData-ClhKhkN6.js";import"./schoolData-CWFtmgnE.js";import"./SchoolSettingsDialog-CLF5QRZg.js";import"./QStepper-DsaP_4Mi.js";import"./QTd-BU_S4ffH.js";import"./QTable-BIAJAIui.js";import"./QLinearProgress-CX6G9yBK.js";import"./use-fullscreen-BQHoXYBI.js";import"./QSpinnerGears-D6n0tTlP.js";import"./QInnerLoading-Dg1MHCDl.js";import"./date-Bovy_vJ3.js";import"./CSTSyncDialog-C-vurwm7.js";const le={class:"q-pa-md"},te={class:"row items-center q-mb-lg justify-between"},oe={class:"col-auto"},se={class:"q-ma-none text-weight-bold"},ie={class:"text-grey-7 q-mb-none"},ne={class:"col-auto row q-gutter-sm items-center"},ue={class:"row q-gutter-md items-end"},re={class:"col-12 col-sm-6 col-md-4"},de={class:"col-12 col-sm-auto"},ce={class:"col-12 col-sm-auto"},me={class:"col-12 col-sm-auto"},ve={class:"col-12 col-sm-auto"},pe={class:"row q-gutter-md items-center"},fe={class:"col-12 col-md-auto"},ye={key:0},_e={key:1},ge={class:"col-12 col-md-auto"},he={key:0},be={key:1},we={class:"col-12 col-md-3"},ke={class:"col-12 col-md-3"},xe={class:"col-auto"},je={class:"col-12"},Ve={key:0,class:"q-mb-sm"},Se={class:"text-caption text-grey-7 q-mb-xs"},Ce={class:"row q-gutter-sm"},Ue={key:1},qe={class:"text-caption text-grey-7 q-mb-xs"},Te={class:"row q-gutter-sm"},Pe={class:"text-left"},Ee={class:"text-left"},Ae={class:"text-center"},De={class:"text-center"},Fe={class:"text-center"},Qe={key:0,class:"row justify-center q-pa-xl"},Le={class:"text-h6 text-grey-7 q-mt-md"},ze={class:"text-grey-6"},Oe={class:"text-h6"},Ie={key:0,class:"text-center q-pa-md"},Ge={key:1,class:"text-center text-grey-7 q-pa-md"},Me=e({__name:"TimetableEditor",setup(e){const{t:Me}=S(),$e=a(),Re=C([]),We=C([]),Ne=C([]),Be=C([]),Je=C([]),He=C({}),Ke=C(null),Xe=C([1,2,3,4,5]),Ye=C([1,2,3,4,5,6,7,8]),Ze=C([]),ea=C([]),aa=[{label:"Sunday",value:1},{label:"Monday",value:2},{label:"Tuesday",value:3},{label:"Wednesday",value:4},{label:"Thursday",value:5},{label:"Friday",value:6},{label:"Saturday",value:7}],la=Array.from({length:12},(e,a)=>({label:`Period ${a+1}`,value:a+1})),ta=U(()=>{const e=Re.value.find(e=>e.id===Ke.value);return(null==e?void 0:e.name)||""}),oa=C(!1),sa=C(null),ia=C(null),na=C(null),ua=C(null),ra=C(!1),da=C(!1),ca=C(!1),ma=C(!1),va=C(!1),pa=C(!1),fa=C(!1),ya=C(!1),_a=C(!1),ga=C(!1),ha=C(!1),ba=C(""),wa=C(""),ka=C(!1),xa=C(null),ja=C(""),Va=C(!1),Sa=C(!1),Ca=C(!1);C(!1);const Ua=async()=>{var e;if(ba.value)try{await B.post("/weekly-system/api/drafts/save",{name:ba.value,description:wa.value,overwrite:ka.value,schedules:We.value}),$e.notify({type:"positive",message:"Draft saved successfully"}),ga.value=!1,ba.value="",wa.value="",ka.value=!1}catch(a){409===(null==(e=a.response)?void 0:e.status)?$e.notify({type:"warning",message:'Draft name exists. Check "Overwrite" to replace it.',timeout:5e3}):(console.error("Error saving draft:",a),$e.notify({type:"negative",message:"Failed to save draft"}))}},qa=async e=>{ha.value=!0,ja.value=e.name,Va.value=!0,xa.value=null;try{const a=await B.post("/weekly-system/api/drafts/compare",{name:e.name});xa.value=a.data.comparison}catch(a){console.error("Error comparing drafts:",a),$e.notify({type:"negative",message:"Failed to compare schedules"}),ha.value=!1}finally{Va.value=!1}},Ta=async()=>{Sa.value=!0;try{await B.post("/weekly-system/api/drafts/load",{name:ja.value,create_backup:!0}),$e.notify({type:"positive",message:"Draft published successfully! Auto-backup created."}),ha.value=!1,_a.value=!1,await $a()}catch(e){console.error("Error publishing draft:",e),$e.notify({type:"negative",message:"Failed to publish draft"})}finally{Sa.value=!1}},Pa=async e=>{Sa.value=!0;try{await B.post("/weekly-system/api/drafts/load",{name:e.name,create_backup:!0}),$e.notify({type:"positive",message:"Draft loaded successfully! Auto-backup created."}),_a.value=!1,await $a()}catch(a){console.error("Error loading draft:",a),$e.notify({type:"negative",message:"Failed to load draft"})}finally{Sa.value=!1}},Ea=C(null),Aa=C(null),Da=C(null),Fa=C(!1),Qa=C(!1),La=C([]),za=C("overall"),Oa=C(!1),Ia=C(!1),Ga=()=>{Xe.value=[1,2,3,4,5],Ye.value=[1,2,3,4,5,6,7,8],Ze.value=[],ea.value=[]},Ma=async()=>{ca.value=!0;try{const e=new URLSearchParams(window.location.search),a=e.get("school"),l=e.get("teacher_id");if(l){const e=parseInt(l);isNaN(e)||(ea.value=[e])}const t={};a&&(t.school_id=a);const o=await B.get("/api/classrooms",{params:t}),s=o.data.data||o.data||[];Re.value=Array.isArray(s)?s:[];const i=e.get("classroom_id");let n=!1;if(i){const e=parseInt(i);Re.value.find(a=>a.id===e)&&(Ke.value=e,n=!0)}!Re.value.length||Ke.value||n||(Ke.value=Re.value[0].id)}catch(e){console.error("Error fetching classrooms:",e),$e.notify({type:"negative",message:"Failed to load classrooms"})}finally{ca.value=!1}},$a=async()=>{if(Ke.value){ma.value=!0;try{const e=await B.get("/admin/schedules",{params:{classroom_id:Ke.value}}),a=e.data.data||e.data||[];We.value=Array.isArray(a)?a:[],e.data.classroom_stats&&(Aa.value=e.data.classroom_stats),e.data.overall_stats&&(Da.value=e.data.overall_stats),e.data.stats&&(Ea.value=e.data.stats),Aa.value||Da.value||Ja(),await Ra()}catch(e){console.error("Error fetching schedules:",e),$e.notify({type:"negative",message:"Failed to load schedules"})}finally{ma.value=!1}}},Ra=async()=>{var e;try{const a=await B.get("/weekly-system/api/teacher-conflicts");He.value=(null==(e=a.data.data)?void 0:e.conflicts)||{}}catch(a){console.error("Error fetching teacher conflicts:",a),He.value={}}},Wa=async()=>{if(Ke.value){va.value=!0;try{const e=await B.get("/api/classroom-subject-teachers",{params:{classroom_id:Ke.value}});Ne.value=(e.data.data||e.data||[]).map(e=>({...e,display_label:`${e.subject_name} - ${e.teacher_name}`}))}catch(e){console.error("Error fetching CST options:",e)}finally{va.value=!1}}},Na=async()=>{pa.value=!0;try{const e=await B.get("/api/teachers");Be.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching teachers:",e)}finally{pa.value=!1}},Ba=async()=>{fa.value=!0;try{const e=await B.get("/api/subjects");Je.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching subjects:",e)}finally{fa.value=!1}},Ja=()=>{if(!Array.isArray(We.value)||0===We.value.length)return void(Ea.value={total_slots:0,assigned_slots:0,unassigned_slots:0,conflict_count:0});const e=We.value.filter(e=>e&&e.cst_id&&null!=e.day_number&&null!=e.period_number).length,a=We.value.length,l=Object.keys(He.value||{}).length;Ea.value={total_slots:a,assigned_slots:e,unassigned_slots:a-e,conflict_count:l}},Ha=async()=>{},Ka=async({day:e,period:a,schedule:l})=>{if(ia.value=e,na.value=a,sa.value=l,Ke.value){ra.value=!0,ua.value=null;try{const l=await B.get("/weekly-system/api/slot-availability",{params:{classroom_id:Ke.value,day:e,period:a}});ua.value=l.data.data}catch(t){console.error("Error fetching slot availability:",t),ua.value=null}finally{ra.value=!1}}oa.value=!0},Xa=e=>{sa.value=e,ia.value=e.day,na.value=e.period_number,oa.value=!0},Ya=async e=>{try{const a=e.id;if(!a||a.toString().startsWith("temp_"))return void(await $a());await B.put(`/admin/schedules/${a}`,{cst_id:null,day:e.day_number||e.day,period_number:e.period_number}),$e.notify({type:"positive",message:"Slot cleared successfully"}),await $a()}catch(a){console.error("Error clearing schedule:",a),$e.notify({type:"negative",message:"Failed to clear slot"})}},Za=async e=>{var a,l;ya.value=!0;try{const a=e.day,l=e.period,t=We.value.find(e=>(e.day_number||e.day)==a&&e.period_number==l),o={cst_id:e.cst_id,day:a,period_number:l,teacher_substitute_id:e.teacher_substitute_id,co_teacher_id:e.co_teacher_id,co_subject_id:e.co_subject_id,notes:e.notes,school_id:new URLSearchParams(window.location.search).get("school")};t&&t.id&&!t.id.toString().startsWith("temp_")?await B.put(`/admin/schedules/${t.id}`,o):await B.post("/admin/schedules/store",o),$e.notify({type:"positive",message:"Schedule updated successfully"}),oa.value=!1,await $a()}catch(t){console.error("Error saving schedule:",t);const e=(null==(l=null==(a=t.response)?void 0:a.data)?void 0:l.message)||"Failed to update schedule";$e.notify({type:"negative",message:e})}finally{ya.value=!1}},el=e=>{},al=async e=>{za.value=e,Fa.value=!0,Qa.value=!0,La.value=[];try{const a={};"classroom"===e&&Ke.value&&(a.classroom_id=Ke.value);const l=await B.get("/weekly-system/api/teacher-conflicts",{params:a});if(l.data.success&&l.data.data){const e=l.data.data.conflicts||[],a=(Array.isArray(e)?e:Object.values(e)).filter(e=>!e.schedule_id);La.value=a.map(e=>({teacher_name:e.teacher_name,day_name:ll(e.day),period_number:e.period,classrooms:e.classrooms.map(e=>e.classroom_name)}))}}catch(a){console.error("Error fetching conflict details:",a),$e.notify({type:"negative",message:"Failed to load conflict details"})}finally{Qa.value=!1}},ll=e=>["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e-1]||`Day ${e}`,tl=async()=>{We.value=[],await $a(),$e.notify({type:"positive",message:"AI import completed successfully! Timetable refreshed.",position:"top"})},ol=async()=>{We.value=[],await $a(),$e.notify({type:"positive",message:"Random fill completed successfully! Timetable refreshed.",position:"top"})};q(Ke,async e=>{e&&await Promise.all([$a(),Wa()])}),T(async()=>{await Promise.all([Ma(),Na(),Ba()])});const sl=C(!1),il=async()=>{if(Ke.value){sl.value=!0;try{await B.post("/admin/schedules/auto-fill-orders",{classroom_id:Ke.value}),$e.notify({type:"positive",message:"Period orders updated successfully",position:"top"}),await $a()}catch(e){console.error("Error auto-filling orders:",e),$e.notify({type:"negative",message:"Failed to update Period orders"})}finally{sl.value=!1}}},nl=C(!1),ul=C(null),rl=()=>{if(!Ke.value)return;const e=Re.value.find(e=>e.id===Ke.value),a=((null==e?void 0:e.name)||"classroom").toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),l=route("schedules.classroom.view",{classroom_id:Ke.value,classroom_name:a});window.open(l,"_blank")},dl=()=>{if(!ul.value)return;const e="object"==typeof ul.value?ul.value:Be.value.find(e=>e.id===ul.value);if(!e)return;const a=(e.name||"teacher").toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),l=route("schedules.teacher.view",{teacher_id:e.id,teacher_name:a});window.open(l,"_blank"),nl.value=!1,ul.value=null},cl=()=>{if(!ul.value)return;const e="object"==typeof ul.value?ul.value:Be.value.find(e=>e.id===ul.value);if(!e)return;const a=(e.name||"teacher").toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),l=route("schedules.teacher.view",{teacher_id:e.id,teacher_name:a});navigator.clipboard.writeText(l).then(()=>{$e.notify({type:"positive",message:"Teacher schedule link copied!",position:"top",timeout:2e3}),nl.value=!1,ul.value=null})},ml=()=>{if(!Ke.value)return;const e=Re.value.find(e=>e.id===Ke.value),a=((null==e?void 0:e.name)||"classroom").toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),l=route("schedules.classroom.view",{classroom_id:Ke.value,classroom_name:a});navigator.clipboard.writeText(l).then(()=>{$e.notify({type:"positive",message:"Student schedule link copied to clipboard!",position:"top",timeout:2e3})})};return(e,a)=>{const S=P("Head");return A(),E(W,null,[D(S,{title:Q(Me)("weeklySystem.timetableEditor.title")},null,8,["title"]),F("div",le,[D(K),F("div",te,[F("div",oe,[F("h4",se,[D(l,{name:"grid_view",class:"q-mr-sm",color:"primary"}),z(" "+O(Q(Me)("weeklySystem.timetableEditor.title")),1)]),F("p",ie,O(Q(Me)("weeklySystem.timetableEditor.subtitle")),1)]),F("div",ne,[D(t,{color:"positive","text-color":"white",dense:"",icon:"cloud_done",class:"q-mr-md"},{default:I(()=>a[28]||(a[28]=[z(" Live Mode: Changes scale immediately ")])),_:1})])]),D(p,{flat:"",bordered:"",class:"q-pa-md q-mb-lg"},{default:I(()=>[F("div",ue,[F("div",re,[D(w,{modelValue:Ke.value,"onUpdate:modelValue":[a[0]||(a[0]=e=>Ke.value=e),Ha],options:Re.value,"option-value":"id","option-label":"name",label:Q(Me)("weeklyPlans.classroom"),outlined:"",dense:"","emit-value":"","map-options":"",loading:ca.value},{prepend:I(()=>[D(l,{name:"meeting_room",color:"secondary"})]),option:I(({opt:e,itemProps:a})=>[D(o,G(M(a)),{default:I(()=>[D(s,null,{default:I(()=>[D(i,null,{default:I(()=>[z(O(e.name),1)]),_:2},1024),D(i,{caption:""},{default:I(()=>{var a;return[z(O((null==(a=e.grade)?void 0:a.name)||e.grade_name),1)]}),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","label","loading"])]),F("div",de,[D(n,{color:"primary",icon:"settings",label:"Actions",disable:!Ke.value},{default:I(()=>[D(u,{style:{"min-width":"220px"}},{default:I(()=>[D(i,{header:"",class:"text-weight-bold bg-grey-1"},{default:I(()=>a[29]||(a[29]=[z("Tools")])),_:1}),$((A(),L(o,{clickable:"",onClick:a[1]||(a[1]=e=>Oa.value=!0)},{default:I(()=>[D(s,{avatar:""},{default:I(()=>[D(l,{name:"psychology",color:"secondary"})]),_:1}),D(s,null,{default:I(()=>[D(i,null,{default:I(()=>[z(O(Q(Me)("common.aiGenerate")),1)]),_:1}),D(i,{caption:""},{default:I(()=>a[30]||(a[30]=[z("Generate schedule with AI")])),_:1})]),_:1})]),_:1})),[[b]]),$((A(),L(o,{clickable:"",onClick:a[2]||(a[2]=e=>Ia.value=!0)},{default:I(()=>[D(s,{avatar:""},{default:I(()=>[D(l,{name:"shuffle",color:"positive"})]),_:1}),D(s,null,{default:I(()=>[D(i,null,{default:I(()=>a[31]||(a[31]=[z("Random Fill")])),_:1}),D(i,{caption:""},{default:I(()=>a[32]||(a[32]=[z("Auto-fill empty slots")])),_:1})]),_:1})]),_:1})),[[b]]),D(r),D(i,{header:"",class:"text-weight-bold bg-grey-1"},{default:I(()=>a[33]||(a[33]=[z("Share Links")])),_:1}),$((A(),L(o,{clickable:"",onClick:ml},{default:I(()=>[D(s,{avatar:""},{default:I(()=>[D(l,{name:"link",color:"primary"})]),_:1}),D(s,null,{default:I(()=>[D(i,null,{default:I(()=>a[34]||(a[34]=[z("Copy Student Link")])),_:1}),D(i,{caption:""},{default:I(()=>a[35]||(a[35]=[z("Classroom view URL")])),_:1})]),_:1})]),_:1})),[[b]]),$((A(),L(o,{clickable:"",onClick:rl},{default:I(()=>[D(s,{avatar:""},{default:I(()=>[D(l,{name:"open_in_new",color:"secondary"})]),_:1}),D(s,null,{default:I(()=>[D(i,null,{default:I(()=>a[36]||(a[36]=[z("Open Student Page")])),_:1}),D(i,{caption:""},{default:I(()=>a[37]||(a[37]=[z("Open in new tab")])),_:1})]),_:1})]),_:1})),[[b]]),$((A(),L(o,{clickable:"",onClick:a[3]||(a[3]=e=>nl.value=!0)},{default:I(()=>[D(s,{avatar:""},{default:I(()=>[D(l,{name:"person_search",color:"accent"})]),_:1}),D(s,null,{default:I(()=>[D(i,null,{default:I(()=>a[38]||(a[38]=[z("Get Teacher Link...")])),_:1}),D(i,{caption:""},{default:I(()=>a[39]||(a[39]=[z("Select teacher view")])),_:1})]),_:1})]),_:1})),[[b]])]),_:1})]),_:1},8,["disable"])]),F("div",ce,[D(d,{color:"accent",icon:"format_list_numbered",label:Q(Me)("common.autoOrder")||"Auto-Order",outline:"",disable:!Ke.value,onClick:il,loading:sl.value},{default:I(()=>[D(c,null,{default:I(()=>a[40]||(a[40]=[z("Auto-fill period numbers (1, 2, 3...) for each subject")])),_:1})]),_:1},8,["label","disable","loading"])]),F("div",me,[D(d,{color:"secondary",icon:"save",label:"Manage Drafts",outline:"",onClick:a[4]||(a[4]=e=>_a.value=!0)})]),F("div",ve,[D(d,{color:"info",icon:"assignment_ind",label:"Assignments Overview",outline:"",onClick:a[5]||(a[5]=e=>da.value=!0)})])]),D(r,{class:"q-my-md"}),F("div",pe,[F("div",fe,[D(w,{modelValue:Xe.value,"onUpdate:modelValue":a[6]||(a[6]=e=>Xe.value=e),options:aa,label:"Days",outlined:"",dense:"",multiple:"","emit-value":"","map-options":"",style:{"min-width":"150px"}},{option:I(({itemProps:e,opt:a,selected:l,toggleOption:t})=>[D(o,G(M(e)),{default:I(()=>[D(s,null,{default:I(()=>[D(i,null,{default:I(()=>[z(O(a.label),1)]),_:2},1024)]),_:2},1024),D(s,{side:""},{default:I(()=>[D(m,{"model-value":l,"onUpdate:modelValue":e=>t(a)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040)]),selected:I(()=>[Xe.value.length===aa.length?(A(),E("div",ye,"All Days")):(A(),E("div",_e,O(Xe.value.length)+" Days Selected",1))]),_:1},8,["modelValue"])]),F("div",ge,[D(w,{modelValue:Ye.value,"onUpdate:modelValue":a[7]||(a[7]=e=>Ye.value=e),options:Q(la),label:"Periods",outlined:"",dense:"",multiple:"","emit-value":"","map-options":"",style:{"min-width":"150px"}},{option:I(({itemProps:e,opt:a,selected:l,toggleOption:t})=>[D(o,G(M(e)),{default:I(()=>[D(s,null,{default:I(()=>[D(i,null,{default:I(()=>[z(O(a.label),1)]),_:2},1024)]),_:2},1024),D(s,{side:""},{default:I(()=>[D(m,{"model-value":l,"onUpdate:modelValue":e=>t(a)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040)]),selected:I(()=>[Ye.value.length===Q(la).length?(A(),E("div",he,"All Periods")):(A(),E("div",be,O(Ye.value.length)+" Periods",1))]),_:1},8,["modelValue","options"])]),F("div",we,[D(w,{modelValue:Ze.value,"onUpdate:modelValue":a[8]||(a[8]=e=>Ze.value=e),options:Je.value,"option-value":"id","option-label":"name",label:"Filter Subjects",outlined:"",dense:"",multiple:"","emit-value":"","map-options":"",clearable:""},{option:I(({itemProps:e,opt:a,selected:l,toggleOption:t})=>[D(o,G(M(e)),{default:I(()=>[D(s,null,{default:I(()=>[D(i,null,{default:I(()=>[z(O(a.name),1)]),_:2},1024)]),_:2},1024),D(s,{side:""},{default:I(()=>[D(m,{"model-value":l,"onUpdate:modelValue":e=>t(a)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])]),F("div",ke,[D(w,{modelValue:ea.value,"onUpdate:modelValue":a[9]||(a[9]=e=>ea.value=e),options:Be.value,"option-value":"id","option-label":"name",label:"Filter Teachers",outlined:"",dense:"",multiple:"","emit-value":"","map-options":"",clearable:""},{option:I(({itemProps:e,opt:a,selected:l,toggleOption:t})=>[D(o,G(M(e)),{default:I(()=>[D(s,null,{default:I(()=>[D(i,null,{default:I(()=>[z(O(a.name),1)]),_:2},1024)]),_:2},1024),D(s,{side:""},{default:I(()=>[D(m,{"model-value":l,"onUpdate:modelValue":e=>t(a)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])]),F("div",xe,[D(d,{flat:"",round:"",icon:"restart_alt",color:"grey",onClick:Ga},{default:I(()=>[D(c,null,{default:I(()=>a[41]||(a[41]=[z("Reset Filters")])),_:1})]),_:1})]),D(ee,{modelValue:_a.value,"onUpdate:modelValue":a[10]||(a[10]=e=>_a.value=e),onCompare:qa,onLoad:Pa},null,8,["modelValue"]),D(ae,{modelValue:ha.value,"onUpdate:modelValue":a[11]||(a[11]=e=>ha.value=e),"draft-name":ja.value,comparison:xa.value,loading:Va.value,publishing:Sa.value,onPublish:Ta},null,8,["modelValue","draft-name","comparison","loading","publishing"]),D(v,{modelValue:ga.value,"onUpdate:modelValue":a[15]||(a[15]=e=>ga.value=e)},{default:I(()=>[D(p,{style:{"min-width":"400px"}},{default:I(()=>[D(f,null,{default:I(()=>a[42]||(a[42]=[F("div",{class:"text-h6"},"Save Schedule Draft",-1)])),_:1}),D(f,{class:"q-pt-none q-gutter-md"},{default:I(()=>[D(y,{filled:"",modelValue:ba.value,"onUpdate:modelValue":a[12]||(a[12]=e=>ba.value=e),autofocus:"",label:"Draft Name",hint:"Unique name for this version",rules:[e=>!!e||"Name is required"]},null,8,["modelValue","rules"]),D(y,{filled:"",modelValue:wa.value,"onUpdate:modelValue":a[13]||(a[13]=e=>wa.value=e),type:"textarea",label:"Description (Optional)",rows:"3",hint:"What changed in this version?"},null,8,["modelValue"]),D(m,{modelValue:ka.value,"onUpdate:modelValue":a[14]||(a[14]=e=>ka.value=e),label:"Overwrite if exists"},null,8,["modelValue"])]),_:1}),D(_,{align:"right",class:"text-primary"},{default:I(()=>[$(D(d,{flat:"",label:"Cancel"},null,512),[[b]]),D(d,{flat:"",label:"Save Draft",onClick:Ua,color:"primary"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),F("div",je,[Da.value?(A(),E("div",Ve,[F("div",Se,O(Q(Me)("weeklyPlans.totalSlots"))+" ("+O(Q(Me)("weeklyPlans.allClassrooms"))+")",1),F("div",Ce,[D(t,{dense:"",icon:"apps",color:"blue-2","text-color":"blue-9",size:"sm"},{default:I(()=>[z(O(Da.value.total_slots)+" "+O(Q(Me)("common.total")),1)]),_:1}),D(t,{dense:"",icon:"check_circle",color:"green-2","text-color":"green-9",size:"sm"},{default:I(()=>[z(O(Da.value.assigned_slots)+" "+O(Q(Me)("common.assigned")),1)]),_:1}),D(t,{dense:"",icon:"radio_button_unchecked",color:"grey-3","text-color":"grey-8",size:"sm"},{default:I(()=>[z(O(Da.value.unassigned_slots)+" "+O(Q(Me)("common.empty")),1)]),_:1}),Da.value.conflict_count>0?(A(),L(t,{key:0,dense:"",icon:"warning",color:"orange-2","text-color":"orange-9",size:"sm",clickable:"",onClick:a[16]||(a[16]=e=>al("overall"))},{default:I(()=>[z(O(Da.value.conflict_count)+" "+O(Q(Me)("common.conflicts")),1)]),_:1})):R("",!0)])])):R("",!0),Aa.value?(A(),E("div",Ue,[F("div",qe,O(Q(Me)("weeklyPlans.totalSlots"))+" ("+O(Q(Me)("weeklyPlans.currentClassroom"))+")",1),F("div",Te,[D(t,{dense:"",icon:"apps",color:"blue-2","text-color":"blue-9",size:"sm"},{default:I(()=>[z(O(Aa.value.total_slots)+" "+O(Q(Me)("common.total")),1)]),_:1}),D(t,{dense:"",icon:"check_circle",color:"green-2","text-color":"green-9",size:"sm"},{default:I(()=>[z(O(Aa.value.assigned_slots)+" "+O(Q(Me)("common.assigned")),1)]),_:1}),D(t,{dense:"",icon:"radio_button_unchecked",color:"grey-3","text-color":"grey-8",size:"sm"},{default:I(()=>[z(O(Aa.value.unassigned_slots)+" "+O(Q(Me)("common.empty")),1)]),_:1}),Aa.value.conflict_count>0?(A(),L(t,{key:0,dense:"",icon:"warning",color:"orange-2","text-color":"orange-9",size:"sm",clickable:"",onClick:a[17]||(a[17]=e=>al("classroom"))},{default:I(()=>[z(O(Aa.value.conflict_count)+" "+O(Q(Me)("common.conflicts")),1)]),_:1})):R("",!0)]),Aa.value.subject_breakdown&&Aa.value.subject_breakdown.length>0?(A(),L(g,{key:0,modelValue:Ca.value,"onUpdate:modelValue":a[18]||(a[18]=e=>Ca.value=e),icon:"analytics",label:"Subject Breakdown",caption:"Expected vs Actual",class:"q-mt-md bg-grey-1 rounded-borders overflow-hidden","header-class":"text-primary"},{default:I(()=>[D(x,{dense:"",flat:"",square:"",class:"subject-breakdown-table"},{default:I(()=>[a[44]||(a[44]=F("thead",null,[F("tr",null,[F("th",{class:"text-left"},"Subject"),F("th",{class:"text-left"},"Teacher"),F("th",{class:"text-center"},"Expected"),F("th",{class:"text-center"},"Actual"),F("th",{class:"text-center"},"Status")])],-1)),F("tbody",null,[(A(!0),E(W,null,N(Aa.value.subject_breakdown,(e,o)=>(A(),E("tr",{key:o},[F("td",Pe,[D(k,{color:"blue-2","text-color":"blue-9"},{default:I(()=>[z(O(e.subject_name),1)]),_:2},1024)]),F("td",Ee,O(e.teacher_name),1),F("td",Ae,[D(t,{dense:"",size:"sm",color:"grey-3","text-color":"grey-9"},{default:I(()=>[z(O(e.expected),1)]),_:2},1024)]),F("td",De,[D(t,{dense:"",size:"sm",color:e.actual===e.expected?"green-2":"orange-2","text-color":e.actual===e.expected?"green-9":"orange-9"},{default:I(()=>[z(O(e.actual),1)]),_:2},1032,["color","text-color"])]),F("td",Fe,[e.actual===e.expected?(A(),L(l,{key:0,name:"check_circle",color:"positive",size:"sm"},{default:I(()=>[D(c,null,{default:I(()=>a[43]||(a[43]=[z("Correct")])),_:1})]),_:1})):e.actual<e.expected?(A(),L(l,{key:1,name:"arrow_downward",color:"warning",size:"sm"},{default:I(()=>[D(c,null,{default:I(()=>[z("Missing "+O(e.expected-e.actual)+" period(s)",1)]),_:2},1024)]),_:2},1024)):(A(),L(l,{key:2,name:"arrow_upward",color:"warning",size:"sm"},{default:I(()=>[D(c,null,{default:I(()=>[z(O(e.actual-e.expected)+" extra period(s)",1)]),_:2},1024)]),_:2},1024))])]))),128))])]),_:1})]),_:1},8,["modelValue"])):R("",!0)])):R("",!0)])])]),_:1}),ma.value?(A(),E("div",Qe,[D(j,{size:"50px",color:"primary"})])):Ke.value?(A(),L(J,{key:2,schedules:We.value,"teacher-conflicts":He.value,"visible-days":Xe.value,"visible-periods":Ye.value,"filter-subject-ids":Ze.value,"filter-teacher-ids":ea.value,onCellClick:Ka,onEdit:Xa,onClear:Ya},null,8,["schedules","teacher-conflicts","visible-days","visible-periods","filter-subject-ids","filter-teacher-ids"])):(A(),L(p,{key:1,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:I(()=>[D(l,{name:"touch_app",size:"64px",color:"grey-5"}),F("p",Le,O(Q(Me)("weeklySystem.timetableEditor.selectClassroom")),1),F("p",ze,O(Q(Me)("weeklySystem.timetableEditor.chooseClassroom")),1)]),_:1})),D(H,{modelValue:oa.value,"onUpdate:modelValue":a[19]||(a[19]=e=>oa.value=e),schedule:sa.value,day:ia.value,period:na.value,"classroom-name":ta.value,"cst-options":Ne.value,teachers:Be.value,subjects:Je.value,"loading-c-s-t":va.value,"loading-teachers":pa.value,"loading-subjects":fa.value,saving:ya.value,"slot-availability":ua.value,"loading-availability":ra.value,onSubmit:Za,onFilterCst:el,onClose:a[20]||(a[20]=e=>oa.value=!1)},null,8,["modelValue","schedule","day","period","classroom-name","cst-options","teachers","subjects","loading-c-s-t","loading-teachers","loading-subjects","saving","slot-availability","loading-availability"]),D(v,{modelValue:Fa.value,"onUpdate:modelValue":a[21]||(a[21]=e=>Fa.value=e),position:"right"},{default:I(()=>[D(p,{style:{width:"500px","max-width":"80vw"}},{default:I(()=>[D(f,{class:"row items-center q-pb-none"},{default:I(()=>[F("div",Oe,O(Q(Me)("weeklySystem.timetableEditor.conflictDetails")),1),D(V),$(D(d,{icon:"close",flat:"",round:"",dense:""},null,512),[[b]])]),_:1}),D(f,null,{default:I(()=>[Qa.value?(A(),E("div",Ie,[D(h,{color:"primary",size:"3em"})])):0===La.value.length?(A(),E("div",Ge,O(Q(Me)("common.noConflicts")),1)):(A(),L(u,{key:2,separator:""},{default:I(()=>[(A(!0),E(W,null,N(La.value,(e,a)=>(A(),L(o,{key:a},{default:I(()=>[D(s,null,{default:I(()=>[D(i,{class:"text-weight-medium"},{default:I(()=>[z(O(e.teacher_name),1)]),_:2},1024),D(i,{caption:""},{default:I(()=>[z(O(e.day_name)+" - Period "+O(e.period_number),1)]),_:2},1024),D(i,{caption:"",class:"text-orange-9"},{default:I(()=>[z(O(Q(Me)("weeklySystem.timetableEditor.assignedTo"))+": "+O(e.classrooms.join(", ")),1)]),_:2},1024)]),_:2},1024),D(s,{side:""},{default:I(()=>[D(k,{color:"orange",label:e.classrooms.length+" classes"},null,8,["label"])]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1},8,["modelValue"]),D(X,{modelValue:Oa.value,"onUpdate:modelValue":a[22]||(a[22]=e=>Oa.value=e),"classroom-id":Ke.value,"classroom-name":ta.value,subjects:Je.value,onApplied:tl},null,8,["modelValue","classroom-id","classroom-name","subjects"]),D(Y,{modelValue:Ia.value,"onUpdate:modelValue":a[23]||(a[23]=e=>Ia.value=e),"classroom-id":Ke.value,"classroom-name":ta.value,onApplied:ol},null,8,["modelValue","classroom-id","classroom-name"]),D(Z,{modelValue:da.value,"onUpdate:modelValue":a[24]||(a[24]=e=>da.value=e)},null,8,["modelValue"]),D(v,{modelValue:nl.value,"onUpdate:modelValue":a[27]||(a[27]=e=>nl.value=e)},{default:I(()=>[D(p,{style:{"min-width":"400px"}},{default:I(()=>[D(f,null,{default:I(()=>a[45]||(a[45]=[F("div",{class:"text-h6"},"Get Teacher Schedule Link",-1)])),_:1}),D(f,null,{default:I(()=>[D(w,{modelValue:ul.value,"onUpdate:modelValue":a[25]||(a[25]=e=>ul.value=e),options:Be.value,"option-value":"id","option-label":"name",label:"Select Teacher",outlined:"",dense:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",onFilter:a[26]||(a[26]=(e,a)=>{a(()=>{})}),ref:"teacherLinkSelect"},{"no-option":I(()=>[D(o,null,{default:I(()=>[D(s,{class:"text-grey"},{default:I(()=>a[46]||(a[46]=[z(" No results ")])),_:1})]),_:1})]),_:1},8,["modelValue","options"]),a[47]||(a[47]=F("div",{class:"q-mt-sm text-caption text-grey"}," Select a teacher to generate a read-only schedule link. ",-1))]),_:1}),D(_,{align:"right"},{default:I(()=>[$(D(d,{flat:"",label:"Cancel",color:"primary"},null,512),[[b]]),D(d,{flat:"",label:"Open Page",color:"secondary",onClick:dl,disable:!ul.value},null,8,["disable"]),D(d,{flat:"",label:"Copy Link",color:"primary",onClick:cl,disable:!ul.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])],64)}}},[["__scopeId","data-v-219c9a41"]]);export{Me as default};
