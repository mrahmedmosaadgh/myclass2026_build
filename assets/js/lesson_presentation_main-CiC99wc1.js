import{u as e}from"./presentationStore-CqdsmQ-I.js";import t from"./CanvasEditor-CZavOzIf.js";import o from"./PresentationMode-DeDLJ6zZ.js";import n from"./TopBar-BmzWdEBo.js";import{l}from"./ui-DFn3cvMd.js";import{_ as s}from"./LucideIcon-B0gGlzx4.js";import{r as a}from"./app-DTyzyps1.js";import{f as r,a as i,k as c,N as d,J as u,b as v,O as p,I as g,Q as m,F as y,R as h,U as f,V as b,y as w,ac as S,a0 as x}from"./vendor-BJyC5yAd.js";import"./ElementContent-DYSYSsDs.js";import"./youtube_VideoPlayer-_rBq4MaF.js";import"./offline-BzIlwqNM.js";import"./i18n-BDgsCcB6.js";import"./VideoPlayer-D9z4RG7L.js";import"./text_el-BzvMDzlE.js";import"./createLucideIcon-a-HRSG4f.js";import"./printer-MKOkmkKr.js";import"./image-kFeW2ff6.js";import"./Dropdown8-CUWqkSFi.js";const C={class:"presentation-layout"},k={class:"main-content"},j={class:"slides-panel"},E={class:"slides-controls"},I={class:"slides-list"},L=["onClick"],_={class:"slide-preview"},A={class:"slide-number"},P={class:"thumbnail-content"},D=["onUpdate:modelValue"],F={class:"slide-actions"},N=["onClick"],O=["onClick"],T={class:"editor-area"},U={class:"canvas-container"},R=a({__name:"lesson_presentation_main",setup(a){const R=e(),V=r(!1),z=r(!1),M=i(()=>R.slides),J=i(()=>R.currentSlideIndex),$=i(()=>R.currentSlide),B=({x:e,y:t,type:o})=>{if(M.value&&0!==M.value.length||(R.addSlide(),l.info("Created first slide")),!$.value||!$.value.content)return console.warn("No current slide or invalid slide content"),void l.warning("Please select a slide first");const n={id:Date.now(),type:o,x:Math.max(0,e-100),y:Math.max(0,t-50),width:"auto",height:"auto",content:"text"===o?"New Text":"",visible:!0,locked:!1,style:{fontSize:"16px",fontFamily:"Arial",color:"#000000",backgroundColor:"white",padding:"12px",borderRadius:"4px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",border:"1px solid #e2e8f0",display:"text"===o?"inline-block":"block",width:"text"===o?"auto":"320px",minWidth:"text"===o?"50px":"320px"}};try{R.addElement(n),console.log("Added new element:",n)}catch(s){console.error("Failed to add element:",s),l.error("Failed to add element")}},q=()=>{try{R.toggleAllElements()}catch(e){console.error("Failed to toggle elements:",e),l.error("Failed to toggle elements")}},Q=e=>{try{R.setZoomLevel(e)}catch(t){console.error("Failed to change zoom:",t),l.error("Failed to change zoom level")}},Z=e=>{},H=i({get:()=>R.presentationTitle,set:e=>R.setTitle(e)}),W=()=>{R.addSlide(),l.success("New slide added",{position:"bottom-right",autoClose:2e3})},G=e=>{R.updateSlideContent(e)},K=()=>{if(console.log("Current slides:",M.value),!M.value||!Array.isArray(M.value))throw console.error("Slides is not an array:",M.value),new Error("Invalid slides data structure");0===M.value.length&&(console.warn("No slides to save, creating a default slide"),M.value.push({id:Date.now(),title:"",content:{elements:[],backgroundImage:""}}));const e=M.value.map((e,t)=>(console.log(`Processing slide ${t}:`,e),e.content?{id:e.id||Date.now()+t,title:e.title||"",content:{elements:Array.isArray(e.content.elements)?e.content.elements:[],backgroundImage:e.content.backgroundImage||""}}:(console.warn(`Slide ${t} missing content, creating default structure`),{id:e.id||Date.now()+t,title:e.title||"",content:{elements:[],backgroundImage:""}})));return console.log(`Prepared ${e.length} slides for saving`),{title:H.value||"Untitled Presentation",slides:e,version:"2.0",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),slideCount:e.length}};0===M.value.length&&W();const X=i(()=>R.isPresentationMode),Y=()=>{try{R.setPresentationMode(!0),console.log("Starting presentation mode")}catch(e){console.error("Error starting presentation:",e),l.error("Failed to start presentation")}},ee=()=>{try{R.setPresentationMode(!1),console.log("Exiting presentation mode")}catch(e){console.error("Error exiting presentation:",e),l.error("Failed to exit presentation")}},te=()=>{console.log("Saving slides, count:",M.value.length)};c(M,e=>{console.log("Slides changed. New count:",e.length)},{deep:!0}),c(M,e=>{J.value>=e.length&&(J.value=Math.max(0,e.length-1))});const oe=()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=e=>{const t=e.target.files[0];if(!t)return;const o=new FileReader;o.onload=e=>{try{const t=JSON.parse(e.target.result);if(console.log("Parsed presentation data:",t),!t.slides||!Array.isArray(t.slides))throw new Error("Invalid presentation format");R.loadPresentation(t),l.success(`Successfully loaded presentation with ${t.slides.length} slides`)}catch(t){console.error("Error loading presentation:",t),l.error("Error loading presentation: "+t.message)}},o.onerror=()=>{l.error("Error reading file")},o.readAsText(t)},e.click()},ne=r(!1),le=r(!1),se=r(""),ae=r(""),re=async()=>{try{if(z.value)return;if(z.value=!0,!se.value)return console.log("No previous save path, redirecting to saveAs"),z.value=!1,ie();console.log("Quick saving to:",se.value);const e=K(),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),o=URL.createObjectURL(t);setTimeout(()=>{const e=document.createElement("a");e.href=o,e.download=se.value,e.style.display="none",document.body.appendChild(e);try{e.click(),console.log("Download triggered successfully")}catch(t){console.error("Error triggering download:",t),l.error("Failed to trigger download"),z.value=!1}setTimeout(()=>{document.body.removeChild(e),URL.revokeObjectURL(o),z.value=!1;const t=document.querySelector(".title-input");t&&(t.classList.add("save-success"),setTimeout(()=>t.classList.remove("save-success"),500)),l.success("Presentation saved successfully",{icon:"ðŸ’¾",position:"bottom-right",autoClose:2e3})},100)},100),ne.value=!1,le.value=!1}catch(e){console.error("Error saving presentation:",e),l.error("Error saving presentation: "+e.message),z.value=!1}},ie=async()=>{try{if(z.value)return;z.value=!0;const e=prompt("Enter file name:",H.value||"presentation");if(!e)return console.log("Save As cancelled - no filename provided"),void(z.value=!1);console.log("Saving as new file:",e);const t=K(),o=(new Date).toISOString().slice(0,19).replace(/[:]/g,"-"),n=`${e}_${o}.json`,s=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=URL.createObjectURL(s);setTimeout(()=>{const t=document.createElement("a");t.href=a,t.download=n,t.style.display="none",document.body.appendChild(t);try{t.click(),console.log("Download triggered successfully for:",n)}catch(o){console.error("Error triggering download:",o),l.error("Failed to trigger download"),z.value=!1}setTimeout(()=>{document.body.removeChild(t),URL.revokeObjectURL(a),z.value=!1,ae.value=e,se.value=n,H.value=e;const o=document.querySelector(".title-input");o&&(o.classList.add("save-success"),setTimeout(()=>o.classList.remove("save-success"),500)),l.success('Presentation saved as "'+e+'"',{icon:"ðŸ“„",position:"bottom-right",autoClose:3e3})},100)},100),ne.value=!1,le.value=!1}catch(e){console.error("Error saving presentation:",e),l.error("Error saving presentation: "+e.message),z.value=!1}},ce=({x:e,y:t,currentElementType:o})=>{V.value||B({x:e,y:t,type:o||"text"})};return(e,a)=>(u(),d("div",C,[v(n,{readonly:V.value,isSaving:z.value,onQuickSave:re,onSaveAs:ie,onStartPresentation:Y,onLoad_all_slides_to_file:oe,onAddElement:B,onToggleElements:q,onZoomChange:Q,onBackgroundChange:Z},null,8,["readonly","isSaving"]),p("div",k,[p("div",j,[p("div",E,[p("button",{onClick:W,class:"action-btn add-btn"},[v(s,{name:"plus",size:"18"}),a[1]||(a[1]=p("span",null,"New Slide",-1))])]),p("div",I,[(u(!0),d(y,null,h(M.value,(e,t)=>(u(),d("div",{key:t,class:f(["slide-thumbnail",{active:t===J.value}]),onClick:e=>(e=>{R.setCurrentSlideIndex(e)})(t)},[p("div",_,[p("div",A,b(t+1),1),p("div",P,[w(p("input",{type:"text","onUpdate:modelValue":t=>e.title=t,class:"border-0"},null,8,D),[[S,e.title]])])]),p("div",F,[p("button",{onClick:x(e=>(e=>{var t;const o=M.value[e],n={id:Date.now(),title:null==(t=M.value[e])?void 0:t.title,content:JSON.parse(JSON.stringify(o.content))};M.value.splice(e+1,0,n),J.value=e+1,l.success("Slide duplicated",{position:"bottom-right",autoClose:2e3}),te()})(t),["stop"]),class:"duplicate-btn",title:"Duplicate slide"},[v(s,{name:"copy",size:"16"})],8,N),p("button",{onClick:x(e=>(e=>{M.value.length>1?(M.value.splice(e,1),J.value>=M.value.length&&(J.value=M.value.length-1),te()):l.error("Cannot delete the only slide",{position:"bottom-right",autoClose:2e3})})(t),["stop"]),class:"delete-btn",title:"Delete slide"},[v(s,{name:"trash-2",size:"16"})],8,O)])],10,L))),128))])]),p("div",T,[p("div",U,[$.value?(u(),g(t,{key:J.value,modelValue:$.value.content,"onUpdate:modelValue":[a[0]||(a[0]=e=>$.value.content=e),G],onCanvasClick:ce},null,8,["modelValue"])):m("",!0)])])]),X.value?(u(),g(o,{key:0,slides:M.value,initialIndex:J.value,onExit:ee},null,8,["slides","initialIndex"])):m("",!0)]))}},[["__scopeId","data-v-c83f7c5a"]]);export{R as default};
