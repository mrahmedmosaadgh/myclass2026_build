import{u as e,Q as a,h as l,b as o,H as s,t,d as r,f as i,p as n,o as d,aS as u,e as c}from"./app-Dtv5Fi9L.js";import{Q as m}from"./QBadge-B7PIhVlN.js";import{Q as p}from"./QTd-DkPAnXdW.js";import{Q as v}from"./QTable-DjEJtvgI.js";import{Q as h}from"./QSelect-BslHFD89.js";import{Q as _}from"./QForm-Cyf9p9ZM.js";import{M as g,a as f,f as y,I as w,J as b,K as V,R as x,b as S,W as k,V as q,N as j,y as A,_ as C,$ as Q}from"./vendor-BWKGNkNB.js";import{_ as R}from"./AppLayout-B3PyevP7.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./QMarkupTable-BGpv7gz2.js";import"./QLinearProgress-D6iXPeG1.js";import"./use-fullscreen-GpMU35jG.js";import"./rtl-Cr6c3OOr.js";const H={class:"py-12"},N={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},U={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-6"},D={class:"flex justify-between items-center mb-6"},E={class:"flex space-x-2"},M={class:"text-h6"},$={class:"q-my-md bg-gray-50 p-3 rounded border border-gray-200"},T={key:0,class:"q-gutter-md q-pl-md border-l-4 border-indigo-500 q-mb-md"},P={key:1},z={__name:"Index",props:{schools:{type:Object,required:!0},hrs:{type:Array,required:!0}},setup(z){const F=e();g();const I=z,L=[{name:"name",required:!0,label:"School Name",align:"left",field:"name",sortable:!0},{name:"hr",align:"left",label:"Assigned HR",field:e=>{var a;return(null==(a=e.hr)?void 0:a.name)||"N/A"},sortable:!0},{name:"status",align:"center",label:"Status",field:"is_active",sortable:!0},{name:"actions",align:"right",label:"Actions"}],O=f(()=>I.hrs.map(e=>({label:e.name,value:e.id}))),B=y(""),J=y(!1),K=y(!1),W=y(null),G=y(!1),X=y({name:"",h_r_id:null,create_new_hr:!1,hr_name:"",hr_email:"",hr_password:""}),Y=()=>{X.value={name:"",h_r_id:null,create_new_hr:!1,hr_name:"",hr_email:"",hr_password:""},W.value=null,K.value=!1},Z=(e=null)=>{W.value=e,X.value=e?{name:e.name,h_r_id:e.h_r_id,create_new_hr:!1,hr_name:"",hr_email:"",hr_password:""}:{name:"",h_r_id:null,create_new_hr:!1,hr_name:"",hr_email:"",hr_password:""},K.value=!0},ee=()=>{Q.reload({only:["schools","hrs"],preserveScroll:!0,preserveState:!0})},ae=async()=>{var e,a,l,o;if(!X.value.name)return void F.notify({type:"warning",message:"School Name is required"});if(X.value.create_new_hr){if(!X.value.hr_name||!X.value.hr_email||!X.value.hr_password)return void F.notify({type:"warning",message:"All HR details are required"})}else if(!X.value.h_r_id)return void F.notify({type:"warning",message:"Please select an HR Manager"});G.value=!0;const s="/admin/school"+(W.value?`/${W.value.id}`:""),t={...X.value,...W.value&&{_method:"PUT"}};try{const e=await C.post(s,t);F.notify({type:"positive",message:e.data.message||(W.value?"School updated successfully":"School created successfully")}),closeModal(),ee()}catch(r){const s=(null==(a=null==(e=r.response)?void 0:e.data)?void 0:a.message)||"An error occurred while saving.";F.notify({type:"negative",message:s}),(null==(o=null==(l=r.response)?void 0:l.data)?void 0:o.errors)&&console.error(r.response.data.errors)}finally{G.value=!1}};return(e,g)=>(b(),w(R,{title:"Schools"},{header:V(()=>g[9]||(g[9]=[x("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Schools Management ",-1)])),default:V(()=>[x("div",H,[x("div",N,[x("div",U,[x("div",D,[x("div",E,[S(l,{modelValue:B.value,"onUpdate:modelValue":g[0]||(g[0]=e=>B.value=e),dense:"",outlined:"",placeholder:"Search schools...",class:"w-64"},{append:V(()=>[S(a,{name:"search"})]),_:1},8,["modelValue"])]),S(o,{color:"primary",icon:"add",label:"Add School",onClick:g[1]||(g[1]=e=>Z())})]),S(v,{rows:z.schools.data,columns:L,"row-key":"id",filter:B.value,loading:J.value,flat:"",bordered:""},{"body-cell-status":V(e=>[S(p,{props:e,class:"text-center"},{default:V(()=>[S(m,{color:e.row.is_active?"positive":"negative",label:e.row.is_active?"Active":"Inactive",class:"q-px-sm q-py-xs"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-actions":V(e=>[S(p,{props:e,class:"text-right"},{default:V(()=>[S(s,{flat:""},{default:V(()=>[S(o,{flat:"",round:"",size:"sm",color:e.row.is_active?"warning":"positive",icon:e.row.is_active?"block":"check_circle",onClick:a=>(e=>{const a=e.is_active?"Deactivate":"Activate";F.dialog({title:"Confirm Action",message:`Are you sure you want to ${a.toLowerCase()} <strong>${e.name}</strong>?`,html:!0,cancel:!0,persistent:!0}).onOk(()=>{C.post(`/admin/school/${e.id}/toggle-status`).then(e=>{F.notify({type:"positive",message:e.data.message||`School ${a}d successfully`}),ee()}).catch(e=>{F.notify({type:"negative",message:"Failed to update status"})})})})(e.row)},{default:V(()=>[S(t,null,{default:V(()=>[k(q(e.row.is_active?"Deactivate":"Activate"),1)]),_:2},1024)]),_:2},1032,["color","icon","onClick"]),S(o,{flat:"",round:"",size:"sm",color:"primary",icon:"edit",onClick:a=>Z(e.row)},{default:V(()=>[S(t,null,{default:V(()=>g[10]||(g[10]=[k("Edit")])),_:1})]),_:2},1032,["onClick"]),S(o,{flat:"",round:"",size:"sm",color:"negative",icon:"delete",onClick:a=>{return l=e.row,void F.dialog({title:"Delete School",message:`Are you sure you want to delete <strong>${l.name}</strong>? This cannot be undone.`,html:!0,ok:{label:"Delete",color:"negative"},cancel:!0,persistent:!0}).onOk(()=>{const e=new FormData;e.append("_method","DELETE"),C.post(`/admin/school/${l.id}`,e).then(e=>{F.notify({type:"positive",message:"School deleted successfully"}),ee()}).catch(e=>{F.notify({type:"negative",message:"Failed to delete school"})})});var l}},{default:V(()=>[S(t,null,{default:V(()=>g[11]||(g[11]=[k("Delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","filter","loading"])])])]),S(c,{modelValue:K.value,"onUpdate:modelValue":g[8]||(g[8]=e=>K.value=e),persistent:""},{default:V(()=>[S(r,{style:{"min-width":"500px"}},{default:V(()=>[S(i,null,{default:V(()=>[x("div",M,q(W.value?"Edit School":"Add New School"),1)]),_:1}),S(i,{class:"q-pt-none"},{default:V(()=>[S(_,{onSubmit:ae,class:"q-gutter-md"},{default:V(()=>[S(l,{modelValue:X.value.name,"onUpdate:modelValue":g[2]||(g[2]=e=>X.value.name=e),label:"School Name *",outlined:"",rules:[e=>!!e||"Name is required"]},null,8,["modelValue","rules"]),x("div",$,[S(n,{modelValue:X.value.create_new_hr,"onUpdate:modelValue":g[3]||(g[3]=e=>X.value.create_new_hr=e),label:"Create New HR Manager Account",color:"indigo"},null,8,["modelValue"])]),X.value.create_new_hr?(b(),j("div",T,[g[12]||(g[12]=x("div",{class:"text-subtitle2 text-indigo-700 q-mb-sm"},"New HR Details",-1)),S(l,{modelValue:X.value.hr_name,"onUpdate:modelValue":g[4]||(g[4]=e=>X.value.hr_name=e),label:"HR Manager Name *",outlined:"",dense:"",rules:[e=>!!e||"HR Name is required"]},null,8,["modelValue","rules"]),S(l,{modelValue:X.value.hr_email,"onUpdate:modelValue":g[5]||(g[5]=e=>X.value.hr_email=e),label:"HR Email *",type:"email",outlined:"",dense:"",rules:[e=>!!e||"Email is required",e=>/.+@.+\..+/.test(e)||"Invalid email format"]},null,8,["modelValue","rules"]),S(l,{modelValue:X.value.hr_password,"onUpdate:modelValue":g[6]||(g[6]=e=>X.value.hr_password=e),label:"Password *",type:"password",outlined:"",dense:"",rules:[e=>!!e||"Password is required"]},null,8,["modelValue","rules"])])):(b(),j("div",P,[S(h,{modelValue:X.value.h_r_id,"onUpdate:modelValue":g[7]||(g[7]=e=>X.value.h_r_id=e),options:O.value,label:"Assign Existing HR *",outlined:"","emit-value":"","map-options":"",rules:[e=>!!e||"Please select an HR Manager"]},null,8,["modelValue","options","rules"])]))]),_:1})]),_:1}),S(d,{align:"right",class:"text-primary"},{default:V(()=>[A(S(o,{flat:"",label:"Cancel",onClick:Y},null,512),[[u]]),S(o,{color:"primary",label:W.value?"Update School":"Create School",loading:G.value,onClick:ae},null,8,["label","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{z as default};
