import{a5 as e,X as t,O as o,al as n,an as i,b as r,k as l,Q as a,j as s,aR as c,t as d,I as u,Y as p,Z as m,bo as h,P as f,aq as g}from"./app-NYt77MEb.js";import{h as v,p as b,f as y,a as k,k as C,o as w,A as S,n as T}from"./vendor-BWKGNkNB.js";import{u as z,a as x,b as q}from"./use-fullscreen-CdeNMBy-.js";function P(e,t){if(t&&e===t)return null;const o=e.nodeName.toLowerCase();if(!0===["div","li","ul","ol","blockquote"].includes(o))return e;const n=(window.getComputedStyle?window.getComputedStyle(e):e.currentStyle).display;return"block"===n||"table"===n?e:P(e.parentNode)}function L(e,t,o){return!(!e||e===document.body)&&(!0===o&&e===t||(t===document?document.body:t).contains(e.parentNode))}function H(e,t,o){if(o||((o=document.createRange()).selectNode(e),o.setStart(e,0)),0===t.count)o.setEnd(e,t.count);else if(t.count>0)if(e.nodeType===Node.TEXT_NODE)e.textContent.length<t.count?t.count-=e.textContent.length:(o.setEnd(e,t.count),t.count=0);else for(let n=0;0!==t.count&&n<e.childNodes.length;n++)o=H(e.childNodes[n],t,o);return o}const B=/^https?:\/\//;class ${constructor(e,t){this.el=e,this.eVm=t,this._range=null}get selection(){if(this.el){const e=document.getSelection();if(L(e.anchorNode,this.el,!0)&&L(e.focusNode,this.el,!0))return e}return null}get hasSelection(){return null!==this.selection&&0!==this.selection.toString().length}get range(){const e=this.selection;return(null==e?void 0:e.rangeCount)?e.getRangeAt(0):this._range}get parent(){const e=this.range;if(null!==e){const t=e.startContainer;return t.nodeType===document.ELEMENT_NODE?t:t.parentNode}return null}get blockParent(){const e=this.parent;return null!==e?P(e,this.el):null}save(e=this.range){null!==e&&(this._range=e)}restore(e=this._range){const t=document.createRange(),o=document.getSelection();null!==e?(t.setStart(e.startContainer,e.startOffset),t.setEnd(e.endContainer,e.endOffset),o.removeAllRanges(),o.addRange(t)):(o.selectAllChildren(this.el),o.collapseToEnd())}savePosition(){let e,t=-1;const o=document.getSelection(),n=this.el.parentNode;if(o.focusNode&&L(o.focusNode,n))for(e=o.focusNode,t=o.focusOffset;e&&e!==n;)e!==this.el&&e.previousSibling?(e=e.previousSibling,t+=e.textContent.length):e=e.parentNode;this.savedPos=t}restorePosition(e=0){if(this.savedPos>0&&this.savedPos<e){const e=window.getSelection(),t=H(this.el,{count:this.savedPos});t&&(t.collapse(!1),e.removeAllRanges(),e.addRange(t))}}hasParent(e,t){const o=t?this.parent:this.blockParent;return null!==o&&o.nodeName.toLowerCase()===e.toLowerCase()}hasParents(e,t,o=this.parent){return null!==o&&(!0===e.includes(o.nodeName.toLowerCase())||!0===t&&this.hasParents(e,t,o.parentNode))}is(e,t){if(null===this.selection)return!1;switch(e){case"formatBlock":return"DIV"===t&&this.parent===this.el||this.hasParent(t,"PRE"===t);case"link":return this.hasParent("A",!0);case"fontSize":return document.queryCommandValue(e)===t;case"fontName":const o=document.queryCommandValue(e);return o===`"${t}"`||o===t;case"fullscreen":return this.eVm.inFullscreen.value;case"viewsource":return this.eVm.isViewingSource.value;case void 0:return!1;default:const n=document.queryCommandState(e);return void 0!==t?n===t:n}}getParentAttribute(e){return null!==this.parent?this.parent.getAttribute(e):null}can(e){return"outdent"===e?this.hasParents(["blockquote","li"],!0):"indent"===e?this.hasParents(["li"],!0):"link"===e?null!==this.selection||this.is("link"):void 0}apply(t,o,n=e){if("formatBlock"===t)["BLOCKQUOTE","H1","H2","H3","H4","H5","H6"].includes(o)&&this.is(t,o)&&(t="outdent",o=null),"PRE"===o&&this.is(t,"PRE")&&(o="P");else{if("print"===t){n();const e=window.open();return e.document.write(`\n        <!doctype html>\n        <html>\n          <head>\n            <title>Print - ${document.title}</title>\n          </head>\n          <body>\n            <div>${this.el.innerHTML}</div>\n          </body>\n        </html>\n      `),e.print(),void e.close()}if("link"===t){const e=this.getParentAttribute("href");if(null===e){const e=this.selectWord(this.selection),t=e?e.toString():"";if(!(t.length||this.range&&this.range.cloneContents().querySelector("img")))return;this.eVm.editLinkUrl.value=B.test(t)?t:"https://",document.execCommand("createLink",!1,this.eVm.editLinkUrl.value),this.save(e.getRangeAt(0))}else this.eVm.editLinkUrl.value=e,this.range.selectNodeContents(this.parent),this.save();return}if("fullscreen"===t)return this.eVm.toggleFullscreen(),void n();if("viewsource"===t)return this.eVm.isViewingSource.value=!1===this.eVm.isViewingSource.value,this.eVm.setContent(this.eVm.props.modelValue),void n()}document.execCommand(t,!1,o),n()}selectWord(e){if(null===e||!0!==e.isCollapsed||void 0===e.modify)return e;const t=document.createRange();t.setStart(e.anchorNode,e.anchorOffset),t.setEnd(e.focusNode,e.focusOffset);const o=t.collapsed?["backward","forward"]:["forward","backward"];t.detach();const n=e.focusNode,i=e.focusOffset;return e.collapse(e.anchorNode,e.anchorOffset),e.modify("move",o[0],"character"),e.modify("move",o[1],"word"),e.extend(n,i),e.modify("extend",o[1],"character"),e.modify("extend",o[0],"word"),e}}function O(e,t,o){t.handler?t.handler(e,o,o.caret):o.runCmd(t.cmd,t.param)}function N(e){return v("div",{class:"q-editor__toolbar-group"},e)}function V(e,t,o,n=!1){const i=n||"toggle"===t.type&&(t.toggled?t.toggled(e):t.cmd&&e.caret.is(t.cmd,t.param)),l=[];if(t.tip&&e.$q.platform.is.desktop){const e=t.key?v("div",[v("small",`(CTRL + ${String.fromCharCode(t.key)})`)]):null;l.push(v(d,{delay:1e3},()=>[v("div",{innerHTML:t.tip}),e]))}return v(r,{...e.buttonProps.value,icon:null!==t.icon?t.icon:void 0,color:i?t.toggleColor||e.props.toolbarToggleColor:t.color||e.props.toolbarColor,textColor:i&&!e.props.toolbarPush?null:t.textColor||e.props.toolbarTextColor,label:t.label,disable:!!t.disable&&("function"!=typeof t.disable||t.disable(e)),size:"sm",onClick(n){null==o||o(),O(n,t,e)}},()=>l)}function _(e){if(e.caret)return e.buttons.value.filter(t=>!e.isViewingSource.value||t.find(e=>"viewsource"===e.cmd)).map(o=>N(o.map(o=>(!e.isViewingSource.value||"viewsource"===o.cmd)&&("slot"===o.type?t(e.slots[o.slot]):"dropdown"===o.type?function(e,t){const o="only-icons"===t.list;let n,i,r=t.label,d=null!==t.icon?t.icon:void 0;function u(){m.component.proxy.hide()}if(o)i=t.options.map(t=>{const o=void 0===t.type&&e.caret.is(t.cmd,t.param);return o&&(r=t.tip,d=null!==t.icon?t.icon:void 0),V(e,t,u,o)}),n=e.toolbarBackgroundClass.value,i=[N(i)];else{const o=void 0!==e.props.toolbarToggleColor?`text-${e.props.toolbarToggleColor}`:null,c=void 0!==e.props.toolbarTextColor?`text-${e.props.toolbarTextColor}`:null,p="no-icons"===t.list;i=t.options.map(t=>{const n=!!t.disable&&t.disable(e),i=void 0===t.type&&e.caret.is(t.cmd,t.param);i&&(r=t.tip,d=null!==t.icon?t.icon:void 0);const m=t.htmlTip;return v(s,{active:i,activeClass:o,clickable:!0,disable:n,dense:!0,onClick(o){var n;u(),!0!==(null==o?void 0:o.qAvoidFocus)&&(null==(n=e.contentRef.value)||n.focus()),e.caret.restore(),O(o,t,e)}},()=>[!0===p?null:v(l,{class:i?o:c,side:!0},()=>v(a,{name:null!==t.icon?t.icon:void 0})),v(l,m?()=>v("div",{class:"text-no-wrap",innerHTML:t.htmlTip}):t.tip?()=>v("div",{class:"text-no-wrap"},t.tip):void 0)])}),n=[e.toolbarBackgroundClass.value,c]}const p=t.highlight&&r!==t.label,m=v(c,{...e.buttonProps.value,noCaps:!0,noWrap:!0,color:p?e.props.toolbarToggleColor:e.props.toolbarColor,textColor:p&&!e.props.toolbarPush?null:e.props.toolbarTextColor,label:t.fixedLabel?t.label:r,icon:t.fixedIcon?null!==t.icon?t.icon:void 0:d,contentClass:n,onShow:t=>e.emit("dropdownShow",t),onHide:t=>e.emit("dropdownHide",t),onBeforeShow:t=>e.emit("dropdownBeforeShow",t),onBeforeHide:t=>e.emit("dropdownBeforeHide",t)},()=>i);return m}(e,o):V(e,o)))))}const E=Object.prototype.toString,j=Object.prototype.hasOwnProperty,R=new Set(["Boolean","Number","String","Function","Array","Date","RegExp"].map(e=>"[object "+e+"]"));function F(e){if(e!==Object(e)||!0===R.has(E.call(e)))return!1;if(e.constructor&&!1===j.call(e,"constructor")&&!1===j.call(e.constructor.prototype,"isPrototypeOf"))return!1;let t;for(t in e);return void 0===t||j.call(e,t)}function A(){let e,t,o,n,i,r,l=arguments[0]||{},a=1,s=!1;const c=arguments.length;for("boolean"==typeof l&&(s=l,l=arguments[1]||{},a=2),Object(l)!==l&&"function"!=typeof l&&(l={}),c===a&&(l=this,a--);a<c;a++)if(null!==(e=arguments[a]))for(t in e)o=l[t],n=e[t],l!==n&&(!0===s&&n&&((i=Array.isArray(n))||!0===F(n))?(r=!0===i?!0===Array.isArray(o)?o:[]:!0===F(o)?o:{},l[t]=A(s,r,n)):void 0!==n&&(l[t]=n));return l}const U=u({name:"QEditor",props:{...p,...x,modelValue:{type:String,required:!0},readonly:Boolean,disable:Boolean,minHeight:{type:String,default:"10rem"},maxHeight:String,height:String,definitions:Object,fonts:Object,placeholder:String,toolbar:{type:Array,validator:e=>0===e.length||e.every(e=>e.length),default:()=>[["left","center","right","justify"],["bold","italic","underline","strike"],["undo","redo"]]},toolbarColor:String,toolbarBg:String,toolbarTextColor:String,toolbarToggleColor:{type:String,default:"primary"},toolbarOutline:Boolean,toolbarPush:Boolean,toolbarRounded:Boolean,paragraphTag:{type:String,validator:e=>["div","p"].includes(e),default:"div"},contentStyle:Object,contentClass:[Object,Array,String],square:Boolean,flat:Boolean,dense:Boolean},emits:[...z,"update:modelValue","keydown","click","focus","blur","dropdownShow","dropdownHide","dropdownBeforeShow","dropdownBeforeHide","linkShow","linkHide"],setup(e,{slots:t,emit:l}){const{proxy:a}=b(),{$q:s}=a,c=m(e,s),{inFullscreen:d,toggleFullscreen:u}=q(),p=h(),z=y(null),x=y(null),P=y(null),L=y(!1),H=k(()=>!e.readonly&&!e.disable);let B,O,V=e.modelValue;document.execCommand("defaultParagraphSeparator",!1,e.paragraphTag),B=window.getComputedStyle(document.body).fontFamily;const E=k(()=>e.toolbarBg?` bg-${e.toolbarBg}`:""),j=k(()=>({type:"a",flat:!0!==e.toolbarOutline&&!0!==e.toolbarPush,noWrap:!0,outline:e.toolbarOutline,push:e.toolbarPush,rounded:e.toolbarRounded,dense:!0,color:e.toolbarColor,disable:!H.value,size:"sm"})),R=k(()=>{const t=s.lang.editor,o=s.iconSet.editor;return{bold:{cmd:"bold",icon:o.bold,tip:t.bold,key:66},italic:{cmd:"italic",icon:o.italic,tip:t.italic,key:73},strike:{cmd:"strikeThrough",icon:o.strikethrough,tip:t.strikethrough,key:83},underline:{cmd:"underline",icon:o.underline,tip:t.underline,key:85},unordered:{cmd:"insertUnorderedList",icon:o.unorderedList,tip:t.unorderedList},ordered:{cmd:"insertOrderedList",icon:o.orderedList,tip:t.orderedList},subscript:{cmd:"subscript",icon:o.subscript,tip:t.subscript,htmlTip:"x<subscript>2</subscript>"},superscript:{cmd:"superscript",icon:o.superscript,tip:t.superscript,htmlTip:"x<superscript>2</superscript>"},link:{cmd:"link",disable:e=>e.caret&&!e.caret.can("link"),icon:o.hyperlink,tip:t.hyperlink,key:76},fullscreen:{cmd:"fullscreen",icon:o.toggleFullscreen,tip:t.toggleFullscreen,key:70},viewsource:{cmd:"viewsource",icon:o.viewSource,tip:t.viewSource},quote:{cmd:"formatBlock",param:"BLOCKQUOTE",icon:o.quote,tip:t.quote,key:81},left:{cmd:"justifyLeft",icon:o.left,tip:t.left},center:{cmd:"justifyCenter",icon:o.center,tip:t.center},right:{cmd:"justifyRight",icon:o.right,tip:t.right},justify:{cmd:"justifyFull",icon:o.justify,tip:t.justify},print:{type:"no-state",cmd:"print",icon:o.print,tip:t.print,key:80},outdent:{type:"no-state",disable:e=>e.caret&&!e.caret.can("outdent"),cmd:"outdent",icon:o.outdent,tip:t.outdent},indent:{type:"no-state",disable:e=>e.caret&&!e.caret.can("indent"),cmd:"indent",icon:o.indent,tip:t.indent},removeFormat:{type:"no-state",cmd:"removeFormat",icon:o.removeFormat,tip:t.removeFormat},hr:{type:"no-state",cmd:"insertHorizontalRule",icon:o.hr,tip:t.hr},undo:{type:"no-state",cmd:"undo",icon:o.undo,tip:t.undo,key:90},redo:{type:"no-state",cmd:"redo",icon:o.redo,tip:t.redo,key:89},h1:{cmd:"formatBlock",param:"H1",icon:o.heading1||o.heading,tip:t.heading1,htmlTip:`<h1 class="q-ma-none">${t.heading1}</h1>`},h2:{cmd:"formatBlock",param:"H2",icon:o.heading2||o.heading,tip:t.heading2,htmlTip:`<h2 class="q-ma-none">${t.heading2}</h2>`},h3:{cmd:"formatBlock",param:"H3",icon:o.heading3||o.heading,tip:t.heading3,htmlTip:`<h3 class="q-ma-none">${t.heading3}</h3>`},h4:{cmd:"formatBlock",param:"H4",icon:o.heading4||o.heading,tip:t.heading4,htmlTip:`<h4 class="q-ma-none">${t.heading4}</h4>`},h5:{cmd:"formatBlock",param:"H5",icon:o.heading5||o.heading,tip:t.heading5,htmlTip:`<h5 class="q-ma-none">${t.heading5}</h5>`},h6:{cmd:"formatBlock",param:"H6",icon:o.heading6||o.heading,tip:t.heading6,htmlTip:`<h6 class="q-ma-none">${t.heading6}</h6>`},p:{cmd:"formatBlock",param:e.paragraphTag,icon:o.heading,tip:t.paragraph},code:{cmd:"formatBlock",param:"PRE",icon:o.code,htmlTip:`<code>${t.code}</code>`},"size-1":{cmd:"fontSize",param:"1",icon:o.size1||o.size,tip:t.size1,htmlTip:`<font size="1">${t.size1}</font>`},"size-2":{cmd:"fontSize",param:"2",icon:o.size2||o.size,tip:t.size2,htmlTip:`<font size="2">${t.size2}</font>`},"size-3":{cmd:"fontSize",param:"3",icon:o.size3||o.size,tip:t.size3,htmlTip:`<font size="3">${t.size3}</font>`},"size-4":{cmd:"fontSize",param:"4",icon:o.size4||o.size,tip:t.size4,htmlTip:`<font size="4">${t.size4}</font>`},"size-5":{cmd:"fontSize",param:"5",icon:o.size5||o.size,tip:t.size5,htmlTip:`<font size="5">${t.size5}</font>`},"size-6":{cmd:"fontSize",param:"6",icon:o.size6||o.size,tip:t.size6,htmlTip:`<font size="6">${t.size6}</font>`},"size-7":{cmd:"fontSize",param:"7",icon:o.size7||o.size,tip:t.size7,htmlTip:`<font size="7">${t.size7}</font>`}}}),F=k(()=>{const t=e.definitions||{},o=e.definitions||e.fonts?A(!0,{},R.value,t,function(e,t,o,n={}){const i=Object.keys(n);if(0===i.length)return{};const r={default_font:{cmd:"fontName",param:e,icon:o,tip:t}};return i.forEach(e=>{const t=n[e];r[e]={cmd:"fontName",param:t,icon:o,tip:t,htmlTip:`<font face="${t}">${t}</font>`}}),r}(B,s.lang.editor.defaultFont,s.iconSet.editor.font,e.fonts)):R.value;return e.toolbar.map(e=>e.map(e=>{if(e.options)return{type:"dropdown",icon:e.icon,label:e.label,size:"sm",dense:!0,fixedLabel:e.fixedLabel,fixedIcon:e.fixedIcon,highlight:e.highlight,list:e.list,options:e.options.map(e=>o[e])};const n=o[e];return n?"no-state"===n.type||t[e]&&(void 0===n.cmd||R.value[n.cmd]&&"no-state"===R.value[n.cmd].type)?n:Object.assign({type:"toggle"},n):{type:"slot",slot:e}}))}),U={$q:s,props:e,slots:t,emit:l,inFullscreen:d,toggleFullscreen:u,runCmd:re,isViewingSource:L,editLinkUrl:P,toolbarBackgroundClass:E,buttonProps:j,contentRef:x,buttons:F,setContent:ie};C(()=>e.modelValue,e=>{V!==e&&(V=e,ie(e,!0))}),C(P,e=>{l("link"+(e?"Show":"Hide"))});const M=k(()=>e.toolbar&&0!==e.toolbar.length),I=k(()=>{const e={},t=t=>{t.key&&(e[t.key]={cmd:t.cmd,param:t.param})};return F.value.forEach(e=>{e.forEach(e=>{e.options?e.options.forEach(t):t(e)})}),e}),K=k(()=>d.value?e.contentStyle:[{minHeight:e.minHeight,height:e.height,maxHeight:e.maxHeight},e.contentStyle]),Q=k(()=>"q-editor q-editor--"+(!0===L.value?"source":"default")+(!0===e.disable?" disabled":"")+(!0===d.value?" fullscreen column":"")+(!0===e.square?" q-editor--square no-border-radius":"")+(!0===e.flat?" q-editor--flat":"")+(!0===e.dense?" q-editor--dense":"")+(!0===c.value?" q-editor--dark q-dark":"")),D=k(()=>[e.contentClass,"q-editor__content",{col:d.value,"overflow-auto":d.value||e.maxHeight}]),W=k(()=>!0===e.disable?{"aria-disabled":"true"}:{});function X(){if(null!==x.value){const t="inner"+(!0===L.value?"Text":"HTML"),o=x.value[t];o!==e.modelValue&&(V=o,l("update:modelValue",o))}}function Y(e){if(l("keydown",e),!0!==e.ctrlKey||!0===o(e))return void le();const t=e.keyCode,n=I.value[t];if(void 0!==n){const{cmd:t,param:o}=n;f(e),re(t,o,!1)}}function Z(e){le(),l("click",e)}function G(e){if(null!==x.value){const{scrollTop:e,scrollHeight:t}=x.value;O=t-e}U.caret.save(),l("blur",e)}function J(e){T(()=>{null!==x.value&&void 0!==O&&(x.value.scrollTop=x.value.scrollHeight-O)}),l("focus",e)}function ee(e){const t=z.value;if(null!==t&&!0===t.contains(e.target)&&(null===e.relatedTarget||!0!==t.contains(e.relatedTarget))){const e="inner"+(!0===L.value?"Text":"HTML");U.caret.restorePosition(x.value[e].length),le()}}function te(e){const t=z.value;null===t||!0!==t.contains(e.target)||null!==e.relatedTarget&&!0===t.contains(e.relatedTarget)||(U.caret.savePosition(),le())}function oe(){O=void 0}function ne(e){U.caret.save()}function ie(e,t){if(null!==x.value){!0===t&&U.caret.savePosition();const o="inner"+(!0===L.value?"Text":"HTML");x.value[o]=e,!0===t&&(U.caret.restorePosition(x.value[o].length),le())}}function re(e,t,o=!0){ae(),U.caret.restore(),U.caret.apply(e,t,()=>{ae(),U.caret.save(),o&&le()})}function le(){setTimeout(()=>{P.value=null,a.$forceUpdate()},1)}function ae(){g(()=>{var e;null==(e=x.value)||e.focus({preventScroll:!0})})}return w(()=>{U.caret=a.caret=new $(x.value,U),ie(e.modelValue),le(),document.addEventListener("selectionchange",ne)}),S(()=>{document.removeEventListener("selectionchange",ne)}),Object.assign(a,{runCmd:re,refreshToolbar:le,focus:ae,getContentEl:function(){return x.value}}),()=>{let t;if(M.value){const e=[v("div",{key:"qedt_top",class:"q-editor__toolbar row no-wrap scroll-x"+E.value},_(U))];null!==P.value&&e.push(v("div",{key:"qedt_btm",class:"q-editor__toolbar row no-wrap items-center scroll-x"+E.value},function(e){if(e.caret){const t=e.props.toolbarColor||e.props.toolbarTextColor;let l=e.editLinkUrl.value;const a=()=>{e.caret.restore(),l!==e.editLinkUrl.value&&document.execCommand("createLink",!1,""===l?" ":l),e.editLinkUrl.value=null};return[v("div",{class:`q-mx-xs text-${t}`},`${e.$q.lang.editor.url}: `),v("input",{key:"qedt_btm_input",class:"col q-editor__link-input",value:l,onInput:e=>{i(e),l=e.target.value},onKeydown:t=>{if(!0!==o(t))switch(t.keyCode){case 13:return n(t),a();case 27:n(t),e.caret.restore(),e.editLinkUrl.value&&"https://"!==e.editLinkUrl.value||document.execCommand("unlink"),e.editLinkUrl.value=null}}}),N([v(r,{key:"qedt_btm_rem",tabindex:-1,...e.buttonProps.value,label:e.$q.lang.label.remove,noCaps:!0,onClick:()=>{e.caret.restore(),document.execCommand("unlink"),e.editLinkUrl.value=null}}),v(r,{key:"qedt_btm_upd",...e.buttonProps.value,label:e.$q.lang.label.update,noCaps:!0,onClick:a})])]}}(U))),t=v("div",{key:"toolbar_ctainer",class:"q-editor__toolbars-container"},e)}return v("div",{ref:z,class:Q.value,style:{height:!0===d.value?"100%":null},...W.value,onFocusin:ee,onFocusout:te},[t,v("div",{ref:x,style:K.value,class:D.value,contenteditable:H.value,placeholder:e.placeholder,...p.listeners.value,onInput:X,onKeydown:Y,onClick:Z,onBlur:G,onFocus:J,onMousedown:oe,onTouchstartPassive:oe})])}}});export{U as Q};
