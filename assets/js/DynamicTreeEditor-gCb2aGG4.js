import e from"./TreeNode-DNwgJ1s0.js";import{f as a,o as t,_ as l,N as s,J as r,O as n,R as o,V as i,y as u,ac as d,W as c,F as v,Q as p,S as g,I as y,U as x}from"./vendor-BWKGNkNB.js";import{r as m}from"./app-4gpSDtVV.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";const b={class:"p-6 space-y-4"},f={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},h={class:"bg-white p-6 rounded-lg shadow-lg text-center"},w={class:"bg-white p-4 rounded shadow"},k={class:"flex flex-col md:flex-row md:items-center gap-4 mb-4"},C={class:"flex-grow"},N={key:0,class:"mb-4 bg-gray-50 p-3 rounded border"},T={key:0,class:"text-gray-500 italic"},j={key:1,class:"space-y-2 max-h-40 overflow-y-auto"},S=["onClick"],_={class:"text-xs text-gray-500"},E={class:"flex flex-wrap gap-2"},A={class:"mr-1"},L={class:"tree bg-white p-4 rounded shadow"},z={key:0,class:"text-center text-gray-500 py-10"},D={key:1,class:"relative"},F={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},I={class:"bg-white p-6 rounded-lg shadow-lg max-w-md w-full"},P={class:"text-lg font-medium mb-4"},R={class:"fixed bottom-4 right-4 z-50"},U={class:"flex items-center"},V={class:"mr-2"},$=m({__name:"DynamicTreeEditor",setup(m){const $=a([]),M=a("My Tree Structure"),O=a(!1),B=a(""),H=a(!1),J=a([]),Q=a(!1),W=a(1),q=a(null),G=a({visible:!1,y:0}),K=a(!1),X=a(""),Y=a(null),Z=a(null),ee=a([]);t(async()=>{await ae()});const ae=async()=>{ye(!0,"Loading tree data...");try{const e=await l.get("/api/tree-structures/latest");e.data?(M.value=e.data.name,$.value=e.data.tree_data,q.value=e.data.id,re(),xe("Tree loaded successfully","success")):te()}catch(e){console.error("Error loading tree data:",e),xe("Failed to load tree data. Starting with empty tree.","error"),te()}finally{ye(!1)}},te=()=>{$.value=[],W.value=1,q.value=null},le=()=>{ve("Create a new tree? Any unsaved changes will be lost.",()=>{M.value="New Tree Structure",$.value=[],W.value=1,q.value=null,xe("New tree created","info")})},se=async()=>{ye(!0,"Loading available trees...");try{const e=await l.get("/api/tree-structures");J.value=e.data,H.value=!0}catch(e){console.error("Error loading tree list:",e),xe("Failed to load tree list","error")}finally{ye(!1)}},re=()=>{let e=0;const a=t=>{for(const l of t)l.id>e&&(e=l.id),l.children&&l.children.length>0&&a(l.children)};a($.value),W.value=e+1},ne=()=>{$.value.push({id:W.value++,text:"",children:[],editing:!0,expanded:!0})},oe=async()=>{if(M.value.trim()){ye(!0,"Saving tree...");try{const e={name:M.value,tree_data:$.value};let a;q.value?a=await l.put(`/api/tree-structures/${q.value}`,e):(a=await l.post("/api/tree-structures",e),q.value=a.data.id),xe("Tree saved successfully","success")}catch(e){console.error("Error saving tree:",e),xe("Failed to save tree","error")}finally{ye(!1)}}else xe("Please enter a tree name","error")},ie=()=>{Q.value=!Q.value;const e=a=>{for(const t of a)t.expanded=Q.value,t.children&&t.children.length>0&&e(t.children)};e($.value)},ue=()=>{},de=e=>{G.value.visible=!0,G.value.y=e.y},ce=e=>{G.value.visible=!1;const{sourceParent:a,sourceIndex:t,targetParent:l,targetIndex:s}=e,[r]=a.splice(t,1);l.splice(s,0,r)},ve=(e,a,t=null)=>{X.value=e,Y.value=a,Z.value=t,K.value=!0},pe=()=>{K.value=!1,Y.value=null,Z.value=null},ge=()=>{Y.value&&(Z.value?Y.value(Z.value):Y.value()),K.value=!1,Y.value=null,Z.value=null},ye=(e,a="")=>{O.value=e,B.value=a},xe=(e,a="info")=>{const t={message:e,type:a};ee.value.push(t),setTimeout(()=>{const e=ee.value.indexOf(t);-1!==e&&ee.value.splice(e,1)},3e3)},me=e=>{if(!e)return"";const a=new Date(e);return a.toLocaleDateString()+" "+a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};return(a,t)=>(r(),s("div",b,[O.value?(r(),s("div",f,[o("div",h,[t[2]||(t[2]=o("svg",{class:"animate-spin h-10 w-10 text-blue-500 mx-auto mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[o("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),o("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),o("p",null,i(B.value),1)])])):n("",!0),o("div",w,[o("div",k,[o("div",C,[t[3]||(t[3]=o("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tree Name",-1)),u(o("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>M.value=e),type:"text",class:"border rounded p-2 w-full",placeholder:"Enter tree name"},null,512),[[d,M.value]])]),o("div",{class:"flex gap-2"},[o("button",{onClick:se,class:"bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded flex items-center"},t[4]||(t[4]=[o("span",{class:"mr-1"},"üìã",-1),c(" Load ")])),o("button",{onClick:le,class:"bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded flex items-center"},t[5]||(t[5]=[o("span",{class:"mr-1"},"üìù",-1),c(" New ")]))])]),H.value?(r(),s("div",N,[t[6]||(t[6]=o("h3",{class:"font-medium mb-2"},"Select a Tree",-1)),0===J.value.length?(r(),s("div",T,"No saved trees found")):(r(),s("div",j,[(r(!0),s(v,null,p(J.value,e=>(r(),s("div",{key:e.id,class:"flex justify-between items-center p-2 hover:bg-gray-100 rounded cursor-pointer",onClick:a=>(async e=>{ye(!0,"Loading selected tree..."),H.value=!1;try{const a=await l.get(`/api/tree-structures/${e}`);M.value=a.data.name,$.value=a.data.tree_data,q.value=a.data.id,re(),xe("Tree loaded successfully","success")}catch(a){console.error("Error loading tree:",a),xe("Failed to load tree","error")}finally{ye(!1)}})(e.id)},[o("span",null,i(e.name),1),o("span",_,i(me(e.updated_at)),1)],8,S))),128))])),o("button",{onClick:t[1]||(t[1]=e=>H.value=!1),class:"mt-2 text-sm text-gray-500"},"Cancel")])):n("",!0)]),o("div",E,[o("button",{onClick:ne,class:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded flex items-center"},t[7]||(t[7]=[o("span",{class:"mr-1"},"‚ûï",-1),c(" Add Root Node ")])),o("button",{onClick:oe,class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded flex items-center"},t[8]||(t[8]=[o("span",{class:"mr-1"},"üíæ",-1),c(" Save Tree ")])),o("button",{onClick:ie,class:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded flex items-center"},[o("span",A,i(Q.value?"üîº":"üîΩ"),1),c(" "+i(Q.value?"Collapse All":"Expand All"),1)])]),o("div",L,[0===$.value.length?(r(),s("div",z,t[9]||(t[9]=[o("p",{class:"text-xl mb-2"},"No nodes yet",-1),o("p",null,'Click "Add Root Node" to start building your tree',-1)]))):(r(),s("div",D,[G.value.visible?(r(),s("div",{key:0,class:"absolute h-0.5 bg-blue-500 transition-all",style:g({left:"0",right:"0",top:`${G.value.y}px`})},null,4)):n("",!0),(r(!0),s(v,null,p($.value,(a,t)=>(r(),y(e,{key:a.id,node:a,parent:$.value,index:t,"expand-all":Q.value,onUpdate:ue,onNodeDrag:de,onNodeDrop:ce},null,8,["node","parent","index","expand-all"]))),128))]))]),K.value?(r(),s("div",F,[o("div",I,[o("h3",P,i(X.value),1),o("div",{class:"flex justify-end gap-2"},[o("button",{onClick:pe,class:"px-4 py-2 border rounded hover:bg-gray-100"},"Cancel"),o("button",{onClick:ge,class:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"},"Confirm")])])])):n("",!0),o("div",R,[(r(!0),s(v,null,p(ee.value,(e,a)=>(r(),s("div",{key:a,class:x(["mb-2 p-3 rounded shadow-lg max-w-xs transform transition-all duration-300",["success"===e.type?"bg-green-500 text-white":"error"===e.type?"bg-red-500 text-white":"bg-blue-500 text-white"]])},[o("div",U,[o("span",V,i("success"===e.type?"‚úÖ":"error"===e.type?"‚ùå":"‚ÑπÔ∏è"),1),o("span",null,i(e.message),1)])],2))),128))])]))}},[["__scopeId","data-v-c066e076"]]);export{$ as default};
