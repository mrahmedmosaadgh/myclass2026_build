import{u as e,C as a,n as l,e as s,d as t,Q as r,a as o,b as n,aD as d}from"./app-BzjXrVp9.js";import{Q as i}from"./QSpinnerDots-CsCCDASU.js";import{Q as c}from"./QSpace-qzKo_-If.js";import{Q as u}from"./QTd-DUSBgVC_.js";import{Q as m}from"./QTable-BcXT6C-J.js";import{f as p,a as y,k as v,o as w,L as b,I as f,b as h,H as k,J as _,M as g,U as x,y as j,V as P,F as Q,Q as T,x as q,Z as M}from"./vendor-EI0FRBVb.js";import L from"./CompletionProgressBar-C26777Bn.js";import N from"./StatusBadge-D6cZlTBs.js";import{u as S}from"./useWeeklyPlansStore-DMDsUO--.js";import{u as D}from"./i18n-BbKXhR_S.js";import"./offline-BzIlwqNM.js";import"./ui-B__oX9pK.js";import"./QMarkupTable-_1wJRVO3.js";import"./QSelect-CciNNEfD.js";import"./rtl-Cr6c3OOr.js";import"./QLinearProgress-L5RdawR6.js";import"./use-fullscreen-BnDnBhbA.js";import"./schoolData-BnE_O2cp.js";const H={class:"q-pa-md"},I={class:"row items-center justify-between"},V={class:"text-subtitle1 text-grey-8"},C={class:"row q-gutter-sm"},z={key:0,class:"row justify-center q-pa-xl"},U={class:"text-h6 text-grey-7 q-mt-md"},W={class:"text-grey-6"},A={key:2,class:"q-gutter-md"},B={class:"text-h6"},E=["innerHTML"],F=["innerHTML"],Y={__name:"WeeklyPlanStats",setup(Y,{expose:Z}){const{t:$}=D(),J=S();e();const O=p([]),R=p([]),G=p(!1),K=p({rowsPerPage:50}),X=p(!1),ee=p(null),ae=y(()=>"ar"===$("code")?"right":"left"),le=y(()=>[{name:"day",label:$("weeklyPlans.day"),field:e=>{var a;return null==(a=e.schedule)?void 0:a.day},format:e=>te(e),sortable:!0,align:ae.value},{name:"period",label:$("weeklyPlans.period"),field:e=>{var a;return null==(a=e.schedule)?void 0:a.period_number},sortable:!0,align:"center"},{name:"subject",label:$("weeklyPlans.subject"),field:e=>{var a,l;return null==(l=null==(a=e.schedule)?void 0:a.cst)?void 0:l.subject_name},sortable:!0,align:ae.value},{name:"classroom",label:$("weeklyPlans.classroom"),field:e=>{var a,l;return null==(l=null==(a=e.schedule)?void 0:a.cst)?void 0:l.classroom_name},sortable:!0,align:ae.value},{name:"status",label:$("weeklyPlans.status"),field:"status",sortable:!0,align:"center"},{name:"cw",label:$("weeklyPlans.classwork"),field:"cw",sortable:!0,align:ae.value},{name:"hw",label:$("weeklyPlans.homework"),field:"hw",sortable:!0,align:ae.value}]),se=y(()=>({completed:O.value.reduce((e,a)=>e+(a.completed||0),0),partial:O.value.reduce((e,a)=>e+(a.partial||0),0),empty:O.value.reduce((e,a)=>e+(a.empty||0),0)})),te=e=>$(`weeklyPlans.shortDays.${e}`)||e,re=async()=>{if(J.selectedCopyId){G.value=!0;try{const e=await M.get("/weekly-system/api/weekly-plans/teacher-stats",{params:{week_number:J.weekNumber,academic_year_id:J.selectedAcademicYearId,semester_number:J.semesterNumber}});O.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching stats:",e),O.value=[]}finally{G.value=!1}}},oe=async e=>{ee.value=e,X.value=!0;try{const a=await M.get("/weekly-system/api/weekly-plans",{params:{teacher_id:e.teacher_id,week_number:J.weekNumber,academic_year_id:J.selectedAcademicYearId,semester_number:J.semesterNumber}});R.value=(a.data.data||a.data||[]).map(e=>({...e,status:ne(e)}))}catch(a){console.error("Error fetching teacher plans:",a)}},ne=e=>{var a,l;const s=!!(null==(a=e.cw)?void 0:a.trim()),t=!!(null==(l=e.hw)?void 0:l.trim());return s||t?s&&t?"completed":"partial":"empty"};return v(()=>[J.selectedCopyId,J.weekNumber,J.semesterNumber],()=>{re()},{deep:!0}),w(()=>{re()}),Z({refresh:re}),(e,p)=>(f(),b("div",H,[h(l,{flat:"",bordered:"",class:"q-pa-md q-mb-lg"},{default:_(()=>[g("div",I,[g("div",V,x(j($)("weeklyPlans.progressOverview")),1),g("div",C,[h(a,{dense:"",color:"green-2","text-color":"green-9",icon:"check_circle"},{default:_(()=>[P(x(se.value.completed)+" "+x(j($)("weeklyPlans.completed")),1)]),_:1}),h(a,{dense:"",color:"amber-2","text-color":"amber-9",icon:"timelapse"},{default:_(()=>[P(x(se.value.partial)+" "+x(j($)("weeklyPlans.partial")),1)]),_:1}),h(a,{dense:"",color:"red-1","text-color":"red-8",icon:"hourglass_empty"},{default:_(()=>[P(x(se.value.empty)+" "+x(j($)("weeklyPlans.empty")),1)]),_:1})])])]),_:1}),G.value?(f(),b("div",z,[h(i,{size:"50px",color:"primary"})])):O.value.length?(f(),b("div",A,[(f(!0),b(Q,null,T(O.value,e=>(f(),k(L,{key:e.teacher_id,teacher:e,onView:oe},null,8,["teacher"]))),128))])):(f(),k(l,{key:1,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:_(()=>[h(s,{name:"playlist_add",size:"64px",color:"grey-5"}),g("p",U,x(j($)("weeklyPlans.noTeacherData")),1),g("p",W,x(j($)("weeklyPlans.generateFirst")),1)]),_:1})),h(n,{modelValue:X.value,"onUpdate:modelValue":p[1]||(p[1]=e=>X.value=e),maximized:""},{default:_(()=>[h(l,null,{default:_(()=>[h(t,{class:"row items-center"},{default:_(()=>{var e;return[g("div",B,x(j($)("weeklyPlans.teacherWeeklyPlans",{name:null==(e=ee.value)?void 0:e.teacher_name})),1),h(c),q(h(r,{icon:"close",flat:"",round:"",dense:""},null,512),[[d]])]}),_:1}),h(o),h(t,{class:"scroll",style:{"max-height":"80vh"}},{default:_(()=>[h(m,{pagination:K.value,"onUpdate:pagination":p[0]||(p[0]=e=>K.value=e),rows:R.value,columns:le.value,"row-key":"id",dense:"",flat:"",bordered:""},{"body-cell-status":_(e=>[h(u,{props:e},{default:_(()=>[h(N,{status:e.row.status},null,8,["status"])]),_:2},1032,["props"])]),"body-cell-cw":_(e=>[h(u,{props:e},{default:_(()=>[g("div",{innerHTML:e.row.cw||"-",class:"text-caption",style:{"max-width":"200px",overflow:"hidden"}},null,8,E)]),_:2},1032,["props"])]),"body-cell-hw":_(e=>[h(u,{props:e},{default:_(()=>[g("div",{innerHTML:e.row.hw||"-",class:"text-caption",style:{"max-width":"200px",overflow:"hidden"}},null,8,F)]),_:2},1032,["props"])]),_:1},8,["pagination","rows","columns"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Y as default};
