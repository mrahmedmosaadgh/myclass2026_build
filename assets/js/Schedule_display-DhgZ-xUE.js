import{r as e,u as l,Q as a,b as o,h as s,d as t,f as r,o as n,aS as d,e as i}from"./app-DlLesFGi.js";import{Q as u}from"./QTd-BU_S4ffH.js";import{Q as c}from"./QSelect-BTh0khse.js";import{Q as v}from"./QTable-BIAJAIui.js";import{f as p,a as m,k as f,N as b,O as y,J as g,b as h,K as w,R as _,F as C,z as k,V as j,W as V,y as q,_ as S}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";import"./QMarkupTable-CzIo4GGA.js";import"./QLinearProgress-CX6G9yBK.js";import"./use-fullscreen-BQHoXYBI.js";const P={key:0,class:"mt-4"},I={class:"row full-width q-col-gutter-md"},Q={class:"col-12 col-md-6"},U={class:"col-12 col-md-6 flex justify-end items-center"},x={class:"edit-actions q-mt-sm"},L=["onClick"],T={class:"edit-actions q-mt-sm"},A=["onClick"],F={class:"full-width row flex-center q-gutter-sm"},$={class:"text-negative"},D=e({__name:"Schedule_display",props:{schoolId:{type:Number,required:!0},scheduleCopyId:{type:Number,required:!0}},setup(e){const D=l(),E=e,N=[{name:"id",label:"ID",field:"id",align:"left",sortable:!0},{name:"classroom",label:"Classroom",field:e=>{var l,a;return null==(a=null==(l=e.cst)?void 0:l.classroom)?void 0:a.name},align:"left",sortable:!0},{name:"subject",label:"Subject",field:e=>{var l,a;return null==(a=null==(l=e.cst)?void 0:l.subject)?void 0:a.name},align:"left",sortable:!0},{name:"teacher",label:"Teacher",field:e=>{var l,a;return null==(a=null==(l=e.cst)?void 0:l.teacher)?void 0:a.name},align:"left",sortable:!0},{name:"period_number",label:"Period",field:"period_number",align:"center",sortable:!0},{name:"day",label:"Day",field:"day",align:"center",sortable:!0},{name:"active",label:"Active",field:"active",align:"center",sortable:!0}],B=p({sortBy:"period_number",descending:!1,page:1,rowsPerPage:10}),R=p(E.schoolId),W=p([]),z=p(!1),K=p(!1),M=p(""),O=p(""),J=p(null),X=p(""),Y=p(""),G=p(!1),H=p(null),Z=e=>["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"][e-1]||`Day ${e}`,ee=Array.from({length:10},(e,l)=>({label:`Period ${l+1}`,value:l+1})),le=Array.from({length:5},(e,l)=>({label:Z(l+1),value:l+1})),ae=(e,l,a)=>{J.value=e,X.value=l,Y.value=a},oe=()=>{J.value=null,X.value=""},se=e=>{H.value=e,G.value=!0},te=async e=>{var l,a;try{z.value=!0,await S.post(`/admin/schedules/update/${e.id}`,{[X.value]:Y.value}),e[X.value]=Y.value,D.notify({type:"positive",message:"Schedule updated successfully"})}catch(o){D.notify({type:"negative",message:(null==(a=null==(l=o.response)?void 0:l.data)?void 0:a.message)||"Failed to update schedule"}),console.error("Error updating schedule:",o)}finally{J.value=null,X.value="",G.value=!1,z.value=!1}},re=m(()=>{let e=[...W.value];if(O.value){const l=O.value.toLowerCase();e=e.filter(e=>{var a,o,s,t,r,n;return((null==(o=null==(a=e.cst)?void 0:a.classroom)?void 0:o.name)||"").toLowerCase().includes(l)||((null==(t=null==(s=e.cst)?void 0:s.subject)?void 0:t.name)||"").toLowerCase().includes(l)||((null==(n=null==(r=e.cst)?void 0:r.teacher)?void 0:n.name)||"").toLowerCase().includes(l)||String(e.period_number).includes(l)||Z(e.day).toLowerCase().includes(l)})}return e}),ne=async()=>{var e,l;try{z.value=!0;const e=await S.get(`/admin/schedules/${E.schoolId}/${E.scheduleCopyId}`);W.value=e.data}catch(a){M.value=(null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||"Failed to fetch schedule data",K.value=!0,console.error("Error fetching schedule data:",a)}finally{z.value=!1}},de=()=>{B.value.page=1},ie=e=>{B.value.page=e.pagination.page,B.value.rowsPerPage=e.pagination.rowsPerPage,B.value.sortBy=e.pagination.sortBy,B.value.descending=e.pagination.descending};return f(()=>E.scheduleCopyId,ne,{immediate:!0}),(l,p)=>R.value&&e.scheduleCopyId?(g(),b("div",P,[h(v,{title:"Schedule Entries",rows:re.value,columns:N,"row-key":"id",loading:z.value,pagination:B.value,"rows-per-page-options":[10,20,50],flat:"",bordered:"",dense:"",onRequest:ie},{top:w(()=>[_("div",I,[_("div",Q,[h(s,{modelValue:O.value,"onUpdate:modelValue":[p[0]||(p[0]=e=>O.value=e),de],dense:"",outlined:"",placeholder:"Search...",class:"q-mb-md"},{append:w(()=>[h(a,{name:"search"})]),_:1},8,["modelValue"])]),_("div",U,[h(o,{color:"primary",icon:"refresh",onClick:ne,loading:z.value,label:"Refresh",class:"q-ml-md"},null,8,["loading"])])])]),"body-cell-classroom":w(e=>[h(u,{props:e},{default:w(()=>{var l,a;return[V(j((null==(a=null==(l=e.row.cst)?void 0:l.classroom)?void 0:a.name)||"-"),1)]}),_:2},1032,["props"])]),"body-cell-subject":w(e=>[h(u,{props:e},{default:w(()=>{var l,a;return[V(j((null==(a=null==(l=e.row.cst)?void 0:l.subject)?void 0:a.name)||"-"),1)]}),_:2},1032,["props"])]),"body-cell-teacher":w(e=>[h(u,{props:e},{default:w(()=>{var l,a;return[V(j((null==(a=null==(l=e.row.cst)?void 0:l.teacher)?void 0:a.name)||"-"),1)]}),_:2},1032,["props"])]),"body-cell-period_number":w(e=>[h(u,{props:e,class:"editable-cell"},{default:w(()=>[J.value===e.row.id&&"period_number"===X.value?(g(),b(C,{key:0},[h(c,{modelValue:Y.value,"onUpdate:modelValue":[p[1]||(p[1]=e=>Y.value=e),l=>se(e.row)],options:k(ee),"option-value":"value","option-label":"label","emit-value":"","map-options":"",dense:"",outlined:"",class:"edit-select",rules:[e=>!!e||"Period is required"]},null,8,["modelValue","options","onUpdate:modelValue","rules"]),_("div",x,[h(o,{flat:"",dense:"",color:"positive",icon:"check",onClick:l=>te(e.row)},null,8,["onClick"]),h(o,{flat:"",dense:"",color:"negative",icon:"close",onClick:oe})])],64)):(g(),b("div",{key:1,class:"editable-content",onClick:l=>ae(e.row.id,"period_number",e.row.period_number)},j(e.row.period_number),9,L))]),_:2},1032,["props"])]),"body-cell-day":w(e=>[h(u,{props:e,class:"editable-cell"},{default:w(()=>[J.value===e.row.id&&"day"===X.value?(g(),b(C,{key:0},[h(c,{modelValue:Y.value,"onUpdate:modelValue":[p[2]||(p[2]=e=>Y.value=e),l=>se(e.row)],options:k(le),"option-value":"value","option-label":"label","emit-value":"","map-options":"",dense:"",outlined:"",class:"edit-select",rules:[e=>!!e||"Day is required"]},null,8,["modelValue","options","onUpdate:modelValue","rules"]),_("div",T,[h(o,{flat:"",dense:"",color:"positive",icon:"check",onClick:l=>te(e.row)},null,8,["onClick"]),h(o,{flat:"",dense:"",color:"negative",icon:"close",onClick:oe})])],64)):(g(),b("div",{key:1,class:"editable-content",onClick:l=>ae(e.row.id,"day",e.row.day)},j(Z(e.row.day)),9,A))]),_:2},1032,["props"])]),"body-cell-active":w(e=>[h(u,{props:e},{default:w(()=>[h(a,{name:e.row.active?"check_circle":"cancel",color:e.row.active?"positive":"negative"},null,8,["name","color"])]),_:2},1032,["props"])]),"no-data":w(()=>[_("div",F,[h(a,{size:"2em",name:"sentiment_dissatisfied"}),p[6]||(p[6]=_("span",null,"No matching records found",-1))])]),_:1},8,["rows","loading","pagination"]),h(i,{modelValue:K.value,"onUpdate:modelValue":p[3]||(p[3]=e=>K.value=e)},{default:w(()=>[h(t,null,{default:w(()=>[h(r,null,{default:w(()=>[p[7]||(p[7]=_("div",{class:"text-h6"},"Error",-1)),_("div",$,j(M.value),1)]),_:1}),h(n,{align:"right"},{default:w(()=>[q(h(o,{flat:"",label:"OK",color:"primary"},null,512),[[d]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),h(i,{modelValue:G.value,"onUpdate:modelValue":p[5]||(p[5]=e=>G.value=e)},{default:w(()=>[h(t,null,{default:w(()=>[h(r,null,{default:w(()=>p[8]||(p[8]=[_("div",{class:"text-h6"},"Confirm Changes",-1),_("div",{class:"text-body1"},"Are you sure you want to save the changes?",-1)])),_:1}),h(n,{align:"right"},{default:w(()=>[q(h(o,{flat:"",label:"Cancel",color:"negative"},null,512),[[d]]),h(o,{flat:"",label:"Save",color:"positive",onClick:p[4]||(p[4]=e=>te(H.value))})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):y("",!0)}},[["__scopeId","data-v-1b4c281b"]]);export{D as default};
