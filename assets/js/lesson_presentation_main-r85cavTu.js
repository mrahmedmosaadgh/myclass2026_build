import{u as e}from"./presentationStore-Dx8RFDSw.js";import t from"./CanvasEditor-DjSsVt8_.js";import o from"./PresentationMode-CnZPk0wQ.js";import n from"./TopBar-Brs35UEU.js";import{l}from"./ui-BP0GJNn5.js";import{_ as s}from"./LucideIcon-kaM68_Rv.js";import{p as a}from"./app-BXm70mdJ.js";import{f as r,a as i,k as c,L as d,I as u,b as v,M as p,H as g,O as m,F as y,Q as h,S as f,U as b,x as w,ab as S,$ as x}from"./vendor-DNM7Y6Xn.js";import"./ElementContent-Cm8ErG2R.js";import"./youtube_VideoPlayer-B5-P2tD_.js";import"./offline-BzIlwqNM.js";import"./i18n-CBOKL2HS.js";import"./VideoPlayer-CbKuKDFh.js";import"./text_el-29ggcNfv.js";import"./createLucideIcon-DNsKNLPq.js";import"./align-right-BV65b6MB.js";import"./underline-BaO36zfI.js";import"./image-D9BEVhOC.js";import"./printer-DEjU2fo9.js";import"./Dropdown8-Byj5JDZm.js";const j={class:"presentation-layout"},k={class:"main-content"},C={class:"slides-panel"},E={class:"slides-controls"},I={class:"slides-list"},L=["onClick"],_={class:"slide-preview"},P={class:"slide-number"},A={class:"thumbnail-content"},D=["onUpdate:modelValue"],F={class:"slide-actions"},O=["onClick"],T=["onClick"],U={class:"editor-area"},N={class:"canvas-container"},R=a({__name:"lesson_presentation_main",setup(a){const R=e(),M=r(!1),$=r(!1),V=i(()=>R.slides),z=i(()=>R.currentSlideIndex),J=i(()=>R.currentSlide),B=({x:e,y:t,type:o})=>{if(V.value&&0!==V.value.length||(R.addSlide(),l.info("Created first slide")),!J.value||!J.value.content)return console.warn("No current slide or invalid slide content"),void l.warning("Please select a slide first");const n={id:Date.now(),type:o,x:Math.max(0,e-100),y:Math.max(0,t-50),width:"auto",height:"auto",content:"text"===o?"New Text":"",visible:!0,locked:!1,style:{fontSize:"16px",fontFamily:"Arial",color:"#000000",backgroundColor:"white",padding:"12px",borderRadius:"4px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",border:"1px solid #e2e8f0",display:"text"===o?"inline-block":"block",width:"text"===o?"auto":"320px",minWidth:"text"===o?"50px":"320px"}};try{R.addElement(n),console.log("Added new element:",n)}catch(s){console.error("Failed to add element:",s),l.error("Failed to add element")}},q=()=>{try{R.toggleAllElements()}catch(e){console.error("Failed to toggle elements:",e),l.error("Failed to toggle elements")}},Q=e=>{try{R.setZoomLevel(e)}catch(t){console.error("Failed to change zoom:",t),l.error("Failed to change zoom level")}},Z=e=>{},H=i({get:()=>R.presentationTitle,set:e=>R.setTitle(e)}),W=()=>{R.addSlide(),l.success("New slide added",{position:"bottom-right",autoClose:2e3})},X=e=>{R.updateSlideContent(e)},Y=()=>{if(console.log("Current slides:",V.value),!V.value||!Array.isArray(V.value))throw console.error("Slides is not an array:",V.value),new Error("Invalid slides data structure");0===V.value.length&&(console.warn("No slides to save, creating a default slide"),V.value.push({id:Date.now(),title:"",content:{elements:[],backgroundImage:""}}));const e=V.value.map((e,t)=>(console.log(`Processing slide ${t}:`,e),e.content?{id:e.id||Date.now()+t,title:e.title||"",content:{elements:Array.isArray(e.content.elements)?e.content.elements:[],backgroundImage:e.content.backgroundImage||""}}:(console.warn(`Slide ${t} missing content, creating default structure`),{id:e.id||Date.now()+t,title:e.title||"",content:{elements:[],backgroundImage:""}})));return console.log(`Prepared ${e.length} slides for saving`),{title:H.value||"Untitled Presentation",slides:e,version:"2.0",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),slideCount:e.length}};0===V.value.length&&W();const G=i(()=>R.isPresentationMode),K=()=>{try{R.setPresentationMode(!0),console.log("Starting presentation mode")}catch(e){console.error("Error starting presentation:",e),l.error("Failed to start presentation")}},ee=()=>{try{R.setPresentationMode(!1),console.log("Exiting presentation mode")}catch(e){console.error("Error exiting presentation:",e),l.error("Failed to exit presentation")}},te=()=>{console.log("Saving slides, count:",V.value.length)};c(V,e=>{console.log("Slides changed. New count:",e.length)},{deep:!0}),c(V,e=>{z.value>=e.length&&(z.value=Math.max(0,e.length-1))});const oe=()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=e=>{const t=e.target.files[0];if(!t)return;const o=new FileReader;o.onload=e=>{try{const t=JSON.parse(e.target.result);if(console.log("Parsed presentation data:",t),!t.slides||!Array.isArray(t.slides))throw new Error("Invalid presentation format");R.loadPresentation(t),l.success(`Successfully loaded presentation with ${t.slides.length} slides`)}catch(t){console.error("Error loading presentation:",t),l.error("Error loading presentation: "+t.message)}},o.onerror=()=>{l.error("Error reading file")},o.readAsText(t)},e.click()},ne=r(!1),le=r(!1),se=r(""),ae=r(""),re=async()=>{try{if($.value)return;if($.value=!0,!se.value)return console.log("No previous save path, redirecting to saveAs"),$.value=!1,ie();console.log("Quick saving to:",se.value);const e=Y(),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),o=URL.createObjectURL(t);setTimeout(()=>{const e=document.createElement("a");e.href=o,e.download=se.value,e.style.display="none",document.body.appendChild(e);try{e.click(),console.log("Download triggered successfully")}catch(t){console.error("Error triggering download:",t),l.error("Failed to trigger download"),$.value=!1}setTimeout(()=>{document.body.removeChild(e),URL.revokeObjectURL(o),$.value=!1;const t=document.querySelector(".title-input");t&&(t.classList.add("save-success"),setTimeout(()=>t.classList.remove("save-success"),500)),l.success("Presentation saved successfully",{icon:"ðŸ’¾",position:"bottom-right",autoClose:2e3})},100)},100),ne.value=!1,le.value=!1}catch(e){console.error("Error saving presentation:",e),l.error("Error saving presentation: "+e.message),$.value=!1}},ie=async()=>{try{if($.value)return;$.value=!0;const e=prompt("Enter file name:",H.value||"presentation");if(!e)return console.log("Save As cancelled - no filename provided"),void($.value=!1);console.log("Saving as new file:",e);const t=Y(),o=(new Date).toISOString().slice(0,19).replace(/[:]/g,"-"),n=`${e}_${o}.json`,s=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=URL.createObjectURL(s);setTimeout(()=>{const t=document.createElement("a");t.href=a,t.download=n,t.style.display="none",document.body.appendChild(t);try{t.click(),console.log("Download triggered successfully for:",n)}catch(o){console.error("Error triggering download:",o),l.error("Failed to trigger download"),$.value=!1}setTimeout(()=>{document.body.removeChild(t),URL.revokeObjectURL(a),$.value=!1,ae.value=e,se.value=n,H.value=e;const o=document.querySelector(".title-input");o&&(o.classList.add("save-success"),setTimeout(()=>o.classList.remove("save-success"),500)),l.success('Presentation saved as "'+e+'"',{icon:"ðŸ“„",position:"bottom-right",autoClose:3e3})},100)},100),ne.value=!1,le.value=!1}catch(e){console.error("Error saving presentation:",e),l.error("Error saving presentation: "+e.message),$.value=!1}},ce=({x:e,y:t,currentElementType:o})=>{M.value||B({x:e,y:t,type:o||"text"})};return(e,a)=>(u(),d("div",j,[v(n,{readonly:M.value,isSaving:$.value,onQuickSave:re,onSaveAs:ie,onStartPresentation:K,onLoad_all_slides_to_file:oe,onAddElement:B,onToggleElements:q,onZoomChange:Q,onBackgroundChange:Z},null,8,["readonly","isSaving"]),p("div",k,[p("div",C,[p("div",E,[p("button",{onClick:W,class:"action-btn add-btn"},[v(s,{name:"plus",size:"18"}),a[1]||(a[1]=p("span",null,"New Slide",-1))])]),p("div",I,[(u(!0),d(y,null,h(V.value,(e,t)=>(u(),d("div",{key:t,class:f(["slide-thumbnail",{active:t===z.value}]),onClick:e=>(e=>{R.setCurrentSlideIndex(e)})(t)},[p("div",_,[p("div",P,b(t+1),1),p("div",A,[w(p("input",{type:"text","onUpdate:modelValue":t=>e.title=t,class:"border-0"},null,8,D),[[S,e.title]])])]),p("div",F,[p("button",{onClick:x(e=>(e=>{var t;const o=V.value[e],n={id:Date.now(),title:null==(t=V.value[e])?void 0:t.title,content:JSON.parse(JSON.stringify(o.content))};V.value.splice(e+1,0,n),z.value=e+1,l.success("Slide duplicated",{position:"bottom-right",autoClose:2e3}),te()})(t),["stop"]),class:"duplicate-btn",title:"Duplicate slide"},[v(s,{name:"copy",size:"16"})],8,O),p("button",{onClick:x(e=>(e=>{V.value.length>1?(V.value.splice(e,1),z.value>=V.value.length&&(z.value=V.value.length-1),te()):l.error("Cannot delete the only slide",{position:"bottom-right",autoClose:2e3})})(t),["stop"]),class:"delete-btn",title:"Delete slide"},[v(s,{name:"trash-2",size:"16"})],8,T)])],10,L))),128))])]),p("div",U,[p("div",N,[J.value?(u(),g(t,{key:z.value,modelValue:J.value.content,"onUpdate:modelValue":[a[0]||(a[0]=e=>J.value.content=e),X],onCanvasClick:ce},null,8,["modelValue"])):m("",!0)])])]),G.value?(u(),g(o,{key:0,slides:V.value,initialIndex:z.value,onExit:ee},null,8,["slides","initialIndex"])):m("",!0)]))}},[["__scopeId","data-v-c83f7c5a"]]);export{R as default};
