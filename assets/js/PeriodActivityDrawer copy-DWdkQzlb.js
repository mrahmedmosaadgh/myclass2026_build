import{o as e,u as a,c as l,Q as o,B as t,aE as d,m as s,k as r,bp as i,f as n,a as u,b as c}from"./app-C-NJhdpe.js";import{Q as m}from"./QSelect-B3f0Rrq3.js";import{Q as v}from"./QTab-C_vkYR0k.js";import{Q as p}from"./QTabs-C8Sz98qV.js";import{Q as _}from"./QTabPanel-zhJc0Joi.js";import{Q as y}from"./QTabPanels-bY91sdlT.js";import{Z as f,a as b,f as g,k as h,H as V,I as k,J as w,b as D,M as U,U as x,L as q,O as j,F as S,Q as N,N as P}from"./vendor-CUZ9QTQV.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";import"./rtl-Cr6c3OOr.js";import"./use-panel-CGzbevm7.js";import"./use-render-cache-CmTcazfP.js";const A={class:"row items-center"},E={class:"col"},Q={class:"text-h6"},C={class:"text-subtitle2"},M={class:"col-auto"},T={key:0,class:"q-pa-lg flex flex-center"},$={key:1},L={key:0,class:"q-pa-md"},F={key:1},I={key:0,class:"q-pa-md flex flex-center"},O={key:1,class:"text-center q-pa-md"},z={key:2},B={class:"row items-center q-gutter-md"},R={class:"col-3"},H={class:"col"},J={key:0,class:"col-2"},K={class:"row items-center q-gutter-md"},X={class:"col-3"},Z={class:"col-3"},G={class:"col-3"},W={class:"row items-center q-gutter-md"},Y={class:"col-3"},ee={class:"col-2"},ae={class:"col-2"},le={class:"col-5"},oe={class:"row items-center q-gutter-md"},te={class:"col-3"},de={class:"col-2"},se={class:"col-7"},re={class:"q-pa-md"},ie=e({__name:"PeriodActivityDrawer copy",props:{modelValue:Boolean,periodData:Object,calendarDate:String},emits:["update:modelValue"],setup(e,{emit:ie}){var ne;f.defaults.headers.common["X-CSRF-TOKEN"]=null==(ne=document.querySelector('meta[name="csrf-token"]'))?void 0:ne.getAttribute("content"),f.defaults.withCredentials=!0;const ue=a(),ce=e,me=ie,ve=b({get:()=>ce.modelValue,set:e=>{me("update:modelValue",e)}}),pe=g(!1),_e=g(!1),ye=g(!1),fe=g(null),be=g([]),ge=g([]),he=g("attendance"),Ve=[{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"},{label:"Modified",value:"modified"},{label:"Event Affected",value:"event_affected"}],ke=[{label:"Present",value:"present"},{label:"Absent",value:"absent"},{label:"Late",value:"late"},{label:"Excused",value:"excused"}],we=g([]),De=async()=>{var e,a,l,o,t;if(ce.periodData&&ce.calendarDate){pe.value=!0;try{console.log("Loading period activity for:",{schedule_id:ce.periodData.schedule_id,calendar_date:ce.calendarDate,classroom_id:ce.periodData.classroom_id});const l=await f.get("/api/period-activities",{params:{schedule_id:ce.periodData.schedule_id,calendar_date:ce.calendarDate,classroom_id:ce.periodData.classroom_id,teacher_id:null==(a=null==(e=P().props.auth.user)?void 0:e.teacher)?void 0:a.id}});console.log("Period activity response:",l.data),l.data&&l.data.records?(Array.isArray(l.data.records.data)&&l.data.records.data.length>0?fe.value=l.data.records.data[0]:Array.isArray(l.data.records)&&l.data.records.length>0?fe.value=l.data.records[0]:fe.value=null,l.data.student_records?ge.value=l.data.student_records:await Ue()):l.data&&l.data.period_activity?(fe.value=l.data.period_activity,l.data.student_records?ge.value=l.data.student_records:await Ue()):(fe.value=null,ge.value=[])}catch(d){console.error("Error loading period activity:",d),console.error("Error details:",(null==(l=d.response)?void 0:l.data)||d.message),ue.notify({color:"negative",message:`Failed to load period activity data: ${(null==(t=null==(o=d.response)?void 0:o.data)?void 0:t.message)||d.message}`,icon:"error"}),fe.value=null}finally{pe.value=!1}}},Ue=async()=>{var e,a,l,o;if(null==(e=fe.value)?void 0:e.id){ye.value=!0;try{console.log("Loading student records for period activity:",fe.value.id);const e=await f.get(`/api/period-activities/${fe.value.id}/student-records`);console.log("Student records response:",e.data),e.data&&Array.isArray(e.data)&&e.data.length>0?(ge.value=e.data,be.value=e.data.map(e=>({id:e.student_id,name:e.name}))):(console.log("No student records found"),ge.value=[])}catch(t){console.error("Error loading student records:",t),console.error("Error details:",(null==(a=t.response)?void 0:a.data)||t.message),ue.notify({color:"negative",message:`Failed to load student records: ${(null==(o=null==(l=t.response)?void 0:l.data)?void 0:o.message)||t.message}`,icon:"error"})}finally{ye.value=!1}}else console.log("No period activity ID available, cannot load student records")},xe=async()=>{var e,a,l,o;if(null==(e=fe.value)?void 0:e.id){_e.value=!0;try{console.log("Saving period activity:",fe.value);const e=await f.put(`/api/period-activities/${fe.value.id}`,{...fe.value,updated_by:void 0});console.log("Period activity saved:",e.data),fe.value=e.data,console.log("Saving student records:",ge.value);const a=await f.put(`/api/period-activities/${fe.value.id}/student-records/batch`,{records:ge.value});console.log("Student records saved:",a.data),ue.notify({color:"positive",message:"Period activity saved successfully",icon:"check"})}catch(t){console.error("Error saving period activity:",t),console.error("Error details:",(null==(a=t.response)?void 0:a.data)||t.message),ue.notify({color:"negative",message:`Failed to save period activity: ${(null==(o=null==(l=t.response)?void 0:l.data)?void 0:o.message)||t.message}`,icon:"error"})}finally{_e.value=!1}}else console.error("No period activity ID available")},qe=async()=>{var e,a,l,o,t;if(ce.periodData){_e.value=!0;try{console.log("Creating period activity for:",ce.periodData);const l=await f.post("/api/period-activities",{schedule_id:ce.periodData.schedule_id,calendar_date:ce.calendarDate,teacher_id:null==(a=null==(e=P().props.auth.user)?void 0:e.teacher)?void 0:a.id,classroom_id:ce.periodData.classroom_id});console.log("Period activity created:",l.data),l.data&&l.data.period_activity&&(fe.value=l.data.period_activity,l.data.student_records?ge.value=l.data.student_records:await(async()=>{var e,a,l,o,t;if(null==(e=ce.periodData)?void 0:e.classroom_id){ye.value=!0;try{console.log("Loading students for classroom:",ce.periodData.classroom_id);const e=await f.get(`/api/classrooms/${ce.periodData.classroom_id}/students`);console.log("Students response:",e.data),e.data&&Array.isArray(e.data)?(be.value=e.data,(null==(a=fe.value)?void 0:a.id)&&0===ge.value.length&&(ge.value=be.value.map(e=>({id:null,period_activity_id:fe.value.id,student_id:e.id,name:e.name,attendance_status:"present",late_minutes:0,homework_completed:!1,homework_score:null,behavior_plus_marks:0,behavior_minus_marks:0,behavior_notes:"",participation_score:null,participation_notes:""})))):(console.log("No students found or invalid response format"),be.value=[])}catch(d){console.error("Error loading students:",d),console.error("Error details:",(null==(l=d.response)?void 0:l.data)||d.message),ue.notify({color:"negative",message:`Failed to load students: ${(null==(t=null==(o=d.response)?void 0:o.data)?void 0:t.message)||d.message}`,icon:"error"}),be.value=[]}finally{ye.value=!1}}else console.error("No classroom ID available")})(),ue.notify({color:"positive",message:"Period activity created successfully",icon:"check"}))}catch(d){console.error("Error creating period activity:",d),console.error("Error details:",(null==(l=d.response)?void 0:l.data)||d.message),ue.notify({color:"negative",message:`Failed to create period activity: ${(null==(t=null==(o=d.response)?void 0:o.data)?void 0:t.message)||d.message}`,icon:"error"})}finally{_e.value=!1}}else console.error("No period data available")};return h(()=>[ce.periodData,ce.calendarDate,ve.value],([e,a,l])=>{e&&a&&l&&De()},{immediate:!0}),h(fe,e=>{(null==e?void 0:e.id)&&0===ge.value.length&&Ue()}),h(ve,e=>{e&&(error.value=null,fe.value=null,ge.value=[],be.value=[],De())}),(a,f)=>(k(),V(c,{modelValue:ve.value,"onUpdate:modelValue":f[8]||(f[8]=e=>ve.value=e),persistent:"",maximized:"","transition-show":"slide-up","transition-hide":"slide-down",class:"period-activity-dialog"},{default:w(()=>[D(s,{class:"full-height"},{default:w(()=>[D(l,{class:"bg-primary text-white"},{default:w(()=>{var a,l,t,d;return[U("div",A,[U("div",E,[U("div",Q,x(null==(a=e.periodData)?void 0:a.subject)+" - "+x(null==(l=e.periodData)?void 0:l.classroom),1),U("div",C,x(e.calendarDate)+" | "+x(null==(t=e.periodData)?void 0:t.from)+" - "+x(null==(d=e.periodData)?void 0:d.to),1)]),U("div",M,[D(o,{flat:"",round:"",dense:"",icon:"close",onClick:f[0]||(f[0]=e=>ve.value=!1)})])])]}),_:1}),D(l,{class:"q-pa-none"},{default:w(()=>[D(t,{style:{height:"calc(100vh - 70px)"}},{default:w(()=>[pe.value?(k(),q("div",T,[D(d,{color:"primary",size:"3em"})])):(k(),q("div",$,[fe.value?(k(),q("div",F,[D(s,{flat:"",bordered:"",class:"q-ma-md"},{default:w(()=>[D(l,null,{default:w(()=>[f[10]||(f[10]=U("div",{class:"text-h6"},"Teacher Information",-1)),D(r,{modelValue:fe.value.teacher_present,"onUpdate:modelValue":f[1]||(f[1]=e=>fe.value.teacher_present=e),label:"Teacher Present"},null,8,["modelValue"]),fe.value.teacher_present?j("",!0):(k(),V(m,{key:0,modelValue:fe.value.teacher_substitute_id,"onUpdate:modelValue":f[2]||(f[2]=e=>fe.value.teacher_substitute_id=e),options:we.value,label:"Substitute Teacher",outlined:"",class:"q-mt-sm"},null,8,["modelValue","options"]))]),_:1})]),_:1}),D(s,{flat:"",bordered:"",class:"q-ma-md"},{default:w(()=>[D(l,null,{default:w(()=>[f[11]||(f[11]=U("div",{class:"text-h6"},"Period Status",-1)),D(i,{modelValue:fe.value.period_status,"onUpdate:modelValue":f[3]||(f[3]=e=>fe.value.period_status=e),options:Ve,color:"primary"},null,8,["modelValue"])]),_:1})]),_:1}),D(s,{flat:"",bordered:"",class:"q-ma-md"},{default:w(()=>[D(l,null,{default:w(()=>[f[12]||(f[12]=U("div",{class:"text-h6"},"Notes",-1)),D(n,{modelValue:fe.value.lesson_notes,"onUpdate:modelValue":f[4]||(f[4]=e=>fe.value.lesson_notes=e),type:"textarea",label:"Lesson Notes",outlined:"",class:"q-mb-md"},null,8,["modelValue"]),D(n,{modelValue:fe.value.improvement_notes,"onUpdate:modelValue":f[5]||(f[5]=e=>fe.value.improvement_notes=e),type:"textarea",label:"Improvement Notes",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),D(s,{flat:"",bordered:"",class:"q-ma-md"},{default:w(()=>[D(l,null,{default:w(()=>[f[14]||(f[14]=U("div",{class:"text-h6"},"Student Records",-1)),ye.value?(k(),q("div",I,[D(d,{color:"primary",size:"2em"})])):ge.value.length?(k(),q("div",z,[D(p,{modelValue:he.value,"onUpdate:modelValue":f[6]||(f[6]=e=>he.value=e),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:w(()=>[D(v,{name:"attendance",label:"Attendance"}),D(v,{name:"homework",label:"Homework"}),D(v,{name:"behavior",label:"Behavior"}),D(v,{name:"participation",label:"Participation"})]),_:1},8,["modelValue"]),D(u),D(y,{modelValue:he.value,"onUpdate:modelValue":f[7]||(f[7]=e=>he.value=e),animated:""},{default:w(()=>[D(_,{name:"attendance"},{default:w(()=>[(k(!0),q(S,null,N(ge.value,e=>(k(),q("div",{key:e.id,class:"q-mb-md"},[U("div",B,[U("div",R,x(e.name),1),U("div",H,[D(i,{modelValue:e.attendance_status,"onUpdate:modelValue":a=>e.attendance_status=a,options:ke,color:"primary",inline:""},null,8,["modelValue","onUpdate:modelValue"])]),"late"===e.attendance_status?(k(),q("div",J,[D(n,{modelValue:e.late_minutes,"onUpdate:modelValue":a=>e.late_minutes=a,modelModifiers:{number:!0},type:"number",label:"Minutes",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])])):j("",!0)])]))),128))]),_:1}),D(_,{name:"homework"},{default:w(()=>[(k(!0),q(S,null,N(ge.value,e=>(k(),q("div",{key:e.id,class:"q-mb-md"},[U("div",K,[U("div",X,x(e.name),1),U("div",Z,[D(r,{modelValue:e.homework_completed,"onUpdate:modelValue":a=>e.homework_completed=a,label:"Completed"},null,8,["modelValue","onUpdate:modelValue"])]),U("div",G,[D(n,{modelValue:e.homework_score,"onUpdate:modelValue":a=>e.homework_score=a,modelModifiers:{number:!0},type:"number",label:"Score",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])])])]))),128))]),_:1}),D(_,{name:"behavior"},{default:w(()=>[(k(!0),q(S,null,N(ge.value,e=>(k(),q("div",{key:e.id,class:"q-mb-md"},[U("div",W,[U("div",Y,x(e.name),1),U("div",ee,[D(n,{modelValue:e.behavior_plus_marks,"onUpdate:modelValue":a=>e.behavior_plus_marks=a,modelModifiers:{number:!0},type:"number",label:"Plus",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),U("div",ae,[D(n,{modelValue:e.behavior_minus_marks,"onUpdate:modelValue":a=>e.behavior_minus_marks=a,modelModifiers:{number:!0},type:"number",label:"Minus",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),U("div",le,[D(n,{modelValue:e.behavior_notes,"onUpdate:modelValue":a=>e.behavior_notes=a,type:"textarea",label:"Notes",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])])])]))),128))]),_:1}),D(_,{name:"participation"},{default:w(()=>[(k(!0),q(S,null,N(ge.value,e=>(k(),q("div",{key:e.id,class:"q-mb-md"},[U("div",oe,[U("div",te,x(e.name),1),U("div",de,[D(n,{modelValue:e.participation_score,"onUpdate:modelValue":a=>e.participation_score=a,modelModifiers:{number:!0},type:"number",label:"Score",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),U("div",se,[D(n,{modelValue:e.participation_notes,"onUpdate:modelValue":a=>e.participation_notes=a,type:"textarea",label:"Notes",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])])])]))),128))]),_:1})]),_:1},8,["modelValue"])])):(k(),q("div",O,[f[13]||(f[13]=U("p",null,"No student records found for this class",-1)),D(o,{color:"primary",label:"Load Student Records",onClick:Ue})]))]),_:1})]),_:1}),U("div",re,[D(o,{color:"primary",label:"Save",onClick:xe,class:"full-width",loading:_e.value},null,8,["loading"])])])):(k(),q("div",L,[D(s,{flat:"",bordered:""},{default:w(()=>[D(l,{class:"text-center"},{default:w(()=>[f[9]||(f[9]=U("p",{class:"text-h6"},"No period activity record exists for this period",-1)),D(o,{color:"primary",label:"Create Period Activity",onClick:qe,loading:_e.value},null,8,["loading"])]),_:1})]),_:1})]))]))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},[["__scopeId","data-v-3e3e181f"]]);export{ie as default};
