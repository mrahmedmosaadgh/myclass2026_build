import{r as e,u as a,Q as t,aS as s,b as l,t as d,aI as o,F as r,d as i,f as n,G as u,c,i as m,j as v,k as p,h as f,o as b,g,e as _}from"./app-BxJhpxku.js";import{Q as x}from"./QSpace-BD6HDuXW.js";import{Q as q}from"./QBar-p1H6y_GZ.js";import{Q as w}from"./QForm-CKei0wIu.js";import{s as y}from"./i18n-B0T1C7j3.js";import{r as h}from"./katex-DjUCNC-N.js";import{d as k}from"./date-DbdfPnt6.js";import{a as M,f as V,r as j,k as Q,I as F,J as H,K as S,b as L,N as A,R as G,y as T,V as I,W as N,O as U,Q as C,z as O,F as E}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./ui-B7TfxbV_.js";import"./katex-BXKQVcz-.js";const z={class:"text-subtitle1"},D={key:0,class:"row justify-center items-center full-height q-pa-xl"},Y={class:"q-pa-md"},R={class:"row q-gutter-md q-mb-md"},B={class:"col-12 col-sm-6 col-md-3"},$={class:"text-subtitle1"},J={class:"col-12 col-sm-6 col-md-3"},K={class:"text-subtitle1"},P={class:"col-12 col-sm-6 col-md-3"},W={class:"text-subtitle1"},X={class:"col-12 col-sm-6 col-md-3"},Z={class:"row items-start"},ee={class:"col"},ae={class:"text-subtitle1 text-weight-bold q-mb-sm"},te=["innerHTML"],se={class:"q-mb-sm"},le={class:"col-auto text-center"},de={class:"text-subtitle1 text-weight-bold q-mb-sm"},oe=["innerHTML"],re={key:0,class:"q-mb-md"},ie=["innerHTML"],ne={class:"q-mb-md"},ue=["innerHTML"],ce={class:"row q-gutter-md"},me={class:"col-12 col-sm-3"},ve={class:"col"},pe=e({__name:"QuGradingDialog",props:{modelValue:Boolean,attemptId:Number},emits:["update:modelValue","graded"],setup(e,{emit:pe}){const fe=e,be=pe,ge=a(),_e=M({get:()=>fe.modelValue,set:e=>be("update:modelValue",e)}),xe=V(!1),qe=V(!1),we=V(null),ye=V([]),he=V([]),ke=V(0),Me=j({});Q(()=>fe.attemptId,e=>{e&&fe.modelValue&&Ve(e)}),Q(()=>fe.modelValue,e=>{e&&fe.attemptId&&Ve(fe.attemptId)});const Ve=async e=>{xe.value=!0;try{const a=await window.axios.get(y("qu-exams.grading-data",e));we.value=a.data.attempt,ye.value=a.data.autoGraded,he.value=a.data.manualQuestions,ke.value=a.data.totalMarks,Object.keys(Me).forEach(e=>delete Me[e]),he.value.forEach(e=>{var a,t;Me[e.answer.id]={answer_id:e.answer.id,marks_obtained:null!=(a=e.answer.marks_obtained)?a:0,feedback:null!=(t=e.answer.feedback)?t:""}})}catch(a){console.error("Failed to load grading data",a),ge.notify({type:"negative",message:"Failed to load grading data"})}finally{xe.value=!1}},je=M(()=>{let e=0;return ye.value&&ye.value.forEach(a=>{e+=parseFloat(a.answer.marks_obtained)||0}),Object.values(Me).forEach(a=>{e+=parseFloat(a.marks_obtained)||0}),Math.round(e)}),Qe=M(()=>{var e;const a=null==(e=we.value)?void 0:e.grading_status;return"completed"===a?"positive":"partial"===a?"orange":"grey"}),Fe=M(()=>{var e;const a=null==(e=we.value)?void 0:e.grading_status;return a?a.charAt(0).toUpperCase()+a.slice(1):""}),He=e=>{var a;if("mcq"===e.question.question_type)return e.answer.selected_options||"No answer";if("true_false"===e.question.question_type){const t=null==(a=e.answer.selected_options)?void 0:a[0];return t?t.charAt(0).toUpperCase()+t.slice(1):"No answer"}return"No answer"},Se=async()=>{var e,a,t;qe.value=!0;try{await window.axios.post(y("qu-grading.save",we.value.id),{grades:Object.values(Me)}),ge.notify({type:"positive",message:"Grades saved successfully"}),be("graded"),_e.value=!1}catch(s){console.error("Failed to save grades",s);let l="Failed to save grades";(null==(t=null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.errors)?void 0:t.grades)&&(l=s.response.data.errors.grades),ge.notify({type:"negative",message:l})}finally{qe.value=!1}};return(e,a)=>(H(),F(_,{modelValue:_e.value,"onUpdate:modelValue":a[0]||(a[0]=e=>_e.value=e),maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:S(()=>[L(i,{class:"column no-wrap"},{default:S(()=>[L(q,{class:"bg-primary text-white"},{default:S(()=>{var e,o,r,i;return[L(t,{name:"edit_note"}),G("div",z," Grading: "+I(null==(o=null==(e=we.value)?void 0:e.user)?void 0:o.name)+" - "+I(null==(i=null==(r=we.value)?void 0:r.exam)?void 0:i.title),1),L(x),T((H(),F(l,{dense:"",flat:"",icon:"close"},{default:S(()=>[L(d,null,{default:S(()=>a[1]||(a[1]=[N("Close")])),_:1})]),_:1})),[[s]])]}),_:1}),xe.value?(H(),A("div",D,[L(o,{color:"primary",size:"3em"}),a[2]||(a[2]=G("div",{class:"q-ml-sm"},"Loading grading data...",-1))])):(H(),F(r,{key:1,class:"col"},{default:S(()=>[G("div",Y,[G("div",R,[G("div",B,[L(i,{flat:"",bordered:""},{default:S(()=>[L(n,{class:"text-center q-pa-sm"},{default:S(()=>{var e,t;return[G("div",$,I(null==(t=null==(e=we.value)?void 0:e.user)?void 0:t.name),1),a[3]||(a[3]=G("div",{class:"text-caption text-grey-7"},"Student",-1))]}),_:1})]),_:1})]),G("div",J,[L(i,{flat:"",bordered:""},{default:S(()=>[L(n,{class:"text-center q-pa-sm"},{default:S(()=>{var e,t;return[G("div",K,I((t=null==(e=we.value)?void 0:e.completed_at,t?k.formatDate(t,"YYYY-MM-DD HH:mm"):"")),1),a[4]||(a[4]=G("div",{class:"text-caption text-grey-7"},"Submitted",-1))]}),_:1})]),_:1})]),G("div",P,[L(i,{flat:"",bordered:""},{default:S(()=>[L(n,{class:"text-center q-pa-sm"},{default:S(()=>[G("div",W,I(je.value)+" / "+I(ke.value),1),a[5]||(a[5]=G("div",{class:"text-caption text-grey-7"},"Current Score",-1))]),_:1})]),_:1})]),G("div",X,[L(i,{flat:"",bordered:""},{default:S(()=>[L(n,{class:"text-center q-pa-sm"},{default:S(()=>[L(u,{color:Qe.value,"text-color":"white",dense:""},{default:S(()=>[N(I(Fe.value),1)]),_:1},8,["color"]),a[6]||(a[6]=G("div",{class:"text-caption text-grey-7"},"Status",-1))]),_:1})]),_:1})])]),L(c,{class:"q-mb-md"}),ye.value.length>0?(H(),F(i,{key:0,flat:"",bordered:"",class:"q-mb-md"},{default:S(()=>[L(n,null,{default:S(()=>a[7]||(a[7]=[G("div",{class:"text-h6"},"Auto-Graded Questions",-1)])),_:1}),L(m,{separator:""},{default:S(()=>[(H(!0),A(E,null,C(ye.value,(e,s)=>(H(),F(v,{key:"auto-"+e.question.id,class:"q-pa-md"},{default:S(()=>[L(p,null,{default:S(()=>[G("div",Z,[G("div",ee,[G("div",ae," Question "+I(s+1),1),G("div",{class:"text-body1 q-mb-md",innerHTML:O(h)(e.question.question_text)},null,8,te),G("div",se,[a[8]||(a[8]=G("div",{class:"text-caption text-grey-7"},"Student Answer:",-1)),L(u,{color:e.is_correct?"positive":"negative","text-color":"white",dense:""},{default:S(()=>[N(I(He(e)),1)]),_:2},1032,["color"])])]),G("div",le,[L(u,{color:e.is_correct?"positive":"negative","text-color":"white"},{default:S(()=>[L(t,{name:e.is_correct?"check_circle":"cancel",size:"sm",class:"q-mr-sm"},null,8,["name"]),N(" "+I(e.answer.marks_obtained)+" / "+I(e.question.marks),1)]),_:2},1032,["color"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):U("",!0),he.value.length>0?(H(),F(i,{key:1,flat:"",bordered:""},{default:S(()=>[L(n,null,{default:S(()=>a[9]||(a[9]=[G("div",{class:"text-h6"},"Questions Requiring Manual Grading",-1)])),_:1}),L(w,{onSubmit:Se},{default:S(()=>[L(m,{separator:""},{default:S(()=>[(H(!0),A(E,null,C(he.value,(e,t)=>(H(),F(v,{key:"manual-"+e.question.id,class:"q-pa-md"},{default:S(()=>[L(p,null,{default:S(()=>[G("div",de," Question "+I(ye.value.length+t+1),1),G("div",{class:"text-body1 q-mb-md",innerHTML:O(h)(e.question.question_text)},null,8,oe),e.question.correct_answer?(H(),A("div",re,[a[10]||(a[10]=G("div",{class:"text-caption text-grey-7 q-mb-xs"},"Model Answer:",-1)),L(i,{flat:"",bordered:"",class:"q-pa-sm bg-green-1"},{default:S(()=>[G("div",{innerHTML:O(h)(e.question.correct_answer)},null,8,ie)]),_:2},1024)])):U("",!0),G("div",ne,[a[11]||(a[11]=G("div",{class:"text-caption text-grey-7 q-mb-xs"},"Student Answer:",-1)),L(i,{flat:"",bordered:"",class:"q-pa-sm bg-grey-1"},{default:S(()=>[G("div",{innerHTML:O(h)(e.answer.answer_text||"No answer provided")},null,8,ue)]),_:2},1024)]),G("div",ce,[G("div",me,[L(f,{modelValue:Me[e.answer.id].marks_obtained,"onUpdate:modelValue":a=>Me[e.answer.id].marks_obtained=a,modelModifiers:{number:!0},type:"number",label:"Marks Awarded",hint:`Out of ${e.question.marks}`,rules:[e=>null!==e&&""!==e||"Required",e=>e>=0||"Must be >= 0",a=>a<=e.question.marks||`Max ${e.question.marks}`],outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue","hint","rules"])]),G("div",ve,[L(f,{modelValue:Me[e.answer.id].feedback,"onUpdate:modelValue":a=>Me[e.answer.id].feedback=a,type:"textarea",label:"Feedback (Optional)",hint:"Provide feedback to help the student improve",outlined:"",dense:"",rows:"3"},null,8,["modelValue","onUpdate:modelValue"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),L(b,{align:"right",class:"q-pa-md"},{default:S(()=>[T(L(l,{flat:"",label:"Cancel",color:"grey"},null,512),[[s]]),L(l,{type:"submit",label:"Save Grades",color:"primary",icon:"save",loading:qe.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})):ye.value.length>0?(H(),F(g,{key:2,class:"bg-positive text-white q-mt-md"},{avatar:S(()=>[L(t,{name:"check_circle"})]),default:S(()=>[a[12]||(a[12]=N(" All questions have been auto-graded. No manual grading required. "))]),_:1})):U("",!0)])]),_:1}))]),_:1})]),_:1},8,["modelValue"]))}},[["__scopeId","data-v-fce6dee0"]]);export{pe as default};
