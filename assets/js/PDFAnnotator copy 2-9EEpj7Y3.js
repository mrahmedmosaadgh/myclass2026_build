import{Y as e}from"./index-DHgm37GR.js";import a from"./html2canvas.esm-Cq3pa7K9.js";import{E as l}from"./jspdf.es.min-DKhx6mND.js";import{p as t}from"./app-BXm70mdJ.js";import{f as n,k as u,n as o,o as s,e as v,L as i,I as c,M as r,V as d,U as p,$ as g,S as f,x as h,ab as m,b,y as k}from"./vendor-DNM7Y6Xn.js";import"./offline-BzIlwqNM.js";import"./i18n-CBOKL2HS.js";import"./ui-BP0GJNn5.js";const y={class:"pdf-draw-local"},w={class:"upload-section"},P={class:"upload-box"},x={key:0,class:"upload-content"},C={key:1,class:"selected-file"},R={key:0,class:"pdf-section"},L={class:"toolbar"},U=["disabled"],j={class:"navigation-bar"},D=["disabled"],E={class:"page-info"},M=["max"],F=["disabled"],S={class:"viewer-wrapper"},B={key:1,class:"no-pdf"},I=t({__name:"PDFAnnotator copy 2",setup(t){const I=n(""),O=n(""),_=n(1),T=n(1),A=n("black"),Y=n({}),H=n(!1),N=n([]),V=n(null);let X=null;const $=e=>{var a;const l=null==(a=e.target.files)?void 0:a[0];l&&("application/pdf"===l.type?l.size>52428800?alert("File too large (max 50 MB)"):(I.value&&URL.revokeObjectURL(I.value),I.value=URL.createObjectURL(l),O.value=l.name,Y.value={},_.value=1):alert("Please select a PDF file"))},q=()=>{I.value&&URL.revokeObjectURL(I.value),I.value="",O.value="",_.value=1,T.value=1,Y.value={},V.value&&V.value.getContext("2d").clearRect(0,0,V.value.width,V.value.height)},z=e=>{e&&e.totalPages&&(T.value=e.totalPages)},G=()=>{o(J)},J=()=>{if(!V.value)return;const e=V.value.parentElement.querySelector(".pdf-embed");if(!e)return;const a=e.getBoundingClientRect();V.value.width=a.width,V.value.height=a.height,V.value.style.width=a.width+"px",V.value.style.height=a.height+"px",X=V.value.getContext("2d"),X.lineWidth=3,X.lineCap="round",X.lineJoin="round",X.strokeStyle=A.value,Z()},Q=e=>{"mousedown"===e.type&&e.preventDefault(),H.value=!0,N.value=[];const a=V.value.getBoundingClientRect(),l=e.clientX-a.left,t=e.clientY-a.top;N.value.push({x:l,y:t}),Y.value[_.value]||(Y.value[_.value]=[]),Y.value[_.value].push({color:A.value,points:N.value})},W=e=>{if(!H.value||!X)return;e.preventDefault();const a=V.value.getBoundingClientRect(),l=e.clientX-a.left,t=e.clientY-a.top;N.value.push({x:l,y:t});const n=N.value[N.value.length-2];X.beginPath(),X.moveTo(n.x,n.y),X.lineTo(l,t),X.stroke()},K=e=>{H.value=!1},Z=()=>{if(!X)return;X.clearRect(0,0,V.value.width,V.value.height);(Y.value[_.value]||[]).forEach(e=>{X.strokeStyle=e.color,X.beginPath(),e.points.forEach((e,a)=>{0===a?X.moveTo(e.x,e.y):X.lineTo(e.x,e.y)}),X.stroke()})},ee=()=>{var e;return(null==(e=Y.value[_.value])?void 0:e.length)>0},ae=e=>{A.value=e,X&&(X.strokeStyle=e)},le=()=>{var e;(null==(e=Y.value[_.value])?void 0:e.length)>0&&(Y.value[_.value].pop(),Z())},te=()=>{Y.value[_.value]=[],Z()},ne=async()=>{var e;const l=null==(e=V.value)?void 0:e.parentElement;if(!l)return;const t=await a(l,{scale:1}),n=document.createElement("a");n.download=`annotated-page-${_.value}.png`,n.href=t.toDataURL(),n.click()},ue=async()=>{var e;const t=new l("p","mm","a4");let n=0;for(let l=1;l<=T.value;l++){_.value=l,await o(),await o();const u=null==(e=V.value)?void 0:e.parentElement;if(!u)continue;const s=await a(u,{scale:1}),v=s.toDataURL("image/png"),i=210,c=295;let r=s.height*i/s.width;n>0&&t.addPage();do{const e=c-n;newHeight>e&&(t.addPage(),n=0),t.addImage(v,"PNG",0,n,i,newHeight),r-=e,n=0}while(r>0);n=r-c}t.save("annotated-pdf-full.pdf")},oe=()=>{_.value>1&&_.value--},se=()=>{_.value<T.value&&_.value++},ve=()=>{_.value<1&&(_.value=1),_.value>T.value&&(_.value=T.value)};return u(_,()=>{o(()=>{J()})}),s(()=>{var e,a,l;null==(e=V.value)||e.addEventListener("touchstart",e=>{e.preventDefault(),Q(e.touches[0])},{passive:!1}),null==(a=V.value)||a.addEventListener("touchmove",e=>{e.preventDefault(),W(e.touches[0])},{passive:!1}),null==(l=V.value)||l.addEventListener("touchend",K,{passive:!1})}),v(()=>{I.value&&URL.revokeObjectURL(I.value)}),(a,l)=>(c(),i("div",y,[r("div",w,[l[6]||(l[6]=r("h2",{class:"title"},"Upload PDF to Draw on Any Page",-1)),r("label",P,[r("input",{type:"file",accept:".pdf",onChange:$,class:"file-input"},null,32),O.value?(c(),i("div",C,[l[5]||(l[5]=r("div",{class:"icon"},"âœ…",-1)),r("p",null,[l[4]||(l[4]=d("Loaded: ")),r("strong",null,p(O.value),1)]),r("button",{onClick:g(q,["prevent"]),class:"clear-btn"},"Change File")])):(c(),i("div",x,l[3]||(l[3]=[r("div",{class:"icon"},"ðŸ“„",-1),r("p",null,"Drag & drop or click to upload",-1),r("small",null,"Max 50 MB",-1)])))])]),I.value?(c(),i("div",R,[r("div",L,[r("button",{onClick:l[0]||(l[0]=e=>ae("black")),class:f({active:"black"===A.value})},"Black",2),r("button",{onClick:l[1]||(l[1]=e=>ae("red")),class:f({active:"red"===A.value})},"Red",2),r("button",{onClick:le,disabled:!ee},"Undo",8,U),r("button",{onClick:te},"Clear Page"),r("button",{onClick:ne},"Save Page as Image"),r("button",{onClick:ue},"Save All as PDF")]),r("div",j,[r("button",{onClick:oe,disabled:_.value<=1,class:"nav-btn"},"â† Previous",8,D),r("span",E,[l[7]||(l[7]=d(" Page ")),h(r("input",{"onUpdate:modelValue":l[2]||(l[2]=e=>_.value=e),onInput:ve,type:"number",min:"1",max:T.value,class:"page-input"},null,40,M),[[m,_.value,void 0,{number:!0}]]),d(" of "+p(T.value),1)]),r("button",{onClick:se,disabled:_.value>=T.value,class:"nav-btn"},"Next â†’",8,F)]),r("div",S,[b(k(e),{source:I.value,"page-number":_.value,onProgress:z,onRendered:G,class:"pdf-embed","enable-annotation":!1},null,8,["source","page-number"]),r("canvas",{ref_key:"canvas",ref:V,class:"draw-canvas",onMousedown:Q,onMousemove:W,onMouseup:K,onMouseleave:K},null,544)])])):(c(),i("div",B,l[8]||(l[8]=[r("p",null,"Upload a PDF to start drawing on any page",-1)])))]))}},[["__scopeId","data-v-c86e35b1"]]);export{I as default};
