import{Q as e}from"./QSpace-Bk4F2b8L.js";import{o as a,u as l,c as t,aP as s,Q as n,f as u,d as i,g as o,h as r,i as d,j as m,n as p,l as v,m as c,b as f}from"./app-B77gjd5a.js";import{Q as _}from"./QFile-CU_I75Xg.js";import{Q as b}from"./QSelect-DB_tK-Lk.js";import{Q as h}from"./QForm-BQsH4F1U.js";import{f as w,a as g,k as x,I as V,J as y,K as j,b as k,N as q,y as A,V as Q,a0 as U,M,Q as F,F as S,R as B,W as C}from"./vendor-DuKqz2x4.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";import"./use-file-Bu9Bf7oq.js";import"./rtl-Cr6c3OOr.js";const R={class:"text-h6"},E={class:"q-gutter-md"},I={class:"q-gutter-sm"},N={key:0,class:"q-mt-sm"},P=a({__name:"AnswerForm",props:{modelValue:{type:Boolean,default:!1},answer:{type:Object,default:null},questionId:{type:Number,required:!0}},emits:["update:modelValue","save"],setup(a,{expose:P,emit:z}){const $=a,K=z,L=l(),O=w($.modelValue),T=w(!1),W=w({}),D=w(null),G=w({answer_text:"",media_links:[],attachments:[],status:"draft",notes:"",is_public:!1}),J=g({get:()=>G.value.media_links.join(", "),set:e=>{G.value.media_links=e?e.split(",").map(e=>e.trim()).filter(Boolean):[]}}),Z=g(()=>[{label:"Draft",value:"draft"},{label:"Published",value:"published"},{label:"Under Review",value:"review"},{label:"Archived",value:"archived"}]),H=g(()=>!!$.answer),X=g(()=>G.value.answer_text),Y=e=>{e?G.value={answer_text:e.answer_text||"",media_links:Array.isArray(e.media_links)?e.media_links:[],attachments:Array.isArray(e.attachments)?e.attachments:[],status:e.status||"draft",notes:e.notes||"",is_public:e.is_public||!1}:(G.value={answer_text:"",media_links:[],attachments:[],status:"draft",notes:"",is_public:!1},W.value={},D.value=null)},ee=()=>{if(!X.value)return void L.notify({type:"negative",message:"Please provide an answer text",position:"top"});T.value=!0,W.value={};const e={...G.value,question_id:$.questionId};H.value&&(e.id=$.answer.id),D.value&&D.value.length>0&&(e.new_files=D.value),K("save",e)},ae=e=>{e.forEach(e=>{L.notify({type:"negative",message:`File "${e.file.name}" was rejected: ${e.failedPropValidation}`,position:"top"})})},le=e=>{if(0===e)return"0 Bytes";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["Bytes","KB","MB","GB"][a]};return x(()=>$.modelValue,e=>{O.value=e,e&&Y($.answer)}),x(()=>$.answer,e=>{O.value&&Y(e)}),P({handleSaveComplete:()=>{T.value=!1,O.value=!1,D.value=null},handleSaveError:e=>{var a,l;T.value=!1,(null==(l=null==(a=e.response)?void 0:a.data)?void 0:l.errors)&&(W.value=e.response.data.errors)}}),(a,l)=>(y(),V(f,{modelValue:O.value,"onUpdate:modelValue":[l[6]||(l[6]=e=>O.value=e),l[7]||(l[7]=e=>a.$emit("update:modelValue",e))],persistent:""},{default:j(()=>[k(c,{style:{"min-width":"500px","max-width":"700px",width:"100%"}},{default:j(()=>[k(t,{class:"row items-center q-pb-none"},{default:j(()=>[q("div",R,Q(H.value?"Edit Answer":"Add New Answer"),1),k(e),A(k(n,{icon:"close",flat:"",round:"",dense:""},null,512),[[s]])]),_:1}),k(h,{onSubmit:U(ee,["prevent"]),class:"q-gutter-md"},{default:j(()=>[k(t,{class:"q-pt-none"},{default:j(()=>[q("div",E,[k(u,{modelValue:G.value.answer_text,"onUpdate:modelValue":l[0]||(l[0]=e=>G.value.answer_text=e),label:"Answer Text *",outlined:"",dense:"",type:"textarea",rows:"5",rules:[e=>!!e||"Answer text is required"],error:!!W.value.answer_text,"error-message":W.value.answer_text,hint:"The main answer content"},null,8,["modelValue","rules","error","error-message"]),k(u,{modelValue:J.value,"onUpdate:modelValue":l[1]||(l[1]=e=>J.value=e),label:"Media Links",outlined:"",dense:"",type:"textarea",rows:"3",hint:"Enter media URLs separated by commas (optional)",error:!!W.value.media_links,"error-message":W.value.media_links},null,8,["modelValue","error","error-message"]),q("div",I,[l[9]||(l[9]=q("div",{class:"text-subtitle2"},"Attachments",-1)),k(_,{modelValue:D.value,"onUpdate:modelValue":l[2]||(l[2]=e=>D.value=e),label:"Upload Files",outlined:"",dense:"",multiple:"",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.mp4,.mp3","max-files":"5","max-file-size":"10485760",onRejected:ae},{prepend:j(()=>[k(i,{name:"attach_file"})]),_:1},8,["modelValue"]),G.value.attachments&&G.value.attachments.length>0?(y(),M("div",N,[l[8]||(l[8]=q("div",{class:"text-caption text-grey-7"},"Current attachments:",-1)),k(o,{dense:""},{default:j(()=>[(y(!0),M(S,null,B(G.value.attachments,(e,a)=>(y(),V(r,{key:a,dense:""},{default:j(()=>[k(d,{avatar:""},{default:j(()=>{return[k(i,{name:(a=e.type,(null==a?void 0:a.includes("image"))?"image":(null==a?void 0:a.includes("video"))?"videocam":(null==a?void 0:a.includes("audio"))?"audiotrack":(null==a?void 0:a.includes("pdf"))?"picture_as_pdf":(null==a?void 0:a.includes("word"))||(null==a?void 0:a.includes("document"))?"description":"insert_drive_file")},null,8,["name"])];var a}),_:2},1024),k(d,null,{default:j(()=>[k(m,null,{default:j(()=>[C(Q(e.name),1)]),_:2},1024),k(m,{caption:""},{default:j(()=>[C(Q(le(e.size)),1)]),_:2},1024)]),_:2},1024),k(d,{side:""},{default:j(()=>[k(n,{icon:"delete",flat:"",round:"",dense:"",size:"sm",color:"negative",onClick:e=>(e=>{G.value.attachments.splice(e,1)})(a)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):F("",!0)]),k(b,{modelValue:G.value.status,"onUpdate:modelValue":l[3]||(l[3]=e=>G.value.status=e),options:Z.value,label:"Status",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options"]),k(u,{modelValue:G.value.notes,"onUpdate:modelValue":l[4]||(l[4]=e=>G.value.notes=e),label:"Notes",outlined:"",dense:"",type:"textarea",rows:"2",hint:"Optional notes or comments about this answer"},null,8,["modelValue"]),k(p,{modelValue:G.value.is_public,"onUpdate:modelValue":l[5]||(l[5]=e=>G.value.is_public=e),label:"Make this answer public",color:"primary"},null,8,["modelValue"])])]),_:1}),k(v,{align:"right",class:"q-pa-md"},{default:j(()=>[A(k(n,{flat:"",label:"Cancel",color:"grey-7",disable:T.value},null,8,["disable"]),[[s]]),k(n,{type:"submit",label:"Save",color:"primary",loading:T.value,disable:!X.value},null,8,["loading","disable"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},[["__scopeId","data-v-aa31e36a"]]);export{P as default};
