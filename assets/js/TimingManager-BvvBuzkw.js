import{u as e,bk as a,bb as t,f as l,p as o,Q as s,C as i}from"./app-B77gjd5a.js";import{Q as n}from"./QTab-CnAf4tCv.js";import{Q as d}from"./QTabs-D_ZwIIJm.js";import{Q as r}from"./QTabPanel-B_PJ80R0.js";import{Q as u}from"./QTabPanels-B5JhG1n5.js";import m from"./DaySchedule-Czk0SNWT.js";import c from"./SchedulePreview-3jGZYJnI.js";import{a3 as p,f,a as v,o as g,M as y,J as h,N as b,b as j,K as S,W as _,F as w,R as T,I as V,V as Q,Q as k}from"./vendor-DuKqz2x4.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";import"./rtl-Cr6c3OOr.js";import"./use-panel-N2fkKyR_.js";import"./use-render-cache-CmTcazfP.js";import"./QBadge-ZkvAqPBD.js";import"./QSelect-DB_tK-Lk.js";import"./QTable-Dzgz30xz.js";import"./QMarkupTable-xKG6mM4A.js";import"./QLinearProgress-B9hMkhRG.js";import"./use-fullscreen-Cf3Zl1YN.js";import"./QTr-DYQ1GmNz.js";import"./QTd-Cd1TbwhN.js";const C={class:"timing-manager"},x={class:"preview-section q-mt-lg"},$={class:"time-slots-config bg-grey-2 p-4 mb-4 rounded-borders"},E={class:"flex items-center justify-between mb-2"},P={class:"flex gap-2"},R={class:"time-slots-list flex gap-4 flex-wrap"},M={class:"flex justify-between mb-4"},D={class:"actions flex gap-2"},I={__name:"TimingManager",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(I,{emit:O}){const q=e(),U=a();p(U);const{fetchData:A}=U,F=I,L=O,N=["Sunday","Monday","Tuesday","Wednesday","Thursday"],W=f("sunday"),J=f("08:00"),K=f("08:45"),B=f([{id:0,from:"08:00",to:"08:45",active:!0}]),H=f(F.modelValue||{d1:[],d2:[],d3:[],d4:[],d5:[]}),z=v(()=>{var e;const a=`d${G()+1}`;return(null==(e=H.value[a])?void 0:e.length)>0}),G=()=>N.findIndex(e=>e.toLowerCase()===W.value.toLowerCase()),X=async()=>{if(!ee())return void q.notify({type:"negative",message:"Please check all required fields"});const e=localStorage.getItem("selected_school");if(!e)return void q.notify({type:"negative",message:"Please check school_id"});const a={school_id:e,options:{timeSlots:B.value,defaultStartTime:J.value,defaultEndTime:K.value},timing:H.value};await A({endpoint:route("admin.schedules.timings.store"),method:"POST",data:a,successMessage:"Schedule timing saved successfully!",errorMessage:"Failed to save schedule timing",onSuccess:e=>{L("update:modelValue",H.value)},onError:e=>{console.error("Save failed:",e)}})},Y=()=>{const e={id:B.value.length,from:J.value,to:K.value};B.value.push(e)},Z=()=>{const e=`d${G()+1}`,a=H.value[e];(null==a?void 0:a.length)&&q.dialog({title:"Confirm Copy",message:"Copy current day schedule to all other days?",cancel:!0,persistent:!0}).onOk(()=>{N.forEach((t,l)=>{const o=`d${l+1}`;o!==e&&(H.value[o]=a.map(a=>({...a,period_code:a.period_code.includes("break")?a.period_code:a.period_code.replace(e,o)})))}),L("update:modelValue",H.value),q.notify({type:"positive",message:"Schedule copied to all days successfully"})})},ee=()=>{var e;if(!B.value.length)return q.notify({type:"warning",message:"At least one time slot is required"}),!1;for(const a of Object.keys(H.value)){const t=H.value[a];if(null==t?void 0:t.length)for(const l of t){if(!l.label||!(null==(e=l.timeSlots)?void 0:e.length))return q.notify({type:"warning",message:`Invalid configuration in ${a}`}),!1;const t=l.timeSlots[0];if(!t.from||!t.to||!t.active)return q.notify({type:"warning",message:`Primary time slot required in ${a}`}),!1}}return!0};return g(async()=>{(()=>{const e=localStorage.getItem("selected_school");fetch(`/admin/schedules/timings_show_data/${e}`).then(e=>e.json()).then(e=>{console.log("Debug - Raw Response:",e)}).catch(e=>{console.error("Debug - Fetch Error:",e)})})(),await(async()=>{const e=localStorage.getItem("selected_school");e?await A({endpoint:"/admin/schedules/timings_show_data2",data:{school_id:e},method:"post",onSuccess:e=>{console.log("Response:",e),e&&e.data?(e.data.options&&(Array.isArray(e.data.options.timeSlots)&&(B.value=e.data.options.timeSlots),e.data.options.defaultStartTime&&(J.value=e.data.options.defaultStartTime),e.data.options.defaultEndTime&&(K.value=e.data.options.defaultEndTime)),e.data.timing&&(H.value=e.data.timing),q.notify({type:"positive",message:"Schedule timing loaded successfully"})):q.notify({type:"info",message:"No existing schedule configuration found"})},onError:e=>{console.error("Failed to load timing data:",e),q.notify({type:"negative",message:"Failed to load timing configuration"})}}):q.notify({type:"warning",message:"No school selected"})})()}),(e,a)=>(h(),y("div",C,[b("div",x,[j(t,{icon:"preview",label:"Schedule Preview","default-opened":""},{default:S(()=>[j(c,{timing:H.value,"time-slots":B.value},null,8,["timing","time-slots"])]),_:1})]),b("div",$,[b("div",E,[a[5]||(a[5]=b("h4",{class:"text-subtitle1 q-my-none"},"Time Slots Configuration",-1)),b("div",P,[j(l,{modelValue:J.value,"onUpdate:modelValue":a[0]||(a[0]=e=>J.value=e),type:"time",dense:"",label:"Default Start",style:{width:"120px"}},null,8,["modelValue"]),j(l,{modelValue:K.value,"onUpdate:modelValue":a[1]||(a[1]=e=>K.value=e),type:"time",dense:"",label:"Default End",style:{width:"120px"}},null,8,["modelValue"]),j(s,{flat:"",dense:"",icon:"add",color:"primary",onClick:Y},{default:S(()=>[j(o,null,{default:S(()=>a[4]||(a[4]=[_("Add Time Slot")])),_:1})]),_:1})])]),b("div",R,[(h(!0),y(w,null,T(B.value,(e,a)=>(h(),V(i,{key:a,removable:"",onRemove:e=>(e=>{0!==e&&q.dialog({title:"Confirm Removal",message:"Remove this time slot from all periods?",cancel:!0,persistent:!0}).onOk(()=>{B.value=B.value.filter((a,t)=>t!==e),Object.keys(H.value).forEach(a=>{H.value[a].forEach(a=>{delete a[`from${e+1}`],delete a[`to${e+1}`]})})})})(a),color:"primary","text-color":"white"},{default:S(()=>[_(" Slot "+Q(a+1)+" ",1),j(o,null,{default:S(()=>[_(Q(e.from)+" - "+Q(e.to),1)]),_:2},1024)]),_:2},1032,["onRemove","removable"]))),128))])]),b("div",M,[a[6]||(a[6]=b("h3",{class:"text-lg font-semibold"},"Schedule Timing Manager",-1)),b("div",D,["sunday"==W.value?(h(),V(s,{key:0,color:"secondary",label:"Copy Current Day to All",icon:"content_copy",onClick:Z,disable:!z.value},null,8,["disable"])):k("",!0),j(s,{color:"primary",onClick:X,icon:"save",label:"Save"})])]),j(d,{modelValue:W.value,"onUpdate:modelValue":a[2]||(a[2]=e=>W.value=e),class:"bg-grey-2",dense:"",align:"justify"},{default:S(()=>[(h(),y(w,null,T(N,e=>j(n,{key:e,name:e.toLowerCase(),label:e},null,8,["name","label"])),64))]),_:1},8,["modelValue"]),j(u,{modelValue:W.value,"onUpdate:modelValue":a[3]||(a[3]=e=>W.value=e),animated:""},{default:S(()=>[(h(),y(w,null,T(N,(e,a)=>j(r,{key:e,name:e.toLowerCase()},{default:S(()=>[j(m,{periods:H.value[`d${a+1}`]||[],"day-code":`d${a+1}`,"time-slots":B.value,"default-start-time":J.value,"default-end-time":K.value,"onUpdate:periods":e=>{return t=e,l=a+1,H.value[`d${l}`]=t,void L("update:modelValue",H.value);var t,l}},null,8,["periods","day-code","time-slots","default-start-time","default-end-time","onUpdate:periods"])]),_:2},1032,["name"])),64))]),_:1},8,["modelValue"])]))}};export{I as default};
