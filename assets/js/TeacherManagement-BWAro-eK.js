import{Q as e}from"./QSpace-Bu8V-QDa.js";import{u as l,Q as a,D as o,n as t,d as n,g as r,m as u,aD as i,b as s}from"./app-BXm70mdJ.js";import{Q as d}from"./QTd-BIxMTYzb.js";import{Q as m}from"./QTable-rnEofRem.js";import{Q as c}from"./QSelect-CnZtzPIC.js";import{Q as p}from"./QForm-DyZk5PSh.js";import{_ as v}from"./AppLayout-poNpMhjN.js";import{a as b,f,o as h,H as g,I as _,J as y,M as w,b as V,U as j,x as q}from"./vendor-DNM7Y6Xn.js";import"./offline-BzIlwqNM.js";import"./i18n-CBOKL2HS.js";import"./ui-BP0GJNn5.js";import"./QMarkupTable-Dmg3C5Wm.js";import"./QLinearProgress-Cix0cchl.js";import"./use-fullscreen-FlxrEg_V.js";import"./rtl-Cr6c3OOr.js";const C={class:"q-pa-md"},Q={class:"row q-mb-md"},x={class:"text-h6"},A={__name:"TeacherManagement",props:{teachers:{type:Array,required:!1,default:()=>[]},schools:{type:Array,required:!0}},setup(A){const k=l(),U=A,N=b(()=>U.schools.map(e=>({value:e.id,label:e.name}))),S=f([]),T=f(!1),E=f(!1),L=f(!1),R=f(!1),D=f(!1),M=f(null),O=f(null),P=f({page:1,rowsPerPage:10,rowsNumber:0}),F=f({name:"",name_ar:"",email:"",school_id:null,phone_number:"",gender:null,date_of_birth:null}),$=[{name:"t_id",label:"Teacher ID",field:"t_id",sortable:!0},{name:"name",label:"Name",field:"name",sortable:!0},{name:"name_ar",label:"Arabic Name",field:"name_ar",sortable:!0},{name:"email",label:"Email",field:"email",sortable:!0},{name:"school",label:"School",field:"school",sortable:!0},{name:"phone_number",label:"Phone",field:"phone_number",sortable:!0},{name:"gender",label:"Gender",field:"gender",sortable:!0},{name:"actions",label:"Actions",field:"actions"}],I=e=>{console.log("onRequest",e)},B=()=>{T.value=!0,axios.get("/admin/teachers",{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},withCredentials:!0}).then(e=>{S.value=e.data.data,P.value.rowsNumber=e.data.total}).catch(e=>{k.notify({color:"negative",message:"Failed to load teachers"})}).finally(()=>{T.value=!1})},G=(e=null)=>{e?(M.value=e,F.value={...e}):(M.value=null,F.value={name:"",name_ar:"",email:"",school_id:null,phone_number:"",gender:null,date_of_birth:null}),E.value=!0},H=async()=>{var e,l,a,o,t;R.value=!0;try{const o={...F.value,school_id:(null==(l=null==(e=F.value)?void 0:e.school_id)?void 0:l.value)||F.value.school_id,gender:(null==(a=F.value.gender)?void 0:a.value)||F.value.gender};M.value?await axios.put(`/api/teachers/${M.value.id}`,o):await axios.post("/api/teachers",o),await B(),E.value=!1,k.notify({color:"positive",message:`Teacher ${M.value?"updated":"created"} successfully`})}catch(n){k.notify({color:"negative",message:(null==(t=null==(o=n.response)?void 0:o.data)?void 0:t.message)||"Operation failed"})}finally{R.value=!1}},J=async()=>{if(O.value){D.value=!0;try{await axios.delete(`/api/teachers/${O.value.id}`),await B(),L.value=!1,k.notify({color:"positive",message:"Teacher deleted successfully"})}catch(e){k.notify({color:"negative",message:"Failed to delete teacher"})}finally{D.value=!1,O.value=null}}},X=async()=>{try{const e=(await axios.get("/api/teachers/export")).data,l=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=window.URL.createObjectURL(l),o=document.createElement("a");o.href=a,o.setAttribute("download",`teachers_${(new Date).toISOString()}.json`),document.body.appendChild(o),o.click(),document.body.removeChild(o)}catch(e){k.notify({color:"negative",message:"Failed to export data"})}};return h(()=>{B()}),(l,b)=>(_(),g(v,{title:"teacher"},{default:y(()=>[w("div",C,[w("div",Q,[V(e),V(a,{color:"primary",icon:"add",label:"Add Teacher",onClick:b[0]||(b[0]=e=>G())}),V(a,{color:"secondary",icon:"download",label:"Export",class:"q-ml-sm",onClick:X})]),V(m,{rows:S.value,columns:$,"row-key":"id",loading:T.value,pagination:P.value,onRequest:I},{"body-cell-actions":y(e=>[V(d,{props:e},{default:y(()=>[V(o,{flat:""},{default:y(()=>[V(a,{flat:"",round:"",color:"info",icon:"edit",onClick:l=>G(e.row)},null,8,["onClick"]),V(a,{flat:"",round:"",color:"negative",icon:"delete",onClick:l=>{return a=e.row,O.value=a,void(L.value=!0);var a}},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"]),V(s,{modelValue:E.value,"onUpdate:modelValue":b[7]||(b[7]=e=>E.value=e),persistent:""},{default:y(()=>[V(t,{style:{"min-width":"350px"}},{default:y(()=>[V(n,null,{default:y(()=>[w("div",x,j(M.value?"Edit Teacher":"Add Teacher"),1)]),_:1}),V(n,null,{default:y(()=>[V(p,{onSubmit:H,class:"q-gutter-md"},{default:y(()=>[V(r,{modelValue:F.value.name,"onUpdate:modelValue":b[1]||(b[1]=e=>F.value.name=e),label:"Name",rules:[e=>!!e||"Name is required"]},null,8,["modelValue","rules"]),V(r,{modelValue:F.value.name_ar,"onUpdate:modelValue":b[2]||(b[2]=e=>F.value.name_ar=e),label:"Arabic Name"},null,8,["modelValue"]),V(r,{modelValue:F.value.email,"onUpdate:modelValue":b[3]||(b[3]=e=>F.value.email=e),label:"Email",type:"email",rules:[e=>!!e||"Email is required"]},null,8,["modelValue","rules"]),V(c,{modelValue:F.value.school_id,"onUpdate:modelValue":b[4]||(b[4]=e=>F.value.school_id=e),options:N.value,label:"School",rules:[e=>!!e||"School is required"]},null,8,["modelValue","options","rules"]),V(r,{modelValue:F.value.phone_number,"onUpdate:modelValue":b[5]||(b[5]=e=>F.value.phone_number=e),label:"Phone Number"},null,8,["modelValue"]),V(c,{modelValue:F.value.gender,"onUpdate:modelValue":b[6]||(b[6]=e=>F.value.gender=e),options:["male","female"],label:"Gender","emit-value":"","map-options":""},null,8,["modelValue"])]),_:1})]),_:1}),V(u,{align:"right"},{default:y(()=>[q(V(a,{flat:"",label:"Cancel",color:"primary"},null,512),[[i]]),V(a,{flat:"",label:"Save",color:"primary",onClick:H,loading:R.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),V(s,{modelValue:L.value,"onUpdate:modelValue":b[8]||(b[8]=e=>L.value=e)},{default:y(()=>[V(t,null,{default:y(()=>[V(n,{class:"row items-center"},{default:y(()=>b[9]||(b[9]=[w("span",{class:"q-ml-sm"},"Are you sure you want to delete this teacher?",-1)])),_:1}),V(u,{align:"right"},{default:y(()=>[q(V(a,{flat:"",label:"Cancel",color:"primary"},null,512),[[i]]),V(a,{flat:"",label:"Delete",color:"negative",onClick:J,loading:D.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1}))}};export{A as default};
