import{r as e}from"./app-CWAnT6CT.js";import{f as a,a as t,o,e as l,k as r,N as u,J as n,R as s,S as v,U as i}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";const c=e({__name:"DrawingCanvas",props:{isActive:{type:Boolean,default:!1},drawingTool:{type:String,default:"pen"},penColor:{type:String,default:"#FF0000"},penSize:{type:Number,default:3},backgroundColor:{type:String,default:"transparent"},currentPage:{type:Number,default:1},clearTrigger:{type:Number,default:0},storageKey:{type:String,default:"drawing-pages"}},emits:["strokes-updated","pages-updated","page-background-changed"],setup(e,{expose:c,emit:g}){const d=e,p=g,h=a(null),f=a(null),y=a(!1),m=a({}),b=a({}),k=a([]),w=t(()=>m.value[d.currentPage]||[]),S=t(()=>b.value[d.currentPage]||"transparent");o(()=>{C(),R(),window.addEventListener("resize",P)}),l(()=>{window.removeEventListener("resize",P),F()}),r(()=>d.clearTrigger,()=>{A()}),r(()=>d.isActive,e=>{e&&P()}),r(()=>d.currentPage,()=>{p("page-background-changed",S.value),M()}),r(()=>d.backgroundColor,e=>{b.value[d.currentPage]=e,F(),M()});const C=()=>{h.value&&(f.value=h.value.getContext("2d"),P(),f.value.lineCap="round",f.value.lineJoin="round")},P=()=>{if(!h.value)return;const e=h.value.parentElement.getBoundingClientRect();h.value.width=e.width,h.value.height=e.height,M()},T=e=>{if(!d.isActive)return;y.value=!0;const a=O(e);k.value=[{x:a.x,y:a.y,color:d.penColor,size:d.penSize,tool:d.drawingTool}]},x=e=>{if(!y.value||!d.isActive)return;const a=O(e);k.value.push({x:a.x,y:a.y,color:d.penColor,size:d.penSize,tool:d.drawingTool}),M(),N(k.value)},z=()=>{y.value&&(y.value=!1,k.value.length>0&&(m.value[d.currentPage]||(m.value[d.currentPage]=[]),m.value[d.currentPage].push([...k.value]),k.value=[],F(),p("strokes-updated",w.value)))},j=e=>{e.preventDefault();const a=e.touches[0],t=new MouseEvent("mousedown",{clientX:a.clientX,clientY:a.clientY});h.value.dispatchEvent(t)},E=e=>{e.preventDefault();const a=e.touches[0],t=new MouseEvent("mousemove",{clientX:a.clientX,clientY:a.clientY});h.value.dispatchEvent(t)},O=e=>{const a=h.value.getBoundingClientRect();return{x:e.clientX-a.left,y:e.clientY-a.top}},N=e=>{if(f.value&&!(e.length<2)){"eraser"===e[0].tool?(f.value.globalCompositeOperation="destination-out",f.value.strokeStyle="rgba(0,0,0,1)",f.value.lineWidth=3*e[0].size):(f.value.globalCompositeOperation="source-over",f.value.strokeStyle=e[0].color,f.value.lineWidth=e[0].size),f.value.beginPath(),f.value.moveTo(e[0].x,e[0].y);for(let a=1;a<e.length;a++)f.value.lineTo(e[a].x,e[a].y);f.value.stroke(),f.value.globalCompositeOperation="source-over"}},M=()=>{if(!f.value)return;f.value.clearRect(0,0,h.value.width,h.value.height);w.value.forEach(e=>{N(e)})},A=()=>{m.value[d.currentPage]=[],k.value=[],f.value&&f.value.clearRect(0,0,h.value.width,h.value.height),F(),p("strokes-updated",[])},F=()=>{try{const e={pages:m.value,backgrounds:b.value};localStorage.setItem(d.storageKey,JSON.stringify(e)),p("pages-updated",Object.keys(m.value).length)}catch(e){console.error("Failed to save to localStorage:",e)}},R=()=>{try{const e=localStorage.getItem(d.storageKey);if(e){const a=JSON.parse(e);a.pages?(m.value=a.pages,b.value=a.backgrounds||{}):(m.value=a,b.value={}),p("page-background-changed",S.value),M(),p("pages-updated",Object.keys(m.value).length)}}catch(e){console.error("Failed to load from localStorage:",e)}};return c({clearCurrentPage:A,undo:()=>{m.value[d.currentPage]&&0!==m.value[d.currentPage].length&&(m.value[d.currentPage].pop(),M(),F(),p("strokes-updated",w.value))},addNewPage:e=>{m.value[e]||(m.value[e]=[],F(),p("pages-updated",Object.keys(m.value).length))},saveToStorage:F,loadFromStorage:R}),(a,t)=>(n(),u("div",{class:i(["drawing-canvas-overlay",{active:e.isActive}]),style:v({backgroundColor:e.backgroundColor})},[s("canvas",{ref_key:"canvas",ref:h,onMousedown:T,onMousemove:x,onMouseup:z,onMouseleave:z,onTouchstart:j,onTouchmove:E,onTouchend:z},null,544)],6))}},[["__scopeId","data-v-16db4305"]]);export{c as default};
