import{Q as e}from"./QSpace-Bu8V-QDa.js";import{p as a,u as l,d as t,aD as s,Q as n,g as u,e as i,h as o,i as r,j as d,k as m,o as p,m as v,n as c,b as f}from"./app-BXm70mdJ.js";import{Q as _}from"./QFile-BmfyT66f.js";import{Q as b}from"./QSelect-CnZtzPIC.js";import{Q as w}from"./QForm-DyZk5PSh.js";import{f as h,a as g,k as x,H as V,I as y,J as j,b as k,M as A,x as q,U,$ as Q,L as B,O as F,F as M,Q as S,V as C}from"./vendor-DNM7Y6Xn.js";import"./offline-BzIlwqNM.js";import"./i18n-CBOKL2HS.js";import"./ui-BP0GJNn5.js";import"./use-file-s-H4_Vj8.js";import"./rtl-Cr6c3OOr.js";const E={class:"text-h6"},I={class:"q-gutter-md"},$={class:"q-gutter-sm"},z={key:0,class:"q-mt-sm"},L=a({__name:"AnswerForm",props:{modelValue:{type:Boolean,default:!1},answer:{type:Object,default:null},questionId:{type:Number,required:!0}},emits:["update:modelValue","save"],setup(a,{expose:L,emit:N}){const O=a,P=N,R=l(),D=h(O.modelValue),T=h(!1),G=h({}),H=h(null),J=h({answer_text:"",media_links:[],attachments:[],status:"draft",notes:"",is_public:!1}),K=g({get:()=>J.value.media_links.join(", "),set:e=>{J.value.media_links=e?e.split(",").map(e=>e.trim()).filter(Boolean):[]}}),W=g(()=>[{label:"Draft",value:"draft"},{label:"Published",value:"published"},{label:"Under Review",value:"review"},{label:"Archived",value:"archived"}]),X=g(()=>!!O.answer),Y=g(()=>J.value.answer_text),Z=e=>{e?J.value={answer_text:e.answer_text||"",media_links:Array.isArray(e.media_links)?e.media_links:[],attachments:Array.isArray(e.attachments)?e.attachments:[],status:e.status||"draft",notes:e.notes||"",is_public:e.is_public||!1}:(J.value={answer_text:"",media_links:[],attachments:[],status:"draft",notes:"",is_public:!1},G.value={},H.value=null)},ee=()=>{if(!Y.value)return void R.notify({type:"negative",message:"Please provide an answer text",position:"top"});T.value=!0,G.value={};const e={...J.value,question_id:O.questionId};X.value&&(e.id=O.answer.id),H.value&&H.value.length>0&&(e.new_files=H.value),P("save",e)},ae=e=>{e.forEach(e=>{R.notify({type:"negative",message:`File "${e.file.name}" was rejected: ${e.failedPropValidation}`,position:"top"})})},le=e=>{if(0===e)return"0 Bytes";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["Bytes","KB","MB","GB"][a]};return x(()=>O.modelValue,e=>{D.value=e,e&&Z(O.answer)}),x(()=>O.answer,e=>{D.value&&Z(e)}),L({handleSaveComplete:()=>{T.value=!1,D.value=!1,H.value=null},handleSaveError:e=>{var a,l;T.value=!1,(null==(l=null==(a=e.response)?void 0:a.data)?void 0:l.errors)&&(G.value=e.response.data.errors)}}),(a,l)=>(y(),V(f,{modelValue:D.value,"onUpdate:modelValue":[l[6]||(l[6]=e=>D.value=e),l[7]||(l[7]=e=>a.$emit("update:modelValue",e))],persistent:""},{default:j(()=>[k(c,{style:{"min-width":"500px","max-width":"700px",width:"100%"}},{default:j(()=>[k(t,{class:"row items-center q-pb-none"},{default:j(()=>[A("div",E,U(X.value?"Edit Answer":"Add New Answer"),1),k(e),q(k(n,{icon:"close",flat:"",round:"",dense:""},null,512),[[s]])]),_:1}),k(w,{onSubmit:Q(ee,["prevent"]),class:"q-gutter-md"},{default:j(()=>[k(t,{class:"q-pt-none"},{default:j(()=>[A("div",I,[k(u,{modelValue:J.value.answer_text,"onUpdate:modelValue":l[0]||(l[0]=e=>J.value.answer_text=e),label:"Answer Text *",outlined:"",dense:"",type:"textarea",rows:"5",rules:[e=>!!e||"Answer text is required"],error:!!G.value.answer_text,"error-message":G.value.answer_text,hint:"The main answer content"},null,8,["modelValue","rules","error","error-message"]),k(u,{modelValue:K.value,"onUpdate:modelValue":l[1]||(l[1]=e=>K.value=e),label:"Media Links",outlined:"",dense:"",type:"textarea",rows:"3",hint:"Enter media URLs separated by commas (optional)",error:!!G.value.media_links,"error-message":G.value.media_links},null,8,["modelValue","error","error-message"]),A("div",$,[l[9]||(l[9]=A("div",{class:"text-subtitle2"},"Attachments",-1)),k(_,{modelValue:H.value,"onUpdate:modelValue":l[2]||(l[2]=e=>H.value=e),label:"Upload Files",outlined:"",dense:"",multiple:"",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.mp4,.mp3","max-files":"5","max-file-size":"10485760",onRejected:ae},{prepend:j(()=>[k(i,{name:"attach_file"})]),_:1},8,["modelValue"]),J.value.attachments&&J.value.attachments.length>0?(y(),B("div",z,[l[8]||(l[8]=A("div",{class:"text-caption text-grey-7"},"Current attachments:",-1)),k(o,{dense:""},{default:j(()=>[(y(!0),B(M,null,S(J.value.attachments,(e,a)=>(y(),V(r,{key:a,dense:""},{default:j(()=>[k(d,{avatar:""},{default:j(()=>{return[k(i,{name:(a=e.type,(null==a?void 0:a.includes("image"))?"image":(null==a?void 0:a.includes("video"))?"videocam":(null==a?void 0:a.includes("audio"))?"audiotrack":(null==a?void 0:a.includes("pdf"))?"picture_as_pdf":(null==a?void 0:a.includes("word"))||(null==a?void 0:a.includes("document"))?"description":"insert_drive_file")},null,8,["name"])];var a}),_:2},1024),k(d,null,{default:j(()=>[k(m,null,{default:j(()=>[C(U(e.name),1)]),_:2},1024),k(m,{caption:""},{default:j(()=>[C(U(le(e.size)),1)]),_:2},1024)]),_:2},1024),k(d,{side:""},{default:j(()=>[k(n,{icon:"delete",flat:"",round:"",dense:"",size:"sm",color:"negative",onClick:e=>(e=>{J.value.attachments.splice(e,1)})(a)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):F("",!0)]),k(b,{modelValue:J.value.status,"onUpdate:modelValue":l[3]||(l[3]=e=>J.value.status=e),options:W.value,label:"Status",outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options"]),k(u,{modelValue:J.value.notes,"onUpdate:modelValue":l[4]||(l[4]=e=>J.value.notes=e),label:"Notes",outlined:"",dense:"",type:"textarea",rows:"2",hint:"Optional notes or comments about this answer"},null,8,["modelValue"]),k(p,{modelValue:J.value.is_public,"onUpdate:modelValue":l[5]||(l[5]=e=>J.value.is_public=e),label:"Make this answer public",color:"primary"},null,8,["modelValue"])])]),_:1}),k(v,{align:"right",class:"q-pa-md"},{default:j(()=>[q(k(n,{flat:"",label:"Cancel",color:"grey-7",disable:T.value},null,8,["disable"]),[[s]]),k(n,{type:"submit",label:"Save",color:"primary",loading:T.value,disable:!Y.value},null,8,["loading","disable"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},[["__scopeId","data-v-aa31e36a"]]);export{L as default};
