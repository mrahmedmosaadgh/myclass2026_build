import{u as e,d as a,f as l,Q as o,aF as s,p as t,m as r,c as i,n,l as d,aP as u,b as c}from"./app-C-NJhdpe.js";import{Q as m}from"./QBadge-D_SrvMy0.js";import{Q as p}from"./QTd-D3bw3I77.js";import{Q as v}from"./QTable-D-FHlyjj.js";import{Q as h}from"./QSelect-B3f0Rrq3.js";import{Q as _}from"./QForm-CqbXDoyt.js";import{N as g,a as f,f as y,H as b,I as w,J as x,M as V,b as S,V as k,U as q,L as j,x as A,Z as C,_ as Q}from"./vendor-CUZ9QTQV.js";import{_ as U}from"./AppLayout-ClCiCQFL.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";import"./QMarkupTable-CDVIpyWz.js";import"./QLinearProgress-DLQRR2k-.js";import"./use-fullscreen-iiJPvjW2.js";import"./rtl-Cr6c3OOr.js";const H={class:"py-12"},N={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},R={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-6"},D={class:"flex justify-between items-center mb-6"},E={class:"flex space-x-2"},M={class:"text-h6"},P={class:"q-my-md bg-gray-50 p-3 rounded border border-gray-200"},T={key:0,class:"q-gutter-md q-pl-md border-l-4 border-indigo-500 q-mb-md"},$={key:1},F={__name:"Index",props:{schools:{type:Object,required:!0},hrs:{type:Array,required:!0}},setup(F){const L=e();g();const I=F,O=[{name:"name",required:!0,label:"School Name",align:"left",field:"name",sortable:!0},{name:"hr",align:"left",label:"Assigned HR",field:e=>{var a;return(null==(a=e.hr)?void 0:a.name)||"N/A"},sortable:!0},{name:"status",align:"center",label:"Status",field:"is_active",sortable:!0},{name:"actions",align:"right",label:"Actions"}],z=f(()=>I.hrs.map(e=>({label:e.name,value:e.id}))),B=y(""),J=y(!1),Z=y(!1),G=y(null),K=y(!1),W=y({name:"",h_r_id:null,create_new_hr:!1,hr_name:"",hr_email:"",hr_password:""}),X=()=>{W.value={name:"",h_r_id:null,create_new_hr:!1,hr_name:"",hr_email:"",hr_password:""},G.value=null,Z.value=!1},Y=(e=null)=>{G.value=e,W.value=e?{name:e.name,h_r_id:e.h_r_id,create_new_hr:!1,hr_name:"",hr_email:"",hr_password:""}:{name:"",h_r_id:null,create_new_hr:!1,hr_name:"",hr_email:"",hr_password:""},Z.value=!0},ee=()=>{Q.reload({only:["schools","hrs"],preserveScroll:!0,preserveState:!0})},ae=async()=>{var e,a,l,o;if(!W.value.name)return void L.notify({type:"warning",message:"School Name is required"});if(W.value.create_new_hr){if(!W.value.hr_name||!W.value.hr_email||!W.value.hr_password)return void L.notify({type:"warning",message:"All HR details are required"})}else if(!W.value.h_r_id)return void L.notify({type:"warning",message:"Please select an HR Manager"});K.value=!0;const s="/admin/school"+(G.value?`/${G.value.id}`:""),t={...W.value,...G.value&&{_method:"PUT"}};try{const e=await C.post(s,t);L.notify({type:"positive",message:e.data.message||(G.value?"School updated successfully":"School created successfully")}),closeModal(),ee()}catch(r){const s=(null==(a=null==(e=r.response)?void 0:e.data)?void 0:a.message)||"An error occurred while saving.";L.notify({type:"negative",message:s}),(null==(o=null==(l=r.response)?void 0:l.data)?void 0:o.errors)&&console.error(r.response.data.errors)}finally{K.value=!1}};return(e,g)=>(w(),b(U,{title:"Schools"},{header:x(()=>g[9]||(g[9]=[V("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Schools Management ",-1)])),default:x(()=>[V("div",H,[V("div",N,[V("div",R,[V("div",D,[V("div",E,[S(l,{modelValue:B.value,"onUpdate:modelValue":g[0]||(g[0]=e=>B.value=e),dense:"",outlined:"",placeholder:"Search schools...",class:"w-64"},{append:x(()=>[S(a,{name:"search"})]),_:1},8,["modelValue"])]),S(o,{color:"primary",icon:"add",label:"Add School",onClick:g[1]||(g[1]=e=>Y())})]),S(v,{rows:F.schools.data,columns:O,"row-key":"id",filter:B.value,loading:J.value,flat:"",bordered:""},{"body-cell-status":x(e=>[S(p,{props:e,class:"text-center"},{default:x(()=>[S(m,{color:e.row.is_active?"positive":"negative",label:e.row.is_active?"Active":"Inactive",class:"q-px-sm q-py-xs"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-actions":x(e=>[S(p,{props:e,class:"text-right"},{default:x(()=>[S(s,{flat:""},{default:x(()=>[S(o,{flat:"",round:"",size:"sm",color:e.row.is_active?"warning":"positive",icon:e.row.is_active?"block":"check_circle",onClick:a=>(e=>{const a=e.is_active?"Deactivate":"Activate";L.dialog({title:"Confirm Action",message:`Are you sure you want to ${a.toLowerCase()} <strong>${e.name}</strong>?`,html:!0,cancel:!0,persistent:!0}).onOk(()=>{C.post(`/admin/school/${e.id}/toggle-status`).then(e=>{L.notify({type:"positive",message:e.data.message||`School ${a}d successfully`}),ee()}).catch(e=>{L.notify({type:"negative",message:"Failed to update status"})})})})(e.row)},{default:x(()=>[S(t,null,{default:x(()=>[k(q(e.row.is_active?"Deactivate":"Activate"),1)]),_:2},1024)]),_:2},1032,["color","icon","onClick"]),S(o,{flat:"",round:"",size:"sm",color:"primary",icon:"edit",onClick:a=>Y(e.row)},{default:x(()=>[S(t,null,{default:x(()=>g[10]||(g[10]=[k("Edit")])),_:1})]),_:2},1032,["onClick"]),S(o,{flat:"",round:"",size:"sm",color:"negative",icon:"delete",onClick:a=>{return l=e.row,void L.dialog({title:"Delete School",message:`Are you sure you want to delete <strong>${l.name}</strong>? This cannot be undone.`,html:!0,ok:{label:"Delete",color:"negative"},cancel:!0,persistent:!0}).onOk(()=>{const e=new FormData;e.append("_method","DELETE"),C.post(`/admin/school/${l.id}`,e).then(e=>{L.notify({type:"positive",message:"School deleted successfully"}),ee()}).catch(e=>{L.notify({type:"negative",message:"Failed to delete school"})})});var l}},{default:x(()=>[S(t,null,{default:x(()=>g[11]||(g[11]=[k("Delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","filter","loading"])])])]),S(c,{modelValue:Z.value,"onUpdate:modelValue":g[8]||(g[8]=e=>Z.value=e),persistent:""},{default:x(()=>[S(r,{style:{"min-width":"500px"}},{default:x(()=>[S(i,null,{default:x(()=>[V("div",M,q(G.value?"Edit School":"Add New School"),1)]),_:1}),S(i,{class:"q-pt-none"},{default:x(()=>[S(_,{onSubmit:ae,class:"q-gutter-md"},{default:x(()=>[S(l,{modelValue:W.value.name,"onUpdate:modelValue":g[2]||(g[2]=e=>W.value.name=e),label:"School Name *",outlined:"",rules:[e=>!!e||"Name is required"]},null,8,["modelValue","rules"]),V("div",P,[S(n,{modelValue:W.value.create_new_hr,"onUpdate:modelValue":g[3]||(g[3]=e=>W.value.create_new_hr=e),label:"Create New HR Manager Account",color:"indigo"},null,8,["modelValue"])]),W.value.create_new_hr?(w(),j("div",T,[g[12]||(g[12]=V("div",{class:"text-subtitle2 text-indigo-700 q-mb-sm"},"New HR Details",-1)),S(l,{modelValue:W.value.hr_name,"onUpdate:modelValue":g[4]||(g[4]=e=>W.value.hr_name=e),label:"HR Manager Name *",outlined:"",dense:"",rules:[e=>!!e||"HR Name is required"]},null,8,["modelValue","rules"]),S(l,{modelValue:W.value.hr_email,"onUpdate:modelValue":g[5]||(g[5]=e=>W.value.hr_email=e),label:"HR Email *",type:"email",outlined:"",dense:"",rules:[e=>!!e||"Email is required",e=>/.+@.+\..+/.test(e)||"Invalid email format"]},null,8,["modelValue","rules"]),S(l,{modelValue:W.value.hr_password,"onUpdate:modelValue":g[6]||(g[6]=e=>W.value.hr_password=e),label:"Password *",type:"password",outlined:"",dense:"",rules:[e=>!!e||"Password is required"]},null,8,["modelValue","rules"])])):(w(),j("div",$,[S(h,{modelValue:W.value.h_r_id,"onUpdate:modelValue":g[7]||(g[7]=e=>W.value.h_r_id=e),options:z.value,label:"Assign Existing HR *",outlined:"","emit-value":"","map-options":"",rules:[e=>!!e||"Please select an HR Manager"]},null,8,["modelValue","options","rules"])]))]),_:1})]),_:1}),S(d,{align:"right",class:"text-primary"},{default:x(()=>[A(S(o,{flat:"",label:"Cancel",onClick:X},null,512),[[u]]),S(o,{color:"primary",label:G.value?"Update School":"Create School",loading:K.value,onClick:ae},null,8,["label","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{F as default};
