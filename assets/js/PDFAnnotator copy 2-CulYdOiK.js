import{Y as e}from"./index-j1xg8sjY.js";import a from"./html2canvas.esm-Cq3pa7K9.js";import{E as l}from"./jspdf.es.min-DYeqIxwp.js";import{o as t}from"./app-Buylb2AA.js";import{f as n,k as u,n as o,o as s,e as v,L as i,I as c,M as d,V as r,U as p,$ as g,S as f,x as h,ab as m,b,y as k}from"./vendor-CUZ9QTQV.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";const y={class:"pdf-draw-local"},w={class:"upload-section"},P={class:"upload-box"},x={key:0,class:"upload-content"},C={key:1,class:"selected-file"},R={key:0,class:"pdf-section"},L={class:"toolbar"},U=["disabled"],j={class:"navigation-bar"},D=["disabled"],E={class:"page-info"},M=["max"],F=["disabled"],S={class:"viewer-wrapper"},B={key:1,class:"no-pdf"},I=t({__name:"PDFAnnotator copy 2",setup(t){const I=n(""),_=n(""),O=n(1),T=n(1),A=n("black"),Y=n({}),H=n(!1),N=n([]),V=n(null);let X=null;const $=e=>{var a;const l=null==(a=e.target.files)?void 0:a[0];l&&("application/pdf"===l.type?l.size>52428800?alert("File too large (max 50 MB)"):(I.value&&URL.revokeObjectURL(I.value),I.value=URL.createObjectURL(l),_.value=l.name,Y.value={},O.value=1):alert("Please select a PDF file"))},q=()=>{I.value&&URL.revokeObjectURL(I.value),I.value="",_.value="",O.value=1,T.value=1,Y.value={},V.value&&V.value.getContext("2d").clearRect(0,0,V.value.width,V.value.height)},z=e=>{e&&e.totalPages&&(T.value=e.totalPages)},G=()=>{o(J)},J=()=>{if(!V.value)return;const e=V.value.parentElement.querySelector(".pdf-embed");if(!e)return;const a=e.getBoundingClientRect();V.value.width=a.width,V.value.height=a.height,V.value.style.width=a.width+"px",V.value.style.height=a.height+"px",X=V.value.getContext("2d"),X.lineWidth=3,X.lineCap="round",X.lineJoin="round",X.strokeStyle=A.value,Z()},W=e=>{"mousedown"===e.type&&e.preventDefault(),H.value=!0,N.value=[];const a=V.value.getBoundingClientRect(),l=e.clientX-a.left,t=e.clientY-a.top;N.value.push({x:l,y:t}),Y.value[O.value]||(Y.value[O.value]=[]),Y.value[O.value].push({color:A.value,points:N.value})},K=e=>{if(!H.value||!X)return;e.preventDefault();const a=V.value.getBoundingClientRect(),l=e.clientX-a.left,t=e.clientY-a.top;N.value.push({x:l,y:t});const n=N.value[N.value.length-2];X.beginPath(),X.moveTo(n.x,n.y),X.lineTo(l,t),X.stroke()},Q=e=>{H.value=!1},Z=()=>{if(!X)return;X.clearRect(0,0,V.value.width,V.value.height);(Y.value[O.value]||[]).forEach(e=>{X.strokeStyle=e.color,X.beginPath(),e.points.forEach((e,a)=>{0===a?X.moveTo(e.x,e.y):X.lineTo(e.x,e.y)}),X.stroke()})},ee=()=>{var e;return(null==(e=Y.value[O.value])?void 0:e.length)>0},ae=e=>{A.value=e,X&&(X.strokeStyle=e)},le=()=>{var e;(null==(e=Y.value[O.value])?void 0:e.length)>0&&(Y.value[O.value].pop(),Z())},te=()=>{Y.value[O.value]=[],Z()},ne=async()=>{var e;const l=null==(e=V.value)?void 0:e.parentElement;if(!l)return;const t=await a(l,{scale:1}),n=document.createElement("a");n.download=`annotated-page-${O.value}.png`,n.href=t.toDataURL(),n.click()},ue=async()=>{var e;const t=new l("p","mm","a4");let n=0;for(let l=1;l<=T.value;l++){O.value=l,await o(),await o();const u=null==(e=V.value)?void 0:e.parentElement;if(!u)continue;const s=await a(u,{scale:1}),v=s.toDataURL("image/png"),i=210,c=295;let d=s.height*i/s.width;n>0&&t.addPage();do{const e=c-n;newHeight>e&&(t.addPage(),n=0),t.addImage(v,"PNG",0,n,i,newHeight),d-=e,n=0}while(d>0);n=d-c}t.save("annotated-pdf-full.pdf")},oe=()=>{O.value>1&&O.value--},se=()=>{O.value<T.value&&O.value++},ve=()=>{O.value<1&&(O.value=1),O.value>T.value&&(O.value=T.value)};return u(O,()=>{o(()=>{J()})}),s(()=>{var e,a,l;null==(e=V.value)||e.addEventListener("touchstart",e=>{e.preventDefault(),W(e.touches[0])},{passive:!1}),null==(a=V.value)||a.addEventListener("touchmove",e=>{e.preventDefault(),K(e.touches[0])},{passive:!1}),null==(l=V.value)||l.addEventListener("touchend",Q,{passive:!1})}),v(()=>{I.value&&URL.revokeObjectURL(I.value)}),(a,l)=>(c(),i("div",y,[d("div",w,[l[6]||(l[6]=d("h2",{class:"title"},"Upload PDF to Draw on Any Page",-1)),d("label",P,[d("input",{type:"file",accept:".pdf",onChange:$,class:"file-input"},null,32),_.value?(c(),i("div",C,[l[5]||(l[5]=d("div",{class:"icon"},"âœ…",-1)),d("p",null,[l[4]||(l[4]=r("Loaded: ")),d("strong",null,p(_.value),1)]),d("button",{onClick:g(q,["prevent"]),class:"clear-btn"},"Change File")])):(c(),i("div",x,l[3]||(l[3]=[d("div",{class:"icon"},"ðŸ“„",-1),d("p",null,"Drag & drop or click to upload",-1),d("small",null,"Max 50 MB",-1)])))])]),I.value?(c(),i("div",R,[d("div",L,[d("button",{onClick:l[0]||(l[0]=e=>ae("black")),class:f({active:"black"===A.value})},"Black",2),d("button",{onClick:l[1]||(l[1]=e=>ae("red")),class:f({active:"red"===A.value})},"Red",2),d("button",{onClick:le,disabled:!ee},"Undo",8,U),d("button",{onClick:te},"Clear Page"),d("button",{onClick:ne},"Save Page as Image"),d("button",{onClick:ue},"Save All as PDF")]),d("div",j,[d("button",{onClick:oe,disabled:O.value<=1,class:"nav-btn"},"â† Previous",8,D),d("span",E,[l[7]||(l[7]=r(" Page ")),h(d("input",{"onUpdate:modelValue":l[2]||(l[2]=e=>O.value=e),onInput:ve,type:"number",min:"1",max:T.value,class:"page-input"},null,40,M),[[m,O.value,void 0,{number:!0}]]),r(" of "+p(T.value),1)]),d("button",{onClick:se,disabled:O.value>=T.value,class:"nav-btn"},"Next â†’",8,F)]),d("div",S,[b(k(e),{source:I.value,"page-number":O.value,onProgress:z,onRendered:G,class:"pdf-embed","enable-annotation":!1},null,8,["source","page-number"]),d("canvas",{ref_key:"canvas",ref:V,class:"draw-canvas",onMousedown:W,onMousemove:K,onMouseup:Q,onMouseleave:Q},null,544)])])):(c(),i("div",B,l[8]||(l[8]=[d("p",null,"Upload a PDF to start drawing on any page",-1)])))]))}},[["__scopeId","data-v-c86e35b1"]]);export{I as default};
