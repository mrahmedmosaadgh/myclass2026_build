import{r as e}from"./app-BxJhpxku.js";import{f as a,a as t,e as l,N as n,J as s,R as o,O as i,S as r,V as u,U as c}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";const v={class:"bar-container"},d={class:"meter-info"},m={class:"status-text"},f={class:"db-text"},h={key:0,class:"warning-flasher"},p=e({__name:"noise",setup(e){const p=a(!1),M=a(-100),g=a(50);let b=null,w=null,y=null,x=null;const A=t(()=>Math.max(20,Math.round(M.value+70))),k=t(()=>p.value&&A.value>g.value),C=t(()=>k.value?"#ff3b30":A.value>g.value-5?"#ffcc00":"#34c759"),j=t(()=>{const e=(A.value-20)/90*100;return Math.max(0,Math.min(100,e))}),S=t(()=>{const e=(g.value-20)/90*100;return Math.max(0,Math.min(100,e))}),_=a(null),q=()=>{p.value=!1,x&&cancelAnimationFrame(x),y&&(y.disconnect(),y=null),b&&(b.close(),b=null)},B=()=>{p.value?q():(async()=>{try{_.value=null,b=new(window.AudioContext||window.webkitAudioContext),w=b.createAnalyser(),w.fftSize=512,w.smoothingTimeConstant=.8;const e=await navigator.mediaDevices.getUserMedia({audio:!0});y=b.createMediaStreamSource(e),y.connect(w),p.value=!0,D()}catch(e){console.error("Microphone access denied or error:",e),_.value=e.message||"Microphone access denied",p.value=!1}})()},D=()=>{if(!w||!p.value)return;const e=w.frequencyBinCount,a=new Uint8Array(e);w.getByteTimeDomainData(a);let t=0;for(let n=0;n<e;n++){const e=(a[n]-128)/128;t+=e*e}const l=Math.sqrt(t/e);M.value=l>0?20*Math.log10(l):-100,x=requestAnimationFrame(D)};return l(()=>q()),(e,a)=>(s(),n("div",{class:c(["noise-meter-simple",{"is-listening":p.value}]),onClick:B},[o("div",v,[a[0]||(a[0]=o("div",{class:"bar-track"},null,-1)),o("div",{class:"bar-fill",style:r({height:j.value+"%",backgroundColor:C.value})},null,4),o("div",{class:"threshold-marker",style:r({bottom:S.value+"%"})},null,4)]),o("div",d,[o("div",m,u(p.value?"Listening...":"Paused"),1),o("div",f,u(p.value?Math.round(A.value):"--")+" dBA",1)]),k.value?(s(),n("div",h)):i("",!0)],2))}},[["__scopeId","data-v-bec7fa32"]]);export{p as default};
