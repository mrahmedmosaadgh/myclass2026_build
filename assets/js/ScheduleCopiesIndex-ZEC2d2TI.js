import{o as e,u as a,d as l,p as s,Q as o,m as t,c as i,l as c,b as r,aP as n}from"./app-CqJgtQaN.js";import{Q as u}from"./QSpinnerDots-COoAi2MP.js";import{u as d}from"./i18n-DE5KxGn8.js";import{f as m,a as p,o as v,af as y,M as g,J as h,b as f,N as b,z as j,I as w,W as _,V as S,K as V,F as Q,R as k,y as C,_ as x}from"./vendor-DuKqz2x4.js";import q from"./ScheduleCopyCard-CMJe26bH.js";import T from"./ScheduleCopyForm-BxH1nFni.js";import E from"./ScheduleCopyFilters-00dzlx58.js";import F from"./ScheduleSyncDialog-BenP2YR4.js";import D from"./CSTOverviewDialog-DYQq5r2Z.js";import P from"./WeeklyPlanMenu-CxtSFrop.js";import"./offline-BzIlwqNM.js";import"./ui-BITzTqrO.js";import"./StatusBadge-D9Y2PIHp.js";import"./QSpace-1qvgFvrB.js";import"./QSelect-DIrzf0A1.js";import"./rtl-Cr6c3OOr.js";import"./QForm-B30T44oJ.js";import"./schoolData-CkY39Iur.js";import"./QTd-ByoVTzgk.js";import"./QTable-BsElv-Vz.js";import"./QMarkupTable-zlNNuWrg.js";import"./QLinearProgress-YbspEMZC.js";import"./use-fullscreen-Dd3XWOIZ.js";import"./QBadge-Coi-CloS.js";import"./date-Caiy_slx.js";import"./QTab-ryoZpl60.js";import"./QTabs-HxdE4zj2.js";import"./WeeklySystemGuide-aGi-wzIy.js";import"./QTabPanel-ZKXTFaGG.js";import"./use-panel-CvVDQB6d.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-B9tZ3cBE.js";import"./MainSchoolData-DuZrTkSl.js";import"./SchoolSettingsDialog-ChrxNyz1.js";const U={class:"q-pa-md"},M={class:"row items-center q-mb-lg"},z={class:"col"},B={class:"q-ma-none text-weight-bold"},O={class:"text-grey-7 q-mb-none"},R={class:"col-auto"},$={key:0,class:"row justify-center q-pa-xl"},I={class:"text-h6 text-grey-7 q-mt-md"},J={class:"text-grey-6"},K={key:2,class:"row q-gutter-md"},W={class:"text-h6"},A=e({__name:"ScheduleCopiesIndex",setup(e){const{t:A}=d(),H=a(),L=m([]),N=m([]),G=m([]),X=m([]),Y=m(!1),Z=m(!1),ee=m(!1),ae=m(!1),le=m(!1),se=m(!1),oe=m(!1),te=m(!1),ie=m(!1),ce=m(!1),re=m(null),ne=m(null),ue=m(null),de=m({school_id:null,academic_year_id:null,semester_id:null,status:null}),me=p(()=>{let e=[...L.value];return de.value.school_id&&(e=e.filter(e=>e.school_id===de.value.school_id)),de.value.academic_year_id&&(e=e.filter(e=>e.academic_year_id===de.value.academic_year_id)),de.value.semester_id&&(e=e.filter(e=>e.semester_id===de.value.semester_id)),de.value.status&&(e=e.filter(e=>e.status===de.value.status)),e}),pe=async()=>{Y.value=!0;try{const e=await x.get("/admin/schedule-copies");L.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching schedule copies:",e),H.notify({type:"negative",message:A("common.errors.fetchFailed")})}finally{Y.value=!1}},ve=async()=>{Z.value=!0;try{const e=await x.get("/api/schools");N.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching schools:",e)}finally{Z.value=!1}},ye=async()=>{ee.value=!0;try{const e=await x.get("/api/academic-years");G.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching academic years:",e)}finally{ee.value=!1}},ge=async()=>{ae.value=!0;try{const e=await x.get("/api/semesters");X.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching semesters:",e)}finally{ae.value=!1}},he=()=>{re.value=null,oe.value=!0},fe=e=>{re.value={...e},oe.value=!0},be=async e=>{le.value=!0;try{if(e.isEdit)await x.put(`/admin/schedule-copies/${re.value.id}`,e),H.notify({type:"positive",message:A("common.updatedSuccessfully")});else{const a=await x.post("/admin/schedule-copies",e);e.auto_generate&&a.data.id?(await x.post("/admin/schedule-copies/create-entries",{schedule_copy_id:a.data.id}),H.notify({type:"positive",message:"Schedule copy created with schedule slots"})):H.notify({type:"positive",message:A("common.createdSuccessfully")})}oe.value=!1,await pe()}catch(a){console.error("Error saving schedule copy:",a),H.notify({type:"negative",message:A("common.errors.submitFailed")})}finally{le.value=!1}},je=async e=>{try{await x.put(`/admin/schedule-copies/${e.id}`,{status:"active"}),H.notify({type:"positive",message:A("common.activatedSuccessfully")}),await pe()}catch(a){console.error("Error activating:",a),H.notify({type:"negative",message:A("common.errors.activateFailed")})}},we=async e=>{try{await x.put(`/admin/schedule-copies/${e.id}`,{status:"archived"}),H.notify({type:"info",message:A("common.archivedSuccessfully")}),await pe()}catch(a){console.error("Error archiving:",a),H.notify({type:"negative",message:A("common.errors.archiveFailed")})}},_e=e=>{ne.value=e,te.value=!0},Se=async()=>{se.value=!0;try{await x.delete(`/admin/schedule-copies/${ne.value.id}`),H.notify({type:"positive",message:A("common.deletedSuccessfully")}),te.value=!1,await pe()}catch(e){console.error("Error deleting:",e),H.notify({type:"negative",message:A("common.errors.deleteFailed")})}finally{se.value=!1}},Ve=()=>{},Qe=e=>{ue.value=e,ie.value=!0},ke=()=>{H.notify({type:"positive",message:"Schedule synchronization updated",position:"top"})};return v(async()=>{await Promise.all([pe(),ve(),ye(),ge()])}),(e,a)=>{var d,m;const p=y("Head");return h(),g(Q,null,[f(p,{title:j(A)("weeklySystem.scheduleCopies.title")},null,8,["title"]),b("div",U,[f(P),b("div",M,[b("div",z,[b("h4",B,[f(l,{name:"content_copy",class:"q-mr-sm",color:"primary"}),_(" "+S(j(A)("weeklySystem.scheduleCopies.title")),1)]),b("p",O,S(j(A)("weeklySystem.scheduleCopies.subtitle")),1)]),b("div",R,[f(o,{color:"teal",icon:"preview",label:"CST Overview",outline:"",onClick:a[0]||(a[0]=e=>ce.value=!0),class:"q-mr-sm"},{default:V(()=>[f(s,null,{default:V(()=>a[6]||(a[6]=[_("View subject-teacher assignments overview")])),_:1})]),_:1}),f(o,{color:"primary",icon:"add",label:j(A)("common.create"),onClick:he},null,8,["label"])])]),f(E,{modelValue:de.value,"onUpdate:modelValue":a[1]||(a[1]=e=>de.value=e),schools:N.value,"academic-years":G.value,semesters:X.value,"loading-schools":Z.value,"loading-years":ee.value,"loading-semesters":ae.value,onFilter:Ve,class:"q-mb-lg"},null,8,["modelValue","schools","academic-years","semesters","loading-schools","loading-years","loading-semesters"]),Y.value?(h(),g("div",$,[f(u,{size:"50px",color:"primary"})])):me.value.length?(h(),g("div",K,[(h(!0),g(Q,null,k(me.value,e=>(h(),g("div",{key:e.id,class:"col-12 col-sm-6 col-md-4 col-lg-3"},[f(q,{copy:e,onEdit:fe,onActivate:je,onArchive:we,onDelete:_e,onSync:Qe},null,8,["copy"])]))),128))])):(h(),w(t,{key:1,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:V(()=>[f(l,{name:"folder_open",size:"64px",color:"grey-5"}),b("p",I,S(j(A)("weeklySystem.schoolBrowser.noDataTitle")),1),b("p",J,S(j(A)("common.noResults")),1),f(o,{color:"primary",icon:"add",label:j(A)("common.create"),onClick:he,class:"q-mt-md"},null,8,["label"])]),_:1})),f(T,{modelValue:oe.value,"onUpdate:modelValue":a[2]||(a[2]=e=>oe.value=e),"edit-data":re.value,schools:N.value,"academic-years":G.value,semesters:X.value,"loading-schools":Z.value,"loading-years":ee.value,"loading-semesters":ae.value,saving:le.value,onSubmit:be},null,8,["modelValue","edit-data","schools","academic-years","semesters","loading-schools","loading-years","loading-semesters","saving"]),f(r,{modelValue:te.value,"onUpdate:modelValue":a[3]||(a[3]=e=>te.value=e)},{default:V(()=>[f(t,{style:{"min-width":"350px"}},{default:V(()=>[f(i,{class:"row items-center"},{default:V(()=>[f(l,{name:"warning",color:"negative",size:"md",class:"q-mr-sm"}),b("span",W,S(j(A)("common.delete"))+" "+S(j(A)("weeklySystem.scheduleCopies.title")),1)]),_:1}),f(i,null,{default:V(()=>{var e;return[_(S(j(A)("common.confirmDelete"))+' "',1),b("strong",null,S(null==(e=ne.value)?void 0:e.name),1),_('"? '+S(j(A)("common.actionCannotBeUndone")),1)]}),_:1}),f(c,{align:"right"},{default:V(()=>[C(f(o,{flat:"",label:j(A)("common.cancel")},null,8,["label"]),[[n]]),f(o,{flat:"",label:j(A)("common.delete"),color:"negative",loading:se.value,onClick:Se},null,8,["label","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),f(F,{modelValue:ie.value,"onUpdate:modelValue":a[4]||(a[4]=e=>ie.value=e),"copy-id":null==(d=ue.value)?void 0:d.id,"copy-name":null==(m=ue.value)?void 0:m.name,onSynced:ke},null,8,["modelValue","copy-id","copy-name"]),f(D,{modelValue:ce.value,"onUpdate:modelValue":a[5]||(a[5]=e=>ce.value=e)},null,8,["modelValue"])])],64)}}},[["__scopeId","data-v-9338a7c2"]]);export{A as default};
