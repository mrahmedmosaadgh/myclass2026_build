import{u as e,f as a,Q as l,c as s,o as t,b as o,d as i,e as n}from"./app-CCwy2VVq.js";import{Q as d}from"./QSelect-DZElG_R-.js";import{Q as u}from"./QForm-C5vfISjA.js";import{Q as m}from"./QBadge-BmqcVL7P.js";import{a3 as r,f as c,k as p,a as v,_ as g,I as y,J as f,K as h,b as x,R as q,z as _,O as b,V as w}from"./vendor-BWKGNkNB.js";import{u as S}from"./schoolData-CWFtmgnE.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";const V={class:"row q-col-gutter-md"},j={class:"col-12"},k={class:"row q-col-gutter-md q-mt-none"},z={class:"col-12 col-md-4"},I={class:"col-12 col-md-4"},Q={class:"row justify-center q-gutter-md"},C={class:"text-weight-medium"},U={class:"text-weight-medium"},F={class:"text-weight-medium"},Y={__name:"SchoolSettingsDialog",props:{modelValue:{type:Boolean,default:!1},schoolId:{type:Number,required:!1,default:null}},emits:["update:modelValue","saved","cancel"],setup(Y,{emit:A}){const B=e(),D=S(),{schools:E}=r(D),J=Y,K=A,N=c(!1),O=c(null),P=c(null),R=c(null),T=c([]),$=c([]);p(()=>J.modelValue,e=>{N.value=e,e&&(J.schoolId&&(O.value=J.schoolId),M())}),p(N,e=>{K("update:modelValue",e)}),p(O,async e=>{e&&N.value&&await M()});const G=v(()=>O.value&&P.value&&R.value),H=e=>{const a=E.value.find(a=>a.id===e);return a?a.name:"Unknown School"},L=async e=>{e&&await D.setSchool(e)},M=async()=>{var e,a;try{if(T.value=D.academicYears,$.value=D.semesters,0===T.value.length){const e=await g.get("/api/academic-years");T.value=e.data.data||e.data}if(0===$.value.length){const e=await g.get("/api/semesters");$.value=e.data.data||e.data}O.value&&await W()}catch(l){B.notify({type:"negative",message:"Failed to load options",caption:(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||l.message})}},W=async()=>{var e,a;try{D.academicYearId&&(P.value=T.value.find(e=>e.id===D.academicYearId)||null),D.semesterId&&(R.value=$.value.find(e=>e.id===D.semesterId)||null)}catch(l){B.notify({type:"negative",message:"Failed to load current settings",caption:(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||l.message})}},X=async()=>{var e,a,l,s;if(G.value)try{await D.updateSchoolSettings({academic_year_id:(null==(e=P.value)?void 0:e.id)||null,semester_id:(null==(a=R.value)?void 0:a.id)||null}),B.notify({type:"positive",message:"School settings saved successfully"}),K("saved"),N.value=!1}catch(t){B.notify({type:"negative",message:"Failed to save settings",caption:(null==(s=null==(l=t.response)?void 0:l.data)?void 0:s.message)||t.message})}else B.notify({type:"warning",message:"Please fill in all required fields",caption:"All fields marked with * are required"})};return(e,r)=>(f(),y(n,{modelValue:N.value,"onUpdate:modelValue":r[4]||(r[4]=e=>N.value=e),persistent:"",maximized:""},{default:h(()=>[x(i,{style:{"max-width":"800px",margin:"auto"},class:"q-pa-lg"},{default:h(()=>[x(a,{class:"text-center"},{default:h(()=>r[5]||(r[5]=[q("div",{class:"text-h5 text-primary q-mb-sm"},"School Configuration",-1),q("div",{class:"text-subtitle1 text-grey"},"Set up school context for the weekly planning system",-1)])),_:1}),x(a,null,{default:h(()=>[x(u,{class:"q-gutter-y-md"},{default:h(()=>[q("div",V,[q("div",j,[x(d,{modelValue:O.value,"onUpdate:modelValue":[r[0]||(r[0]=e=>O.value=e),L],options:_(D).schools,"option-value":"id","option-label":"name",label:"Select School *",outlined:"",dense:"","emit-value":"","map-options":"",loading:_(D).loading,rules:[e=>!!e||"School selection is required"],class:"full-width"},{prepend:h(()=>[x(l,{name:"school",color:"primary"})]),_:1},8,["modelValue","options","loading","rules"])])]),q("div",k,[q("div",z,[x(d,{modelValue:P.value,"onUpdate:modelValue":r[1]||(r[1]=e=>P.value=e),options:T.value,"option-value":"id","option-label":"name",label:"Academic Year *",outlined:"",dense:"","map-options":"",rules:[e=>!!e||"Academic year is required"]},{prepend:h(()=>[x(l,{name:"calendar_month",color:"blue"})]),_:1},8,["modelValue","options","rules"])]),q("div",I,[x(d,{modelValue:R.value,"onUpdate:modelValue":r[2]||(r[2]=e=>R.value=e),options:$.value,"option-value":"id","option-label":"name",label:"Semester *",outlined:"",dense:"","map-options":"",rules:[e=>!!e||"Semester is required"]},{prepend:h(()=>[x(l,{name:"event",color:"indigo"})]),_:1},8,["modelValue","options","rules"])])])]),_:1})]),_:1}),x(s,{class:"q-my-md"}),x(a,{class:"text-center"},{default:h(()=>[r[6]||(r[6]=q("div",{class:"text-h6 text-weight-medium text-primary q-mb-md"},"Current Selection",-1)),q("div",Q,[O.value?(f(),y(m,{key:0,color:"primary",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:h(()=>[x(l,{name:"school",size:"18px",class:"q-mr-xs"}),q("span",C,w(H(O.value)),1)]),_:1})):b("",!0),P.value?(f(),y(m,{key:1,color:"blue-6",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:h(()=>[x(l,{name:"calendar_month",size:"18px",class:"q-mr-xs"}),q("span",U,w(P.value.name),1)]),_:1})):b("",!0),R.value?(f(),y(m,{key:2,color:"indigo-6",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:h(()=>[x(l,{name:"event",size:"18px",class:"q-mr-xs"}),q("span",F,w(R.value.name),1)]),_:1})):b("",!0)])]),_:1}),x(t,{align:"right",class:"q-pt-lg"},{default:h(()=>[x(o,{label:"Cancel",color:"grey",flat:"",onClick:r[3]||(r[3]=a=>e.$emit("cancel")),class:"q-px-md"}),x(o,{label:"Save Settings",icon:"save",color:"primary",onClick:X,disable:!G.value,class:"q-px-xl"},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{Y as default};
