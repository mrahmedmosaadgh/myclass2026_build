import{f as e,a,k as s,L as l,I as o,b as t,M as r,y as i,a3 as n,O as d,J as c,V as m,U as u,F as p,Q as v,x as b,aa as _,ac as h,_ as y}from"./vendor-CUZ9QTQV.js";import{_ as k}from"./PrimaryButton-DNYxrPcC.js";import{_ as f}from"./SecondaryButton-BH3tlEGv.js";import{_ as g}from"./Pagination-CZ87PeIC.js";import{_ as j}from"./DataTable-CQiV1Hx1.js";import w from"./DialogModal_7-CbZfiD7u.js";import{_ as x}from"./ImportExcel-DoBpCbxb.js";import{u as S,w as C}from"./xlsx-cMC2LkxH.js";import{aU as q}from"./app-C-NJhdpe.js";import"./LucideIcon-BIJr1cpK.js";import"./createLucideIcon-D8qi68V_.js";import"./align-right-BZZ7ajs4.js";import"./underline-o77cex9c.js";import"./image-odJN2dKV.js";import"./printer-D7revZzT.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";import"./Modal-BVf9TNwG.js";const A={class:"py-12"},T={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},N={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-6"},I={class:"flex justify-between items-center mb-6"},M={class:"flex space-x-2"},U={key:0,class:"mt-4"},D={class:"space-y-4"},E=["for"],V=["id","onUpdate:modelValue"],$={value:""},G=["value"],O=["type","id","onUpdate:modelValue","min"],P="/admin/classroom-subject-teacher",W={__name:"Index",props:{records:Object,options:{type:Object,default:()=>({schools:[],grades:[],classrooms:[],subjects:[],teachers:[]})}},setup(W){const F=W,L=e(!1),B=e(null),z=a(()=>{var e;return(null==(e=F.records)?void 0:e.data)||[]}),J=a(()=>{var e;return(null==(e=F.records)?void 0:e.links)||null}),Q=[{key:"school.name",label:"School"},{key:"grade.name",label:"Grade"},{key:"classroom.name",label:"Classroom"},{key:"subject.name",label:"Subject"},{key:"teacher.name",label:"Teacher"},{key:"classes_per_week",label:"Classes/Week"}],H=a(()=>{var e,a,s,l,o,t,r,i;return[{name:"school_id",label:"School",type:"select",required:!0,options:(null==(a=null==(e=F.options)?void 0:e.schools)?void 0:a.map(e=>({value:e.id,label:e.name})))||[]},{name:"classroom_id",label:"Classroom",type:"select",required:!0,options:(null==(l=null==(s=F.options)?void 0:s.classrooms)?void 0:l.map(e=>({value:e.id,label:e.name})))||[]},{name:"subject_id",label:"Subject",type:"select",required:!0,options:(null==(t=null==(o=F.options)?void 0:o.subjects)?void 0:t.map(e=>({value:e.id,label:e.name})))||[]},{name:"teacher_id",label:"Teacher",type:"select",required:!0,options:(null==(i=null==(r=F.options)?void 0:r.teachers)?void 0:i.map(e=>({value:e.id,label:e.name})))||[]},{name:"classes_per_week",label:"Classes per Week",type:"number",required:!0,min:1}]}),K=e({school_id:"",classroom_id:"",subject_id:"",teacher_id:"",classes_per_week:""});s(B,e=>{K.value=e?{school_id:e.school_id,classroom_id:e.classroom_id,subject_id:e.subject_id,teacher_id:e.teacher_id,classes_per_week:e.classes_per_week}:{school_id:"",classroom_id:"",subject_id:"",teacher_id:"",classes_per_week:""}});const R=(e=null)=>{B.value=e,L.value=!0},X=()=>{L.value=!1,B.value=null,K.value={school_id:"",classroom_id:"",subject_id:"",teacher_id:"",classes_per_week:""}},Y=()=>{q.start(),y.reload({only:["records"],preserveScroll:!0,preserveState:!0}).then(()=>{q.done()})},Z=()=>{q.start();const e=B.value?`${P}/${B.value.id}`:P;axios.post(e,{...B.value&&{_method:"PUT"},...K.value}).then(()=>{X(),Y()}).catch(e=>{var a,s;(null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.errors)&&console.error(e.response.data.errors)}).finally(()=>{q.done()})},ee=async e=>{if(confirm("Are you sure you want to delete this record?")){q.start();try{await axios.delete(`${P}/${e.id}`),Y()}catch(a){console.error("Delete error:",a)}finally{q.done()}}},ae=()=>{q.start();try{const e=[["School","Grade","Classroom","Subject","Teacher","Classes/Week"],...z.value.map(e=>{var a,s,l,o,t;return[(null==(a=e.school)?void 0:a.name)||"",(null==(s=e.grade)?void 0:s.name)||"",(null==(l=e.classroom)?void 0:l.name)||"",(null==(o=e.subject)?void 0:o.name)||"",(null==(t=e.teacher)?void 0:t.name)||"",e.classes_per_week]})],a=S.aoa_to_sheet(e),s=S.book_new();S.book_append_sheet(s,a,"Teacher Assignments");const l=`teacher_assignments_${(new Date).toISOString().split("T")[0]}.xlsx`;C(s,l)}catch(e){console.error("Export failed:",e),alert("Failed to export data")}finally{q.done()}},se=[{key:"school",label:"School Name",required:!0,description:"Must match an existing school name"},{key:"grade",label:"Grade Name",required:!0,description:"Must match an existing grade name"},{key:"classroom",label:"Classroom Name",required:!0,description:"Must match an existing classroom name"},{key:"subject",label:"Subject Name",required:!0,description:"Must match an existing subject name"},{key:"teacher",label:"Teacher Name",required:!0,description:"Must match an existing teacher name"},{key:"classes_per_week",label:"Classes per Week",required:!0,type:"number",description:"Number of classes per week"}];return(e,a)=>(o(),l(p,null,[t(i(n),{title:"Classroom Subject Teachers"}),r("div",A,[r("div",T,[r("div",N,[r("div",I,[r("div",M,[t(k,{onClick:a[0]||(a[0]=e=>R())},{default:c(()=>a[1]||(a[1]=[m(" Add New Assignment ")])),_:1}),t(x,{onImported:Y,"validate-url":P+"/validate-import","import-url":P+"/import",columns:se,"button-text":"Import Assignments","preview-title":"Preview Data"},null,8,["validate-url","import-url"]),t(f,{onClick:ae},{default:c(()=>a[2]||(a[2]=[m(" Export ")])),_:1})])]),t(j,{items:z.value,columns:Q,onEdit:R,onDelete:ee},null,8,["items"]),J.value?(o(),l("div",U,[t(g,{links:J.value},null,8,["links"])])):d("",!0)])])]),t(w,{show:L.value,title:B.value?"Edit Assignment":"Add New Assignment",fields:H.value,editing:!!B.value,onClose:X,onSubmitted:Z},{title:c(()=>[m(u(B.value?"Edit Assignment":"Add New Assignment"),1)]),content:c(()=>[r("div",D,[(o(!0),l(p,null,v(H.value,e=>(o(),l("div",{key:e.name,class:"grid grid-cols-1 gap-2"},[r("label",{for:e.name,class:"block text-sm font-medium text-gray-700"},u(e.label),9,E),"select"===e.type?b((o(),l("select",{key:0,id:e.name,"onUpdate:modelValue":a=>K.value[e.name]=a,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},[r("option",$,"Select "+u(e.label),1),(o(!0),l(p,null,v(e.options,e=>(o(),l("option",{key:e.value,value:e.value},u(e.label),9,G))),128))],8,V)),[[_,K.value[e.name]]]):b((o(),l("input",{key:1,type:e.type,id:e.name,"onUpdate:modelValue":a=>K.value[e.name]=a,min:e.min,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,8,O)),[[h,K.value[e.name]]])]))),128))])]),footer:c(()=>[t(f,{onClick:X},{default:c(()=>a[3]||(a[3]=[m(" Cancel ")])),_:1}),t(k,{class:"ml-3",onClick:Z},{default:c(()=>[m(u(B.value?"Update":"Create"),1)]),_:1})]),_:1},8,["show","title","fields","editing"])],64))}};export{W as default};
