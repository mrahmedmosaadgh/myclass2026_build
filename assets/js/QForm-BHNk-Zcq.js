import{I as o,X as t,ap as e,P as n,aq as a,ar as r}from"./app-CWAnT6CT.js";import{f as s,D as i,H as u,o as c,p as l,h as f,n as d,aj as m}from"./vendor-BWKGNkNB.js";const p=o({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(o,{slots:p,emit:v}){const b=l(),y=s(null);let h=0;const S=[];function x(t){const n="boolean"==typeof t?t:!0!==o.noErrorFocus,a=++h,r=(o,t)=>{v("validation"+(!0===o?"Success":"Error"),t)},s=o=>{const t=o.validate();return"function"==typeof t.then?t.then(t=>({valid:t,comp:o}),t=>({valid:!1,comp:o,err:t})):Promise.resolve({valid:t,comp:o})};return(!0===o.greedy?Promise.all(S.map(s)).then(o=>o.filter(o=>!0!==o.valid)):S.reduce((o,t)=>o.then(()=>s(t).then(o=>{if(!1===o.valid)return Promise.reject(o)})),Promise.resolve()).catch(o=>[o])).then(o=>{if(void 0===o||0===o.length)return a===h&&r(!0),!0;if(a===h){const{comp:t,err:a}=o[0];if(void 0!==a&&console.error(a),r(!1,t),!0===n){const t=o.find(({comp:o})=>"function"==typeof o.focus&&!1===e(o.$));void 0!==t&&t.comp.focus()}}return!1})}function g(){h++,S.forEach(o=>{"function"==typeof o.resetValidation&&o.resetValidation()})}function q(t){void 0!==t&&n(t);const e=h+1;x().then(n=>{e===h&&!0===n&&(void 0!==o.onSubmit?v("submit",t):void 0!==(null==t?void 0:t.target)&&"function"==typeof t.target.submit&&t.target.submit())})}function F(t){void 0!==t&&n(t),v("reset"),d(()=>{g(),!0===o.autofocus&&!0!==o.noResetFocus&&j()})}function j(){a(()=>{if(null===y.value)return;const o=y.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||y.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||y.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(y.value.querySelectorAll("[tabindex]"),o=>-1!==o.tabIndex);null==o||o.focus({preventScroll:!0})})}m(r,{bindComponent(o){S.push(o)},unbindComponent(o){const t=S.indexOf(o);-1!==t&&S.splice(t,1)}});let E=!1;return i(()=>{E=!0}),u(()=>{!0===E&&!0===o.autofocus&&j()}),c(()=>{!0===o.autofocus&&j()}),Object.assign(b.proxy,{validate:x,resetValidation:g,submit:q,reset:F,focus:j,getValidationComponents:()=>S}),()=>f("form",{class:"q-form",ref:y,onSubmit:q,onReset:F},t(p.default))}});export{p as Q};
