import{r as e}from"./app-NYt77MEb.js";import{f as t,o as n,A as o,N as i,J as s,R as l,a0 as a}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";const c={class:"pad"},r={class:"controls"},u=["disabled"],v=800,p=500,f=e({__name:"DrawingPad",setup(e){const f=t(null);let d=null;const h=t([]);let m=null,g=!1;const y=t(!1),x=t("#111"),w=t(3);function b(){const e=f.value,t=window.devicePixelRatio||1;e.width=v*t,e.height=p*t,e.style.width=v+"px",e.style.height=p+"px",d=e.getContext("2d"),d.scale(t,t),d.lineCap="round",d.lineJoin="round",d.strokeStyle=x.value,d.lineWidth=w.value,k()}function k(){d.clearRect(0,0,v,p)}function R(e){if(e.touches&&e.touches[0]){const t=f.value.getBoundingClientRect();return{x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}}{const t=f.value.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}}function j(e){const t=e.points;if(!(t.length<2)){d.strokeStyle=e.color,d.lineWidth=e.size,d.beginPath(),d.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length-1;e++){const n=(t[e].x+t[e+1].x)/2,o=(t[e].y+t[e+1].y)/2;d.quadraticCurveTo(t[e].x,t[e].y,n,o)}d.lineTo(t[t.length-1].x,t[t.length-1].y),d.stroke()}}function C(){k();for(const e of h.value)j(e);m&&j(m)}function T(e){g=!0;const t=R(e),n=performance.now();m={points:[{x:t.x,y:t.y,t:0}],color:x.value,size:w.value,_startTime:n},C()}function _(e){if(!g||!m)return;const t=R(e),n=performance.now()-m._startTime,o=m.points[m.points.length-1],i=t.x-o.x,s=t.y-o.y;i*i+s*s<1.5||(m.points.push({x:t.x,y:t.y,t:n}),C())}function z(){g&&(g=!1,m&&m.points.length>0&&(delete m._startTime,h.value.push(m)),m=null,C())}function L(){h.value=[],m=null,k()}function M(){const e={version:1,width:v,height:p,pen:{color:x.value,size:w.value},strokes:h.value.map(e=>({points:e.points,color:e.color,size:e.size}))},t=new Blob([JSON.stringify(e)],{type:"application/json"}),n=URL.createObjectURL(t),o=document.createElement("a");o.href=n,o.download=`drawing-${Date.now()}.json`,o.click(),URL.revokeObjectURL(n)}async function S(){if(y.value||0===h.value.length)return;y.value=!0,k();const e=performance.now();let t=0,n=0;requestAnimationFrame(function o(i){k();for(let e=0;e<t;e++)j(h.value[e]);const s=i-e;if(t>=h.value.length)return void(y.value=!1);const l=h.value[t],a=l.points[l.points.length-1].t,c=Math.min(s-n,a);!function(e,t){const n=[];for(const o of e.points){if(!(o.t<=t))break;n.push(o)}n.length>1&&(d.save(),j({...e,points:n}),d.restore()),n.length}(l,Math.max(0,c)),c>=a&&(t++,n=s),requestAnimationFrame(o)})}return n(()=>{b(),window.addEventListener("resize",b)}),o(()=>{window.removeEventListener("resize",b)}),(e,t)=>(s(),i("div",c,[l("canvas",{ref_key:"canvas",ref:f,class:"canvas",onMousedown:T,onMousemove:_,onMouseup:z,onMouseleave:z,onTouchstart:a(T,["prevent"]),onTouchmove:a(_,["prevent"]),onTouchend:a(z,["prevent"])},null,544),l("div",r,[l("button",{onClick:L},"Clear"),l("button",{onClick:M},"Save JSON"),l("button",{disabled:y.value,onClick:S},"Replay",8,u)])]))}},[["__scopeId","data-v-83b5b2c1"]]);export{f as default};
