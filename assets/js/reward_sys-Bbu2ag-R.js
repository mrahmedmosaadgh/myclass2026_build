import{Q as e}from"./QBtnToggle-5HzBn6ma.js";import{o as l,u as a,c as t,d as s,Q as o,p as i,m as n,b as r,n as d,a as u,h as c,i as v,j as m,l as p,e as g,f as b,C as f,aP as y,k as x,A as h}from"./app-Cs5CKgHw.js";import{Q as w}from"./QBadge-jxRwPSDj.js";import{Q as _,a as S}from"./QToolbar-0VdwqYbP.js";import{Q as k}from"./QTab-BrYgSklz.js";import{Q as $}from"./QTabs-BWwunJzN.js";import{Q as j}from"./QTabPanel-BXfuden_.js";import{Q as C}from"./QSelect-D-pA-eh-.js";import{Q as V}from"./QTabPanels-DzMXaeN6.js";import{u as I}from"./i18n-kquWfmcz.js";import{f as z,o as U,k as A,M as F,a as N,_ as P,af as E,N as Q,J as R,b as T,O as B,I as L,Q as D,K as O,V as q,z as M,l as W,W as G,F as K,R as J,y as Z,ag as H,ah as Y,U as X}from"./vendor-nQjeLEvd.js";import{r as ee}from"./reward_sys_point_action-oLy4sW63.js";import le from"./PeriodSelectionRefactored-CpWS9afW.js";import ae from"./ClassroomSelection-DYwWZZRl.js";import te from"./TopLeaderboard-BYZNqsS-.js";import se from"./StudentCard-y-pnjVrk.js";import oe from"./StudentGrouping-D15rzxxB.js";import ie from"./BehaviorIncidents-_VIlVGTD.js";import"./offline-BzIlwqNM.js";import"./ui-Bfjdq-TR.js";import"./rtl-Cr6c3OOr.js";import"./use-panel-FmIc7Z0R.js";import"./use-render-cache-CmTcazfP.js";import"./html2canvas.esm-Cq3pa7K9.js";import"./CertificateGenerator-B-sck8B_.js";import"./QSpace-Xg69Ss6f.js";import"./QBar-C5rvtwM8.js";import"./QSlider-CD2iG_xB.js";import"./jspdf.es.min-BJlCvzNI.js";import"./AvatarManager-D9N9HClK.js";import"./CameraCapture-5fFOxHSK.js";import"./vuedraggable.umd-C4qRof-w.js";import"./index-DTdDyFNb.js";import"./IncidentPrintReport-C5IgCbp2.js";const ne={class:"p-6 space-y-6 bg-gradient-to-br from-blue-50 to-indigo-50 min-h-screen"},re={class:"text-3xl font-bold"},de={class:"text-blue-100"},ue={class:"flex items-center justify-between bg-white p-4 rounded-lg border border-gray-200 shadow-sm"},ce={class:"flex items-center gap-4"},ve={class:"bg-blue-100 p-3 rounded-full text-blue-600"},me={class:"text-sm text-gray-500 font-medium"},pe={class:"text-lg font-bold text-gray-800 flex items-center gap-2"},ge={key:0},be={key:1,class:"text-gray-400 italic"},fe={class:"text-blue-600 font-mono bg-blue-50 px-2 py-0.5 rounded text-base"},ye={class:"text-xs text-gray-500 mt-1"},xe={key:0,class:"bg-gradient-to-r from-blue-50 to-indigo-50 p-3 rounded-lg border border-blue-200 shadow-sm"},he={class:"flex items-center justify-between flex-wrap gap-3"},we={class:"flex items-center gap-2"},_e={class:"text-sm font-bold text-gray-700"},Se={class:"flex items-center gap-3 flex-wrap"},ke={class:"flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg border border-blue-200"},$e={class:"flex flex-col"},je={class:"text-xs text-gray-500"},Ce={class:"text-lg font-bold text-blue-600"},Ve={class:"flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg border border-green-200"},Ie={class:"flex flex-col"},ze={class:"text-xs text-gray-500"},Ue={class:"text-lg font-bold text-green-600"},Ae={class:"flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg border border-red-200"},Fe={class:"flex flex-col"},Ne={class:"text-xs text-gray-500"},Pe={class:"text-lg font-bold text-red-600"},Ee={key:0,class:"mt-3 pt-3 border-t border-blue-200"},Qe={class:"text-xs font-semibold text-gray-600 mb-2 flex items-center gap-1"},Re={class:"bg-white border border-red-200 rounded-lg p-2"},Te={class:"flex flex-wrap gap-1.5"},Be={class:"max-w-7xl mx-auto space-y-8"},Le={class:"bg-white p-6 rounded-xl shadow-sm border border-gray-200"},De={class:"text-lg font-bold text-gray-700 mb-4 flex items-center gap-2"},Oe={class:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-100 flex justify-center"},qe={class:"text-sm text-gray-700"},Me={class:"font-bold text-blue-600 font-mono text-lg"},We={class:"bg-white p-6 rounded-xl shadow-sm border border-gray-200"},Ge={class:"text-lg font-bold text-gray-700 mb-4 flex items-center gap-2"},Ke={key:0,class:"mt-4"},Je={class:"text-md font-semibold text-gray-600 mb-3 flex items-center gap-2"},Ze={key:1,class:"text-center py-8 text-gray-400"},He={class:"absolute-right q-pa-sm flex items-center"},Ye={class:"space-y-4"},Xe={class:"flex justify-between items-center mb-4"},el={class:"text-xl font-bold"},ll={class:"flex gap-2"},al={class:"flex flex-wrap justify-center gap-6 p-4"},tl={class:""},sl={class:"flex items-center justify-between gap-4"},ol={class:"flex items-center gap-3 flex-1"},il={class:"font-bold text-gray-700"},nl={class:"mt-6"},rl={class:"mb-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200 shadow-sm"},dl={class:"flex items-center justify-between flex-wrap gap-3"},ul={class:"flex items-center gap-2"},cl={class:"font-bold text-gray-700"},vl={class:"flex items-center gap-2 flex-wrap"},ml={key:0,class:"mb-3 p-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg border border-indigo-200"},pl={class:"flex items-center justify-between"},gl={class:"font-bold text-indigo-900 flex items-center gap-2"},bl={class:"flex gap-2"},fl={class:"flex flex-wrap justify-center gap-4"},yl={class:"space-y-4"},xl={class:"mb-4"},hl={class:"text-xl font-bold mb-2"},wl={class:"text-sm text-gray-600"},_l={class:"p-4 bg-red-50 rounded-lg border border-red-200"},Sl={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},kl={class:"mt-2 text-sm"},$l={class:"flex flex-wrap justify-center gap-6 p-4"},jl={class:"space-y-4"},Cl={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Vl=["onClick"],Il={class:"flex items-start justify-between mb-3"},zl={class:"flex-1"},Ul={class:"font-semibold text-lg"},Al={class:"text-xs text-gray-600"},Fl={key:0,class:"text-xs text-red-600 mt-1"},Nl={class:"space-y-2"},Pl={class:"p-2 bg-green-100 rounded flex justify-between items-center"},El={class:"text-sm font-bold text-green-900"},Ql={class:"p-2 bg-red-100 rounded flex justify-between items-center"},Rl={class:"text-sm font-bold text-red-900"},Tl={class:"p-2 bg-blue-100 rounded flex justify-between items-center"},Bl={class:"text-lg font-bold text-blue-600"},Ll={class:"space-y-4"},Dl={class:"flex justify-between items-center mb-4"},Ol={class:"text-xl font-bold"},ql={key:0,class:"text-center py-8"},Ml={class:"text-gray-500 text-lg"},Wl={class:"flex items-start justify-between"},Gl={class:"flex-1"},Kl={class:"flex items-center gap-2 mb-1"},Jl={class:"font-bold text-lg"},Zl={class:"text-2xl"},Hl={class:"text-sm text-gray-700"},Yl={class:"text-xs text-gray-500 mt-1"},Xl={key:0,class:"text-xs text-gray-600 mt-1 italic"},ea={key:1,class:"text-xs text-red-600 mt-1"},la={class:"flex flex-col h-full gap-4"},aa={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},ta={class:"space-y-6"},sa={class:"flex justify-between items-center mb-6"},oa={class:"text-2xl font-bold text-gray-800"},ia={class:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200"},na={class:"flex items-center gap-3 mb-4"},ra={class:"text-xl font-bold text-green-800"},da={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},ua={class:"flex items-start justify-between mb-2"},ca={class:"flex items-center gap-2"},va={class:"text-3xl"},ma={class:"font-bold text-gray-800"},pa={class:"text-xs text-gray-500"},ga={class:"flex gap-1"},ba={class:"flex items-center justify-between mt-3 pt-3 border-t border-green-100"},fa={class:"text-lg font-bold text-green-600"},ya={key:0,class:"text-center py-8 text-gray-400"},xa={class:"bg-gradient-to-r from-red-50 to-rose-50 rounded-xl p-6 border border-red-200"},ha={class:"flex items-center gap-3 mb-4"},wa={class:"text-xl font-bold text-red-800"},_a={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Sa={class:"flex items-start justify-between mb-2"},ka={class:"flex items-center gap-2"},$a={class:"text-3xl"},ja={class:"font-bold text-gray-800"},Ca={class:"text-xs text-gray-500"},Va={class:"flex gap-1"},Ia={class:"flex items-center justify-between mt-3 pt-3 border-t border-red-100"},za={class:"text-lg font-bold text-red-600"},Ua={key:0,class:"text-center py-8 text-gray-400"},Aa={class:"text-2xl font-semibold text-gray-600"},Fa={class:"p-4 border-b border-blue-200 bg-blue-100/50"},Na={class:"font-bold text-blue-900 flex items-center gap-2 text-lg"},Pa={class:"flex-1 overflow-y-auto p-4 custom-scrollbar"},Ea={key:0,class:"text-center py-8 text-gray-400 italic text-sm"},Qa={key:1,class:"flex flex-col gap-2"},Ra={class:"flex flex-col leading-tight overflow-hidden w-full"},Ta={class:"font-bold text-2xl truncate"},Ba={class:"text-sm opacity-80 truncate"},La={class:"p-3 border-t border-blue-200 bg-white"},Da={class:"grid grid-cols-3 gap-2"},Oa={class:"flex-1 flex flex-col bg-white"},qa={class:"text-h6 font-bold flex items-center gap-2"},Ma={class:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3"},Wa=["onClick"],Ga={class:"font-bold text-xl leading-tight text-gray-800 line-clamp-2"},Ka={class:"flex justify-between items-center"},Ja={class:"text-h6"},Za=l({__name:"reward_sys",setup(l){const Za={select:"/audio/click-234708.mp3",reward:"/audio/purchase-success-384963.mp3",penalty:"/audio/error-010-206498.mp3"},Ha={},Ya=z(null),Xa=z(!1);U(()=>{for(const[l,a]of Object.entries(Za)){const e=new Audio(a);e.load(),Ha[l]=e}const e=localStorage.getItem("reward-system-bg-music");Xa.value="true"===e,Ya.value&&(Ya.value.volume=.1,Xa.value&&Ya.value.play().catch(e=>console.log("Autoplay prevented:",e)))}),A(Xa,e=>{localStorage.setItem("reward-system-bg-music",e),Ya.value&&(e?Ya.value.play().catch(e=>console.log("Playback error:",e)):Ya.value.pause())});const et=e=>{const l=Ha[e];l&&(l.currentTime=0,l.play().catch(e=>console.log("Sound play error:",e)))},{t:lt,locale:at}=I(),tt=e=>e?"ar"===at.value&&e.name_ar?e.name_ar:e.name:"",st=F(),ot=N(()=>{var e,l;const a=null==(l=null==(e=st.props.auth)?void 0:e.user)?void 0:l.school;return Array.isArray(a)&&a.length>0?a[0].logo_url:null}),it=N(()=>{const e=new Map;return mt.value.forEach(l=>{l.subject_id&&!e.has(l.subject_id)&&e.set(l.subject_id,{id:l.subject_id,name:l.subject_name,name_ar:l.subject_name_ar})}),Array.from(e.values())}),nt=N(()=>ft.value?mt.value.filter(e=>e.subject_id===ft.value):[]),rt=N(()=>{const e=pt.value.length;if(0===e)return{present:0,absent:0,absentList:[]};const l=pt.value.filter(e=>Ct.value[e.id]).length;return{present:l,absent:e-l,absentList:pt.value.filter(e=>!Ct.value[e.id])}}),dt=()=>{const e=rt.value.absentList.map(e=>"ar"===at.value&&e.name_ar?e.name_ar:e.name).join("\n");e&&navigator.clipboard.writeText(e).then(()=>{ut.notify({message:lt("rewardSys.session.copied"),color:"positive",icon:"content_copy",position:"top"})}).catch(e=>{console.error("Failed to copy: ",e)})};z("https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf");const ut=a(),ct=z("attendance"),vt=z("behavior_incidents");A(ct,(e,l)=>{e!==l&&($t.value=[])});const mt=z([]),pt=z([]),gt=z([]),bt=z(null),ft=z(null),yt=z((new Date).toISOString().split("T")[0]),xt=z(1),ht=z(1),wt=z(1),_t=z(1),St=z(null),kt=z(null),$t=z([]),jt=z({}),Ct=z({}),Vt=z({}),It=z([]);z([]);const zt=z(!1),Ut=z(!1),At=z(!1),Ft=z(!1),Nt=z(!1),Pt=z(null),Et=z(null),Qt=z({message:"",created:0,skipped:0}),Rt=z(!0),Tt=z(!1),Bt=z(!1),Lt=z("positive"),Dt=z(null),Ot=z("no_groups"),qt=z([]),Mt=z(!1),Wt=z(null),Gt=z(!1),Kt=z(null),Jt=z(!1),Zt=z({name:"",type:"positive",points:0,icon:""});A(ft,e=>{null!==e&&(localStorage.setItem("reward-system-selected-subject-id",e.toString()),console.log(`ðŸ’¾ Saved subject to localStorage: ${e}`))}),A(bt,e=>{null!==e&&(localStorage.setItem("reward-system-selected-classroom-id",e.toString()),console.log(`ðŸ’¾ Saved classroom to localStorage: ${e}`))}),A(xt,e=>{null!==e&&(localStorage.setItem("reward-system-selected-semester",e.toString()),console.log(`ðŸ’¾ Saved semester to localStorage: ${e}`))}),A(ht,e=>{null!==e&&(localStorage.setItem("reward-system-selected-week",e.toString()),console.log(`ðŸ’¾ Saved week to localStorage: ${e}`))}),A(wt,e=>{null!==e&&(localStorage.setItem("reward-system-selected-day",e.toString()),console.log(`ðŸ’¾ Saved day to localStorage: ${e}`))}),A(_t,e=>{null!==e&&(localStorage.setItem("reward-system-selected-period-number",e.toString()),console.log(`ðŸ’¾ Saved period number to localStorage: ${e}`))});const Ht=N(()=>`${xt.value}.${ht.value}.${wt.value}.${_t.value}`),Yt=N(()=>{console.log("ðŸ” All behaviors:",gt.value);const e=gt.value.filter(e=>{if(e.type)return"positive"===e.type||"reward"===e.type;return(e.value||e.points||0)>0});return console.log("âœ… Positive behaviors:",e),e}),Xt=N(()=>{const e=gt.value.filter(e=>{if(e.type)return"negative"===e.type||"penalty"===e.type;return(e.value||e.points||0)<0});return console.log("âš ï¸ Negative behaviors:",e),e}),es=N(()=>[{label:"No Groups",value:"no_groups",icon:"grid_view"},{label:"Name (Aâ†’Z)",value:"name_asc",icon:"sort_by_alpha"},{label:"Name (Zâ†’A)",value:"name_desc",icon:"sort_by_alpha"},...qt.value.map(e=>({label:e.name,value:e.id,icon:"groups"}))]),ls=N(()=>{const e=es.value.find(e=>e.value===Ot.value);return(null==e?void 0:e.icon)||"grid_view"}),as=N(()=>{if("no_groups"===Ot.value)return[{name:null,students:pt.value}];if("name_asc"===Ot.value){return[{name:null,students:[...pt.value].sort((e,l)=>(e.firstName||"").localeCompare(l.firstName||""))}]}if("name_desc"===Ot.value){return[{name:null,students:[...pt.value].sort((e,l)=>(l.firstName||"").localeCompare(e.firstName||""))}]}const e=qt.value.find(e=>e.id===Ot.value);if(!e)return[{name:null,students:pt.value}];const l=e.groups.map(e=>({name:e.name,students:pt.value.filter(l=>e.student_ids.includes(l.id))})),a=new Set(e.groups.flatMap(e=>e.student_ids)),t=pt.value.filter(e=>!a.has(e.id));return t.length>0&&l.push({name:"Unassigned",students:t}),l});function ts(){const e=pt.value.filter(e=>Ct.value[e.id]);$t.value=e.map(e=>e.id)}function ss(){const e=pt.value.filter(e=>Ct.value[e.id]),l=new Set($t.value),a=[];e.forEach(e=>{l.has(e.id)||a.push(e.id)}),$t.value=a}function os(e){0!==$t.value.length?(Lt.value=e,Dt.value=null,Bt.value=!0):ut.notify({message:"Please select students first",color:"warning",position:"top"})}async function is(){Dt.value&&("positive"===Lt.value?(St.value=Dt.value,await async function(){await xs(St.value),St.value=null}()):(kt.value=Dt.value,await ys()),Bt.value=!1,Dt.value=null)}async function ns(e){var l,a;const t=qt.value.findIndex(l=>l.id===e.id);t>=0?qt.value[t]=e:qt.value.push(e);try{const l=await P.post("/api/classroom-layouts/save",{classroom_id:bt.value,layouts:qt.value});if(!l.data.success)throw new Error(l.data.message||"Failed to save layout");ut.notify({message:`Layout "${e.name}" saved successfully!`,color:"positive",position:"top",icon:"check_circle"}),Ot.value=e.id,Mt.value=!1,Wt.value=null}catch(s){if(console.error("Error saving layout:",s),ut.notify({message:"Failed to save layout: "+((null==(a=null==(l=s.response)?void 0:l.data)?void 0:a.message)||s.message),color:"negative",position:"top",icon:"error"}),t>=0)qt.value.splice(t,1);else{const l=qt.value.findIndex(l=>l.id===e.id);l>=0&&qt.value.splice(l,1)}}}async function rs(e){var l,a;const t=qt.value.findIndex(l=>l.id===e);if(t<0)return;const s=qt.value[t];qt.value.splice(t,1),Ot.value===e&&(Ot.value="no_groups");try{const e=await P.post("/api/classroom-layouts/save",{classroom_id:bt.value,layouts:qt.value});if(!e.data.success)throw new Error(e.data.message||"Failed to delete layout");ut.notify({message:`Layout "${s.name}" deleted successfully!`,color:"positive",position:"top",icon:"delete"})}catch(o){console.error("Error deleting layout:",o),ut.notify({message:"Failed to delete layout: "+((null==(a=null==(l=o.response)?void 0:l.data)?void 0:a.message)||o.message),color:"negative",position:"top",icon:"error"}),qt.value.splice(t,0,s),"no_groups"===Ot.value&&(Ot.value=e)}}function ds(e){e?(Kt.value=e,Zt.value={name:e.name,type:e.type||(e.value>0?"positive":"negative"),points:e.value||e.points||0,icon:e.icon||""}):(Kt.value=null,Zt.value={name:"",type:"positive",points:0,icon:""}),Gt.value=!0}async function us(){var e,l;if(Zt.value.name&&Zt.value.type&&null!==Zt.value.points){Jt.value=!0;try{const e={name:Zt.value.name,name_ar:Zt.value.name_ar||null,type:Zt.value.type,value:Zt.value.points,points:Zt.value.points,icon:Zt.value.icon||null,school_id:1,year_id:2};if(Kt.value){const l=await P.put(`/api/behaviors/${Kt.value.id}`,e),a=gt.value.findIndex(e=>e.id===Kt.value.id);a>=0&&(gt.value[a]=l.data),ut.notify({message:"Behavior updated successfully!",color:"positive",icon:"check_circle"})}else{const l=await P.post("/api/behaviors",e);gt.value.push(l.data),ut.notify({message:"Behavior created successfully!",color:"positive",icon:"check_circle"})}Gt.value=!1,Kt.value=null}catch(a){console.error("Error saving behavior:",a),ut.notify({message:"Failed to save behavior: "+((null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||a.message),color:"negative",icon:"error"})}finally{Jt.value=!1}}else ut.notify({message:"Please fill in all required fields",color:"warning",position:"top"})}function cs(e){ut.dialog({title:"Confirm Delete",message:`Are you sure you want to delete "${e.name}"? This action cannot be undone.`,cancel:!0,persistent:!0,color:"negative"}).onOk(()=>{!async function(e){var l,a;try{await P.delete(`/api/behaviors/${e.id}`);const l=gt.value.findIndex(l=>l.id===e.id);l>=0&&gt.value.splice(l,1),ut.notify({message:"Behavior deleted successfully!",color:"positive",icon:"check_circle"})}catch(t){console.error("Error deleting behavior:",t),ut.notify({message:"Failed to delete behavior: "+((null==(a=null==(l=t.response)?void 0:l.data)?void 0:a.message)||t.message),color:"negative",icon:"error"})}}(e)})}function vs(e){yt.value=e.date,xt.value=e.semester,ht.value=e.week,wt.value=e.day,_t.value=e.periodNumber,console.log("ðŸ“… Period changed:",{periodCode:Ht.value,...e})}function ms(e){if(!Ct.value[e])return void ut.notify({message:"Cannot select absent students",color:"warning",position:"top",timeout:1e3});const l=$t.value.indexOf(e);-1===l?($t.value.push(e),et("select")):$t.value.splice(l,1)}function ps(e,l){if(l){const l=e.filter(e=>Ct.value[e.id]).map(e=>e.id),a=new Set($t.value);l.forEach(e=>a.add(e)),$t.value=Array.from(a),et("select")}else{const l=new Set(e.map(e=>e.id));$t.value=$t.value.filter(e=>!l.has(e))}}function gs(){$t.value=[]}async function bs(e){if(!e)return pt.value=[],$t.value=[],void(qt.value=[]);try{Ut.value=!0,pt.value=[],$t.value=[],Et.value=null,Qt.value={message:"",created:0,skipped:0},await async function(){if(bt.value)try{const e=await P.get("/api/classroom-layouts/load",{params:{classroom_id:bt.value}});e.data.success&&(qt.value=e.data.data||[])}catch(e){console.error("Error loading layouts:",e)}}()}catch(l){console.error("Failed to load classroom:",l),ut.notify({message:"Failed to load classroom: "+l.message,color:"negative",position:"top"})}finally{Ut.value=!1}}async function fs(){if(bt.value){Ut.value=!0,Qt.value={message:"Initializing...",created:0,skipped:0};try{const e={classroom_id:bt.value,date:yt.value,period_code:Ht.value},l=await P.post("/api/student-behaviors/init-classroom",e);if(l&&l.data){const e=l.data;Et.value=e.student_behaviors_mains_id,Qt.value={message:`Session initialized (created ${e.created}, skipped ${e.skipped})`,created:e.created,skipped:e.skipped};const a=e.student_behaviors||[],t=a.map(e=>({id:e.student.id,name:e.student.name||`Student ${e.student_id}`,name_ar:e.student.name_ar,firstName:e.student.first_name,secondName:e.student.second_name,lastName:e.student.last_name,avatar:e.student.avatar,behaviorRecordId:e.id}));pt.value=t,$t.value=[];const s={};for(const l of a)Ct.value[l.student_id]=void 0===l.attend||l.attend,s[l.student_id]={attend:void 0===l.attend||l.attend,points_plus:l.points_plus||0,points_minus:l.points_minus||0};jt.value=s,ut.notify({message:"Session initialized",color:"positive",position:"top"}),await Ss(),Rt.value=!1}}catch(e){console.error("Failed to init classroom session:",e),Qt.value={message:"Initialization failed",created:0,skipped:0},ut.notify({message:"Failed to init session: "+(e.message||"error"),color:"negative",position:"top"})}finally{Ut.value=!1}}}async function ys(){await xs(kt.value),kt.value=null}async function xs(e){if($t.value.length&&e)try{At.value=!0;const l=await ee.applyBehaviorToStudents($t.value,e,{date:yt.value,periodCode:Ht.value,classroomId:bt.value});if(l.success){ut.notify({message:`Applied behavior to ${$t.value.length} students`,color:"positive",position:"top"});const l=gt.value.find(l=>l.id===e);if(l){const e=l.value||l.points||0;e>0&&et("reward"),e<0&&et("penalty")}await fs(),$t.value=[]}else ut.notify({message:l.error||"Failed to apply behavior",color:"negative",position:"top"})}catch(l){console.error("Error applying behavior:",l),ut.notify({message:l.message||"Error applying behavior",color:"negative",position:"top"})}finally{At.value=!1}}async function hs(e,l,a){Ct.value[e]=l,Vt.value[e]=!0,et("select");try{const a=await ee.updateAttendance(e,l,{date:yt.value,periodCode:Ht.value,classroomId:bt.value});if(!a.success)throw new Error(a.error||"Failed to update attendance");ut.notify({message:a.message||"Attendance updated",color:"positive",position:"top"}),!1===l&&await fs()}catch(t){console.error("Failed to persist attendance for",e,t),Ct.value[e]=a,ut.notify({message:"Failed to update attendance. Reverted.",color:"negative",position:"top"})}finally{Vt.value[e]=!1}}async function ws(){Ft.value=!0;const e={};for(const a of pt.value)e[a.id]=!0,Ct.value[a.id]=!0;try{(await ee.batchUpdateAttendance(e,{date:yt.value,periodCode:Ht.value,classroomId:bt.value})).success&&ut.notify({message:"All students marked present",color:"positive",position:"top"})}catch(l){console.error("Failed to mark all present:",l),ut.notify({message:"Failed to mark all present",color:"negative",position:"top"})}finally{Ft.value=!1}}async function _s(){Ft.value=!0;const e={};for(const a of pt.value)e[a.id]=!1,Ct.value[a.id]=!1;try{(await ee.batchUpdateAttendance(e,{date:yt.value,periodCode:Ht.value,classroomId:bt.value})).success&&ut.notify({message:"All students marked absent",color:"warning",position:"top"})}catch(l){console.error("Failed to mark all absent:",l),ut.notify({message:"Failed to mark all absent",color:"negative",position:"top"})}finally{Ft.value=!1}}async function Ss(){Nt.value=!0;try{const e=await ee.getRecentActions({classroomId:bt.value,date:yt.value,limit:10});e.success?It.value=e.data:console.error("Failed to load history:",e.error)}catch(e){console.error("Error loading history:",e)}finally{Nt.value=!1}}function ks(e){if(!e)return"";return new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}async function $s(e){console.log("Incident recorded:",e),await fs(),ut.notify({message:"Behavior incident recorded (-1 point)",color:"warning",position:"top"})}return U(async()=>{try{console.log("ðŸš€ Initializing reward system...");const e=await P.get("/my_classes_with_students");mt.value=e.data,console.log(`âœ… Loaded ${mt.value.length} classrooms`);const l=localStorage.getItem("reward-system-selected-subject-id"),a=localStorage.getItem("reward-system-selected-classroom-id");l&&it.value.some(e=>e.id===parseInt(l))?(ft.value=parseInt(l),console.log(`ðŸ“š Restored subject from localStorage: ${l}`)):it.value.length>0&&(ft.value=it.value[0].id,console.log(`ðŸ“š Auto-selected first subject: ${it.value[0].name}`)),a&&mt.value.some(e=>e.classroom_id===parseInt(a))&&(bt.value=parseInt(a),console.log(`ðŸ« Restored classroom from localStorage: ${a}`));const t=localStorage.getItem("reward-system-selected-semester"),s=localStorage.getItem("reward-system-selected-week"),o=localStorage.getItem("reward-system-selected-day"),i=localStorage.getItem("reward-system-selected-period-number");t&&(xt.value=parseInt(t),console.log(`ðŸ“… Restored semester from localStorage: ${t}`)),s&&(ht.value=parseInt(s),console.log(`ðŸ“… Restored week from localStorage: ${s}`)),o&&(wt.value=parseInt(o),console.log(`ðŸ“… Restored day from localStorage: ${o}`)),i&&(_t.value=parseInt(i),console.log(`ðŸ“… Restored period number from localStorage: ${i}`)),console.log(`ðŸ”¢ Active Period Code: ${xt.value}.${ht.value}.${wt.value}.${_t.value}`);const n=await ee.fetchBehaviors();n.success?(gt.value=n.data,console.log(`âœ… Loaded ${gt.value.length} behaviors`),console.log("ðŸ“‹ Behaviors data:",gt.value),gt.value=gt.value.map(e=>({...e,value:e.value||e.points||0})),console.log("ðŸ“‹ Normalized behaviors:",gt.value)):(console.error("âŒ Failed to load behaviors:",n.error),ut.notify({message:"Failed to load behaviors: "+n.error,color:"negative",position:"top"})),console.log("âœ… Reward system initialized")}catch(e){console.error("âŒ Failed to initialize reward system:",e),ut.notify({message:"Failed to initialize reward system: "+e.message,color:"negative",position:"top"})}}),(l,a)=>{const I=E("Head");return R(),Q(K,null,[T(I,{title:"Reward System"}),B("div",ne,[T(n,{class:"shadow-lg rounded-2xl overflow-hidden"},{default:O(()=>[T(t,{class:"bg-gradient-to-r from-blue-500 to-indigo-600 text-white flex justify-between items-center"},{default:O(()=>[B("div",null,[B("h1",re,"ðŸ† "+q(l.$t("rewardSys.behaviors.management")),1),B("p",de,q(l.$t("rewardSys.behaviors.management")),1)]),T(e,{modelValue:M(at),"onUpdate:modelValue":a[0]||(a[0]=e=>W(at)?at.value=e:null),options:[{label:"ðŸ‡¬ðŸ‡§ English",value:"en"},{label:"ðŸ‡¸ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",value:"ar"}],flat:"",color:"white","text-color":"white","toggle-color":"white","toggle-text-color":"primary",unelevated:""},null,8,["modelValue"])]),_:1}),T(t,{class:"p-6 space-y-4"},{default:O(()=>{var e;return[B("div",ue,[B("div",ce,[B("div",ve,[T(s,{name:"event_note",size:"md"})]),B("div",null,[B("div",me,q(l.$t("rewardSys.session.current")),1),B("div",pe,[bt.value?(R(),Q("span",ge,q((null==(e=mt.value.find(e=>e.classroom_id===bt.value))?void 0:e.classroom_name)||l.$t("rewardSys.session.unknownClass")),1)):(R(),Q("span",be,q(l.$t("rewardSys.session.noClassroom")),1)),a[33]||(a[33]=B("span",{class:"text-gray-300"},"|",-1)),B("span",fe,q(Ht.value),1)]),B("div",ye,q(new Date(yt.value).toLocaleDateString())+" â€¢ Period "+q(_t.value),1)])]),T(o,{color:"primary",icon:"settings",label:l.$t("rewardSys.session.setupButton"),onClick:a[1]||(a[1]=e=>Rt.value=!0),size:"lg",class:"shadow-md"},null,8,["label"])]),bt.value?(R(),Q("div",xe,[B("div",he,[B("div",we,[T(s,{name:"groups",class:"text-blue-600",size:"sm"}),B("span",_e,q(l.$t("rewardSys.session.classroomSummary")),1)]),B("div",Se,[B("div",ke,[T(s,{name:"people",class:"text-blue-600",size:"sm"}),B("div",$e,[B("span",je,q(l.$t("rewardSys.session.total")),1),B("span",Ce,q(pt.value.length),1)])]),B("div",Ve,[T(s,{name:"check_circle",class:"text-green-600",size:"sm"}),B("div",Ie,[B("span",ze,q(l.$t("rewardSys.session.present")),1),B("span",Ue,q(rt.value.present),1)])]),B("div",Ae,[T(s,{name:"cancel",class:"text-red-600",size:"sm"}),B("div",Fe,[B("span",Ne,q(l.$t("rewardSys.session.absent")),1),B("span",Pe,q(rt.value.absent),1)])]),T(o,{dense:"",color:"primary",icon:"content_copy",label:l.$t("rewardSys.session.copyList"),onClick:dt,disable:0===rt.value.absent,size:"sm",class:"shadow-sm"},{default:O(()=>[T(i,null,{default:O(()=>[G(q(l.$t("rewardSys.session.copyToClipboard")),1)]),_:1})]),_:1},8,["label","disable"])])]),rt.value.absent>0?(R(),Q("div",Ee,[B("div",Qe,[T(s,{name:"person_off",size:"xs",color:"red"}),B("span",null,q(l.$t("rewardSys.session.absentStudentsList")),1),T(w,{color:"red",label:rt.value.absent,class:"ml-1"},null,8,["label"])]),B("div",Re,[B("div",Te,[(R(!0),Q(K,null,J(rt.value.absentList,e=>(R(),L(f,{key:e.id,color:"red","text-color":"white",size:"sm",dense:"",icon:"person"},{default:O(()=>[G(q("ar"===M(at)&&e.name_ar?e.name_ar:e.name),1)]),_:2},1024))),128))])])])):D("",!0)])):D("",!0)]}),_:1})]),_:1}),T(r,{modelValue:Rt.value,"onUpdate:modelValue":a[10]||(a[10]=e=>Rt.value=e),"full-width":"","full-height":""},{default:O(()=>[T(n,{class:"flex flex-col bg-gray-50"},{default:O(()=>[T(_,{class:"bg-white border-b border-gray-200 p-4"},{default:O(()=>[T(S,{class:"text-xl font-bold text-gray-800 flex items-center gap-2"},{default:O(()=>[T(s,{name:"settings_suggest",color:"primary"}),G(" "+q(l.$t("rewardSys.session.setup")),1)]),_:1}),Z(T(o,{flat:"",round:"",dense:"",icon:"close"},null,512),[[y]])]),_:1}),T(t,{class:"flex-1 overflow-auto p-6"},{default:O(()=>[B("div",Be,[B("div",Le,[B("h3",De,[T(s,{name:"schedule",class:"text-blue-500"}),G(" "+q(l.$t("rewardSys.session.timePeriod")),1)]),T(le,{date:yt.value,semester:xt.value,week:ht.value,day:wt.value,"period-number":_t.value,"onUpdate:date":a[2]||(a[2]=e=>yt.value=e),"onUpdate:semester":a[3]||(a[3]=e=>xt.value=e),"onUpdate:week":a[4]||(a[4]=e=>ht.value=e),"onUpdate:day":a[5]||(a[5]=e=>wt.value=e),"onUpdate:periodNumber":a[6]||(a[6]=e=>_t.value=e),onChange:vs,persist:!0,persistKey:"reward-system-period-selection"},null,8,["date","semester","week","day","period-number"]),B("div",Oe,[B("p",qe,[G(q(l.$t("rewardSys.session.activePeriodCode"))+" ",1),B("span",Me,q(Ht.value),1)])])]),B("div",We,[B("h3",Ge,[T(s,{name:"school",class:"text-blue-500"}),G(" "+q(l.$t("rewardSys.session.subject")),1)]),T($,{modelValue:ft.value,"onUpdate:modelValue":a[7]||(a[7]=e=>ft.value=e),dense:"",class:"text-grey-7 mb-4","active-color":"primary","indicator-color":"primary",align:"left","narrow-indicator":""},{default:O(()=>[(R(!0),Q(K,null,J(it.value,e=>(R(),L(k,{key:e.id,name:e.id,label:"ar"===M(at)&&e.name_ar?e.name_ar:e.name,class:"text-sm"},null,8,["name","label"]))),128))]),_:1},8,["modelValue"]),ft.value?(R(),Q("div",Ke,[B("h4",Je,[T(s,{name:"class",class:"text-green-500"}),G(" "+q(l.$t("rewardSys.session.classroom")),1)]),T(ae,{modelValue:bt.value,"onUpdate:modelValue":a[8]||(a[8]=e=>bt.value=e),classrooms:nt.value,loading:Ut.value,"init-status":Qt.value,"avatar-edit-enabled":Tt.value,"onUpdate:avatarEditEnabled":a[9]||(a[9]=e=>Tt.value=e),onChange:bs,onInit:fs},null,8,["modelValue","classrooms","loading","init-status","avatar-edit-enabled"])])):(R(),Q("div",Ze,[T(s,{name:"subject",size:"3rem",class:"mb-2"}),B("p",null,q(l.$t("rewardSys.session.selectSubject")),1)]))])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),B("audio",{ref_key:"bgMusic",ref:Ya,loop:"",id:"bg-music"},a[34]||(a[34]=[B("source",{src:"/audio/background_music2.mp3",type:"audio/mpeg"},null,-1)]),512),pt.value.length?(R(),L(n,{key:0,class:"shadow-lg rounded-2xl"},{default:O(()=>[T($,{modelValue:ct.value,"onUpdate:modelValue":a[13]||(a[13]=e=>ct.value=e),dense:"",class:"text-grey-7","active-color":"primary","indicator-color":"primary",align:"left"},{default:O(()=>[T(k,{name:"attendance",icon:"how_to_reg",label:l.$t("rewardSys.tabs.attendance")},null,8,["label"]),T(k,{name:"positive",icon:"add_circle",label:l.$t("rewardSys.tabs.positivePoints")},null,8,["label"]),T(k,{name:"history",icon:"cancel",label:l.$t("rewardSys.tabs.history")},null,8,["label"]),T(k,{name:"champions",icon:"emoji_events",label:l.$t("rewardSys.tabs.champions"),onClick:a[11]||(a[11]=e=>zt.value=!0)},null,8,["label"]),T(k,{name:"settings_reports",icon:"settings_applications",label:l.$t("rewardSys.tabs.settingsReports")},null,8,["label"]),B("div",He,[T(d,{modelValue:Xa.value,"onUpdate:modelValue":a[12]||(a[12]=e=>Xa.value=e),"checked-icon":"music_note","unchecked-icon":"music_off",label:Xa.value?l.$t("rewardSys.musicOn"):l.$t("rewardSys.musicOff"),color:"primary"},null,8,["modelValue","label"])])]),_:1},8,["modelValue"]),T(u),T(V,{modelValue:ct.value,"onUpdate:modelValue":a[22]||(a[22]=e=>ct.value=e),animated:""},{default:O(()=>[T(j,{name:"attendance"},{default:O(()=>[B("div",Ye,[B("div",Xe,[B("h3",el,q(l.$t("rewardSys.attendance.manage")),1),B("div",ll,[T(o,{color:"positive",label:l.$t("rewardSys.attendance.markAllPresent"),onClick:ws,loading:Ft.value},null,8,["label","loading"]),T(o,{color:"warning",label:l.$t("rewardSys.attendance.markAllAbsent"),onClick:_s,loading:Ft.value},null,8,["label","loading"])])]),B("div",al,[(R(!0),Q(K,null,J(pt.value,e=>{var l,a,t,s;return R(),L(se,{key:e.id,student:e,"disable-behavior":!Ct.value[e.id],"allow-disabled-click":!0,"avatar-edit-enabled":Tt.value,"student-summary":{positive:(null==(l=jt.value[e.id])?void 0:l.points_plus)||0,negative:(null==(a=jt.value[e.id])?void 0:a.points_minus)||0,total:((null==(t=jt.value[e.id])?void 0:t.points_plus)||0)-((null==(s=jt.value[e.id])?void 0:s.points_minus)||0)},onSelect:l=>async function(e){const l=void 0===Ct.value[e]||Ct.value[e],a=!l;if(!1===a){const t=jt.value[e];if(t&&(t.points_plus>0||t.points_minus>0))return void ut.dialog({title:"Warning",message:`This student has ${t.points_plus} positive and ${t.points_minus} negative points for this session. Marking them absent will remove all their points for this session. Continue?`,cancel:!0,persistent:!0,ok:{label:"Yes, Mark Absent",color:"negative"},cancel:{label:"Cancel",color:"grey"}}).onOk(async()=>{await hs(e,a,l)})}await hs(e,a,l)}(e.id)},null,8,["student","disable-behavior","avatar-edit-enabled","student-summary","onSelect"])}),128))])])]),_:1}),T(j,{name:"positive"},{default:O(()=>[B("div",tl,[T(n,{class:"shadow-md rounded-xl mb-4"},{default:O(()=>[T(t,{class:"p-3 bg-gradient-to-r from-blue-50 to-indigo-50"},{default:O(()=>[B("div",sl,[B("div",ol,[T(s,{name:"view_module",size:"sm",color:"primary"}),B("span",il,q(l.$t("rewardSys.layout")),1),T(C,{modelValue:Ot.value,"onUpdate:modelValue":a[14]||(a[14]=e=>Ot.value=e),options:es.value,"option-value":"value","option-label":"label",outlined:"",dense:"","emit-value":"","map-options":"",class:"w-64"},{prepend:O(()=>[T(s,{name:ls.value},null,8,["name"])]),_:1},8,["modelValue","options"])]),T(o,{flat:"",color:"primary",icon:"settings",label:l.$t("rewardSys.manageGroups"),onClick:a[15]||(a[15]=e=>Mt.value=!0)},null,8,["label"])])]),_:1})]),_:1}),B("div",nl,[B("div",rl,[B("div",dl,[B("div",ul,[T(s,{name:"checklist",class:"text-blue-600",size:"sm"}),B("span",cl,q(l.$t("rewardSys.selected"))+": ",1),T(w,{label:$t.value.length,color:"blue",class:"text-lg"},null,8,["label"])]),B("div",vl,[T(o,{flat:"",dense:"",color:"primary",label:l.$t("rewardSys.selection.all"),size:"sm",onClick:ts,icon:"check_box",class:"bg-blue-100/50"},null,8,["label"]),T(o,{flat:"",dense:"",color:"primary",label:l.$t("rewardSys.selection.inv"),size:"sm",onClick:ss,icon:"swap_vert",class:"bg-blue-100/50"},null,8,["label"]),T(o,{flat:"",dense:"",color:"negative",label:l.$t("rewardSys.selection.clear"),size:"sm",onClick:gs,icon:"clear",class:"bg-red-100/50"},null,8,["label"]),T(u,{vertical:"",inset:"",class:"mx-2"}),T(o,{color:"positive",icon:"add",label:l.$t("rewardSys.points.title"),onClick:a[16]||(a[16]=e=>os("positive")),disable:0===$t.value.length,size:"sm"},null,8,["label","disable"]),T(o,{color:"negative",icon:"remove",label:l.$t("rewardSys.points.title"),onClick:a[17]||(a[17]=e=>os("negative")),disable:0===$t.value.length,size:"sm"},null,8,["label","disable"])])])]),(R(!0),Q(K,null,J(as.value,(e,a)=>(R(),Q("div",{key:a,class:"mb-6"},[e.name?(R(),Q("div",ml,[B("div",pl,[B("h4",gl,[T(s,{name:"groups"}),G(" "+q(e.name)+" ",1),T(w,{label:e.students.length,color:"indigo"},null,8,["label"])]),B("div",bl,[T(o,{dense:"",size:"sm",color:"indigo",icon:"check_box",label:l.$t("rewardSys.selection.all"),onClick:l=>ps(e.students,!0),outline:""},null,8,["label","onClick"]),T(o,{dense:"",size:"sm",color:"grey",icon:"check_box_outline_blank",label:l.$t("rewardSys.selection.clear"),onClick:l=>ps(e.students,!1),outline:""},null,8,["label","onClick"])])])])):D("",!0),B("div",fl,[(R(!0),Q(K,null,J(e.students,e=>{var l,a,t,s;return R(),L(se,{key:e.id,student:e,selected:$t.value.includes(e.id),"selected-id":$t.value.includes(e.id)?e.id:null,"disable-behavior":!Ct.value[e.id],"is-absent":!Ct.value[e.id],"allow-disabled-click":!1,"avatar-edit-enabled":Tt.value,"student-summary":{positive:(null==(l=jt.value[e.id])?void 0:l.points_plus)||0,negative:(null==(a=jt.value[e.id])?void 0:a.points_minus)||0,total:((null==(t=jt.value[e.id])?void 0:t.points_plus)||0)-((null==(s=jt.value[e.id])?void 0:s.points_minus)||0)},onSelect:l=>ms(e.id)},null,8,["student","selected","selected-id","disable-behavior","is-absent","avatar-edit-enabled","student-summary","onSelect"])}),128))])]))),128))])])]),_:1}),T(j,{name:"negative"},{default:O(()=>[B("div",yl,[B("div",xl,[B("h3",hl,q(l.$t("rewardSys.points.deduct")),1),B("p",wl,q(l.$t("rewardSys.points.selectStudentsNegative")),1)]),B("div",_l,[B("div",Sl,[T(C,{modelValue:kt.value,"onUpdate:modelValue":a[18]||(a[18]=e=>kt.value=e),options:Xt.value,"option-value":"id","option-label":"name",outlined:"",dense:"",placeholder:l.$t("rewardSys.points.selectNegativeBehavior"),"emit-value":"","map-options":""},{option:O(e=>[T(c,H(Y(e.itemProps)),{default:O(()=>[T(v,null,{default:O(()=>[T(m,null,{default:O(()=>[G(q(tt(e.opt)),1)]),_:2},1024),T(m,{caption:""},{default:O(()=>[G(q(e.opt.value||e.opt.points||0)+" points",1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","placeholder"]),T(o,{color:"negative",icon:"remove_circle",label:l.$t("rewardSys.points.applyToSelected"),onClick:ys,disable:!$t.value.length||!kt.value,loading:At.value},null,8,["label","disable","loading"])]),B("div",kl,[a[35]||(a[35]=G("Selected: ")),B("strong",null,q($t.value.length),1),a[36]||(a[36]=G(" students"))])]),B("div",$l,[(R(!0),Q(K,null,J(pt.value,e=>{var l,a,t,s;return R(),L(se,{key:e.id,student:e,selected:$t.value.includes(e.id),"selected-id":$t.value.includes(e.id)?e.id:null,"disable-behavior":!Ct.value[e.id],"allow-disabled-click":!1,"avatar-edit-enabled":Tt.value,"student-summary":{positive:(null==(l=jt.value[e.id])?void 0:l.points_plus)||0,negative:(null==(a=jt.value[e.id])?void 0:a.points_minus)||0,total:((null==(t=jt.value[e.id])?void 0:t.points_plus)||0)-((null==(s=jt.value[e.id])?void 0:s.points_minus)||0)},onSelect:l=>ms(e.id)},null,8,["student","selected","selected-id","disable-behavior","avatar-edit-enabled","student-summary","onSelect"])}),128))])])]),_:1}),T(j,{name:"old_card"},{default:O(()=>[B("div",jl,[a[40]||(a[40]=B("h3",{class:"text-xl font-bold mb-4"},"Old Card View",-1)),B("div",Cl,[(R(!0),Q(K,null,J(pt.value,e=>{var l,t,s,o;return R(),Q("div",{key:e.id,class:X(["p-4 border-2 rounded-lg transition",[Ct.value[e.id]?$t.value.includes(e.id)?"bg-green-100 border-green-500 cursor-pointer":"bg-white border-gray-200 cursor-pointer":"bg-gray-100 border-gray-300 opacity-50 cursor-not-allowed"]]),onClick:l=>Ct.value[e.id]&&ms(e.id)},[B("div",Il,[B("div",zl,[B("p",Ul,q(e.name),1),B("p",Al,"ID: "+q(e.id),1),Ct.value[e.id]?D("",!0):(R(),Q("p",Fl,"âŒ Absent"))]),T(x,{"model-value":$t.value.includes(e.id),"onUpdate:modelValue":l=>ms(e.id),disable:!Ct.value[e.id],color:"positive",size:"lg"},null,8,["model-value","onUpdate:modelValue","disable"])]),B("div",Nl,[B("div",Pl,[a[37]||(a[37]=B("span",{class:"text-xs font-semibold text-green-800"},"Positive",-1)),B("span",El,"+"+q((null==(l=jt.value[e.id])?void 0:l.points_plus)||0)+" â­",1)]),B("div",Ql,[a[38]||(a[38]=B("span",{class:"text-xs font-semibold text-red-800"},"Negative",-1)),B("span",Rl,"-"+q((null==(t=jt.value[e.id])?void 0:t.points_minus)||0)+" âš ï¸",1)]),B("div",Tl,[a[39]||(a[39]=B("span",{class:"text-xs font-semibold text-blue-800"},"Total",-1)),B("span",Bl,q(((null==(s=jt.value[e.id])?void 0:s.points_plus)||0)-((null==(o=jt.value[e.id])?void 0:o.points_minus)||0)),1)])])],10,Vl)}),128))])])]),_:1}),T(j,{name:"history"},{default:O(()=>[B("div",Ll,[B("div",Dl,[B("h3",Ol,q(l.$t("rewardSys.history.title")),1),T(o,{color:"primary",icon:"refresh",label:l.$t("rewardSys.history.refresh"),onClick:Ss,loading:Nt.value},null,8,["label","loading"])]),It.value.length?D("",!0):(R(),Q("div",ql,[B("p",Ml,q(l.$t("rewardSys.history.empty")),1)])),(R(!0),Q(K,null,J(It.value,e=>{var a,t,s;return R(),Q("div",{key:e.id,class:X(["p-4 bg-white rounded-lg border-l-4",[e.canceled?"border-gray-400 opacity-60":e.value>0?"border-green-500":"border-red-500"]])},[B("div",Wl,[B("div",Gl,[B("div",Kl,[B("span",Jl,q((null==(t=null==(a=e.student_behavior)?void 0:a.student)?void 0:t.name)||l.$t("rewardSys.history.unknown")),1),B("span",Zl,q(e.value>0?"â­":"âš ï¸"),1)]),B("p",Hl,[B("strong",null,q(tt(e.behavior)||l.$t("rewardSys.history.unknownBehavior")),1),B("span",{class:X(e.value>0?"text-green-600":"text-red-600")}," ("+q(e.value>0?"+":"")+q(e.value)+" "+q(l.$t("rewardSys.points.title"))+") ",3)]),B("p",Yl,q(ks(e.created_at))+" by "+q((null==(s=e.created_by)?void 0:s.name)||l.$t("rewardSys.history.unknown")),1),e.note?(R(),Q("p",Xl,q(l.$t("rewardSys.history.note"))+" "+q(e.note),1)):D("",!0),e.canceled?(R(),Q("p",ea," âŒ "+q(l.$t("rewardSys.history.canceled"))+" "+q(e.cancel_reason)+" ("+q(ks(e.canceled_at))+") ",1)):D("",!0)]),e.canceled?D("",!0):(R(),L(o,{key:0,color:"warning",icon:"undo",label:l.$t("rewardSys.history.undo"),size:"sm",onClick:l=>async function(e){Pt.value=e;try{const l=await ee.undoAction(e,"Undone by teacher");l.success?(ut.notify({message:"Action undone successfully",color:"positive",position:"top"}),await Ss(),await fs()):ut.notify({message:l.error||"Failed to undo action",color:"negative",position:"top"})}catch(l){console.error("Error undoing action:",l),ut.notify({message:"Error undoing action",color:"negative",position:"top"})}finally{Pt.value=null}}(e.id),loading:Pt.value===e.id},null,8,["label","onClick","loading"]))])],2)}),128))])]),_:1}),T(j,{name:"settings_reports",class:"p-4"},{default:O(()=>[B("div",la,[B("div",aa,[T($,{modelValue:vt.value,"onUpdate:modelValue":a[19]||(a[19]=e=>vt.value=e),align:"left",class:"text-gray-600 bg-gray-50 border-b border-gray-200","active-color":"primary","indicator-color":"primary",dense:""},{default:O(()=>[T(k,{name:"behavior_incidents",icon:"report_problem",label:l.$t("rewardSys.tabs.behaviorIncidents")},null,8,["label"]),T(k,{name:"behaviors",icon:"settings",label:l.$t("rewardSys.tabs.behaviors")},null,8,["label"])]),_:1},8,["modelValue"]),T(V,{modelValue:vt.value,"onUpdate:modelValue":a[21]||(a[21]=e=>vt.value=e),animated:"",class:"bg-transparent"},{default:O(()=>[T(j,{name:"behavior_incidents"},{default:O(()=>[T(ie,{students:pt.value,"classroom-id":bt.value,date:yt.value,"period-code":Ht.value,onIncidentRecorded:$s},null,8,["students","classroom-id","date","period-code"])]),_:1}),T(j,{name:"behaviors"},{default:O(()=>[B("div",ta,[B("div",sa,[B("h3",oa,q(l.$t("rewardSys.behaviors.management")),1),T(o,{color:"primary",icon:"add",label:l.$t("rewardSys.behaviors.addNew"),onClick:a[20]||(a[20]=e=>ds(null)),size:"md",class:"shadow-md"},null,8,["label"])]),B("div",ia,[B("div",na,[T(s,{name:"add_circle",size:"md",color:"positive"}),B("h4",ra,q(l.$t("rewardSys.behaviors.positiveSection")),1),T(w,{label:Yt.value.length,color:"positive"},null,8,["label"])]),B("div",da,[(R(!0),Q(K,null,J(Yt.value,e=>(R(),Q("div",{key:e.id,class:"bg-white rounded-lg p-4 shadow-sm border border-green-100 hover:shadow-md transition-all"},[B("div",ua,[B("div",ca,[B("div",va,q(e.icon||"â­"),1),B("div",null,[B("h5",ma,q(tt(e)),1),B("p",pa,"ID: "+q(e.id),1)])]),B("div",ga,[T(o,{flat:"",round:"",dense:"",icon:"edit",color:"primary",size:"sm",onClick:l=>ds(e)},{default:O(()=>[T(i,null,{default:O(()=>a[41]||(a[41]=[G("Edit")])),_:1})]),_:2},1032,["onClick"]),T(o,{flat:"",round:"",dense:"",icon:"delete",color:"negative",size:"sm",onClick:l=>cs(e)},{default:O(()=>[T(i,null,{default:O(()=>a[42]||(a[42]=[G("Delete")])),_:1})]),_:2},1032,["onClick"])])]),B("div",ba,[a[43]||(a[43]=B("span",{class:"text-sm text-gray-600"},"Points:",-1)),B("span",fa,"+"+q(e.value||e.points||0),1)])]))),128))]),0===Yt.value.length?(R(),Q("div",ya,[T(s,{name:"sentiment_neutral",size:"3rem",class:"mb-2"}),B("p",null,q(l.$t("rewardSys.behaviors.noPositive")),1)])):D("",!0)]),B("div",xa,[B("div",ha,[T(s,{name:"remove_circle",size:"md",color:"negative"}),B("h4",wa,q(l.$t("rewardSys.behaviors.negativeSection")),1),T(w,{label:Xt.value.length,color:"negative"},null,8,["label"])]),B("div",_a,[(R(!0),Q(K,null,J(Xt.value,e=>(R(),Q("div",{key:e.id,class:"bg-white rounded-lg p-4 shadow-sm border border-red-100 hover:shadow-md transition-all"},[B("div",Sa,[B("div",ka,[B("div",$a,q(e.icon||"âš ï¸"),1),B("div",null,[B("h5",ja,q(tt(e)),1),B("p",Ca,"ID: "+q(e.id),1)])]),B("div",Va,[T(o,{flat:"",round:"",dense:"",icon:"edit",color:"primary",size:"sm",onClick:l=>ds(e)},{default:O(()=>[T(i,null,{default:O(()=>a[44]||(a[44]=[G("Edit")])),_:1})]),_:2},1032,["onClick"]),T(o,{flat:"",round:"",dense:"",icon:"delete",color:"negative",size:"sm",onClick:l=>cs(e)},{default:O(()=>[T(i,null,{default:O(()=>a[45]||(a[45]=[G("Delete")])),_:1})]),_:2},1032,["onClick"])])]),B("div",Ia,[a[46]||(a[46]=B("span",{class:"text-sm text-gray-600"},"Points:",-1)),B("span",za,q(e.value||e.points||0),1)])]))),128))]),0===Xt.value.length?(R(),Q("div",Ua,[T(s,{name:"sentiment_neutral",size:"3rem",class:"mb-2"}),B("p",null,q(l.$t("rewardSys.behaviors.noNegative")),1)])):D("",!0)])])]),_:1})]),_:1},8,["modelValue"])])])]),_:1})]),_:1},8,["modelValue"])]),_:1})):D("",!0),pt.value.length?D("",!0):(R(),L(n,{key:1,class:"shadow-lg rounded-2xl"},{default:O(()=>[T(t,{class:"text-center py-12"},{default:O(()=>[B("p",Aa,"ðŸ“š "+q(l.$t("rewardSys.messages.selectClassroom")),1)]),_:1})]),_:1})),T(r,{modelValue:zt.value,"onUpdate:modelValue":a[23]||(a[23]=e=>zt.value=e),maximized:""},{default:O(()=>[T(n,null,{default:O(()=>[T(p,{align:"right"},{default:O(()=>[Z(T(o,{flat:"",label:"Close",color:"primary"},null,512),[[y]])]),_:1}),T(t,{class:"p-0"},{default:O(()=>[T(te,{students:pt.value,"student-behaviors":jt.value,"period-code":Ht.value,date:yt.value,"school-logo":ot.value},null,8,["students","student-behaviors","period-code","date","school-logo"])]),_:1}),T(p,{align:"right"},{default:O(()=>[Z(T(o,{flat:"",label:"Close",color:"primary"},null,512),[[y]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),T(r,{modelValue:Bt.value,"onUpdate:modelValue":a[24]||(a[24]=e=>Bt.value=e),"full-width":"",maxWidth:"1000px"},{default:O(()=>[T(n,{class:"flex flex-col md:flex-row h-[80vh] md:h-[70vh]"},{default:O(()=>[T(t,{class:"w-full md:w-1/3 bg-blue-50 border-r border-blue-100 flex flex-col p-0"},{default:O(()=>[B("div",Fa,[B("h4",Na,[T(s,{name:"checklist"}),G(" "+q(l.$t("rewardSys.selected"))+" ("+q($t.value.length)+") ",1)])]),B("div",Pa,[0===$t.value.length?(R(),Q("div",Ea,q(l.$t("rewardSys.messages.clickToSelect")),1)):(R(),Q("div",Qa,[(R(!0),Q(K,null,J($t.value,e=>(R(),L(f,{key:e,removable:"",onRemove:l=>ms(e),color:"white","text-color":"primary",class:"shadow-sm border border-blue-100 m-0 w-full"},{default:O(()=>{var l,a;return[T(h,{icon:"person",color:"primary","text-color":"white","font-size":"14px"}),B("div",Ra,[B("span",Ta,[G(q(null==(l=pt.value.find(l=>l.id===e))?void 0:l.firstName)+" ",1),B("span",Ba,q(null==(a=pt.value.find(l=>l.id===e))?void 0:a.lastName),1)])])]}),_:2},1032,["onRemove"]))),128))]))]),B("div",La,[B("div",Da,[T(o,{flat:"",dense:"",color:"primary",label:"All",size:"sm",onClick:ts,class:"bg-blue-50"}),T(o,{flat:"",dense:"",color:"primary",label:"Inv",size:"sm",onClick:ss,class:"bg-blue-50"}),T(o,{flat:"",dense:"",color:"negative",label:"Clear",size:"sm",onClick:gs,class:"bg-red-50"})])])]),_:1}),B("div",Oa,[T(t,{class:X("positive"===Lt.value?"bg-green-50 border-b border-green-100":"bg-red-50 border-b border-red-100")},{default:O(()=>[B("div",qa,[T(s,{name:"positive"===Lt.value?"add_circle":"remove_circle",color:"positive"===Lt.value?"positive":"negative"},null,8,["name","color"]),G(" "+q("positive"===Lt.value?l.$t("rewardSys.points.positiveTitle"):l.$t("rewardSys.points.negativeTitle")),1)])]),_:1},8,["class"]),T(t,{class:"flex-1 overflow-y-auto p-4 custom-scrollbar"},{default:O(()=>[B("div",Ma,[(R(!0),Q(K,null,J("positive"===Lt.value?Yt.value:Xt.value,e=>(R(),Q("div",{key:e.id,class:"cursor-pointer transition-all duration-200 relative group",onClick:l=>Dt.value=e.id},[B("div",{class:X(["h-full p-3 rounded-xl border-2 flex flex-col items-center text-center gap-2 hover:shadow-md transition-all",[Dt.value===e.id?"positive"===Lt.value?"border-green-500 bg-green-50 scale-105":"border-red-500 bg-red-50 scale-105":"border-gray-100 bg-white hover:border-gray-300"]])},[B("div",{class:X(["text-3xl p-3 rounded-full mb-1","positive"===Lt.value?"bg-green-100 text-green-600":"bg-red-100 text-red-600"])},q(e.icon||("positive"===Lt.value?"â­":"âš ï¸")),3),B("div",Ga,q(tt(e)),1),B("div",{class:X(["text-xl font-bold px-3 py-1 rounded-full mt-auto","positive"===Lt.value?"bg-green-200 text-green-800":"bg-red-200 text-red-800"])},q("positive"===Lt.value?"+":"")+q(e.value||e.points||0),3),Dt.value===e.id?(R(),Q("div",{key:0,class:X(["absolute top-2 right-2 text-xl drop-shadow-sm","positive"===Lt.value?"text-green-600":"text-red-600"])},[T(s,{name:"check_circle"})],2)):D("",!0)],2)],8,Wa))),128))])]),_:1}),T(p,{align:"right",class:"p-4 border-t border-gray-100 bg-gray-50 gap-3"},{default:O(()=>[Z(T(o,{flat:"",label:l.$t("rewardSys.tabs.cancel"),color:"grey-7",size:"lg",class:"font-bold"},null,8,["label"]),[[y]]),T(o,{color:"positive"===Lt.value?"positive":"negative",label:"positive"===Lt.value?l.$t("rewardSys.points.applyPositive"):l.$t("rewardSys.points.applyNegative"),icon:"positive"===Lt.value?"check_circle":"warning",onClick:is,disable:!Dt.value,loading:At.value,size:"lg",class:"px-8 font-bold shadow-md",push:""},null,8,["color","label","icon","disable","loading"])]),_:1})])]),_:1})]),_:1},8,["modelValue"]),T(r,{modelValue:Gt.value,"onUpdate:modelValue":a[30]||(a[30]=e=>Gt.value=e),persistent:""},{default:O(()=>[T(n,{class:"min-w-[500px]"},{default:O(()=>[T(t,{class:"bg-primary text-white"},{default:O(()=>[B("div",Ka,[B("div",Ja,q(Kt.value?l.$t("rewardSys.behaviors.edit"):l.$t("rewardSys.behaviors.create")),1),Kt.value&&!Kt.value.teacher_id?(R(),L(w,{key:0,color:"blue",label:"ðŸ”’ "+l.$t("rewardSys.behaviors.schoolDefault")},null,8,["label"])):D("",!0)])]),_:1}),T(t,{class:"q-pt-md space-y-4"},{default:O(()=>[Kt.value&&!Kt.value.teacher_id?(R(),L(g,{key:0,class:"bg-blue-50 text-blue-900",rounded:"",dense:""},{avatar:O(()=>[T(s,{name:"info",color:"blue"})]),default:O(()=>[G(" "+q(l.$t("rewardSys.behaviors.readOnlyWarning")),1)]),_:1})):D("",!0),T(b,{modelValue:Zt.value.name,"onUpdate:modelValue":a[25]||(a[25]=e=>Zt.value.name=e),label:"ðŸ‡¬ðŸ‡§ "+l.$t("rewardSys.behaviors.form.nameEn")+" *",outlined:"",dense:"",rules:[e=>!!e||"Name is required"],readonly:Kt.value&&!Kt.value.teacher_id},{prepend:O(()=>[T(s,{name:"translate"})]),_:1},8,["modelValue","label","rules","readonly"]),T(b,{modelValue:Zt.value.name_ar,"onUpdate:modelValue":a[26]||(a[26]=e=>Zt.value.name_ar=e),label:"ðŸ‡¸ðŸ‡¦ "+l.$t("rewardSys.behaviors.form.nameAr"),outlined:"",dense:"",dir:"rtl",readonly:Kt.value&&!Kt.value.teacher_id},{prepend:O(()=>[T(s,{name:"translate"})]),_:1},8,["modelValue","label","readonly"]),T(C,{modelValue:Zt.value.type,"onUpdate:modelValue":a[27]||(a[27]=e=>Zt.value.type=e),options:[{label:l.$t("rewardSys.behaviors.form.types.positive"),value:"positive"},{label:l.$t("rewardSys.behaviors.form.types.negative"),value:"negative"}],label:l.$t("rewardSys.behaviors.form.type")+" *",outlined:"",dense:"","emit-value":"","map-options":"",rules:[e=>!!e||"Type is required"],readonly:Kt.value&&!Kt.value.teacher_id},null,8,["modelValue","options","label","rules","readonly"]),T(b,{modelValue:Zt.value.points,"onUpdate:modelValue":a[28]||(a[28]=e=>Zt.value.points=e),modelModifiers:{number:!0},label:l.$t("rewardSys.behaviors.form.points")+" *",type:"number",outlined:"",dense:"",rules:[e=>null!==e&&""!==e||"Points are required"],hint:"positive"===Zt.value.type?"Positive number (e.g., 5)":"Negative number (e.g., -3)",readonly:Kt.value&&!Kt.value.teacher_id},null,8,["modelValue","label","rules","hint","readonly"]),T(b,{modelValue:Zt.value.icon,"onUpdate:modelValue":a[29]||(a[29]=e=>Zt.value.icon=e),label:l.$t("rewardSys.behaviors.form.icon"),outlined:"",dense:"",hint:"Optional emoji, e.g., â­ ðŸŽ‰ âš ï¸ ðŸš«",readonly:Kt.value&&!Kt.value.teacher_id},null,8,["modelValue","label","readonly"])]),_:1}),T(p,{align:"right",class:"q-px-md q-pb-md"},{default:O(()=>[Z(T(o,{flat:"",label:l.$t("rewardSys.tabs.cancel")},null,8,["label"]),[[y]]),!Kt.value||Kt.value.teacher_id?(R(),L(o,{key:0,color:"primary",label:Kt.value?l.$t("common.update"):l.$t("common.create"),onClick:us,loading:Jt.value},null,8,["label","loading"])):D("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),T(r,{modelValue:Mt.value,"onUpdate:modelValue":a[32]||(a[32]=e=>Mt.value=e),maximized:""},{default:O(()=>[T(oe,{students:pt.value,"saved-layouts":qt.value,"editing-layout":Wt.value,onSave:ns,onDelete:rs,onClose:a[31]||(a[31]=e=>Mt.value=!1)},null,8,["students","saved-layouts","editing-layout"])]),_:1},8,["modelValue"])])],64)}}},[["__scopeId","data-v-99a431c4"]]);export{Za as default};
