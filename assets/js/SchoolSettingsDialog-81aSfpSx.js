import{u as e,c as a,d as l,a as s,l as t,Q as o,m as i,b as n}from"./app-BB4Fw2oM.js";import{Q as d}from"./QSelect-BImwntZk.js";import{Q as u}from"./QForm-zhfWFjRn.js";import{Q as m}from"./QBadge-BkpTfeZ_.js";import{a3 as r,f as c,k as p,a as v,_ as g,I as y,J as f,K as h,b as x,N as q,z as b,Q as _,V as w}from"./vendor-DuKqz2x4.js";import{u as S}from"./schoolData-BRFwL7u7.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";import"./rtl-Cr6c3OOr.js";const V={class:"row q-col-gutter-md"},j={class:"col-12"},k={class:"row q-col-gutter-md q-mt-none"},Q={class:"col-12 col-md-4"},z={class:"col-12 col-md-4"},I={class:"row justify-center q-gutter-md"},C={class:"text-weight-medium"},U={class:"text-weight-medium"},F={class:"text-weight-medium"},Y={__name:"SchoolSettingsDialog",props:{modelValue:{type:Boolean,default:!1},schoolId:{type:Number,required:!1,default:null}},emits:["update:modelValue","saved","cancel"],setup(Y,{emit:A}){const N=e(),B=S(),{schools:D}=r(B),J=Y,K=A,P=c(!1),T=c(null),$=c(null),E=c(null),G=c([]),H=c([]);p(()=>J.modelValue,e=>{P.value=e,e&&(J.schoolId&&(T.value=J.schoolId),R())}),p(P,e=>{K("update:modelValue",e)}),p(T,async e=>{e&&P.value&&await R()});const L=v(()=>T.value&&$.value&&E.value),M=e=>{const a=D.value.find(a=>a.id===e);return a?a.name:"Unknown School"},O=async e=>{e&&await B.setSchool(e)},R=async()=>{var e,a;try{if(G.value=B.academicYears,H.value=B.semesters,0===G.value.length){const e=await g.get("/api/academic-years");G.value=e.data.data||e.data}if(0===H.value.length){const e=await g.get("/api/semesters");H.value=e.data.data||e.data}T.value&&await W()}catch(l){N.notify({type:"negative",message:"Failed to load options",caption:(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||l.message})}},W=async()=>{var e,a;try{B.academicYearId&&($.value=G.value.find(e=>e.id===B.academicYearId)||null),B.semesterId&&(E.value=H.value.find(e=>e.id===B.semesterId)||null)}catch(l){N.notify({type:"negative",message:"Failed to load current settings",caption:(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||l.message})}},X=async()=>{var e,a,l,s;if(L.value)try{await B.updateSchoolSettings({academic_year_id:(null==(e=$.value)?void 0:e.id)||null,semester_id:(null==(a=E.value)?void 0:a.id)||null}),N.notify({type:"positive",message:"School settings saved successfully"}),K("saved"),P.value=!1}catch(t){N.notify({type:"negative",message:"Failed to save settings",caption:(null==(s=null==(l=t.response)?void 0:l.data)?void 0:s.message)||t.message})}else N.notify({type:"warning",message:"Please fill in all required fields",caption:"All fields marked with * are required"})};return(e,r)=>(f(),y(n,{modelValue:P.value,"onUpdate:modelValue":r[4]||(r[4]=e=>P.value=e),persistent:"",maximized:""},{default:h(()=>[x(i,{style:{"max-width":"800px",margin:"auto"},class:"q-pa-lg"},{default:h(()=>[x(a,{class:"text-center"},{default:h(()=>r[5]||(r[5]=[q("div",{class:"text-h5 text-primary q-mb-sm"},"School Configuration",-1),q("div",{class:"text-subtitle1 text-grey"},"Set up school context for the weekly planning system",-1)])),_:1}),x(a,null,{default:h(()=>[x(u,{class:"q-gutter-y-md"},{default:h(()=>[q("div",V,[q("div",j,[x(d,{modelValue:T.value,"onUpdate:modelValue":[r[0]||(r[0]=e=>T.value=e),O],options:b(B).schools,"option-value":"id","option-label":"name",label:"Select School *",outlined:"",dense:"","emit-value":"","map-options":"",loading:b(B).loading,rules:[e=>!!e||"School selection is required"],class:"full-width"},{prepend:h(()=>[x(l,{name:"school",color:"primary"})]),_:1},8,["modelValue","options","loading","rules"])])]),q("div",k,[q("div",Q,[x(d,{modelValue:$.value,"onUpdate:modelValue":r[1]||(r[1]=e=>$.value=e),options:G.value,"option-value":"id","option-label":"name",label:"Academic Year *",outlined:"",dense:"","map-options":"",rules:[e=>!!e||"Academic year is required"]},{prepend:h(()=>[x(l,{name:"calendar_month",color:"blue"})]),_:1},8,["modelValue","options","rules"])]),q("div",z,[x(d,{modelValue:E.value,"onUpdate:modelValue":r[2]||(r[2]=e=>E.value=e),options:H.value,"option-value":"id","option-label":"name",label:"Semester *",outlined:"",dense:"","map-options":"",rules:[e=>!!e||"Semester is required"]},{prepend:h(()=>[x(l,{name:"event",color:"indigo"})]),_:1},8,["modelValue","options","rules"])])])]),_:1})]),_:1}),x(s,{class:"q-my-md"}),x(a,{class:"text-center"},{default:h(()=>[r[6]||(r[6]=q("div",{class:"text-h6 text-weight-medium text-primary q-mb-md"},"Current Selection",-1)),q("div",I,[T.value?(f(),y(m,{key:0,color:"primary",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:h(()=>[x(l,{name:"school",size:"18px",class:"q-mr-xs"}),q("span",C,w(M(T.value)),1)]),_:1})):_("",!0),$.value?(f(),y(m,{key:1,color:"blue-6",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:h(()=>[x(l,{name:"calendar_month",size:"18px",class:"q-mr-xs"}),q("span",U,w($.value.name),1)]),_:1})):_("",!0),E.value?(f(),y(m,{key:2,color:"indigo-6",size:"lg",class:"q-px-lg q-py-xs",style:{height:"40px"}},{default:h(()=>[x(l,{name:"event",size:"18px",class:"q-mr-xs"}),q("span",F,w(E.value.name),1)]),_:1})):_("",!0)])]),_:1}),x(t,{align:"right",class:"q-pt-lg"},{default:h(()=>[x(o,{label:"Cancel",color:"grey",flat:"",onClick:r[3]||(r[3]=a=>e.$emit("cancel")),class:"q-px-md"}),x(o,{label:"Save Settings",icon:"save",color:"primary",onClick:X,disable:!L.value,class:"q-px-xl"},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{Y as default};
