import{p as e,u as a,d as l,a as t,e as o,D as s,Q as i,aD as u,m as n,n as r}from"./app-Dccx8xF5.js";import{Q as d}from"./QTab-BJCUrT4L.js";import{Q as c}from"./QTabs-4quOvtr1.js";import{Q as v}from"./QFile-BhfveOyG.js";import{Q as p}from"./QTabPanel-QxVdoii7.js";import{Q as m}from"./QSlider-CeOdoP27.js";import{Q as f}from"./QSpace-BWA-UIs7.js";import{Q as g}from"./QTabPanels-DiqDdK2g.js";import{f as h,a as b,k as y,n as F,o as w,H as x,I as _,J as j,b as C,M as Q,L as k,O as S,V,Q as P,R as U,F as D,U as R,x as T,Z as q}from"./vendor-EI0FRBVb.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./ui-B__oX9pK.js";import"./rtl-Cr6c3OOr.js";import"./use-file-CcW7htgS.js";import"./use-panel-DP2_LoYb.js";import"./use-render-cache-CmTcazfP.js";const M={class:"column q-gutter-md"},I={key:0,class:"preview-container"},z=["src"],L={class:"column q-gutter-md"},O={class:"row q-gutter-sm items-center"},J={class:"row items-center q-gutter-xs"},E={class:"row items-center q-gutter-xs"},G={class:"text-caption"},N={class:"canvas-container"},W=e({__name:"PracticeSubmission",props:{progressId:{type:Number,required:!0},existingSubmission:{type:Object,default:null}},emits:["submitted","close"],setup(e,{emit:W}){const A=a(),B=e,H=W,X=h("upload"),Y=h(null),K=h(null),Z=h(null),$=h(null),ee=h(!1),ae=h("pen"),le=h("#000000"),te=h(3),oe=["#000000","#FF0000","#0000FF","#00FF00","#FFFF00","#FF00FF"],se=h(!1),ie=b(()=>"upload"===X.value?null!==Y.value:Z.value&&!me()),ue=e=>{if(e){const a=new FileReader;a.onload=e=>{K.value=e.target.result},a.readAsDataURL(e)}else K.value=null},ne=()=>{if(Z.value){const e=Z.value.parentElement;Z.value.width=e.offsetWidth,Z.value.height=400,$.value=Z.value.getContext("2d"),$.value.lineCap="round",$.value.lineJoin="round",$.value.fillStyle="#FFFFFF",$.value.fillRect(0,0,Z.value.width,Z.value.height)}};y(X,e=>{"draw"===e&&F(()=>{ne()})}),w(()=>{"draw"===X.value&&F(()=>{ne()})});const re=e=>{const a=Z.value.getBoundingClientRect(),l=Z.value.width/a.width,t=Z.value.height/a.height;return e.touches?{x:(e.touches[0].clientX-a.left)*l,y:(e.touches[0].clientY-a.top)*t}:{x:(e.clientX-a.left)*l,y:(e.clientY-a.top)*t}},de=e=>{if(!$.value)return;e.preventDefault(),ee.value=!0;const a=re(e);$.value.beginPath(),$.value.moveTo(a.x,a.y)},ce=e=>{if(!ee.value)return;e.preventDefault();const a=re(e);"pen"===ae.value?($.value.strokeStyle=le.value,$.value.lineWidth=te.value,$.value.globalCompositeOperation="source-over"):"eraser"===ae.value&&($.value.strokeStyle="#FFFFFF",$.value.lineWidth=2*te.value,$.value.globalCompositeOperation="destination-out"),$.value.lineTo(a.x,a.y),$.value.stroke()},ve=()=>{ee.value=!1},pe=()=>{$.value.fillStyle="#FFFFFF",$.value.fillRect(0,0,Z.value.width,Z.value.height)},me=()=>{const e=document.createElement("canvas");e.width=Z.value.width,e.height=Z.value.height;const a=e.getContext("2d");return a.fillStyle="#FFFFFF",a.fillRect(0,0,e.width,e.height),Z.value.toDataURL()===e.toDataURL()},fe=async()=>{var e,a;se.value=!0;try{const e=new FormData;"upload"===X.value?(e.append("submission_type","upload"),e.append("file",Y.value)):(e.append("submission_type","drawing"),e.append("drawing_data",Z.value.toDataURL("image/png")));const a=await q.post(route("lesson-presentation.progress.submit-practice",{id:B.progressId}),e,{headers:{"Content-Type":"multipart/form-data"}});A.notify({type:"positive",message:"Practice submitted successfully!",position:"top"}),H("submitted",a.data),H("close")}catch(l){console.error("Submission error:",l),A.notify({type:"negative",message:(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.error)||"Failed to submit practice",position:"top"})}finally{se.value=!1}};return(e,a)=>(_(),x(r,{style:{"min-width":"700px","max-width":"90vw"}},{default:j(()=>[C(l,null,{default:j(()=>a[6]||(a[6]=[Q("div",{class:"text-h6"},"Submit Practice Solution",-1),Q("div",{class:"text-caption text-grey-7"},"Upload an image or draw your solution",-1)])),_:1}),C(t),C(l,null,{default:j(()=>[C(c,{modelValue:X.value,"onUpdate:modelValue":a[0]||(a[0]=e=>X.value=e),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify"},{default:j(()=>[C(d,{name:"upload",label:"Upload Image",icon:"upload_file"}),C(d,{name:"draw",label:"Draw Solution",icon:"draw"})]),_:1},8,["modelValue"]),C(t,{class:"q-my-md"}),C(g,{modelValue:X.value,"onUpdate:modelValue":a[5]||(a[5]=e=>X.value=e),animated:""},{default:j(()=>[C(p,{name:"upload"},{default:j(()=>[Q("div",M,[C(v,{modelValue:Y.value,"onUpdate:modelValue":[a[1]||(a[1]=e=>Y.value=e),ue],label:"Choose an image",accept:"image/*","max-file-size":"5242880",outlined:"",clearable:""},{prepend:j(()=>[C(o,{name:"attach_file"})]),hint:j(()=>a[7]||(a[7]=[V(" Max file size: 5MB. Supported formats: JPG, PNG, GIF ")])),_:1},8,["modelValue"]),K.value?(_(),k("div",I,[a[8]||(a[8]=Q("div",{class:"text-subtitle2 q-mb-sm"},"Preview:",-1)),Q("img",{src:K.value,alt:"Preview",class:"preview-image"},null,8,z)])):S("",!0)])]),_:1}),C(p,{name:"draw"},{default:j(()=>[Q("div",L,[Q("div",O,[C(s,{outline:""},{default:j(()=>[C(i,{outline:"pen"!==ae.value,unelevated:"pen"===ae.value,color:"primary",icon:"edit",label:"Pen",onClick:a[2]||(a[2]=e=>ae.value="pen")},null,8,["outline","unelevated"]),C(i,{outline:"eraser"!==ae.value,unelevated:"eraser"===ae.value,color:"primary",icon:"cleaning_services",label:"Eraser",onClick:a[3]||(a[3]=e=>ae.value="eraser")},null,8,["outline","unelevated"])]),_:1}),C(t,{vertical:""}),Q("div",J,[a[9]||(a[9]=Q("span",{class:"text-caption text-grey-7"},"Color:",-1)),(_(),k(D,null,P(oe,e=>C(i,{key:e,style:U({backgroundColor:e}),outline:le.value!==e,size:"sm",round:"",onClick:a=>le.value=e,class:"color-btn"},{default:j(()=>[le.value===e?(_(),x(o,{key:0,name:"check",color:"white",size:"xs"})):S("",!0)]),_:2},1032,["style","outline","onClick"])),64))]),C(t,{vertical:""}),Q("div",E,[a[10]||(a[10]=Q("span",{class:"text-caption text-grey-7"},"Size:",-1)),C(m,{modelValue:te.value,"onUpdate:modelValue":a[4]||(a[4]=e=>te.value=e),min:1,max:10,step:1,style:{width:"100px"},color:"primary"},null,8,["modelValue"]),Q("span",G,R(te.value),1)]),C(f),C(i,{flat:"",color:"negative",icon:"delete",label:"Clear",onClick:pe})]),Q("div",N,[Q("canvas",{ref_key:"canvas",ref:Z,onMousedown:de,onMousemove:ce,onMouseup:ve,onMouseleave:ve,onTouchstart:de,onTouchmove:ce,onTouchend:ve,class:"drawing-canvas"},null,544)])])]),_:1})]),_:1},8,["modelValue"])]),_:1}),C(t),C(n,{align:"right"},{default:j(()=>[T(C(i,{flat:"",label:"Cancel",color:"grey"},null,512),[[u]]),C(i,{unelevated:"",label:"Submit",color:"primary",onClick:fe,loading:se.value,disable:!ie.value},null,8,["loading","disable"])]),_:1})]),_:1}))}},[["__scopeId","data-v-87a7c7e7"]]);export{W as default};
