import{r as e,u as a,f as l,Q as t,aS as s,b as o,h as i,G as r,p as u,o as n,d,e as m}from"./app-4gpSDtVV.js";import{Q as c}from"./QSpace-BaiVAeLS.js";import{Q as v}from"./QFile-vliiLupf.js";import{Q as p}from"./QSelect-Dgk9Cshp.js";import{Q as b}from"./QForm-B3HUaoek.js";import{r as w}from"./resumeApi-D4JEP9pi.js";import{a as f,f as h,k as g,e as y,I as x,J as _,K as V,b as q,R as k,y as A,W as j,V as U,N as M,O as R,F as Q,Q as S,z as B}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./use-file-Ce4kWIwa.js";import"./rtl-Cr6c3OOr.js";const F={class:"text-h6"},C={class:"q-mb-md"},D={class:"q-mb-md"},z={class:"q-mb-md"},E={key:0,class:"q-mt-sm"},I={class:"q-mb-md"},N={class:"row q-gutter-sm items-center"},L={key:0,class:"row items-center q-gutter-sm"},P={class:"text-caption"},O={class:"q-mb-md"},G={class:"q-mb-md"},T={class:"q-mb-md"},$=e({__name:"AnswerFormDialog",props:{modelValue:{type:Boolean,default:!1},answer:{type:Object,default:null},questionId:{type:Number,required:!0}},emits:["update:modelValue","save"],setup(e,{emit:$}){const J=e,K=$,W=a(),Y=f({get:()=>J.modelValue,set:e=>K("update:modelValue",e)}),H=h(!1),X=h({}),Z=h(null),ee=h(""),ae=h(!1),le=h(null),te=h(0),se=h(null),oe=h([]),ie=h({answer_text:"",media_links:[],attachments:[],status:"draft",notes:"",is_public:!1}),re=[{label:"Draft",value:"draft"},{label:"Published",value:"published"},{label:"Under Review",value:"review"},{label:"Archived",value:"archived"}],ue=f(()=>!!J.answer),ne=()=>{ie.value={answer_text:"",media_links:[],attachments:[],status:"draft",notes:"",is_public:!1},Z.value=null,ee.value="",le.value=null,X.value={}},de=()=>{if(!me())return;H.value=!0,X.value={};const e={...ie.value,media_links:ee.value.split("\n").map(e=>e.trim()).filter(e=>e.length>0)};le.value&&(e.voice_note=le.value);(ue.value?w.updateAnswer(J.answer.id,e):w.createAnswer(J.questionId,e)).then(()=>{W.notify({type:"positive",message:`Answer ${ue.value?"updated":"created"} successfully`,position:"top"}),K("save"),Y.value=!1}).catch(e=>{var a,l;console.error("Error saving answer:",e),(null==(l=null==(a=e.response)?void 0:a.data)?void 0:l.errors)&&(X.value=e.response.data.errors),W.notify({type:"negative",message:`Failed to ${ue.value?"update":"create"} answer`,position:"top"})}).finally(()=>{H.value=!1})},me=()=>(X.value={},!!ie.value.answer_text.trim()||(X.value.answer_text="Answer text is required",!1)),ce=e=>{W.notify({type:"negative",message:`${e.length} file(s) rejected. Check file size and type.`,position:"top"})},ve=e=>{if(!e)return"";const a=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,a)*100)/100+" "+["Bytes","KB","MB","GB"][a]},pe=async()=>{ae.value?we():await be()},be=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});se.value=new MediaRecorder(e),oe.value=[],se.value.ondataavailable=e=>{oe.value.push(e.data)},se.value.onstop=()=>{const a=new Blob(oe.value,{type:"audio/wav"});le.value=a,e.getTracks().forEach(e=>e.stop())},se.value.start(),ae.value=!0;const a=Date.now(),l=setInterval(()=>{ae.value?te.value=Math.floor((Date.now()-a)/1e3):clearInterval(l)},1e3)}catch(e){console.error("Error starting recording:",e),W.notify({type:"negative",message:"Failed to start recording. Please check microphone permissions.",position:"top"})}},we=()=>{se.value&&ae.value&&(se.value.stop(),ae.value=!1)},fe=()=>{if(le.value){new Audio(URL.createObjectURL(le.value)).play()}},he=()=>{le.value=null,te.value=0};return g(()=>J.answer,e=>{var a;e?(a=e)&&(ie.value={answer_text:a.answer_text||"",media_links:a.media_links||[],attachments:a.attachments||[],status:a.status||"draft",notes:a.notes||"",is_public:a.is_public||!1},ee.value=(a.media_links||[]).join("\n")):ne()},{immediate:!0}),g(()=>J.modelValue,e=>{e||ne()}),y(()=>{ae.value&&we()}),(e,a)=>(_(),x(m,{modelValue:Y.value,"onUpdate:modelValue":a[6]||(a[6]=e=>Y.value=e),persistent:"",maximized:B(W).screen.lt.md,"full-width":B(W).screen.gt.sm,"transition-show":"slide-up","transition-hide":"slide-down"},{default:V(()=>[q(d,{style:{"min-width":"600px","max-width":"800px",width:"100%"}},{default:V(()=>[q(l,{class:"row items-center q-pb-none bg-primary text-white"},{default:V(()=>[k("div",F,[q(t,{name:"edit",class:"q-mr-sm"}),j(" "+U(ue.value?"Edit Answer":"Add New Answer"),1)]),q(c),A(q(o,{icon:"close",flat:"",round:"",dense:"",color:"white"},null,512),[[s]])]),_:1}),q(b,{onSubmit:de,class:"q-pa-md"},{default:V(()=>[k("div",C,[a[7]||(a[7]=k("label",{class:"text-subtitle2 q-mb-sm block"},"Answer Text *",-1)),q(i,{modelValue:ie.value.answer_text,"onUpdate:modelValue":a[0]||(a[0]=e=>ie.value.answer_text=e),type:"textarea",rows:"6",outlined:"",placeholder:"Enter your answer here...",error:!!X.value.answer_text,"error-message":X.value.answer_text,counter:"",maxlength:"5000"},null,8,["modelValue","error","error-message"])]),k("div",D,[a[8]||(a[8]=k("label",{class:"text-subtitle2 q-mb-sm block"},"Media Links",-1)),q(i,{modelValue:ee.value,"onUpdate:modelValue":a[1]||(a[1]=e=>ee.value=e),type:"textarea",rows:"3",outlined:"",placeholder:"Enter media URLs (one per line)",hint:"Add YouTube, image, or other media URLs"},null,8,["modelValue"])]),k("div",z,[a[11]||(a[11]=k("label",{class:"text-subtitle2 q-mb-sm block"},"File Attachments",-1)),q(v,{modelValue:Z.value,"onUpdate:modelValue":a[2]||(a[2]=e=>Z.value=e),multiple:"",outlined:"",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.mp4,.mp3","max-file-size":"10485760",onRejected:ce},{prepend:V(()=>[q(t,{name:"attach_file"})]),hint:V(()=>a[9]||(a[9]=[j(" Max 10MB per file. Supported: PDF, DOC, images, videos, audio ")])),_:1},8,["modelValue"]),Z.value&&Z.value.length>0?(_(),M("div",E,[a[10]||(a[10]=k("div",{class:"text-caption q-mb-xs"},"Selected files:",-1)),(_(!0),M(Q,null,S(Z.value,(e,a)=>{return _(),x(r,{key:a,removable:"",onRemove:e=>(e=>{Z.value&&Array.isArray(Z.value)&&Z.value.splice(e,1)})(a),color:"blue-1","text-color":"blue-8",icon:(l=e.type,(null==l?void 0:l.includes("image"))?"image":(null==l?void 0:l.includes("video"))?"videocam":(null==l?void 0:l.includes("audio"))?"audiotrack":(null==l?void 0:l.includes("pdf"))?"picture_as_pdf":"description")},{default:V(()=>[j(U(e.name)+" ("+U(ve(e.size))+") ",1)]),_:2},1032,["onRemove","icon"]);var l}),128))])):R("",!0)]),k("div",I,[a[12]||(a[12]=k("label",{class:"text-subtitle2 q-mb-sm block"},"Voice Note",-1)),k("div",N,[q(o,{color:ae.value?"negative":"primary",icon:ae.value?"stop":"mic",label:ae.value?"Stop Recording":"Record Voice Note",onClick:pe},null,8,["color","icon","label"]),le.value?(_(),M("div",L,[q(o,{icon:"play_arrow",flat:"",round:"",onClick:fe}),q(o,{icon:"delete",flat:"",round:"",color:"negative",onClick:he}),k("span",P,U(te.value)+"s",1)])):R("",!0)])]),k("div",O,[a[13]||(a[13]=k("label",{class:"text-subtitle2 q-mb-sm block"},"Status",-1)),q(p,{modelValue:ie.value.status,"onUpdate:modelValue":a[3]||(a[3]=e=>ie.value.status=e),options:re,outlined:"","emit-value":"","map-options":""},null,8,["modelValue"])]),k("div",G,[a[14]||(a[14]=k("label",{class:"text-subtitle2 q-mb-sm block"},"Private Notes",-1)),q(i,{modelValue:ie.value.notes,"onUpdate:modelValue":a[4]||(a[4]=e=>ie.value.notes=e),type:"textarea",rows:"3",outlined:"",placeholder:"Add private notes (only visible to you)"},null,8,["modelValue"])]),k("div",T,[q(u,{modelValue:ie.value.is_public,"onUpdate:modelValue":a[5]||(a[5]=e=>ie.value.is_public=e),label:"Make this answer public",color:"primary"},null,8,["modelValue"]),a[15]||(a[15]=k("div",{class:"text-caption text-grey-6 q-mt-xs"}," Public answers can be viewed by other users ",-1))]),q(n,{align:"right",class:"q-pt-md"},{default:V(()=>[A(q(o,{flat:"",label:"Cancel",color:"grey-7"},null,512),[[s]]),q(o,{type:"submit",label:ue.value?"Update Answer":"Save Answer",color:"primary",loading:H.value,disable:!ie.value.answer_text.trim()},null,8,["label","loading","disable"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","maximized","full-width"]))}},[["__scopeId","data-v-eb660792"]]);export{$ as default};
