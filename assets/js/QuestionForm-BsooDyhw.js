import{f as e,a as t,d as l,k as o,N as n,J as a,O as i,V as s,Q as r,y as u,b as d,W as p,z as c,U as v,F as m,R as _,a0 as f,ab as h,ac as b,ae as g}from"./vendor-nQjeLEvd.js";import{V as y}from"./ValidationError-C_bfYyF3.js";import{o as x}from"./app-B9g134Ig.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";const q={class:"question-form"},k={class:"question-form__title"},E={class:"form-group"},C=["value"],j={class:"form-group"},V={class:"form-hint"},U={class:"form-group"},S=["value"],T={class:"form-group"},O=["value"],Q={class:"form-group"},A=["value"],w={class:"form-group"},F={class:"form-group"},$={class:"form-group"},D={class:"form-group"},H={key:0,class:"form-section"},L={class:"option-item__header"},B={class:"option-item__label"},I=["onClick","disabled"],R=["onUpdate:modelValue"],z={class:"checkbox-label"},G=["onUpdate:modelValue"],M=["disabled"],Z={key:1,class:"form-section"},J=["onUpdate:modelValue","placeholder"],K=["onClick"],N=["disabled"],P={key:2,class:"form-section"},W={class:"checkbox-label"},Y={class:"form-actions"},X=["disabled"],ee=x(l({__name:"QuestionForm",props:{questionTypes:{},gradeLevels:{},subjects:{},topics:{},initialData:{default:()=>({})},isEditing:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(l,{expose:x,emit:ee}){const te=l,le=ee,oe=e({question_type_id:null,question_text:"",grade_level_id:null,subject_id:null,topic_id:null,bloom_level:null,difficulty_level:null,estimated_time_sec:null,status:"draft",hints:[],explanation:{text:"",revealed_after_attempt:!0},options:[],...te.initialData}),ne=e(!1),ae=t(()=>oe.value.question_type_id&&te.questionTypes.find(e=>e.id===oe.value.question_type_id)||null),{validateForm:ie,getFieldError:se,hasFieldError:re,clearFieldError:ue,clearErrors:de,setServerErrors:pe}=function(l){const o=e([]),n=e=>e&&0!==e.trim().length?e.length<10?"Question text must be at least 10 characters.":e.length>5e3?"Question text cannot exceed 5000 characters.":null:"Question text is required.",a=(e,t)=>null==e||""===e?`${t} is required.`:null,i=e=>null===e?null:e<1||e>6?"Bloom level must be between 1 and 6.":null,s=e=>null===e?null:e<1||e>5?"Difficulty level must be between 1 and 5.":null,r=e=>null===e?null:e<1?"Estimated time must be at least 1 second.":e>3600?"Estimated time cannot exceed 1 hour (3600 seconds).":null,u=e=>{var t;if(!(null==(t=l.value)?void 0:t.supports_hints)&&e.length>0)return"This question type does not support hints.";if(e.length>5)return"You can provide a maximum of 5 hints.";for(let l=0;l<e.length;l++){const t=e[l];if(t.length<5)return`Hint ${l+1} must be at least 5 characters.`;if(t.length>1e3)return`Hint ${l+1} cannot exceed 1000 characters.`}return null},d=e=>{var t;return e&&e.text?(null==(t=l.value)?void 0:t.supports_explanation)?e.text.length<10?"Explanation must be at least 10 characters.":e.text.length>5e3?"Explanation cannot exceed 5000 characters.":null:"This question type does not support explanations.":null},p=e=>{if(!l.value)return null;if(l.value.has_options&&0===e.length)return"This question type requires options.";if(!l.value.has_options&&e.length>0)return"This question type does not support options.";if(e.length>0&&e.length<2)return"At least 2 options are required.";if(e.length>10)return"Maximum 10 options allowed.";const t=e.some(e=>e.is_correct);if(e.length>0&&!t)return"At least one option must be marked as correct.";const o=e.map(e=>e.option_key),n=new Set(o);if(o.length!==n.size)return"Option keys must be unique.";for(let l=0;l<e.length;l++){const t=e[l];if(!t.option_key||!/^[A-Z]$/.test(t.option_key))return`Option ${l+1}: Key must be a single uppercase letter (A-Z).`;if(!t.option_text||0===t.option_text.trim().length)return`Option ${l+1}: Text is required.`;if(t.option_text.length>1e3)return`Option ${l+1}: Text cannot exceed 1000 characters.`;if(null!==t.distractor_strength&&(t.distractor_strength<0||t.distractor_strength>1))return`Option ${l+1}: Distractor strength must be between 0 and 1.`}return null};return{errors:t(()=>o.value),validateForm:e=>{o.value=[];const t=a(e.question_type_id,"Question type");t&&o.value.push({field:"question_type_id",message:t});const l=n(e.question_text);l&&o.value.push({field:"question_text",message:l});const c=a(e.grade_level_id,"Grade level");c&&o.value.push({field:"grade_level_id",message:c});const v=a(e.subject_id,"Subject");v&&o.value.push({field:"subject_id",message:v});const m=a(e.status,"Status");m&&o.value.push({field:"status",message:m});const _=i(e.bloom_level);_&&o.value.push({field:"bloom_level",message:_});const f=s(e.difficulty_level);f&&o.value.push({field:"difficulty_level",message:f});const h=r(e.estimated_time_sec);h&&o.value.push({field:"estimated_time_sec",message:h});const b=u(e.hints);b&&o.value.push({field:"hints",message:b});const g=d(e.explanation);g&&o.value.push({field:"explanation",message:g});const y=p(e.options);return y&&o.value.push({field:"options",message:y}),0===o.value.length},validateQuestionText:n,validateRequired:a,validateBloomLevel:i,validateDifficultyLevel:s,validateEstimatedTime:r,validateHints:u,validateExplanation:d,validateOptions:p,getFieldError:e=>{const t=o.value.find(t=>t.field===e);return t?t.message:null},hasFieldError:e=>o.value.some(t=>t.field===e),clearErrors:()=>{o.value=[]},clearFieldError:e=>{o.value=o.value.filter(t=>t.field!==e)},setServerErrors:e=>{o.value=[],Object.entries(e).forEach(([e,t])=>{t.forEach(t=>{o.value.push({field:e,message:t})})})}}}(ae);o(()=>oe.value.question_type_id,e=>{const t=te.questionTypes.find(t=>t.id===e);(null==t?void 0:t.has_options)&&0===oe.value.options.length?oe.value.options=[{option_key:"A",option_text:"",is_correct:!1,distractor_strength:null,order_index:0},{option_key:"B",option_text:"",is_correct:!1,distractor_strength:null,order_index:1},{option_key:"C",option_text:"",is_correct:!1,distractor_strength:null,order_index:2},{option_key:"D",option_text:"",is_correct:!1,distractor_strength:null,order_index:3}]:(null==t?void 0:t.has_options)||(oe.value.options=[])});const ce=()=>{const e=String.fromCharCode(65+oe.value.options.length);oe.value.options.push({option_key:e,option_text:"",is_correct:!1,distractor_strength:null,order_index:oe.value.options.length})},ve=()=>{oe.value.hints.push("")},me=()=>{de(),ie(oe.value)&&(ne.value=!0,le("submit",oe.value))},_e=()=>{le("cancel")};return x({setServerErrors:pe,clearErrors:de}),(e,t)=>{var l,o,x;return a(),n("div",q,[i("h2",k,s(e.isEditing?"Edit Question":"Create Question"),1),i("form",{onSubmit:f(me,["prevent"]),class:"question-form__form"},[i("div",E,[t[25]||(t[25]=i("label",{for:"question-type",class:"form-label"},[p(" Question Type "),i("span",{class:"required"},"*")],-1)),u(i("select",{id:"question-type","onUpdate:modelValue":t[0]||(t[0]=e=>oe.value.question_type_id=e),class:v(["form-input",{"form-input--error":c(re)("question_type_id")}]),onChange:t[1]||(t[1]=e=>c(ue)("question_type_id"))},[t[24]||(t[24]=i("option",{value:null},"Select a question type",-1)),(a(!0),n(m,null,_(e.questionTypes,e=>(a(),n("option",{key:e.id,value:e.id},s(e.name),9,C))),128))],34),[[h,oe.value.question_type_id]]),d(y,{error:c(se)("question_type_id")},null,8,["error"])]),i("div",j,[t[26]||(t[26]=i("label",{for:"question-text",class:"form-label"},[p(" Question Text "),i("span",{class:"required"},"*")],-1)),u(i("textarea",{id:"question-text","onUpdate:modelValue":t[2]||(t[2]=e=>oe.value.question_text=e),class:v(["form-input form-textarea",{"form-input--error":c(re)("question_text")}]),rows:"4",placeholder:"Enter your question here...",onInput:t[3]||(t[3]=e=>c(ue)("question_text"))},null,34),[[b,oe.value.question_text]]),i("div",V,s(oe.value.question_text.length)+" / 5000 characters ",1),d(y,{error:c(se)("question_text")},null,8,["error"])]),i("div",U,[t[28]||(t[28]=i("label",{for:"grade-level",class:"form-label"},[p(" Grade Level "),i("span",{class:"required"},"*")],-1)),u(i("select",{id:"grade-level","onUpdate:modelValue":t[4]||(t[4]=e=>oe.value.grade_level_id=e),class:v(["form-input",{"form-input--error":c(re)("grade_level_id")}]),onChange:t[5]||(t[5]=e=>c(ue)("grade_level_id"))},[t[27]||(t[27]=i("option",{value:null},"Select a grade level",-1)),(a(!0),n(m,null,_(e.gradeLevels,e=>(a(),n("option",{key:e.id,value:e.id},s(e.name),9,S))),128))],34),[[h,oe.value.grade_level_id]]),d(y,{error:c(se)("grade_level_id")},null,8,["error"])]),i("div",T,[t[30]||(t[30]=i("label",{for:"subject",class:"form-label"},[p(" Subject "),i("span",{class:"required"},"*")],-1)),u(i("select",{id:"subject","onUpdate:modelValue":t[6]||(t[6]=e=>oe.value.subject_id=e),class:v(["form-input",{"form-input--error":c(re)("subject_id")}]),onChange:t[7]||(t[7]=e=>c(ue)("subject_id"))},[t[29]||(t[29]=i("option",{value:null},"Select a subject",-1)),(a(!0),n(m,null,_(e.subjects,e=>(a(),n("option",{key:e.id,value:e.id},s(e.name),9,O))),128))],34),[[h,oe.value.subject_id]]),d(y,{error:c(se)("subject_id")},null,8,["error"])]),i("div",Q,[t[32]||(t[32]=i("label",{for:"topic",class:"form-label"},"Topic",-1)),u(i("select",{id:"topic","onUpdate:modelValue":t[8]||(t[8]=e=>oe.value.topic_id=e),class:v(["form-input",{"form-input--error":c(re)("topic_id")}]),onChange:t[9]||(t[9]=e=>c(ue)("topic_id"))},[t[31]||(t[31]=i("option",{value:null},"Select a topic (optional)",-1)),(a(!0),n(m,null,_(e.topics,e=>(a(),n("option",{key:e.id,value:e.id},s(e.name),9,A))),128))],34),[[h,oe.value.topic_id]]),d(y,{error:c(se)("topic_id")},null,8,["error"])]),i("div",w,[t[34]||(t[34]=i("label",{for:"bloom-level",class:"form-label"},"Bloom Level",-1)),u(i("select",{id:"bloom-level","onUpdate:modelValue":t[10]||(t[10]=e=>oe.value.bloom_level=e),class:v(["form-input",{"form-input--error":c(re)("bloom_level")}]),onChange:t[11]||(t[11]=e=>c(ue)("bloom_level"))},t[33]||(t[33]=[i("option",{value:null},"Select Bloom level (optional)",-1),i("option",{value:1},"1 - Remember",-1),i("option",{value:2},"2 - Understand",-1),i("option",{value:3},"3 - Apply",-1),i("option",{value:4},"4 - Analyze",-1),i("option",{value:5},"5 - Evaluate",-1),i("option",{value:6},"6 - Create",-1)]),34),[[h,oe.value.bloom_level]]),d(y,{error:c(se)("bloom_level")},null,8,["error"])]),i("div",F,[t[36]||(t[36]=i("label",{for:"difficulty-level",class:"form-label"}," Difficulty Level ",-1)),u(i("select",{id:"difficulty-level","onUpdate:modelValue":t[12]||(t[12]=e=>oe.value.difficulty_level=e),class:v(["form-input",{"form-input--error":c(re)("difficulty_level")}]),onChange:t[13]||(t[13]=e=>c(ue)("difficulty_level"))},t[35]||(t[35]=[i("option",{value:null},"Select difficulty (optional)",-1),i("option",{value:1},"1 - Very Easy",-1),i("option",{value:2},"2 - Easy",-1),i("option",{value:3},"3 - Medium",-1),i("option",{value:4},"4 - Hard",-1),i("option",{value:5},"5 - Very Hard",-1)]),34),[[h,oe.value.difficulty_level]]),d(y,{error:c(se)("difficulty_level")},null,8,["error"])]),i("div",$,[t[37]||(t[37]=i("label",{for:"estimated-time",class:"form-label"}," Estimated Time (seconds) ",-1)),u(i("input",{id:"estimated-time","onUpdate:modelValue":t[14]||(t[14]=e=>oe.value.estimated_time_sec=e),type:"number",class:v(["form-input",{"form-input--error":c(re)("estimated_time_sec")}]),min:"1",max:"3600",placeholder:"e.g., 60",onInput:t[15]||(t[15]=e=>c(ue)("estimated_time_sec"))},null,34),[[b,oe.value.estimated_time_sec,void 0,{number:!0}]]),d(y,{error:c(se)("estimated_time_sec")},null,8,["error"])]),i("div",D,[t[39]||(t[39]=i("label",{for:"status",class:"form-label"},[p(" Status "),i("span",{class:"required"},"*")],-1)),u(i("select",{id:"status","onUpdate:modelValue":t[16]||(t[16]=e=>oe.value.status=e),class:v(["form-input",{"form-input--error":c(re)("status")}]),onChange:t[17]||(t[17]=e=>c(ue)("status"))},t[38]||(t[38]=[i("option",{value:"draft"},"Draft",-1),i("option",{value:"active"},"Active",-1),i("option",{value:"review"},"Under Review",-1),i("option",{value:"archived"},"Archived",-1)]),34),[[h,oe.value.status]]),d(y,{error:c(se)("status")},null,8,["error"])]),(null==(l=ae.value)?void 0:l.has_options)?(a(),n("div",H,[t[41]||(t[41]=i("h3",{class:"form-section__title"},"Answer Options",-1)),(a(!0),n(m,null,_(oe.value.options,(e,l)=>(a(),n("div",{key:l,class:"option-item"},[i("div",L,[i("span",B,"Option "+s(e.option_key),1),i("button",{type:"button",class:"option-item__remove",onClick:e=>(e=>{oe.value.options.splice(e,1),oe.value.options.forEach((e,t)=>{e.option_key=String.fromCharCode(65+t),e.order_index=t})})(l),disabled:oe.value.options.length<=2}," Remove ",8,I)]),u(i("input",{"onUpdate:modelValue":t=>e.option_text=t,type:"text",class:"form-input",placeholder:"Enter option text...",onInput:t[18]||(t[18]=e=>c(ue)("options"))},null,40,R),[[b,e.option_text]]),i("label",z,[u(i("input",{"onUpdate:modelValue":t=>e.is_correct=t,type:"checkbox",onChange:t[19]||(t[19]=e=>c(ue)("options"))},null,40,G),[[g,e.is_correct]]),t[40]||(t[40]=i("span",null,"Correct answer",-1))])]))),128)),i("button",{type:"button",class:"btn btn--secondary",onClick:ce,disabled:oe.value.options.length>=10}," Add Option ",8,M),d(y,{error:c(se)("options")},null,8,["error"])])):r("",!0),(null==(o=ae.value)?void 0:o.supports_hints)?(a(),n("div",Z,[t[42]||(t[42]=i("h3",{class:"form-section__title"},"Hints (Optional)",-1)),(a(!0),n(m,null,_(oe.value.hints,(e,l)=>(a(),n("div",{key:l,class:"hint-item"},[u(i("input",{"onUpdate:modelValue":e=>oe.value.hints[l]=e,type:"text",class:"form-input",placeholder:`Hint ${l+1}`,onInput:t[20]||(t[20]=e=>c(ue)("hints"))},null,40,J),[[b,oe.value.hints[l]]]),i("button",{type:"button",class:"btn btn--icon",onClick:e=>(e=>{oe.value.hints.splice(e,1)})(l)}," Ã— ",8,K)]))),128)),i("button",{type:"button",class:"btn btn--secondary",onClick:ve,disabled:oe.value.hints.length>=5}," Add Hint ",8,N),d(y,{error:c(se)("hints")},null,8,["error"])])):r("",!0),(null==(x=ae.value)?void 0:x.supports_explanation)?(a(),n("div",P,[t[44]||(t[44]=i("h3",{class:"form-section__title"},"Explanation (Optional)",-1)),u(i("textarea",{"onUpdate:modelValue":t[21]||(t[21]=e=>oe.value.explanation.text=e),class:"form-input form-textarea",rows:"3",placeholder:"Provide an explanation for this question...",onInput:t[22]||(t[22]=e=>c(ue)("explanation"))},null,544),[[b,oe.value.explanation.text]]),i("label",W,[u(i("input",{"onUpdate:modelValue":t[23]||(t[23]=e=>oe.value.explanation.revealed_after_attempt=e),type:"checkbox"},null,512),[[g,oe.value.explanation.revealed_after_attempt]]),t[43]||(t[43]=i("span",null,"Reveal explanation only after attempt",-1))]),d(y,{error:c(se)("explanation")},null,8,["error"])])):r("",!0),i("div",Y,[i("button",{type:"button",class:"btn btn--secondary",onClick:_e}," Cancel "),i("button",{type:"submit",class:"btn btn--primary",disabled:ne.value},s(ne.value?"Saving...":e.isEditing?"Update Question":"Create Question"),9,X)])],32)])}}}),[["__scopeId","data-v-c8d7da7d"]]);export{ee as default};
