import{bk as e,c as l,f as a,Q as o,l as t,m as s}from"./app-Buylb2AA.js";import{Q as u}from"./QCircularProgress-D5atz-UQ.js";import{Q as n}from"./QSelect-CcTxzM62.js";import{f as r,a as d,z as v,H as i,I as c,J as m,b as p,O as k,M as f,U as y,L as b,F as h}from"./vendor-CUZ9QTQV.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";import"./rtl-Cr6c3OOr.js";const g={class:"text-h6"},S={class:"text-subtitle2"},x={class:"text-h3"},w={class:"row q-mt-md"},C={class:"row q-mt-md justify-center"},_={class:"text-center q-mb-md"},D={key:0},V={class:"text-h6"},T={key:1},j={class:"text-subtitle1"},$={__name:"PomodoroTimer",props:{tasks:{type:Array,default:()=>[]}},emits:["close","session-completed","enter-focus-mode"],setup($,{emit:q}){const I=$,M=q,Q=e(),U=r(!1),F=r(!1),P=r(!1),B=r(!1),N=r(0),z=r(25),A=r(5),E=r(null),O=r(""),R=r(null),W=r(null),H=r(null),J=r(null),L=r(0),G=d(()=>I.tasks.map(e=>({id:e.id,title:e.title}))),K=d(()=>E.value?I.tasks.find(e=>e.id===E.value):null),X=d(()=>{if(B.value){const e=60*A.value;return(e-N.value)/e*100}{const e=60*z.value;return(e-N.value)/e*100}}),Y=()=>{U.value=!0,F.value=!1,P.value=!1,B.value=!1,N.value=60*z.value,H.value=Date.now(),L.value=0,Q.fetchData({endpoint:"/developer/pomodoro/start",method:"post",data:{task_id:E.value,type:"work",duration:z.value},onSuccess:e=>{R.value=e.session,ee()}})},Z=()=>{U.value=!0,F.value=!1,P.value=!1,B.value=!0,N.value=60*A.value,H.value=Date.now(),L.value=0,Q.fetchData({endpoint:"/developer/pomodoro/start",method:"post",data:{task_id:null,type:"break",duration:A.value},onSuccess:e=>{R.value=e.session,ee()}})},ee=()=>{clearInterval(W.value),W.value=setInterval(()=>{F.value||(N.value--,N.value<=0&&te())},1e3)},le=()=>{F.value=!0,J.value=Date.now()},ae=()=>{F.value=!1,L.value+=Date.now()-J.value,J.value=null},oe=()=>{clearInterval(W.value),R.value&&Q.fetchData({endpoint:`/developer/pomodoro/${R.value.id}/end`,method:"post",data:{notes:"Session interrupted by user",status:"interrupted"},onSuccess:()=>{M("session-completed")}}),se()},te=()=>{clearInterval(W.value),U.value=!1,re(),B.value?(B.value=!1,P.value=!1,R.value&&Q.fetchData({endpoint:`/developer/pomodoro/${R.value.id}/end`,method:"post",data:{notes:"Break completed",status:"completed"},onSuccess:()=>{M("session-completed"),R.value=null}})):P.value=!0},se=()=>{clearInterval(W.value),U.value=!1,F.value=!1,P.value=!1,B.value=!1,N.value=0,O.value="",R.value=null},ue=()=>{se(),M("close")},ne=e=>{const l=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`},re=()=>{new Audio("/sounds/notification.mp3").play().catch(e=>console.error("Error playing sound:",e))},de=()=>{R.value&&Q.fetchData({endpoint:`/developer/pomodoro/${R.value.id}/end`,method:"post",data:{notes:O.value||"Need more time to complete",status:"extended"},onSuccess:()=>{M("session-completed"),Y()}})},ve=()=>{R.value&&Q.fetchData({endpoint:`/developer/pomodoro/${R.value.id}/end`,method:"post",data:{notes:O.value||"Task completed",status:"completed"},onSuccess:()=>{M("session-completed"),E.value?Q.fetchData({endpoint:`/developer/tasks/${E.value}/toggle-complete`,method:"post",onSuccess:()=>{Z()}}):Z()}})},ie=()=>{R.value&&Q.fetchData({endpoint:`/developer/pomodoro/${R.value.id}/end`,method:"post",data:{notes:O.value||"Taking a longer break",status:"completed"},onSuccess:()=>{M("session-completed"),A.value=2*A.value,Z()}})},ce=()=>{console.log("Entering Focus Mode with task:",K.value),console.log("Current session:",R.value),M("enter-focus-mode",K.value,R.value),M("close")};return v(()=>{clearInterval(W.value)}),(e,r)=>(c(),i(s,{style:{width:"400px","max-width":"90vw"}},{default:m(()=>[p(l,{class:"text-center"},{default:m(()=>[f("div",g,y(B.value?"Break Time":"Pomodoro Timer"),1),f("div",S,y(B.value?"Relax and recharge":"Stay focused and productive"),1)]),_:1}),p(l,{class:"text-center"},{default:m(()=>[p(u,{value:X.value,size:"200px",thickness:.2,color:"primary","track-color":"grey-3",class:"q-ma-md"},{default:m(()=>[f("div",x,y(ne(N.value)),1)]),_:1},8,["value"])]),_:1}),B.value||U.value||P.value?k("",!0):(c(),i(l,{key:0},{default:m(()=>[p(n,{modelValue:E.value,"onUpdate:modelValue":r[0]||(r[0]=e=>E.value=e),options:G.value,label:"Select Task","option-value":"id","option-label":"title","emit-value":"","map-options":"",clearable:""},null,8,["modelValue","options"]),f("div",w,[p(a,{modelValue:z.value,"onUpdate:modelValue":r[1]||(r[1]=e=>z.value=e),modelModifiers:{number:!0},type:"number",label:"Duration (minutes)",min:"1",max:"60",class:"col-6 q-pr-sm"},null,8,["modelValue"]),p(a,{modelValue:A.value,"onUpdate:modelValue":r[2]||(r[2]=e=>A.value=e),modelModifiers:{number:!0},type:"number",label:"Break (minutes)",min:"1",max:"30",class:"col-6 q-pl-sm"},null,8,["modelValue"])])]),_:1})),P.value?(c(),i(l,{key:1},{default:m(()=>[r[4]||(r[4]=f("div",{class:"text-h6 text-center q-mb-md"},"Session Completed!",-1)),p(a,{modelValue:O.value,"onUpdate:modelValue":r[3]||(r[3]=e=>O.value=e),type:"textarea",label:"What did you accomplish?",rows:"3"},null,8,["modelValue"]),f("div",C,[p(o,{flat:"",color:"grey",label:"Need more time",onClick:de}),p(o,{flat:"",color:"positive",label:"Task completed",onClick:ve}),p(o,{flat:"",color:"primary",label:"Take a longer break",onClick:ie})])]),_:1})):k("",!0),U.value?(c(),i(l,{key:2},{default:m(()=>[f("div",_,[K.value?(c(),b("div",D,[r[5]||(r[5]=f("div",{class:"text-subtitle1"},"Working on:",-1)),f("div",V,y(K.value.title),1)])):(c(),b("div",T,[f("div",j,y(B.value?"Taking a break":"Focus session"),1)]))])]),_:1})):k("",!0),p(t,{align:"center"},{default:m(()=>[U.value||P.value?k("",!0):(c(),i(o,{key:0,color:"primary",label:"Start",icon:"play_arrow",onClick:Y})),U.value?(c(),b(h,{key:1},[p(o,{color:"negative",label:"Stop",icon:"stop",onClick:oe}),F.value?(c(),i(o,{key:1,color:"primary",label:"Resume",icon:"play_arrow",onClick:ae})):(c(),i(o,{key:0,color:"grey",label:"Pause",icon:"pause",onClick:le})),p(o,{color:"primary",flat:"",label:"Focus Mode",icon:"fullscreen",onClick:ce})],64)):k("",!0),P.value?(c(),i(o,{key:2,color:"primary",label:"Start New Session",icon:"refresh",onClick:se})):k("",!0),U.value?k("",!0):(c(),i(o,{key:3,flat:"",label:"Close",color:"grey",onClick:ue}))]),_:1})]),_:1}))}};export{$ as default};
