import{o as e}from"./app-Buylb2AA.js";import{f as a,a as l,e as t,L as s,I as n,M as o,b as r,S as i,V as u,U as c,J as v,O as d,A as m,R as f,x as h,ab as g}from"./vendor-CUZ9QTQV.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";const p={class:"meter-container"},b={class:"circular-meter"},y={viewBox:"0 0 200 200"},k=["stroke","stroke-dashoffset"],w={key:0,class:"warning-banner"},x={class:"bar-meter"},M={class:"info"},A={key:0},C={key:1,class:"listening-text"},S={class:"db-value"},B={class:"threshold-control"},j={class:"threshold-value"},_=e({__name:"noise",setup(e){const _=a(!1),q=a(-100),L=a(80);let U=null,D=null,F=null,I=null;const T=2*Math.PI*90,V=l(()=>Math.max(20,Math.round(q.value+70))),z=l(()=>_.value&&V.value>L.value),J=l(()=>z.value?"#ff3b30":q.value>-25?"#ff9500":q.value>-40?"#ffcc00":"#34c759"),O=l(()=>z.value?"#ff3b30":J.value),P=l(()=>{const e=Math.min(1,V.value/110);return T*(1-e)}),R=l(()=>Math.min(100,V.value/110*100)),W=l(()=>L.value/110*100),E=()=>{_.value=!1,I&&cancelAnimationFrame(I),F&&F.disconnect(),U&&U.close()},G=()=>{_.value?E():(async()=>{try{U=new(window.AudioContext||window.webkitAudioContext),D=U.createAnalyser(),D.fftSize=512,D.smoothingTimeConstant=.9;const e=await navigator.mediaDevices.getUserMedia({audio:!0});F=U.createMediaStreamSource(e),F.connect(D),_.value=!0,H()}catch(e){alert("Microphone access required!"),console.error(e)}})()},H=()=>{if(!D)return;const e=D.frequencyBinCount,a=new Uint8Array(e);D.getByteTimeDomainData(a);let l=0;for(let s=0;s<e;s++){const e=(a[s]-128)/128;l+=e*e}const t=Math.sqrt(l/e);q.value=t>0?20*Math.log10(t):-100,_.value&&(I=requestAnimationFrame(H))};return t(()=>E()),(e,a)=>(n(),s("div",{class:i(["noise-meter",{listening:_.value,warning:z.value}])},[o("div",p,[o("div",b,[(n(),s("svg",y,[a[1]||(a[1]=o("circle",{class:"meter-bg",cx:"100",cy:"100",r:"90","stroke-width":"20",fill:"none"},null,-1)),o("circle",{class:"meter-fill",cx:"100",cy:"100",r:"90","stroke-width":"20",fill:"none",stroke:J.value,"stroke-dasharray":T,"stroke-dashoffset":P.value,transform:"rotate(-90 100 100)"},null,8,k)])),o("div",{class:i(["level-text",{warning:z.value}])},[u(c(Math.round(V.value))+" ",1),a[2]||(a[2]=o("small",null,"dBA",-1))],2)]),r(m,{name:"fade"},{default:v(()=>[z.value?(n(),s("div",w,a[3]||(a[3]=[o("p",null,"Too Loud!",-1)]))):d("",!0)]),_:1}),o("div",x,[o("div",{class:"bar",style:f({height:R.value+"%",backgroundColor:O.value})},null,4),o("div",{class:"threshold-line",style:f({bottom:W.value+"%"})},null,4)]),o("div",M,[_.value?(n(),s("p",C,"Listening...")):(n(),s("p",A,'Click "Start" to begin listening')),o("p",S,c(V.value.toFixed(0))+" dBA",1)]),o("div",B,[a[4]||(a[4]=o("label",{for:"threshold"},"Warning threshold:",-1)),h(o("input",{type:"range",id:"threshold",min:"50",max:"100","onUpdate:modelValue":a[0]||(a[0]=e=>L.value=e),class:"slider"},null,512),[[g,L.value,void 0,{number:!0}]]),o("span",j,c(L.value)+" dBA",1)])]),o("button",{onClick:G,class:"control-btn"},c(_.value?"Stop":"Start")+" Listening ",1)],2))}},[["__scopeId","data-v-7d29112c"]]);export{_ as default};
