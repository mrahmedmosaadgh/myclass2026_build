import{r as e,u as a,f as l,c as t,Q as o,H as s,b as i,aS as u,o as n,d as r}from"./app-YpH5vqWh.js";import{Q as d}from"./QTab-D15tnj4c.js";import{Q as c}from"./QTabs-CSqR0VCn.js";import{Q as v}from"./QFile-CzgAInrb.js";import{Q as p}from"./QTabPanel-BAPJ1DQL.js";import{Q as m}from"./QSlider-BvZyTImW.js";import{Q as f}from"./QSpace-DaC9STlt.js";import{Q as g}from"./QTabPanels-DBSQeA0j.js";import{f as h,a as y,k as F,n as b,o as w,I as x,J as _,K as j,b as C,R as S,N as k,O as Q,W as V,Q as P,S as R,F as T,V as U,y as q,_ as D}from"./vendor-BWKGNkNB.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";import"./use-file-CegrFE3j.js";import"./use-panel-Di-bjwYZ.js";import"./use-render-cache-CmTcazfP.js";const I={class:"column q-gutter-md"},M={key:0,class:"preview-container"},z=["src"],G={class:"column q-gutter-md"},J={class:"row q-gutter-sm items-center"},L={class:"row items-center q-gutter-xs"},O={class:"row items-center q-gutter-xs"},W={class:"text-caption"},E={class:"canvas-container"},N=e({__name:"PracticeSubmission",props:{progressId:{type:Number,required:!0},existingSubmission:{type:Object,default:null}},emits:["submitted","close"],setup(e,{emit:N}){const A=a(),B=e,K=N,X=h("upload"),Y=h(null),H=h(null),Z=h(null),$=h(null),ee=h(!1),ae=h("pen"),le=h("#000000"),te=h(3),oe=["#000000","#FF0000","#0000FF","#00FF00","#FFFF00","#FF00FF"],se=h(!1),ie=y(()=>"upload"===X.value?null!==Y.value:Z.value&&!me()),ue=e=>{if(e){const a=new FileReader;a.onload=e=>{H.value=e.target.result},a.readAsDataURL(e)}else H.value=null},ne=()=>{if(Z.value){const e=Z.value.parentElement;Z.value.width=e.offsetWidth,Z.value.height=400,$.value=Z.value.getContext("2d"),$.value.lineCap="round",$.value.lineJoin="round",$.value.fillStyle="#FFFFFF",$.value.fillRect(0,0,Z.value.width,Z.value.height)}};F(X,e=>{"draw"===e&&b(()=>{ne()})}),w(()=>{"draw"===X.value&&b(()=>{ne()})});const re=e=>{const a=Z.value.getBoundingClientRect(),l=Z.value.width/a.width,t=Z.value.height/a.height;return e.touches?{x:(e.touches[0].clientX-a.left)*l,y:(e.touches[0].clientY-a.top)*t}:{x:(e.clientX-a.left)*l,y:(e.clientY-a.top)*t}},de=e=>{if(!$.value)return;e.preventDefault(),ee.value=!0;const a=re(e);$.value.beginPath(),$.value.moveTo(a.x,a.y)},ce=e=>{if(!ee.value)return;e.preventDefault();const a=re(e);"pen"===ae.value?($.value.strokeStyle=le.value,$.value.lineWidth=te.value,$.value.globalCompositeOperation="source-over"):"eraser"===ae.value&&($.value.strokeStyle="#FFFFFF",$.value.lineWidth=2*te.value,$.value.globalCompositeOperation="destination-out"),$.value.lineTo(a.x,a.y),$.value.stroke()},ve=()=>{ee.value=!1},pe=()=>{$.value.fillStyle="#FFFFFF",$.value.fillRect(0,0,Z.value.width,Z.value.height)},me=()=>{const e=document.createElement("canvas");e.width=Z.value.width,e.height=Z.value.height;const a=e.getContext("2d");return a.fillStyle="#FFFFFF",a.fillRect(0,0,e.width,e.height),Z.value.toDataURL()===e.toDataURL()},fe=async()=>{var e,a;se.value=!0;try{const e=new FormData;"upload"===X.value?(e.append("submission_type","upload"),e.append("file",Y.value)):(e.append("submission_type","drawing"),e.append("drawing_data",Z.value.toDataURL("image/png")));const a=await D.post(route("lesson-presentation.progress.submit-practice",{id:B.progressId}),e,{headers:{"Content-Type":"multipart/form-data"}});A.notify({type:"positive",message:"Practice submitted successfully!",position:"top"}),K("submitted",a.data),K("close")}catch(l){console.error("Submission error:",l),A.notify({type:"negative",message:(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.error)||"Failed to submit practice",position:"top"})}finally{se.value=!1}};return(e,a)=>(_(),x(r,{style:{"min-width":"700px","max-width":"90vw"}},{default:j(()=>[C(l,null,{default:j(()=>a[6]||(a[6]=[S("div",{class:"text-h6"},"Submit Practice Solution",-1),S("div",{class:"text-caption text-grey-7"},"Upload an image or draw your solution",-1)])),_:1}),C(t),C(l,null,{default:j(()=>[C(c,{modelValue:X.value,"onUpdate:modelValue":a[0]||(a[0]=e=>X.value=e),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify"},{default:j(()=>[C(d,{name:"upload",label:"Upload Image",icon:"upload_file"}),C(d,{name:"draw",label:"Draw Solution",icon:"draw"})]),_:1},8,["modelValue"]),C(t,{class:"q-my-md"}),C(g,{modelValue:X.value,"onUpdate:modelValue":a[5]||(a[5]=e=>X.value=e),animated:""},{default:j(()=>[C(p,{name:"upload"},{default:j(()=>[S("div",I,[C(v,{modelValue:Y.value,"onUpdate:modelValue":[a[1]||(a[1]=e=>Y.value=e),ue],label:"Choose an image",accept:"image/*","max-file-size":"5242880",outlined:"",clearable:""},{prepend:j(()=>[C(o,{name:"attach_file"})]),hint:j(()=>a[7]||(a[7]=[V(" Max file size: 5MB. Supported formats: JPG, PNG, GIF ")])),_:1},8,["modelValue"]),H.value?(_(),k("div",M,[a[8]||(a[8]=S("div",{class:"text-subtitle2 q-mb-sm"},"Preview:",-1)),S("img",{src:H.value,alt:"Preview",class:"preview-image"},null,8,z)])):Q("",!0)])]),_:1}),C(p,{name:"draw"},{default:j(()=>[S("div",G,[S("div",J,[C(s,{outline:""},{default:j(()=>[C(i,{outline:"pen"!==ae.value,unelevated:"pen"===ae.value,color:"primary",icon:"edit",label:"Pen",onClick:a[2]||(a[2]=e=>ae.value="pen")},null,8,["outline","unelevated"]),C(i,{outline:"eraser"!==ae.value,unelevated:"eraser"===ae.value,color:"primary",icon:"cleaning_services",label:"Eraser",onClick:a[3]||(a[3]=e=>ae.value="eraser")},null,8,["outline","unelevated"])]),_:1}),C(t,{vertical:""}),S("div",L,[a[9]||(a[9]=S("span",{class:"text-caption text-grey-7"},"Color:",-1)),(_(),k(T,null,P(oe,e=>C(i,{key:e,style:R({backgroundColor:e}),outline:le.value!==e,size:"sm",round:"",onClick:a=>le.value=e,class:"color-btn"},{default:j(()=>[le.value===e?(_(),x(o,{key:0,name:"check",color:"white",size:"xs"})):Q("",!0)]),_:2},1032,["style","outline","onClick"])),64))]),C(t,{vertical:""}),S("div",O,[a[10]||(a[10]=S("span",{class:"text-caption text-grey-7"},"Size:",-1)),C(m,{modelValue:te.value,"onUpdate:modelValue":a[4]||(a[4]=e=>te.value=e),min:1,max:10,step:1,style:{width:"100px"},color:"primary"},null,8,["modelValue"]),S("span",W,U(te.value),1)]),C(f),C(i,{flat:"",color:"negative",icon:"delete",label:"Clear",onClick:pe})]),S("div",E,[S("canvas",{ref_key:"canvas",ref:Z,onMousedown:de,onMousemove:ce,onMouseup:ve,onMouseleave:ve,onTouchstart:de,onTouchmove:ce,onTouchend:ve,class:"drawing-canvas"},null,544)])])]),_:1})]),_:1},8,["modelValue"])]),_:1}),C(t),C(n,{align:"right"},{default:j(()=>[q(C(i,{flat:"",label:"Cancel",color:"grey"},null,512),[[u]]),C(i,{unelevated:"",label:"Submit",color:"primary",onClick:fe,loading:se.value,disable:!ie.value},null,8,["loading","disable"])]),_:1})]),_:1}))}},[["__scopeId","data-v-87a7c7e7"]]);export{N as default};
