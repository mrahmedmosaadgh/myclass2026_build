import{Q as e}from"./QSpinnerDots-DjseaGnd.js";import{o as l,u as t,B as a,m as s,a as n,g as r,i as o,d as i,Q as u,h as c,R as d,A as v,j as m,f as p,n as f}from"./app-Buylb2AA.js";import{Q as y}from"./QTree-D4vz2xmN.js";import{Q as h}from"./QSplitter-B483Zwai.js";import{f as x,a as g,o as _,k,L as w,I as b,b as q,J as C,M as S,O as $,U as j,H as L,F as I,Q as V,V as N,x as Q}from"./vendor-CUZ9QTQV.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";const z={class:"single-course-preview"},U={class:"q-pa-md"},E={key:0,class:"text-center q-pa-md"},T={key:1,class:"text-center q-pa-md"},D={class:"q-mt-md text-negative"},H={key:2,class:"text-center q-pa-md"},F={key:3},M={class:"row items-center q-mb-md"},P={class:"text-h5 col"},A={class:"row items-center justify-between q-mb-sm"},B={class:"row items-center"},O={class:"q-pa-md"},J={key:0,class:"lesson-content"},R={class:"row items-center q-mb-md"},G={class:"text-h4 col"},K=["innerHTML"],W={key:1,class:"text-center q-pa-xl text-grey-7"},X={key:3,class:"q-mt-md"},Y={class:"row justify-end q-mt-md"},Z={key:1,class:"level-lessons"},ee={class:"row items-center q-mb-md"},le={class:"text-h4 col"},te={key:0,class:"text-center q-mt-xl"},ae={class:"text-grey-7 q-mt-md"},se={key:0},ne={key:1},re={key:2,class:"text-center q-mt-xl"},oe=l({__name:"SingleCoursePreview",props:{courseId:{type:[String,Number],required:!0},courseData:{type:Object,default:null}},setup(l){const oe=t(),ie=l,ue=x(25),ce=x(null),de=x(""),ve=x(!1),me=x(!1),pe=x(null),fe=x(!1),ye=x(null),he=x(null),xe=g(()=>{var e;return pe.value?[{id:`course-${pe.value.id}`,name:pe.value.name,type:"course",children:(null==(e=pe.value.levels)?void 0:e.map(e=>{const l={id:`level-${e.id}`,name:e.title,displayName:`${e.order||1}. ${e.title}`,type:"level",levelId:e.id,children:[]};return e.sections&&e.sections.length>0&&(me.value?l.children=e.sections.map(l=>{var t;return{id:`section-${l.id}`,name:l.title||"Untitled Section",displayName:`${e.order||1}.${l.order||1}. ${l.title||"Untitled Section"}`,type:"section",levelId:e.id,sectionId:l.id,children:(null==(t=l.lessons)?void 0:t.map(e=>({id:`lesson-${e.id}`,name:e.title,type:"lesson",lessonId:e.id,lesson:e})))||[]}}):e.sections.forEach(e=>{e.lessons&&e.lessons.length>0&&e.lessons.forEach(t=>{l.children.push({id:`lesson-${t.id}`,name:t.title,type:"lesson",lessonId:t.id,section_title:e.title,lesson:t})})})),l}))||[]}]:[]}),ge=g(()=>{if(!de.value||!xe.value.length)return xe.value;const e=de.value.toLowerCase(),l=xe.value[0];if(!l)return[];const t=l.children.filter(l=>{if(l.name.toLowerCase().includes(e))return!0;const t=l.children.filter(l=>{var t;if(l.name.toLowerCase().includes(e))return!0;return((null==(t=l.lessons)?void 0:t.filter(l=>l.title.toLowerCase().includes(e)||l.text&&l.text.toLowerCase().includes(e)))||[]).length>0});return t.length>0?{...l,children:t}:null}).filter(Boolean);return[{...l,children:t}]}),_e=g(()=>{if(!ce.value)return null;const e=be(ce.value);return e&&"level"===e.type?{id:e.levelId,name:e.name}:null}),ke=g(()=>{var e,l;if(!_e.value||!pe.value)return[];const t=_e.value.id,a=null==(e=pe.value.levels)?void 0:e.find(e=>e.id===t);if(!a)return[];let s=[];if(null==(l=a.sections)||l.forEach(e=>{if(e.lessons&&e.lessons.length>0){const l=e.lessons.map(l=>({...l,section_title:e.title}));s=[...s,...l]}}),de.value){const e=de.value.toLowerCase();s=s.filter(l=>l.title.toLowerCase().includes(e)||l.text&&l.text.toLowerCase().includes(e))}return s}),we=async()=>{if(ie.courseData)pe.value=ie.courseData;else{fe.value=!0,ye.value=null;try{const e=await fetch(`/course-management/api/courses/${ie.courseId}/structure`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const l=await e.json();pe.value=l.data||l}catch(e){console.error("Error loading course:",e),ye.value="Failed to load course. Please try again.",oe.notify({type:"negative",message:"Failed to load course",position:"top"})}finally{fe.value=!1}}},be=e=>{if(!xe.value.length)return null;const l=xe.value[0];if(l.id===e)return l;for(const t of l.children||[]){if(t.id===e)return t;for(const l of t.children||[])if(l.id===e)return l}return null},qe=e=>{switch(e.type){case"course":return"school";case"level":return"layers";case"section":return"description";default:return"help_outline"}},Ce=e=>{switch(e.type){case"course":return"primary";case"level":return"secondary";case"section":return"accent";default:return"grey"}},Se=e=>{if(!e)return void(he.value=null);const l=be(e);l&&("lesson"===l.type?he.value=l.lesson:(l.type,he.value=null))},$e=()=>{ve.value=!ve.value,ve.value||(de.value="")};return _(()=>{we()}),k(()=>ie.courseId,()=>{we()}),(l,t)=>(b(),w("div",z,[q(h,{modelValue:ue.value,"onUpdate:modelValue":t[4]||(t[4]=e=>ue.value=e),style:{height:"100vh"},limits:[20,50]},{before:C(()=>[q(a,{class:"fit"},{default:C(()=>[S("div",U,[fe.value?(b(),w("div",E,[q(e,{color:"primary",size:"40px"}),t[5]||(t[5]=S("div",{class:"q-mt-md"},"Loading course data...",-1))])):ye.value?(b(),w("div",T,[q(i,{name:"error",color:"negative",size:"40px"}),S("div",D,j(ye.value),1)])):pe.value?(b(),w("div",F,[S("div",M,[S("h3",P,j(pe.value.name),1),q(u,{flat:"",round:"",icon:"search",onClick:$e,color:ve.value?"primary":"grey"},null,8,["color"])]),ve.value?(b(),L(p,{key:0,modelValue:de.value,"onUpdate:modelValue":t[0]||(t[0]=e=>de.value=e),placeholder:"Search levels, sections, and lessons...",dense:"",outlined:"",class:"q-mb-md",clearable:""},{prepend:C(()=>[q(i,{name:"search"})]),_:1},8,["modelValue"])):$("",!0),S("div",A,[t[7]||(t[7]=S("div",{class:"text-caption text-grey-8"},"Course Structure",-1)),q(f,{modelValue:me.value,"onUpdate:modelValue":t[1]||(t[1]=e=>me.value=e),label:"Show Sections",color:"primary",dense:"",size:"sm"},null,8,["modelValue"])]),q(y,{nodes:ge.value,"node-key":"id","label-key":"name","children-key":"children",selected:ce.value,"onUpdate:selected":[t[2]||(t[2]=e=>ce.value=e),Se]},{"default-header":C(e=>[S("div",B,[q(i,{name:qe(e.node),size:"20px",class:"q-mr-sm",color:Ce(e.node)},null,8,["name","color"]),S("span",null,j(e.node.displayName||e.node.name),1)])]),_:1},8,["nodes","selected"])])):(b(),w("div",H,[q(i,{name:"info",color:"grey",size:"40px"}),t[6]||(t[6]=S("div",{class:"q-mt-md text-grey"},"No course data available",-1))]))])]),_:1})]),after:C(()=>[q(a,{class:"fit"},{default:C(()=>[S("div",O,[he.value?(b(),w("div",J,[S("div",R,[S("h2",G,j(he.value.title),1)]),q(s,{flat:"",bordered:"",class:"q-pa-md"},{default:C(()=>[he.value.text?(b(),w("div",{key:0,innerHTML:he.value.text,class:"lesson-text"},null,8,K)):(b(),w("div",W," No content available for this lesson. ")),he.value.attachments&&he.value.attachments.length?(b(),L(n,{key:2,class:"q-my-md"})):$("",!0),he.value.attachments&&he.value.attachments.length?(b(),w("div",X,[t[8]||(t[8]=S("div",{class:"text-subtitle1 q-mb-sm"},"Attachments",-1)),q(r,{bordered:"",separator:""},{default:C(()=>[(b(!0),w(I,null,V(he.value.attachments,e=>(b(),L(c,{key:e.id,clickable:""},{default:C(()=>[q(o,{avatar:""},{default:C(()=>[q(i,{name:"attachment",color:"primary"})]),_:1}),q(o,null,{default:C(()=>[N(j(e.name),1)]),_:2},1024),q(o,{side:""},{default:C(()=>[q(u,{flat:"",round:"",icon:"download",color:"primary"})]),_:1})]),_:2},1024))),128))]),_:1})])):$("",!0)]),_:1}),S("div",Y,[q(u,{color:"primary",icon:"play_arrow",label:"Start Lesson",onClick:t[3]||(t[3]=e=>{return l=he.value,void oe.notify({type:"positive",message:`Starting lesson: ${l.title}`,position:"top"});var l})})])])):_e.value?(b(),w("div",Z,[S("div",ee,[S("h2",le,j(_e.value.name),1)]),q(r,{bordered:"",separator:""},{default:C(()=>[(b(!0),w(I,null,V(ke.value,(e,l)=>Q((b(),L(c,{key:e.id,clickable:"",class:"q-py-md",onClick:l=>(e=>{he.value=e,ce.value=`lesson-${e.id}`})(e)},{default:C(()=>[q(o,{avatar:""},{default:C(()=>[q(v,{color:"primary","text-color":"white"},{default:C(()=>[N(j(l+1),1)]),_:2},1024)]),_:2},1024),q(o,null,{default:C(()=>[q(m,{class:"text-subtitle1"},{default:C(()=>[N(j(e.title),1)]),_:2},1024),e.section_title?(b(),L(m,{key:0,caption:"",class:"text-grey-8"},{default:C(()=>[N(" Section: "+j(e.section_title),1)]),_:2},1024)):$("",!0)]),_:2},1024),q(o,{side:""},{default:C(()=>[q(u,{flat:"",round:"",icon:"visibility",color:"primary"})]),_:1})]),_:2},1032,["onClick"])),[[d]])),128))]),_:1}),ke.value&&0!==ke.value.length?$("",!0):(b(),w("div",te,[q(i,{name:"info",size:"48px",color:"grey-5"}),S("p",ae,[de.value?(b(),w("span",se,'No lessons match "'+j(de.value)+'"',1)):(b(),w("span",ne,"No lessons available in this level"))])]))])):fe.value?$("",!0):(b(),w("div",re,[q(i,{name:"touch_app",size:"48px",color:"grey-5"}),t[9]||(t[9]=S("p",{class:"text-grey-7 q-mt-md"},"Select a level or lesson to view content",-1))]))])]),_:1})]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-7522820d"]]);export{oe as default};
