import{f as e,a,N as r,J as t,b as o,R as s,z as l,a4 as i,O as n,V as d,K as u,W as c,F as p,$ as m}from"./vendor-BWKGNkNB.js";import{_ as b}from"./PrimaryButton-DVJXOzHH.js";import{_ as v}from"./SecondaryButton-WaufSYeJ.js";import{_ as j}from"./Pagination-DMF9MOGD.js";import{_ as g}from"./DataTable-zMwSNXZH.js";import{_ as f}from"./FormModal-Bx8JHk_R.js";import{_ as x}from"./ImportExcel-BKTytu3O.js";import{utils as _,writeFile as y}from"./xlsx-BHXqx-YI.js";import"./LucideIcon-CYYJCXCs.js";import"./createLucideIcon-bevK9Pnz.js";import"./printer-yyUpIzJF.js";import"./image-T1FtDBZI.js";import"./Modal-W7e3DFIO.js";import"./app-DlLesFGi.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";const h={class:"py-12"},w={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},S={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-6"},k={key:0,class:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4"},$={class:"flex justify-between items-center mb-6"},G={class:"flex space-x-2"},M={key:1,class:"mt-4"},I="/admin/grade-subject",E={__name:"Index",props:{records:Object,options:Object},setup(E){const D=E,F=[{key:"grade",label:"Grade Name",required:!0,description:"Must match an existing grade name"},{key:"subject",label:"Subject Name",required:!0,description:"Must match an existing subject name"}],q=e(!1),A=e(null),C=e(!1),N=a(()=>D.records.data),O=a(()=>D.records.links),P=[{key:"grade.name",label:"Grade"},{key:"subject.name",label:"Subject"}],B=[{name:"grade_id",label:"Grade",type:"select",required:!0,placeholder:"Select a grade",options:a(()=>{var e,a;return(null==(a=null==(e=D.options)?void 0:e.grades)?void 0:a.map(e=>({value:e.id,label:e.name})))||[]})},{name:"subject_id",label:"Subject",type:"select",required:!0,placeholder:"Select a subject",options:a(()=>{var e,a;return(null==(a=null==(e=D.options)?void 0:e.subjects)?void 0:a.map(e=>({value:e.id,label:e.name})))||[]})}],T=(e=null)=>{A.value=e,q.value=!0},L=()=>{q.value=!1,A.value=null},z=()=>{m.reload({only:["records"]})},J=async({form:e,onSuccess:a,onError:r})=>{var t,o,s;if(console.log({form:e,onSuccess:a,onError:r}),C.value)return;C.value=!0;const l=null==(t=A.value)?void 0:t.id,i=l?`${I}/${l}`:I;try{const r={grade_id:e.grade_id,subject_id:e.subject_id};await axios.post(i,{...l&&{_method:"PUT"},...r}),a(),L(),z()}catch(n){(null==(s=null==(o=n.response)?void 0:o.data)?void 0:s.errors)?r(n.response.data.errors):r({error:["An unexpected error occurred"]})}finally{C.value=!1}},K=async e=>{if(confirm("Are you sure you want to delete this mapping?"))try{await axios.delete(`${I}/${e.id}`),z()}catch(a){console.error("Deletion error:",a),alert("An error occurred while deleting the record.")}},R=()=>{try{const e=[["Grade","Subject"],...N.value.map(e=>{var a,r;return[(null==(a=e.grade)?void 0:a.name)||"",(null==(r=e.subject)?void 0:r.name)||""]})],a=_.aoa_to_sheet(e),r=_.book_new();_.book_append_sheet(r,a,"Grade Subjects");const t=`grade_subjects_${(new Date).toISOString().split("T")[0]}.xlsx`;y(r,t)}catch(e){console.error("Export failed:",e),alert("Failed to export data")}};return(e,a)=>{var m;return t(),r(p,null,[o(l(i),{title:"Grade Subject Mappings"}),s("div",h,[s("div",w,[s("div",S,[(null==(m=e.$page.props.flash)?void 0:m.success)?(t(),r("div",k,d(e.$page.props.flash.success),1)):n("",!0),s("div",$,[s("div",G,[o(b,{onClick:a[0]||(a[0]=e=>T())},{default:u(()=>a[1]||(a[1]=[c(" Add New Mapping ")])),_:1}),o(x,{onImported:z,"validate-url":I+"/validate-import","import-url":I+"/import",columns:F,"button-text":"Import Mappings","preview-title":"Preview Grade Subject Data"},null,8,["validate-url","import-url"]),o(v,{onClick:R},{default:u(()=>a[2]||(a[2]=[c(" Export ")])),_:1})])]),o(g,{items:N.value,columns:P,onEdit:T,onDelete:K},null,8,["items"]),O.value?(t(),r("div",M,[o(j,{links:O.value},null,8,["links"])])):n("",!0)])])]),o(f,{show:q.value,title:"Grade Subject Mapping",fields:B,editing:A.value,onClose:L,onSubmitted:J},null,8,["show","editing"])],64)}}};export{E as default};
