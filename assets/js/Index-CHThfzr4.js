import{a as e,f as r,H as a,I as o,J as l,M as t,b as s,L as n,O as i,U as d,V as p,_ as u,Z as m}from"./vendor-EI0FRBVb.js";import{_ as c}from"./AppLayout-CE2yjlSr.js";import{_ as b}from"./PrimaryButton-D4MqeasW.js";import{_ as v}from"./SecondaryButton-UHI6KqaH.js";import{_ as f}from"./Pagination-wcG7j81T.js";import{_ as h}from"./DataTable-ByHcWWGX.js";import{_ as x}from"./FormModal-D0sNxqUR.js";import{_ as y}from"./ImportExcel-CDVdqykE.js";import"./app-DXXarK7I.js";import{u as _,w as g}from"./xlsx-cMC2LkxH.js";import"./LucideIcon-DP3BSI4t.js";import"./createLucideIcon-APVJ2SH-.js";import"./align-right-CnRMXp62.js";import"./underline-PDlIMkNx.js";import"./image-CpjPXLZL.js";import"./printer-DTcC0fi8.js";import"./Modal-Bpd3oPmg.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./ui-B__oX9pK.js";const j={class:"py-12"},k={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},E={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-6"},w={key:0,class:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4"},A={class:"flex justify-between items-center mb-6"},D={class:"flex space-x-2"},I={key:1,class:"mt-4"},P="Parents Management",S="/admin/student-parent",N={__name:"Index",props:{records:{type:Object,required:!0},schools:{type:Array,required:!0}},setup(N){const $=N,q=e(()=>{var e;return(null==(e=$.records)?void 0:e.data)||[]}),L=e(()=>{var e;return(null==(e=$.records)?void 0:e.links)||null}),M=[{key:"t_id",label:"ID"},{key:"name",label:"Name"},{key:"name_ar",label:"Arabic Name"},{key:"school.name",label:"School"},{key:"report",label:"Enable Reports",type:"boolean",formatter:e=>e?"Enabled":"Disabled",class:e=>e?"text-green-600":"text-red-600"}],C=[{name:"name",label:"Name",type:"text",required:!0},{name:"name_ar",label:"Arabic Name",type:"text"},{name:"school_id",label:"School",type:"select",required:!0,options:e(()=>$.schools.map(e=>({value:e.id,label:e.name})))},{name:"report",label:"Enable Reports",type:"select",required:!0,options:[{value:1,label:"Enabled"},{value:0,label:"Disabled"}],default:1}],O=r(!1),R=r(null),B=r(!1),F=(e=null)=>{R.value=e,e&&(e.report=e.report?1:0),O.value=!0},T=()=>{O.value=!1,R.value=null},U=({form:e,onSuccess:r,onError:a})=>{var o;if(B.value)return;B.value=!0;const l=null==(o=R.value)?void 0:o.id,t=l?`${S}/${l}`:S,s={...e,report:e.report?1:0};m.post(t,{...l&&{_method:"PUT"},...s}).then(e=>{r(),T(),J()}).catch(e=>{var r,o;(null==(o=null==(r=e.response)?void 0:r.data)?void 0:o.errors)?a(e.response.data.errors):a({error:["An unexpected error occurred"]})}).finally(()=>{B.value=!1})},H=e=>{confirm("Are you sure you want to delete this record?")&&m.delete(`${S}/${e.id}`).then(()=>{J()}).catch(e=>{console.error("Error:",e),alert("An error occurred while deleting the record.")})},J=()=>{u.reload({only:["records"],preserveScroll:!0,preserveState:!0})},Q=()=>{try{const e=[["ID","Name","Arabic Name","School","Enable Reports"],...q.value.map(e=>{var r;return[e.t_id||"",e.name,e.name_ar,(null==(r=e.school)?void 0:r.name)||"",e.report?"Enabled":"Disabled"]})],r=_.aoa_to_sheet(e),a=_.book_new();_.book_append_sheet(a,r,"Parents"),g(a,"parents.xlsx")}catch(e){console.error("Export failed:",e),alert("Failed to export data")}};return(e,r)=>(o(),a(c,{title:P},{header:l(()=>[t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},d(P))]),default:l(()=>{var a;return[t("div",j,[t("div",k,[t("div",E,[(null==(a=e.$page.props.flash)?void 0:a.success)?(o(),n("div",w,d(e.$page.props.flash.success),1)):i("",!0),t("div",A,[t("div",D,[s(b,{onClick:r[0]||(r[0]=e=>F())},{default:l(()=>r[1]||(r[1]=[p(" Add New Parent ")])),_:1}),s(y,{onImported:J,"validate-url":S+"/validate-import","import-url":S+"/import","undo-url":S+"/undo-import"},null,8,["validate-url","import-url","undo-url"]),s(v,{onClick:Q},{default:l(()=>r[2]||(r[2]=[p(" Export ")])),_:1})])]),s(h,{items:q.value,columns:M,onEdit:F,onDelete:H},null,8,["items"]),L.value?(o(),n("div",I,[s(f,{links:L.value},null,8,["links"])])):i("",!0)])])]),s(x,{show:O.value,title:"Parent",fields:C,editing:R.value,onClose:T,onSubmitted:U},null,8,["show","editing"])]}),_:1}))}};export{N as default};
