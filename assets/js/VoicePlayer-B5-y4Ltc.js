import{o as e,u as a,Q as l,p as o}from"./app-BwCflFkV.js";import{Q as t}from"./QLinearProgress-BKKQOFX1.js";import{f as r,a as u,k as n,o as i,e as s,L as v,I as c,M as d,O as f,b as p,U as m,J as y,V as h,n as g}from"./vendor-CUZ9QTQV.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";const w={class:"voice-player"},k={class:"row items-center q-gutter-sm"},_={class:"col"},C={class:"text-caption text-grey-7 time-display"},R=["src"],W=e({__name:"VoicePlayer",props:{audioUrl:{type:String,required:!0},showWaveform:{type:Boolean,default:!1},autoplay:{type:Boolean,default:!1}},setup(e){const W=e,b=a(),x=r(null),E=r(null),j=r(null),S=r(!1),z=r(!1),U=r(0),B=r(0),M=r(!1),T=r(1),q=r([]),L=[.5,.75,1,1.25,1.5,2],P=u(()=>B.value>0?U.value/B.value:0),Q=async()=>{if(x.value)try{S.value?x.value.pause():(z.value=!0,await x.value.play())}catch(e){console.error("Error playing audio:",e),b.notify({type:"negative",message:"Failed to play audio",position:"top"})}finally{z.value=!1}},$=e=>{if(!x.value||0===B.value)return;const a=e.target.getBoundingClientRect(),l=(e.clientX-a.left)/a.width*B.value;x.value.currentTime=l},A=e=>{if(!x.value||0===B.value)return;const a=E.value.getBoundingClientRect(),l=(e.clientX-a.left)/a.width*B.value;x.value.currentTime=l},D=()=>{x.value&&(M.value=!M.value,x.value.muted=M.value)},I=()=>{const e=(L.indexOf(T.value)+1)%L.length;T.value=L[e],x.value&&(x.value.playbackRate=T.value)},N=()=>{const e=document.createElement("a");e.href=W.audioUrl,e.download=`voice-note-${Date.now()}.wav`,document.body.appendChild(e),e.click(),document.body.removeChild(e)},O=e=>{if(!e||isNaN(e))return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`},V=()=>{if(!E.value||!q.value.length)return;const e=E.value,a=e.getContext("2d"),l=e.width,o=e.height;a.clearRect(0,0,l,o),a.fillStyle="#1976d2";const t=l/q.value.length;q.value.forEach((e,l)=>{const r=e*o,u=l*t,n=(o-r)/2;a.fillRect(u,n,t-1,r)}),P.value>0&&(a.fillStyle="rgba(25, 118, 210, 0.3)",a.fillRect(0,0,l*P.value,o))},X=()=>{B.value=x.value.duration,W.autoplay&&Q(),W.showWaveform&&(async()=>{if(W.showWaveform&&x.value)try{const e=100,a=[];for(let l=0;l<e;l++)a.push(.8*Math.random()+.1);q.value=a,await g(),V()}catch(e){console.error("Error generating waveform:",e)}})()},F=()=>{U.value=x.value.currentTime,W.showWaveform&&V()},J=()=>{S.value=!1,U.value=0,W.showWaveform&&V()},G=e=>{console.error("Audio error:",e),z.value=!1,b.notify({type:"negative",message:"Error loading audio file",position:"top"})};return n(()=>{var e;return null==(e=x.value)?void 0:e.paused},e=>{S.value=!e}),n(()=>W.audioUrl,()=>{x.value&&x.value.load()}),i(()=>{if(E.value&&W.showWaveform){const e=E.value;e.width=e.offsetWidth,e.height=60}}),s(()=>{x.value&&x.value.pause()}),(a,r)=>(c(),v("div",w,[d("div",k,[p(l,{icon:S.value?"pause":"play_arrow",round:"",color:"primary",size:"sm",onClick:Q,loading:z.value},null,8,["icon","loading"]),d("div",_,[p(t,{value:P.value,color:"primary","track-color":"grey-3",size:"8px",rounded:"",class:"cursor-pointer",onClick:$},null,8,["value"])]),d("div",C,m(O(U.value))+" / "+m(O(B.value)),1),p(l,{icon:M.value?"volume_off":"volume_up",flat:"",round:"",size:"sm",onClick:D},null,8,["icon"]),p(l,{icon:"download",flat:"",round:"",size:"sm",onClick:N},{default:y(()=>[p(o,null,{default:y(()=>r[0]||(r[0]=[h("Download Audio")])),_:1})]),_:1}),p(l,{flat:"",round:"",size:"sm",onClick:I,class:"speed-btn"},{default:y(()=>[h(m(T.value)+"x ",1),p(o,null,{default:y(()=>r[1]||(r[1]=[h("Playback Speed")])),_:1})]),_:1})]),e.showWaveform?(c(),v("div",{key:0,class:"waveform-container q-mt-sm",ref_key:"waveformRef",ref:j},[d("canvas",{ref_key:"canvasRef",ref:E,class:"waveform-canvas",onClick:A},null,512)],512)):f("",!0),d("audio",{ref_key:"audioRef",ref:x,src:e.audioUrl,preload:"metadata",onLoadedmetadata:X,onTimeupdate:F,onEnded:J,onError:G},null,40,R)]))}},[["__scopeId","data-v-7967f027"]]);export{W as default};
