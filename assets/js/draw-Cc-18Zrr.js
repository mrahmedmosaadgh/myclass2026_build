import{d as e,f as t,o as a,e as o,L as l,I as n,M as i,O as r,S as s,V as u,x as d,U as c,ab as v}from"./vendor-EI0FRBVb.js";import{p as h}from"./app-Dccx8xF5.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./ui-B__oX9pK.js";const p={class:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 p-4"},g={class:"max-w-5xl mx-auto"},x={class:"bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl p-6 mb-8 border border-white/30"},f={class:"flex flex-wrap gap-4 justify-center items-center text-sm"},w={class:"flex rounded-xl overflow-hidden shadow-lg"},m={class:"flex items-center gap-6"},b={class:"flex items-center gap-3"},y={class:"font-bold text-lg w-12 text-right"},k={class:"flex gap-3"},R=["disabled"],P=["disabled"],C={class:"flex gap-3"},j={class:"bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-xl shadow-lg cursor-pointer transition"},L={class:"bg-white/90 backdrop-blur-xl rounded-3xl shadow-2xl overflow-hidden border border-white/40"},B={key:0,class:"fixed inset-0 pointer-events-none flex items-end justify-center pb-12 z-50"},I={class:"bg-black/90 text-white px-10 py-5 rounded-full text-2xl font-bold shadow-2xl animate-pulse"},O=h(e({__name:"draw",setup(e){const h=t(null);let O=null;const U=t("pen"),S=t("#8B5CF6"),M=t(6),E=t(!1),T=t(!1),D=t(0),z=t(null),A=t([]),V=t([]),F=t(-1);function J(){if(!h.value||!O)return;const e=h.value.getBoundingClientRect();h.value.width=e.width*devicePixelRatio,h.value.height=e.height*devicePixelRatio,O.scale(devicePixelRatio,devicePixelRatio),K()}function N(e){if(!h.value)return{x:0,y:0};const t=h.value.getBoundingClientRect();return{x:(e.clientX-t.left)*devicePixelRatio,y:(e.clientY-t.top)*devicePixelRatio}}function _(e){if(T.value||!O)return;E.value=!0;const t=N(e);A.value.push({tool:U.value,color:"pen"===U.value?S.value:null,width:M.value,path:[t]}),O.beginPath(),O.moveTo(t.x/devicePixelRatio,t.y/devicePixelRatio),W()}function H(e){if(!E.value||!O||!A.value.length)return;const t=N(e);A.value[A.value.length-1].path.push(t),O.lineTo(t.x/devicePixelRatio,t.y/devicePixelRatio),O.stroke()}function G(){E.value&&(E.value=!1,q())}function W(e){if(!O)return;const t=e||{tool:U.value,color:S.value,width:M.value};"eraser"===t.tool?O.globalCompositeOperation="destination-out":(O.globalCompositeOperation="source-over",O.strokeStyle=t.color,O.lineWidth=t.width)}function q(){if(!O||!h.value)return;const e=O.getImageData(0,0,h.value.width,h.value.height);V.value=V.value.slice(0,F.value+1),V.value.push(e),F.value=V.value.length-1}function X(){F.value<=0||(F.value--,O&&h.value&&O.putImageData(V.value[F.value],0,0))}function Y(){O&&h.value&&(O.clearRect(0,0,h.value.width,h.value.height),A.value=[],z.value=null,V.value=[],F.value=-1,q())}function $(){z.value=null,K()}function K(){if(O&&h.value)if(O.clearRect(0,0,h.value.width,h.value.height),z.value){const e=new Image;e.onload=()=>{O.drawImage(e,0,0,h.value.width/devicePixelRatio,h.value.height/devicePixelRatio),Q()},e.src=z.value}else Q()}function Q(){A.value.forEach(e=>{if(!(e.path.length<2)){O.beginPath(),O.moveTo(e.path[0].x/devicePixelRatio,e.path[0].y/devicePixelRatio),W(e);for(let t=1;t<e.path.length;t++)O.lineTo(e.path[t].x/devicePixelRatio,e.path[t].y/devicePixelRatio);O.stroke()}})}async function Z(){if(!A.value.length||!O||!h.value)return;if(T.value=!0,D.value=0,O.clearRect(0,0,h.value.width,h.value.height),z.value){const e=new Image;e.src=z.value,await new Promise(t=>e.onload=t),O.drawImage(e,0,0,h.value.width/devicePixelRatio,h.value.height/devicePixelRatio)}let e=A.value.reduce((e,t)=>e+t.path.length,0),t=0;for(const a of A.value)if(!(a.path.length<2)){O.beginPath(),O.moveTo(a.path[0].x/devicePixelRatio,a.path[0].y/devicePixelRatio),W(a);for(let o=1;o<a.path.length;o++)O.lineTo(a.path[o].x/devicePixelRatio,a.path[o].y/devicePixelRatio),O.stroke(),t++,D.value=t/e*100,await new Promise(requestAnimationFrame)}T.value=!1}function ee(e){const t=new Image;t.onload=()=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;e.getContext("2d").drawImage(t,0,0),z.value=e.toDataURL("image/png"),K()},t.onerror=()=>alert("Failed to load image"),t.src=e}async function te(){try{const e=await navigator.clipboard.read();for(const t of e){const e=t.types.find(e=>e.startsWith("image/"));if(e){const a=await t.getType(e);return void ee(URL.createObjectURL(a))}}alert("No image found in clipboard")}catch(e){alert("Clipboard access denied – copy an image first!")}}function ae(e){var t;if(T.value)return;const a=null==(t=e.clipboardData)?void 0:t.items;if(a)for(const o of a)if(o.type.startsWith("image/")){e.preventDefault();const t=o.getAsFile();return void(t&&ee(URL.createObjectURL(t)))}}function oe(){const e={version:4,background:z.value,strokes:A.value,createdAt:(new Date).toISOString()},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),o=document.createElement("a");o.href=a,o.download=`magic-canvas-${(new Date).toISOString().slice(0,10)}.json`,o.click(),URL.revokeObjectURL(a)}function le(e){var t;const a=null==(t=e.target.files)?void 0:t[0];if(!a)return;const o=new FileReader;o.onload=()=>{try{const e=JSON.parse(o.result);z.value=e.background||null,A.value=e.strokes||[],K(),q()}catch(e){alert("Invalid file!")}},o.readAsText(a)}return a(()=>{!function(){if(!h.value)return;if(O=h.value.getContext("2d"),!O)return;O.lineCap="round",O.lineJoin="round",J(),q()}(),window.addEventListener("resize",J),window.addEventListener("paste",ae)}),o(()=>{window.removeEventListener("resize",J),window.removeEventListener("paste",ae)}),(e,t)=>(n(),l("div",p,[i("div",g,[t[10]||(t[10]=i("h1",{class:"text-center text-5xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2"}," ✨ Magic Canvas ✨ ",-1)),t[11]||(t[11]=i("p",{class:"text-center text-gray-600 mb-8"},"Draw • Erase • Replay • Paste Background • Save/Load",-1)),i("div",x,[i("div",f,[i("div",w,[i("button",{onClick:t[0]||(t[0]=e=>U.value="pen"),class:s(["pen"===U.value?"bg-gradient-to-r from-purple-500 to-pink-500 text-white":"bg-gray-100 text-gray-700","flex items-center gap-2 px-6 py-4 font-medium transition"])},t[4]||(t[4]=[i("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})],-1),u(" Pen ")]),2),i("button",{onClick:t[1]||(t[1]=e=>U.value="eraser"),class:s(["eraser"===U.value?"bg-gradient-to-r from-red-500 to-orange-500 text-white":"bg-gray-100 text-gray-700","flex items-center gap-2 px-6 py-4 font-medium transition"])},t[5]||(t[5]=[i("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"}),i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 7v4m0 4v.01"})],-1),u(" Eraser ")]),2)]),i("div",m,[d(i("input",{type:"color","onUpdate:modelValue":t[2]||(t[2]=e=>S.value=e),class:"w-14 h-14 rounded-full cursor-pointer shadow-xl hover:scale-110 transition",title:"Color"},null,512),[[v,S.value]]),i("div",b,[d(i("input",{type:"range","onUpdate:modelValue":t[3]||(t[3]=e=>M.value=e),min:"1",max:"50",class:"w-40 accent-purple-600"},null,512),[[v,M.value,void 0,{number:!0}]]),i("span",y,c(M.value),1)])]),i("div",k,[i("button",{onClick:Y,class:"bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-xl shadow-lg transition"},"Clear All"),i("button",{onClick:X,disabled:F.value<=0,class:"bg-gray-600 hover:bg-gray-700 disabled:opacity-40 text-white px-6 py-3 rounded-xl shadow-lg transition"},"Undo",8,R),i("button",{onClick:Z,disabled:0===A.value.length,class:"bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white px-6 py-3 rounded-xl shadow-lg transition flex items-center gap-2"},t[6]||(t[6]=[i("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.752 11.168l-6.718-3.873A1 1 0 007 8.135v7.73a1 1 0 001.034.968l6.718-3.873a1 1 0 000-1.792z"})],-1),u(" Replay ")]),8,P)]),i("div",C,[i("button",{onClick:te,class:"relative bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white px-6 py-3 rounded-xl shadow-lg transition flex items-center gap-2 overflow-hidden group"},t[7]||(t[7]=[i("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),u(" Paste BG "),i("span",{class:"absolute inset-0 bg-white/20 -translate-x-full group-hover:translate-x-0 transition-transform duration-500"},null,-1)])),z.value?(n(),l("button",{key:0,onClick:$,class:"bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-xl shadow-lg transition flex items-center gap-2"},t[8]||(t[8]=[i("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),u(" Remove BG ")]))):r("",!0),i("button",{onClick:oe,class:"bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl shadow-lg transition"},"Save JSON"),i("label",j,[t[9]||(t[9]=u(" Load JSON ")),i("input",{type:"file",onChange:le,accept:".json",class:"hidden"},null,32)])])])]),i("div",L,[i("canvas",{ref_key:"canvas",ref:h,onPointerdown:_,onPointermove:H,onPointerup:G,onPointerleave:G,onPointercancel:G,class:s(["w-full block touch-none","eraser"===U.value?"cursor-eraser":"cursor-crosshair"]),style:{height:"calc(100vh - 280px)","min-height":"500px"}},null,34)]),T.value?(n(),l("div",B,[i("div",I," Replaying... "+c(Math.round(D.value))+"% ",1)])):r("",!0),t[12]||(t[12]=i("div",{class:"text-center mt-4 text-sm text-gray-500"},' Tip: Copy any image → Ctrl+V (or click "Paste BG") ',-1))])]))}}),[["__scopeId","data-v-520d9362"]]);export{O as default};
