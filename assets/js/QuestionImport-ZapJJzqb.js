import{f as e,a as l,d as s,N as t,J as a,R as i,V as r,z as o,an as n,O as d,b as u,W as c,U as p,F as v,Q as m,a0 as f}from"./vendor-BWKGNkNB.js";import{V as _}from"./ValidationError-D34RFmX-.js";import{u as g}from"./useQuizI18n-COVRmzJR.js";import{u as h}from"./i18n-B0T1C7j3.js";import{r as x}from"./app-NYt77MEb.js";import"./offline-BzIlwqNM.js";import"./ui-B7TfxbV_.js";const w={class:"question-import"},y={class:"question-import__title"},b={class:"question-import__info"},F={class:"form-group"},k={for:"import-file",class:"form-label"},E={class:"file-input-wrapper"},z={key:0,class:"file-input-placeholder"},M={class:"file-input-text"},I={class:"file-input-hint"},S={key:1,class:"file-info"},j={class:"file-info__details"},q={class:"file-info__name"},C={class:"file-info__meta"},B=["aria-label"],L={key:0,class:"import-progress"},A={class:"import-progress__text"},T={key:1,class:"import-results"},Q={class:"import-results__stats"},V={class:"stat"},D={class:"stat__value"},N={class:"stat stat--success"},O={class:"stat__value"},R={class:"stat stat--error"},U={class:"stat__value"},X={key:0,class:"import-errors"},$={class:"import-errors__list"},G={class:"import-error__row"},H={class:"import-error__message"},K={class:"form-actions"},W=["disabled"],Z=["disabled"],J=x(s({__name:"QuestionImport",emits:["submit","cancel"],setup(s,{expose:x,emit:J}){const{t:P}=h(),{importTitle:Y,importSelectFile:ee,importImporting:le}=g(),se=J,te=e(null),ae=e(null),ie=e(!1),re=e(null),{validateFile:oe,getFieldError:ne,hasFieldError:de,clearErrors:ue,formatFileSize:ce,getFileInfo:pe,MAX_FILE_SIZE:ve}=function(){const s=e([]),t=["csv","txt","xlsx","xls"],a=["text/csv","text/plain","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],i=10485760,r=e=>{const l=e.split(".");return l.length>1?l[l.length-1].toLowerCase():""},o=e=>{const l=r(e.name);return t.includes(l)?(e.type&&!a.includes(e.type)&&console.warn("File MIME type mismatch:",e.type),null):`Invalid file type. Allowed types: ${t.join(", ")}`},n=e=>{if(e.size>i){const l=10;return`File size (${(e.size/1048576).toFixed(2)}MB) exceeds maximum allowed size (${l}MB)`}return 0===e.size?"File is empty":null},d=e=>e.name&&0!==e.name.trim().length?/[<>:"|?*\x00-\x1f]/.test(e.name)?"File name contains invalid characters":null:"File name is invalid",u=e=>{if(0===e)return"0 Bytes";const l=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,l)*100)/100+" "+["Bytes","KB","MB","GB"][l]};return{errors:l(()=>s.value),validateFile:e=>{if(s.value=[],!e)return s.value.push({field:"file",message:"Please select a file to import"}),!1;const l=d(e);l&&s.value.push({field:"file",message:l});const t=o(e);t&&s.value.push({field:"file",message:t});const a=n(e);return a&&s.value.push({field:"file",message:a}),0===s.value.length},validateFileType:o,validateFileSize:n,validateFileName:d,getFieldError:e=>{const l=s.value.find(l=>l.field===e);return l?l.message:null},hasFieldError:e=>s.value.some(l=>l.field===e),clearErrors:()=>{s.value=[]},clearFieldError:e=>{s.value=s.value.filter(l=>l.field!==e)},setServerErrors:e=>{s.value=[],Object.entries(e).forEach(([e,l])=>{l.forEach(l=>{s.value.push({field:e,message:l})})})},formatFileSize:u,getFileInfo:e=>({name:e.name,size:u(e.size),type:e.type||"Unknown",extension:r(e.name),lastModified:new Date(e.lastModified).toLocaleString()}),ALLOWED_EXTENSIONS:t,MAX_FILE_SIZE:i}}(),me=l(()=>ae.value?pe(ae.value):null),fe=e=>{var l;const s=(null==(l=e.target.files)?void 0:l[0])||null;ue(),re.value=null,s&&oe(s)?ae.value=s:(ae.value=null,te.value&&(te.value.value=""))},_e=()=>{ae.value=null,re.value=null,ue(),te.value&&(te.value.value="")},ge=async()=>{ue(),oe(ae.value)&&(ie.value=!0,se("submit",ae.value))},he=()=>{se("cancel")};return x({setImportResults:e=>{re.value=e,ie.value=!1},setErrors:e=>{ie.value=!1},clearFile:_e}),(e,l)=>(a(),t("div",w,[i("h2",y,r(o(Y)()),1),i("div",b,[i("p",null,r(o(P)("quiz.import.uploadInstructions")),1),l[0]||(l[0]=n('<ul class="column-list" data-v-047ddd4c><li data-v-047ddd4c><strong data-v-047ddd4c>question_type</strong> - Question type slug (e.g., multiple_choice, true_false)</li><li data-v-047ddd4c><strong data-v-047ddd4c>grade_level</strong> - Grade level name</li><li data-v-047ddd4c><strong data-v-047ddd4c>subject</strong> - Subject name</li><li data-v-047ddd4c><strong data-v-047ddd4c>topic</strong> - Topic name (optional)</li><li data-v-047ddd4c><strong data-v-047ddd4c>question_text</strong> - The question text</li><li data-v-047ddd4c><strong data-v-047ddd4c>option_a, option_b, option_c, option_d</strong> - Answer options</li><li data-v-047ddd4c><strong data-v-047ddd4c>correct_answer</strong> - Correct answer(s) (e.g., A or A,C for multi-select)</li><li data-v-047ddd4c><strong data-v-047ddd4c>bloom_level</strong> - Bloom taxonomy level (1-6, optional)</li><li data-v-047ddd4c><strong data-v-047ddd4c>difficulty_level</strong> - Difficulty level (1-5, optional)</li><li data-v-047ddd4c><strong data-v-047ddd4c>estimated_time_sec</strong> - Estimated time in seconds (optional)</li><li data-v-047ddd4c><strong data-v-047ddd4c>hints</strong> - Semicolon-separated hints (optional)</li><li data-v-047ddd4c><strong data-v-047ddd4c>explanation</strong> - Explanation text (optional)</li><li data-v-047ddd4c><strong data-v-047ddd4c>status</strong> - Status (draft, active, review, archived)</li></ul>',1))]),i("form",{onSubmit:f(ge,["prevent"]),class:"question-import__form"},[i("div",F,[i("label",k,[c(r(o(ee)())+" ",1),l[1]||(l[1]=i("span",{class:"required"},"*",-1))]),i("div",E,[i("input",{id:"import-file",ref_key:"fileInput",ref:te,type:"file",accept:".csv,.txt,.xlsx,.xls",class:p(["file-input",{"file-input--error":o(de)("file")}]),onChange:fe},null,34),ae.value?(a(),t("div",S,[l[4]||(l[4]=i("div",{class:"file-info__icon"},[i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),i("div",j,[i("p",q,r(me.value.name),1),i("p",C,r(me.value.size)+" â€¢ "+r(me.value.extension.toUpperCase()),1)]),i("button",{type:"button",class:"file-info__remove",onClick:_e,"aria-label":o(P)("quiz.import.removeFile")},l[3]||(l[3]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,B)])):(a(),t("div",z,[l[2]||(l[2]=i("svg",{class:"file-input-icon",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),i("p",M,r(o(P)("quiz.import.clickToSelect")),1),i("p",I,r(o(P)("quiz.import.fileHint"))+" (max "+r(o(ce)(o(ve)))+") ",1)]))]),u(_,{error:o(ne)("file")},null,8,["error"])]),ie.value?(a(),t("div",L,[l[5]||(l[5]=i("div",{class:"import-progress__spinner"},null,-1)),i("p",A,r(o(le)()),1)])):d("",!0),re.value?(a(),t("div",T,[i("div",{class:p(["import-results__summary",{"import-results__summary--success":0===re.value.failed,"import-results__summary--partial":re.value.failed>0&&re.value.successful>0,"import-results__summary--error":0===re.value.successful}])},[l[9]||(l[9]=i("h3",{class:"import-results__title"},"Import Complete",-1)),i("div",Q,[i("div",V,[l[6]||(l[6]=i("span",{class:"stat__label"},"Total Rows:",-1)),i("span",D,r(re.value.total_rows),1)]),i("div",N,[l[7]||(l[7]=i("span",{class:"stat__label"},"Successful:",-1)),i("span",O,r(re.value.successful),1)]),i("div",R,[l[8]||(l[8]=i("span",{class:"stat__label"},"Failed:",-1)),i("span",U,r(re.value.failed),1)])])],2),re.value.errors&&re.value.errors.length>0?(a(),t("div",X,[l[10]||(l[10]=i("h4",{class:"import-errors__title"},"Error Details",-1)),i("div",$,[(a(!0),t(v,null,m(re.value.errors,(e,l)=>(a(),t("div",{key:l,class:"import-error"},[i("span",G,"Row "+r(e.row)+":",1),i("span",H,r(e.message),1)]))),128))])])):d("",!0)])):d("",!0),i("div",K,[i("button",{type:"button",class:"btn btn--secondary",onClick:he,disabled:ie.value}," Cancel ",8,W),i("button",{type:"submit",class:"btn btn--primary",disabled:!ae.value||ie.value},r(ie.value?o(le)():o(P)("quiz.import.importQuestions")),9,Z)])],32)]))}}),[["__scopeId","data-v-047ddd4c"]]);export{J as default};
