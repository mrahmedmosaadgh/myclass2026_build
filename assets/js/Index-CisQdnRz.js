import{u as a,f as e,b as t,aI as l,g as i,Q as o,i as n,R as s,j as r,k as d,l as u,t as c,d as p,h as f,o as g,aS as v,e as m}from"./app-Dtv5Fi9L.js";import{Q as y}from"./QPagination-DzFw2F_8.js";import{Q as _}from"./QSelect-BslHFD89.js";import{Q as h}from"./QForm-Cyf9p9ZM.js";import{Z as b,f as k,a as w,_ as x,o as N,I as V,J as j,K as S,R as q,b as C,O as A,N as T,W as I,V as O,F as R,Q as D,y as F,U as Q,a0 as U}from"./vendor-BWKGNkNB.js";import{_ as E}from"./AppLayout-B3PyevP7.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";const M=b("notification",()=>{const a=k([]),e=k(!1),t=k(null),l=k({current_page:1,last_page:1,per_page:15,total:0}),i=w(()=>a.value.filter(a=>null===a.read_at).length);return{notifications:a,loading:e,error:t,pagination:l,unreadCount:i,fetchNotifications:async(i=1)=>{try{e.value=!0,t.value=null;const o=await x.get(`/notifications?page=${i}`),n=o.data;return n.data?(a.value=n.data,l.value={current_page:n.current_page,last_page:n.last_page,per_page:n.per_page,total:n.total}):(a.value=n,l.value={current_page:1,last_page:1,per_page:n.length,total:n.length}),o.data}catch(o){throw console.error("Error fetching notifications:",o),t.value="Failed to load notifications",o}finally{e.value=!1}},markAsRead:async e=>{try{const t=await x.post(`/notifications/${e}/read`),l=a.value.findIndex(a=>a.id===e);return-1!==l&&(a.value[l].read_at=(new Date).toISOString()),t.data}catch(t){throw console.error("Error marking notification as read:",t),t}},markAllAsRead:async()=>{try{const e=await x.post("/notifications/mark-all-read");return a.value=a.value.map(a=>({...a,read_at:a.read_at||(new Date).toISOString()})),e.data}catch(e){throw console.error("Error marking all notifications as read:",e),e}},deleteNotification:async e=>{try{const t=await x.delete(`/notifications/${e}`);return a.value=a.value.filter(a=>a.id!==e),t.data}catch(t){throw console.error("Error deleting notification:",t),t}},sendTestNotification:async(a,e,t="both")=>{try{return(await x.post("/notifications/send-test",{title:a,body:e,type:t})).data}catch(l){throw console.error("Error sending test notification:",l),l}}}}),P={class:"py-12"},$={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},z={class:"flex justify-between items-center"},B={class:"q-gutter-sm"},L={key:0,class:"flex justify-center q-py-md"},Y={key:2,class:"text-center q-py-xl"},J={key:3},K={class:"q-gutter-sm"},W={__name:"Index",props:{notifications:{type:Object,default:()=>({data:[],current_page:1,last_page:1,per_page:15,total:0})}},setup(b){const x=b,W=a(),Z=M(),G=k(!1),H=k(null),X=k(x.notifications.data||[]),aa=k({current_page:x.notifications.current_page||1,last_page:x.notifications.last_page||1,per_page:x.notifications.per_page||15,total:x.notifications.total||0}),ea=k(aa.value.current_page),ta=k(!1),la=k(!1),ia=k({title:"Test Notification",body:"This is a test notification message.",type:"both"}),oa=w(()=>X.value.filter(a=>null===a.read_at).length),na=async(a=1)=>{try{G.value=!0,H.value=null;const e=await Z.fetchNotifications(a);e.data?(X.value=e.data,aa.value={current_page:e.current_page,last_page:e.last_page,per_page:e.per_page,total:e.total}):(X.value=e,aa.value={current_page:1,last_page:1,per_page:e.length,total:e.length})}catch(e){H.value="Failed to load notifications",console.error(e)}finally{G.value=!1}},sa=async()=>{try{await Z.markAllAsRead(),X.value=X.value.map(a=>({...a,read_at:a.read_at||(new Date).toISOString()})),W.notify({type:"positive",message:"All notifications marked as read",position:"top-right"})}catch(a){W.notify({type:"negative",message:"Failed to mark all notifications as read",position:"top-right"}),console.error(a)}},ra=async a=>{try{await Z.deleteNotification(a),X.value=X.value.filter(e=>e.id!==a),W.notify({type:"positive",message:"Notification deleted",position:"top-right"})}catch(e){W.notify({type:"negative",message:"Failed to delete notification",position:"top-right"}),console.error(e)}},da=a=>{a<1||a>aa.value.last_page||na(a)},ua=async()=>{try{la.value=!0,await Z.sendTestNotification(ia.value.title,ia.value.body,ia.value.type),ta.value=!1,W.notify({type:"positive",message:"Test notification sent successfully",position:"top-right"}),"database"!==ia.value.type&&"both"!==ia.value.type||await na(1)}catch(a){W.notify({type:"negative",message:"Failed to send test notification",position:"top-right"}),console.error(a)}finally{la.value=!1}};return N(()=>{x.notifications.data&&0!==x.notifications.data.length||na()}),(a,b)=>(j(),V(E,{title:"Notifications"},{header:S(()=>b[7]||(b[7]=[q("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Notifications ",-1)])),default:S(()=>[q("div",P,[q("div",$,[C(p,{flat:"",bordered:"",class:"q-pa-md"},{default:S(()=>[C(e,null,{default:S(()=>[q("div",z,[b[8]||(b[8]=q("div",{class:"text-h5"},"Your Notifications",-1)),q("div",B,[oa.value>0?(j(),V(t,{key:0,onClick:sa,color:"primary",disable:G.value,icon:"done_all",label:"Mark All as Read"},null,8,["disable"])):A("",!0),C(t,{onClick:b[0]||(b[0]=a=>ta.value=!0),color:"positive",icon:"send",label:"Send Test Notification"})])])]),_:1}),C(e,null,{default:S(()=>[G.value?(j(),T("div",L,[C(l,{color:"primary",size:"3em"})])):H.value?(j(),V(i,{key:1,class:"bg-negative text-white q-mb-md"},{action:S(()=>[C(t,{flat:"",color:"white",label:"Retry",onClick:b[1]||(b[1]=a=>na())})]),default:S(()=>[I(O(H.value)+" ",1)]),_:1})):0===X.value.length?(j(),T("div",Y,[C(o,{name:"notifications_off",size:"4em",color:"grey-5"}),b[9]||(b[9]=q("div",{class:"text-h6 q-mt-md"},"No notifications",-1)),b[10]||(b[10]=q("div",{class:"text-grey-7"},"You don't have any notifications yet.",-1))])):(j(),T("div",J,[C(n,{separator:""},{default:S(()=>[(j(!0),T(R,null,D(X.value,a=>F((j(),V(r,{key:a.id,class:Q(a.read_at?"":"bg-blue-1"),clickable:""},{default:S(()=>[C(d,null,{default:S(()=>[C(u,{class:"text-weight-medium"},{default:S(()=>[I(O(a.data.title),1)]),_:2},1024),C(u,{caption:""},{default:S(()=>[I(O(a.data.body),1)]),_:2},1024),C(u,{caption:""},{default:S(()=>{return[I(O((e=a.created_at,new Date(e).toLocaleString())),1)];var e}),_:2},1024)]),_:2},1024),C(d,{side:""},{default:S(()=>[q("div",K,[a.read_at?A("",!0):(j(),V(t,{key:0,flat:"",round:"",color:"primary",icon:"done",onClick:U(e=>(async a=>{try{await Z.markAsRead(a);const e=X.value.findIndex(e=>e.id===a);-1!==e&&(X.value[e].read_at=(new Date).toISOString()),W.notify({type:"positive",message:"Notification marked as read",position:"top-right"})}catch(e){W.notify({type:"negative",message:"Failed to mark notification as read",position:"top-right"}),console.error(e)}})(a.id),["stop"])},{default:S(()=>[C(c,null,{default:S(()=>b[11]||(b[11]=[I("Mark as Read")])),_:1})]),_:2},1032,["onClick"])),C(t,{flat:"",round:"",color:"negative",icon:"delete",onClick:U(e=>{return t=a.id,void W.dialog({title:"Confirm",message:"Are you sure you want to delete this notification?",cancel:!0,persistent:!0}).onOk(()=>{ra(t)});var t},["stop"])},{default:S(()=>[C(c,null,{default:S(()=>b[12]||(b[12]=[I("Delete")])),_:1})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1032,["class"])),[[s]])),128))]),_:1})]))]),_:1}),aa.value.last_page>1?(j(),V(e,{key:0,class:"flex justify-center"},{default:S(()=>[C(y,{modelValue:ea.value,"onUpdate:modelValue":[b[2]||(b[2]=a=>ea.value=a),da],max:aa.value.last_page,"max-pages":6,"boundary-links":"","direction-links":""},null,8,["modelValue","max"])]),_:1})):A("",!0)]),_:1})])]),C(m,{modelValue:ta.value,"onUpdate:modelValue":b[6]||(b[6]=a=>ta.value=a),persistent:""},{default:S(()=>[C(p,{style:{"min-width":"350px"}},{default:S(()=>[C(e,null,{default:S(()=>b[13]||(b[13]=[q("div",{class:"text-h6"},"Send Test Notification",-1)])),_:1}),C(e,{class:"q-pt-none"},{default:S(()=>[C(h,{onSubmit:ua},{default:S(()=>[C(f,{modelValue:ia.value.title,"onUpdate:modelValue":b[3]||(b[3]=a=>ia.value.title=a),label:"Title",rules:[a=>!!a||"Title is required"],class:"q-mb-md"},null,8,["modelValue","rules"]),C(f,{modelValue:ia.value.body,"onUpdate:modelValue":b[4]||(b[4]=a=>ia.value.body=a),label:"Message",type:"textarea",rules:[a=>!!a||"Message is required"],class:"q-mb-md"},null,8,["modelValue","rules"]),C(_,{modelValue:ia.value.type,"onUpdate:modelValue":b[5]||(b[5]=a=>ia.value.type=a),options:[{label:"Database Only",value:"database"},{label:"Push Only",value:"push"},{label:"Both Database & Push",value:"both"}],label:"Notification Type","emit-value":"","map-options":""},null,8,["modelValue"])]),_:1})]),_:1}),C(g,{align:"right"},{default:S(()=>[F(C(t,{flat:"",label:"Cancel",color:"negative"},null,512),[[v]]),C(t,{loading:la.value,color:"positive",label:"Send",onClick:ua},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{W as default};
