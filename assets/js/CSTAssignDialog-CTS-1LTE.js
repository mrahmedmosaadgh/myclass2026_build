import{I as e,Y as a,Z as l,X as t,f as s,Q as o,b as i,G as n,c as u,g as d,j as r,k as c,s as p,l as m,h as _,o as b,d as y,e as g,aS as v}from"./app-DlLesFGi.js";import{Q as h}from"./QSpace-BK_PGLKv.js";import{p as f,a as j,h as S,f as x,k as V,I as k,J as q,K as Q,b as w,O as A,R as T,y as B,W as O,V as $,m as z,S as C,U as N}from"./vendor-BWKGNkNB.js";import{Q as U}from"./QSelect-BTh0khse.js";import{Q as R}from"./QForm-CDvMxBSt.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";const F=["text","rect","circle","QBtn","QBadge","QChip","QToolbar","QCheckbox","QRadio","QToggle","QSlider","QRange","QInput","QAvatar"],I=["wave","pulse","pulse-x","pulse-y","fade","blink","none"],D=e({name:"QSkeleton",props:{...a,tag:{type:String,default:"div"},type:{type:String,validator:e=>F.includes(e),default:"rect"},animation:{type:String,validator:e=>I.includes(e),default:"wave"},animationSpeed:{type:[String,Number],default:1500},square:Boolean,bordered:Boolean,size:String,width:String,height:String},setup(e,{slots:a}){const s=f(),o=l(e,s.proxy.$q),i=j(()=>{const a=void 0!==e.size?[e.size,e.size]:[e.width,e.height];return{"--q-skeleton-speed":`${e.animationSpeed}ms`,width:a[0],height:a[1]}}),n=j(()=>`q-skeleton q-skeleton--${!0===o.value?"dark":"light"} q-skeleton--type-${e.type}`+("none"!==e.animation?` q-skeleton--anim q-skeleton--anim-${e.animation}`:"")+(!0===e.square?" q-skeleton--square":"")+(!0===e.bordered?" q-skeleton--bordered":""));return()=>S(e.tag,{class:n.value,style:i.value},t(a.default))}}),G={class:"text-h6"},P={class:"row q-gutter-sm text-caption text-grey-7"},W={class:"text-weight-medium"},E={__name:"CSTAssignDialog",props:{modelValue:{type:Boolean,default:!1},schedule:{type:Object,default:null},day:{type:Number,default:null},period:{type:Number,default:null},classroomName:{type:String,default:""},cstOptions:{type:Array,default:()=>[]},teachers:{type:Array,default:()=>[]},subjects:{type:Array,default:()=>[]},loadingCST:{type:Boolean,default:!1},loadingTeachers:{type:Boolean,default:!1},loadingSubjects:{type:Boolean,default:!1},saving:{type:Boolean,default:!1},slotAvailability:{type:Object,default:null},loadingAvailability:{type:Boolean,default:!1}},emits:["update:modelValue","submit","filter-cst"],setup(e,{emit:a}){const l=e,t=a,f=j({get:()=>l.modelValue,set:e=>t("update:modelValue",e)}),S=["","Sunday","Monday","Tuesday","Wednesday","Thursday"],F=j(()=>S[l.day]||"Day"),I=j(()=>{if(!l.slotAvailability)return l.cstOptions.map(e=>({...e,is_busy:!1,busy_info:null,display_label:`${e.subject_name} - ${e.teacher_name}`}));const e=l.slotAvailability.busy_teachers||{};return l.cstOptions.map(a=>{const l=e[a.teacher_id],t=!!l&&!l.is_current_classroom;return{...a,is_busy:t,busy_info:l,display_label:t?`${a.subject_name} - ${a.teacher_name} ⚠️`:`${a.subject_name} - ${a.teacher_name}`}})}),E=j(()=>{if(!l.slotAvailability)return 0;const e=l.slotAvailability.busy_teachers||{};return Object.values(e).filter(e=>!e.is_current_classroom).length}),J=x({cst_id:null,teacher_substitute_id:null,co_teacher_id:null,co_subject_id:null,place:"",notes:""});V(()=>l.schedule,e=>{J.value=e?{cst_id:e.cst_id,teacher_substitute_id:e.teacher_substitute_id,co_teacher_id:e.co_teacher_id,co_subject_id:e.co_subject_id,place:e.place||"",notes:e.notes||""}:{cst_id:null,teacher_substitute_id:null,co_teacher_id:null,co_subject_id:null,place:"",notes:""}},{immediate:!0}),V(f,e=>{e||(J.value={cst_id:null,teacher_substitute_id:null,co_teacher_id:null,co_subject_id:null,place:"",notes:""})});const K=(e,a,l)=>{t("filter-cst",e),a()},L=()=>{var e;t("submit",{...J.value,schedule_id:null==(e=l.schedule)?void 0:e.id,day:l.day,period:l.period})};return(a,l)=>(q(),k(g,{modelValue:f.value,"onUpdate:modelValue":l[6]||(l[6]=e=>f.value=e),persistent:""},{default:Q(()=>[w(y,{style:{"min-width":"450px","max-width":"550px"}},{default:Q(()=>[w(s,{class:"row items-center q-pb-none"},{default:Q(()=>[T("div",G,[w(o,{name:"assignment",class:"q-mr-sm",color:"primary"}),l[7]||(l[7]=O(" Assign Subject & Teacher "))]),w(h),B(w(i,{icon:"close",flat:"",round:"",dense:""},null,512),[[v]])]),_:1}),w(s,{class:"q-pt-sm"},{default:Q(()=>[T("div",P,[w(n,{dense:"",icon:"calendar_today",size:"sm"},{default:Q(()=>[O($(F.value)+" - Period "+$(e.period),1)]),_:1}),e.classroomName?(q(),k(n,{key:0,dense:"",icon:"meeting_room",size:"sm"},{default:Q(()=>[O($(e.classroomName),1)]),_:1})):A("",!0)])]),_:1}),w(u),e.loadingAvailability?(q(),k(s,{key:0,class:"q-py-sm"},{default:Q(()=>[w(D,{type:"text",width:"60%"})]),_:1})):E.value>0?(q(),k(s,{key:1,class:"q-py-sm"},{default:Q(()=>[w(d,{dense:"",rounded:"",class:"bg-orange-1 text-orange-9"},{avatar:Q(()=>[w(o,{name:"warning",color:"orange"})]),default:Q(()=>[T("span",W,$(E.value)+" teacher(s)",1),l[8]||(l[8]=O(" already assigned at this time slot in other classrooms. ")),l[9]||(l[9]=T("div",{class:"text-caption q-mt-xs"}," They are marked with ⚠️ in the dropdown below. ",-1))]),_:1})]),_:1})):A("",!0),w(s,null,{default:Q(()=>[w(R,{class:"q-gutter-md"},{default:Q(()=>[w(U,{modelValue:J.value.cst_id,"onUpdate:modelValue":l[0]||(l[0]=e=>J.value.cst_id=e),options:I.value,"option-value":"id","option-label":"display_label",label:"Subject & Teacher *",outlined:"",dense:"","emit-value":"","map-options":"",clearable:"","use-input":"","input-debounce":"300",onFilter:K,loading:e.loadingCST||e.loadingAvailability},{prepend:Q(()=>[w(o,{name:"menu_book",color:"primary"})]),option:Q(({opt:e,itemProps:a})=>[w(r,z(a,{class:{"bg-orange-1":e.is_busy}}),{default:Q(()=>[w(c,{avatar:""},{default:Q(()=>[w(p,{style:C({backgroundColor:e.c_bg||"#e0e0e0",color:e.c_text||"#333"}),size:"32px"},{default:Q(()=>{var a;return[O($((null==(a=e.subject_name)?void 0:a.charAt(0))||"S"),1)]}),_:2},1032,["style"])]),_:2},1024),w(c,null,{default:Q(()=>[w(m,{class:N({"text-orange-9":e.is_busy})},{default:Q(()=>[O($(e.subject_name)+" ",1),e.is_busy?(q(),k(o,{key:0,name:"warning",color:"orange",size:"xs",class:"q-ml-xs"})):A("",!0)]),_:2},1032,["class"]),w(m,{caption:"",class:N({"text-orange-7":e.is_busy})},{default:Q(()=>[O($(e.teacher_name),1)]),_:2},1032,["class"]),e.is_busy?(q(),k(m,{key:0,caption:"",class:"text-orange-8"},{default:Q(()=>{var a,l;return[w(o,{name:"info",size:"xs",class:"q-mr-xs"}),O(" Busy in "+$(null==(a=e.busy_info)?void 0:a.assigned_to_classroom)+" ("+$(null==(l=e.busy_info)?void 0:l.subject)+") ",1)]}),_:2},1024)):A("",!0)]),_:2},1024)]),_:2},1040,["class"])]),"no-option":Q(()=>[w(r,null,{default:Q(()=>[w(c,{class:"text-grey"},{default:Q(()=>l[10]||(l[10]=[O("No options available")])),_:1})]),_:1})]),_:1},8,["modelValue","options","loading"]),w(U,{modelValue:J.value.teacher_substitute_id,"onUpdate:modelValue":l[1]||(l[1]=e=>J.value.teacher_substitute_id=e),options:e.teachers,"option-value":"id","option-label":"name",label:"Substitute Teacher (Optional)",outlined:"",dense:"","emit-value":"","map-options":"",clearable:"",loading:e.loadingTeachers},{prepend:Q(()=>[w(o,{name:"swap_horiz",color:"orange"})]),_:1},8,["modelValue","options","loading"]),w(U,{modelValue:J.value.co_teacher_id,"onUpdate:modelValue":l[2]||(l[2]=e=>J.value.co_teacher_id=e),options:e.teachers,"option-value":"id","option-label":"name",label:"Co-Teacher (Optional)",outlined:"",dense:"","emit-value":"","map-options":"",clearable:"",loading:e.loadingTeachers},{prepend:Q(()=>[w(o,{name:"group",color:"blue"})]),_:1},8,["modelValue","options","loading"]),w(U,{modelValue:J.value.co_subject_id,"onUpdate:modelValue":l[3]||(l[3]=e=>J.value.co_subject_id=e),options:e.subjects,"option-value":"id","option-label":"name",label:"Co-Subject (Optional)",outlined:"",dense:"","emit-value":"","map-options":"",clearable:"",loading:e.loadingSubjects},{prepend:Q(()=>[w(o,{name:"library_books",color:"teal"})]),_:1},8,["modelValue","options","loading"]),w(_,{modelValue:J.value.place,"onUpdate:modelValue":l[4]||(l[4]=e=>J.value.place=e),label:"Location/Room (Optional)",outlined:"",dense:""},{prepend:Q(()=>[w(o,{name:"place"})]),_:1},8,["modelValue"]),w(_,{modelValue:J.value.notes,"onUpdate:modelValue":l[5]||(l[5]=e=>J.value.notes=e),label:"Notes",outlined:"",dense:"",type:"textarea",rows:"2"},{prepend:Q(()=>[w(o,{name:"note"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),w(u),w(b,{align:"right",class:"q-pa-md"},{default:Q(()=>[B(w(i,{flat:"",label:"Cancel",color:"grey"},null,512),[[v]]),w(i,{label:"Save Assignment",color:"primary",loading:e.saving,onClick:L},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};export{E as default};
