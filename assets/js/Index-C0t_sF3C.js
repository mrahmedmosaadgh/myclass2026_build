import{o as e,u as l,d as a,Q as o,p as t,aF as s,c as i,m as n,h as d,i as r,f as u,A as c,e as m,C as v,l as p,aP as g,b as _,bp as f,a as h}from"./app-CqJgtQaN.js";import{Q as y}from"./QSelect-DIrzf0A1.js";import{Q as b}from"./QTd-ByoVTzgk.js";import{Q as w}from"./QBadge-Coi-CloS.js";import{Q as x}from"./QTable-BsElv-Vz.js";import{a as k,Q as C}from"./QToolbar-Ca3FN16A.js";import{Q as S}from"./QFile-xLyhoCdi.js";import{f as V,a as $,o as N,M as q,J as A,N as U,b as I,Q as P,W as j,K as E,I as F,V as Q,F as T,y as z,_ as D}from"./vendor-DuKqz2x4.js";import{u as R,w as M,r as O}from"./xlsx-cMC2LkxH.js";import G from"./StudentPromotionDialog-D29votVA.js";import"./offline-BzIlwqNM.js";import"./i18n-DE5KxGn8.js";import"./ui-BITzTqrO.js";import"./rtl-Cr6c3OOr.js";import"./QMarkupTable-zlNNuWrg.js";import"./QLinearProgress-YbspEMZC.js";import"./use-fullscreen-Dd3XWOIZ.js";import"./use-file-DKm4cWq6.js";import"./QStepperNavigation-D39NU_bn.js";import"./QStepper-Ci1nCW3a.js";import"./use-panel-CvVDQB6d.js";import"./use-render-cache-CmTcazfP.js";const W={class:"q-pa-md"},B={class:"row items-center q-mb-md"},Y={class:"col"},H={class:"text-h4 text-weight-bold"},J={class:"col-auto"},L={class:"row q-col-gutter-md q-mb-md"},K={class:"col-12 col-md-3"},X={class:"text-h6"},Z={class:"col-12 col-md-3"},ee={class:"text-h6"},le={class:"col-12 col-md-3"},ae={class:"text-h6"},oe={class:"col-12 col-md-3"},te={class:"text-h6"},se={class:"row items-center q-mb-sm"},ie={class:"col"},ne={class:"text-h6"},de={class:"col-auto"},re={class:"row q-col-gutter-md"},ue={class:"col-12 col-md-3"},ce={class:"col-12 col-md-3"},me={class:"col-12 col-md-3"},ve={class:"col-12 col-md-3"},pe={class:"col-12 col-md-6"},ge={class:"col-12"},_e={key:0,class:"text-caption text-grey-7"},fe={class:"text-weight-bold"},he={class:"text-caption text-grey-7"},ye={class:"full-width row flex-center q-gutter-sm q-pa-lg"},be={key:0,style:{position:"fixed",bottom:"18px",left:"0",right:"0","z-index":"2000",padding:"0 16px"}},we={class:"text-h6"},xe={key:0,class:"text-caption"},ke={class:"row q-col-gutter-md"},Ce={class:"col-12 col-md-6"},Se={class:"col-12 col-md-6"},Ve={class:"col-12 col-md-6"},$e={class:"col-12"},Ne={class:"col-12 col-md-6"},qe={class:"col-12 col-md-6"},Ae={class:"col-12 col-md-6"},Ue={class:"col-12"},Ie={class:"col-12"},Pe={class:"text-caption"},je={class:"text-subtitle2 q-mb-sm"},Ee={class:"text-caption"},Fe={class:"q-mb-md"},Qe={class:"text-caption"},Te={key:0},ze={key:1},De={class:"text-subtitle2 q-mb-sm"},Re={key:0,class:"q-mb-md"},Me={key:1,class:"q-mt-md"},Oe={class:"row q-gutter-sm"},Ge={class:"text-h6 text-positive q-mb-md"},We={class:"row q-gutter-sm q-mb-sm"},Be={class:"row q-gutter-sm"},Ye=e({__name:"Index",props:{records:Object,schools:Array,grades:Array,academicYears:Array,userRoles:Array,permissions:Object},setup(e){const Ye=e,He=l(),Je=V(!1),Le=V([]),Ke=V([]),Xe=V(!1),Ze=V(!1),el=V(!1),ll=V(null),al=V(!1),ol=V(null),tl=V([]),sl=V(!1),il=V(!1),nl=V(null),dl=V(!1),rl=V(null),ul=V([]),cl=[{name:"name",label:"Name",field:"name",align:"left"},{name:"name_ar",label:"Arabic Name",field:"name_ar",align:"left"},{name:"name_cute",label:"Nickname",field:"name_cute",align:"left"},{name:"notes",label:"Notes",field:"notes",align:"left"}],ml=V("skip"),vl=[{label:"Skip Duplicates (Safe)",value:"skip",description:"Only create new students"},{label:"Update Existing",value:"update",description:"Update duplicate students with new data"}],pl=V(!1),gl=V([]),_l=V(null),fl=V("all"),hl=V(!1),yl=V(null),bl=[{name:"status",label:"Status",field:"status",align:"center",format:e=>e||"pending"},{name:"name",label:"Name",field:"name",align:"left"},{name:"name_ar",label:"Arabic Name",field:"name_ar",align:"left"},{name:"name_cute",label:"Nickname",field:"name_cute",align:"left"},{name:"classroom",label:"Classroom",field:"classroom",align:"left"},{name:"notes",label:"Notes",field:"notes",align:"left"}],wl=V({school_id:null,stage_id:null,grade_id:null,classroom_id:null,search:""}),xl=V([]),kl=V([]),Cl=V([]),Sl=V(Ye.grades||[]),Vl=V(Ye.academicYears||[]),$l=V([]),Nl=V([]),ql=V([]),Al=V({name:"",name_ar:"",name_cute:"",school_id:null,stage_id:null,grade_id:null,classroom_id:null,notes:""}),Ul=V({sortBy:"name",descending:!1,page:1,rowsPerPage:25,rowsNumber:0}),Il=[{name:"index",label:"#",field:"index",align:"left",sortable:!1,style:"width: 50px"},{name:"avatar",label:"",field:"name",align:"center",style:"width: 60px",sortable:!1},{name:"s_id",label:"ID",field:"s_id",align:"left",sortable:!0},{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"school",label:"School",field:e=>{var l;return(null==(l=e.school)?void 0:l.name)||""},align:"left",sortable:!0},{name:"grade",label:"Grade",field:e=>{var l;return(null==(l=e.grade)?void 0:l.name)||""},align:"left",sortable:!0},{name:"classroom",label:"Classroom",field:e=>{var l;return(null==(l=e.classroom)?void 0:l.name)||""},align:"left",sortable:!0},{name:"actions",label:"Actions",field:"id",align:"center",sortable:!1}],Pl=$(()=>Ul.value.rowsNumber||0),jl=$(()=>wl.value.school_id?Le.value.filter(e=>e.school_id===wl.value.school_id).length:0),El=$(()=>Le.value.length),Fl=$(()=>Ke.value.length),Ql=$(()=>wl.value.school_id&&wl.value.grade_id&&wl.value.classroom_id),Tl=()=>{const e=Ye.schools.find(e=>e.id===wl.value.school_id);return(null==e?void 0:e.name)||"N/A"},zl=()=>{const e=kl.value.find(e=>e.id===wl.value.grade_id);return(null==e?void 0:e.name)||"N/A"},Dl=()=>{const e=Cl.value.find(e=>e.id===wl.value.classroom_id);return(null==e?void 0:e.name)||"N/A"},Rl=()=>`${Tl()} â†’ ${zl()} â†’ ${Dl()}`,Ml=$(()=>"all"===fl.value?ul.value:ul.value.filter(e=>e.validationStatus===fl.value)),Ol=e=>{if(!e)return"?";const l=e.split(" ");return l.length>=2?(l[0][0]+l[1][0]).toUpperCase():e.substring(0,2).toUpperCase()},Gl=async()=>{wl.value.stage_id=null,wl.value.grade_id=null,wl.value.classroom_id=null,xl.value=[],kl.value=[],Cl.value=[],wl.value.school_id&&(Hl(wl.value.school_id),await Ll(wl.value.school_id,"school")),Kl()},Wl=async()=>{wl.value.grade_id=null,wl.value.classroom_id=null,kl.value=[],wl.value.stage_id?(await Jl(wl.value.stage_id),await Ll(wl.value.stage_id,"stage")):wl.value.school_id?await Ll(wl.value.school_id,"school"):Cl.value=[],Kl()},Bl=async()=>{wl.value.classroom_id=null,wl.value.grade_id?await Ll(wl.value.grade_id,"grade"):wl.value.stage_id?await Ll(wl.value.stage_id,"stage"):wl.value.school_id?await Ll(wl.value.school_id,"school"):Cl.value=[],Kl()},Yl=async()=>{0===Cl.value.length&&wl.value.school_id&&(wl.value.grade_id?await Ll(wl.value.grade_id,"grade"):wl.value.stage_id?await Ll(wl.value.stage_id,"stage"):await Ll(wl.value.school_id,"school"))},Hl=async e=>{try{const l=await D.get(`/admin/stages/by-school/${e}`);xl.value=l.data}catch(l){console.error("Error loading stages:",l)}},Jl=async e=>{try{const l=await D.get(`/admin/grades/by-stage/${e}`);kl.value=l.data}catch(l){console.error("Error loading grades:",l)}},Ll=async(e,l)=>{try{let a="";a="school"===l?`/admin/classrooms/by-school/${e}`:"stage"===l?`/admin/classrooms/by-stage/${e}`:`/admin/classrooms/by-grade/${e}`;const o=await D.get(a);Cl.value=o.data}catch(a){console.error("Error loading classrooms:",a),Cl.value=[]}},Kl=async()=>{Je.value=!0;try{const e={school_id:wl.value.school_id,stage_id:wl.value.stage_id,grade_id:wl.value.grade_id,classroom_id:wl.value.classroom_id,search:wl.value.search},l=await D.get("/admin/students/filtered",{params:e});Le.value=l.data.records.data||[],Ul.value.rowsNumber=l.data.records.total||0}catch(e){He.notify({type:"negative",message:"Failed to load students"})}finally{Je.value=!1}},Xl=()=>{wl.value={school_id:null,stage_id:null,grade_id:null,classroom_id:null,search:""},xl.value=[],kl.value=[],Cl.value=[],Kl()};let Zl;const ea=()=>{clearTimeout(Zl),Zl=setTimeout(()=>{Kl()},500)},la=e=>{Kl()},aa=(e=null)=>{il.value=!1,nl.value=null,e?(ll.value=e,nl.value=e.classroom_id,Al.value={name:e.name,name_ar:e.name_ar,name_cute:e.name_cute,school_id:e.school_id,stage_id:e.stage_id,grade_id:e.grade_id,classroom_id:e.classroom_id,notes:e.notes},e.school_id&&ta(),e.stage_id&&sa(),e.grade_id&&ia()):(ll.value=null,Al.value={name:"",name_ar:"",name_cute:"",school_id:wl.value.school_id,stage_id:wl.value.stage_id,grade_id:wl.value.grade_id,classroom_id:wl.value.classroom_id,notes:""}),Xe.value=!0},oa=()=>{ll.value&&null!==nl.value&&(il.value=Al.value.classroom_id!==nl.value)},ta=async()=>{if(Al.value.stage_id=null,Al.value.grade_id=null,Al.value.classroom_id=null,Al.value.school_id){const e=await D.get(`/admin/stages/by-school/${Al.value.school_id}`);$l.value=e.data}},sa=async()=>{if(Al.value.grade_id=null,Al.value.classroom_id=null,Al.value.stage_id){const e=await D.get(`/admin/grades/by-stage/${Al.value.stage_id}`);Nl.value=e.data}},ia=async()=>{if(Al.value.classroom_id=null,Al.value.grade_id){const e=await D.get(`/admin/classrooms/by-grade/${Al.value.grade_id}`);ql.value=e.data}},na=async()=>{var e,l;al.value=!0;try{const e=ll.value?`/admin/students/${ll.value.id}`:"/admin/students",l={...Al.value,...ll.value&&{_method:"PUT"}};await D.post(e,l),He.notify({type:"positive",message:ll.value?"Student updated successfully":"Student created successfully"}),Xe.value=!1,Kl()}catch(a){He.notify({type:"negative",message:(null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||"Failed to save student"})}finally{al.value=!1}},da=()=>{if(0!==Le.value.length)try{const e=Le.value.map(e=>{var l,a,o,t;return{ID:e.s_id||"",Name:e.name||"","Arabic Name":e.name_ar||"",Nickname:e.name_cute||"",School:(null==(l=e.school)?void 0:l.name)||"",Stage:(null==(a=e.stage)?void 0:a.name)||"",Grade:(null==(o=e.grade)?void 0:o.name)||"",Classroom:(null==(t=e.classroom)?void 0:t.name)||"",Notes:e.notes||""}}),l=R.json_to_sheet(e),a=R.book_new();R.book_append_sheet(a,l,"Students");const o=(new Date).toISOString().split("T")[0];M(a,`students_export_${o}.xlsx`),He.notify({type:"positive",message:`Successfully exported ${Le.value.length} students`})}catch(e){console.error("Export error:",e),He.notify({type:"negative",message:"Failed to export students"})}else He.notify({type:"warning",message:"No students to export"})},ra=()=>{He.notify({type:"info",message:"Bulk classroom change coming in Phase 4!"})},ua=()=>{if(0!==Ke.value.length)try{const e=Ke.value.map(e=>{var l,a,o,t;return{ID:e.s_id||"",Name:e.name||"","Arabic Name":e.name_ar||"",Nickname:e.name_cute||"",School:(null==(l=e.school)?void 0:l.name)||"",Stage:(null==(a=e.stage)?void 0:a.name)||"",Grade:(null==(o=e.grade)?void 0:o.name)||"",Classroom:(null==(t=e.classroom)?void 0:t.name)||"",Notes:e.notes||""}}),l=R.json_to_sheet(e),a=R.book_new();R.book_append_sheet(a,l,"Students");const o=(new Date).toISOString().split("T")[0];M(a,`students_export_${o}.xlsx`),He.notify({type:"positive",message:`Successfully exported ${Ke.value.length} students`})}catch(e){console.error("Export error:",e),He.notify({type:"negative",message:"Failed to export students"})}else He.notify({type:"warning",message:"No students selected"})},ca=()=>{He.dialog({title:"Confirm Bulk Delete",message:`Are you sure you want to delete ${Ke.value.length} students?`,cancel:!0,persistent:!0}).onOk(()=>{He.notify({type:"info",message:"Bulk delete coming soon!"})})},ma=e=>{He.notify({type:"positive",message:`Successfully promoted ${e.promoted_count} students!`}),Kl()},va=()=>{Ql.value?el.value=!0:He.notify({type:"negative",message:"Please select School, Grade, and Classroom before importing"})},pa=async e=>{if(e)try{const l=await ga(e);tl.value=l.map((e,l)=>({index:l,name:e.name||e.Name||"",name_ar:e.name_ar||e["Arabic Name"]||"",name_cute:e.name_cute||e.Nickname||"",notes:e.notes||e.Notes||""}))}catch(l){He.notify({type:"negative",message:"Error reading Excel file: "+l.message})}},ga=e=>new Promise((l,a)=>{const o=new FileReader;o.onload=e=>{try{const a=new Uint8Array(e.target.result),o=O(a,{type:"array"}),t=o.Sheets[o.SheetNames[0]],s=R.sheet_to_json(t);l(s)}catch(o){a(o)}},o.onerror=a,o.readAsArrayBuffer(e)}),_a=async()=>{sl.value=!0;let e=0,l=0;try{for(const o of tl.value)try{const l={name:o.name,name_ar:o.name_ar||"",name_cute:o.name_cute||"",school_id:wl.value.school_id,stage_id:wl.value.stage_id,grade_id:wl.value.grade_id,classroom_id:wl.value.classroom_id,notes:o.notes||""};await D.post("/admin/students",l),e++}catch(a){l++,console.error("Import error:",a)}He.notify({type:e>0?"positive":"negative",message:`Import complete: ${e} students added${l>0?`, ${l} errors`:""}`,timeout:3e3}),ka(),await Kl()}catch(a){He.notify({type:"negative",message:"Import failed: "+(a.message||"Unknown error")})}finally{sl.value=!1}},fa=()=>{window.location.href="/admin/students/download-template"},ha=()=>{window.location.href="/admin/students/download-template-with-classroom"},ya=async e=>{if(e)try{const l=await ga(e);if(l.length>0&&!("classroom"in l[0])&&!("Classroom"in l[0]))return He.notify({type:"negative",message:'Invalid file: Missing "classroom" column. Please download the correct template.'}),void(rl.value=null);const a=[],o=[];if(l.forEach((e,l)=>{const t=e.name||e.Name||"",s=e.classroom||e.Classroom||"";t.trim()&&s.trim()?a.push({index:l,name:t.trim(),name_ar:(e.name_ar||e["Arabic Name"]||"").trim(),name_cute:(e.name_cute||e.Nickname||"").trim(),classroom:s.trim(),notes:(e.notes||e.Notes||"").trim()}):o.push({row:l+2,reason:t.trim()?"Missing classroom":"Missing name"})}),o.length>0){const e=o.map(e=>`Row ${e.row}: ${e.reason}`).join("\n");He.dialog({title:"Invalid Records Found",message:`Found ${o.length} invalid record(s):\n\n${e}\n\nThese rows will be skipped.`,html:!0})}ul.value=a}catch(l){He.notify({type:"negative",message:"Error reading Excel file: "+l.message})}},ba=async()=>{var e,l;if(!wl.value.school_id)return void He.notify({type:"negative",message:"Please select a school"});const a=ul.value.length;let o=0,t=0,s=0,i=0,n=0,d=0;const r=[],u=He.dialog({title:"Importing Students",message:`Processing 0 of ${a} students...`,progress:{spinner:!1,value:0,color:"primary"},persistent:!0,ok:!1});sl.value=!0;try{for(const[m,v]of ul.value.entries())try{const e=await D.post("/admin/students/import-with-classroom",{school_id:wl.value.school_id,name:v.name,name_ar:v.name_ar,name_cute:v.name_cute,classroom:v.classroom,notes:v.notes,import_mode:ml.value});o++;const l=e.data.status;"created"===l?t++:"updated"===l?s++:"duplicate"===l?i++:"restored"===l&&n++;const r="update"===ml.value?`Created: ${t} | Updated: ${s} | Restored: ${n} | Skipped: ${i} | Failed: ${d}`:`Created: ${t} | Restored: ${n} | Duplicates: ${i} | Failed: ${d}`;u.update({message:`Processing ${o} of ${a} students...\\n${r}`,progress:{value:o/a}})}catch(c){o++,d++,r.push({row:m+2,name:v.name,error:(null==(l=null==(e=c.response)?void 0:e.data)?void 0:l.message)||c.message});const p="update"===ml.value?`Created: ${t} | Updated: ${s} | Restored: ${n} | Skipped: ${i} | Failed: ${d}`:`Created: ${t} | Restored: ${n} | Duplicates: ${i} | Failed: ${d}`;u.update({message:`Processing ${o} of ${a} students...\\n${p}`,progress:{value:o/a}})}u.hide(),yl.value={created:t,updated:s,restored:n,duplicates:i,failed:d,errors:r},hl.value=!0,sl.value=!1,await Kl()}catch(c){u.hide(),He.notify({type:"negative",message:"Import failed: "+(c.message||"Unknown error")}),sl.value=!1}},wa=()=>{wl.value.school_id?dl.value=!0:He.notify({type:"negative",message:"Please select a School first"})},xa=async()=>{pl.value=!0;try{const e=await D.post("/admin/students/validate-import-batch",{school_id:wl.value.school_id,students:ul.value,import_mode:ml.value});gl.value=e.data.validations,_l.value=e.data.summary,ul.value=ul.value.map((e,l)=>{const a=gl.value[l];return{...e,validationStatus:a.status,validationMessage:a.message,validationIcon:a.icon,validationColor:a.color}}),He.notify({type:"positive",message:`Validation complete! ${_l.value.total} records checked.`,timeout:2e3})}catch(e){He.notify({type:"negative",message:"Validation failed: "+(e.message||"Unknown error")})}finally{pl.value=!1}},ka=()=>{el.value=!1,ol.value=null,tl.value=[]},Ca=()=>{dl.value=!1,rl.value=null,ul.value=[],gl.value=[],_l.value=null,fl.value="all",hl.value=!1,yl.value=null};return N(async()=>{var e;(null==(e=Ye.records)?void 0:e.data)&&(Le.value=Ye.records.data,Ul.value.rowsNumber=Ye.records.total||0),Ye.schools&&Ye.schools.length>0&&(wl.value.school_id=Ye.schools[0].id,await Gl())}),(l,V)=>(A(),q("div",W,[U("div",B,[U("div",Y,[U("div",H,[I(a,{name:"school",class:"q-mr-sm"}),V[30]||(V[30]=j(" Student Management "))]),V[31]||(V[31]=U("div",{class:"text-subtitle2 text-grey-7"}," Manage students, classrooms, and promotions ",-1))]),U("div",J,[I(s,{push:""},{default:E(()=>[I(o,{color:"primary",icon:"add",label:"Add Student",onClick:V[0]||(V[0]=e=>aa()),disable:!Ql.value,unelevated:""},{default:E(()=>[Ql.value?P("",!0):(A(),F(t,{key:0},{default:E(()=>V[32]||(V[32]=[j(" Please select School, Grade, and Classroom first ")])),_:1}))]),_:1},8,["disable"]),I(o,{color:"secondary",icon:"upgrade",label:"Promote Students",onClick:V[1]||(V[1]=e=>Ze.value=!0),unelevated:""}),I(o,{color:"info",icon:"upload_file",label:"Import",onClick:va,disable:!Ql.value,unelevated:""},{default:E(()=>[Ql.value?P("",!0):(A(),F(t,{key:0},{default:E(()=>V[33]||(V[33]=[j(" Please select School, Grade, and Classroom first ")])),_:1}))]),_:1},8,["disable"]),I(o,{color:"purple",icon:"cloud_upload",label:"School-Wide Import",onClick:wa,disable:!wl.value.school_id,unelevated:""},{default:E(()=>[wl.value.school_id?P("",!0):(A(),F(t,{key:0},{default:E(()=>V[34]||(V[34]=[j(" Please select a School first ")])),_:1}))]),_:1},8,["disable"]),I(o,{color:"positive",icon:"download",label:"Export",onClick:da,unelevated:""})]),_:1})])]),U("div",L,[U("div",K,[I(n,{flat:"",bordered:""},{default:E(()=>[I(i,{class:"bg-primary text-white"},{default:E(()=>[U("div",X,Q(Pl.value),1),V[35]||(V[35]=U("div",{class:"text-caption"},"Total Students",-1))]),_:1})]),_:1})]),U("div",Z,[I(n,{flat:"",bordered:""},{default:E(()=>[I(i,{class:"bg-secondary text-white"},{default:E(()=>[U("div",ee,Q(jl.value),1),V[36]||(V[36]=U("div",{class:"text-caption"},"In Selected School",-1))]),_:1})]),_:1})]),U("div",le,[I(n,{flat:"",bordered:""},{default:E(()=>[I(i,{class:"bg-positive text-white"},{default:E(()=>[U("div",ae,Q(El.value),1),V[37]||(V[37]=U("div",{class:"text-caption"},"Filtered Results",-1))]),_:1})]),_:1})]),U("div",oe,[I(n,{flat:"",bordered:""},{default:E(()=>[I(i,{class:"bg-info text-white"},{default:E(()=>[U("div",te,Q(Fl.value),1),V[38]||(V[38]=U("div",{class:"text-caption"},"Selected",-1))]),_:1})]),_:1})])]),I(n,{flat:"",bordered:"",class:"q-mb-md"},{default:E(()=>[I(i,null,{default:E(()=>[U("div",se,[U("div",ie,[U("div",ne,[I(a,{name:"filter_list",class:"q-mr-sm"}),V[39]||(V[39]=j(" Filters "))])]),U("div",de,[I(o,{flat:"",dense:"",icon:"clear",label:"Clear All",onClick:Xl,color:"negative"})])]),U("div",re,[U("div",ue,[I(y,{modelValue:wl.value.school_id,"onUpdate:modelValue":[V[2]||(V[2]=e=>wl.value.school_id=e),Gl],options:e.schools,"option-value":"id","option-label":"name",label:"School",outlined:"",dense:"",clearable:"","emit-value":"","map-options":""},{prepend:E(()=>[I(a,{name:"business"})]),_:1},8,["modelValue","options"])]),U("div",ce,[I(y,{modelValue:wl.value.stage_id,"onUpdate:modelValue":[V[3]||(V[3]=e=>wl.value.stage_id=e),Wl],options:xl.value,"option-value":"id","option-label":"name",label:"Stage",outlined:"",dense:"",clearable:"","emit-value":"","map-options":"",disable:!wl.value.school_id},{prepend:E(()=>[I(a,{name:"layers"})]),_:1},8,["modelValue","options","disable"])]),U("div",me,[I(y,{modelValue:wl.value.grade_id,"onUpdate:modelValue":[V[4]||(V[4]=e=>wl.value.grade_id=e),Bl],options:kl.value,"option-value":"id","option-label":"name",label:"Grade",outlined:"",dense:"",clearable:"","emit-value":"","map-options":"",disable:!wl.value.school_id},{prepend:E(()=>[I(a,{name:"school"})]),_:1},8,["modelValue","options","disable"])]),U("div",ve,[I(y,{modelValue:wl.value.classroom_id,"onUpdate:modelValue":[V[5]||(V[5]=e=>wl.value.classroom_id=e),Kl],options:Cl.value,"option-value":"id","option-label":"name",label:"Classroom",outlined:"",dense:"",clearable:"","emit-value":"","map-options":"",disable:!wl.value.school_id,onPopupShow:Yl},{prepend:E(()=>[I(a,{name:"meeting_room"})]),"no-option":E(()=>[I(d,null,{default:E(()=>[I(r,{class:"text-grey"},{default:E(()=>[j(Q(0===Cl.value.length?"Click to load classrooms...":"No classrooms available"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","options","disable"])]),U("div",pe,[I(u,{modelValue:wl.value.search,"onUpdate:modelValue":[V[6]||(V[6]=e=>wl.value.search=e),ea],label:"Search by name or ID",outlined:"",dense:"",clearable:""},{prepend:E(()=>[I(a,{name:"search"})]),_:1},8,["modelValue"])])])]),_:1})]),_:1}),I(n,{flat:"",bordered:""},{default:E(()=>[I(x,{rows:Le.value,columns:Il,"row-key":"id",loading:Je.value,pagination:Ul.value,onRequest:la,selection:"multiple",selected:Ke.value,"onUpdate:selected":V[7]||(V[7]=e=>Ke.value=e),flat:"","rows-per-page-options":[10,25,50,100]},{top:E(()=>[U("div",ge,[V[40]||(V[40]=U("div",{class:"text-h6"},"Students List",-1)),Ke.value.length>0?(A(),q("div",_e,Q(Ke.value.length)+" student(s) selected ",1)):P("",!0)])]),"body-cell-index":E(e=>[I(b,{props:e},{default:E(()=>[j(Q(e.rowIndex+1),1)]),_:2},1032,["props"])]),"body-cell-avatar":E(e=>[I(b,{props:e},{default:E(()=>[I(c,{color:"primary","text-color":"white",size:"md"},{default:E(()=>[j(Q(Ol(e.row.name)),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-name":E(e=>[I(b,{props:e},{default:E(()=>[U("div",fe,Q(e.row.name),1),U("div",he,Q(e.row.name_ar),1)]),_:2},1032,["props"])]),"body-cell-s_id":E(e=>[I(b,{props:e},{default:E(()=>[I(w,{color:"grey-7",outline:""},{default:E(()=>[j(Q(e.row.s_id),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-school":E(e=>[I(b,{props:e},{default:E(()=>{var l;return[U("div",null,Q(null==(l=e.row.school)?void 0:l.name),1)]}),_:2},1032,["props"])]),"body-cell-classroom":E(e=>[I(b,{props:e},{default:E(()=>[I(w,{color:"secondary"},{default:E(()=>{var l;return[j(Q(null==(l=e.row.classroom)?void 0:l.name),1)]}),_:2},1024)]),_:2},1032,["props"])]),"body-cell-grade":E(e=>[I(b,{props:e},{default:E(()=>{var l;return[U("div",null,Q(null==(l=e.row.grade)?void 0:l.name),1)]}),_:2},1032,["props"])]),"body-cell-actions":E(e=>[I(b,{props:e},{default:E(()=>[I(s,{flat:""},{default:E(()=>[I(o,{flat:"",dense:"",round:"",icon:"edit",color:"primary",onClick:l=>aa(e.row)},{default:E(()=>[I(t,null,{default:E(()=>V[41]||(V[41]=[j("Edit")])),_:1})]),_:2},1032,["onClick"]),I(o,{flat:"",dense:"",round:"",icon:"history",color:"info",onClick:l=>(async e=>{try{const l=await D.get(`/admin/students/${e.id}/classroom-history`);He.dialog({title:`Classroom History - ${e.name}`,message:JSON.stringify(l.data.history,null,2)})}catch(l){He.notify({type:"negative",message:"Failed to load history"})}})(e.row)},{default:E(()=>[I(t,null,{default:E(()=>V[42]||(V[42]=[j("View History")])),_:1})]),_:2},1032,["onClick"]),I(o,{flat:"",dense:"",round:"",icon:"delete",color:"negative",onClick:l=>(async e=>{He.dialog({title:"Confirm Delete",message:`Are you sure you want to delete ${e.name}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{await D.delete(`/admin/students/${e.id}`),He.notify({type:"positive",message:"Student deleted successfully"}),Kl()}catch(l){He.notify({type:"negative",message:"Failed to delete student"})}})})(e.row)},{default:E(()=>[I(t,null,{default:E(()=>V[43]||(V[43]=[j("Delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),"no-data":E(()=>[U("div",ye,[I(a,{size:"2em",name:"sentiment_dissatisfied"}),V[44]||(V[44]=U("span",null,"No students found. Try adjusting your filters.",-1))])]),_:1},8,["rows","loading","pagination","selected"])]),_:1}),Ke.value.length>0?(A(),q("div",be,[I(C,{class:"bg-primary text-white shadow-up-2",style:{"border-radius":"4px"}},{default:E(()=>[I(k,null,{default:E(()=>[j(Q(Ke.value.length)+" student(s) selected ",1)]),_:1}),I(o,{flat:"",label:"Change Classroom",icon:"meeting_room",onClick:ra}),I(o,{flat:"",label:"Export Selected",icon:"download",onClick:ua}),I(o,{flat:"",label:"Delete Selected",icon:"delete",onClick:ca}),I(o,{flat:"",round:"",dense:"",icon:"close",onClick:V[8]||(V[8]=e=>Ke.value=[])})]),_:1})])):P("",!0),I(_,{modelValue:Xe.value,"onUpdate:modelValue":V[17]||(V[17]=e=>Xe.value=e),persistent:""},{default:E(()=>[I(n,{style:{"min-width":"600px"}},{default:E(()=>[I(i,{class:"bg-primary text-white"},{default:E(()=>[U("div",we,Q(ll.value?"Edit Student":"Add New Student"),1),ll.value?P("",!0):(A(),q("div",xe," Adding to: "+Q(Rl()),1))]),_:1}),I(i,null,{default:E(()=>[ll.value?P("",!0):(A(),F(m,{key:0,class:"bg-info text-white q-mb-md",rounded:""},{avatar:E(()=>[I(a,{name:"info"})]),default:E(()=>[V[45]||(V[45]=U("div",{class:"text-weight-bold"},"Selected Context:",-1)),U("div",null,Q(Tl())+" â†’ "+Q(zl())+" â†’ "+Q(Dl()),1)]),_:1})),U("div",ke,[U("div",Ce,[I(u,{modelValue:Al.value.name,"onUpdate:modelValue":V[9]||(V[9]=e=>Al.value.name=e),label:"Name *",outlined:"",rules:[e=>!!e||"Name is required"]},null,8,["modelValue","rules"])]),U("div",Se,[I(u,{modelValue:Al.value.name_ar,"onUpdate:modelValue":V[10]||(V[10]=e=>Al.value.name_ar=e),label:"Arabic Name",outlined:""},null,8,["modelValue"])]),U("div",Ve,[I(u,{modelValue:Al.value.name_cute,"onUpdate:modelValue":V[11]||(V[11]=e=>Al.value.name_cute=e),label:"Nickname",outlined:""},null,8,["modelValue"])]),ll.value?(A(),q(T,{key:0},[U("div",$e,[I(m,{class:"bg-grey-2 q-mb-md",rounded:""},{avatar:E(()=>[I(a,{name:"info",color:"primary"})]),default:E(()=>[V[46]||(V[46]=U("div",{class:"text-weight-bold"},"Current Assignment:",-1)),U("div",null,[I(v,{dense:"",color:"secondary","text-color":"white",icon:"business"},{default:E(()=>{var e;return[j(Q((null==(e=ll.value.school)?void 0:e.name)||"N/A"),1)]}),_:1}),I(v,{dense:"",color:"info","text-color":"white",icon:"layers"},{default:E(()=>{var e;return[j(Q((null==(e=ll.value.stage)?void 0:e.name)||"N/A"),1)]}),_:1}),I(v,{dense:"",color:"primary","text-color":"white",icon:"school"},{default:E(()=>{var e;return[j(Q((null==(e=ll.value.grade)?void 0:e.name)||"N/A"),1)]}),_:1}),I(v,{dense:"",color:"accent","text-color":"white",icon:"meeting_room"},{default:E(()=>{var e;return[j(Q((null==(e=ll.value.classroom)?void 0:e.name)||"N/A"),1)]}),_:1})])]),_:1})]),U("div",Ne,[I(y,{modelValue:Al.value.school_id,"onUpdate:modelValue":[V[12]||(V[12]=e=>Al.value.school_id=e),ta],options:e.schools,"option-value":"id","option-label":"name",label:"School *",outlined:"","emit-value":"","map-options":"",rules:[e=>!!e||"School is required"]},null,8,["modelValue","options","rules"])]),U("div",qe,[I(y,{modelValue:Al.value.stage_id,"onUpdate:modelValue":[V[13]||(V[13]=e=>Al.value.stage_id=e),sa],options:$l.value,"option-value":"id","option-label":"name",label:"Stage *",outlined:"","emit-value":"","map-options":"",disable:!Al.value.school_id,rules:[e=>!!e||"Stage is required"]},null,8,["modelValue","options","disable","rules"])]),U("div",Ae,[I(y,{modelValue:Al.value.grade_id,"onUpdate:modelValue":[V[14]||(V[14]=e=>Al.value.grade_id=e),ia],options:Nl.value,"option-value":"id","option-label":"name",label:"Grade *",outlined:"","emit-value":"","map-options":"",disable:!Al.value.stage_id,rules:[e=>!!e||"Grade is required"]},null,8,["modelValue","options","disable","rules"])]),U("div",Ue,[I(y,{modelValue:Al.value.classroom_id,"onUpdate:modelValue":[V[15]||(V[15]=e=>Al.value.classroom_id=e),oa],options:ql.value,"option-value":"id","option-label":"name",label:"Classroom *",outlined:"","emit-value":"","map-options":"",disable:!Al.value.grade_id,rules:[e=>!!e||"Classroom is required"]},{prepend:E(()=>[I(a,{name:"meeting_room"})]),_:1},8,["modelValue","options","disable","rules"]),il.value?(A(),F(m,{key:0,class:"bg-warning text-white q-mt-sm",dense:"",rounded:""},{avatar:E(()=>[I(a,{name:"warning"})]),default:E(()=>[V[47]||(V[47]=U("strong",null,"Warning:",-1)),V[48]||(V[48]=j(" Changing the classroom will update the student's assignment and may affect their schedule and records. "))]),_:1})):P("",!0)])],64)):P("",!0),U("div",Ie,[I(u,{modelValue:Al.value.notes,"onUpdate:modelValue":V[16]||(V[16]=e=>Al.value.notes=e),label:"Notes",outlined:"",type:"textarea",rows:"3"},null,8,["modelValue"])])])]),_:1}),I(p,{align:"right"},{default:E(()=>[z(I(o,{flat:"",label:"Cancel",color:"negative"},null,512),[[g]]),I(o,{unelevated:"",label:"Save",color:"primary",onClick:na,loading:al.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),I(G,{modelValue:Ze.value,"onUpdate:modelValue":V[18]||(V[18]=e=>Ze.value=e),grades:Sl.value,"academic-years":Vl.value,onPromoted:ma},null,8,["modelValue","grades","academic-years"]),I(_,{modelValue:el.value,"onUpdate:modelValue":V[20]||(V[20]=e=>el.value=e),persistent:""},{default:E(()=>[I(n,{style:{"min-width":"700px","max-width":"90vw"}},{default:E(()=>[I(i,{class:"bg-info text-white"},{default:E(()=>[V[49]||(V[49]=U("div",{class:"text-h6"},"Import Students",-1)),U("div",Pe," Importing to: "+Q(Rl()),1)]),_:1}),tl.value.length?(A(),F(i,{key:1,class:"q-pt-none",style:{"max-height":"400px","overflow-y":"auto"}},{default:E(()=>[U("div",je,"Preview ("+Q(tl.value.length)+" students)",1),I(x,{rows:tl.value,columns:cl,"row-key":"index",flat:"",dense:"",pagination:{rowsPerPage:10}},null,8,["rows"])]),_:1})):(A(),F(i,{key:0},{default:E(()=>[I(S,{modelValue:ol.value,"onUpdate:modelValue":[V[19]||(V[19]=e=>ol.value=e),pa],label:"Select Excel file",accept:".xlsx,.xls",outlined:""},{prepend:E(()=>[I(a,{name:"attach_file"})]),_:1},8,["modelValue"]),I(m,{class:"bg-grey-2 q-mt-md",rounded:""},{avatar:E(()=>[I(a,{name:"info",color:"info"})]),action:E(()=>[I(o,{flat:"",dense:"",label:"Download Template",icon:"download",color:"primary",onClick:fa})]),default:E(()=>[V[50]||(V[50]=U("div",{class:"text-caption"},[U("strong",null,"Required columns:"),j(" name"),U("br"),U("strong",null,"Optional columns:"),j(" name_ar, name_cute, notes ")],-1))]),_:1})]),_:1})),I(p,{align:"right"},{default:E(()=>[I(o,{flat:"",label:"Cancel",color:"negative",onClick:ka}),tl.value.length?(A(),F(o,{key:0,unelevated:"",label:"Import All",color:"primary",onClick:_a,loading:sl.value},null,8,["loading"])):P("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),I(_,{modelValue:dl.value,"onUpdate:modelValue":V[29]||(V[29]=e=>dl.value=e),persistent:""},{default:E(()=>[I(n,{style:{"min-width":"700px","max-width":"90vw"}},{default:E(()=>[I(i,{class:"bg-purple text-white"},{default:E(()=>[V[51]||(V[51]=U("div",{class:"text-h6"},"School-Wide Import",-1)),U("div",Ee," Importing to: "+Q(Tl()),1)]),_:1}),ul.value.length?(A(),F(i,{key:1,class:"q-pt-none"},{default:E(()=>[U("div",De,"Preview ("+Q(Ml.value.length)+" of "+Q(ul.value.length)+" students)",1),gl.value.length?(A(),q("div",Re,[I(s,{outline:""},{default:E(()=>[I(o,{outline:"all"!==fl.value,unelevated:"all"===fl.value,label:"All",color:"grey-7",size:"sm",onClick:V[23]||(V[23]=e=>fl.value="all")},null,8,["outline","unelevated"]),_l.value.errors>0?(A(),F(o,{key:0,outline:"error"!==fl.value,unelevated:"error"===fl.value,label:`âŒ Errors (${_l.value.errors})`,color:"negative",size:"sm",onClick:V[24]||(V[24]=e=>fl.value="error")},null,8,["outline","unelevated","label"])):P("",!0),_l.value.will_create>0?(A(),F(o,{key:1,outline:"will_create"!==fl.value,unelevated:"will_create"===fl.value,label:`âœ… Create (${_l.value.will_create})`,color:"positive",size:"sm",onClick:V[25]||(V[25]=e=>fl.value="will_create")},null,8,["outline","unelevated","label"])):P("",!0),_l.value.will_update>0?(A(),F(o,{key:2,outline:"will_update"!==fl.value,unelevated:"will_update"===fl.value,label:`ðŸ“ Update (${_l.value.will_update})`,color:"primary",size:"sm",onClick:V[26]||(V[26]=e=>fl.value="will_update")},null,8,["outline","unelevated","label"])):P("",!0),_l.value.will_restore>0?(A(),F(o,{key:3,outline:"will_restore"!==fl.value,unelevated:"will_restore"===fl.value,label:`ðŸ”„ Restore (${_l.value.will_restore})`,color:"info",size:"sm",onClick:V[27]||(V[27]=e=>fl.value="will_restore")},null,8,["outline","unelevated","label"])):P("",!0),_l.value.will_skip>0?(A(),F(o,{key:4,outline:"will_skip"!==fl.value,unelevated:"will_skip"===fl.value,label:`â­ï¸ Skip (${_l.value.will_skip})`,color:"warning",size:"sm",onClick:V[28]||(V[28]=e=>fl.value="will_skip")},null,8,["outline","unelevated","label"])):P("",!0)]),_:1})])):P("",!0),I(x,{rows:Ml.value,columns:bl,"row-key":"index",flat:"",bordered:"",dense:"",pagination:{rowsPerPage:20},style:{"max-height":"400px"},"virtual-scroll":""},{"body-cell-status":E(e=>[I(b,{props:e},{default:E(()=>[e.row.validationStatus?(A(),F(w,{key:0,color:e.row.validationColor||"grey",label:e.row.validationIcon+" "+e.row.validationMessage},null,8,["color","label"])):(A(),F(w,{key:1,color:"grey",label:"â³ Pending validation"}))]),_:2},1032,["props"])]),_:1},8,["rows"]),_l.value?(A(),q("div",Me,[I(h,{class:"q-mb-md"}),V[58]||(V[58]=U("div",{class:"text-subtitle2 q-mb-sm"},"ðŸ“Š Validation Summary",-1)),U("div",Oe,[I(v,{color:"grey-3","text-color":"grey-9",dense:""},{default:E(()=>[V[56]||(V[56]=U("strong",null,"Total:",-1)),j(" "+Q(_l.value.total),1)]),_:1}),_l.value.will_create>0?(A(),F(v,{key:0,color:"positive","text-color":"white",dense:""},{default:E(()=>[j(" âœ… Will Create: "+Q(_l.value.will_create),1)]),_:1})):P("",!0),_l.value.will_update>0?(A(),F(v,{key:1,color:"primary","text-color":"white",dense:""},{default:E(()=>[j(" ðŸ“ Will Update: "+Q(_l.value.will_update),1)]),_:1})):P("",!0),_l.value.will_restore>0?(A(),F(v,{key:2,color:"info","text-color":"white",dense:""},{default:E(()=>[j(" ðŸ”„ Will Restore: "+Q(_l.value.will_restore),1)]),_:1})):P("",!0),_l.value.will_skip>0?(A(),F(v,{key:3,color:"warning","text-color":"white",dense:""},{default:E(()=>[j(" â­ï¸ Will Skip: "+Q(_l.value.will_skip),1)]),_:1})):P("",!0),_l.value.errors>0?(A(),F(v,{key:4,color:"negative","text-color":"white",dense:""},{default:E(()=>[j(" âŒ Errors: "+Q(_l.value.errors),1)]),_:1})):P("",!0)]),_l.value.errors>0?(A(),F(m,{key:0,class:"bg-red-1 text-negative q-mt-sm",dense:"",rounded:""},{avatar:E(()=>[I(a,{name:"warning",color:"negative"})]),default:E(()=>[V[57]||(V[57]=U("strong",null,"Cannot import:",-1)),j(" Please fix "+Q(_l.value.errors)+' error(s) before importing. Click the "âŒ Errors" filter above to see only problematic records. ',1)]),_:1})):P("",!0)])):P("",!0)]),_:1})):(A(),F(i,{key:0},{default:E(()=>[U("div",Fe,[V[54]||(V[54]=U("div",{class:"text-subtitle2 q-mb-sm"},"Import Mode",-1)),I(f,{modelValue:ml.value,"onUpdate:modelValue":V[21]||(V[21]=e=>ml.value=e),options:vl,color:"purple",inline:""},null,8,["modelValue"]),I(m,{class:"bg-blue-1 q-mt-sm",dense:"",rounded:""},{avatar:E(()=>[I(a,{name:"skip"===ml.value?"info":"update",color:"primary"},null,8,["name"])]),default:E(()=>[U("div",Qe,["skip"===ml.value?(A(),q("span",Te,V[52]||(V[52]=[U("strong",null,"Skip Mode:",-1),j(" Existing students will be left unchanged. Only new students will be created. ")]))):(A(),q("span",ze,V[53]||(V[53]=[U("strong",null,"Update Mode:",-1),j(" Existing students will be updated with new data from Excel (non-empty fields only). ")])))])]),_:1})]),I(S,{modelValue:rl.value,"onUpdate:modelValue":[V[22]||(V[22]=e=>rl.value=e),ya],label:"Select Excel file with classroom column",accept:".xlsx,.xls",outlined:""},{prepend:E(()=>[I(a,{name:"attach_file"})]),_:1},8,["modelValue"]),I(m,{class:"bg-grey-2 q-mt-md",rounded:""},{avatar:E(()=>[I(a,{name:"info",color:"info"})]),action:E(()=>[I(o,{flat:"",dense:"",label:"Download Template",icon:"download",color:"primary",onClick:ha})]),default:E(()=>[V[55]||(V[55]=U("div",{class:"text-caption"},[U("strong",null,"Required columns:"),j(" name, classroom"),U("br"),U("strong",null,"Optional columns:"),j(" name_ar, name_cute, notes"),U("br"),U("strong",null,"Classroom formats:"),j(' "4A", "Grade 4 - A", "4-A" ')],-1))]),_:1})]),_:1})),hl.value?(A(),F(i,{key:2,class:"bg-green-1 q-pa-md"},{default:E(()=>[U("div",Ge,[I(a,{name:"check_circle",size:"sm",class:"q-mr-sm"}),V[59]||(V[59]=j(" Import Complete! "))]),U("div",We,[I(v,{color:"grey-7","text-color":"white",size:"md"},{default:E(()=>[V[60]||(V[60]=U("strong",null,"Total:",-1)),j(" "+Q(yl.value.created+yl.value.updated+yl.value.restored+yl.value.duplicates+yl.value.failed),1)]),_:1})]),U("div",Be,[yl.value.created>0?(A(),F(v,{key:0,color:"positive","text-color":"white",size:"md"},{default:E(()=>[j(" âœ… Created: "+Q(yl.value.created),1)]),_:1})):P("",!0),yl.value.updated>0?(A(),F(v,{key:1,color:"primary","text-color":"white",size:"md"},{default:E(()=>[j(" ðŸ“ Updated: "+Q(yl.value.updated),1)]),_:1})):P("",!0),yl.value.restored>0?(A(),F(v,{key:2,color:"info","text-color":"white",size:"md"},{default:E(()=>[j(" ðŸ”„ Restored: "+Q(yl.value.restored),1)]),_:1})):P("",!0),yl.value.duplicates>0?(A(),F(v,{key:3,color:"warning","text-color":"white",size:"md"},{default:E(()=>[j(" â­ï¸ Skipped: "+Q(yl.value.duplicates),1)]),_:1})):P("",!0),yl.value.failed>0?(A(),F(v,{key:4,color:"negative","text-color":"white",size:"md"},{default:E(()=>[j(" âŒ Failed: "+Q(yl.value.failed),1)]),_:1})):P("",!0)]),yl.value.failed>0?(A(),F(m,{key:0,class:"bg-red-1 text-negative q-mt-md",dense:"",rounded:""},{avatar:E(()=>[I(a,{name:"error",color:"negative"})]),default:E(()=>[U("strong",null,Q(yl.value.failed)+" record(s) failed.",1),V[61]||(V[61]=j(" Check browser console for details. "))]),_:1})):P("",!0)]),_:1})):P("",!0),I(p,{align:"right"},{default:E(()=>[I(o,{flat:"",label:"Cancel",color:"negative",onClick:Ca}),ul.value.length&&!gl.value.length?(A(),F(o,{key:0,unelevated:"",label:"Validate All",color:"info",icon:"fact_check",onClick:xa,loading:pl.value},null,8,["loading"])):P("",!0),gl.value.length?(A(),F(o,{key:1,unelevated:"",label:"Import All",color:"purple",icon:"upload",onClick:ba,loading:sl.value,disable:_l.value&&_l.value.errors>0},null,8,["loading","disable"])):P("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-0e1ce305"]]);export{Ye as default};
