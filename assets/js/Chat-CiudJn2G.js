import{f as e,a,o as s,e as t,N as r,J as i,b as o,O as l,z as n,a4 as d,V as c,K as u,W as g,P as v,F as m,R as y,U as p,a0 as f,y as x,ac as b,n as h,_ as k}from"./vendor-nQjeLEvd.js";import{u as w,b8 as _}from"./app-tFXAu5dG.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";const j={class:"flex justify-between items-center"},N={class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},E={class:"py-12"},C={class:"max-w-4xl mx-auto sm:px-6 lg:px-8"},S={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},U={class:"flex flex-col h-[600px]"},A={class:"p-4 border-b dark:border-gray-700 flex items-center"},F={class:"flex-shrink-0"},I=["src"],R={class:"ml-3"},T={class:"text-lg font-medium text-gray-900 dark:text-gray-100"},J={class:"text-sm text-gray-500 dark:text-gray-400"},L={key:0,class:"flex items-center justify-center h-full"},O={class:"break-words"},P={class:"text-xs mt-1 opacity-70"},V={class:"p-4 border-t dark:border-gray-700"},z=["disabled"],B=["disabled"],D={__name:"Chat",props:{conversation:Object,messages:Array},setup(D){const H=D,K=e(null),W=e(""),$=e(!1),q=e([]),G=w(),M=a(()=>[...H.messages,...q.value]),Q=e=>{if(!e)return"Just now";try{return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(a){return console.error("Error formatting time:",a),"Invalid time"}},X=async()=>{K.value&&(await h(),K.value.scrollTop=K.value.scrollHeight)},Y=async()=>{if(W.value.trim()&&!$.value){$.value=!0;try{const e=await k.post(route("private-chat.send-message",H.conversation.id),{message:W.value.trim()});q.value.push(e.data),W.value="",await X()}catch(e){console.error("Error sending message:",e),G.notify({message:"Failed to send message",caption:"Please try again",color:"negative",icon:"error",position:"top",timeout:3e3})}finally{$.value=!1}}},Z=async()=>{try{const e=(await k.get(route("private-chat.get-messages",H.conversation.id))).data,a=[...H.messages,...q.value].map(e=>e.id);let s=0;e.forEach(e=>{a.includes(e.id)||(q.value.push(e),s++)}),s>0&&X()}catch(e){console.error("Error refreshing messages:",e),e.response&&G.notify({message:"Error refreshing messages",color:"warning",icon:"sync_problem",position:"bottom-right",timeout:3e3})}},ee=e(null);return s(()=>{X(),(()=>{const e=H.conversation.user.id;_.markNotificationAsRead(e,H.conversation.id),_.listenForNotifications(e,a=>{if(!a)return;const s=a[H.conversation.id];s&&!s.is_read&&(_.markNotificationAsRead(e,H.conversation.id),Z())})})(),ee.value=setInterval(()=>{Z()},1e4)}),t(()=>{ee.value&&clearInterval(ee.value),_.removeNotificationListener(H.conversation.user.id)}),(e,a)=>(i(),r(m,null,[o(n(d),{title:`Chat with ${D.conversation.user.name}`},null,8,["title"]),l("div",j,[l("h2",N," Chat with "+c(D.conversation.user.name),1),o(n(v),{href:e.route("private-chat.index"),class:"px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition"},{default:u(()=>a[1]||(a[1]=[g(" Back to Users ")])),_:1},8,["href"])]),l("div",E,[l("div",C,[l("div",S,[l("div",U,[l("div",A,[l("div",F,[l("img",{src:D.conversation.user.profile_photo_url,alt:"User avatar",class:"h-10 w-10 rounded-full"},null,8,I)]),l("div",R,[l("h3",T,c(D.conversation.user.name),1),l("p",J,c(D.conversation.user.email),1)])]),l("div",{class:"flex-1 p-4 overflow-y-auto",ref_key:"messagesContainer",ref:K},[0===M.value.length?(i(),r("div",L,a[2]||(a[2]=[l("p",{class:"text-gray-500 dark:text-gray-400"}," No messages yet. Start the conversation! ",-1)]))):(i(!0),r(m,{key:1},y(M.value,e=>(i(),r("div",{key:e.id,class:p(["mb-4",e.is_mine?"flex justify-end":"flex justify-start"])},[l("div",{class:p(["max-w-[70%] rounded-lg p-3",e.is_mine?"bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-700 dark:text-gray-200"])},[l("div",O,c(e.body),1),l("div",P,c(Q(e.created_at)),1)],2)],2))),128))],512),l("div",V,[l("form",{onSubmit:f(Y,["prevent"]),class:"flex gap-2"},[x(l("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>W.value=e),type:"text",placeholder:"Type a message...",class:"flex-1 px-4 py-2 border dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-600",disabled:$.value},null,8,z),[[b,W.value]]),l("button",{type:"submit",class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 transition",disabled:!W.value.trim()||$.value}," Send ",8,B)],32)])])])])])],64))}};export{D as default};
