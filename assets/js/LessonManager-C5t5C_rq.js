import{r as e,u as l,f as a,d as s,b as o,i as r,j as i,Q as t,k as u,l as n,h as d,s as c,o as m,aS as v,e as p}from"./app-DTyzyps1.js";import{Q as g}from"./QForm-YUIalQzX.js";import{_ as f,f as y,a7 as _,N as b,J as h,b as k,O as w,z as V,a4 as C,K as x,Q as j,V as L,U as q,I as N,W as S,y as A}from"./vendor-BJyC5yAd.js";import{d as O}from"./vuedraggable.umd-B6xfz0Kr.js";import"./offline-BzIlwqNM.js";import"./i18n-BDgsCcB6.js";import"./ui-DFn3cvMd.js";import"./index-DsCb48G-.js";const U={class:"lesson-manager"},E={class:"q-pa-md"},J={class:"row q-col-gutter-md"},Q={class:"col-12"},D={class:"text-h5"},F={class:"text-subtitle2"},I={key:0,class:"q-mt-sm"},M={class:"col-12 col-md-8"},P={class:"row justify-between items-center"},T={key:0,class:"text-subtitle2"},z={key:0},K={key:1,class:"row q-gutter-sm"},R={class:"drag-handle cursor-move"},$={class:"row q-gutter-sm"},W={key:0,class:"q-pa-md text-center text-grey"},X={class:"col-12 col-md-4"},B={class:"text-h6"},G={class:"row q-gutter-sm justify-end"},H=e({__name:"LessonManager",props:{curriculum:Object,lessons:Array},setup(e){var H;f.defaults.headers.common["X-CSRF-TOKEN"]=null==(H=document.querySelector('meta[name="csrf-token"]'))?void 0:H.getAttribute("content"),f.defaults.withCredentials=!0;const Y=e,Z=l(),ee=y([...Y.lessons]),le=y([]),ae=y(!1),se=y(null),oe=y(!1),re=y(!1),ie=y(!1),te=y(null),ue=y(!1),ne=y(!1),de=_({curriculum_id:Y.curriculum.id,title:"",page_number:null,description:"",position:null}),ce=()=>{de.reset(),de.curriculum_id=Y.curriculum.id,ae.value=!1,se.value=null},me=()=>{ce()},ve=async()=>{oe.value=!0;try{if(ae.value){const e=await f.put(`/api/lessons/${se.value}`,{title:de.title,page_number:de.page_number,description:de.description}),l=ee.value.findIndex(e=>e.id===se.value);-1!==l&&(ee.value[l]=e.data),Z.notify({color:"positive",message:"Lesson updated successfully",icon:"check_circle"})}else{de.position=ee.value.length;const e=await f.post("/api/lessons",de);ee.value.push(e.data),Z.notify({color:"positive",message:"Lesson added successfully",icon:"check_circle"})}ce()}catch(e){console.error("Error submitting form:",e),Z.notify({color:"negative",message:"An error occurred. Please try again.",icon:"error"})}finally{oe.value=!1}},pe=async()=>{if(te.value){re.value=!0;try{await f.delete(`/api/lessons/${te.value.id}`),ee.value=ee.value.filter(e=>e.id!==te.value.id),Z.notify({color:"positive",message:"Lesson deleted successfully",icon:"check_circle"})}catch(e){console.error("Error deleting lesson:",e),Z.notify({color:"negative",message:"An error occurred while deleting the lesson",icon:"error"})}finally{re.value=!1,te.value=null}}},ge=()=>{le.value=JSON.parse(JSON.stringify(ee.value)),ue.value=!0},fe=()=>{ee.value=JSON.parse(JSON.stringify(le.value)),ue.value=!1},ye=async()=>{ne.value=!0;try{const e=ee.value.map(e=>e.id),l=await f.post("/api/lessons/reorder",{curriculum_id:Y.curriculum.id,lesson_ids:e});ee.value=l.data,ue.value=!1,Z.notify({color:"positive",message:"Lesson order saved successfully",icon:"check_circle"})}catch(e){console.error("Error saving lesson order:",e),Z.notify({color:"negative",message:"Failed to save lesson order",icon:"error"})}finally{ne.value=!1}};return(l,f)=>(h(),b("div",U,[k(V(C),{title:"Manage Lessons - "+e.curriculum.name},null,8,["title"]),w("div",E,[w("div",J,[w("div",Q,[k(s,{class:"curriculum-info"},{default:x(()=>[k(a,null,{default:x(()=>[w("div",D,L(e.curriculum.name),1),w("div",F,L(e.curriculum.subject.name)+" | "+L(e.curriculum.grade.name)+" | "+L(e.curriculum.school.name),1),e.curriculum.description?(h(),b("div",I,L(e.curriculum.description),1)):j("",!0)]),_:1})]),_:1})]),w("div",M,[k(s,null,{default:x(()=>[k(a,null,{default:x(()=>[w("div",P,[w("div",null,[f[5]||(f[5]=w("div",{class:"text-h6"},"Lessons",-1)),ue.value?(h(),b("div",T,"Drag and drop to reorder")):j("",!0)]),!ue.value&&ee.value.length>1?(h(),b("div",z,[k(o,{color:"primary",icon:"reorder",label:"Reorder Lessons",onClick:ge})])):j("",!0),ue.value?(h(),b("div",K,[k(o,{color:"negative",outline:"",icon:"cancel",label:"Cancel",onClick:fe}),k(o,{color:"positive",icon:"save",label:"Save Order",onClick:ye,loading:ne.value},null,8,["loading"])])):j("",!0)])]),_:1}),k(a,null,{default:x(()=>[k(r,{bordered:"",separator:"",class:"rounded-borders"},{default:x(()=>[k(V(O),{modelValue:ee.value,"onUpdate:modelValue":f[0]||(f[0]=e=>ee.value=e),group:"lessons","item-key":"id",handle:".drag-handle",disabled:!ue.value,animation:200},{item:x(({element:e,index:l})=>[k(i,{class:q(["lesson-item q-py-md",{"reorder-mode":ue.value}])},{default:x(()=>[ue.value?(h(),N(u,{key:0,avatar:""},{default:x(()=>[w("div",R,[k(t,{name:"drag_indicator",size:"md"})])]),_:1})):j("",!0),k(u,null,{default:x(()=>[k(n,{class:"text-weight-bold"},{default:x(()=>[S(L(e.lesson_number)+". "+L(e.title),1)]),_:2},1024),e.page_number?(h(),N(n,{key:0,caption:""},{default:x(()=>[S(" Page: "+L(e.page_number),1)]),_:2},1024)):j("",!0),e.description?(h(),N(n,{key:1,caption:""},{default:x(()=>[S(L(e.description),1)]),_:2},1024)):j("",!0)]),_:2},1024),ue.value?j("",!0):(h(),N(u,{key:1,side:""},{default:x(()=>[w("div",$,[k(o,{flat:"",round:"",color:"primary",icon:"edit",onClick:l=>{return a=e,de.title=a.title,de.page_number=a.page_number,de.description=a.description||"",ae.value=!0,void(se.value=a.id);var a}},null,8,["onClick"]),k(o,{flat:"",round:"",color:"negative",icon:"delete",onClick:l=>{return a=e,te.value=a,void(ie.value=!0);var a}},null,8,["onClick"])])]),_:2},1024))]),_:2},1032,["class"])]),_:1},8,["modelValue","disabled"]),0===ee.value.length?(h(),b("div",W," No lessons yet. Add your first lesson using the form. ")):j("",!0)]),_:1})]),_:1})]),_:1})]),w("div",X,[k(s,null,{default:x(()=>[k(a,null,{default:x(()=>[w("div",B,L(ae.value?"Edit Lesson":"Add New Lesson"),1)]),_:1}),k(a,null,{default:x(()=>[k(g,{onSubmit:ve,class:"q-gutter-md"},{default:x(()=>[k(d,{modelValue:V(de).title,"onUpdate:modelValue":f[1]||(f[1]=e=>V(de).title=e),label:"Lesson Title",rules:[e=>!!e||"Title is required"],outlined:""},null,8,["modelValue","rules"]),k(d,{modelValue:V(de).page_number,"onUpdate:modelValue":f[2]||(f[2]=e=>V(de).page_number=e),modelModifiers:{number:!0},label:"Page Number",type:"number",outlined:""},null,8,["modelValue"]),k(d,{modelValue:V(de).description,"onUpdate:modelValue":f[3]||(f[3]=e=>V(de).description=e),label:"Description",type:"textarea",outlined:""},null,8,["modelValue"]),w("div",G,[ae.value?(h(),N(o,{key:0,label:"Cancel",color:"grey",onClick:me,outline:""})):j("",!0),k(o,{label:ae.value?"Update Lesson":"Add Lesson",type:"submit",color:"primary",loading:oe.value},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1})])])]),k(p,{modelValue:ie.value,"onUpdate:modelValue":f[4]||(f[4]=e=>ie.value=e),persistent:""},{default:x(()=>[k(s,null,{default:x(()=>[k(a,{class:"row items-center"},{default:x(()=>[k(c,{icon:"warning",color:"negative","text-color":"white"}),f[6]||(f[6]=w("span",{class:"q-ml-sm"},"Are you sure you want to delete this lesson?",-1))]),_:1}),k(m,{align:"right"},{default:x(()=>[A(k(o,{flat:"",label:"Cancel",color:"primary"},null,512),[[v]]),A(k(o,{flat:"",label:"Delete",color:"negative",onClick:pe,loading:re.value},null,8,["loading"]),[[v]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-ecbc7791"]]);export{H as default};
