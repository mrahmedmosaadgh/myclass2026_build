import{E as e,ac as l,T as a,U as t,aN as o,bo as r,bp as n,b0 as s,ai as i,e as u,V as d,p as c,u as m,C as p,o as v,aD as g,Q as b,d as f,a as h,g as y,q as x,bn as w,B as _,n as k,f as V,m as C,b as $,h as A,j as q,k as M,i as S,aC as T,aj as I,D as U}from"./app-BXm70mdJ.js";import{Q as z}from"./QSlider-BotkHKKU.js";import{Q as B}from"./QTabs-CDJ215OP.js";import{Q as P}from"./QTab-DhKL91H_.js";import{Q as E}from"./QTabPanels-LFwTBPSC.js";import{Q as R}from"./QTabPanel-sB32VrK8.js";import{u as Q}from"./use-render-cache-CmTcazfP.js";import{p as j,f as H,a as L,k as F,h as O,n as G,Z as D,H as W,I as N,J as Y,b as K,M as X,V as J,U as Z,x as ee,L as le,O as ae,F as te,Q as oe,A as re,y as ne,o as se}from"./vendor-DNM7Y6Xn.js";import ie from"./purify.es-C2Ba6vpb.js";import ue from"./MathEditor-BSejsytI.js";import de from"./MathPastePreview-CJnG0Z0g.js";import{Q as ce}from"./QSelect-CnZtzPIC.js";import{k as me}from"./katex-BXKQVcz-.js";import{Q as pe}from"./QBadge-ZzhN1X9C.js";const ve=/^rgb(a)?\((\d{1,3}),(\d{1,3}),(\d{1,3}),?([01]?\.?\d*?)?\)$/;function ge({r:e,g:l,b:a,a:t}){const o=void 0!==t;if(e=Math.round(e),l=Math.round(l),a=Math.round(a),e>255||l>255||a>255||o&&t>100)throw new TypeError("Expected 3 numbers below 256 (and optionally one below 100)");return t=o?(256|Math.round(255*t/100)).toString(16).slice(1):"","#"+(a|l<<8|e<<16|1<<24).toString(16).slice(1)+t}function be({r:e,g:l,b:a,a:t}){return`rgb${void 0!==t?"a":""}(${e},${l},${a}${void 0!==t?","+t/100:""})`}function fe(e){if("string"!=typeof e)throw new TypeError("Expected a string");3===(e=e.replace(/^#/,"")).length?e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]:4===e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]);const l=parseInt(e,16);return e.length>6?{r:l>>24&255,g:l>>16&255,b:l>>8&255,a:Math.round((255&l)/2.55)}:{r:l>>16,g:l>>8&255,b:255&l}}function he({h:e,s:l,v:a,a:t}){let o,r,n;l/=100,a/=100,e/=360;const s=Math.floor(6*e),i=6*e-s,u=a*(1-l),d=a*(1-i*l),c=a*(1-(1-i)*l);switch(s%6){case 0:o=a,r=c,n=u;break;case 1:o=d,r=a,n=u;break;case 2:o=u,r=a,n=c;break;case 3:o=u,r=d,n=a;break;case 4:o=c,r=u,n=a;break;case 5:o=a,r=u,n=d}return{r:Math.round(255*o),g:Math.round(255*r),b:Math.round(255*n),a:t}}function ye({r:e,g:l,b:a,a:t}){const o=Math.max(e,l,a),r=Math.min(e,l,a),n=o-r,s=0===o?0:n/o,i=o/255;let u;switch(o){case r:u=0;break;case e:u=l-a+n*(l<a?6:0),u/=6*n;break;case l:u=a-e+2*n,u/=6*n;break;case a:u=e-l+4*n,u/=6*n}return{h:Math.round(360*u),s:Math.round(100*s),v:Math.round(100*i),a:t}}function xe(e){if("string"!=typeof e)throw new TypeError("Expected a string");const l=e.replace(/ /g,""),a=ve.exec(l);if(null===a)return fe(l);const t={r:Math.min(255,parseInt(a[2],10)),g:Math.min(255,parseInt(a[3],10)),b:Math.min(255,parseInt(a[4],10))};if(a[1]){const e=parseFloat(a[5]);t.a=100*Math.min(1,!0===isNaN(e)?1:e)}return t}const we=["rgb(255,204,204)","rgb(255,230,204)","rgb(255,255,204)","rgb(204,255,204)","rgb(204,255,230)","rgb(204,255,255)","rgb(204,230,255)","rgb(204,204,255)","rgb(230,204,255)","rgb(255,204,255)","rgb(255,153,153)","rgb(255,204,153)","rgb(255,255,153)","rgb(153,255,153)","rgb(153,255,204)","rgb(153,255,255)","rgb(153,204,255)","rgb(153,153,255)","rgb(204,153,255)","rgb(255,153,255)","rgb(255,102,102)","rgb(255,179,102)","rgb(255,255,102)","rgb(102,255,102)","rgb(102,255,179)","rgb(102,255,255)","rgb(102,179,255)","rgb(102,102,255)","rgb(179,102,255)","rgb(255,102,255)","rgb(255,51,51)","rgb(255,153,51)","rgb(255,255,51)","rgb(51,255,51)","rgb(51,255,153)","rgb(51,255,255)","rgb(51,153,255)","rgb(51,51,255)","rgb(153,51,255)","rgb(255,51,255)","rgb(255,0,0)","rgb(255,128,0)","rgb(255,255,0)","rgb(0,255,0)","rgb(0,255,128)","rgb(0,255,255)","rgb(0,128,255)","rgb(0,0,255)","rgb(128,0,255)","rgb(255,0,255)","rgb(245,0,0)","rgb(245,123,0)","rgb(245,245,0)","rgb(0,245,0)","rgb(0,245,123)","rgb(0,245,245)","rgb(0,123,245)","rgb(0,0,245)","rgb(123,0,245)","rgb(245,0,245)","rgb(214,0,0)","rgb(214,108,0)","rgb(214,214,0)","rgb(0,214,0)","rgb(0,214,108)","rgb(0,214,214)","rgb(0,108,214)","rgb(0,0,214)","rgb(108,0,214)","rgb(214,0,214)","rgb(163,0,0)","rgb(163,82,0)","rgb(163,163,0)","rgb(0,163,0)","rgb(0,163,82)","rgb(0,163,163)","rgb(0,82,163)","rgb(0,0,163)","rgb(82,0,163)","rgb(163,0,163)","rgb(92,0,0)","rgb(92,46,0)","rgb(92,92,0)","rgb(0,92,0)","rgb(0,92,46)","rgb(0,92,92)","rgb(0,46,92)","rgb(0,0,92)","rgb(46,0,92)","rgb(92,0,92)","rgb(255,255,255)","rgb(205,205,205)","rgb(178,178,178)","rgb(153,153,153)","rgb(127,127,127)","rgb(102,102,102)","rgb(76,76,76)","rgb(51,51,51)","rgb(25,25,25)","rgb(0,0,0)"],_e="M5 5 h10 v10 h-10 v-10 z",ke=e({name:"QColor",props:{...a,...l,modelValue:String,defaultValue:String,defaultView:{type:String,default:"spectrum",validator:e=>["spectrum","tune","palette"].includes(e)},formatModel:{type:String,default:"auto",validator:e=>["auto","hex","rgb","hexa","rgba"].includes(e)},palette:Array,noHeader:Boolean,noHeaderTabs:Boolean,noFooter:Boolean,square:Boolean,flat:Boolean,bordered:Boolean,disable:Boolean,readonly:Boolean},emits:["update:modelValue","change"],setup(e,{emit:l}){const{proxy:a}=j(),{$q:c}=a,m=t(e,c),{getCache:p}=Q(),v=H(null),g=H(null),b=L(()=>"auto"===e.formatModel?null:-1!==e.formatModel.indexOf("hex")),f=L(()=>"auto"===e.formatModel?null:-1!==e.formatModel.indexOf("a")),h=H("auto"===e.formatModel?void 0===e.modelValue||null===e.modelValue||""===e.modelValue||e.modelValue.startsWith("#")?"hex":"rgb":e.formatModel.startsWith("hex")?"hex":"rgb"),y=H(e.defaultView),x=H(N(e.modelValue||e.defaultValue)),w=L(()=>!0!==e.disable&&!0!==e.readonly),_=L(()=>void 0===e.modelValue||null===e.modelValue||""===e.modelValue||e.modelValue.startsWith("#")),k=L(()=>null!==b.value?b.value:_.value),V=L(()=>({type:"hidden",name:e.name,value:x.value[!0===k.value?"hex":"rgb"]})),C=s(V),$=L(()=>null!==f.value?f.value:void 0!==x.value.a),A=L(()=>({backgroundColor:x.value.rgb||"#000"})),q=L(()=>"q-color-picker__header-content q-color-picker__header-content--"+(void 0!==x.value.a&&x.value.a<65||function(e){if("string"!=typeof e&&(!e||void 0===e.r))throw new TypeError("Expected a string or a {r, g, b} object as color");const l="string"==typeof e?xe(e):e,a=l.r/255,t=l.g/255,o=l.b/255;return.2126*(a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4))+.7152*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.0722*(o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4))}(x.value)>.4?"light":"dark")),M=L(()=>({background:`hsl(${x.value.h},100%,50%)`})),S=L(()=>({top:100-x.value.v+"%",[!0===c.lang.rtl?"right":"left"]:`${x.value.s}%`})),T=L(()=>void 0!==e.palette&&0!==e.palette.length?e.palette:we),I=L(()=>"q-color-picker"+(!0===e.bordered?" q-color-picker--bordered":"")+(!0===e.square?" q-color-picker--square no-border-radius":"")+(!0===e.flat?" q-color-picker--flat no-shadow":"")+(!0===e.disable?" disabled":"")+(!0===m.value?" q-color-picker--dark q-dark":"")),U=L(()=>!0===e.disable?{"aria-disabled":"true"}:{}),D=L(()=>[[o,ee,void 0,{prevent:!0,stop:!0,mouse:!0}]]);function W(e,a){x.value.hex=ge(e),x.value.rgb=be(e),x.value.r=e.r,x.value.g=e.g,x.value.b=e.b,x.value.a=e.a;const t=x.value[!0===k.value?"hex":"rgb"];l("update:modelValue",t),!0===a&&l("change",t)}function N(l){const a=void 0!==f.value?f.value:"auto"===e.formatModel?null:-1!==e.formatModel.indexOf("a");if("string"!=typeof l||0===l.length||!0!==r.anyColor(l.replace(/ /g,"")))return{h:0,s:0,v:0,r:0,g:0,b:0,a:!0===a?100:void 0,hex:void 0,rgb:void 0};const t=xe(l);return!0===a&&void 0===t.a&&(t.a=100),t.hex=ge(t),t.rgb=be(t),Object.assign(t,ye(t))}function Y(e,l,a){const t=v.value;if(null===t)return;const o=t.clientWidth,r=t.clientHeight,n=t.getBoundingClientRect();let s=Math.min(o,Math.max(0,e-n.left));!0===c.lang.rtl&&(s=o-s);const i=Math.min(r,Math.max(0,l-n.top)),u=Math.round(100*s/o),d=Math.round(100*Math.max(0,Math.min(1,-i/r+1))),m=he({h:x.value.h,s:u,v:d,a:!0===$.value?x.value.a:void 0});x.value.s=u,x.value.v=d,W(m,a)}function K(e,l){const a=Math.round(e),t=he({h:a,s:x.value.s,v:x.value.v,a:!0===$.value?x.value.a:void 0});x.value.h=a,W(t,l)}function X(e){K(e,!0)}function J(e,l,t,o,r){if(void 0!==o&&i(o),!/^[0-9]+$/.test(e))return void(!0===r&&a.$forceUpdate());const n=Math.floor(Number(e));if(n<0||n>t)return void(!0===r&&a.$forceUpdate());const s={r:"r"===l?n:x.value.r,g:"g"===l?n:x.value.g,b:"b"===l?n:x.value.b,a:!0===$.value?"a"===l?n:x.value.a:void 0};if("a"!==l){const e=ye(s);x.value.h=e.h,x.value.s=e.s,x.value.v=e.v}if(W(s,r),!0!==r&&void 0!==(null==o?void 0:o.target.selectionEnd)){const e=o.target.selectionEnd;G(()=>{o.target.setSelectionRange(e,e)})}}function Z(e,l){let a;const t=e.target.value;if(i(e),"hex"===h.value){if(t.length!==(!0===$.value?9:7)||!/^#[0-9A-Fa-f]+$/.test(t))return!0;a=fe(t)}else{let e;if(!t.endsWith(")"))return!0;if(!0!==$.value&&t.startsWith("rgb(")){if(e=t.substring(4,t.length-1).split(",").map(e=>parseInt(e,10)),3!==e.length||!/^rgb\([0-9]{1,3},[0-9]{1,3},[0-9]{1,3}\)$/.test(t))return!0}else{if(!0!==$.value||!t.startsWith("rgba("))return!0;{if(e=t.substring(5,t.length-1).split(","),4!==e.length||!/^rgba\([0-9]{1,3},[0-9]{1,3},[0-9]{1,3},(0|0\.[0-9]+[1-9]|0\.[1-9]+|1)\)$/.test(t))return!0;for(let a=0;a<3;a++){const l=parseInt(e[a],10);if(l<0||l>255)return!0;e[a]=l}const l=parseFloat(e[3]);if(l<0||l>1)return!0;e[3]=l}}if(e[0]<0||e[0]>255||e[1]<0||e[1]>255||e[2]<0||e[2]>255||!0===$.value&&(e[3]<0||e[3]>1))return!0;a={r:e[0],g:e[1],b:e[2],a:!0===$.value?100*e[3]:void 0}}const o=ye(a);if(x.value.h=o.h,x.value.s=o.s,x.value.v=o.v,W(a,l),!0!==l){const l=e.target.selectionEnd;G(()=>{e.target.setSelectionRange(l,l)})}}function ee(e){e.isFinal?Y(e.position.left,e.position.top,!0):le(e)}F(()=>e.modelValue,l=>{const a=N(l||e.defaultValue);a.hex!==x.value.hex&&(x.value=a)}),F(()=>e.defaultValue,l=>{if(!e.modelValue&&l){const e=N(l);e.hex!==x.value.hex&&(x.value=e)}});const le=n(e=>{Y(e.position.left,e.position.top)},20);function ae(e){Y(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset,!0)}function te(e){Y(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset)}function oe(e){null!==g.value&&(g.value.$el.style.opacity=e?1:0)}function re(e){h.value=e}function ne(e){y.value=e}function se(){const e={ref:v,class:"q-color-picker__spectrum non-selectable relative-position cursor-pointer"+(!0!==w.value?" readonly":""),style:M.value,...!0===w.value?{onClick:ae,onMousedown:te}:{}},l=[O("div",{style:{paddingBottom:"100%"}}),O("div",{class:"q-color-picker__spectrum-white absolute-full"}),O("div",{class:"q-color-picker__spectrum-black absolute-full"}),O("div",{class:"absolute",style:S.value},[void 0!==x.value.hex?O("div",{class:"q-color-picker__spectrum-circle"}):null])],a=[O(z,{class:"q-color-picker__hue non-selectable",modelValue:x.value.h,min:0,max:360,trackSize:"8px",innerTrackColor:"transparent",selectionColor:"transparent",readonly:!0!==w.value,thumbPath:_e,"onUpdate:modelValue":K,onChange:X})];return!0===$.value&&a.push(O(z,{class:"q-color-picker__alpha non-selectable",modelValue:x.value.a,min:0,max:100,trackSize:"8px",trackColor:"white",innerTrackColor:"transparent",selectionColor:"transparent",trackImg:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAH0lEQVQoU2NkYGAwZkAFZ5G5jPRRgOYEVDeB3EBjBQBOZwTVugIGyAAAAABJRU5ErkJggg==",readonly:!0!==w.value,hideSelection:!0,thumbPath:_e,...p("alphaSlide",{"onUpdate:modelValue":e=>J(e,"a",100),onChange:e=>J(e,"a",100,void 0,!0)})})),[d("div",e,l,"spec",w.value,()=>D.value),O("div",{class:"q-color-picker__sliders"},a)]}function ie(){return[O("div",{class:"row items-center no-wrap"},[O("div","R"),O(z,{modelValue:x.value.r,min:0,max:255,color:"red",dark:m.value,readonly:!0!==w.value,...p("rSlide",{"onUpdate:modelValue":e=>J(e,"r",255),onChange:e=>J(e,"r",255,void 0,!0)})}),O("input",{value:x.value.r,maxlength:3,readonly:!0!==w.value,onChange:i,...p("rIn",{onInput:e=>J(e.target.value,"r",255,e),onBlur:e=>J(e.target.value,"r",255,e,!0)})})]),O("div",{class:"row items-center no-wrap"},[O("div","G"),O(z,{modelValue:x.value.g,min:0,max:255,color:"green",dark:m.value,readonly:!0!==w.value,...p("gSlide",{"onUpdate:modelValue":e=>J(e,"g",255),onChange:e=>J(e,"g",255,void 0,!0)})}),O("input",{value:x.value.g,maxlength:3,readonly:!0!==w.value,onChange:i,...p("gIn",{onInput:e=>J(e.target.value,"g",255,e),onBlur:e=>J(e.target.value,"g",255,e,!0)})})]),O("div",{class:"row items-center no-wrap"},[O("div","B"),O(z,{modelValue:x.value.b,min:0,max:255,color:"blue",readonly:!0!==w.value,dark:m.value,...p("bSlide",{"onUpdate:modelValue":e=>J(e,"b",255),onChange:e=>J(e,"b",255,void 0,!0)})}),O("input",{value:x.value.b,maxlength:3,readonly:!0!==w.value,onChange:i,...p("bIn",{onInput:e=>J(e.target.value,"b",255,e),onBlur:e=>J(e.target.value,"b",255,e,!0)})})]),!0===$.value?O("div",{class:"row items-center no-wrap"},[O("div","A"),O(z,{modelValue:x.value.a,color:"grey",readonly:!0!==w.value,dark:m.value,...p("aSlide",{"onUpdate:modelValue":e=>J(e,"a",100),onChange:e=>J(e,"a",100,void 0,!0)})}),O("input",{value:x.value.a,maxlength:3,readonly:!0!==w.value,onChange:i,...p("aIn",{onInput:e=>J(e.target.value,"a",100,e),onBlur:e=>J(e.target.value,"a",100,e,!0)})})]):null]}function ue(){return[O("div",{class:"row items-center q-color-picker__palette-rows"+(!0===w.value?" q-color-picker__palette-rows--editable":"")},T.value.map(e=>O("div",{class:"q-color-picker__cube col-auto",style:{backgroundColor:e},...!0===w.value?p("palette#"+e,{onClick:()=>{!function(e){const l=N(e),a={r:l.r,g:l.g,b:l.b,a:l.a};void 0===a.a&&(a.a=x.value.a),x.value.h=l.h,x.value.s=l.s,x.value.v=l.v,W(a,!0)}(e)}}):{}})))]}return()=>{const l=[O(E,{modelValue:y.value,animated:!0},()=>[O(R,{class:"q-color-picker__spectrum-tab overflow-hidden",name:"spectrum"},se),O(R,{class:"q-pa-md q-color-picker__tune-tab",name:"tune"},ie),O(R,{class:"q-color-picker__palette-tab",name:"palette"},ue)])];return void 0!==e.name&&!0!==e.disable&&C(l,"push"),!0!==e.noHeader&&l.unshift(function(){const l=[];return!0!==e.noHeaderTabs&&l.push(O(B,{class:"q-color-picker__header-tabs",modelValue:h.value,dense:!0,align:"justify","onUpdate:modelValue":re},()=>[O(P,{label:"HEX"+(!0===$.value?"A":""),name:"hex",ripple:!1}),O(P,{label:"RGB"+(!0===$.value?"A":""),name:"rgb",ripple:!1})])),l.push(O("div",{class:"q-color-picker__header-banner row flex-center no-wrap"},[O("input",{class:"fit",value:x.value[h.value],...!0!==w.value?{readonly:!0}:{},...p("topIn",{onInput:e=>{oe(!0===Z(e))},onChange:i,onBlur:e=>{!0===Z(e,!0)&&a.$forceUpdate(),oe(!1)}})}),O(u,{ref:g,class:"q-color-picker__error-icon absolute no-pointer-events",name:c.iconSet.type.negative})])),O("div",{class:"q-color-picker__header relative-position overflow-hidden"},[O("div",{class:"q-color-picker__header-bg absolute-full"}),O("div",{class:q.value,style:A.value},l)])}()),!0!==e.noFooter&&l.push(O("div",{class:"q-color-picker__footer relative-position overflow-hidden"},[O(B,{class:"absolute-full",modelValue:y.value,dense:!0,align:"justify","onUpdate:modelValue":ne},()=>[O(P,{icon:c.iconSet.colorPicker.spectrum,name:"spectrum",ripple:!1}),O(P,{icon:c.iconSet.colorPicker.tune,name:"tune",ripple:!1}),O(P,{icon:c.iconSet.colorPicker.palette,name:"palette",ripple:!1})])])),O("div",{class:I.value,...U.value},l)}}});const Ve=new class{async complete(e,l={}){var a,t,o,r;try{const a=await D.post("/api/ai/complete",{prompt:e,context:{previousMessages:l.previousMessages||[]},systemMessage:l.systemMessage,temperature:l.temperature||.7,maxTokens:l.maxTokens||2e3,model:l.model||"deepseek"});return{success:!0,content:a.data.content,usage:a.data.usage}}catch(n){return console.error("AI Service Error:",n),{success:!1,error:(null==(t=null==(a=n.response)?void 0:a.data)?void 0:t.error)||"Failed to get AI response",message:(null==(r=null==(o=n.response)?void 0:o.data)?void 0:r.message)||n.message}}}async improveText(e){return this.complete(`Improve the following text for clarity, grammar, and style:\n\n${e}`,{systemMessage:"You are an expert editor. Improve the text while maintaining its original meaning and tone.",temperature:.5})}async generateSimilarProblems(e,l=3){return this.complete(`Generate ${l} similar math problems to this one:\n\n${e}\n\nProvide only the problems, one per line.`,{systemMessage:"You are a math teacher creating practice problems. Generate similar problems with different numbers but the same concept.",temperature:.8})}async explainConcept(e,l="middle"){return this.complete(`Explain "${e}" in simple terms for ${l} school students.`,{systemMessage:"You are an experienced teacher. Explain concepts clearly and engagingly for students.",temperature:.6})}};const Ce={class:"row items-center justify-between q-px-md"},$e={class:"text-h5 flex items-center gap-3"},Ae={class:"row items-center gap-3"},qe={class:"row q-pa-md",style:{"min-height":"560px"}},Me={class:"col-12 col-lg-6 q-pr-lg-lg",style:{"max-height":"70vh","overflow-y":"auto"}},Se={class:"q-gutter-y-md"},Te={key:0,class:"q-mb-md"},Ie={class:"q-mt-xs"},Ue={key:1},ze={class:"q-mt-xs"},Be={key:0,class:"q-mt-lg"},Pe={class:"q-gutter-y-lg"},Ee={key:0},Re={class:"q-gutter-y-md"},Qe={class:"col-12 col-lg-6"},je={class:"column full-height"},He={class:"row items-center justify-between q-mb-sm"},Le={class:"text-h6 flex items-center gap-2"},Fe=["innerHTML"],Oe={class:"row q-gutter-sm"},Ge={key:0,class:"q-mt-md text-center"},De={class:"q-mt-xs"},We=c({__name:"PromptBuilder",emits:["use-prompt","close"],setup(e,{emit:l}){const a=m(),t=l;H(!0);const o=H(!0),r=H("pro-quiz"),n=H(""),s=H({grade:"Grade 7",numQuestions:20,lessons:"5-1 Ratios and Rates\n5-2 Proportions\n5-3 Percent Problems",options:["withSections","withAnswerKey","withLatex"]}),i=H({topic:"",grade:"Grade 6",numQuestions:15,types:["multiple-choice","short-answer"],withAnswerKey:!0}),d=H({topic:"",grade:"",duration:60,style:"Direct"}),c=H(""),V=H(""),C=H([]),$=H({grade:[],lessons:[],topic:[]});try{const e=localStorage.getItem("promptBuilderHistory"),l=localStorage.getItem("promptBuilderFieldHistory");e&&(C.value=JSON.parse(e)),l&&($.value=JSON.parse(l))}catch(O){console.error(O)}const A=[{label:"Section per lesson",value:"withSections"},{label:"Group by type",value:"groupByType"},{label:"KaTeX math",value:"withLatex"},{label:"Answer key + explanations",value:"withAnswerKey"},{label:"Print-ready",value:"printReady"}],q=["multiple-choice","true-false","fill-in-blank","short-answer","matching"];function M(e){n.value=e}function S(e){return[...new Set($.value[e]||[])].slice(0,8)}function T(e=!1){let l="";if("pro-quiz"===r.value){const e=s.value.lessons.split("\n").filter(e=>e.trim()).map(e=>`• ${e.trim()}`).join("\n")||"these topics",a=s.value.options||[];l=`Create a high-quality, ${s.value.numQuestions}-question quiz for ${s.value.grade} students covering:\n\n${e}\n\n`+(a.includes("withSections")?"Organize into sections by lesson.\n":"")+(a.includes("groupByType")?"Group by question type.\n":"")+(a.includes("withLatex")?"Use KaTeX for all math: \\frac{1}{2}, \\sqrt{x}\n":"")+(a.includes("withAnswerKey")?"Include detailed answer key with explanations at the end.\n":"")+(a.includes("printReady")?"Output in clean, print-ready HTML with title and name lines.\n":"")+"Use student misconceptions as distractors. Make it professional and ready to use."}else l="quiz"===r.value?`Generate a ${i.value.numQuestions}-question quiz about "${i.value.topic}" for ${i.value.grade} students. Include: ${i.value.types.join(", ")}. `+(i.value.withAnswerKey?"Add detailed answer key.":""):"custom"===r.value?c.value||"Your custom prompt will appear here...":"Select a template to begin...";V.value=l.trim(),function(e){if(!e||e.length<20)return;const l={text:e,template:r.value,timestamp:Date.now()};C.value=[l,...C.value.filter(l=>l.text!==e)].slice(0,20),localStorage.setItem("promptBuilderHistory",JSON.stringify(C.value)),s.value.grade&&($.value.grade=[s.value.grade,...$.value.grade.filter(e=>e!==s.value.grade)].slice(0,15));if(s.value.lessons){s.value.lessons.split("\n").map(e=>e.trim()).filter(Boolean).forEach(e=>{$.value.lessons.includes(e)||($.value.lessons=[e,...$.value.lessons].slice(0,30))})}i.value.topic&&($.value.topic=[i.value.topic,...$.value.topic.filter(e=>e!==i.value.topic)].slice(0,15));localStorage.setItem("promptBuilderFieldHistory",JSON.stringify($.value))}(l)}F([s,i,d,c,r,o],()=>{T()},{deep:!0,immediate:!0});const I=L(()=>V.value?V.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/`(.*?)`/g,'<code class="bg-grey-3 q-px-xs rounded">$1</code>').replace(/\n/g,"<br>"):'<em class="text-grey-5">Your prompt will appear here...</em>');function U(e,l){return e.length>l?e.substring(0,l-3)+"...":e}function Q(){navigator.clipboard.writeText(V.value),a.notify({message:"Copied to clipboard!",type:"positive",icon:"content_copy"})}function j(){t("use-prompt",V.value)}return(e,l)=>(N(),W(k,{class:"prompt-builder-dialog",style:{width:"960px","max-width":"96vw","border-radius":"20px",overflow:"hidden"}},{default:Y(()=>[K(f,{class:"bg-gradient text-white q-py-md"},{default:Y(()=>[X("div",Ce,[X("div",null,[X("div",$e,[K(u,{name:"auto_awesome",size:"2rem"}),l[21]||(l[21]=J(" Quick Prompt Builder ")),K(p,{dense:"",color:"white","text-color":"primary",icon:"bolt"},{default:Y(()=>[J(Z(o.value?"Easy Mode":"Pro Mode"),1)]),_:1})]),l[22]||(l[22]=X("div",{class:"text-subtitle2 opacity-90 q-mt-xs"}," Build perfect AI prompts • History tags • Instant preview ",-1))]),X("div",Ae,[K(v,{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=e=>o.value=e),color:"yellow",size:"lg",icon:"child_care",label:o.value?"Easy":"Pro","keep-color":""},null,8,["modelValue","label"]),ee(K(b,{icon:"close",flat:"",round:"",dense:""},null,512),[[g]])])])]),_:1}),K(B,{modelValue:r.value,"onUpdate:modelValue":l[1]||(l[1]=e=>r.value=e),dense:"",class:"bg-grey-2","active-color":"primary","indicator-color":"primary",align:"justify"},{default:Y(()=>[K(P,{name:"pro-quiz",icon:"verified",label:"Pro Quiz"},{default:Y(()=>[K(pe,{color:"positive",floating:""},{default:Y(()=>l[23]||(l[23]=[J("Best")])),_:1})]),_:1}),K(P,{name:"quiz",icon:"quiz",label:"Quick Quiz"}),K(P,{name:"lesson",icon:"school",label:"Lesson Plan"}),K(P,{name:"worksheet",icon:"assignment",label:"Worksheet"}),K(P,{name:"flashcards",icon:"style",label:"Flashcards"}),K(P,{name:"custom",icon:"tune",label:"Custom"})]),_:1},8,["modelValue"]),K(h),X("div",qe,[X("div",Me,[K(E,{modelValue:r.value,"onUpdate:modelValue":l[19]||(l[19]=e=>r.value=e),animated:"","keep-alive":""},{default:Y(()=>[K(R,{name:"pro-quiz",class:"q-pa-none"},{default:Y(()=>[X("div",Se,[K(y,{modelValue:s.value.grade,"onUpdate:modelValue":l[2]||(l[2]=e=>s.value.grade=e),filled:"",label:"Grade / Course *",placeholder:"e.g. Grade 8, Algebra I, AP Biology",onFocus:l[3]||(l[3]=e=>M("grade"))},{prepend:Y(()=>[K(u,{name:"school"})]),_:1},8,["modelValue"]),S("grade").length?(N(),le("div",Te,[l[24]||(l[24]=X("span",{class:"text-caption text-grey-6"},"Quick insert:",-1)),X("div",Ie,[(N(!0),le(te,null,oe(S("grade").slice(0,6),e=>(N(),W(p,{key:e,clickable:"",onClick:l=>s.value.grade=e,color:"primary","text-color":"white",size:"sm",class:"q-ma-xs"},{default:Y(()=>[J(Z(e),1)]),_:2},1032,["onClick"]))),128))])])):ae("",!0),K(y,{modelValue:s.value.numQuestions,"onUpdate:modelValue":l[4]||(l[4]=e=>s.value.numQuestions=e),modelModifiers:{number:!0},filled:"",type:"number",label:"Total Questions",min:5,max:o.value?25:60,hint:"Easy Mode: max 25"},{prepend:Y(()=>[K(u,{name:"format_list_numbered"})]),_:1},8,["modelValue","max"]),K(y,{modelValue:s.value.lessons,"onUpdate:modelValue":l[5]||(l[5]=e=>s.value.lessons=e),filled:"",type:"textarea",rows:o.value?4:7,label:"Lessons / Topics * (one per line)",placeholder:"e.g. 5-1 Ratios\\n5-2 Percent Problems",autogrow:"",onFocus:l[6]||(l[6]=e=>M("lessons"))},{prepend:Y(()=>[K(u,{name:"menu_book"})]),append:Y(()=>[K(b,{flat:"",round:"",icon:"lightbulb",color:"amber"},{default:Y(()=>[K(x,null,{default:Y(()=>l[25]||(l[25]=[J("Tip: Add page numbers!")])),_:1})]),_:1})]),_:1},8,["modelValue","rows"]),S("lessons").length?(N(),le("div",Ue,[l[26]||(l[26]=X("span",{class:"text-caption text-grey-6"},"Recent topics:",-1)),X("div",ze,[(N(!0),le(te,null,oe(S("lessons").slice(0,8),e=>(N(),W(p,{key:e,clickable:"",onClick:l=>{return a=e,void(s.value.lessons+=(s.value.lessons?"\n":"")+a);var a},color:"teal","text-color":"white",size:"sm",icon:"history",class:"q-ma-xs"},{default:Y(()=>[J(Z(U(e,22)),1)]),_:2},1032,["onClick"]))),128))])])):ae("",!0),K(re,{name:"q-transition--fade"},{default:Y(()=>[o.value?ae("",!0):(N(),le("div",Be,[l[27]||(l[27]=X("div",{class:"text-h6 text-primary q-mb-md"},"Advanced Options",-1)),K(w,{modelValue:s.value.options,"onUpdate:modelValue":l[7]||(l[7]=e=>s.value.options=e),options:A,type:"toggle",inline:"",color:"primary"},null,8,["modelValue"])]))]),_:1})])]),_:1}),K(R,{name:"quiz"},{default:Y(()=>[X("div",Pe,[K(y,{modelValue:i.value.topic,"onUpdate:modelValue":l[8]||(l[8]=e=>i.value.topic=e),filled:"",label:"Main Topic",onFocus:l[9]||(l[9]=e=>M("topic"))},null,8,["modelValue"]),S("topic").length?(N(),le("div",Ee,[(N(!0),le(te,null,oe(S("topic").slice(0,6),e=>(N(),W(p,{key:e,clickable:"",onClick:l=>i.value.topic=e,color:"orange","text-color":"white",size:"sm",class:"q-ma-xs"},{default:Y(()=>[J(Z(e),1)]),_:2},1032,["onClick"]))),128))])):ae("",!0),K(y,{modelValue:i.value.grade,"onUpdate:modelValue":l[10]||(l[10]=e=>i.value.grade=e),filled:"",label:"Grade Level"},null,8,["modelValue"]),K(z,{modelValue:i.value.numQuestions,"onUpdate:modelValue":l[11]||(l[11]=e=>i.value.numQuestions=e),min:5,max:40,label:"","label-always":""},null,8,["modelValue"]),K(ce,{modelValue:i.value.types,"onUpdate:modelValue":l[12]||(l[12]=e=>i.value.types=e),filled:"",multiple:"","use-chips":"",options:q,label:"Question Types"},null,8,["modelValue"]),K(v,{modelValue:i.value.withAnswerKey,"onUpdate:modelValue":l[13]||(l[13]=e=>i.value.withAnswerKey=e),label:"Include Answer Key + Explanations"},null,8,["modelValue"])])]),_:1}),K(R,{name:"lesson"},{default:Y(()=>[X("div",Re,[K(y,{modelValue:d.value.topic,"onUpdate:modelValue":l[14]||(l[14]=e=>d.value.topic=e),filled:"",label:"Lesson Title"},null,8,["modelValue"]),K(y,{modelValue:d.value.grade,"onUpdate:modelValue":l[15]||(l[15]=e=>d.value.grade=e),filled:"",label:"Grade"},null,8,["modelValue"]),K(y,{modelValue:d.value.duration,"onUpdate:modelValue":l[16]||(l[16]=e=>d.value.duration=e),modelModifiers:{number:!0},filled:"",type:"number",suffix:" min",label:"Duration"},null,8,["modelValue"]),K(ce,{modelValue:d.value.style,"onUpdate:modelValue":l[17]||(l[17]=e=>d.value.style=e),filled:"",options:["Direct","Inquiry","Flipped","Project-Based"],label:"Style"},null,8,["modelValue"])])]),_:1}),K(R,{name:"worksheet"},{default:Y(()=>l[28]||(l[28]=[X("div",{class:"text-center text-grey"},"Worksheet builder coming soon...",-1)])),_:1}),K(R,{name:"flashcards"},{default:Y(()=>l[29]||(l[29]=[X("div",{class:"text-center text-grey"},"Flashcards coming soon...",-1)])),_:1}),K(R,{name:"custom"},{default:Y(()=>[K(y,{modelValue:c.value,"onUpdate:modelValue":l[18]||(l[18]=e=>c.value=e),filled:"",type:"textarea",autogrow:"",label:"Your Custom Prompt",placeholder:"Write or paste anything... full control!",class:"text-body1"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),X("div",Qe,[X("div",je,[X("div",He,[X("div",Le,[K(u,{name:"preview",color:"primary"}),l[31]||(l[31]=J(" Live Preview ")),K(p,{size:"sm",color:"positive",icon:"auto_mode"},{default:Y(()=>l[30]||(l[30]=[J("Auto")])),_:1})]),K(b,{flat:"",round:"",icon:"refresh",color:"grey-7",onClick:l[20]||(l[20]=e=>T(!0))})]),K(_,{class:"rounded-borders bg-grey-1 flex-grow-1 q-mb-md",style:{height:"1px"}},{default:Y(()=>[X("div",{class:"q-pa-md font-mono text-body2",innerHTML:I.value},null,8,Fe)]),_:1}),X("div",Oe,[K(b,{color:"grey-8",icon:"content_copy",label:"Copy",onClick:Q,class:"col",unelevated:""}),K(b,{color:"positive",icon:"send",label:"Send to AI",onClick:j,class:"col",unelevated:""})]),C.value.length?(N(),le("div",Ge,[l[32]||(l[32]=X("span",{class:"text-caption text-grey"},"Recent prompts:",-1)),X("div",De,[(N(!0),le(te,null,oe(C.value.slice(0,5),(e,l)=>(N(),W(p,{key:l,clickable:"",onClick:l=>function(e){V.value=e.text,r.value=e.template,a.notify({message:"Loaded from history",type:"positive",icon:"history"})}(e),size:"sm",color:"grey-4",class:"q-ma-xs"},{default:Y(()=>[J(Z(U(e.text,28)),1)]),_:2},1032,["onClick"]))),128))])])):ae("",!0)])])])]),_:1}))}},[["__scopeId","data-v-9cb32bec"]]),Ne={class:"flex items-center justify-between"},Ye={class:"flex gap-2"},Ke={key:0,class:"q-mt-md"},Xe=["innerHTML"],Je=c({__name:"AIAssistant",props:{modelValue:{type:Boolean,default:!1},initialPrompt:{type:String,default:""},context:{type:String,default:""},onInsert:{type:Function,default:null}},emits:["update:modelValue","insert"],setup(e,{emit:l}){const a=e,t=l,o=m(),{ask:r,loading:n,error:s,clearError:i}=function(){const e=H(!1),l=H(null),a=H("");return{loading:e,error:l,lastResponse:a,ask:async(t,o={})=>{if(!t||!t.trim())return l.value="Prompt cannot be empty","";e.value=!0,l.value=null;try{const e=await Ve.complete(t,o);return e.success?(a.value=e.content,e.content):(l.value=e.error||"Failed to get AI response","")}catch(r){return l.value=r.message||"An unexpected error occurred",""}finally{e.value=!1}},improveText:async t=>{if(!t||!t.trim())return l.value="Text cannot be empty","";e.value=!0,l.value=null;try{const e=await Ve.improveText(t);return e.success?(a.value=e.content,e.content):(l.value=e.error||"Failed to improve text","")}catch(o){return l.value=o.message||"An unexpected error occurred",""}finally{e.value=!1}},generateSimilarProblems:async(t,o=3)=>{if(!t||!t.trim())return l.value="Problem cannot be empty","";e.value=!0,l.value=null;try{const e=await Ve.generateSimilarProblems(t,o);return e.success?(a.value=e.content,e.content):(l.value=e.error||"Failed to generate problems","")}catch(r){return l.value=r.message||"An unexpected error occurred",""}finally{e.value=!1}},clearError:()=>{l.value=null}}}(),d=L({get:()=>a.modelValue,set:e=>t("update:modelValue",e)}),c=H(a.initialPrompt||""),p=H(""),v=H(localStorage.getItem("ai_model_preference")||"github"),g=H(!1),h=[{label:"GitHub (GPT-4o) - FREE",value:"github"},{label:"DeepSeek",value:"deepseek"},{label:"Gemini",value:"gemini"}],w=L(()=>p.value.replace(/\n/g,"<br>")),_=async()=>{i(),localStorage.setItem("ai_model_preference",v.value);let e=c.value;a.context&&(e=`Context:\n${a.context}\n\nRequest:\n${c.value}`);const l=await r(e,{model:v.value});l&&(p.value=l)},A=()=>{navigator.clipboard.writeText(p.value).then(()=>{o.notify({type:"positive",message:"Copied to clipboard!",position:"top",timeout:1500})})},q=()=>{let e=p.value;e=e.replace(/\\\((.*?)\\\)/g,"$$$1$$"),e=e.replace(/\\\[(.*?)\\\]/g,"$$$$$$1$$$$"),e=e.replace(/^### (.*?)$/gm,"<h3>$1</h3>"),e=e.replace(/^## (.*?)$/gm,"<h2>$1</h2>"),e=e.replace(/^# (.*?)$/gm,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<b>$1</b>"),e=e.replace(/\*(.*?)\*/g,"<i>$1</i>"),e=e.replace(/^---+$/gm,""),e=e.replace(/\n{3,}/g,"\n\n"),p.value=e.trim(),o.notify({type:"positive",message:"Delimiters fixed!",position:"top",timeout:1500})},M=()=>{let e=p.value;e=e.replace(/\\\((.*?)\\\)/g,"$$$1$$"),e=e.replace(/\\\[(.*?)\\\]/g,"$$$$$$1$$$$"),e=e.replace(/^### (.*?)$/gm,"<h3>$1</h3>"),e=e.replace(/^## (.*?)$/gm,"<h2>$1</h2>"),e=e.replace(/^# (.*?)$/gm,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<b>$1</b>"),e=e.replace(/\*(.*?)\*/g,"<i>$1</i>"),e=e.replace(/^---+$/gm,"");const l=/\$\$([\s\S]*?)\$\$|\$([\s\S]*?)\$/g;let a,t=0,r="";for(;null!==(a=l.exec(e));){r+=e.slice(t,a.index).replace(/\n/g,"<br>");const o=a[1],s=a[2];try{o?r+=me.renderToString(o,{throwOnError:!1,displayMode:!0}):s&&(r+=me.renderToString(s,{throwOnError:!1,displayMode:!1}))}catch(n){r+=`<span class="text-red-500">Error: ${n.message}</span>`}t=l.lastIndex}r+=e.slice(t).replace(/\n/g,"<br>"),p.value=r,o.notify({type:"positive",message:"Math rendered!",position:"top",timeout:1500})},S=()=>{a.onInsert&&a.onInsert(p.value),t("insert",p.value),T()},T=()=>{d.value=!1,setTimeout(()=>{c.value="",p.value="",i()},300)},I=e=>{c.value=e,g.value=!1};return(l,a)=>(N(),le(te,null,[K($,{modelValue:d.value,"onUpdate:modelValue":a[3]||(a[3]=e=>d.value=e),persistent:""},{default:Y(()=>[K(k,{style:{"min-width":"600px","max-width":"90vw"}},{default:Y(()=>[K(f,null,{default:Y(()=>[X("div",Ne,[a[7]||(a[7]=X("div",null,[X("div",{class:"text-h6"},"AI Assistant"),X("div",{class:"text-caption text-grey"},"Ask AI to help with your content")],-1)),X("div",Ye,[K(b,{flat:"",dense:"",icon:"auto_awesome",color:"purple",onClick:a[0]||(a[0]=e=>g.value=!0)},{default:Y(()=>[K(x,null,{default:Y(()=>a[6]||(a[6]=[J("Quick Prompt Builder")])),_:1})]),_:1}),K(ce,{modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=e=>v.value=e),options:h,label:"AI Model",dense:"",outlined:"","emit-value":"","map-options":"",style:{"min-width":"150px"}},{prepend:Y(()=>[K(u,{name:"settings"})]),_:1},8,["modelValue"])])])]),_:1}),K(f,{class:"q-pt-none"},{default:Y(()=>[K(y,{modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=e=>c.value=e),filled:"",type:"textarea",rows:"4",label:"Your question or request",placeholder:"e.g., Improve this text, Generate 3 similar problems, Explain this concept...",disable:ne(n),autofocus:""},null,8,["modelValue","disable"]),p.value?(N(),le("div",Ke,[a[8]||(a[8]=X("div",{class:"text-subtitle2 text-grey-7 q-mb-xs"},"AI Response:",-1)),K(k,{flat:"",bordered:"",class:"q-pa-md bg-grey-1"},{default:Y(()=>[X("div",{innerHTML:w.value,class:"markdown prose"},null,8,Xe)]),_:1})])):ae("",!0),ne(s)?(N(),W(V,{key:1,class:"bg-negative text-white q-mt-md",rounded:""},{avatar:Y(()=>[K(u,{name:"error"})]),default:Y(()=>[J(" "+Z(ne(s)),1)]),_:1})):ae("",!0)]),_:1}),K(C,{align:"right"},{default:Y(()=>[K(b,{flat:"",label:"Cancel",color:"grey",onClick:T,disable:ne(n)},null,8,["disable"]),p.value?(N(),W(b,{key:0,flat:"",label:"Copy",color:"primary",icon:"content_copy",onClick:A,disable:ne(n)},null,8,["disable"])):ae("",!0),p.value?(N(),W(b,{key:1,flat:"",label:"Fix Delimiters",color:"secondary",icon:"code",onClick:q,disable:ne(n)},{default:Y(()=>[K(x,null,{default:Y(()=>a[9]||(a[9]=[J("Convert \\(...\\) to $...$")])),_:1})]),_:1},8,["disable"])):ae("",!0),p.value?(N(),W(b,{key:2,flat:"",label:"Render Math",color:"accent",icon:"functions",onClick:M,disable:ne(n)},{default:Y(()=>[K(x,null,{default:Y(()=>a[10]||(a[10]=[J("Render LaTeX with KaTeX")])),_:1})]),_:1},8,["disable"])):ae("",!0),p.value&&e.onInsert?(N(),W(b,{key:3,unelevated:"",label:"Insert",color:"primary",icon:"add",onClick:S,disable:ne(n)},null,8,["disable"])):ae("",!0),K(b,{unelevated:"",label:"Ask AI",color:"accent",icon:"psychology",onClick:_,loading:ne(n),disable:!c.value.trim()},null,8,["loading","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),K($,{modelValue:g.value,"onUpdate:modelValue":a[5]||(a[5]=e=>g.value=e)},{default:Y(()=>[K(We,{onClose:a[4]||(a[4]=e=>g.value=!1),onUsePrompt:I})]),_:1},8,["modelValue"])],64))}},[["__scopeId","data-v-2f30d47a"]]),Ze={class:"rich-text-editor border border-gray-300 rounded-md shadow-sm overflow-hidden bg-white"},el={class:"w-full border-b border-grey-4 q-pa-xs flex gap-2 items-center"},ll={class:"flex items-center gap-1"},al=c({__name:"RichTextEditor",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:l}){const a=e,t=l,o=H(null),r=H(!1),n=H(null),s=H(null),i=H(""),u=H(!0),d=H(!1),c=H(!1),m=H(!1);F(()=>a.modelValue,e=>{o.value&&e!==o.value.innerHTML&&(o.value.innerHTML=e)}),se(()=>{o.value&&(o.value.innerHTML=a.modelValue)});const p=()=>{o.value&&t("update:modelValue",o.value.innerHTML)},v=()=>{const e=window.getSelection();if(e.getRangeAt&&e.rangeCount){const l=e.getRangeAt(0);o.value&&o.value.contains(l.commonAncestorContainer)&&(n.value=l)}},f=()=>{if(n.value){const e=window.getSelection();e.removeAllRanges(),e.addRange(n.value)}else o.value&&o.value.focus()},y=e=>{"IMG"===e.target.tagName?(s.value=e.target,i.value=e.target.style.width||"auto",u.value="block"!==e.target.style.display):(s.value=null,i.value=""),v()},w=e=>{s.value&&(s.value.style.width=e,s.value.style.height="auto",i.value=e,p())},_=()=>{s.value&&(u.value=!u.value,u.value?(s.value.style.display="inline",s.value.style.margin=""):(s.value.style.display="block",s.value.style.margin="0 auto"),p())},V=(e,l=null)=>{f(),document.execCommand(e,!1,l),v(),p()},C=e=>{f(),document.execCommand("insertHTML",!1,e),d.value=!1,v(),p()},z=e=>{f();const l=e.replace(/\n/g,"<br>");document.execCommand("insertHTML",!1,l),c.value=!1,v(),p()},B=e=>{f(),document.execCommand("insertHTML",!1,e),m.value=!1,v(),p()},P=()=>{const e=window.getSelection();return e&&e.rangeCount>0?e.toString():""},E=async e=>{try{return(await D.post(route("lesson-presentation.proxy-image"),{url:e})).data.base64}catch(l){return console.error("Failed to convert image:",e,l),null}},R=async(e="cursor")=>{if(r.value=!0,o.value)if(o.value.focus(),"replace"===e){o.value.innerHTML="";const e=document.createRange(),l=window.getSelection();e.setStart(o.value,0),e.collapse(!0),l.removeAllRanges(),l.addRange(e),v()}else if("end"===e){const e=document.createRange(),l=window.getSelection();e.selectNodeContents(o.value),e.collapse(!1),l.removeAllRanges(),l.addRange(e),v()}else f();try{const e=await navigator.clipboard.read();for(const l of e){if(l.types.includes("text/html")){const e=await l.getType("text/html"),a=await e.text(),t=(new DOMParser).parseFromString(a,"text/html"),o=t.getElementsByTagName("img"),r=Array.from(o).map(async e=>{const l=e.getAttribute("src");if(l&&(l.startsWith("http://")||l.startsWith("https://"))){const a=await E(l);a&&e.setAttribute("src",a)}});await Promise.all(r);const n=ie.sanitize(t.body.innerHTML,{ADD_TAGS:["img"],ADD_ATTR:["src","style","width","height","alt","class"]});return document.execCommand("insertHTML",!1,n),void p()}if(l.types.some(e=>e.startsWith("image/"))){const e=await l.getType(l.types.find(e=>e.startsWith("image/"))),a=new FileReader;return a.onload=e=>{const l=`<img src="${e.target.result}" style="max-width: 100%;" />`,a=ie.sanitize(l,{ADD_TAGS:["img"],ADD_ATTR:["src","style"]});document.execCommand("insertHTML",!1,a),p()},void a.readAsDataURL(e)}if(l.types.includes("text/plain")){const e=await l.getType("text/plain"),a=await e.text();return document.execCommand("insertText",!1,a),void p()}}}catch(l){console.error("Failed to read clipboard contents: ",l);try{const e=await navigator.clipboard.readText();document.execCommand("insertText",!1,e),p()}catch(a){alert("Could not paste from clipboard. Please use Ctrl+V.")}}finally{r.value=!1}};return(e,l)=>(N(),le("div",Ze,[X("div",el,[K(T,{split:"",onClick:l[3]||(l[3]=e=>R("cursor")),loading:r.value,flat:"",dense:"",size:"sm",color:"grey-8",icon:"content_paste",label:"Paste","no-caps":""},{default:Y(()=>[K(A,null,{default:Y(()=>[ee((N(),W(S,{clickable:"",onClick:l[0]||(l[0]=e=>R("cursor"))},{default:Y(()=>[K(q,null,{default:Y(()=>[K(M,null,{default:Y(()=>l[21]||(l[21]=[J("Paste at Cursor")])),_:1})]),_:1})]),_:1})),[[g]]),ee((N(),W(S,{clickable:"",onClick:l[1]||(l[1]=e=>m.value=!0)},{default:Y(()=>[K(q,{class:"text-primary"},{default:Y(()=>[K(M,null,{default:Y(()=>l[22]||(l[22]=[J("Smart Paste (Math/AI)...")])),_:1})]),_:1})]),_:1})),[[g]]),ee((N(),W(S,{clickable:"",onClick:l[2]||(l[2]=e=>R("replace"))},{default:Y(()=>[K(q,{class:"text-red"},{default:Y(()=>[K(M,null,{default:Y(()=>l[23]||(l[23]=[J("Replace All")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1}),K(x,null,{default:Y(()=>l[24]||(l[24]=[J("Paste Options")])),_:1})]),_:1},8,["loading"]),K(h,{vertical:"",inset:""}),K(b,{flat:"",dense:"",size:"sm",color:"grey-8",icon:"format_color_text"},{default:Y(()=>[K(x,null,{default:Y(()=>l[25]||(l[25]=[J("Text Color")])),_:1}),K(I,null,{default:Y(()=>[K(ke,{"no-header":"","no-footer":"","default-view":"palette","onUpdate:modelValue":l[4]||(l[4]=e=>V("foreColor",e))})]),_:1})]),_:1}),K(b,{flat:"",dense:"",size:"sm",color:"grey-8",icon:"format_color_fill"},{default:Y(()=>[K(x,null,{default:Y(()=>l[26]||(l[26]=[J("Background Color")])),_:1}),K(I,null,{default:Y(()=>[K(ke,{"no-header":"","no-footer":"","default-view":"palette","onUpdate:modelValue":l[5]||(l[5]=e=>V("hiliteColor",e))})]),_:1})]),_:1}),K(h,{vertical:"",inset:""}),K(T,{flat:"",dense:"",size:"sm",color:"grey-8",icon:"format_size","no-caps":""},{default:Y(()=>[K(A,null,{default:Y(()=>[ee((N(),W(S,{clickable:"",onClick:l[6]||(l[6]=e=>V("fontSize","1"))},{default:Y(()=>[K(q,null,{default:Y(()=>l[27]||(l[27]=[J("Small")])),_:1})]),_:1})),[[g]]),ee((N(),W(S,{clickable:"",onClick:l[7]||(l[7]=e=>V("fontSize","3"))},{default:Y(()=>[K(q,null,{default:Y(()=>l[28]||(l[28]=[J("Normal")])),_:1})]),_:1})),[[g]]),ee((N(),W(S,{clickable:"",onClick:l[8]||(l[8]=e=>V("fontSize","5"))},{default:Y(()=>[K(q,null,{default:Y(()=>l[29]||(l[29]=[J("Large")])),_:1})]),_:1})),[[g]]),ee((N(),W(S,{clickable:"",onClick:l[9]||(l[9]=e=>V("fontSize","7"))},{default:Y(()=>[K(q,null,{default:Y(()=>l[30]||(l[30]=[J("Huge")])),_:1})]),_:1})),[[g]])]),_:1}),K(x,null,{default:Y(()=>l[31]||(l[31]=[J("Font Size")])),_:1})]),_:1}),K(h,{vertical:"",inset:""}),K(b,{onClick:l[10]||(l[10]=e=>V("bold")),flat:"",dense:"",size:"sm",color:"grey-8",icon:"format_bold"},{default:Y(()=>[K(x,null,{default:Y(()=>l[32]||(l[32]=[J("Bold")])),_:1})]),_:1}),K(b,{onClick:l[11]||(l[11]=e=>V("italic")),flat:"",dense:"",size:"sm",color:"grey-8",icon:"format_italic"},{default:Y(()=>[K(x,null,{default:Y(()=>l[33]||(l[33]=[J("Italic")])),_:1})]),_:1}),K(b,{onClick:l[12]||(l[12]=e=>V("underline")),flat:"",dense:"",size:"sm",color:"grey-8",icon:"format_underlined"},{default:Y(()=>[K(x,null,{default:Y(()=>l[34]||(l[34]=[J("Underline")])),_:1})]),_:1}),s.value?(N(),le(te,{key:0},[K(h,{vertical:"",inset:""}),X("div",ll,[l[36]||(l[36]=X("span",{class:"text-xs text-grey-7 q-ml-xs"},"Img:",-1)),K(U,{flat:"",dense:""},{default:Y(()=>[K(b,{label:"25%",size:"sm",dense:"",color:"grey-8",onClick:l[13]||(l[13]=e=>w("25%"))}),K(b,{label:"50%",size:"sm",dense:"",color:"grey-8",onClick:l[14]||(l[14]=e=>w("50%"))}),K(b,{label:"100%",size:"sm",dense:"",color:"grey-8",onClick:l[15]||(l[15]=e=>w("100%"))})]),_:1}),K(b,{flat:!u.value,unelevated:u.value,color:u.value?"primary":"grey-8",size:"sm",dense:"",label:"Inline",onClick:_,class:"q-ml-xs"},{default:Y(()=>[K(x,null,{default:Y(()=>l[35]||(l[35]=[J("Toggle Inline/Block")])),_:1})]),_:1},8,["flat","unelevated","color"])])],64)):ae("",!0),K(h,{vertical:"",inset:""}),K(b,{onClick:l[16]||(l[16]=e=>d.value=!0),flat:"",dense:"",size:"sm",color:"grey-8",icon:"functions"},{default:Y(()=>[K(x,null,{default:Y(()=>l[37]||(l[37]=[J("Insert Math Equation")])),_:1})]),_:1}),K(b,{onClick:l[17]||(l[17]=e=>c.value=!0),flat:"",dense:"",size:"sm",color:"accent",icon:"psychology"},{default:Y(()=>[K(x,null,{default:Y(()=>l[38]||(l[38]=[J("AI Assistant")])),_:1})]),_:1})]),X("div",{ref_key:"editor",ref:o,class:"max-h-96 overflow-y-auto markdown prose dark:prose-invert w-full break-words markdown-new-styling",contenteditable:"true",onInput:p,onBlur:p,onMouseup:v,onKeyup:v,onMouseleave:v,onClick:y},null,544),K($,{modelValue:d.value,"onUpdate:modelValue":l[18]||(l[18]=e=>d.value=e)},{default:Y(()=>[K(k,{style:{"min-width":"600px","max-width":"90vw"}},{default:Y(()=>[K(ue,{onInsert:C})]),_:1})]),_:1},8,["modelValue"]),K($,{modelValue:m.value,"onUpdate:modelValue":l[19]||(l[19]=e=>m.value=e),"full-width":"","full-height":""},{default:Y(()=>[K(k,{class:"flex flex-col h-full overflow-hidden"},{default:Y(()=>[K(de,{onInsert:B})]),_:1})]),_:1},8,["modelValue"]),K(Je,{modelValue:c.value,"onUpdate:modelValue":l[20]||(l[20]=e=>c.value=e),context:P(),"on-insert":z},null,8,["modelValue","context"])]))}},[["__scopeId","data-v-45c9ebd5"]]),tl=Object.freeze(Object.defineProperty({__proto__:null,default:al},Symbol.toStringTag,{value:"Module"}));export{Je as A,al as R,tl as a};
