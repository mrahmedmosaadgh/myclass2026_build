import{f as e,b as a,t as l,G as t,d as o,h as r,o as s,e as n}from"./app-4gpSDtVV.js";import{Q as i}from"./QTd-D1GV5G3N.js";import{Q as m}from"./QTable-Yrq9AmcZ.js";import{Q as u}from"./QSpace-BaiVAeLS.js";import{Q as d}from"./QSelect-Dgk9Cshp.js";import{Q as c}from"./QForm-B3HUaoek.js";import{a as p,f as b,o as v,N as y,J as _,b as f,R as g,z as k,a4 as S,K as h,W as w,V as j,F as q,Q as x,I,O as N,$ as V,_ as D}from"./vendor-BWKGNkNB.js";import{_ as Q}from"./ImportExcel-DcRIWk0g.js";import{e as C}from"./exportHelper-Jl5p4jiq.js";import"./offline-BzIlwqNM.js";import"./i18n-B0T1C7j3.js";import"./ui-B7TfxbV_.js";import"./QMarkupTable-B_ExttGO.js";import"./QLinearProgress-CBrm9QWG.js";import"./use-fullscreen-BdF06Cx5.js";import"./rtl-Cr6c3OOr.js";import"./SecondaryButton-WaufSYeJ.js";import"./PrimaryButton-DVJXOzHH.js";import"./Modal-DgRFYELY.js";import"./xlsx-BHXqx-YI.js";const A={class:"q-pa-lg"},E={class:"row justify-between items-center q-mb-md"},U={class:"row q-gutter-sm"},$={class:"text-h6"},P="Semester",T="/admin/semester",W={__name:"Index",props:{records:Object,options:Object},setup(W){var Y,z,B,O;const M=W,R=p(()=>{var e;return(null==(e=M.records)?void 0:e.data)||[]});p(()=>{var e;return(null==(e=M.records)?void 0:e.links)||null});const F=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"semester_number",label:"Semester Number",field:"semester_number",align:"center",sortable:!0},{name:"weeks_number",label:"Weeks",field:"weeks_number",align:"center",sortable:!0},{name:"start_date",label:"Start Date",field:"start_date",align:"center",sortable:!0},{name:"end_date",label:"End Date",field:"end_date",align:"center",sortable:!0},{name:"active",label:"Status",field:"active",align:"center",sortable:!0},{name:"actions",label:"Actions",field:"actions",align:"center",sortable:!1}],G=b({sortBy:"name",descending:!1,page:1,rowsPerPage:10}),H=[{name:"name",label:"Name",type:"text",required:!0},{name:"semester_number",label:"Semester Number",type:"number",required:!0},{name:"weeks_number",label:"Number of Weeks",type:"number"},{name:"start_date",label:"Start Date",type:"date"},{name:"end_date",label:"End Date",type:"date"},{name:"school_id",label:"School",type:"select",required:!0,options:(null==(z=null==(Y=M.options)?void 0:Y.schools)?void 0:z.map(e=>({value:e.id,label:e.name})))||[]},{name:"academic_year_id",label:"Academic Year",type:"select",required:!0,options:(null==(O=null==(B=M.options)?void 0:B.academicYears)?void 0:O.map(e=>({value:e.id,label:e.name})))||[]},{name:"active",label:"Status",type:"select",options:[{value:!0,label:"Active"},{value:!1,label:"Inactive"}]}],J=b(!1),K=b(null),L=b(!1),X=b({}),Z=b({}),ee=e=>{G.value=e.pagination},ae=(e=null)=>{K.value=e,J.value=!0,te()},le=()=>{J.value=!1,K.value=null,X.value={},Z.value={}},te=()=>{const e={};if(!H)return e;H.forEach(a=>{var l,t,o,r,s,n;if(a.options&&"object"==typeof a.options&&"value"in a.options&&(a.options=a.options.value),"checkbox"===a.type?e[a.name]=null!=(o=null!=(t=null==(l=K.value)?void 0:l[a.name])?t:a.value)&&o:e[a.name]=null!=(n=null!=(s=null==(r=K.value)?void 0:r[a.name])?s:a.default)?n:"","school_id"===a.name&&!K.value){const l=localStorage.getItem("school_id")||localStorage.getItem("selected_school");l&&(e[a.name]=parseInt(l))}}),Z.value=e},oe=()=>{const e=localStorage.getItem("school_id")||localStorage.getItem("selected_school"),a=e?{school_id:e}:{};V.reload({only:["records"],data:a,preserveScroll:!0,preserveState:!0})},re=async()=>{var e,a,l;L.value=!0,X.value={};const t=null==(e=K.value)?void 0:e.id,o=t?`${T}/${t}`:T;try{await D.post(o,{...t&&{_method:"PUT"},...Z.value}),le(),oe()}catch(r){(null==(l=null==(a=r.response)?void 0:a.data)?void 0:l.errors)&&(X.value=r.response.data.errors)}finally{L.value=!1}},se=[{key:"name",label:"Name"},{key:"semester_number",label:"Semester Number"},{key:"weeks_number",label:"Weeks Number"},{key:"start_date",label:"Start Date"},{key:"end_date",label:"End Date"},{key:"school_id",label:"School ID"},{key:"academic_year_id",label:"Academic Year ID"},{key:"active",label:"Status"}],ne=()=>{C({items:R.value,columns:[{key:"name",label:"Name"},{key:"semester_number",label:"Semester Number"},{key:"weeks_number",label:"Weeks Number"},{key:"start_date",label:"Start Date"},{key:"end_date",label:"End Date"},{key:"school.name",label:"School"},{key:"academicYear.name",label:"Academic Year"},{key:"active",label:"Status"}],fileName:`semesters_${(new Date).toISOString().split("T")[0]}.xlsx`,sheetName:"Semesters"})};return v(()=>{(localStorage.getItem("school_id")||localStorage.getItem("selected_school"))&&oe()}),(p,b)=>(_(),y(q,null,[f(k(S),{title:"Semester Management"}),g("div",A,[f(o,{class:"q-ma-md"},{default:h(()=>[f(e,null,{default:h(()=>[g("div",E,[g("div",U,[f(a,{color:"primary",icon:"add",label:"Add New Semester",onClick:b[0]||(b[0]=e=>ae()),unelevated:""}),f(Q,{onImported:oe,"validate-url":T+"/validate-import","import-url":T+"/import",columns:se,"button-text":"Import Semesters","preview-title":"Preview Data"},null,8,["validate-url","import-url"]),f(a,{color:"secondary",icon:"download",label:"Export",onClick:ne,outline:""})])]),f(m,{rows:R.value,columns:F,"row-key":"id",flat:"",bordered:"",pagination:G.value,onRequest:ee},{"body-cell-active":h(e=>[f(i,{props:e},{default:h(()=>[f(t,{color:e.value?"positive":"negative",label:e.value?"Active":"Inactive","text-color":"white",size:"sm"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-actions":h(e=>[f(i,{props:e},{default:h(()=>[f(a,{flat:"",round:"",color:"primary",icon:"edit",size:"sm",onClick:a=>ae(e.row)},{default:h(()=>[f(l,null,{default:h(()=>b[2]||(b[2]=[w("Edit")])),_:1})]),_:2},1032,["onClick"]),f(a,{flat:"",round:"",color:"negative",icon:"delete",size:"sm",onClick:a=>(async e=>{if(confirm("Are you sure you want to delete this record?"))try{await D.delete(`${T}/${e.id}`),oe()}catch(a){console.error("Deletion error:",a),alert("An error occurred while deleting the record.")}})(e.row),class:"q-ml-xs"},{default:h(()=>[f(l,null,{default:h(()=>b[3]||(b[3]=[w("Delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","pagination"])]),_:1})]),_:1}),f(n,{modelValue:J.value,"onUpdate:modelValue":b[1]||(b[1]=e=>J.value=e),persistent:""},{default:h(()=>[f(o,{style:{"min-width":"500px"}},{default:h(()=>[f(e,{class:"row items-center"},{default:h(()=>[g("div",$,j(K.value?`Edit ${P}`:`Create New ${P}`),1),f(u),f(a,{icon:"close",flat:"",round:"",dense:"",onClick:le})]),_:1}),f(e,null,{default:h(()=>[f(c,{onSubmit:re,class:"q-gutter-md"},{default:h(()=>[(_(),y(q,null,x(H,e=>{var a,l,t;return g("div",{key:e.name},["text"===e.type||"number"===e.type?(_(),I(r,{key:0,modelValue:Z.value[e.name],"onUpdate:modelValue":a=>Z.value[e.name]=a,label:e.label,type:e.type,required:e.required,outlined:"",error:!!X.value[e.name],"error-message":null==(a=X.value[e.name])?void 0:a[0]},null,8,["modelValue","onUpdate:modelValue","label","type","required","error","error-message"])):"date"===e.type?(_(),I(r,{key:1,modelValue:Z.value[e.name],"onUpdate:modelValue":a=>Z.value[e.name]=a,label:e.label,type:"date",outlined:"",error:!!X.value[e.name],"error-message":null==(l=X.value[e.name])?void 0:l[0]},null,8,["modelValue","onUpdate:modelValue","label","error","error-message"])):"select"===e.type?(_(),I(d,{key:2,modelValue:Z.value[e.name],"onUpdate:modelValue":a=>Z.value[e.name]=a,options:e.options,label:e.label,"option-value":"value","option-label":"label","emit-value":"","map-options":"",outlined:"",required:e.required,error:!!X.value[e.name],"error-message":null==(t=X.value[e.name])?void 0:t[0]},null,8,["modelValue","onUpdate:modelValue","options","label","required","error","error-message"])):N("",!0)])}),64)),f(s,{align:"right",class:"q-pt-md"},{default:h(()=>[f(a,{flat:"",label:"Cancel",onClick:le}),f(a,{type:"submit",color:"primary",label:"Save",loading:L.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])],64))}};export{W as default};
