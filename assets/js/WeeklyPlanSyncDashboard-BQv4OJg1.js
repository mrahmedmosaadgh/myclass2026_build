import{Q as e}from"./QSpinnerDots-BY_P7fmL.js";import{p as l,u as a,d as s,e as t,n as i,Q as o,C as r,m as n,b as d,h as c,i as u,j as m,k as v,b2 as p,aD as y}from"./app-BXm70mdJ.js";import{Q as g}from"./QCircularProgress-BjCdikR6.js";import{Q as b}from"./QBadge-ZzhN1X9C.js";import{Q as f}from"./QTd-BIxMTYzb.js";import{Q as _}from"./QTable-rnEofRem.js";import{f as k,a as h,k as w,o as x,L as P,I as j,b as Q,M as q,H as C,O as z,J as I,U as M,y as N,F as E,Q as S,V as D,x as $,Z as A}from"./vendor-DNM7Y6Xn.js";import{u as T}from"./useWeeklyPlansStore-rfk5h30C.js";import{u as U}from"./i18n-CBOKL2HS.js";import"./offline-BzIlwqNM.js";import"./ui-BP0GJNn5.js";import"./QMarkupTable-Dmg3C5Wm.js";import"./QSelect-CnZtzPIC.js";import"./rtl-Cr6c3OOr.js";import"./QLinearProgress-Cix0cchl.js";import"./use-fullscreen-FlxrEg_V.js";import"./schoolData-lzO9rVwn.js";const V={class:"sync-dashboard q-pa-md"},B={key:0,class:"flex flex-center q-pa-xl"},F={key:1},L={class:"row q-col-gutter-md q-mb-lg"},W={class:"col-12 col-sm-6 col-md-3"},J={class:"stat-icon bg-blue-1 text-blue"},O={class:"stat-value text-h4"},Y={class:"stat-label text-grey-7"},H={class:"col-12 col-sm-6 col-md-3"},K={class:"stat-icon bg-green-1 text-green"},Z={class:"stat-value text-h4 text-positive"},G={class:"stat-label text-grey-7"},R={class:"col-12 col-sm-6 col-md-3"},X={class:"stat-icon bg-orange-1 text-orange"},ee={class:"stat-value text-h4 text-warning"},le={class:"stat-label text-grey-7"},ae={class:"col-12 col-sm-6 col-md-3"},se={class:"stat-icon bg-purple-1 text-purple"},te={class:"stat-value text-h4 text-primary"},ie={class:"stat-label text-grey-7"},oe={class:"row q-mb-lg"},re={class:"col-12"},ne={class:"row q-col-gutter-md"},de={class:"row items-center q-mb-md"},ce={class:"col"},ue={class:"text-h6"},me={class:"text-caption text-grey-7"},ve={class:"col-auto"},pe={class:"text-caption"},ye={key:0,class:"text-warning"},ge={class:"text-h6"},be={class:"text-caption text-grey-7"},fe={class:"text-h6 text-grey-7 q-mt-md"},_e={class:"text-grey-6"},ke=l({__name:"WeeklyPlanSyncDashboard",setup(l){const{t:ke}=U(),he=T(),we=a(),xe=k(!1),Pe=k(!1),je=k(null),Qe=k(!1),qe=k([]),Ce=k([]),ze=k("all"),Ie=h(()=>"ar"===ke("code")?"right":"left"),Me=h(()=>[{name:"day",label:ke("weeklyPlans.day"),field:"day",align:Ie.value,sortable:!0},{name:"period",label:ke("weeklyPlans.period"),field:"period",align:"center",sortable:!0},{name:"subject",label:ke("weeklyPlans.subject"),field:"subject",align:Ie.value,sortable:!0},{name:"teacher",label:ke("weeklyPlans.teacher"),field:"teacher",align:Ie.value,sortable:!0},{name:"status",label:ke("weeklyPlans.status"),field:"status",align:"center"}]),Ne=async()=>{if(he.selectedCopyId){xe.value=!0;try{const e=await A.get("/weekly-system/api/sync-analysis",{params:{copy_id:he.selectedCopyId,week_number:he.weekNumber,academic_year_id:he.selectedAcademicYearId,semester_number:he.semesterNumber}});je.value=e.data}catch(e){console.error("Error fetching sync analysis:",e),we.notify({type:"negative",message:"Failed to load sync analysis"})}finally{xe.value=!1}}},Ee=()=>{var e;ze.value="all",qe.value=[],(null==(e=je.value)?void 0:e.classrooms)&&je.value.classrooms.forEach(e=>{e.days&&e.days.forEach(l=>{var a;(null==(a=l.missing_periods)?void 0:a.length)>0&&l.missing_periods.forEach(a=>{qe.value.push({id:a.id,day:l.day,period:a.period,subject:a.subject,teacher:a.teacher,status:"missing",classroom_name:e.name})})})}),Ce.value=[...qe.value],Qe.value=!0},Se=()=>{var e,l;if("all"===ze.value)return"All Classrooms";const a=null==(l=null==(e=je.value)?void 0:e.classrooms)?void 0:l.find(e=>e.id===ze.value);return a?`Classroom ${a.name}`:""},De=async()=>{var e,l;Pe.value=!0;try{const e=Ce.value.map(e=>e.id),l=await A.post("/weekly-system/api/weekly-plans/batch-create",{schedule_ids:e,week_number:he.weekNumber,academic_year_id:he.selectedAcademicYearId,semester_number:he.semesterNumber});we.notify({type:"positive",message:l.data.message||`Created ${e.length} weekly plans`}),Qe.value=!1,await Ne()}catch(a){console.error(a),we.notify({type:"negative",message:(null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||"Failed to create plans"})}finally{Pe.value=!1}};return w(()=>[he.selectedCopyId,he.weekNumber,he.semesterNumber],()=>{Ne()},{deep:!0}),x(()=>{Ne()}),(l,a)=>{var k,h,w,x,A;return j(),P("div",V,[xe.value?(j(),P("div",B,[Q(e,{size:"50px",color:"primary"})])):(j(),P("div",F,[q("div",L,[q("div",W,[Q(i,{flat:"",bordered:"",class:"stat-card"},{default:I(()=>[Q(s,null,{default:I(()=>{var e,l;return[q("div",J,[Q(t,{name:"grid_on",size:"32px"})]),q("div",O,M((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.total_slots)||0),1),q("div",Y,M(N(ke)("weeklyPlans.totalSlots")),1)]}),_:1})]),_:1})]),q("div",H,[Q(i,{flat:"",bordered:"",class:"stat-card"},{default:I(()=>[Q(s,null,{default:I(()=>{var e,l;return[q("div",K,[Q(t,{name:"check_circle",size:"32px"})]),q("div",Z,M((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.complete)||0),1),q("div",G,M(N(ke)("weeklyPlans.completed")),1)]}),_:1})]),_:1})]),q("div",R,[Q(i,{flat:"",bordered:"",class:"stat-card"},{default:I(()=>[Q(s,null,{default:I(()=>{var e,l;return[q("div",X,[Q(t,{name:"error",size:"32px"})]),q("div",ee,M((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.missing)||0),1),q("div",le,M(N(ke)("weeklyPlans.missing")),1)]}),_:1})]),_:1})]),q("div",ae,[Q(i,{flat:"",bordered:"",class:"stat-card"},{default:I(()=>[Q(s,null,{default:I(()=>{var e,l;return[q("div",se,[Q(t,{name:"trending_up",size:"32px"})]),q("div",te,M((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.percentage)||0)+"%",1),q("div",ie,M(N(ke)("weeklyPlans.progress")),1)]}),_:1})]),_:1})])]),q("div",oe,[q("div",re,[(null==(h=null==(k=je.value)?void 0:k.summary)?void 0:h.missing)>0?(j(),C(o,{key:0,color:"primary",icon:"sync",label:N(ke)("weeklyPlans.syncAll"),loading:Pe.value,onClick:Ee,unelevated:"",size:"lg"},null,8,["label","loading"])):z("",!0)])]),q("div",ne,[(j(!0),P(E,null,S(null==(w=je.value)?void 0:w.classrooms,e=>(j(),P("div",{key:e.id,class:"col-12 col-md-6 col-lg-4"},[Q(i,{flat:"",bordered:"",class:"classroom-card"},{default:I(()=>[Q(s,null,{default:I(()=>{var l,a;return[q("div",de,[q("div",ce,[q("div",ue,M(e.name),1),q("div",me,M(e.complete)+"/"+M(e.total_slots)+" slots complete ",1)]),q("div",ve,[Q(g,{value:e.percentage,size:"80px",thickness:.15,color:(a=e.percentage,a>=80?"positive":a>=50?"warning":"negative"),"track-color":"grey-3","show-value":""},{default:I(()=>[q("div",pe,M(e.percentage)+"%",1)]),_:2},1032,["value","color"])])]),(null==(l=e.days)?void 0:l.length)?(j(),C(p,{key:0,icon:"calendar_today",label:N(ke)("weeklyPlans.viewByDay"),dense:"","header-class":"text-primary"},{default:I(()=>[Q(c,{dense:"",separator:""},{default:I(()=>[(j(!0),P(E,null,S(e.days,e=>(j(),C(u,{key:e.day_number},{default:I(()=>[Q(m,null,{default:I(()=>[Q(v,null,{default:I(()=>[D(M(e.day),1)]),_:2},1024),Q(v,{caption:""},{default:I(()=>[D(M(e.complete)+"/"+M(e.total)+" complete ",1),e.missing>0?(j(),P("span",ye," (Missing: P"+M(e.missing_periods.join(", P"))+") ",1)):z("",!0)]),_:2},1024)]),_:2},1024),Q(m,{side:""},{default:I(()=>[Q(b,{color:e.missing>0?"warning":"positive",label:e.missing>0?`${e.missing} missing`:"Complete"},null,8,["color","label"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["label"])):z("",!0),e.missing>0?(j(),C(o,{key:1,color:"primary",icon:"sync",label:`${N(ke)("weeklyPlans.syncWeeklyPlans")} (${e.missing})`,onClick:l=>(e=>{var l,a;ze.value=e,qe.value=[];const s=null==(a=null==(l=je.value)?void 0:l.classrooms)?void 0:a.find(l=>l.id===e);s&&s.days&&s.days.forEach(e=>{var l;(null==(l=e.missing_periods)?void 0:l.length)>0&&e.missing_periods.forEach(l=>{qe.value.push({id:l.id,day:e.day,period:l.period,subject:l.subject,teacher:l.teacher,status:"missing",classroom_name:s.name})})}),Ce.value=[...qe.value],Qe.value=!0})(e.id),outline:"",class:"full-width q-mt-md",size:"sm"},null,8,["label","onClick"])):z("",!0)]}),_:2},1024)]),_:2},1024)]))),128))]),Q(d,{modelValue:Qe.value,"onUpdate:modelValue":a[1]||(a[1]=e=>Qe.value=e),"full-width":""},{default:I(()=>[Q(i,null,{default:I(()=>[Q(s,null,{default:I(()=>[q("div",ge,M(N(ke)("weeklyPlans.syncPreview"))+" - "+M(Se()),1),q("div",be,M(N(ke)("weeklyPlans.selectMissingPlans")),1)]),_:1}),Q(s,{class:"q-pa-none"},{default:I(()=>[Q(_,{rows:qe.value,columns:Me.value,"row-key":"id",selection:"multiple",selected:Ce.value,"onUpdate:selected":a[0]||(a[0]=e=>Ce.value=e),flat:"",bordered:"",pagination:{rowsPerPage:0},"virtual-scroll":"",style:{height:"400px"}},{"body-cell-status":I(e=>[Q(f,{props:e},{default:I(()=>[Q(r,{color:"negative","text-color":"white",size:"sm",icon:"warning"},{default:I(()=>a[2]||(a[2]=[D(" Missing ")])),_:1})]),_:2},1032,["props"])]),_:1},8,["rows","columns","selected"])]),_:1}),Q(n,{align:"right",class:"q-pa-md"},{default:I(()=>[$(Q(o,{flat:"",label:N(ke)("common.cancel"),color:"primary"},null,8,["label"]),[[y]]),Q(o,{unelevated:"",color:"primary",label:N(ke)("weeklyPlans.createPlans",{count:Ce.value.length}),disable:0===Ce.value.length,loading:Pe.value,onClick:De},null,8,["label","disable","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(null==(A=null==(x=je.value)?void 0:x.classrooms)?void 0:A.length)?z("",!0):(j(),C(i,{key:0,flat:"",bordered:"",class:"text-center q-pa-xl q-mt-lg"},{default:I(()=>[Q(t,{name:"check_circle",size:"64px",color:"positive"}),q("p",fe,M(N(ke)("weeklyPlans.allSynced")),1),q("p",_e,M(N(ke)("weeklyPlans.noMissingPlans")),1)]),_:1}))]))])}}},[["__scopeId","data-v-652055c6"]]);export{ke as default};
