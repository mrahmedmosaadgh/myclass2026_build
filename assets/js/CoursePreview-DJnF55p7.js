import{p as e,u as l,B as a,h as s,R as t,j as r,A as o,k as n,Q as i,i as u,e as c,g as d,aq as m}from"./app-BzjXrVp9.js";import{Q as v}from"./QTree-BcSViDG0.js";import{Q as p}from"./QBadge-D2ciqrkO.js";import{Q as f}from"./QSplitter-DKf0DN_o.js";import{f as y,a as h,o as g,L as x,I as w,b as k,J as _,M as q,O as C,H as b,U as L,V as j,F as $,Q,x as I}from"./vendor-EI0FRBVb.js";import"./offline-BzIlwqNM.js";import"./i18n-BbKXhR_S.js";import"./ui-B__oX9pK.js";const V={class:"course-preview"},S={class:"q-pa-md"},z={class:"row items-center q-mb-md"},N={key:1,class:"text-center q-pa-md"},B={key:2,class:"text-center q-pa-md"},P={class:"text-negative q-mt-sm"},U={class:"row items-center"},F={class:"q-pa-md"},T={key:0},E={class:"row items-center q-mb-md"},H={class:"text-h4 col"},R={key:0,class:"text-center q-mt-xl"},A={class:"text-grey-7 q-mt-md"},J={key:0},M={key:1},O={key:1,class:"text-center q-mt-xl"},D=e({__name:"CoursePreview",setup(e){const D=l(),G=y(25),K=y(null),W=y(""),X=y(!1),Y=y([]),Z=y(!1),ee=y(null),le=h(()=>Y.value.map(e=>{var l;return{id:`course-${e.id}`,name:e.name,type:"course",children:(null==(l=e.levels)?void 0:l.map(l=>{var a;return{id:`level-${l.id}`,name:l.title,displayName:`${l.order||1}. ${l.title}`,type:"level",courseId:e.id,levelId:l.id,children:(null==(a=l.sections)?void 0:a.map(a=>({id:`section-${a.id}`,name:a.title,displayName:`${l.order||1}.${a.order||1}. ${a.title}`,type:"section",courseId:e.id,levelId:l.id,sectionId:a.id,lessons:a.lessons||[]})))||[]}}))||[]}})),ae=h(()=>{if(!W.value)return le.value;const e=W.value.toLowerCase();return le.value.map(l=>{if(l.name.toLowerCase().includes(e))return l;const a=l.children.filter(l=>{if(l.name.toLowerCase().includes(e))return!0;const a=l.children.filter(l=>{var a;if(l.name.toLowerCase().includes(e))return!0;return((null==(a=l.lessons)?void 0:a.filter(l=>l.title.toLowerCase().includes(e)||l.text&&l.text.toLowerCase().includes(e)))||[]).length>0});return a.length>0?{...l,children:a}:null}).filter(Boolean);return a.length>0?{...l,children:a}:null}).filter(Boolean)}),se=h(()=>{if(!K.value)return null;const e=oe(K.value);return e&&"section"===e.type?{name:e.name,lessons:e.lessons||[],originalLessons:e.lessons||[]}:null}),te=h(()=>{if(!se.value)return[];let e=se.value.originalLessons||[];if(W.value){const l=W.value.toLowerCase();e=e.filter(e=>e.title.toLowerCase().includes(l)||e.text&&e.text.toLowerCase().includes(l))}return e}),re=async()=>{Z.value=!0,ee.value=null;try{const e=await fetch("/course-management/api/courses/with-structure");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const l=await e.json();Y.value=l.data||l}catch(e){console.error("Error loading courses:",e),ee.value="Failed to load courses. Please try again.",D.notify({type:"negative",message:"Failed to load courses",position:"top"})}finally{Z.value=!1}},oe=e=>{for(const l of le.value){if(l.id===e)return l;for(const a of l.children||[]){if(a.id===e)return a;for(const l of a.children||[])if(l.id===e)return l}}return null},ne=e=>{switch(e.type){case"course":return"school";case"level":return"layers";case"section":return"description";default:return"help_outline"}},ie=e=>{switch(e.type){case"course":return"primary";case"level":return"secondary";case"section":return"accent";default:return"grey"}},ue=e=>{console.log("Selected node:",e)},ce=()=>{X.value=!X.value,X.value||(W.value="")};return g(()=>{re()}),(e,l)=>(w(),x("div",V,[k(f,{modelValue:G.value,"onUpdate:modelValue":l[2]||(l[2]=e=>G.value=e),style:{height:"100vh"},limits:[20,50]},{before:_(()=>[k(a,{class:"fit"},{default:_(()=>[q("div",S,[q("div",z,[l[3]||(l[3]=q("h3",{class:"text-h5 col"},"Course Structure",-1)),k(i,{flat:"",round:"",icon:"search",onClick:ce,color:X.value?"primary":"grey"},null,8,["color"])]),X.value?(w(),b(d,{key:0,modelValue:W.value,"onUpdate:modelValue":l[0]||(l[0]=e=>W.value=e),placeholder:"Search levels, sections, and lessons...",dense:"",outlined:"",class:"q-mb-md",clearable:""},{prepend:_(()=>[k(c,{name:"search"})]),_:1},8,["modelValue"])):C("",!0),Z.value?(w(),x("div",N,[k(m,{color:"primary",size:"3em"}),l[4]||(l[4]=q("div",{class:"q-mt-sm"},"Loading courses...",-1))])):ee.value?(w(),x("div",B,[k(c,{name:"error",size:"3em",color:"negative"}),q("div",P,L(ee.value),1),k(i,{color:"primary",label:"Retry",onClick:re,class:"q-mt-md"})])):(w(),b(v,{key:3,nodes:ae.value,"node-key":"id","label-key":"name","children-key":"children",selected:K.value,"onUpdate:selected":[l[1]||(l[1]=e=>K.value=e),ue],"default-expand-all":""},{"default-header":_(e=>[q("div",U,[k(c,{name:ne(e.node),size:"20px",class:"q-mr-sm",color:ie(e.node)},null,8,["name","color"]),q("span",null,L(e.node.displayName||e.node.name),1)])]),_:1},8,["nodes","selected"]))])]),_:1})]),after:_(()=>[k(a,{class:"fit"},{default:_(()=>[q("div",F,[se.value?(w(),x("div",T,[q("div",E,[q("h2",H,L(se.value.name),1),W.value?(w(),b(p,{key:0,color:"primary",class:"q-ml-sm"},{default:_(()=>{var e;return[j(L(te.value.length)+" of "+L((null==(e=se.value.originalLessons)?void 0:e.length)||0)+" lessons ",1)]}),_:1})):C("",!0)]),k(s,{bordered:"",separator:""},{default:_(()=>[(w(!0),x($,null,Q(te.value,(e,l)=>I((w(),b(u,{key:e.id,clickable:"",class:"q-py-md"},{default:_(()=>[k(r,{avatar:""},{default:_(()=>[k(o,{color:"primary","text-color":"white"},{default:_(()=>[j(L(l+1),1)]),_:2},1024)]),_:2},1024),k(r,null,{default:_(()=>[k(n,{class:"text-subtitle1"},{default:_(()=>[j(L(e.title),1)]),_:2},1024),e.text?(w(),b(n,{key:0,caption:""},{default:_(()=>[j(L(e.text),1)]),_:2},1024)):C("",!0)]),_:2},1024),k(r,{side:""},{default:_(()=>[k(i,{flat:"",round:"",icon:"play_arrow",color:"primary",onClick:l=>(e=>{D.notify({type:"positive",message:`Starting lesson: ${e.title}`,position:"top"})})(e)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)),[[t]])),128))]),_:1}),te.value&&0!==te.value.length?C("",!0):(w(),x("div",R,[k(c,{name:"info",size:"48px",color:"grey-5"}),q("p",A,[W.value?(w(),x("span",J,'No lessons match "'+L(W.value)+'"',1)):(w(),x("span",M,"No lessons available in this section"))])]))])):Z.value?C("",!0):(w(),x("div",O,[k(c,{name:"touch_app",size:"48px",color:"grey-5"}),l[5]||(l[5]=q("p",{class:"text-grey-7 q-mt-md"},"Select a section to view lessons",-1)),l[6]||(l[6]=j("33333 "))]))])]),_:1})]),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-76441b9e"]]);export{D as default};
