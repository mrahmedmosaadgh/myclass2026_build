import{o as e,u as a,c as l,d as o,aP as t,Q as u,aF as s,e as i,bb as n,l as r,m as v,b as c}from"./app-Buylb2AA.js";import{Q as d}from"./QSpace-1_yTqfel.js";import{Q as m}from"./QSelect-CcTxzM62.js";import{a as p,f as g,o as b,n as f,e as y,H as h,I as w,J as k,b as _,M as q,x as C,V as R,L as x,O as S,S as V,U as M}from"./vendor-CUZ9QTQV.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";import"./rtl-Cr6c3OOr.js";const z={class:"text-h6"},j={class:"recording-status q-mb-lg"},A={class:"q-mt-md"},P={class:"text-h6"},U={class:"text-subtitle2 text-grey-6"},F={key:0,class:"waveform-container q-mb-md"},D={class:"recording-controls q-mb-md"},Q={key:1,class:"playback-controls q-mb-md"},B={key:2,class:"permission-request q-mb-md"},H={class:"recording-settings q-mb-md"},I={class:"q-pa-md"},L={class:"q-mb-sm"},T={class:"q-mb-sm"},E=e({__name:"VoiceRecorderDialog",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","voice-recorded"],setup(e,{emit:E}){const O=e,W=E,$=a(),J=p({get:()=>O.modelValue,set:e=>W("update:modelValue",e)}),G=g(!1),K=g(!1),N=g(!1),X=g(0),Y=g(!1),Z=g(!1),ee=g(null),ae=g(null),le=g([]),oe=g(null),te=g(null),ue=g(null),se=g(null),ie=g(null),ne=g("high"),re=g("webm"),ve=[{label:"Low (8kHz)",value:"low"},{label:"Medium (16kHz)",value:"medium"},{label:"High (44kHz)",value:"high"}],ce=[{label:"WebM",value:"webm"},{label:"MP4",value:"mp4"},{label:"WAV",value:"wav"}],de=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});Y.value=!0,Z.value=!1,e.getTracks().forEach(e=>e.stop()),$.notify({type:"positive",message:"Microphone access granted",position:"top"})}catch(e){console.error("Permission denied:",e),$.notify({type:"negative",message:"Microphone access denied",position:"top"})}},me=async()=>{try{oe.value=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:qe(),channelCount:1,echoCancellation:!0,noiseSuppression:!0}}),te.value=new(window.AudioContext||window.webkitAudioContext),ue.value=te.value.createAnalyser();te.value.createMediaStreamSource(oe.value).connect(ue.value),ue.value.fftSize=256;const e={mimeType:Re(),audioBitsPerSecond:Ce()};ae.value=new MediaRecorder(oe.value,e),le.value=[],ae.value.ondataavailable=e=>{e.data.size>0&&le.value.push(e.data)},ae.value.onstop=()=>{const e=new Blob(le.value,{type:Re()});ee.value=e,oe.value&&oe.value.getTracks().forEach(e=>e.stop()),te.value&&te.value.close()},ae.value.start(100),G.value=!0,K.value=!1,X.value=0,ke(),_e()}catch(e){console.error("Error starting recording:",e),$.notify({type:"negative",message:"Failed to start recording",position:"top"})}},pe=()=>{ae.value&&G.value&&(ae.value.pause(),K.value=!0)},ge=()=>{ae.value&&K.value&&(ae.value.resume(),K.value=!1)},be=()=>{ae.value&&G.value&&(ae.value.stop(),G.value=!1,K.value=!1,ie.value&&cancelAnimationFrame(ie.value))},fe=()=>{ee.value=null,X.value=0,le.value=[]},ye=()=>{if(ee.value)if(N.value)N.value=!1;else{const e=new Audio(URL.createObjectURL(ee.value));e.play(),N.value=!0,e.onended=()=>{N.value=!1}}},he=()=>{ee.value&&W("voice-recorded",ee.value),J.value=!1},we=()=>{G.value&&be(),fe(),J.value=!1},ke=()=>{const e=Date.now(),a=setInterval(()=>{G.value?K.value||(X.value=Math.floor((Date.now()-e)/1e3)):clearInterval(a)},1e3)},_e=()=>{if(!ue.value||!se.value)return;const e=se.value,a=e.getContext("2d"),l=ue.value.frequencyBinCount,o=new Uint8Array(l),t=()=>{if(!G.value)return;ie.value=requestAnimationFrame(t),ue.value.getByteFrequencyData(o),a.fillStyle="#f5f5f5",a.fillRect(0,0,e.width,e.height);const u=e.width/l*2.5;let s,i=0;for(let t=0;t<l;t++)s=o[t]/255*e.height,a.fillStyle="rgb(25, 118, 210)",a.fillRect(i,e.height-s,u,s),i+=u+1};t()},qe=()=>({low:8e3,medium:16e3,high:44100}[ne.value]||44100),Ce=()=>({low:32e3,medium:64e3,high:128e3}[ne.value]||128e3),Re=()=>({webm:"audio/webm",mp4:"audio/mp4",wav:"audio/wav"}[re.value]||"audio/webm");return b(async()=>{try{const e=await navigator.permissions.query({name:"microphone"});Y.value="granted"===e.state,"prompt"===e.state&&(Z.value=!0)}catch(e){Z.value=!0}if(await f(),se.value){const e=se.value;e.width=300,e.height=100}}),y(()=>{G.value&&be(),ie.value&&cancelAnimationFrame(ie.value)}),(e,a)=>(w(),h(c,{modelValue:J.value,"onUpdate:modelValue":a[2]||(a[2]=e=>J.value=e),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:k(()=>[_(v,{style:{"min-width":"400px","max-width":"500px"}},{default:k(()=>[_(l,{class:"row items-center q-pb-none"},{default:k(()=>[q("div",z,[_(o,{name:"mic",class:"q-mr-sm"}),a[3]||(a[3]=R(" Voice Recorder "))]),_(d),C(_(u,{icon:"close",flat:"",round:"",dense:""},null,512),[[t]])]),_:1}),_(l,{class:"text-center"},{default:k(()=>{return[q("div",j,[q("div",{class:V(["recording-indicator",{recording:G.value,paused:K.value}])},[_(o,{name:G.value&&!K.value?"fiber_manual_record":K.value?"pause":ee.value?"check_circle":"mic",size:G.value?"4em":"3em",color:G.value&&!K.value?"negative":K.value?"orange":ee.value?"positive":"grey-7"},null,8,["name","size","color"])],2),q("div",A,[q("div",P,M(G.value&&!K.value?"Recording...":K.value?"Paused":ee.value?"Recording Complete":"Ready to Record"),1),q("div",U,M((e=X.value,`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`)),1)])]),G.value||ee.value?(w(),x("div",F,[q("canvas",{ref_key:"waveformCanvas",ref:se,class:"waveform-canvas"},null,512)])):S("",!0),q("div",D,[_(s,null,{default:k(()=>[G.value||ee.value?G.value&&!K.value?(w(),h(u,{key:1,color:"orange",icon:"pause",label:"Pause",size:"lg",onClick:pe})):G.value&&K.value?(w(),h(u,{key:2,color:"negative",icon:"fiber_manual_record",label:"Resume",size:"lg",onClick:ge})):S("",!0):(w(),h(u,{key:0,color:"negative",icon:"fiber_manual_record",label:"Start Recording",size:"lg",onClick:me,disable:!Y.value},null,8,["disable"])),G.value?(w(),h(u,{key:3,color:"grey-7",icon:"stop",label:"Stop",size:"lg",onClick:be,class:"q-ml-sm"})):S("",!0)]),_:1})]),ee.value&&!G.value?(w(),x("div",Q,[_(s,null,{default:k(()=>[_(u,{icon:N.value?"pause":"play_arrow",label:N.value?"Pause":"Play",color:"primary",onClick:ye},null,8,["icon","label"]),_(u,{icon:"replay",label:"Re-record",color:"orange",onClick:fe})]),_:1})])):S("",!0),!Y.value&&Z.value?(w(),x("div",B,[_(i,{class:"bg-orange-1 text-orange-8"},{avatar:k(()=>[_(o,{name:"mic_off"})]),action:k(()=>[_(u,{flat:"",color:"orange",label:"Request Permission",onClick:de})]),default:k(()=>[a[4]||(a[4]=R(" Microphone access is required to record voice notes. "))]),_:1})])):S("",!0),q("div",H,[_(n,{icon:"settings",label:"Recording Settings","header-class":"text-grey-7"},{default:k(()=>[q("div",I,[q("div",L,[a[5]||(a[5]=q("label",{class:"text-subtitle2"},"Quality:",-1)),_(m,{modelValue:ne.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ne.value=e),options:ve,outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue"])]),q("div",T,[a[6]||(a[6]=q("label",{class:"text-subtitle2"},"Format:",-1)),_(m,{modelValue:re.value,"onUpdate:modelValue":a[1]||(a[1]=e=>re.value=e),options:ce,outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue"])])])]),_:1})])];var e}),_:1}),_(r,{align:"right"},{default:k(()=>[_(u,{flat:"",label:"Cancel",color:"grey-7",onClick:we}),_(u,{label:ee.value?"Save Recording":"Close",color:"primary",onClick:he,disable:!ee.value},null,8,["label","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},[["__scopeId","data-v-a16fadc0"]]);export{E as default};
