import{p as e,u as t,bq as a,br as i,q as o,Q as s,n,d as l,e as r,aD as d,b as c}from"./app-BXm70mdJ.js";import{Q as u}from"./QSpace-Bu8V-QDa.js";import{f as p,a as f,k as m,o as v,L as g,I as y,M as b,b as w,J as h,y as x,H as _,O as j,V as S,x as Q,ab as L,aa as P,F as C,Q as $,U as V,am as k,al as q,Z as D}from"./vendor-DNM7Y6Xn.js";import T from"./TextSlide-DxH_5QVA.js";import U from"./MediaSlide-BE8IfmIe.js";import{Q as z}from"./QuestionSlide-D0sVKVDi.js";import E from"./LessonSidebar-BAr4v8Nk.js";import I from"./LessonPlayer-DcWh0k_5.js";import{u as A}from"./teacherStore-BpVC7zBP.js";import"./offline-BzIlwqNM.js";import"./i18n-CBOKL2HS.js";import"./ui-BP0GJNn5.js";import"./RichTextEditor-CxB-jvy6.js";import"./QSlider-BotkHKKU.js";import"./QTabs-CDJ215OP.js";import"./rtl-Cr6c3OOr.js";import"./QTab-DhKL91H_.js";import"./QTabPanels-LFwTBPSC.js";import"./use-panel-D2HepUiw.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanel-sB32VrK8.js";import"./purify.es-C2Ba6vpb.js";import"./MathEditor-BSejsytI.js";import"./katex-BXKQVcz-.js";import"./MathPastePreview-CJnG0Z0g.js";import"./QBadge-ZzhN1X9C.js";import"./QSelect-CnZtzPIC.js";import"./EnhancedQuestionEditor-Cs8uFUOt.js";import"./QuestionEditor-zbB_kPoz.js";import"./StepByStepEditor-B4BGjvgG.js";import"./QuestionTypeSelector-CB_cjRod.js";import"./QuizEngine-IQNXJWyB.js";import"./useQuizI18n-BM0hw-zK.js";import"./QPagination-CaPaC77P.js";const F={class:"flex bg-gray-50 overflow-hidden"},M={class:"flex-1 flex flex-col overflow-hidden"},O={class:"bg-white border-b border-gray-200 px-6 py-3"},B={class:"flex items-center justify-between"},N={class:"flex gap-2"},R={class:"bg-white border-b border-gray-200 px-6 py-4"},H={class:"flex items-start justify-between mb-4"},G={class:"flex-1 mr-4"},J={class:"flex gap-4 mt-2"},W=["value"],Z={class:"flex gap-3 pt-24"},K={class:"flex w-full flex-col"},X={class:"flex-1 overflow-y-auto p-8 bg-gray-50 flex justify-center"},Y={class:"w-full max-w-4xl bg-white rounded-xl shadow-sm border border-gray-200 min-h-[600px] p-2"},ee={key:0,class:"min-h-full flex flex-col"},te={class:"mb-2 flex justify-between items-center border-b pb-1"},ae={class:"flex-1"},ie={key:1,class:"h-full flex flex-col items-center justify-center text-gray-400"},oe={class:"text-h6 flex items-center gap-2"},se=e({__name:"lesson_presentation copy 2",props:{presentationId:{type:[Number,String],default:null},defaultContext:{type:Object,default:()=>({school_id:1,teacher_id:1,subject_id:1})},sections:{type:Array,default:()=>[]}},setup(e){const se=e,ne=A(),le=t(),re=new URLSearchParams(window.location.search).get("id"),de=se.presentationId||re,ce=p({name:"New Lesson",description:"Lesson description",grade_id:null,quiz_id:null,slides:[]}),ue=p(se.sections),pe=p("learn"),fe=p(null),me=p([]),ve=p(0),ge=p(!1),ye=p(!1),be=p(!0);p(!0);const we=f({get:()=>!le.screen.lt.sm&&be.value,set(e){be.value=e}});f(()=>{const e=ue.value.find(e=>e.id===pe.value);return e?`Section: ${e.title}`:"Select a section"});const he=f(()=>me.value.filter(e=>e.section===pe.value)),xe=f(()=>0===he.value.length?null:he.value[ve.value]),_e=e=>{switch(e){case"text":default:return T;case"question":return z;case"image":case"video":case"audio":case"pdf":return U}},je=()=>{const e={slide_type:"text",slide_content:{},section:pe.value};me.value.push(e),ve.value=he.value.length-1},Se=e=>{const t=document.createElement("DIV");return t.innerHTML=e||"",t.textContent||t.innerText||""},Qe=async()=>{if((()=>{var e,t;if(!ce.value.name.trim())return le.notify({type:"warning",message:"Please enter a lesson name",icon:"warning",position:"top"}),!1;if(!ce.value.grade_id)return le.notify({type:"warning",message:"Please select a grade",icon:"warning",position:"top"}),!1;for(let a=0;a<me.value.length;a++){const i=me.value[a];if("question"===i.slide_type){const t=(null==(e=i.slide_content)?void 0:e.questions)||[];if(0===t.length)return le.notify({type:"warning",message:`Slide ${a+1}: Please add at least one question`,icon:"warning",position:"top"}),ve.value=a,!1;for(let e=0;e<t.length;e++){const i=t[e];if(!Se(i.text).trim())return le.notify({type:"warning",message:`Slide ${a+1}, Question ${e+1}: Question text cannot be empty`,icon:"warning",position:"top"}),ve.value=a,!1;if(["short_answer","number"].includes(i.type)&&!i.correct_answer)return le.notify({type:"warning",message:`Slide ${a+1}, Question ${e+1}: Please provide a correct answer`,icon:"warning",position:"top"}),ve.value=a,!1;if("single_choice"===i.type&&!i.correct_answer)return le.notify({type:"warning",message:`Slide ${a+1}, Question ${e+1}: Please select a correct option`,icon:"warning",position:"top"}),ve.value=a,!1;if(["single_choice","multiple_choice"].includes(i.type)){if(!i.options||i.options.length<2)return le.notify({type:"warning",message:`Slide ${a+1}, Question ${e+1}: Must have at least 2 options`,icon:"warning",position:"top"}),ve.value=a,!1;for(let t=0;t<i.options.length;t++)if(!Se(i.options[t].text).trim())return le.notify({type:"warning",message:`Slide ${a+1}, Question ${e+1}, Option ${t+1}: Option text cannot be empty`,icon:"warning",position:"top"}),ve.value=a,!1}}}else if("text"===i.slide_type&&!Se(null==(t=i.slide_content)?void 0:t.text).trim())return le.notify({type:"warning",message:`Slide ${a+1}: Text content cannot be empty`,icon:"warning",position:"top"}),ve.value=a,!1}return!0})()){ge.value=!0;try{const e={...ce.value,school_id:se.defaultContext.school_id,teacher_id:se.defaultContext.teacher_id,subject_id:se.defaultContext.subject_id,grade_id:ce.value.grade_id||se.defaultContext.grade_id};let t;t=de?await D.put(route("lesson-presentation.update",{id:de}),e):await D.post(route("lesson-presentation.store"),e);const a=t.data;for(const i of me.value)i.id?await D.put(route("lesson-presentation.slides.update",{id:a.id,slideId:i.id}),i):await D.post(route("lesson-presentation.slides.add",{id:a.id}),i);if(le.notify({type:"positive",message:"Lesson saved successfully!",icon:"check_circle",position:"top",timeout:2e3}),!de&&a.id){const e=new URL(window.location);e.searchParams.set("id",a.id),window.history.pushState({},"",e)}}catch(e){console.error("Save failed:",e),le.notify({type:"negative",message:"Failed to save lesson. Please try again.",icon:"error",position:"top",timeout:3e3})}finally{ge.value=!1}}},Le=()=>{window.location.href="/lesson-presentation/edit"},Pe=async()=>{if(de)try{le.notify({type:"info",message:"Duplicating lesson...",icon:"content_copy",position:"top",timeout:1e3});const e={...ce.value,name:`${ce.value.name} (Copy)`,school_id:se.defaultContext.school_id,teacher_id:se.defaultContext.teacher_id,subject_id:se.defaultContext.subject_id},t=(await D.post(route("lesson-presentation.store"),e)).data;for(const a of me.value){const e={slide_type:a.slide_type,slide_content:a.slide_content,section:a.section};await D.post(route("lesson-presentation.slides.add",{id:t.id}),e)}le.notify({type:"positive",message:"Lesson duplicated successfully!",icon:"check_circle",position:"top",timeout:2e3}),setTimeout(()=>{window.location.href=`/lesson-presentation/edit?id=${t.id}`},500)}catch(e){console.error("Duplicate failed:",e),le.notify({type:"negative",message:"Failed to duplicate lesson",icon:"error",position:"top",timeout:3e3})}};return m(pe,()=>{ve.value=0}),v(async()=>{await ne.fetchTeacherData(),de?(async e=>{try{const t=await D.get(route("lesson-presentation.show",{id:e}));ce.value={name:t.data.name,description:t.data.description,grade_id:t.data.grade_id,quiz_id:t.data.quiz_id},me.value=(t.data.slides||[]).map(e=>({...e,section:e.section||"learn"}))}catch(t){console.error("Fetch failed:",t),le.notify({type:"negative",message:"Failed to load lesson",icon:"error",position:"top"})}})(de):(0===me.value.length&&je(),ne.grades.length>0&&(ce.value.grade_id=ne.grades[0].id))}),(e,t)=>(y(),g(C,null,[b("div",F,[b("div",M,[b("div",O,[b("div",B,[w(i,{class:"text-sm"},{default:h(()=>[w(a,{icon:"home",label:"Dashboard",to:"/dashboard"}),w(a,{icon:"school",label:"Lessons",to:"/lesson-presentation"}),w(a,{icon:"edit",label:x(de)?"Edit Lesson":"New Lesson"},null,8,["label"])]),_:1}),b("div",N,[w(s,{flat:"",dense:"",icon:"list",label:"All Lessons",color:"primary",size:"sm",to:"/lesson-presentation"},{default:h(()=>[w(o,null,{default:h(()=>t[11]||(t[11]=[S("View all lessons")])),_:1})]),_:1}),w(s,{flat:"",dense:"",icon:"add_circle",label:"New Lesson",color:"positive",size:"sm",onClick:Le},{default:h(()=>[w(o,null,{default:h(()=>t[12]||(t[12]=[S("Create a new lesson")])),_:1})]),_:1}),x(de)?(y(),_(s,{key:0,flat:"",dense:"",icon:"content_copy",label:"Duplicate",color:"secondary",size:"sm",onClick:Pe},{default:h(()=>[w(o,null,{default:h(()=>t[13]||(t[13]=[S("Duplicate this lesson")])),_:1})]),_:1})):j("",!0)])])]),b("div",R,[b("div",H,[b("div",G,[Q(b("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>ce.value.name=e),class:"text-xl font-bold text-gray-800 border-none focus:ring-0 p-0 w-full bg-transparent placeholder-gray-400",placeholder:"Untitled Lesson"},null,512),[[L,ce.value.name]]),b("div",J,[Q(b("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>ce.value.description=e),class:"text-sm text-gray-500 border-none focus:ring-0 p-0 flex-1 bg-transparent placeholder-gray-400",placeholder:"Add a description..."},null,512),[[L,ce.value.description]]),Q(b("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>ce.value.grade_id=e),class:"text-sm border-gray-200 rounded-md text-gray-600 py-1 pl-2 pr-8 bg-transparent focus:ring-0 focus:border-blue-500"},[t[14]||(t[14]=b("option",{value:null,disabled:""},"Select Grade",-1)),(y(!0),g(C,null,$(x(ne).grades,e=>(y(),g("option",{key:e.id,value:e.id},V(e.name),9,W))),128))],512),[[P,ce.value.grade_id]])])]),b("div",Z,[w(s,{outline:"",color:"primary",icon:"visibility",label:"Preview",onClick:t[3]||(t[3]=e=>ye.value=!0),disable:!x(de)},{default:h(()=>[x(de)?j("",!0):(y(),_(o,{key:0},{default:h(()=>t[15]||(t[15]=[S("Save the lesson first to preview")])),_:1}))]),_:1},8,["disable"]),w(s,{color:"positive",icon:"save",label:"Save",onClick:Qe,loading:ge.value},null,8,["loading"])])])]),b("div",K,[w(E,{sections:ue.value,currentSection_data:fe.value,"onUpdate:currentSection_data":t[4]||(t[4]=e=>fe.value=e),currentSection:pe.value,"onUpdate:currentSection":t[5]||(t[5]=e=>pe.value=e),slides:me.value,showDrawer:we.value,"onUpdate:showDrawer":t[6]||(t[6]=e=>we.value=e),"can-edit":!0,"active-slide":xe.value,onSelectSlide:t[7]||(t[7]=e=>ve.value=he.value.indexOf(e)),onAddSlide:je},null,8,["sections","currentSection_data","currentSection","slides","showDrawer","active-slide"])]),b("div",X,[b("div",Y,[xe.value?(y(),g("div",ee,[b("div",te,[t[17]||(t[17]=b("h3",{class:"text-lg font-medium text-gray-700"},"Edit Slide Content",-1)),Q(b("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>xe.value.slide_type=e),class:"border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},t[16]||(t[16]=[k('<option value="text" data-v-b55f77a4>Text Slide</option><option value="image" data-v-b55f77a4>Image Slide</option><option value="video" data-v-b55f77a4>Video Slide</option><option value="audio" data-v-b55f77a4>Audio Slide</option><option value="pdf" data-v-b55f77a4>PDF Slide</option><option value="question" data-v-b55f77a4>Question Slide</option>',6)]),512),[[P,xe.value.slide_type]])]),b("div",ae,[(y(),_(q(_e(xe.value.slide_type)),{modelValue:xe.value.slide_content,"onUpdate:modelValue":t[9]||(t[9]=e=>xe.value.slide_content=e)},null,8,["modelValue"]))])])):(y(),g("div",ie,t[18]||(t[18]=[b("i",{class:"fas fa-layer-group text-4xl mb-4"},null,-1),b("p",null,"Select a slide to edit or create a new one",-1)])))])])])]),w(c,{modelValue:ye.value,"onUpdate:modelValue":t[10]||(t[10]=e=>ye.value=e),maximized:""},{default:h(()=>[w(n,{class:"bg-white"},{default:h(()=>[w(l,{class:"row items-center q-pb-none bg-primary text-white"},{default:h(()=>[b("div",oe,[w(r,{name:"visibility",size:"28px"}),t[19]||(t[19]=S(" Student View Preview "))]),w(u),Q(w(s,{icon:"close",flat:"",round:"",dense:""},null,512),[[d]])]),_:1}),w(l,{class:"q-pa-none",style:{height:"calc(100vh - 60px)"}},{default:h(()=>[w(I,{presentation:{...ce.value,name:"Preview: "+ce.value.name},sections:ue.value,slides:me.value,"is-preview":!0},null,8,["presentation","sections","slides"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},[["__scopeId","data-v-b55f77a4"]]);export{se as default};
