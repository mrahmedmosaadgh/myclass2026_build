import{T as e,U as a,ar as l,as as o,aN as i,aE as s,ak as t,d as u,Q as d,ai as n,bl as r,D as p,aA as c,u as v,c as f,f as m,l as _,aP as h,m as g,b}from"./app-BwCflFkV.js";import{Q as F}from"./QEditor-DqHJ9Z3m.js";import{Q as q}from"./QCircularProgress-geHKoKWc.js";import{u as y,a as w,b as U}from"./use-file-DlZDX63w.js";import{p as k,a as S,f as x,k as z,z as j,l as B,h as L,ai as A,H as E,I as C,J as R,b as V,M as Q,U as O,$ as N,x as T}from"./vendor-CUZ9QTQV.js";import{Q as M}from"./QForm-BCWodDs-.js";import{r as $}from"./resumeApi-Cr1QNNlm.js";import"./offline-BzIlwqNM.js";import"./i18n-CP46N9fu.js";import"./ui-LrZmvB2D.js";import"./use-fullscreen-X4x-6n9-.js";function D(e){return(100*e).toFixed(2)+"%"}const I={...e,...w,label:String,color:String,textColor:String,square:Boolean,flat:Boolean,bordered:Boolean,noThumbnails:Boolean,thumbnailFit:{type:String,default:"cover"},autoUpload:Boolean,hideUploadBtn:Boolean,disable:Boolean,readonly:Boolean},P=[...y,"start","finish","added","removed"];const H=()=>!0;const G=function(e){const a={};return e.forEach(e=>{a[e]=H}),a}(P);function J(e){return"function"==typeof e?e:()=>e}const W=(({name:e,props:v,emits:f,injectPlugin:m})=>p({name:e,props:{...I,...v},emits:!0===c(f)?{...G,...f}:[...P,...f],setup:(e,{expose:p})=>function(e,p){const c=k(),{props:v,slots:f,emit:m,proxy:_}=c,{$q:h}=_,g=a(v,h),b=S(()=>!0!==v.disable&&!0!==v.readonly),F=x(!1),y=x(null),w=x(null),E={files:x([]),queuedFiles:x([]),uploadedFiles:x([]),uploadedSize:x(0),updateFileStatus:function(e,a,o){if(e.__status=a,"idle"===a)return e.__uploaded=0,e.__progress=0,e.__sizeLabel=l(e.size),void(e.__progressLabel="0.00%");"failed"!==a?(e.__uploaded="uploaded"===a?e.size:o,e.__progress="uploaded"===a?1:Math.min(.9999,e.__uploaded/e.size),e.__progressLabel=D(e.__progress),_.$forceUpdate()):_.$forceUpdate()},isAlive:()=>!1===t(c)},{pickFiles:C,addFiles:R,onDragover:V,onDragleave:Q,processFiles:O,getDndNode:N,maxFilesNumber:T,maxTotalSizeNumber:M}=U({editable:b,dnd:F,getFileInput:oe,addFilesToQueue:ie});Object.assign(E,e({props:v,slots:f,emit:m,helpers:E,exposeApi:e=>{Object.assign(E,e)}})),void 0===E.isBusy&&(E.isBusy=x(!1));const $=x(0),I=S(()=>0===$.value?0:E.uploadedSize.value/$.value),P=S(()=>D(I.value)),H=S(()=>l($.value)),G=S(()=>!0===b.value&&!0!==E.isUploading.value&&(!0===v.multiple||0===E.queuedFiles.value.length)&&(void 0===v.maxFiles||E.files.value.length<T.value)&&(void 0===v.maxTotalSize||$.value<M.value)),J=S(()=>!0===b.value&&!0!==E.isBusy.value&&!0!==E.isUploading.value&&0!==E.queuedFiles.value.length);A(r,ue);const W=S(()=>"q-uploader column no-wrap"+(!0===g.value?" q-uploader--dark q-dark":"")+(!0===v.bordered?" q-uploader--bordered":"")+(!0===v.square?" q-uploader--square no-border-radius":"")+(!0===v.flat?" q-uploader--flat no-shadow":"")+(!0===v.disable?" disabled q-uploader--disable":"")+(!0===F.value?" q-uploader--dnd":"")),X=S(()=>"q-uploader__header"+(void 0!==v.color?` bg-${v.color}`:"")+(void 0!==v.textColor?` text-${v.textColor}`:""));function K(){!1===v.disable&&(E.abort(),E.uploadedSize.value=0,$.value=0,le(),E.files.value=[],E.queuedFiles.value=[],E.uploadedFiles.value=[])}function Y(){!1===v.disable&&ee(["uploaded"],()=>{E.uploadedFiles.value=[]})}function Z(){ee(["idle","failed"],({size:e})=>{$.value-=e,E.queuedFiles.value=[]})}function ee(e,a){if(!0===v.disable)return;const l={files:[],size:0},o=E.files.value.filter(a=>-1===e.indexOf(a.__status)||(l.size+=a.size,l.files.push(a),void 0!==a.__img&&window.URL.revokeObjectURL(a.__img.src),!1));0!==l.files.length&&(E.files.value=o,a(l),m("removed",l.files))}function ae(e){v.disable||("uploaded"===e.__status?E.uploadedFiles.value=E.uploadedFiles.value.filter(a=>a.__key!==e.__key):"uploading"===e.__status?e.__abort():$.value-=e.size,E.files.value=E.files.value.filter(a=>a.__key!==e.__key||(void 0!==a.__img&&window.URL.revokeObjectURL(a.__img.src),!1)),E.queuedFiles.value=E.queuedFiles.value.filter(a=>a.__key!==e.__key),m("removed",[e]))}function le(){E.files.value.forEach(e=>{void 0!==e.__img&&window.URL.revokeObjectURL(e.__img.src)})}function oe(){return w.value||y.value.getElementsByClassName("q-uploader__input")[0]}function ie(e,a){const l=O(e,a,E.files.value,!0),o=oe();null!=o&&(o.value=""),void 0!==l&&(l.forEach(e=>{if(E.updateFileStatus(e,"idle"),$.value+=e.size,!0!==v.noThumbnails&&e.type.toUpperCase().startsWith("IMAGE")){const a=new Image;a.src=window.URL.createObjectURL(e),e.__img=a}}),E.files.value=E.files.value.concat(l),E.queuedFiles.value=E.queuedFiles.value.concat(l),m("added",l),!0===v.autoUpload&&E.upload())}function se(){!0===J.value&&E.upload()}function te(e,a,l){if(!0===e){const e={type:"a",key:a,icon:h.iconSet.uploader[a],flat:!0,dense:!0};let o;return"add"===a?(e.onClick=C,o=ue):e.onClick=l,L(d,e,o)}}function ue(){return L("input",{ref:w,class:"q-uploader__input overflow-hidden absolute-full",tabindex:-1,type:"file",title:"",accept:v.accept,multiple:!0===v.multiple?"multiple":void 0,capture:v.capture,onMousedown:n,onClick:C,onChange:ie})}z(E.isUploading,(e,a)=>{!1===a&&!0===e?m("start"):!0===a&&!1===e&&m("finish")}),j(()=>{!0===E.isUploading.value&&E.abort(),0!==E.files.value.length&&le()});const de={};for(const a in E)!0===B(E[a])?o(de,a,()=>E[a].value):de[a]=E[a];return Object.assign(de,{upload:se,reset:K,removeUploadedFiles:Y,removeQueuedFiles:Z,removeFile:ae,pickFiles:C,addFiles:R}),i(de,{canAddFiles:()=>G.value,canUpload:()=>J.value,uploadSizeLabel:()=>H.value,uploadProgressLabel:()=>P.value}),p({...E,upload:se,reset:K,removeUploadedFiles:Y,removeQueuedFiles:Z,removeFile:ae,pickFiles:C,addFiles:R,canAddFiles:G,canUpload:J,uploadSizeLabel:H,uploadProgressLabel:P}),()=>{const e=[L("div",{class:X.value},void 0!==f.header?f.header(de):[L("div",{class:"q-uploader__header-content column"},[L("div",{class:"flex flex-center no-wrap q-gutter-xs"},[te(0!==E.queuedFiles.value.length,"removeQueue",Z),te(0!==E.uploadedFiles.value.length,"removeUploaded",Y),!0===E.isUploading.value?L(s,{class:"q-uploader__spinner"}):null,L("div",{class:"col column justify-center"},[void 0!==v.label?L("div",{class:"q-uploader__title"},[v.label]):null,L("div",{class:"q-uploader__subtitle"},[H.value+" / "+P.value])]),te(G.value,"add"),te(!1===v.hideUploadBtn&&!0===J.value,"upload",E.upload),te(E.isUploading.value,"clear",E.abort)])])]),L("div",{class:"q-uploader__list scroll"},void 0!==f.list?f.list(de):E.files.value.map(e=>L("div",{key:e.__key,class:"q-uploader__file relative-position"+(!0!==v.noThumbnails&&void 0!==e.__img?" q-uploader__file--img":"")+("failed"===e.__status?" q-uploader__file--failed":"uploaded"===e.__status?" q-uploader__file--uploaded":""),style:!0!==v.noThumbnails&&void 0!==e.__img?{backgroundImage:'url("'+e.__img.src+'")',backgroundSize:v.thumbnailFit}:null},[L("div",{class:"q-uploader__file-header row flex-center no-wrap"},["failed"===e.__status?L(u,{class:"q-uploader__file-status",name:h.iconSet.type.negative,color:"negative"}):null,L("div",{class:"q-uploader__file-header-content col"},[L("div",{class:"q-uploader__title"},[e.name]),L("div",{class:"q-uploader__subtitle row items-center no-wrap"},[e.__sizeLabel+" / "+e.__progressLabel])]),"uploading"===e.__status?L(q,{value:e.__progress,min:0,max:1,indeterminate:0===e.__progress}):L(d,{round:!0,dense:!0,flat:!0,icon:h.iconSet.uploader["uploaded"===e.__status?"done":"clear"],onClick:()=>{ae(e)}})])]))),N("uploader")];!0===E.isBusy.value&&e.push(L("div",{class:"q-uploader__overlay absolute-full flex flex-center"},[L(s)]));const a={ref:y,class:W.value};return!0===G.value&&Object.assign(a,{onDragover:V,onDragleave:Q}),L("div",a,e)}}(m,p)}))({name:"QUploader",props:{url:[Function,String],method:{type:[Function,String],default:"POST"},fieldName:{type:[Function,String],default:()=>e=>e.name},headers:[Function,Array],formFields:[Function,Array],withCredentials:[Function,Boolean],sendRaw:[Function,Boolean],batch:[Function,Boolean],factory:Function},emits:["factoryFailed","uploaded","failed","uploading"],injectPlugin:function({props:e,emit:a,helpers:l}){const o=x([]),i=x([]),s=x(0),t=S(()=>({url:J(e.url),method:J(e.method),headers:J(e.headers),formFields:J(e.formFields),fieldName:J(e.fieldName),withCredentials:J(e.withCredentials),sendRaw:J(e.sendRaw),batch:J(e.batch)}));let u;function d(o){if(s.value++,"function"!=typeof e.factory)return void n(o,{});const t=e.factory(o);if(t)if("function"==typeof t.catch&&"function"==typeof t.then){i.value.push(t);const e=e=>{!0===l.isAlive()&&(i.value=i.value.filter(e=>e!==t),0===i.value.length&&(u=!1),l.queuedFiles.value=l.queuedFiles.value.concat(o),o.forEach(e=>{l.updateFileStatus(e,"failed")}),a("factoryFailed",e,o),s.value--)};t.then(a=>{!0===u?e(new Error("Aborted")):!0===l.isAlive()&&(i.value=i.value.filter(e=>e!==t),n(o,a))}).catch(e)}else n(o,t||{});else a("factoryFailed",new Error("QUploader: factory() does not return properly"),o),s.value--}function n(e,i){const u=new FormData,d=new XMLHttpRequest,n=(e,a)=>void 0!==i[e]?J(i[e])(a):t.value[e](a),r=n("url",e);if(!r)return console.error("q-uploader: invalid or no URL specified"),void s.value--;const p=n("formFields",e);void 0!==p&&p.forEach(e=>{u.append(e.name,e.value)});let c,v=0,f=0,m=0,_=0;d.upload.addEventListener("progress",a=>{if(!0===c)return;const o=Math.min(_,a.loaded);l.uploadedSize.value+=o-m,m=o;let i=m-f;for(let s=v;i>0&&s<e.length;s++){const a=e[s];if(!(i>a.size))return void l.updateFileStatus(a,"uploading",i);i-=a.size,v++,f+=a.size,l.updateFileStatus(a,"uploading",a.size)}},!1),d.onreadystatechange=()=>{d.readyState<4||(d.status&&d.status<400?(l.uploadedFiles.value=l.uploadedFiles.value.concat(e),e.forEach(e=>{l.updateFileStatus(e,"uploaded")}),a("uploaded",{files:e,xhr:d})):(c=!0,l.uploadedSize.value-=m,l.queuedFiles.value=l.queuedFiles.value.concat(e),e.forEach(e=>{l.updateFileStatus(e,"failed")}),a("failed",{files:e,xhr:d})),s.value--,o.value=o.value.filter(e=>e!==d))},d.open(n("method",e),r),!0===n("withCredentials",e)&&(d.withCredentials=!0);const h=n("headers",e);void 0!==h&&h.forEach(e=>{d.setRequestHeader(e.name,e.value)});const g=n("sendRaw",e);e.forEach(e=>{l.updateFileStatus(e,"uploading",0),!0!==g&&u.append(n("fieldName",e),e,e.name),e.xhr=d,e.__abort=()=>{d.abort()},_+=e.size}),a("uploading",{files:e,xhr:d}),o.value.push(d),!0===g?d.send(new Blob(e)):d.send(u)}return{isUploading:S(()=>s.value>0),isBusy:S(()=>0!==i.value.length),abort:function(){o.value.forEach(e=>{e.abort()}),0!==i.value.length&&(u=!0)},upload:function(){const e=l.queuedFiles.value.slice(0);l.queuedFiles.value=[],t.value.batch(e)?d(e):e.forEach(e=>{d([e])})}}}}),X={class:"text-h6"},K={__name:"AnswerForm",props:{modelValue:Boolean,answer:Object,questionId:Number},emits:["update:modelValue","save"],setup(e,{emit:a}){const l=e,o=a,i=v(),s=x({answer_text:"",media_links:"",attachments:[]});function t(){const e={...s.value,media_links:s.value.media_links.split(",").map(e=>e.trim()).filter(Boolean)};(l.answer?$.updateAnswer(l.answer.id,e):$.createAnswer(l.questionId,e)).then(()=>{o("save"),o("update:modelValue",!1),i.notify({type:"positive",message:"Saved!"})}).catch(()=>i.notify({type:"negative",message:"Save failed"}))}return z(()=>l.answer,e=>{s.value=e?{...e,media_links:(e.media_links||[]).join(", ")}:{answer_text:"",media_links:"",attachments:[]}},{immediate:!0}),(a,l)=>(C(),E(b,{"model-value":e.modelValue,"onUpdate:modelValue":l[3]||(l[3]=e=>a.$emit("update:modelValue",e))},{default:R(()=>[V(g,{style:{"min-width":"400px"}},{default:R(()=>[V(f,null,{default:R(()=>[Q("div",X,O(e.answer?"Edit":"Add")+" Answer",1)]),_:1}),V(M,{onSubmit:N(t,["prevent"])},{default:R(()=>[V(f,{class:"q-gutter-md"},{default:R(()=>[V(F,{modelValue:s.value.answer_text,"onUpdate:modelValue":l[0]||(l[0]=e=>s.value.answer_text=e),label:"Answer",required:""},null,8,["modelValue"]),V(m,{modelValue:s.value.media_links,"onUpdate:modelValue":l[1]||(l[1]=e=>s.value.media_links=e),label:"Media Links (comma separated)"},null,8,["modelValue"]),V(W,{modelValue:s.value.attachments,"onUpdate:modelValue":l[2]||(l[2]=e=>s.value.attachments=e),label:"Attachments",multiple:""},null,8,["modelValue"])]),_:1}),V(_,{align:"right"},{default:R(()=>[T(V(d,{flat:"",label:"Cancel"},null,512),[[h]]),V(d,{color:"primary",label:"Save",type:"submit"})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}};export{K as default};
