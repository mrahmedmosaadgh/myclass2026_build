import{p as e,u as t,q as a,Q as i,e as o,n as s,d as n,aD as l,b as r}from"./app-BXm70mdJ.js";import{Q as d}from"./QBadge-ZzhN1X9C.js";import{Q as c}from"./QSpace-Bu8V-QDa.js";import{f as u,a as p,k as v,o as m,L as f,I as g,M as y,b as _,O as h,H as w,x,J as b,V as j,ab as S,aa as Q,am as k,al as z,F as P,Z as C}from"./vendor-DNM7Y6Xn.js";import V from"./TextSlide-DxH_5QVA.js";import $ from"./MediaSlide-BE8IfmIe.js";import{Q as q}from"./QuestionSlide-D0sVKVDi.js";import D from"./LessonSidebar-BAr4v8Nk.js";import T from"./LessonPlayer-DcWh0k_5.js";import L from"./QuizSelector-C5vkrdit.js";import{u as U}from"./teacherStore-BpVC7zBP.js";import"./offline-BzIlwqNM.js";import"./i18n-CBOKL2HS.js";import"./ui-BP0GJNn5.js";import"./RichTextEditor-CxB-jvy6.js";import"./QSlider-BotkHKKU.js";import"./QTabs-CDJ215OP.js";import"./rtl-Cr6c3OOr.js";import"./QTab-DhKL91H_.js";import"./QTabPanels-LFwTBPSC.js";import"./use-panel-D2HepUiw.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanel-sB32VrK8.js";import"./purify.es-C2Ba6vpb.js";import"./MathEditor-BSejsytI.js";import"./katex-BXKQVcz-.js";import"./MathPastePreview-CJnG0Z0g.js";import"./QSelect-CnZtzPIC.js";import"./EnhancedQuestionEditor-Cs8uFUOt.js";import"./QuestionEditor-zbB_kPoz.js";import"./StepByStepEditor-B4BGjvgG.js";import"./QuestionTypeSelector-CB_cjRod.js";import"./QuizEngine-IQNXJWyB.js";import"./useQuizI18n-BM0hw-zK.js";import"./QPagination-CaPaC77P.js";const E={class:"flex bg-gray-50 overflow-hidden"},I={class:"flex-1 flex flex-col overflow-hidden"},A={class:"bg-white border-b border-gray-200 px-6 py-3"},F={class:"flex items-center justify-between gap-4"},M={class:"flex-1 min-w-0"},O={class:"flex items-center gap-2 mb-1"},B={class:"flex items-center gap-2 ml-10"},N={class:"flex items-center gap-3"},R={class:"flex w-full flex-col"},G={key:0,class:"flex-1 overflow-y-auto p-6 bg-gray-50 flex justify-center"},H={class:"w-full max-w-4xl"},J={key:0,class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},W={class:"mb-4 flex items-center justify-between"},Z={class:"flex items-center gap-3"},K={class:"min-h-[500px]"},X={key:1,class:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center"},Y={class:"text-h6 flex items-center gap-2"},ee=e({__name:"lesson_presentation",props:{presentationId:{type:[Number,String],default:null},defaultContext:{type:Object,default:()=>({school_id:1,teacher_id:1,subject_id:1})},sections:{type:Array,default:()=>[]}},setup(e){const ee=e,te=U(),ae=t(),ie=new URLSearchParams(window.location.search).get("id"),oe=ee.presentationId||(ie?parseInt(ie):null),se=u(oe),ne=u({name:"New Lesson",description:"Lesson description",grade_id:null,quiz_id:null,slides:[]}),le=u(ee.sections),re=u(""),de=u(null),ce=u([]),ue=u(0),pe=u(!1),ve=u(!1),me=u(!0);u(!0);const fe=p({get:()=>!ae.screen.lt.sm&&me.value,set(e){me.value=e}});p(()=>{const e=le.value.find(e=>e.id===re.value);return e?`Section: ${e.title}`:"Select a section"});const ge=p(()=>ce.value.filter(e=>e.section===re.value)),ye=p(()=>0===ge.value.length?null:ge.value[ue.value]),_e=p(()=>{if(!ne.value.grade_id)return"No Grade";const e=te.grades.find(e=>e.id===ne.value.grade_id);return e?e.name:"Unknown Grade"}),he=e=>{switch(e){case"text":default:return V;case"question":return q;case"image":case"video":case"audio":case"pdf":return $}},we=()=>{const e={slide_type:"text",slide_content:{},section:re.value};ce.value.push(e),ue.value=ge.value.length-1},xe=e=>{const t=document.createElement("DIV");return t.innerHTML=e||"",t.textContent||t.innerText||""},be=async()=>{if((()=>{var e,t;if(!ne.value.name.trim())return ae.notify({type:"warning",message:"Please enter a lesson name",icon:"warning",position:"top"}),!1;if(!ne.value.grade_id)return ae.notify({type:"warning",message:"Please select a grade",icon:"warning",position:"top"}),!1;for(let a=0;a<ce.value.length;a++){const i=ce.value[a];if("question"===i.slide_type){const t=(null==(e=i.slide_content)?void 0:e.questions)||[];if(0===t.length)return ae.notify({type:"warning",message:`Slide ${a+1}: Please add at least one question`,icon:"warning",position:"top"}),ue.value=a,!1;for(let e=0;e<t.length;e++){const i=t[e];if(!xe(i.text).trim())return ae.notify({type:"warning",message:`Slide ${a+1}, Question ${e+1}: Question text cannot be empty`,icon:"warning",position:"top"}),ue.value=a,!1;if(["short_answer","number"].includes(i.type)&&!i.correct_answer)return ae.notify({type:"warning",message:`Slide ${a+1}, Question ${e+1}: Please provide a correct answer`,icon:"warning",position:"top"}),ue.value=a,!1;if("single_choice"===i.type&&!i.correct_answer)return ae.notify({type:"warning",message:`Slide ${a+1}, Question ${e+1}: Please select a correct option`,icon:"warning",position:"top"}),ue.value=a,!1;if(["single_choice","multiple_choice"].includes(i.type)){if(!i.options||i.options.length<2)return ae.notify({type:"warning",message:`Slide ${a+1}, Question ${e+1}: Must have at least 2 options`,icon:"warning",position:"top"}),ue.value=a,!1;for(let t=0;t<i.options.length;t++)if(!xe(i.options[t].text).trim())return ae.notify({type:"warning",message:`Slide ${a+1}, Question ${e+1}, Option ${t+1}: Option text cannot be empty`,icon:"warning",position:"top"}),ue.value=a,!1}}}else if("text"===i.slide_type&&(null==(t=i.slide_content)?void 0:t.text)&&!xe(i.slide_content.text).trim())return ae.notify({type:"warning",message:`Slide ${a+1}: Text content cannot be empty. Please add content or delete the slide.`,icon:"warning",position:"top"}),ue.value=a,!1}return!0})()){pe.value=!0;try{const e={...ne.value,school_id:ee.defaultContext.school_id,teacher_id:ee.defaultContext.teacher_id,subject_id:ee.defaultContext.subject_id,grade_id:ne.value.grade_id||ee.defaultContext.grade_id};let t;t=se.value?await C.put(route("lesson-presentation.update",{id:se.value}),e):await C.post(route("lesson-presentation.store"),e);const a=t.data;for(const i of ce.value){const e={slide_type:i.slide_type,slide_content:i.slide_content||{},section:i.section||re.value||"learn",order_index:i.order_index||0};i.id?await C.put(route("lesson-presentation.slides.update",{id:a.id,slideId:i.id}),e):await C.post(route("lesson-presentation.slides.add",{id:a.id}),e)}if(ae.notify({type:"positive",message:"Lesson saved successfully!",icon:"check_circle",position:"top",timeout:2e3}),!se.value&&a.id){se.value=a.id;const e=new URL(window.location);e.searchParams.set("id",a.id),window.history.pushState({},"",e)}}catch(e){console.error("Save failed:",e),ae.notify({type:"negative",message:"Failed to save lesson. Please try again.",icon:"error",position:"top",timeout:3e3})}finally{pe.value=!1}}},je=async()=>{if(se.value)try{ae.notify({type:"info",message:"Duplicating lesson...",icon:"content_copy",position:"top",timeout:1e3});const e={...ne.value,name:`${ne.value.name} (Copy)`,school_id:ee.defaultContext.school_id,teacher_id:ee.defaultContext.teacher_id,subject_id:ee.defaultContext.subject_id},t=(await C.post(route("lesson-presentation.store"),e)).data;for(const a of ce.value){const e={slide_type:a.slide_type,slide_content:a.slide_content,section:a.section};await C.post(route("lesson-presentation.slides.add",{id:t.id}),e)}ae.notify({type:"positive",message:"Lesson duplicated successfully!",icon:"check_circle",position:"top",timeout:2e3}),setTimeout(()=>{window.location.href=`/lesson-presentation/edit?id=${t.id}`},500)}catch(e){console.error("Duplicate failed:",e),ae.notify({type:"negative",message:"Failed to duplicate lesson",icon:"error",position:"top",timeout:3e3})}};return v(re,()=>{ue.value=0}),m(async()=>{await te.fetchTeacherData(),se.value?(async e=>{try{const t=await C.get(route("lesson-presentation.show",{id:e}));ne.value={name:t.data.name,description:t.data.description,grade_id:t.data.grade_id,quiz_id:t.data.quiz_id},ce.value=(t.data.slides||[]).map(e=>({...e,section:e.section||"learn"}))}catch(t){console.error("Fetch failed:",t),ae.notify({type:"negative",message:"Failed to load lesson",icon:"error",position:"top"})}})(se.value):(0===ce.value.length&&we(),te.grades.length>0&&(ne.value.grade_id=te.grades[0].id))}),(t,u)=>(g(),f(P,null,[y("div",E,[y("div",I,[y("div",A,[y("div",F,[y("div",M,[y("div",O,[_(i,{flat:"",dense:"",round:"",icon:"arrow_back",color:"grey-7",size:"sm",to:"/lesson-presentation"},{default:b(()=>[_(a,null,{default:b(()=>u[12]||(u[12]=[j("Back to lessons")])),_:1})]),_:1}),ne.value.grade_id?(g(),w(d,{key:0,color:"primary",label:_e.value},null,8,["label"])):h("",!0),x(y("input",{"onUpdate:modelValue":u[0]||(u[0]=e=>ne.value.name=e),class:"text-base font-semibold text-gray-800 border-none focus:ring-0 p-0 flex-1 bg-transparent placeholder-gray-400",placeholder:"Lesson Name"},null,512),[[S,ne.value.name]])]),y("div",B,[_(o,{name:"description",size:"14px",color:"grey-5"}),x(y("input",{"onUpdate:modelValue":u[1]||(u[1]=e=>ne.value.description=e),class:"text-sm text-gray-500 border-none focus:ring-0 p-0 flex-1 bg-transparent placeholder-gray-400",placeholder:"Add description..."},null,512),[[S,ne.value.description]])])]),y("div",N,[_(L,{modelValue:ne.value.quiz_id,"onUpdate:modelValue":u[2]||(u[2]=e=>ne.value.quiz_id=e),"school-id":e.defaultContext.school_id,"grade-id":ne.value.grade_id,"subject-id":e.defaultContext.subject_id},null,8,["modelValue","school-id","grade-id","subject-id"]),u[15]||(u[15]=y("div",{class:"h-6 w-px bg-gray-300"},null,-1)),se.value?(g(),w(i,{key:0,flat:"",dense:"",round:"",icon:"content_copy",color:"grey-7",size:"sm",onClick:je},{default:b(()=>[_(a,null,{default:b(()=>u[13]||(u[13]=[j("Duplicate")])),_:1})]),_:1})):h("",!0),_(i,{outline:"",dense:"",icon:"visibility",label:"Preview",color:"primary",size:"sm",onClick:u[3]||(u[3]=e=>ve.value=!0),disable:!se.value},{default:b(()=>[se.value?h("",!0):(g(),w(a,{key:0},{default:b(()=>u[14]||(u[14]=[j("Save first")])),_:1}))]),_:1},8,["disable"]),_(i,{unelevated:"",dense:"",icon:"save",label:"Save",color:"positive",size:"sm",onClick:be,loading:pe.value},null,8,["loading"])])])]),y("div",R,[_(D,{sections:le.value,currentSection_data:de.value,"onUpdate:currentSection_data":u[4]||(u[4]=e=>de.value=e),currentSection:re.value,"onUpdate:currentSection":u[5]||(u[5]=e=>re.value=e),slides:ce.value,showDrawer:fe.value,"onUpdate:showDrawer":u[6]||(u[6]=e=>fe.value=e),"can-edit":!0,"active-slide":ye.value,onSelectSlide:u[7]||(u[7]=e=>ue.value=ge.value.indexOf(e)),onAddSlide:we},null,8,["sections","currentSection_data","currentSection","slides","showDrawer","active-slide"])]),re.value?(g(),f("div",G,[y("div",H,[ye.value?(g(),f("div",J,[y("div",W,[y("div",Z,[_(o,{name:"edit_note",size:"24px",color:"primary"}),u[17]||(u[17]=y("h3",{class:"text-base font-semibold text-gray-700"},"Slide Editor",-1)),_(i,{round:"",dense:"",color:"negative",icon:"delete",size:"sm",onClick:u[8]||(u[8]=e=>{return t=ye.value,void ae.dialog({title:"Delete Slide",message:"Are you sure you want to delete this slide? This action cannot be undone.",cancel:!0,persistent:!0,ok:{label:"Delete",color:"negative",flat:!0},cancel:{label:"Cancel",color:"grey",flat:!0}}).onOk(()=>{const e=ce.value.indexOf(t);-1!==e&&(ce.value.splice(e,1),ge.value.length>0?ue.value>=ge.value.length&&(ue.value=ge.value.length-1):ue.value=0,ae.notify({type:"positive",message:"Slide deleted successfully",icon:"check_circle",position:"top",timeout:1500}))});var t})},{default:b(()=>[_(a,null,{default:b(()=>u[16]||(u[16]=[j("Delete Slide")])),_:1})]),_:1})]),x(y("select",{"onUpdate:modelValue":u[9]||(u[9]=e=>ye.value.slide_type=e),class:"border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 text-sm px-3 py-2"},u[18]||(u[18]=[k('<option value="text" data-v-c0eec36f>ğŸ“ Text</option><option value="image" data-v-c0eec36f>ğŸ–¼ï¸ Image</option><option value="video" data-v-c0eec36f>ğŸ¥ Video</option><option value="audio" data-v-c0eec36f>ğŸµ Audio</option><option value="pdf" data-v-c0eec36f>ğŸ“„ PDF</option><option value="question" data-v-c0eec36f>â“ Question</option>',6)]),512),[[Q,ye.value.slide_type]])]),y("div",K,[(g(),w(z(he(ye.value.slide_type)),{modelValue:ye.value.slide_content,"onUpdate:modelValue":u[10]||(u[10]=e=>ye.value.slide_content=e)},null,8,["modelValue"]))])])):(g(),f("div",X,[_(o,{name:"layers_clear",size:"4rem",color:"grey-4"}),u[19]||(u[19]=y("p",{class:"text-gray-500 text-lg mt-4 mb-2"},"No Slide Selected",-1)),u[20]||(u[20]=y("p",{class:"text-gray-400 text-sm"},"Choose a section and add a slide to get started",-1))]))])])):h("",!0)])]),_(r,{modelValue:ve.value,"onUpdate:modelValue":u[11]||(u[11]=e=>ve.value=e),maximized:""},{default:b(()=>[_(s,{class:"bg-white"},{default:b(()=>[_(n,{class:"row items-center q-pb-none bg-primary text-white"},{default:b(()=>[y("div",Y,[_(o,{name:"visibility",size:"28px"}),u[21]||(u[21]=j(" Student View Preview "))]),_(c),x(_(i,{icon:"close",flat:"",round:"",dense:""},null,512),[[l]])]),_:1}),_(n,{class:"q-pa-none",style:{height:"calc(100vh - 60px)"}},{default:b(()=>[_(T,{presentation:{...ne.value,name:"Preview: "+ne.value.name},sections:le.value,slides:ce.value,"is-preview":!0},null,8,["presentation","sections","slides"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},[["__scopeId","data-v-c0eec36f"]]);export{ee as default};
