import{r as e,u as a,Q as l,G as t,j as o,k as s,l as i,aR as u,i as n,c as r,b as d,t as c,m,e as v,d as p,f,h as y,o as _,be as g,aI as h,aS as b}from"./app-BxJhpxku.js";import{Q as w}from"./QSelect-DvJQhHwY.js";import{Q as k}from"./QBadge-CVqhPkEU.js";import{Q as x}from"./QMarkupTable-FlbqetwF.js";import{Q as j}from"./QSpinnerDots-DZPL0uRa.js";import{Q as V}from"./QSpace-BD6HDuXW.js";import{u as S}from"./i18n-B0T1C7j3.js";import{f as C,a as T,k as U,o as q,af as P,N as D,J as E,b as A,R as Q,z as F,I as z,W as L,V as O,K as I,ag as R,ah as $,y as G,O as M,F as W,Q as N,_ as B}from"./vendor-BWKGNkNB.js";import H from"./TimetableGrid-Dzx8qw9Y.js";import J from"./CSTAssignDialog-CewfY98V.js";import K from"./WeeklyPlanMenu-DA7hLATm.js";import X from"./AIImportDialog-D_7sAMlP.js";import Y from"./RandomFillDialog-ePTfsymd.js";import Z from"./CSTOverviewDialog-92rcZ8OR.js";import ee from"./DraftManagementPanel-C0rwSfZQ.js";import ae from"./DraftComparisonDialog-CTwNSsXo.js";import"./offline-BzIlwqNM.js";import"./ui-B7TfxbV_.js";import"./rtl-Cr6c3OOr.js";import"./TimetableCell-CqQbDkCJ.js";import"./QForm-CKei0wIu.js";import"./QTab-BW3Qt6f3.js";import"./QTabs-4Kad7p-S.js";import"./WeeklySystemGuide-BtIV4nYU.js";import"./QTabPanel-BOH9ztYE.js";import"./use-panel-BQ81VRJa.js";import"./use-render-cache-CmTcazfP.js";import"./QTabPanels-D4uDKOIK.js";import"./MainSchoolData-D_L2RBH7.js";import"./schoolData-CWFtmgnE.js";import"./SchoolSettingsDialog-fHYPg8yc.js";import"./QStepper-Cx-5qlNg.js";import"./QTd-CdMOzIxb.js";import"./QTable-bfrPmXFn.js";import"./QLinearProgress-C8hggxm2.js";import"./use-fullscreen-Dx2-rb4h.js";import"./QSpinnerGears-BKYn5ddQ.js";import"./QInnerLoading-C_Ypq-tN.js";import"./date-DbdfPnt6.js";import"./CSTSyncDialog-26aFlsOL.js";const le={class:"q-pa-md"},te={class:"row items-center q-mb-lg justify-between"},oe={class:"col-auto"},se={class:"q-ma-none text-weight-bold"},ie={class:"text-grey-7 q-mb-none"},ue={class:"col-auto row q-gutter-sm items-center"},ne={class:"row q-gutter-md items-end"},re={class:"col-12 col-sm-6 col-md-4"},de={class:"col-12 col-sm-auto"},ce={class:"col-12 col-sm-auto"},me={class:"col-12 col-sm-auto"},ve={class:"col-12 col-sm-auto"},pe={class:"row q-gutter-md items-center"},fe={class:"col-12 col-md-auto"},ye={key:0},_e={key:1},ge={class:"col-12 col-md-auto"},he={key:0},be={key:1},we={class:"col-12 col-md-3"},ke={class:"col-12 col-md-3"},xe={class:"col-auto"},je={class:"col-12"},Ve={key:0,class:"q-mb-sm"},Se={class:"text-caption text-grey-7 q-mb-xs"},Ce={class:"row q-gutter-sm"},Te={key:1},Ue={class:"text-caption text-grey-7 q-mb-xs"},qe={class:"row q-gutter-sm"},Pe={class:"text-left"},De={class:"text-left"},Ee={class:"text-center"},Ae={class:"text-center"},Qe={class:"text-center"},Fe={key:0,class:"row justify-center q-pa-xl"},ze={class:"text-h6 text-grey-7 q-mt-md"},Le={class:"text-grey-6"},Oe={class:"text-h6"},Ie={key:0,class:"text-center q-pa-md"},Re={key:1,class:"text-center text-grey-7 q-pa-md"},$e=e({__name:"TimetableEditor",setup(e){const{t:$e}=S(),Ge=a(),Me=C([]),We=C([]),Ne=C([]),Be=C([]),He=C([]),Je=C({}),Ke=C(null),Xe=C([1,2,3,4,5]),Ye=C([1,2,3,4,5,6,7,8]),Ze=C([]),ea=C([]),aa=[{label:"Sunday",value:1},{label:"Monday",value:2},{label:"Tuesday",value:3},{label:"Wednesday",value:4},{label:"Thursday",value:5},{label:"Friday",value:6},{label:"Saturday",value:7}],la=Array.from({length:12},(e,a)=>({label:`Period ${a+1}`,value:a+1})),ta=T(()=>{const e=Me.value.find(e=>e.id===Ke.value);return(null==e?void 0:e.name)||""}),oa=C(!1),sa=C(null),ia=C(null),ua=C(null),na=C(null),ra=C(!1),da=C(!1),ca=C(!1),ma=C(!1),va=C(!1),pa=C(!1),fa=C(!1),ya=C(!1),_a=C(!1),ga=C(!1),ha=C(!1),ba=C(""),wa=C(""),ka=C(!1),xa=C(null),ja=C(""),Va=C(!1),Sa=C(!1),Ca=C(!1);C(!1);const Ta=async()=>{var e;if(ba.value)try{await B.post("/weekly-system/api/drafts/save",{name:ba.value,description:wa.value,overwrite:ka.value,schedules:We.value}),Ge.notify({type:"positive",message:"Draft saved successfully"}),ga.value=!1,ba.value="",wa.value="",ka.value=!1}catch(a){409===(null==(e=a.response)?void 0:e.status)?Ge.notify({type:"warning",message:'Draft name exists. Check "Overwrite" to replace it.',timeout:5e3}):(console.error("Error saving draft:",a),Ge.notify({type:"negative",message:"Failed to save draft"}))}},Ua=async e=>{ha.value=!0,ja.value=e.name,Va.value=!0,xa.value=null;try{const a=await B.post("/weekly-system/api/drafts/compare",{name:e.name});xa.value=a.data.comparison}catch(a){console.error("Error comparing drafts:",a),Ge.notify({type:"negative",message:"Failed to compare schedules"}),ha.value=!1}finally{Va.value=!1}},qa=async()=>{Sa.value=!0;try{await B.post("/weekly-system/api/drafts/load",{name:ja.value,create_backup:!0}),Ge.notify({type:"positive",message:"Draft published successfully! Auto-backup created."}),ha.value=!1,_a.value=!1,await Ga()}catch(e){console.error("Error publishing draft:",e),Ge.notify({type:"negative",message:"Failed to publish draft"})}finally{Sa.value=!1}},Pa=async e=>{Sa.value=!0;try{await B.post("/weekly-system/api/drafts/load",{name:e.name,create_backup:!0}),Ge.notify({type:"positive",message:"Draft loaded successfully! Auto-backup created."}),_a.value=!1,await Ga()}catch(a){console.error("Error loading draft:",a),Ge.notify({type:"negative",message:"Failed to load draft"})}finally{Sa.value=!1}},Da=C(null),Ea=C(null),Aa=C(null),Qa=C(!1),Fa=C(!1),za=C([]),La=C("overall"),Oa=C(!1),Ia=C(!1),Ra=()=>{Xe.value=[1,2,3,4,5],Ye.value=[1,2,3,4,5,6,7,8],Ze.value=[],ea.value=[]},$a=async()=>{ca.value=!0;try{const e=new URLSearchParams(window.location.search),a=e.get("school"),l=e.get("teacher_id");if(l){const e=parseInt(l);isNaN(e)||(ea.value=[e])}const t={};a&&(t.school_id=a);const o=await B.get("/api/classrooms",{params:t}),s=o.data.data||o.data||[];Me.value=Array.isArray(s)?s:[];const i=e.get("classroom_id");let u=!1;if(i){const e=parseInt(i);Me.value.find(a=>a.id===e)&&(Ke.value=e,u=!0)}!Me.value.length||Ke.value||u||(Ke.value=Me.value[0].id)}catch(e){console.error("Error fetching classrooms:",e),Ge.notify({type:"negative",message:"Failed to load classrooms"})}finally{ca.value=!1}},Ga=async()=>{if(Ke.value){ma.value=!0;try{const e=await B.get("/admin/schedules",{params:{classroom_id:Ke.value}}),a=e.data.data||e.data||[];We.value=Array.isArray(a)?a:[],e.data.classroom_stats&&(Ea.value=e.data.classroom_stats),e.data.overall_stats&&(Aa.value=e.data.overall_stats),e.data.stats&&(Da.value=e.data.stats),Ea.value||Aa.value||Ha(),await Ma()}catch(e){console.error("Error fetching schedules:",e),Ge.notify({type:"negative",message:"Failed to load schedules"})}finally{ma.value=!1}}},Ma=async()=>{var e;try{const a=await B.get("/weekly-system/api/teacher-conflicts");Je.value=(null==(e=a.data.data)?void 0:e.conflicts)||{}}catch(a){console.error("Error fetching teacher conflicts:",a),Je.value={}}},Wa=async()=>{if(Ke.value){va.value=!0;try{const e=await B.get("/api/classroom-subject-teachers",{params:{classroom_id:Ke.value}});Ne.value=(e.data.data||e.data||[]).map(e=>({...e,display_label:`${e.subject_name} - ${e.teacher_name}`}))}catch(e){console.error("Error fetching CST options:",e)}finally{va.value=!1}}},Na=async()=>{pa.value=!0;try{const e=await B.get("/api/teachers");Be.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching teachers:",e)}finally{pa.value=!1}},Ba=async()=>{fa.value=!0;try{const e=await B.get("/api/subjects");He.value=e.data.data||e.data||[]}catch(e){console.error("Error fetching subjects:",e)}finally{fa.value=!1}},Ha=()=>{if(!Array.isArray(We.value)||0===We.value.length)return void(Da.value={total_slots:0,assigned_slots:0,unassigned_slots:0,conflict_count:0});const e=We.value.filter(e=>e&&e.cst_id&&null!=e.day_number&&null!=e.period_number).length,a=We.value.length,l=Object.keys(Je.value||{}).length;Da.value={total_slots:a,assigned_slots:e,unassigned_slots:a-e,conflict_count:l}},Ja=async()=>{},Ka=async({day:e,period:a,schedule:l})=>{if(ia.value=e,ua.value=a,sa.value=l,Ke.value){ra.value=!0,na.value=null;try{const l=await B.get("/weekly-system/api/slot-availability",{params:{classroom_id:Ke.value,day:e,period:a}});na.value=l.data.data}catch(t){console.error("Error fetching slot availability:",t),na.value=null}finally{ra.value=!1}}oa.value=!0},Xa=e=>{sa.value=e,ia.value=e.day,ua.value=e.period_number,oa.value=!0},Ya=async e=>{try{const a=e.id;if(!a||a.toString().startsWith("temp_"))return void(await Ga());await B.put(`/admin/schedules/${a}`,{cst_id:null,day:e.day_number||e.day,period_number:e.period_number}),Ge.notify({type:"positive",message:"Slot cleared successfully"}),await Ga()}catch(a){console.error("Error clearing schedule:",a),Ge.notify({type:"negative",message:"Failed to clear slot"})}},Za=async e=>{var a,l;ya.value=!0;try{const a=e.day,l=e.period,t=We.value.find(e=>(e.day_number||e.day)==a&&e.period_number==l),o={cst_id:e.cst_id,day:a,period_number:l,teacher_substitute_id:e.teacher_substitute_id,co_teacher_id:e.co_teacher_id,co_subject_id:e.co_subject_id,notes:e.notes,school_id:new URLSearchParams(window.location.search).get("school")};t&&t.id&&!t.id.toString().startsWith("temp_")?await B.put(`/admin/schedules/${t.id}`,o):await B.post("/admin/schedules/store",o),Ge.notify({type:"positive",message:"Schedule updated successfully"}),oa.value=!1,await Ga()}catch(t){console.error("Error saving schedule:",t);const e=(null==(l=null==(a=t.response)?void 0:a.data)?void 0:l.message)||"Failed to update schedule";Ge.notify({type:"negative",message:e})}finally{ya.value=!1}},el=e=>{},al=async e=>{La.value=e,Qa.value=!0,Fa.value=!0,za.value=[];try{const a={};"classroom"===e&&Ke.value&&(a.classroom_id=Ke.value);const l=await B.get("/weekly-system/api/teacher-conflicts",{params:a});if(l.data.success&&l.data.data){const e=l.data.data.conflicts||[],a=(Array.isArray(e)?e:Object.values(e)).filter(e=>!e.schedule_id);za.value=a.map(e=>({teacher_name:e.teacher_name,day_name:ll(e.day),period_number:e.period,classrooms:e.classrooms.map(e=>e.classroom_name)}))}}catch(a){console.error("Error fetching conflict details:",a),Ge.notify({type:"negative",message:"Failed to load conflict details"})}finally{Fa.value=!1}},ll=e=>["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e-1]||`Day ${e}`,tl=async()=>{We.value=[],await Ga(),Ge.notify({type:"positive",message:"AI import completed successfully! Timetable refreshed.",position:"top"})},ol=async()=>{We.value=[],await Ga(),Ge.notify({type:"positive",message:"Random fill completed successfully! Timetable refreshed.",position:"top"})};U(Ke,async e=>{e&&await Promise.all([Ga(),Wa()])}),q(async()=>{await Promise.all([$a(),Na(),Ba()])});const sl=C(!1),il=async()=>{if(Ke.value){sl.value=!0;try{await B.post("/admin/schedules/auto-fill-orders",{classroom_id:Ke.value}),Ge.notify({type:"positive",message:"Period orders updated successfully",position:"top"}),await Ga()}catch(e){console.error("Error auto-filling orders:",e),Ge.notify({type:"negative",message:"Failed to update Period orders"})}finally{sl.value=!1}}},ul=C(!1),nl=C(null),rl=()=>{if(!Ke.value)return;const e=Me.value.find(e=>e.id===Ke.value),a=((null==e?void 0:e.name)||"classroom").toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),l=route("schedules.classroom.view",{classroom_id:Ke.value,classroom_name:a});window.open(l,"_blank")},dl=()=>{if(!nl.value)return;const e="object"==typeof nl.value?nl.value:Be.value.find(e=>e.id===nl.value);if(!e)return;const a=(e.name||"teacher").toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),l=route("schedules.teacher.view",{teacher_id:e.id,teacher_name:a});window.open(l,"_blank"),ul.value=!1,nl.value=null},cl=()=>{if(!nl.value)return;const e="object"==typeof nl.value?nl.value:Be.value.find(e=>e.id===nl.value);if(!e)return;const a=(e.name||"teacher").toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),l=route("schedules.teacher.view",{teacher_id:e.id,teacher_name:a});navigator.clipboard.writeText(l).then(()=>{Ge.notify({type:"positive",message:"Teacher schedule link copied!",position:"top",timeout:2e3}),ul.value=!1,nl.value=null})},ml=()=>{if(!Ke.value)return;const e=Me.value.find(e=>e.id===Ke.value),a=((null==e?void 0:e.name)||"classroom").toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),l=route("schedules.classroom.view",{classroom_id:Ke.value,classroom_name:a});navigator.clipboard.writeText(l).then(()=>{Ge.notify({type:"positive",message:"Student schedule link copied to clipboard!",position:"top",timeout:2e3})})};return(e,a)=>{const S=P("Head");return E(),D(W,null,[A(S,{title:F($e)("weeklySystem.timetableEditor.title")},null,8,["title"]),Q("div",le,[A(K),Q("div",te,[Q("div",oe,[Q("h4",se,[A(l,{name:"grid_view",class:"q-mr-sm",color:"primary"}),L(" "+O(F($e)("weeklySystem.timetableEditor.title")),1)]),Q("p",ie,O(F($e)("weeklySystem.timetableEditor.subtitle")),1)]),Q("div",ue,[A(t,{color:"positive","text-color":"white",dense:"",icon:"cloud_done",class:"q-mr-md"},{default:I(()=>a[28]||(a[28]=[L(" Live Mode: Changes scale immediately ")])),_:1})])]),A(p,{flat:"",bordered:"",class:"q-pa-md q-mb-lg"},{default:I(()=>[Q("div",ne,[Q("div",re,[A(w,{modelValue:Ke.value,"onUpdate:modelValue":[a[0]||(a[0]=e=>Ke.value=e),Ja],options:Me.value,"option-value":"id","option-label":"name",label:F($e)("weeklyPlans.classroom"),outlined:"",dense:"","emit-value":"","map-options":"",loading:ca.value},{prepend:I(()=>[A(l,{name:"meeting_room",color:"secondary"})]),option:I(({opt:e,itemProps:a})=>[A(o,R($(a)),{default:I(()=>[A(s,null,{default:I(()=>[A(i,null,{default:I(()=>[L(O(e.name),1)]),_:2},1024),A(i,{caption:""},{default:I(()=>{var a;return[L(O((null==(a=e.grade)?void 0:a.name)||e.grade_name),1)]}),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","label","loading"])]),Q("div",de,[A(u,{color:"primary",icon:"settings",label:"Actions",disable:!Ke.value},{default:I(()=>[A(n,{style:{"min-width":"220px"}},{default:I(()=>[A(i,{header:"",class:"text-weight-bold bg-grey-1"},{default:I(()=>a[29]||(a[29]=[L("Tools")])),_:1}),G((E(),z(o,{clickable:"",onClick:a[1]||(a[1]=e=>Oa.value=!0)},{default:I(()=>[A(s,{avatar:""},{default:I(()=>[A(l,{name:"psychology",color:"secondary"})]),_:1}),A(s,null,{default:I(()=>[A(i,null,{default:I(()=>[L(O(F($e)("common.aiGenerate")),1)]),_:1}),A(i,{caption:""},{default:I(()=>a[30]||(a[30]=[L("Generate schedule with AI")])),_:1})]),_:1})]),_:1})),[[b]]),G((E(),z(o,{clickable:"",onClick:a[2]||(a[2]=e=>Ia.value=!0)},{default:I(()=>[A(s,{avatar:""},{default:I(()=>[A(l,{name:"shuffle",color:"positive"})]),_:1}),A(s,null,{default:I(()=>[A(i,null,{default:I(()=>a[31]||(a[31]=[L("Random Fill")])),_:1}),A(i,{caption:""},{default:I(()=>a[32]||(a[32]=[L("Auto-fill empty slots")])),_:1})]),_:1})]),_:1})),[[b]]),A(r),A(i,{header:"",class:"text-weight-bold bg-grey-1"},{default:I(()=>a[33]||(a[33]=[L("Share Links")])),_:1}),G((E(),z(o,{clickable:"",onClick:ml},{default:I(()=>[A(s,{avatar:""},{default:I(()=>[A(l,{name:"link",color:"primary"})]),_:1}),A(s,null,{default:I(()=>[A(i,null,{default:I(()=>a[34]||(a[34]=[L("Copy Student Link")])),_:1}),A(i,{caption:""},{default:I(()=>a[35]||(a[35]=[L("Classroom view URL")])),_:1})]),_:1})]),_:1})),[[b]]),G((E(),z(o,{clickable:"",onClick:rl},{default:I(()=>[A(s,{avatar:""},{default:I(()=>[A(l,{name:"open_in_new",color:"secondary"})]),_:1}),A(s,null,{default:I(()=>[A(i,null,{default:I(()=>a[36]||(a[36]=[L("Open Student Page")])),_:1}),A(i,{caption:""},{default:I(()=>a[37]||(a[37]=[L("Open in new tab")])),_:1})]),_:1})]),_:1})),[[b]]),G((E(),z(o,{clickable:"",onClick:a[3]||(a[3]=e=>ul.value=!0)},{default:I(()=>[A(s,{avatar:""},{default:I(()=>[A(l,{name:"person_search",color:"accent"})]),_:1}),A(s,null,{default:I(()=>[A(i,null,{default:I(()=>a[38]||(a[38]=[L("Get Teacher Link...")])),_:1}),A(i,{caption:""},{default:I(()=>a[39]||(a[39]=[L("Select teacher view")])),_:1})]),_:1})]),_:1})),[[b]])]),_:1})]),_:1},8,["disable"])]),Q("div",ce,[A(d,{color:"accent",icon:"format_list_numbered",label:F($e)("common.autoOrder")||"Auto-Order",outline:"",disable:!Ke.value,onClick:il,loading:sl.value},{default:I(()=>[A(c,null,{default:I(()=>a[40]||(a[40]=[L("Auto-fill period numbers (1, 2, 3...) for each subject")])),_:1})]),_:1},8,["label","disable","loading"])]),Q("div",me,[A(d,{color:"secondary",icon:"save",label:"Manage Drafts",outline:"",onClick:a[4]||(a[4]=e=>_a.value=!0)})]),Q("div",ve,[A(d,{color:"info",icon:"assignment_ind",label:"Assignments Overview",outline:"",onClick:a[5]||(a[5]=e=>da.value=!0)})])]),A(r,{class:"q-my-md"}),Q("div",pe,[Q("div",fe,[A(w,{modelValue:Xe.value,"onUpdate:modelValue":a[6]||(a[6]=e=>Xe.value=e),options:aa,label:"Days",outlined:"",dense:"",multiple:"","emit-value":"","map-options":"",style:{"min-width":"150px"}},{option:I(({itemProps:e,opt:a,selected:l,toggleOption:t})=>[A(o,R($(e)),{default:I(()=>[A(s,null,{default:I(()=>[A(i,null,{default:I(()=>[L(O(a.label),1)]),_:2},1024)]),_:2},1024),A(s,{side:""},{default:I(()=>[A(m,{"model-value":l,"onUpdate:modelValue":e=>t(a)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040)]),selected:I(()=>[Xe.value.length===aa.length?(E(),D("div",ye,"All Days")):(E(),D("div",_e,O(Xe.value.length)+" Days Selected",1))]),_:1},8,["modelValue"])]),Q("div",ge,[A(w,{modelValue:Ye.value,"onUpdate:modelValue":a[7]||(a[7]=e=>Ye.value=e),options:F(la),label:"Periods",outlined:"",dense:"",multiple:"","emit-value":"","map-options":"",style:{"min-width":"150px"}},{option:I(({itemProps:e,opt:a,selected:l,toggleOption:t})=>[A(o,R($(e)),{default:I(()=>[A(s,null,{default:I(()=>[A(i,null,{default:I(()=>[L(O(a.label),1)]),_:2},1024)]),_:2},1024),A(s,{side:""},{default:I(()=>[A(m,{"model-value":l,"onUpdate:modelValue":e=>t(a)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040)]),selected:I(()=>[Ye.value.length===F(la).length?(E(),D("div",he,"All Periods")):(E(),D("div",be,O(Ye.value.length)+" Periods",1))]),_:1},8,["modelValue","options"])]),Q("div",we,[A(w,{modelValue:Ze.value,"onUpdate:modelValue":a[8]||(a[8]=e=>Ze.value=e),options:He.value,"option-value":"id","option-label":"name",label:"Filter Subjects",outlined:"",dense:"",multiple:"","emit-value":"","map-options":"",clearable:""},{option:I(({itemProps:e,opt:a,selected:l,toggleOption:t})=>[A(o,R($(e)),{default:I(()=>[A(s,null,{default:I(()=>[A(i,null,{default:I(()=>[L(O(a.name),1)]),_:2},1024)]),_:2},1024),A(s,{side:""},{default:I(()=>[A(m,{"model-value":l,"onUpdate:modelValue":e=>t(a)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])]),Q("div",ke,[A(w,{modelValue:ea.value,"onUpdate:modelValue":a[9]||(a[9]=e=>ea.value=e),options:Be.value,"option-value":"id","option-label":"name",label:"Filter Teachers",outlined:"",dense:"",multiple:"","emit-value":"","map-options":"",clearable:""},{option:I(({itemProps:e,opt:a,selected:l,toggleOption:t})=>[A(o,R($(e)),{default:I(()=>[A(s,null,{default:I(()=>[A(i,null,{default:I(()=>[L(O(a.name),1)]),_:2},1024)]),_:2},1024),A(s,{side:""},{default:I(()=>[A(m,{"model-value":l,"onUpdate:modelValue":e=>t(a)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])]),Q("div",xe,[A(d,{flat:"",round:"",icon:"restart_alt",color:"grey",onClick:Ra},{default:I(()=>[A(c,null,{default:I(()=>a[41]||(a[41]=[L("Reset Filters")])),_:1})]),_:1})]),A(ee,{modelValue:_a.value,"onUpdate:modelValue":a[10]||(a[10]=e=>_a.value=e),onCompare:Ua,onLoad:Pa},null,8,["modelValue"]),A(ae,{modelValue:ha.value,"onUpdate:modelValue":a[11]||(a[11]=e=>ha.value=e),"draft-name":ja.value,comparison:xa.value,loading:Va.value,publishing:Sa.value,onPublish:qa},null,8,["modelValue","draft-name","comparison","loading","publishing"]),A(v,{modelValue:ga.value,"onUpdate:modelValue":a[15]||(a[15]=e=>ga.value=e)},{default:I(()=>[A(p,{style:{"min-width":"400px"}},{default:I(()=>[A(f,null,{default:I(()=>a[42]||(a[42]=[Q("div",{class:"text-h6"},"Save Schedule Draft",-1)])),_:1}),A(f,{class:"q-pt-none q-gutter-md"},{default:I(()=>[A(y,{filled:"",modelValue:ba.value,"onUpdate:modelValue":a[12]||(a[12]=e=>ba.value=e),autofocus:"",label:"Draft Name",hint:"Unique name for this version",rules:[e=>!!e||"Name is required"]},null,8,["modelValue","rules"]),A(y,{filled:"",modelValue:wa.value,"onUpdate:modelValue":a[13]||(a[13]=e=>wa.value=e),type:"textarea",label:"Description (Optional)",rows:"3",hint:"What changed in this version?"},null,8,["modelValue"]),A(m,{modelValue:ka.value,"onUpdate:modelValue":a[14]||(a[14]=e=>ka.value=e),label:"Overwrite if exists"},null,8,["modelValue"])]),_:1}),A(_,{align:"right",class:"text-primary"},{default:I(()=>[G(A(d,{flat:"",label:"Cancel"},null,512),[[b]]),A(d,{flat:"",label:"Save Draft",onClick:Ta,color:"primary"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),Q("div",je,[Aa.value?(E(),D("div",Ve,[Q("div",Se,O(F($e)("weeklyPlans.totalSlots"))+" ("+O(F($e)("weeklyPlans.allClassrooms"))+")",1),Q("div",Ce,[A(t,{dense:"",icon:"apps",color:"blue-2","text-color":"blue-9",size:"sm"},{default:I(()=>[L(O(Aa.value.total_slots)+" "+O(F($e)("common.total")),1)]),_:1}),A(t,{dense:"",icon:"check_circle",color:"green-2","text-color":"green-9",size:"sm"},{default:I(()=>[L(O(Aa.value.assigned_slots)+" "+O(F($e)("common.assigned")),1)]),_:1}),A(t,{dense:"",icon:"radio_button_unchecked",color:"grey-3","text-color":"grey-8",size:"sm"},{default:I(()=>[L(O(Aa.value.unassigned_slots)+" "+O(F($e)("common.empty")),1)]),_:1}),Aa.value.conflict_count>0?(E(),z(t,{key:0,dense:"",icon:"warning",color:"orange-2","text-color":"orange-9",size:"sm",clickable:"",onClick:a[16]||(a[16]=e=>al("overall"))},{default:I(()=>[L(O(Aa.value.conflict_count)+" "+O(F($e)("common.conflicts")),1)]),_:1})):M("",!0)])])):M("",!0),Ea.value?(E(),D("div",Te,[Q("div",Ue,O(F($e)("weeklyPlans.totalSlots"))+" ("+O(F($e)("weeklyPlans.currentClassroom"))+")",1),Q("div",qe,[A(t,{dense:"",icon:"apps",color:"blue-2","text-color":"blue-9",size:"sm"},{default:I(()=>[L(O(Ea.value.total_slots)+" "+O(F($e)("common.total")),1)]),_:1}),A(t,{dense:"",icon:"check_circle",color:"green-2","text-color":"green-9",size:"sm"},{default:I(()=>[L(O(Ea.value.assigned_slots)+" "+O(F($e)("common.assigned")),1)]),_:1}),A(t,{dense:"",icon:"radio_button_unchecked",color:"grey-3","text-color":"grey-8",size:"sm"},{default:I(()=>[L(O(Ea.value.unassigned_slots)+" "+O(F($e)("common.empty")),1)]),_:1}),Ea.value.conflict_count>0?(E(),z(t,{key:0,dense:"",icon:"warning",color:"orange-2","text-color":"orange-9",size:"sm",clickable:"",onClick:a[17]||(a[17]=e=>al("classroom"))},{default:I(()=>[L(O(Ea.value.conflict_count)+" "+O(F($e)("common.conflicts")),1)]),_:1})):M("",!0)]),Ea.value.subject_breakdown&&Ea.value.subject_breakdown.length>0?(E(),z(g,{key:0,modelValue:Ca.value,"onUpdate:modelValue":a[18]||(a[18]=e=>Ca.value=e),icon:"analytics",label:"Subject Breakdown",caption:"Expected vs Actual",class:"q-mt-md bg-grey-1 rounded-borders overflow-hidden","header-class":"text-primary"},{default:I(()=>[A(x,{dense:"",flat:"",square:"",class:"subject-breakdown-table"},{default:I(()=>[a[44]||(a[44]=Q("thead",null,[Q("tr",null,[Q("th",{class:"text-left"},"Subject"),Q("th",{class:"text-left"},"Teacher"),Q("th",{class:"text-center"},"Expected"),Q("th",{class:"text-center"},"Actual"),Q("th",{class:"text-center"},"Status")])],-1)),Q("tbody",null,[(E(!0),D(W,null,N(Ea.value.subject_breakdown,(e,o)=>(E(),D("tr",{key:o},[Q("td",Pe,[A(k,{color:"blue-2","text-color":"blue-9"},{default:I(()=>[L(O(e.subject_name),1)]),_:2},1024)]),Q("td",De,O(e.teacher_name),1),Q("td",Ee,[A(t,{dense:"",size:"sm",color:"grey-3","text-color":"grey-9"},{default:I(()=>[L(O(e.expected),1)]),_:2},1024)]),Q("td",Ae,[A(t,{dense:"",size:"sm",color:e.actual===e.expected?"green-2":"orange-2","text-color":e.actual===e.expected?"green-9":"orange-9"},{default:I(()=>[L(O(e.actual),1)]),_:2},1032,["color","text-color"])]),Q("td",Qe,[e.actual===e.expected?(E(),z(l,{key:0,name:"check_circle",color:"positive",size:"sm"},{default:I(()=>[A(c,null,{default:I(()=>a[43]||(a[43]=[L("Correct")])),_:1})]),_:1})):e.actual<e.expected?(E(),z(l,{key:1,name:"arrow_downward",color:"warning",size:"sm"},{default:I(()=>[A(c,null,{default:I(()=>[L("Missing "+O(e.expected-e.actual)+" period(s)",1)]),_:2},1024)]),_:2},1024)):(E(),z(l,{key:2,name:"arrow_upward",color:"warning",size:"sm"},{default:I(()=>[A(c,null,{default:I(()=>[L(O(e.actual-e.expected)+" extra period(s)",1)]),_:2},1024)]),_:2},1024))])]))),128))])]),_:1})]),_:1},8,["modelValue"])):M("",!0)])):M("",!0)])])]),_:1}),ma.value?(E(),D("div",Fe,[A(j,{size:"50px",color:"primary"})])):Ke.value?(E(),z(H,{key:2,schedules:We.value,"teacher-conflicts":Je.value,"visible-days":Xe.value,"visible-periods":Ye.value,"filter-subject-ids":Ze.value,"filter-teacher-ids":ea.value,onCellClick:Ka,onEdit:Xa,onClear:Ya},null,8,["schedules","teacher-conflicts","visible-days","visible-periods","filter-subject-ids","filter-teacher-ids"])):(E(),z(p,{key:1,flat:"",bordered:"",class:"text-center q-pa-xl"},{default:I(()=>[A(l,{name:"touch_app",size:"64px",color:"grey-5"}),Q("p",ze,O(F($e)("weeklySystem.timetableEditor.selectClassroom")),1),Q("p",Le,O(F($e)("weeklySystem.timetableEditor.chooseClassroom")),1)]),_:1})),A(J,{modelValue:oa.value,"onUpdate:modelValue":a[19]||(a[19]=e=>oa.value=e),schedule:sa.value,day:ia.value,period:ua.value,"classroom-name":ta.value,"cst-options":Ne.value,teachers:Be.value,subjects:He.value,"loading-c-s-t":va.value,"loading-teachers":pa.value,"loading-subjects":fa.value,saving:ya.value,"slot-availability":na.value,"loading-availability":ra.value,onSubmit:Za,onFilterCst:el,onClose:a[20]||(a[20]=e=>oa.value=!1)},null,8,["modelValue","schedule","day","period","classroom-name","cst-options","teachers","subjects","loading-c-s-t","loading-teachers","loading-subjects","saving","slot-availability","loading-availability"]),A(v,{modelValue:Qa.value,"onUpdate:modelValue":a[21]||(a[21]=e=>Qa.value=e),position:"right"},{default:I(()=>[A(p,{style:{width:"500px","max-width":"80vw"}},{default:I(()=>[A(f,{class:"row items-center q-pb-none"},{default:I(()=>[Q("div",Oe,O(F($e)("weeklySystem.timetableEditor.conflictDetails")),1),A(V),G(A(d,{icon:"close",flat:"",round:"",dense:""},null,512),[[b]])]),_:1}),A(f,null,{default:I(()=>[Fa.value?(E(),D("div",Ie,[A(h,{color:"primary",size:"3em"})])):0===za.value.length?(E(),D("div",Re,O(F($e)("common.noConflicts")),1)):(E(),z(n,{key:2,separator:""},{default:I(()=>[(E(!0),D(W,null,N(za.value,(e,a)=>(E(),z(o,{key:a},{default:I(()=>[A(s,null,{default:I(()=>[A(i,{class:"text-weight-medium"},{default:I(()=>[L(O(e.teacher_name),1)]),_:2},1024),A(i,{caption:""},{default:I(()=>[L(O(e.day_name)+" - Period "+O(e.period_number),1)]),_:2},1024),A(i,{caption:"",class:"text-orange-9"},{default:I(()=>[L(O(F($e)("weeklySystem.timetableEditor.assignedTo"))+": "+O(e.classrooms.join(", ")),1)]),_:2},1024)]),_:2},1024),A(s,{side:""},{default:I(()=>[A(k,{color:"orange",label:e.classrooms.length+" classes"},null,8,["label"])]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1},8,["modelValue"]),A(X,{modelValue:Oa.value,"onUpdate:modelValue":a[22]||(a[22]=e=>Oa.value=e),"classroom-id":Ke.value,"classroom-name":ta.value,subjects:He.value,onApplied:tl},null,8,["modelValue","classroom-id","classroom-name","subjects"]),A(Y,{modelValue:Ia.value,"onUpdate:modelValue":a[23]||(a[23]=e=>Ia.value=e),"classroom-id":Ke.value,"classroom-name":ta.value,onApplied:ol},null,8,["modelValue","classroom-id","classroom-name"]),A(Z,{modelValue:da.value,"onUpdate:modelValue":a[24]||(a[24]=e=>da.value=e)},null,8,["modelValue"]),A(v,{modelValue:ul.value,"onUpdate:modelValue":a[27]||(a[27]=e=>ul.value=e)},{default:I(()=>[A(p,{style:{"min-width":"400px"}},{default:I(()=>[A(f,null,{default:I(()=>a[45]||(a[45]=[Q("div",{class:"text-h6"},"Get Teacher Schedule Link",-1)])),_:1}),A(f,null,{default:I(()=>[A(w,{modelValue:nl.value,"onUpdate:modelValue":a[25]||(a[25]=e=>nl.value=e),options:Be.value,"option-value":"id","option-label":"name",label:"Select Teacher",outlined:"",dense:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",onFilter:a[26]||(a[26]=(e,a)=>{a(()=>{})}),ref:"teacherLinkSelect"},{"no-option":I(()=>[A(o,null,{default:I(()=>[A(s,{class:"text-grey"},{default:I(()=>a[46]||(a[46]=[L(" No results ")])),_:1})]),_:1})]),_:1},8,["modelValue","options"]),a[47]||(a[47]=Q("div",{class:"q-mt-sm text-caption text-grey"}," Select a teacher to generate a read-only schedule link. ",-1))]),_:1}),A(_,{align:"right"},{default:I(()=>[G(A(d,{flat:"",label:"Cancel",color:"primary"},null,512),[[b]]),A(d,{flat:"",label:"Open Page",color:"secondary",onClick:dl,disable:!nl.value},null,8,["disable"]),A(d,{flat:"",label:"Copy Link",color:"primary",onClick:cl,disable:!nl.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])],64)}}},[["__scopeId","data-v-219c9a41"]]);export{$e as default};
