import{Q as e}from"./QSpinnerDots-C_dcRmiY.js";import{o as l,u as a,c as s,d as t,m as i,Q as o,C as r,l as n,b as c,g as d,h as u,i as m,j as v,bb as p,aP as y}from"./app-tFXAu5dG.js";import{Q as g}from"./QCircularProgress-BUnc2i8G.js";import{Q as b}from"./QBadge-qhepP9EB.js";import{Q as f}from"./QTd-C5qDfsK9.js";import{Q as _}from"./QTable-RwFHEvWA.js";import{u as h}from"./i18n-kquWfmcz.js";import{f as k,a as w,k as x,o as P,N as j,J as Q,b as C,O as q,I as z,Q as I,K as N,V as E,z as S,F as M,R as $,W as A,y as D,_ as T}from"./vendor-nQjeLEvd.js";import{u as V}from"./useWeeklyPlansStore-C-QEkWe1.js";import"./offline-BzIlwqNM.js";import"./ui-Bfjdq-TR.js";import"./QMarkupTable-Cof6YCqy.js";import"./QSelect-CmlFFsWs.js";import"./rtl-Cr6c3OOr.js";import"./QLinearProgress-D4JaekYN.js";import"./use-fullscreen-COCl0uwf.js";import"./schoolData-B8mO1d2r.js";const W={class:"sync-dashboard q-pa-md"},F={key:0,class:"flex flex-center q-pa-xl"},B={key:1},O={class:"row q-col-gutter-md q-mb-lg"},R={class:"col-12 col-sm-6 col-md-3"},U={class:"stat-icon bg-blue-1 text-blue"},Y={class:"stat-value text-h4"},J={class:"stat-label text-grey-7"},K={class:"col-12 col-sm-6 col-md-3"},L={class:"stat-icon bg-green-1 text-green"},G={class:"stat-value text-h4 text-positive"},H={class:"stat-label text-grey-7"},X={class:"col-12 col-sm-6 col-md-3"},Z={class:"stat-icon bg-orange-1 text-orange"},ee={class:"stat-value text-h4 text-warning"},le={class:"stat-label text-grey-7"},ae={class:"col-12 col-sm-6 col-md-3"},se={class:"stat-icon bg-purple-1 text-purple"},te={class:"stat-value text-h4 text-primary"},ie={class:"stat-label text-grey-7"},oe={class:"row q-mb-lg"},re={class:"col-12"},ne={class:"row q-col-gutter-md"},ce={class:"row items-center q-mb-md"},de={class:"col"},ue={class:"text-h6"},me={class:"text-caption text-grey-7"},ve={class:"col-auto"},pe={class:"text-caption"},ye={key:0,class:"text-warning"},ge={class:"text-h6"},be={class:"text-caption text-grey-7"},fe={class:"text-h6 text-grey-7 q-mt-md"},_e={class:"text-grey-6"},he=l({__name:"WeeklyPlanSyncDashboard",setup(l){const{t:he}=h(),ke=V(),we=a(),xe=k(!1),Pe=k(!1),je=k(null),Qe=k(!1),Ce=k([]),qe=k([]),ze=k("all"),Ie=w(()=>"ar"===he("code")?"right":"left"),Ne=w(()=>[{name:"day",label:he("weeklyPlans.day"),field:"day",align:Ie.value,sortable:!0},{name:"period",label:he("weeklyPlans.period"),field:"period",align:"center",sortable:!0},{name:"subject",label:he("weeklyPlans.subject"),field:"subject",align:Ie.value,sortable:!0},{name:"teacher",label:he("weeklyPlans.teacher"),field:"teacher",align:Ie.value,sortable:!0},{name:"status",label:he("weeklyPlans.status"),field:"status",align:"center"}]),Ee=async()=>{if(ke.selectedCopyId){xe.value=!0;try{const e=await T.get("/weekly-system/api/sync-analysis",{params:{copy_id:ke.selectedCopyId,week_number:ke.weekNumber,academic_year_id:ke.selectedAcademicYearId,semester_number:ke.semesterNumber}});je.value=e.data}catch(e){console.error("Error fetching sync analysis:",e),we.notify({type:"negative",message:"Failed to load sync analysis"})}finally{xe.value=!1}}},Se=()=>{var e;ze.value="all",Ce.value=[],(null==(e=je.value)?void 0:e.classrooms)&&je.value.classrooms.forEach(e=>{e.days&&e.days.forEach(l=>{var a;(null==(a=l.missing_periods)?void 0:a.length)>0&&l.missing_periods.forEach(a=>{Ce.value.push({id:a.id,day:l.day,period:a.period,subject:a.subject,teacher:a.teacher,status:"missing",classroom_name:e.name})})})}),qe.value=[...Ce.value],Qe.value=!0},Me=()=>{var e,l;if("all"===ze.value)return"All Classrooms";const a=null==(l=null==(e=je.value)?void 0:e.classrooms)?void 0:l.find(e=>e.id===ze.value);return a?`Classroom ${a.name}`:""},$e=async()=>{var e,l;Pe.value=!0;try{const e=qe.value.map(e=>e.id),l=await T.post("/weekly-system/api/weekly-plans/batch-create",{schedule_ids:e,week_number:ke.weekNumber,academic_year_id:ke.selectedAcademicYearId,semester_number:ke.semesterNumber});we.notify({type:"positive",message:l.data.message||`Created ${e.length} weekly plans`}),Qe.value=!1,await Ee()}catch(a){console.error(a),we.notify({type:"negative",message:(null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||"Failed to create plans"})}finally{Pe.value=!1}};return x(()=>[ke.selectedCopyId,ke.weekNumber,ke.semesterNumber],()=>{Ee()},{deep:!0}),P(()=>{Ee()}),(l,a)=>{var h,k,w,x,P;return Q(),j("div",W,[xe.value?(Q(),j("div",F,[C(e,{size:"50px",color:"primary"})])):(Q(),j("div",B,[q("div",O,[q("div",R,[C(i,{flat:"",bordered:"",class:"stat-card"},{default:N(()=>[C(s,null,{default:N(()=>{var e,l;return[q("div",U,[C(t,{name:"grid_on",size:"32px"})]),q("div",Y,E((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.total_slots)||0),1),q("div",J,E(S(he)("weeklyPlans.totalSlots")),1)]}),_:1})]),_:1})]),q("div",K,[C(i,{flat:"",bordered:"",class:"stat-card"},{default:N(()=>[C(s,null,{default:N(()=>{var e,l;return[q("div",L,[C(t,{name:"check_circle",size:"32px"})]),q("div",G,E((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.complete)||0),1),q("div",H,E(S(he)("weeklyPlans.completed")),1)]}),_:1})]),_:1})]),q("div",X,[C(i,{flat:"",bordered:"",class:"stat-card"},{default:N(()=>[C(s,null,{default:N(()=>{var e,l;return[q("div",Z,[C(t,{name:"error",size:"32px"})]),q("div",ee,E((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.missing)||0),1),q("div",le,E(S(he)("weeklyPlans.missing")),1)]}),_:1})]),_:1})]),q("div",ae,[C(i,{flat:"",bordered:"",class:"stat-card"},{default:N(()=>[C(s,null,{default:N(()=>{var e,l;return[q("div",se,[C(t,{name:"trending_up",size:"32px"})]),q("div",te,E((null==(l=null==(e=je.value)?void 0:e.summary)?void 0:l.percentage)||0)+"%",1),q("div",ie,E(S(he)("weeklyPlans.progress")),1)]}),_:1})]),_:1})])]),q("div",oe,[q("div",re,[(null==(k=null==(h=je.value)?void 0:h.summary)?void 0:k.missing)>0?(Q(),z(o,{key:0,color:"primary",icon:"sync",label:S(he)("weeklyPlans.syncAll"),loading:Pe.value,onClick:Se,unelevated:"",size:"lg"},null,8,["label","loading"])):I("",!0)])]),q("div",ne,[(Q(!0),j(M,null,$(null==(w=je.value)?void 0:w.classrooms,e=>(Q(),j("div",{key:e.id,class:"col-12 col-md-6 col-lg-4"},[C(i,{flat:"",bordered:"",class:"classroom-card"},{default:N(()=>[C(s,null,{default:N(()=>{var l,a;return[q("div",ce,[q("div",de,[q("div",ue,E(e.name),1),q("div",me,E(e.complete)+"/"+E(e.total_slots)+" slots complete ",1)]),q("div",ve,[C(g,{value:e.percentage,size:"80px",thickness:.15,color:(a=e.percentage,a>=80?"positive":a>=50?"warning":"negative"),"track-color":"grey-3","show-value":""},{default:N(()=>[q("div",pe,E(e.percentage)+"%",1)]),_:2},1032,["value","color"])])]),(null==(l=e.days)?void 0:l.length)?(Q(),z(p,{key:0,icon:"calendar_today",label:S(he)("weeklyPlans.viewByDay"),dense:"","header-class":"text-primary"},{default:N(()=>[C(d,{dense:"",separator:""},{default:N(()=>[(Q(!0),j(M,null,$(e.days,e=>(Q(),z(u,{key:e.day_number},{default:N(()=>[C(m,null,{default:N(()=>[C(v,null,{default:N(()=>[A(E(e.day),1)]),_:2},1024),C(v,{caption:""},{default:N(()=>[A(E(e.complete)+"/"+E(e.total)+" complete ",1),e.missing>0?(Q(),j("span",ye," (Missing: P"+E(e.missing_periods.join(", P"))+") ",1)):I("",!0)]),_:2},1024)]),_:2},1024),C(m,{side:""},{default:N(()=>[C(b,{color:e.missing>0?"warning":"positive",label:e.missing>0?`${e.missing} missing`:"Complete"},null,8,["color","label"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["label"])):I("",!0),e.missing>0?(Q(),z(o,{key:1,color:"primary",icon:"sync",label:`${S(he)("weeklyPlans.syncWeeklyPlans")} (${e.missing})`,onClick:l=>(e=>{var l,a;ze.value=e,Ce.value=[];const s=null==(a=null==(l=je.value)?void 0:l.classrooms)?void 0:a.find(l=>l.id===e);s&&s.days&&s.days.forEach(e=>{var l;(null==(l=e.missing_periods)?void 0:l.length)>0&&e.missing_periods.forEach(l=>{Ce.value.push({id:l.id,day:e.day,period:l.period,subject:l.subject,teacher:l.teacher,status:"missing",classroom_name:s.name})})}),qe.value=[...Ce.value],Qe.value=!0})(e.id),outline:"",class:"full-width q-mt-md",size:"sm"},null,8,["label","onClick"])):I("",!0)]}),_:2},1024)]),_:2},1024)]))),128))]),C(c,{modelValue:Qe.value,"onUpdate:modelValue":a[1]||(a[1]=e=>Qe.value=e),"full-width":""},{default:N(()=>[C(i,null,{default:N(()=>[C(s,null,{default:N(()=>[q("div",ge,E(S(he)("weeklyPlans.syncPreview"))+" - "+E(Me()),1),q("div",be,E(S(he)("weeklyPlans.selectMissingPlans")),1)]),_:1}),C(s,{class:"q-pa-none"},{default:N(()=>[C(_,{rows:Ce.value,columns:Ne.value,"row-key":"id",selection:"multiple",selected:qe.value,"onUpdate:selected":a[0]||(a[0]=e=>qe.value=e),flat:"",bordered:"",pagination:{rowsPerPage:0},"virtual-scroll":"",style:{height:"400px"}},{"body-cell-status":N(e=>[C(f,{props:e},{default:N(()=>[C(r,{color:"negative","text-color":"white",size:"sm",icon:"warning"},{default:N(()=>a[2]||(a[2]=[A(" Missing ")])),_:1})]),_:2},1032,["props"])]),_:1},8,["rows","columns","selected"])]),_:1}),C(n,{align:"right",class:"q-pa-md"},{default:N(()=>[D(C(o,{flat:"",label:S(he)("common.cancel"),color:"primary"},null,8,["label"]),[[y]]),C(o,{unelevated:"",color:"primary",label:S(he)("weeklyPlans.createPlans",{count:qe.value.length}),disable:0===qe.value.length,loading:Pe.value,onClick:$e},null,8,["label","disable","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(null==(P=null==(x=je.value)?void 0:x.classrooms)?void 0:P.length)?I("",!0):(Q(),z(i,{key:0,flat:"",bordered:"",class:"text-center q-pa-xl q-mt-lg"},{default:N(()=>[C(t,{name:"check_circle",size:"64px",color:"positive"}),q("p",fe,E(S(he)("weeklyPlans.allSynced")),1),q("p",_e,E(S(he)("weeklyPlans.noMissingPlans")),1)]),_:1}))]))])}}},[["__scopeId","data-v-652055c6"]]);export{he as default};
