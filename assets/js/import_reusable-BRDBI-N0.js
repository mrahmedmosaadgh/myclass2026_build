import{o as e,c as t,Q as l,a,m as s,g as r,h as o,i as u,d as i,j as d,aE as n,e as c}from"./app-B9g134Ig.js";import{Q as m,a as v}from"./QStepper-DHzY1Glp.js";import{Q as p}from"./QMarkupTable--oDXHFoO.js";import{Q as b}from"./QTable-1t5veXt4.js";import{Q as f}from"./QBadge-DTOqueiL.js";import{Q as x}from"./QLinearProgress-Sm6onaUH.js";import{f as g,a as y,N as w,J as _,I as h,Q as k,O as C,z as q,a4 as S,b as j,K as R,V as T,L as P,F as I,R as U,W as Q,U as E}from"./vendor-nQjeLEvd.js";import L from"./ImportExcel-Bl8rDa5c.js";import"./offline-BzIlwqNM.js";import"./i18n-kquWfmcz.js";import"./ui-Bfjdq-TR.js";import"./use-panel-DG3Ijog8.js";import"./use-render-cache-CmTcazfP.js";import"./QSelect-s_FFdLoI.js";import"./rtl-Cr6c3OOr.js";import"./use-fullscreen-BWg0peHR.js";import"./Modal-HCEfRXK0.js";import"./xlsx-cMC2LkxH.js";const D={class:"q-pa-md"},O={class:"row items-center justify-between"},A={class:"text-h6"},F={class:"text-subtitle2"},V={class:"q-gutter-sm"},B={class:"q-mt-md"},M={class:"q-ma-none q-pl-md"},N={class:"q-mt-md"},$={class:"row q-col-gutter-md q-mb-md"},z={class:"col-12 col-sm-6 col-md-3"},K={class:"text-h5 text-bold text-blue-8"},G={class:"col-12 col-sm-6 col-md-3"},J={class:"text-h5 text-bold text-green-8"},W={class:"col-12 col-sm-6 col-md-3"},H={class:"text-h5 text-bold text-red-8"},X={class:"col-12 col-sm-6 col-md-3"},Y={class:"text-h5 text-bold text-orange-8"},Z={key:0},ee={key:1,class:"q-mt-md"},te={class:"row justify-end q-gutter-sm"},le={class:"q-mb-md"},ae={class:"text-subtitle2 q-mb-sm"},se={class:"absolute-full flex flex-center"},re={class:"row q-col-gutter-md"},oe={class:"col-12 col-sm-6 col-md-3"},ue={class:"text-h5 text-bold text-blue-8"},ie={class:"col-12 col-sm-6 col-md-3"},de={class:"text-h5 text-bold text-green-8"},ne={class:"col-12 col-sm-6 col-md-3"},ce={class:"text-h5 text-bold text-orange-8"},me={class:"col-12 col-sm-6 col-md-3"},ve={class:"text-h5 text-bold text-purple-8"},pe={class:"q-mt-md"},be=e({__name:"import_reusable",props:{title:{type:String,default:""},headerTitle:{type:String,default:"Import Course Management Data"},headerSubtitle:{type:String,default:"Upload Excel file to import courses, levels, sections, and lessons"},backRoute:{type:String,default:""},templateRoute:{type:String,default:""},viewRoute:{type:String,default:""},validateUrl:{type:String,required:!0},importUrl:{type:String,required:!0},undoUrl:{type:String,default:""},importColumns:{type:Array,required:!0},fullPreviewColumns:{type:Array,required:!0},buttonText:{type:String,default:"Choose Excel File"},previewTitle:{type:String,default:"Course Import Preview"},confirmButtonText:{type:String,default:"Confirm & Start Import"},notes:{type:Array,default:()=>["Course, Level, and Lesson columns are required",'Section column is optional (will use "General" if empty)',"Duplicate lessons will be skipped","Courses, levels, and sections will be created if they don't exist","Order will be assigned automatically"]},sampleRows:{type:Array,default:()=>[["Grade 5 Math","Fractions","Add unlike fractions","Lesson A"],["Grade 5 Math","Fractions","Add unlike fractions","Lesson B"],["English Literature","Poetry","","Introduction to Poetry"]]},backLabel:{type:String,default:"Back"}},emits:["validation-success","validation-error","import-success","import-error","imported"],setup(e,{emit:be}){const fe=e,xe=be,ge=g(1),ye=g(!1),we=g(!1),_e=g(null),he=g(null),ke=g([]),Ce=g([]),qe=g(0),Se=g(0),je=y(()=>0===Se.value?0:qe.value/Se.value),Re=()=>{fe.templateRoute&&window.open(fe.templateRoute,"_blank"),ge.value=2},Te=e=>{_e.value=e,e.fileData&&(ke.value=e.fileData.map((e,t)=>({index:t+2,...e}))),ge.value=3,xe("validation-success",e)},Pe=e=>{_e.value=null,xe("validation-error",e)},Ie=e=>{Ue(e)},Ue=e=>{he.value=e.stats||e,ye.value=!0,xe("import-success",e)},Qe=e=>{xe("import-error",e)},Ee=()=>{_e.value=null,ke.value=[],ge.value=3,xe("import-cancelled")},Le=()=>{we.value=!0,Se.value=ke.value.length,qe.value=0,Ce.value=ke.value.map(e=>({course:e.Course,level:e.Level,section:e.Section,lesson:e.Lesson,status:"pending"})),De()},De=async()=>{for(let t=0;t<ke.value.length;t++){Ce.value[t].status="processing";try{(await fetch(fe.importUrl,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({data:[ke.value[t]]})})).ok?Ce.value[t].status="success":Ce.value[t].status="error"}catch(e){Ce.value[t].status="error"}qe.value=t+1,await new Promise(e=>setTimeout(e,100))}try{const e=await fetch(fe.importUrl,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({data:ke.value})}),t=await e.json();e.ok?Ue(t):Qe(t)}catch(e){Qe({message:e.message})}},Oe=e=>{switch(e){case"pending":return"schedule";case"processing":return"sync";case"success":return"check_circle";case"error":return"error";default:return"help"}},Ae=e=>{switch(e){case"pending":default:return"grey";case"processing":return"primary";case"success":return"positive";case"error":return"negative"}},Fe=e=>{switch(e){case"success":return"bg-green-1";case"error":return"bg-red-1";case"processing":return"bg-blue-1";default:return""}},Ve=e=>{switch(e){case"pending":return"Waiting to process";case"processing":return"Processing...";case"success":return"Successfully imported";case"error":return"Failed to import";default:return"Unknown status"}};return(g,y)=>(_(),w("div",null,[e.title?(_(),h(q(S),{key:0,title:e.title},null,8,["title"])):k("",!0),C("div",D,[j(s,{flat:"",bordered:""},{default:R(()=>[j(t,null,{default:R(()=>[C("div",O,[C("div",null,[C("div",A,T(e.headerTitle),1),C("div",F,T(e.headerSubtitle),1)]),C("div",V,[e.backRoute?(_(),h(l,{key:0,flat:"",color:"grey-7",icon:"arrow_back",label:"Back",onClick:y[0]||(y[0]=t=>g.$inertia.visit(e.backRoute))})):k("",!0),e.templateRoute?(_(),h(l,{key:1,color:"primary",icon:"download",label:"Download Template",onClick:Re})):k("",!0)])])]),_:1}),j(a),j(t,null,{default:R(()=>[y[8]||(y[8]=C("div",{class:"text-h6 q-mb-md"},"Import Instructions",-1)),P(g.$slots,"instructions",{},()=>[j(m,{modelValue:ge.value,"onUpdate:modelValue":y[2]||(y[2]=e=>ge.value=e),color:"primary",animated:"",flat:"",bordered:"","header-nav":""},{default:R(()=>[j(v,{name:1,title:"Download Template",icon:"download",done:ge.value>1},{default:R(()=>[y[4]||(y[4]=C("div",{class:"text-body1"}," Download the Excel template to see the required format and sample data. ",-1)),C("div",B,[j(l,{color:"primary",icon:"download",label:"Download Template",onClick:Re})])]),_:1},8,["done"]),j(v,{name:2,title:"Prepare Your Data",icon:"edit",done:ge.value>2},{default:R(()=>[y[6]||(y[6]=C("div",{class:"text-body1 q-mb-md"}," Fill in your course data using this exact column structure: ",-1)),P(g.$slots,"prepare-table",{},()=>[j(p,{flat:"",bordered:""},{default:R(()=>[C("thead",null,[C("tr",null,[(_(!0),w(I,null,U(g.previewHeaderCols,(e,t)=>(_(),w("th",{class:"text-left",key:t},"Column "+T(String.fromCharCode(65+t)),1))),128))])]),C("tbody",null,[C("tr",null,[(_(!0),w(I,null,U(g.previewHeaderCols,(e,t)=>(_(),w("td",{key:t},[C("strong",null,T(e),1)]))),128))]),(_(!0),w(I,null,U(e.sampleRows,e=>(_(),w("tr",{class:"text-grey-7",key:e[0]},[(_(!0),w(I,null,U(e,(e,t)=>(_(),w("td",{key:t},T(e),1))),128))]))),128))])]),_:1})],!0),j(c,{class:"bg-blue-1 text-blue-8 q-mt-md",rounded:""},{avatar:R(()=>[j(i,{name:"info"})]),default:R(()=>[y[5]||(y[5]=C("div",{class:"text-subtitle2"},"Important Notes:",-1)),C("ul",M,[(_(!0),w(I,null,U(e.notes,(e,t)=>(_(),w("li",{key:t},T(e),1))),128))])]),_:1}),C("div",N,[j(l,{color:"primary",icon:"upload",label:"Ready to Upload",onClick:y[1]||(y[1]=e=>ge.value=3)})])]),_:3},8,["done"]),j(v,{name:3,title:"Upload & Import",icon:"upload",done:ye.value},{default:R(()=>[y[7]||(y[7]=C("div",{class:"text-body1 q-mb-md"}," Upload your Excel file to import the course data. ",-1)),P(g.$slots,"uploader",{},()=>[j(L,{"validate-url":e.validateUrl,"import-url":e.importUrl,"undo-url":e.undoUrl,columns:e.importColumns,"button-text":e.buttonText,"preview-title":e.previewTitle,"confirm-button-text":e.confirmButtonText,onValidationSuccess:Te,onValidationError:Pe,onImported:Ie},null,8,["validate-url","import-url","undo-url","columns","button-text","preview-title","confirm-button-text"])],!0)]),_:3},8,["done"])]),_:3},8,["modelValue"])],!0)]),_:3}),_e.value&&!we.value?(_(),h(t,{key:0},{default:R(()=>{var a;return[y[15]||(y[15]=C("div",{class:"text-h6 q-mb-md"},"File Preview & Confirmation",-1)),C("div",$,[C("div",z,[j(s,{class:"bg-blue-1 text-center"},{default:R(()=>[j(t,null,{default:R(()=>{var e;return[C("div",K,T((null==(e=_e.value.stats)?void 0:e.total_rows)||0),1),y[9]||(y[9]=C("div",{class:"text-subtitle2 text-grey-8"},"Total Rows",-1))]}),_:1})]),_:1})]),C("div",G,[j(s,{class:"bg-green-1 text-center"},{default:R(()=>[j(t,null,{default:R(()=>{var e;return[C("div",J,T((null==(e=_e.value.stats)?void 0:e.valid_rows)||0),1),y[10]||(y[10]=C("div",{class:"text-subtitle2 text-grey-8"},"Valid Rows",-1))]}),_:1})]),_:1})]),C("div",W,[j(s,{class:"bg-red-1 text-center"},{default:R(()=>[j(t,null,{default:R(()=>{var e;return[C("div",H,T((null==(e=_e.value.stats)?void 0:e.invalid_rows)||0),1),y[11]||(y[11]=C("div",{class:"text-subtitle2 text-grey-8"},"Invalid Rows",-1))]}),_:1})]),_:1})]),C("div",X,[j(s,{class:"bg-orange-1 text-center"},{default:R(()=>[j(t,null,{default:R(()=>{var e;return[C("div",Y,T((null==(e=_e.value.errors)?void 0:e.length)||0),1),y[12]||(y[12]=C("div",{class:"text-subtitle2 text-grey-8"},"Errors",-1))]}),_:1})]),_:1})])]),ke.value&&ke.value.length>0?(_(),w("div",Z,[y[13]||(y[13]=C("div",{class:"text-subtitle1 q-mb-md"},"Complete Data Preview",-1)),j(b,{rows:ke.value,columns:e.fullPreviewColumns,"row-key":"index",flat:"",bordered:"",dense:"",pagination:{rowsPerPage:20},class:"q-mb-md"},null,8,["rows","columns"])])):k("",!0),_e.value.errors&&_e.value.errors.length>0?(_(),w("div",ee,[y[14]||(y[14]=C("div",{class:"text-subtitle1 q-mb-md text-negative"},"Validation Errors",-1)),j(r,{bordered:"",class:"q-mb-md"},{default:R(()=>[(_(!0),w(I,null,U(_e.value.errors,(e,t)=>(_(),h(o,{key:t},{default:R(()=>[j(u,{avatar:""},{default:R(()=>[j(i,{name:"error",color:"negative"})]),_:1}),j(u,null,{default:R(()=>[j(d,null,{default:R(()=>[Q(T(e),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):k("",!0),C("div",te,[j(l,{flat:"",label:"Cancel",color:"grey-7",onClick:Ee}),j(l,{color:"primary",icon:"upload",label:"Confirm & Start Import",disable:0===(null==(a=_e.value.stats)?void 0:a.valid_rows),onClick:Le},null,8,["disable"])])]}),_:1})):k("",!0),we.value&&!ye.value?(_(),h(t,{key:1},{default:R(()=>[y[16]||(y[16]=C("div",{class:"text-h6 q-mb-md"},"Import Progress",-1)),C("div",le,[C("div",ae," Overall Progress: "+T(qe.value)+" / "+T(Se.value)+" rows ",1),j(x,{value:je.value,size:"20px",color:"primary",class:"q-mb-md"},{default:R(()=>[C("div",se,[j(f,{color:"white","text-color":"primary",label:`${Math.round(100*je.value)}%`},null,8,["label"])])]),_:1},8,["value"])]),y[17]||(y[17]=C("div",{class:"text-subtitle1 q-mb-md"},"Row Status",-1)),j(r,{bordered:""},{default:R(()=>[(_(!0),w(I,null,U(Ce.value,(e,t)=>(_(),h(o,{key:t,class:E(Fe(e.status))},{default:R(()=>[j(u,{avatar:""},{default:R(()=>[j(i,{name:Oe(e.status),color:Ae(e.status)},null,8,["name","color"])]),_:2},1024),j(u,null,{default:R(()=>[j(d,null,{default:R(()=>[Q("Row "+T(t+2)+": "+T(e.course)+" → "+T(e.level)+" → "+T(e.section)+" → "+T(e.lesson),1)]),_:2},1024),j(d,{caption:""},{default:R(()=>[Q(T(Ve(e.status)),1)]),_:2},1024)]),_:2},1024),"processing"===e.status?(_(),h(u,{key:0,side:""},{default:R(()=>[j(n,{color:"primary",size:"20px"})]),_:1})):k("",!0)]),_:2},1032,["class"]))),128))]),_:1})]),_:1})):k("",!0),he.value?(_(),h(t,{key:2},{default:R(()=>[y[23]||(y[23]=C("div",{class:"text-h6 q-mb-md"},"Import Results",-1)),C("div",re,[C("div",oe,[j(s,{class:"bg-blue-1 text-center"},{default:R(()=>[j(t,null,{default:R(()=>[C("div",ue,T(he.value.courses_created||0),1),y[18]||(y[18]=C("div",{class:"text-subtitle2 text-grey-8"},"Courses Created",-1))]),_:1})]),_:1})]),C("div",ie,[j(s,{class:"bg-green-1 text-center"},{default:R(()=>[j(t,null,{default:R(()=>[C("div",de,T(he.value.levels_created||0),1),y[19]||(y[19]=C("div",{class:"text-subtitle2 text-grey-8"},"Levels Created",-1))]),_:1})]),_:1})]),C("div",ne,[j(s,{class:"bg-orange-1 text-center"},{default:R(()=>[j(t,null,{default:R(()=>[C("div",ce,T(he.value.sections_created||0),1),y[20]||(y[20]=C("div",{class:"text-subtitle2 text-grey-8"},"Sections Created",-1))]),_:1})]),_:1})]),C("div",me,[j(s,{class:"bg-purple-1 text-center"},{default:R(()=>[j(t,null,{default:R(()=>[C("div",ve,T(he.value.lessons_created||0),1),y[21]||(y[21]=C("div",{class:"text-subtitle2 text-grey-8"},"Lessons Created",-1))]),_:1})]),_:1})])]),j(c,{class:"bg-green-1 text-green-8 q-mt-md",rounded:""},{avatar:R(()=>[j(i,{name:"check_circle"})]),default:R(()=>[y[22]||(y[22]=C("div",{class:"text-subtitle1"},"Import Completed Successfully!",-1)),C("div",null,T(he.value.total_processed||0)+" rows processed. "+T(he.value.lessons_skipped||0)+" duplicate lessons were skipped.",1)]),_:1}),C("div",pe,[j(l,{color:"primary",icon:"visibility",label:"View Courses",onClick:y[3]||(y[3]=t=>g.$inertia.visit(e.viewRoute||g.route("course-management.courses.index")))})])]),_:1})):k("",!0)]),_:3})])]))}},[["__scopeId","data-v-989db02a"]]);export{be as default};
